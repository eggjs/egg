<!DOCTYPE html>
<html lang="en">
<head>
  <title>Runtime Environment - Born to build better enterprise frameworks and apps</title>
<meta charset="utf-8">
<meta name="description" content="">
<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<link rel="icon" href="/images/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.css" />
<link rel="stylesheet" href="/css/index.css">

</head>
<body>
  <div class="nav" >
  <header>
    <a href="/" class="nav-logo" alt="egg"><img src="https://zos.alipayobjects.com/rmsportal/VTcUYAaoKqXyHJbLAPyF.svg"></a>
    <ul class="nav-item">
      <li>
        <form id="search-form">
          <input type="text" id="search-query" class="search-query st-default-search-input">
        </form>
      </li>
      <li><a href="/intro/" alt="Guide">Guide</a></li><li><a href="/tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li>
      <!--
      <li class="translations">
        <a class="nav-link">Translations</a>
        <span class="arrow"></span>
        <ul class="dropdown-content">
          <li><a href="/">中文</a></li>
          <li><a href="/">English</a></li>
        </ul>
      </li>
      -->
      <li><iframe src="https://ghbtns.com/github-btn.html?user=eggjs&repo=egg&type=star&count=true" frameborder="0" scrolling="0" width="150px" height="20px"></iframe></li>
    </ul>
    <a id="mobileTrigger" href="#" class="mobile-trigger">
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </a>
  </header>
</div>

  <div id="container">
    <div class="page-main">
  <article class="markdown-body">
    <h1>Runtime Environment</h1>
    <h1 id="runtime-environment"><a class="markdown-anchor" href="#runtime-environment">#</a> Runtime Environment</h1>
<p>There could be all kinds of difference during various stages of a web application development, but the application itself should be stateless, so EGG provide environment variables to cope with such difference.</p>
<p>EGG framework provides a variable named <code>env</code> for setting up the runtime environment. The <code>env</code> could be used to determine which configuration file should be applied, or you can perform any operations by detecting the <code>env</code> directly.</p>
<h2 id="how-to-configure-runtime-environment"><a class="markdown-anchor" href="#how-to-configure-runtime-environment">#</a> How to Configure Runtime Environment</h2>
<p>There are several ways:</p>
<ol>
<li>Use <code>config/env</code> file, usually we use the build tools to generate this file, the content of this file is just the env value, such as <code>prod</code>.</li>
<li>Specify the <code>EGG_SERVER_ENV</code> environment variable.</li>
</ol>
<p><code>EGG_SERVER_ENV</code> will be more commonly used, defining the environment variable when you start the application is the simplest way, for example, use the code below to start the application in the production environment.</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">EGG_SERVER_ENV=prod npm start</div></pre></td></tr></table></figure></p>
<h2 id="how-to-use"><a class="markdown-anchor" href="#how-to-use">#</a> How to Use</h2>
<p>You can use <code>app.config.env</code> to get the environment variable.
You can also load different configuration file for different environment by adding a file like  <code>config/config.{env}.js</code> with specified configs, please refer to  <a href="./config.html">config</a> for details.</p>
<h2 id="difference-with-node_env"><a class="markdown-anchor" href="#difference-with-node_env">#</a> Difference with NODE_ENV</h2>
<p>Lots of node applications use <code>NODE_ENV</code> for environment setting, but <code>EGG_SERVER_ENV</code>  distinguishes the environments much more specific. Generally speaking, there are local environment, unit test environment, test environment, production environment during the application development. Test and production environment are <strong>Server Environment</strong> and their <code>NODE_ENV</code> should be set to <code>production</code> , just like how npm make use of <code>NODE_ENV</code>. when you depoly applications in test and production environment, you don't install the devDependencies, so <code>production</code> should be applied.</p>
<p>Default mapping of <code>EGG_SERVER_ENV</code> and <code>NODE_ENV</code> (will generate <code>EGG_SERVER_ENV</code> from <code>NODE_ENV</code> setting if <code>EGG_SERVER_ENV</code> is not specified)</p>
<table>
<thead>
<tr>
<th>NODE_ENV</th>
<th>EGG_SERVER_ENV</th>
<th>remarks</th>
</tr>
</thead>
<tbody></tbody>
</table>
<pre><code>       | local          | local development environment
</code></pre>
<p>test       | unittest       | unit test environment
production | prod           | production environment</p>
<p>For example, <code>EGG_SERVER_ENV</code> will be set to prod when <code>NODE_ENV</code> is production and <code>EGG_SERVER_ENV</code> is not specified.</p>
<h2 id="customize-environment"><a class="markdown-anchor" href="#customize-environment">#</a> Customize environment</h2>
<p>In normal development process, it's not limit to these environments mentioned above. So you can customize environment for you development process, such as SIT (System integration testing).</p>
<p>Set <code>EGG_SERVER_ENV</code> to <code>sit</code> (also set <code>NODE_ENV = production</code> as recommend), the framework will load <code>config/config.sit.js</code> when lanching, and the runtime environment <code>app.config.env</code> will be <code>sit</code>.</p>
<h2 id="difference-with-koa"><a class="markdown-anchor" href="#difference-with-koa">#</a> Difference with Koa</h2>
<p>We are using <code>app.env</code> to distinguishes the environments in koa, and <code>app.env</code> defualt to <code>process.env.NODE_ENV</code>. But in egg (and frameworks base on egg), we put all the configurations in <code>app.config</code>, so we should use <code>app.config.env</code> to distinguishes the environments, <code>app.env</code> is no logger used.</p>

  </article>
  <aside id="mobileAside" class="toc">
  <div class="mobile-menu">
    <ul><li><a href="/intro/" alt="Guide">Guide</a></li><li><a href="/tutorials/index.html" alt="Tutorials">Tutorials</a></li><li><a href="https://github.com/search?q=topic%3Aegg-plugin&type=Repositories" alt="Plugins">Plugins</a></li><li><a href="https://github.com/eggjs/egg/releases" alt="Release">Release</a></li></ul>
  </div>
  <dl><dt>Guide</dt><dd><ul><li><a href="/en/intro/index.html">What is Egg?</a></li><li><a href="/en/intro/egg-and-koa.html">Egg and koa</a></li><li><a href="/en/intro/quickstart.html">Quick Start</a></li></ul></dd><dt>Basis Function</dt><dd><ul><li><a href="/en/basics/structure.html">Directory Structure</a></li><li><a href="/en/basics/env.html">Environment</a></li><li><a href="/en/basics/config.html">Configuration</a></li><li><a href="/en/basics/middleware.html">Middleware</a></li><li><a href="/en/basics/router.html">Router</a></li><li><a href="/en/basics/controller.html">Controller</a></li><li><a href="/en/basics/service.html">Service</a></li><li><a href="/en/basics/schedule.html">Schedule</a></li><li><a href="/en/basics/extend.html">Extend</a></li><li><a href="/en/basics/app-start.html">Custom Init</a></li></ul></dd><dt>Core</dt><dd><ul><li><a href="/en/core/development.html">Development</a></li><li><a href="/en/core/unittest.html">Unit Testing</a></li><li><a href="/en/core/deployment.html">应用部署</a></li><li><a href="/en/core/logger.html">Logger</a></li><li><a href="/en/core/httpclient.html">HttpClient</a></li><li><a href="/en/core/cookie-and-session.html">Cookie and Session</a></li><li><a href="/en/core/cluster-and-ipc.html">Cluster and IPC</a></li><li><a href="/en/core/view.html">View</a></li><li><a href="/en/core/error-handling.html">Error Handling</a></li><li><a href="/en/core/security.html">Security</a></li><li><a href="/en/core/i18n.html">i18n</a></li></ul></dd><dt>Tutorials</dt><dd><ul><li><a href="/en/tutorials/progressive.html">Progressive</a></li><li><a href="/en/tutorials/mysql.html">MySQL</a></li><li><a href="/en/tutorials/restful.html">RESTful API</a></li><li><a href="/en/tutorials/async-function.html">Async Function</a></li></ul></dd><dt>Advanced</dt><dd><ul><li><a href="/en/advanced/loader.html">Loader</a></li><li><a href="/en/advanced/plugin.html">Plugin</a></li><li><a href="/en/advanced/framework.html">Framework</a></li><li><a href="/en/advanced/cluster-client.html">Cluster Enhancement</a></li><li><a href="/en/advanced/view-plugin.html">View Plugin</a></li></ul></dd><dt>Community</dt><dd><ul><li><a href="/en/contributing.html">Contributing</a></li><li><a href="/en/resource.html">资源</a></li><li><a href="/en/faq.html">FAQ</a></li></ul></dd></dl>
</aside>
<script>
var mobileTrigger = document.getElementById('mobileTrigger');
var mobileAside = document.getElementById('mobileAside');
mobileTrigger.onclick = function(e) {
  if (mobileAside.className.indexOf('mobile-show') === -1) {
    mobileAside.className += ' mobile-show';
  } else {
    mobileAside.className = 'toc';
  }
};
</script>

</div>

  </div>
</body>
<script src="https://cdn.jsdelivr.net/docsearch.js/2/docsearch.min.js"></script>
<script> 
docsearch({
  apiKey: '1561de31a86f79507ea00cdb54ce647c',
  indexName: 'eggjs',
  inputSelector: '#search-query',
  // debug: true // Set debug to true if you want to inspect the dropdown
});
</script>
</html>
